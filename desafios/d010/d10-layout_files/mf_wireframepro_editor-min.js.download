try{if(!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return true;}}).x){Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:false,configurable:true,value:function(name,func){Object.defineProperty(this,name,{get:func,enumerable:true,configurable:true});}});Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:false,configurable:true,value:function(name,func){Object.defineProperty(this,name,{set:func,enumerable:true,configurable:true});}});}}catch(defPropException){}function getInternetExplorerVersion(){try{var sAgent=window.navigator.userAgent;var Idx=sAgent.indexOf("MSIE");if(Idx>0){return parseInt(sAgent.substring(Idx+5,sAgent.indexOf(".",Idx)));}else{if(!!navigator.userAgent.match(/Trident\/7\./)){return 11;}else{return 0;}}}catch(err){}return null;}function checkIEVersion(){try{var ver=getInternetExplorerVersion();if(ver>0){bootbox.confirm("ALERT! You're using an old unsupported version of Windows Internet Explorer. Only IE Edge and above are supported.",function(answer){window.location="https://mockflow.com";});}}catch(err){}}var MF_Global=(function(){function privateMethod(){}return{serverURL:function(){var url="https://wireframepro.mockflow.com/";try{var currentHost=window.location.hostname;if(currentHost.includes("wireframepro.mockflow.com")){url="https://wireframepro.mockflow.com/";}else{url="http://"+currentHost+":8080/MockFlow-WireframePro/";}}catch(e){url="https://wireframepro.mockflow.com/";}return url;},powerupServerURL:function(){var url="https://wireframepro.mockflow.com/rtc_powerup/";try{var currentHost=window.location.hostname;if(currentHost.indexOf("wireframepro.mockflow.com")==0){url="https://wireframepro.mockflow.com/rtc_powerup/";}else{url="http://"+currentHost+":2096/";}}catch(e){url="https://wireframepro.mockflow.com/rtc_powerup/";}return url;},websiteURL:function(){var url="https://mockflow.com/";try{var currentHost=window.location.hostname;if(currentHost.includes("mockflow.com")){url="https://mockflow.com/";}else{url="http://"+currentHost+":8080/MockFlow-Website/";}}catch(e){url="https://mockflow.com/";}return url;},cdnURL:function(){return"https://d20hhedk3h2l88.cloudfront.net/apps/wireframepro/";},getS3Bucket:function(){return"assets.mockflow.com";},getCompPath:function(){var comppath="js/src/internal/editor/components/";if(MF_Global.getS3Bucket()=="assets.mockflow.com"){comppath="js/internal/editor/components/";}return comppath;},getSpecPath:function(){var comppath="modules/specs/js/internal/components/";return comppath;},mockupImageURL:function(){return"https://s3.amazonaws.com/mfassets/company/"+MF_UserSession.getUser().company+"/mockup/";},adminAllow:function(){if(MF_UserSession.getUser()){if(MF_UserSession.getUser().username=="pbaskaran@produle.com"||MF_UserSession.getUser().username=="user3@produle.com"||MF_UserSession.getUser().username=="samples@produle.com"||MF_UserSession.getUser().username=="mail@produle.com"||MF_UserSession.getUser().username=="vgnanasabapathy@produle.com"||MF_UserSession.getUser().username=="mvenkat@produle.com"){return true;}}return false;},mockupSharedImageURL:function(company){return"https://s3.amazonaws.com/mfassets/company/"+company+"/mockup/";},getMode:function(){if(MF_Global.getS3Bucket()=="assets.mockflow.com"){if(mf_main.editorController&&mf_main.editorController.RENDER){return"DEV";}else{return"PROD";}}else{return"DEV";}},getS3URL:function(){return"https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/";},getS3ProdURL:function(){return"https://s3.amazonaws.com/assets.mockflow.com/";},getS3CdnURL:function(){if(MF_Global.getS3Bucket()=="assets.mockflow.com"){return"https://assets.mockflow.com/";}else{return"https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/";}}};})();(function(){var originalHTMLMethod=jQuery.fn.html;jQuery.fn.html=function(val){if(arguments&&arguments.length&&arguments.length>0){var nval=arguments[0];if(typeof nval==="string"){if(nval.toLowerCase().includes("http-equiv")){var res=nval.replace(/http-equiv/gi,"http_equiv");arguments[0]=res;}}}return originalHTMLMethod.apply(this,arguments);};var originalAppendMethod=jQuery.fn.append;jQuery.fn.append=function(val){if(arguments&&arguments.length&&arguments.length>0){var nval=arguments[0];if(typeof nval==="string"){if(nval.toLowerCase().includes("http-equiv")){var res=nval.replace(/http-equiv/gi,"http_equiv");arguments[0]=res;}}}return originalAppendMethod.apply(this,arguments);};var originalPrependMethod=jQuery.fn.prepend;jQuery.fn.prepend=function(val){if(arguments&&arguments.length&&arguments.length>0){var nval=arguments[0];if(typeof nval==="string"){if(nval.toLowerCase().includes("http-equiv")){var res=nval.replace(/http-equiv/gi,"http_equiv");arguments[0]=res;}}}return originalPrependMethod.apply(this,arguments);};var originalAfterMethod=jQuery.fn.after;jQuery.fn.after=function(val){if(arguments&&arguments.length&&arguments.length>0){var nval=arguments[0];if(typeof nval==="string"){if(nval.toLowerCase().includes("http-equiv")){var res=nval.replace(/http-equiv/gi,"http_equiv");arguments[0]=res;}}}return originalAfterMethod.apply(this,arguments);};var originalBeforeMethod=jQuery.fn.before;jQuery.fn.before=function(val){if(arguments&&arguments.length&&arguments.length>0){var nval=arguments[0];if(typeof nval==="string"){if(nval.toLowerCase().includes("http-equiv")){var res=nval.replace(/http-equiv/gi,"http_equiv");arguments[0]=res;}}}return originalBeforeMethod.apply(this,arguments);};})();function MF_DesignSpace(){var thisClass=this;this.id=null;this.builtIn=false;this.title=null;this.coverArt=null;this.icon=false;this.creator=null;this.createDate=new Date();this.updateDate=new Date();this.share=false;this.shareDisabled=false;this.isBasic=true;this.permitted=false;this.sharedClient=null;this.clientid=null;this.sections=null;this.permissionType=null;this.opened=false;this.checkPermission=false;this.membersCount=0;this.projectsCount=0;this.spaceDeletedCount=0;this.sort=0;this.urlslug=null;this.font=null;this.category=null;this.lastScrollPos=null;this.lastSearch=null;this.isdeleted=false;this.deletedon=null;this.builtIn=false;this.projects=new Array();this.uidrawings=new Array();this.files=new Array();this.powerups=new Array();this.embeds=new Array();this.collaborators=[];this.displayCollaborators=new Array();this.__defineSetter__("isShared",function(val){});this.__defineGetter__("isShared",function(){if(thisClass.permissionTypeStr=="Owner"){return false;}return true;});var createDateStr="";this.__defineGetter__("createDateStr",function(){if(thisClass.createDate!=null){var curr_date=new Date(thisClass.createDate).getDate();var curr_month=new Date(thisClass.createDate).getMonth()+1;var curr_year=new Date(thisClass.createDate).getFullYear();var hours=new Date(thisClass.createDate).getHours();var minutes=new Date(thisClass.createDate).getMinutes();return curr_date+" "+MF_Utils.getMonthByName(new Date(thisClass.createDate).getMonth())+" "+curr_year+" - "+hours+":"+minutes;}else{return thisClass.createDate;}});this.__defineSetter__("createDateStr",function(val){createDateStr=val;});var updateDateStr="";this.__defineGetter__("updateDateStr",function(){if(thisClass.updateDate!=null){thisClass.updateDate=new Date(thisClass.updateDate);var curr_date=thisClass.updateDate.getDate();var curr_month=thisClass.updateDate.getMonth()+1;var curr_year=thisClass.updateDate.getFullYear();var hours=thisClass.updateDate.getHours();var minutes=thisClass.updateDate.getMinutes();return curr_date+" "+MF_Utils.getMonthByName(thisClass.updateDate.getMonth())+" "+curr_year+" - "+hours+":"+minutes;}else{return thisClass.updateDate;}});this.__defineSetter__("updateDateStr",function(val){updateDateStr=val;});var shareStr="no";this.__defineGetter__("shareStr",function(){if(thisClass.share){return"yes";}else{return"no";}});this.__defineSetter__("shareStr",function(val){shareStr=val;});var owner=true;this.__defineGetter__("owner",function(){if(MF_UserSession.getUser()&&thisClass.clientid==MF_UserSession.getUser().company){return true;}return false;});this.__defineSetter__("owner",function(val){owner=val;});var isAdmin=false;this.__defineGetter__("isAdmin",function(){if(thisClass.permissionType=="Admin"){return true;}});this.__defineSetter__("isAdmin",function(val){isAdmin=val;});var isReviewer=false;this.__defineGetter__("isReviewer",function(){if(thisClass.permissionType=="Reviewer"){return true;}});this.__defineSetter__("isReviewer",function(val){isReviewer=val;});var isEditor=false;this.__defineGetter__("isEditor",function(){if(thisClass.permissionType=="Editor"){return true;}});this.__defineSetter__("isEditor",function(val){isEditor=val;});var canAdmin=false;this.__defineGetter__("canAdmin",function(){if(mf_main.PUBLIC){return false;}if(thisClass.builtIn){return true;}if(MF_UserSession.getUser()&&thisClass.clientid==MF_UserSession.getUser().company){return true;}if(thisClass.permissionType=="Admin"){return true;}return false;});this.__defineSetter__("canAdmin",function(val){canAdmin=val;});var permissionTypeStr="owner";this.__defineGetter__("permissionTypeStr",function(){if(thisClass.permissionType==null){return"Owner";}else{if(thisClass.permissionType=="Editor"){return"Editor";}return thisClass.permissionType;}});this.__defineSetter__("permissionTypeStr",function(val){permissionTypeStr=val;});this.__defineGetter__("creatorStr",function(){if(MF_UserSession.getUser()&&thisClass.clientid==MF_UserSession.getUser().company){return"Me";}return thisClass.creator;});this.__defineSetter__("creatorStr",function(val){});this.__defineGetter__("createdByStr",function(){if(MF_UserSession.getUser()&&thisClass.clientid==MF_UserSession.getUser().company){return"Created By";}return"Shared By";});this.__defineSetter__("createdByStr",function(val){});var daysToDelete="";this.__defineGetter__("daysToDelete",function(){if(thisClass.isdeleted){var dateToday=new Date();var dateDeleted=new Date(thisClass.deletedon);var differenceDays=(dateDeleted.getTime()-dateToday.getTime())/(1000*3600*24);differenceDays=Math.round(differenceDays+30);if(differenceDays<2){return"1 day";}else{return differenceDays+" days";}}return"";});this.__defineSetter__("daysToDelete",function(val){daysToDelete=val;});var coverArtImage="";this.__defineGetter__("coverArtImage",function(){var url="";if(thisClass.id=="default"){url="https://assets.mockflow.com/app/wireframepro/coverarts/images/mfdefaultcoverdefault.jpg";}else{if(thisClass.id=="trash"){url="https://assets.mockflow.com/app/wireframepro/coverarts/images/mfdefaultcovertrash.jpg";}else{if(thisClass.coverArt){var arr=thisClass.coverArt.split("#--__--#");if(arr.length>2&&arr[0]=="custom"){return"https://"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+thisClass.clientid+"/space/"+thisClass.id+"/cover/"+arr[1];}else{url="https://assets.mockflow.com/app/wireframepro/coverarts/images/"+arr[0]+".jpg";}}else{url="https://assets.mockflow.com/app/wireframepro/coverarts/images/"+thisClass.coverArt+".jpg";}}}return url;});this.__defineSetter__("coverArtImage",function(val){coverArtImage=val;});var coverArtWidth=0;this.__defineGetter__("coverArtWidth",function(){var vwidth=0;if(thisClass.id=="default"){vwidth=0;}else{if(thisClass.id=="trash"){vwidth=0;}else{if(thisClass.coverArt){var arr=thisClass.coverArt.split("#--__--#");if(arr.length>2&&arr[0]=="custom"){var imgarr=arr[2].split(",");return parseInt(imgarr[0]);}else{if(arr.length==2){var imgarr=arr[1].split(",");return parseInt(imgarr[0]);}}}}}return vwidth;});this.__defineSetter__("coverArtWidth",function(val){coverArtWidth=val;});var coverArtHeight=0;this.__defineGetter__("coverArtHeight",function(){var vheight=0;if(thisClass.id=="default"){vheight=0;}else{if(thisClass.id=="trash"){vheight=0;}else{if(thisClass.coverArt){var arr=thisClass.coverArt.split("#--__--#");if(arr.length>2&&arr[0]=="custom"){var imgarr=arr[2].split(",");return parseInt(imgarr[1]);}else{if(arr.length==2){var imgarr=arr[1].split(",");return parseInt(imgarr[1]);}}}}}return vheight;});this.__defineSetter__("coverArtHeight",function(val){coverArtHeight=val;});var coverArtThumbImage="";this.__defineGetter__("coverArtThumbImage",function(){var url="";if(thisClass.id=="default"){url="https://assets.mockflow.com/app/wireframepro/coverarts/images/thumbs/mfdefaultcoverdefault.jpg";}else{if(thisClass.id=="trash"){url="https://assets.mockflow.com/app/wireframepro/coverarts/images/thumbs/mfdefaultcovertrash.jpg";}else{if(thisClass.coverArt){var arr=thisClass.coverArt.split("#--__--#");if(arr.length>2&&arr[0]=="custom"){return"https://"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+thisClass.clientid+"/space/"+thisClass.id+"/cover/thumb/"+arr[1];}else{url="https://assets.mockflow.com/app/wireframepro/coverarts/images/thumbs/"+arr[0]+".jpg";}}else{url="https://assets.mockflow.com/app/wireframepro/coverarts/images/thumbs/"+thisClass.coverArt+".jpg";}}}return url;});this.__defineSetter__("coverArtThumbImage",function(val){coverArtThumbImage=val;});var coverPosY="";this.__defineGetter__("coverPosY",function(){var valu=-1;if(thisClass.coverArt){var arr=thisClass.coverArt.split("#--__--#");if(arr[0]=="custom"&&arr.length==4){valu=parseInt(arr[3]);return valu;}else{if(arr[0]!="custom"&&arr.length==3){valu=parseInt(arr[2]);return valu;}}}return valu;});this.__defineSetter__("coverPosY",function(val){coverPosY=val;});var isCustomCoverArt="";this.__defineGetter__("isCustomCoverArt",function(){var custom=false;if(thisClass.coverArt){var arr=thisClass.coverArt.split("#--__--#");if(arr[0]=="custom"){return true;}}return custom;});this.__defineSetter__("isCustomCoverArt",function(val){isCustomCoverArt=val;});var customCoverID="";this.__defineGetter__("customCoverID",function(){var coverid="null";if(thisClass.coverArt){var arr=thisClass.coverArt.split("#--__--#");if(arr[0]=="custom"){coverid=arr[1];}}return coverid;});this.__defineSetter__("customCoverID",function(val){customCoverID=val;});var iconImage="";this.__defineGetter__("iconImage",function(){if(thisClass.id=="trash"){return"images/dash/trashspace2.png";}else{if(thisClass.icon){return"https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+thisClass.clientid+"/space/"+thisClass.id+"/icon/"+thisClass.id+"?time="+new Date().getTime();}else{return"";}}});this.__defineSetter__("iconImage",function(val){iconImage=val;});var isTrashBin="";this.__defineGetter__("isTrashBin",function(){if(thisClass.id=="trash"){return true;}else{return false;}});this.__defineSetter__("isTrashBin",function(val){isTrashBin=val;});var isAddSpace="";this.__defineGetter__("isAddSpace",function(){if(thisClass.id=="add"){return true;}else{return false;}});this.__defineSetter__("isAddSpace",function(val){isAddSpace=val;});var publicProjCount=0;this.__defineSetter__("publicProjCount",function(val){publicProjCount=val;});this.__defineGetter__("publicProjCount",function(){var totalCount=0;if(thisClass.projects&&thisClass.projects.length>0){for(var i=0;i<thisClass.projects.length;i++){if(thisClass.projects[i].share&&!thisClass.projects[i].isdeleted){totalCount=totalCount+1;}}}return totalCount;});this.cast=function(obj){this.id=obj.id;this.title=obj.title;this.icon=obj.icon;this.coverArt=obj.coverArt;this.creator=obj.creator;if(obj.createDate&&typeof obj.createDate=="string"){this.createDate=new Date(obj.createDate);}else{this.createDate=obj.createDate;}if(obj.updateDate&&typeof obj.updateDate=="string"){this.updateDate=new Date(obj.updateDate);}else{this.updateDate=obj.updateDate;}this.publicURL=obj.publicURL;this.share=obj.share;this.shareDisabled=obj.shareDisabled;this.isBasic=obj.isBasic;this.permitted=obj.permitted;this.sharedClient=obj.shareClient;this.clientid=obj.clientid;this.permissionType=obj.permissionType;this.membersCount=obj.membersCount;this.projectsCount=obj.projectsCount;this.builtIn=obj.builtIn;this.isdeleted=obj.isdeleted;this.deletedon=obj.deletedon;this.sort=obj.sort;this.urlslug=obj.urlslug;this.sections=obj.sections;this.readonly=obj.readonly;this.collaborators=obj.collaborators;this.membersCount=obj.membersCount;this.projectsCount=obj.projectsCount;this.spaceDeletedCount=obj.spaceDeletedCount;};}function MF_DesignSpaceCollaborator(){var thisClass=this;this.id=null;this.name=null;this.spaceid=null;this.userid=null;this.type=null;this.disabled=false;var profileImage="";this.__defineGetter__("profileImage",function(){var emailId=thisClass.userid;if(emailId=="support@mockflow.com"){emailId="dummymf";}return MF_Utils.get_gravatar(emailId,60);});this.__defineSetter__("profileImage",function(val){profileImage=val;});var displayName="";this.__defineGetter__("displayName",function(){if(thisClass.name==null||thisClass.name.trim().length==0){var emailArr=thisClass.userid.split("@");return emailArr[0];}return thisClass.name;});this.__defineSetter__("displayName",function(val){displayName=val;});this.cast=function(obj){this.id=obj.id;this.name=obj.name;this.spaceid=obj.spaceid;this.userid=obj.userid;this.type=obj.type;this.disabled=obj.disabled;};}function MF_Project(){var thisClass=this;this.id=null;this.title=null;this.creator=null;this.createDate=new Date();this.updateDate=new Date();this.createNew=false;this.share=false;this.shareDisabled=false;this.isBasic=true;this.permitted=false;this.sharedClient=null;this.permissionType=null;this.realtime=false;this.revision=false;this.drawingType=null;this.checkPermission=false;this.comments=0;this.members=0;this.data=null;this.published=false;this.teamClientList=null;this.enableExport=true;this.enableComments=true;this.enablePublicEncrypt=false;this.publicLinkKey="";this.flash=false;this.width=300;this.height=250;this.origWidth=800;this.origHeight=600;this.sizeType="sizeless";this.autoResize=true;this.collaborators=new Array();this.collaboratorsOld=null;this.sharePerm=null;this.sharePermOld=null;this.pages=new Array();this.emailAlert=true;this.company=null;this.font=null;this.category=null;this.categoryClientid=null;this.publicURL=null;this.urlview="";this.favouriteColors=new Array();this.pinnedPowerups=new Array();this.isdeleted=false;this.deletedon=null;this.readonly=false;this.projectType=null;this.isUIDrawing=null;this.isPowerupOpen=false;this.spaceId="default";this.sort=0;this.options=null;this.powerupId=null;this.pinnedPageId=null;this.setCollaborators=function(arr){if(thisClass.flash){thisClass.collaboratorsOld=arr;}else{thisClass.collaborators=arr;}};this.getCollaborators=function(){if(thisClass.flash){return thisClass.collaboratorsOld;}else{return thisClass.collaborators;}};var canAdmin=false;this.__defineGetter__("canAdmin",function(){if(mf_main.PUBLIC){return false;}if(MF_UserSession.getUser()&&thisClass.company==MF_UserSession.getUser().company){return true;}if(thisClass.permissionType=="Admin"){return true;}return false;});this.__defineSetter__("canAdmin",function(val){canAdmin=val;});var creatorImage="";this.__defineGetter__("creatorImage",function(){if(thisClass.spaceId=="default"||thisClass.spaceId==null){if(MF_UserSession.getUser()&&MF_UserSession.getUser().company!=thisClass.company){var cr=thisClass.creator;if(cr=="support@mockflow.com"){cr="dummymf";}var str=MF_Utils.get_gravatar(cr,32);return str;}}return"";});this.__defineSetter__("creatorImage",function(val){creatorImage=val;});this.__defineSetter__("isShared",function(val){});this.__defineGetter__("isShared",function(){if(thisClass.permissionTypeStr=="Owner"){return false;}return true;});var createDateStr="";this.__defineGetter__("createDateStr",function(){if(thisClass.createDate!=null){try{thisClass.createDate=new Date(thisClass.createDate);var curr_date=thisClass.createDate.getDate();var curr_month=thisClass.createDate.getMonth()+1;var curr_year=thisClass.createDate.getFullYear();var hours=thisClass.createDate.getHours();var minutes=thisClass.createDate.getMinutes();return curr_date+" "+MF_Utils.getMonthByName(thisClass.createDate.getMonth())+" "+curr_year+" - "+hours+":"+minutes;}catch(e){return thisClass.createDate;}}else{return thisClass.createDate;}});this.__defineSetter__("createDateStr",function(val){createDateStr=val;});var updateDateStr="";this.__defineGetter__("updateDateStr",function(){if(thisClass.updateDate!=null){try{thisClass.updateDate=new Date(thisClass.updateDate);var curr_date=thisClass.updateDate.getDate();var curr_month=thisClass.updateDate.getMonth()+1;var curr_year=thisClass.updateDate.getFullYear();var hours=thisClass.updateDate.getHours();var minutes=thisClass.updateDate.getMinutes();return curr_date+" "+MF_Utils.getMonthByName(thisClass.updateDate.getMonth())+" "+curr_year+" - "+hours+":"+minutes;}catch(e){}}else{return thisClass.updateDate;}});this.__defineSetter__("updateDateStr",function(val){updateDateStr=val;});var shareStr="no";this.__defineGetter__("shareStr",function(){if(thisClass.share){return"yes";}else{return"no";}});this.__defineSetter__("shareStr",function(val){shareStr=val;});var owner=true;this.__defineGetter__("owner",function(){if(MF_UserSession.getUser()&&thisClass.company==MF_UserSession.getUser().company){return true;}return false;});this.__defineSetter__("owner",function(val){owner=val;});var permissionTypeStr="owner";this.__defineGetter__("permissionTypeStr",function(){if(thisClass.permissionType==null){return"Owner";}else{if(thisClass.permissionType=="Editor"){return"Designer";}return thisClass.permissionType;}});this.__defineSetter__("permissionTypeStr",function(val){permissionTypeStr=val;});var viewLink="";this.__defineGetter__("viewLink",function(){if(thisClass.projectType=="uidrawing"){var prepend="";if(mf_main.MOBILE){prepend="mobile/";}if(MF_Global.serverURL().includes("localhost")){return MF_Global.serverURL()+prepend+"view.jsp?id="+thisClass.publicURL;}else{return MF_Global.serverURL()+prepend+"view/"+thisClass.publicURL;}}if(thisClass.projectType=="pinpage"){var prepend="";if(mf_main.MOBILE){prepend="mobile/";}if(mf_main.designSpaceController&&mf_main.designSpaceController.selectedDesignSpace){var proj=null;for(var j=0;j<mf_main.designSpaceController.selectedDesignSpace.projects.length;j++){if(thisClass.category==mf_main.designSpaceController.selectedDesignSpace.projects[j].id){proj=mf_main.designSpaceController.selectedDesignSpace.projects[j];break;}}if(proj){if(MF_Global.serverURL().includes("localhost")){return MF_Global.serverURL()+prepend+"view.jsp?id="+proj.publicURL;}else{return MF_Global.serverURL()+prepend+"view/"+proj.publicURL;}}}}if(thisClass.projectType=="designfile"){if(MF_Global.serverURL().includes("localhost")){return MF_Global.serverURL()+"designspaceview.jsp?fileid="+thisClass.publicURL;}else{return MF_Global.serverURL()+"file/"+thisClass.publicURL;}}if(thisClass.projectType=="designembed"){if(MF_Global.serverURL().includes("localhost")){return MF_Global.serverURL()+"designspaceembed.jsp?embedid="+thisClass.publicURL;}else{return MF_Global.serverURL()+"embed/"+thisClass.publicURL;}}return"";});this.__defineSetter__("viewLink",function(val){viewLink=val;});var publishedStr="No";this.__defineGetter__("publishedStr",function(){if(thisClass.published==true){return"Yes";}else{return"No";}});this.__defineSetter__("publishedStr",function(val){publishedStr=val;});var bgColor="#ffffff";this.__defineGetter__("bgColor",function(){if(thisClass.projectType=="powerup"){return"#ffffff";}return"none";});this.__defineSetter__("bgColor",function(val){bgColor=val;});var thumbnailURL="";this.__defineGetter__("thumbnailURL",function(){if(thisClass.flash){if(thisClass.permitted){return MF_Global.mockupSharedImageURL(thisClass.company)+thisClass.id;}else{return MF_Global.mockupImageURL()+thisClass.id;}}if(thisClass.projectType=="uidrawing"||thisClass.projectType=="designembed"){if(thisClass.flash){if(thisClass.permitted){return MF_Global.mockupSharedImageURL(thisClass.company)+thisClass.id;}else{return MF_Global.mockupImageURL()+thisClass.id;}}else{if(thisClass.projectType=="designembed"){return"https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+thisClass.company+"/projects/"+thisClass.id+"/thumbnail/"+thisClass.id+"?"+(new Date().getTime());}else{return"https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+thisClass.company+"/projects/"+thisClass.id+"/thumbnail/"+thisClass.id;}}}else{if(thisClass.projectType=="pinpage"){var arr=thisClass.id.split("_");return"https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+thisClass.company+"/projects/"+thisClass.category+"/pages/"+arr[0]+"/image/thumb/"+arr[0]+".png";}else{if(thisClass.projectType=="designfile"){if(thisClass.category=="image"||thisClass.category=="video"){return"https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+thisClass.company+"/projects/"+thisClass.id+"/thumbnail/"+thisClass.id;}else{if(thisClass.category=="pdf"){if(mf_main.designSpaceController.themeController.displayTheme=="light"){return"images/dash/mfdashformat/mfpdfformatthumb.svg";}else{return"images/dash/mfdashformat/darktheme/mfpdfformatthumb.svg";}}else{if(thisClass.category=="audio"){if(mf_main.designSpaceController.themeController.displayTheme=="light"){return"images/dash/mfdashformat/mfaudioformatthumb.svg";}else{return"images/dash/mfdashformat/darktheme/mfaudioformatthumb.svg";}}else{if(mf_main.designSpaceController.themeController.displayTheme=="light"){return"images/dash/mfdashformat/mftypefile.svg";}else{return"images/dash/mfdashformat/darktheme/mftypefile.svg";}}}}}else{if(thisClass.projectType=="powerup"||thisClass.projectType=="powerupproject"){return"https://assets.mockflow.com/app/wireframepro/powerups/assets/"+thisClass.powerupId+"/thumbnail/"+thisClass.powerupId;}}}}});var projectIcon="";this.__defineGetter__("projectIcon",function(){if(thisClass.projectType=="uidrawing"){if(thisClass.drawingType=="designer"){return"images/dash/dashmenu/designer.png";}else{return"images/dash/dashmenu/wireframe.png";}}else{if(thisClass.projectType=="pinpage"){return"images/dash/dashmenu/wireframe.png";}else{if(thisClass.projectType=="designfile"){return"images/dash/importfiles/files.png";}else{if(thisClass.projectType=="designembed"){return"images/dash/importfiles/embeds.png";}else{if(thisClass.projectType=="powerup"||thisClass.projectType=="powerupproject"){return"images/dash/pinmodal/thumbs/"+thisClass.powerupId+".png";}}}}}});this.__defineGetter__("creatorStr",function(){if(MF_UserSession.getUser()&&thisClass.company==MF_UserSession.getUser().company){return"Me";}return thisClass.creator;});this.__defineSetter__("creatorStr",function(val){});this.__defineGetter__("createdByStr",function(){if(MF_UserSession.getUser()&&thisClass.company==MF_UserSession.getUser().company){return"Created By";}return"Shared By";});this.__defineSetter__("createdByStr",function(val){});var imageURL="";this.__defineGetter__("imageURL",function(){return"https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+thisClass.company+"/projects/"+thisClass.id+"/image/"+thisClass.id;});this.__defineSetter__("imageURL",function(val){imageURL=val;});var daysToDelete="";this.__defineGetter__("daysToDelete",function(){if(thisClass.isdeleted){var dateToday=new Date();var dateDeleted=new Date(thisClass.deletedon);var differenceDays=(dateDeleted.getTime()-dateToday.getTime())/(1000*3600*24);differenceDays=Math.round(differenceDays+30);if(differenceDays<2){return"1 day";}else{return differenceDays+" days";}}return"";});this.__defineSetter__("daysToDelete",function(val){daysToDelete=val;});var isUIDrawing=false;this.__defineGetter__("isUIDrawing",function(){if(thisClass.projectType=="uidrawing"){return true;}return false;});this.__defineSetter__("isUIDrawing",function(val){isUIDrawing=val;});var displayThumbnailPlaceholder=false;this.__defineGetter__("displayThumbnailPlaceholder",function(){if(mf_main.designSpaceController&&mf_main.designSpaceController.selectedDesignSpace&&mf_main.designSpaceController.selectedDesignSpace.id=="trash"){if(thisClass.projectType=="designfile"||thisClass.projectType=="powerup"||thisClass.projectType=="designembed"){return true;}}return false;});this.__defineSetter__("displayThumbnailPlaceholder",function(val){displayThumbnailPlaceholder=val;});var thumbnailPlaceholderURL="";this.__defineGetter__("thumbnailPlaceholderURL",function(){if(thisClass.projectType=="powerup"||thisClass.projectType=="powerupproject"){return"ico-gleam";}else{if(thisClass.projectType=="uidrawing"){return"ico-box2";}else{if(thisClass.projectType=="pinpage"){return"ico-bookmarkoutline";}else{if(thisClass.projectType=="designembed"){return"ico-diamond";}else{if(thisClass.projectType=="designfile"){if(thisClass.category=="image"){return"ico-image2";}else{if(thisClass.category=="pdf"){return"ico-adobe";}else{if(thisClass.category=="video"){return"ico-video";}else{if(thisClass.category=="audio"){return"ico-video";}else{return"ico-filetype";}}}}}}}}}return false;});this.__defineSetter__("thumbnailPlaceholderURL",function(val){thumbnailPlaceholderURL=val;});var ispowerup="";this.__defineGetter__("ispowerup",function(){if(thisClass.projectType=="powerup"||thisClass.projectType=="powerupproject"){return true;}return false;});this.__defineSetter__("ispowerup",function(val){ispowerup=val;});var ispinnedpowerup="";this.__defineGetter__("ispinnedpowerup",function(){if(thisClass.projectType=="powerup"){return true;}return false;});this.__defineSetter__("ispinnedpowerup",function(val){ispinnedpowerup=val;});var ispinpage="";this.__defineGetter__("ispinpage",function(){if(thisClass.projectType=="pinpage"){return true;}return false;});this.__defineSetter__("ispinpage",function(val){ispinpage=val;});var isdesignembed="";this.__defineGetter__("isdesignembed",function(){if(thisClass.projectType=="designembed"){return true;}return false;});this.__defineSetter__("isdesignembed",function(val){isdesignembed=val;});var isDesignFileVideo="";this.__defineGetter__("isDesignFileVideo",function(){if(thisClass.projectType=="designfile"&&thisClass.category=="video"){return true;}return false;});this.__defineSetter__("isDesignFileVideo",function(val){isDesignFileVideo=val;});var thumbnailListingURL="";this.__defineGetter__("thumbnailListingURL",function(){if(thisClass.projectType=="powerup"){return"ico-gleam";}else{if(thisClass.projectType=="uidrawing"){return"ico-box2";}else{if(thisClass.projectType=="designfile"){return"ico-cloud-upload";}else{if(thisClass.projectType=="designembed"){return"ico-diamond";}}}}return false;});this.__defineSetter__("thumbnailListingURL",function(val){thumbnailListingURL=val;});this.cast=function(obj){this.id=obj.id;this.title=obj.title;this.creator=obj.creator;if(obj.createDate&&typeof obj.createDate=="string"){this.createDate=new Date(obj.createDate);}else{this.createDate=obj.createDate;}if(obj.updateDate&&typeof obj.updateDate=="string"){this.updateDate=new Date(obj.updateDate);}else{this.updateDate=obj.updateDate;}this.publicURL=obj.publicURL;this.share=obj.share;this.urlview=obj.urlview;this.shareDisabled=obj.shareDisabled;this.isBasic=obj.isBasic;this.permitted=obj.permitted;this.sharedClient=obj.shareClient;this.permissionType=obj.permissionType;if(this.permissionType==null||this.permissionType==""){this.permissionType="Owner";}this.realtime=obj.realtime;this.revision=obj.revision;this.drawingType=obj.drawingType;this.checkPermission=obj.checkPermission;this.comments=obj.comments;this.members=obj.members;this.data=obj.data;this.font=obj.font;this.category=obj.category;this.published=obj.published;this.collaborators=obj.collaborators;this.collaboratorsOld=obj.collaboratorsOld;this.company=obj.company;this.sharePerm=obj.sharePerm;this.sharePermOld=obj.sharePermOld;this.flash=obj.flash;this.categoryClientid=obj.categoryClientid;this.enableExport=obj.enableExport;this.enableComments=obj.enableComments;this.enablePublicEncrypt=obj.enablePublicEncrypt;this.publicLinkKey=obj.publicLinkKey;this.pages=obj.pages;this.isdeleted=obj.isdeleted;this.deletedon=obj.deletedon;this.readonly=obj.readonly;this.projectType=obj.projectType;this.spaceId=obj.spaceId;this.sort=obj.sort;this.options=obj.options;this.powerupId=obj.powerupId;this.teamClientList=obj.teamClientList;this.pinnedPageId=obj.pinnedPageId;this.createNew=obj.createNew;};}function MF_ComponentItem(){var thisClass=this;this.n=null;this.l=null;this.db=false;this.clientid=null;this.pack=false;this.packid=null;this.sort=0;this.isMaster=false;this.masterClientid=null;this.filter="";this.noAllowDelete=false;this.__defineSetter__("getPackId",function(val){});this.__defineGetter__("getPackId",function(){if(thisClass.packid){return thisClass.packid;}return"";});this.__defineSetter__("getMasterClientid",function(val){});this.__defineGetter__("getMasterClientid",function(){if(thisClass.masterClientid){return thisClass.masterClientid;}return"";});this.__defineSetter__("thumbnail",function(val){});this.__defineGetter__("thumbnail",function(){if(thisClass.pack){if(thisClass.isMaster){return MF_Global.getS3CdnURL()+"app/wireframepro/company/"+thisClass.clientid+"/comppack/"+thisClass.packid+"/comp/"+thisClass.n+"/thumbnail/"+thisClass.n+".png";}else{return MF_Global.getS3CdnURL()+"app/wireframepro/company/"+thisClass.masterClientid+"/comppack/"+thisClass.packid+"/comp/"+thisClass.n+"/thumbnail/"+thisClass.n+".png";}}if(thisClass.db){return MF_Global.getS3CdnURL()+"app/wireframepro/dbcomponents/thumbnails/"+thisClass.n+".png";}return MF_Global.getS3CdnURL()+"app/wireframepro/components/thumbnails/"+thisClass.n+".png";});this.__defineSetter__("getFilterName",function(val){});this.__defineGetter__("getFilterName",function(){if(thisClass.filter==null||thisClass.filter==""){return"Category not assigned";}if(mf_main.componentList.currentComponentFilterList.hasOwnProperty(thisClass.filter)){return mf_main.componentList.currentComponentFilterList[thisClass.filter].name;}return"Category not assigned";});this.cast=function(obj){this.n=obj.n;this.l=obj.l;this.db=obj.db;this.clientid=obj.clientid;this.pack=obj.pack;this.packid=obj.packid;this.sort=obj.sort;this.isMaster=obj.isMaster;this.masterClientid=obj.masterClientid;this.filter=obj.filter;};}function MF_SharePermOld(){var thisClass=this;this.canDuplicateProject=false;this.canChat=true;this.canViewLog=true;this.canViewMembers=true;this.canUploadImage=true;this.canDeleteImage=true;this.canPreviewRevision=true;this.canDeleteRevision=true;this.canChangeSiteMap=true;this.canExportData=false;this.cast=function(obj){this.canDuplicateProject=obj.canDuplicateProject;this.canChat=obj.canChat;this.canViewLog=obj.canViewLog;this.canViewMembers=obj.canViewMembers;this.canUploadImage=obj.canUploadImage;this.canDeleteImage=obj.canDeleteImage;this.canPreviewRevision=obj.canPreviewRevision;this.canDeleteRevision=obj.canDeleteRevision;this.canChangeSiteMap=obj.canChangeSiteMap;this.canExportData=obj.canExportData;};}function MF_ChatMember(){var thisClass=this;this.id=null;this.userid=null;this.name=null;this.online=false;this.type=null;var profileImage="";this.__defineGetter__("profileImage",function(){var str=MF_Utils.get_gravatar(thisClass.userid,32);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});var memberType="";this.__defineGetter__("memberType",function(){if(thisClass.type=="Admin"){return"Admin";}if(thisClass.type=="Editor"){return"Editor";}if(thisClass.type=="Reviewer"){return"Reviewer";}return"Owner";});this.__defineSetter__("memberType",function(val){memberType=val;});this.cast=function(obj){thisClass.userid=obj.userid;thisClass.name=obj.name;thisClass.type=obj.type;};}function MF_MultiLinkObj(){var thisClass=this;this.id=null;this.item=null;this.page=null;this.pageLabel=null;this.count=0;this.isLinked=false;this.linkVal="";this.url=null;}function MF_MultiIconObj(){var thisClass=this;this.id=null;this.item=null;this.iconCls="";this.count=0;this.isIcon=false;}function MF_CollaboratorOld(){var thisClass=this;this.id=null;this.mockupid=null;this.userid=null;this.type=null;this.online=false;this.sharePerm=null;var profileImage="";this.__defineGetter__("profileImage",function(){var str=MF_Utils.get_gravatar(thisClass.userid,32);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});var memberType="";this.__defineGetter__("memberType",function(){if(thisClass.type=="Admin"){return"Admin";}if(thisClass.type=="Editor"){return"Editor";}if(thisClass.type=="Reviewer"){return"Reviewer";}return"Owner";});this.__defineSetter__("memberType",function(val){memberType=val;});this.cast=function(obj){this.id=obj.id;this.mockupid=obj.mockupid;this.userid=obj.userid;this.type=obj.type;this.online=obj.online;this.sharePerm=obj.sharePerm;};}function MF_ProjectInfoData(){var thisClass=this;this.collaborators=null;this.log=null;}function MF_PageExport(){var thisClass=this;this.id=null;this.name=null;this.imagedata=null;this.path=null;this.px=0;this.py=0;this.pw=500;this.ph=500;}function MF_LinkObj(){var thisClass=this;this.event=null;this.type=null;this.url=null;this.pageName=null;}function MF_Feedback(){var thisClass=this;this.id=null;this.projectid=null;this.pageid=null;this.message=null;this.creator=null;this.createDate=null;this.creatorName=null;this.pos=null;this.comment=null;this.message=null;this.reply=null;this.attached=null;var isReply=false;this.__defineGetter__("isReply",function(){if(thisClass.reply!=null){return true;}else{return false;}});this.__defineSetter__("isReply",function(val){isReply=val;});var messageStr="";this.__defineGetter__("messageStr",function(){var str=thisClass.message.replace(/(\r\n|\n|\r)/gm,"<br/>");try{str=linkifyHtml(str,{className:""});}catch(err){str=MF_Utils.htmlEncode(str);}return str;});this.__defineSetter__("messageStr",function(val){messageStr=val;});var createDateStr="";this.__defineGetter__("createDateStr",function(){if(thisClass.createDate!=null){var curr_date=thisClass.createDate.getDate();var curr_month=thisClass.createDate.getMonth()+1;var curr_year=thisClass.createDate.getFullYear();var hours=thisClass.createDate.getHours();var minutes=thisClass.createDate.getMinutes();return curr_date+" "+MF_Utils.getMonthByName(thisClass.createDate.getMonth())+" "+curr_year;}else{return thisClass.createDate;}});this.__defineSetter__("createDateStr",function(val){createDateStr=val;});var createDatePast="";this.__defineGetter__("createDatePast",function(){if(thisClass.createDate!=null){var seconds=Math.floor((new Date()-thisClass.createDate)/1000);var interval=Math.floor(seconds/31536000);if(interval>1){return interval+" years ago";}else{if(interval==1){return interval+" year ago";}}interval=Math.floor(seconds/2592000);if(interval>1){return interval+" months ago";}else{if(interval==1){return interval+" month ago";}}interval=Math.floor(seconds/86400);if(interval>1){return interval+" days ago";}else{if(interval==1){return interval+" day ago";}}interval=Math.floor(seconds/3600);if(interval>1){return interval+" hours ago";}else{if(interval==1){return interval+" hour ago";}}interval=Math.floor(seconds/60);if(interval>1){return interval+" minutes ago";}else{if(interval==1){return interval+" minute ago";}}return"few seconds ago";}else{return thisClass.createDate;}});this.__defineSetter__("createDatePast",function(val){createDatePast=val;});var creatorNameStr="";this.__defineGetter__("creatorNameStr",function(){if(MF_UserSession.getUser()!=null&&MF_UserSession.getUser()!=""){if(thisClass.creator.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()){return"Me";}else{return thisClass.creatorName;}}else{return thisClass.creatorName;}});this.__defineSetter__("creatorNameStr",function(val){creatorNameStr=val;});var annotate="";this.__defineGetter__("annotate",function(){if(thisClass.pos!=null){var arr=thisClass.pos.split(",");if(arr.length==2){return true;}return false;}else{return false;}});this.__defineSetter__("annotate",function(val){annotate=val;});var isAttached=false;this.__defineGetter__("isAttached",function(){if(thisClass.attached==null||thisClass.attached==""){return false;}else{return true;}});this.__defineSetter__("isAttached",function(val){isAttached=val;});var image=false;this.__defineGetter__("image",function(){if(thisClass.attached=="png"||thisClass.attached=="gif"||thisClass.attached=="jpg"||thisClass.attached=="jpeg"){return true;}else{return false;}});this.__defineSetter__("image",function(val){image=val;});var thumbnailURL="";this.__defineGetter__("thumbnailURL",function(){return MF_Global.getS3CdnURL()+"app/wireframepro/company/"+mf_main.editorController.projectObj.company+"/projects/"+mf_main.editorController.projectObj.id+"/pages/"+thisClass.pageid+"/feedback/thumbnail/"+thisClass.id+"."+thisClass.attached;});this.__defineSetter__("thumbnailURL",function(val){thumbnailURL=val;});var attachURL="";this.__defineGetter__("attachURL",function(){return MF_Global.getS3CdnURL()+"app/wireframepro/company/"+mf_main.editorController.projectObj.company+"/projects/"+mf_main.editorController.projectObj.id+"/pages/"+thisClass.pageid+"/feedback/"+thisClass.id+"."+thisClass.attached;});this.__defineSetter__("attachURL",function(val){attachURL=val;});var profileImage="";this.__defineGetter__("profileImage",function(){var cr=thisClass.creator;if(cr=="support@mockflow.com"){cr="dummymf";}var str=MF_Utils.get_gravatar(cr,48);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});var canEdit=false;this.__defineGetter__("canEdit",function(){if(MF_UserSession.getUser()!=null&&MF_UserSession.getUser()!=""){if(thisClass.creator.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()){return true;}else{return false;}}else{return false;}});this.__defineSetter__("canEdit",function(val){canEdit=val;});var canDelete=false;this.__defineGetter__("canDelete",function(){if(MF_UserSession.getUser()!=null&&MF_UserSession.getUser()!=""){if(!mf_main.PUBLIC&&(thisClass.creator.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()||mf_main.PERMISSION=="Owner")){return true;}else{return false;}}else{return false;}});this.__defineSetter__("canDelete",function(val){canDelete=val;});this.cast=function(obj){this.id=obj.id;this.projectid=obj.projectid;this.pageid=obj.pageid;this.message=obj.message;this.creator=obj.creator;this.createDate=obj.createDate;this.creatorName=obj.creatorName;this.pos=obj.pos;this.comment=obj.comment;this.message=obj.message;this.reply=obj.reply;this.attached=obj.attached;};}function MF_PageData(){var thisClass=this;this.eid=null;this.projectid=null;this.clientid=null;this.compressedData=null;this.data=null;this.createDate=null;this.updateDate=null;this.stamp=null;this.comments=0;this.name=null;this.sortorder=-1;this.snapped=false;this.compressed=false;this.deletedBy=null;this.deleteDate=null;var deleteDateStr="";this.__defineGetter__("deleteDateStr",function(){if(thisClass.deleteDate!=null){var curr_date=thisClass.deleteDate.getDate();var curr_month=thisClass.deleteDate.getMonth()+1;var curr_year=thisClass.deleteDate.getFullYear();var hours=thisClass.deleteDate.getHours();var minutes=thisClass.deleteDate.getMinutes();return curr_date+" "+MF_Utils.getMonthByName(thisClass.deleteDate.getMonth())+" "+curr_year+" "+hours+":"+minutes;}else{return thisClass.deleteDate;}});this.__defineSetter__("deleteDateStr",function(val){deleteDateStr=val;});this.cast=function(obj){this.eid=obj.eid;this.projectid=obj.projectid;this.clientid=obj.clientid;this.compressedData=obj.compressedData;this.data=obj.data;this.createDate=obj.createDate;this.updateDate=obj.updateDate;this.stamp=obj.stamp;this.comments=obj.comments;this.sortorder=obj.sortorder;this.name=obj.name;this.snapped=obj.snapped;this.compressed=obj.compressed;this.deletedBy=obj.deletedBy;this.deleteDate=obj.deleteDate;};}function MF_DBComponent(){var thisClass=this;this.id=null;this.name=null;this.creator=null;this.createDate=null;this.data=null;this.imagePresent=false;this.images=null;this.customFonts=null;this.cname=null;this.theme=false;this.sortorder=0;this.cast=function(obj){this.id=obj.id;this.name=obj.name;this.creator=obj.creator;this.createDate=obj.createDate;this.data=obj.data;this.imagePresent=obj.imagePresent;this.images=obj.images;this.customFonts=obj.customFonts;this.theme=obj.theme;this.cname=obj.cname;this.sortorder=obj.sortorder;};}function MF_StoreTemplate(){var thisClass=this;this.id=null;this.name=null;this.createDate=null;this.data=null;this.type=null;this.submitter=null;this.submitterName=null;this.downloads=0;this.approved=false;this.packId=null;this.imagePresent=false;this.images=null;this.clientId=null;this.itemType=null;this.description=null;this.featured=false;this.includeCommon=false;this.customFonts=null;this.premium=false;this.modeType=null;var thumbnailURL="";this.__defineGetter__("thumbnailURL",function(){if(thisClass.itemType=="uipack"){if(MF_Global.getS3Bucket()=="assets.mockflow.com"){return"https://d1tzxux72fvryy.cloudfront.net/"+thisClass.id+"/preview/thumb/"+thisClass.id+".png";}else{return"https://"+MF_Global.getS3Bucket()+"/app/wireframepro/store/"+thisClass.id+"/preview/thumb/"+thisClass.id+".png";}}else{if(MF_Global.getS3Bucket()=="assets.mockflow.com"){return"https://d1tzxux72fvryy.cloudfront.net/"+thisClass.id+"/preview/thumb/"+thisClass.id+".png";}else{return"https://"+MF_Global.getS3Bucket()+"/app/wireframepro/store/"+thisClass.id+"/preview/thumb/"+thisClass.id+".png";}}});this.__defineSetter__("thumbnailURL",function(val){thumbnailURL=val;});var imageURL="";this.__defineGetter__("imageURL",function(){if(MF_Global.getS3Bucket()=="assets.mockflow.com"){return"https://d1tzxux72fvryy.cloudfront.net/"+thisClass.id+"/preview/"+thisClass.id+".png";}else{return"https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/store/"+thisClass.id+"/preview/"+thisClass.id+".png";}});this.__defineSetter__("imageURL",function(val){imageURL=val;});var featuredURL="";this.__defineGetter__("featuredURL",function(){if(thisClass.featured){if(MF_Global.getS3Bucket()=="assets.mockflow.com"){return"https://d1tzxux72fvryy.cloudfront.net/"+thisClass.id+"/featured/"+thisClass.id+".png?"+new Date().getTime();}else{return"https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/store/"+thisClass.id+"/featured/"+thisClass.id+".png?"+new Date().getTime();}}});this.__defineSetter__("featuredURL",function(val){featuredURL=val;});this.cast=function(obj){this.id=obj.id;this.name=obj.name;this.createDate=obj.createDate;this.data=obj.data;this.type=obj.type;this.submitter=obj.submitter;this.submitterName=obj.submitterName;this.downloads=obj.downloads;this.approved=obj.approved;this.packId=obj.packId;this.clientId=obj.clientId;this.itemType=obj.itemType;this.description=obj.description;this.featured=obj.featured;this.includeCommon=obj.includeCommon;this.customFonts=obj.customFonts;this.premium=obj.premium;this.modeType=obj.modeType;};}function MF_CompTemplate(){var thisClass=this;this.eid=null;this.projectid=null;this.clientid=null;this.compressedData=null;this.data=null;this.createDate=null;this.updateDate=null;this.name=null;this.cast=function(obj){this.eid=obj.eid;this.projectid=obj.projectid;this.clientid=obj.clientid;this.compressedData=obj.compressedData;this.data=obj.data;this.createDate=obj.createDate;this.updateDate=obj.updateDate;this.stamp=obj.stamp;this.name=obj.name;};}function MF_CompCategory(){var thisClass=this;this.id=null;this.name=null;this.tags=null;this.builtin=true;this.clientid=null;this.importcategory=null;this.custompack=false;this.modify=true;this.createDate=null;this.componentItemList=null;this.isMaster=false;this.isShared=false;this.masterClientid=null;this.mockstore=false;this.includeCommon=false;this.isMergeablePack=false;this.mergeablePackData=null;this.isProjectPack=false;this.filterList=[];this.modeType=null;this.builtInID=null;this.packId=null;this.__defineSetter__("nameLabel",function(val){});this.__defineGetter__("nameLabel",function(){if(thisClass.id=="featured"){return"Select Pack";}return thisClass.name;});this.__defineSetter__("isMockStore",function(val){});this.__defineGetter__("isMockStore",function(){if(thisClass.mockstore==true){return"yes";}else{return"no";}});this.__defineSetter__("showMoreIcon",function(val){});this.__defineGetter__("showMoreIcon",function(){if(thisClass.isMaster){return true;}if(thisClass.isShared){return false;}return true;});this.__defineSetter__("icon",function(val){});this.__defineGetter__("icon",function(){if(thisClass.custompack&&thisClass.isShared){return MF_Global.getS3CdnURL()+"app/wireframepro/uipack/"+this.id+"/preview/thumb/"+this.id+".png";}if(thisClass.custompack){if(thisClass.isMergeablePack){return"images/editor/category/mergeablePackIcon.png";}else{return"images/editor/category/custom.png";}}if(thisClass.mockstore){return MF_Global.getS3CdnURL()+"app/wireframepro/uipack/"+this.packId+"/preview/thumb/"+this.packId+".png";}return"images/editor/category/"+thisClass.id+".png";});this.cast=function(obj){this.id=obj.id;this.name=obj.name;this.tags=obj.tags;this.builtin=obj.builtin;this.projectid=obj.projectid;this.clientid=obj.clientid;this.importcategory=obj.importcategory;this.createDate=obj.createDate;this.componentItemList=obj.componentItemList;this.custompack=obj.custompack;this.modify=obj.modify;this.isMaster=obj.isMaster;this.isShared=obj.isShared;this.masterClientid=obj.masterClientid;this.includeCommon=obj.includeCommon;this.isMergeablePack=obj.isMergeablePack;this.mergeablePackData=obj.mergeablePackData;this.isProjectPack=obj.isProjectPack;this.filterList=obj.filterList;this.modeType=obj.modeType;};}function MF_MergeablePackData(){var thisClass=this;this.id=null;this.mfClientId=null;this.customPack=null;this.__defineSetter__("icon",function(val){});this.__defineGetter__("icon",function(){if(this.customPack){return MF_Global.getS3CdnURL()+"app/wireframepro/uipack/"+this.id+"/preview/thumb/"+this.id+".png";}else{return"images/editor/category/"+thisClass.id+".png";}});}function MF_LicenseData(){var thisClass=this;this.licenses=null;this.userLicenses=null;}function MF_Revision(){var thisClass=this;this.id=null;this.projectid=null;this.pageid=null;this.creator=null;this.createDate=null;this.data=null;this.note=null;this.auto=null;this.recovery=null;this.company=null;var isAuto=false;this.__defineGetter__("isAuto",function(){if(thisClass.auto!=null){return true;}else{return false;}});this.__defineSetter__("isAuto",function(val){isAuto=val;});var profileImage="";this.__defineGetter__("profileImage",function(){var cr=thisClass.creator;if(cr=="support@mockflow.com"){cr="dummymf";}var str=MF_Utils.get_gravatar(cr,48);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});var createDateStr="";this.__defineGetter__("createDateStr",function(){if(thisClass.createDate!=null){var curr_date=thisClass.createDate.getDate();var curr_month=thisClass.createDate.getMonth()+1;var curr_year=thisClass.createDate.getFullYear();var hours=thisClass.createDate.getHours();var minutes=(thisClass.createDate.getMinutes()<10?"0":"")+thisClass.createDate.getMinutes();return curr_date+" "+MF_Utils.getMonthByName(thisClass.createDate.getMonth())+" "+curr_year+" "+hours+":"+minutes;}else{return thisClass.createDate;}});this.__defineSetter__("createDateStr",function(val){createDateStr=val;});var creatorNameStr="";this.__defineGetter__("creatorNameStr",function(){if(MF_UserSession.getUser()!=null&&MF_UserSession.getUser()!=""){if(thisClass.creator.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()){return"Me";}else{return thisClass.creator;}}else{return thisClass.creator;}});this.__defineSetter__("creatorNameStr",function(val){creatorNameStr=val;});this.cast=function(obj){this.id=obj.id;this.projectid=obj.projectid;this.pageid=obj.pageid;this.creator=obj.creator;this.createDate=obj.createDate;this.data=obj.data;this.note=obj.note;this.auto=obj.auto;this.recovery=obj.recovery;this.company=obj.company;};}function MF_Component(){var thisClass=this;this.name=null;this.category=null;this.label=null;this.cast=function(obj){this.name=obj.name;this.category=obj.category;this.label=obj.label;};}function MF_StoreCategory(){var thisClass=this;this.id="";this.name="";this.icon="";this.cast=function(obj){this.id=obj.id;this.name=obj.name;this.color=obj.color;};}function MF_Font(){var thisClass=this;this.type=null;this.id=null;this.name=null;this.isGoogleFont=false;this.isCustomFont=false;this.projectid=null;this.clientid=null;this.customFontId=null;this.cast=function(obj){this.type=obj.type;this.id=obj.id;this.name=obj.name;this.isGoogleFont=obj.isGoogleFont;if(obj.isCustomFont){this.isCustomFont=obj.isCustomFont;this.projectid=obj.projectid;this.clientid=obj.clientid;this.customFontId=obj.customFontId;}};}function MF_SharePerm(){var thisClass=this;this.canDuplicateProject=false;this.canChat=true;this.canViewLog=true;this.canViewMembers=true;this.canUploadImage=true;this.canDeleteImage=true;this.canPreviewRevision=true;this.canDeleteRevision=true;this.canChangeSiteMap=true;this.canExportData=false;this.cast=function(obj){this.canDuplicateProject=obj.canDuplicateProject;this.canChat=obj.canChat;this.canViewLog=obj.canViewLog;this.canViewMembers=obj.canViewMembers;this.canUploadImage=obj.canUploadImage;this.canDeleteImage=obj.canDeleteImage;this.canPreviewRevision=obj.canPreviewRevision;this.canDeleteRevision=obj.canDeleteRevision;this.canChangeSiteMap=obj.canChangeSiteMap;this.canExportData=obj.canExportData;};}function MF_License(){var thisClass=this;this.id=null;this.clientid=null;this.users=0;this.edition=null;this.cost=0;this.txnID=null;this.status=null;this.period=null;this.monthly=false;this.createDate=null;var periodLbl="";var periodStr="";this.monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];this.__defineGetter__("periodStr",function(){if(thisClass.period!=null){var curr_date=thisClass.period.getDate();var curr_month=thisClass.period.getMonth()+1;var curr_year=thisClass.period.getFullYear();var da="<span class='mfLicenseDate'>"+curr_date+"</span><span class='mfLicenseYear'>"+MF_Utils.getMonthByName(thisClass.period.getMonth())+" "+curr_year+"</span>";if(thisClass.status=="active"||thisClass.status=="invoiced"||thisClass.status=="failed"){return da;}if(thisClass.status=="expired"||thisClass.status=="Expired"){return da;}if(thisClass.status=="cancelled"){return da;}return da;}else{return thisClass.period;}});this.__defineSetter__("periodStr",function(val){periodStr=val;});this.__defineGetter__("periodLbl",function(){if(thisClass.period!=null){if(thisClass.status=="active"||thisClass.status=="invoiced"||thisClass.status=="failed"){return"Renews On";}if(thisClass.status=="expired"||thisClass.status=="Expired"){return"Expired On";}if(thisClass.status=="cancelled"){return"Expires On";}return"";}else{return thisClass.period;}});this.__defineSetter__("periodLbl",function(val){periodLbl=val;});this.__defineGetter__("userCountLabel",function(){if(thisClass.users>=1000){return"-";}else{return thisClass.users;}});this.__defineSetter__("userCountLabel",function(val){});var createDateFormat="";this.__defineGetter__("createDateFormat",function(){if(thisClass.createDate!=null){var curr_date=thisClass.createDate.getDate();var curr_month=thisClass.createDate.getMonth();var curr_year=thisClass.createDate.getFullYear();return curr_date+" "+thisClass.monthNames[curr_month]+" "+curr_year;}else{return thisClass.createDate;}});this.__defineSetter__("createDateFormat",function(val){createDateFormat=val;});var periodFormat="";this.__defineGetter__("periodFormat",function(){if(thisClass.period!=null){var curr_date=thisClass.period.getDate();var curr_month=thisClass.period.getMonth()+1;var curr_year=thisClass.period.getFullYear();return curr_year+"-"+curr_month+"-"+curr_date;}else{return thisClass.period;}});this.__defineSetter__("periodFormat",function(val){periodFormat=val;});var statusMsg="Active";this.__defineGetter__("statusMsg",function(){if(thisClass.status=="active"){return"Active";}if(thisClass.status=="cancelled"){return"Cancelled";}if(thisClass.status=="expired"||thisClass.status=="Expired"){return"Expired";}if(thisClass.status=="failed"){return"Failed";}if(thisClass.status=="invoiced"){return"Invoiced";}return thisClass.status;});this.__defineSetter__("statusMsg",function(val){statusMsg=val;});var statusIcon="mficon-check";this.__defineGetter__("statusIcon",function(){if(thisClass.status=="active"){return"active";}if(thisClass.status=="cancelled"){return"cancelled";}if(thisClass.status=="expired"||thisClass.status=="Expired"){return"expired";}if(thisClass.status=="failed"){return"failed";}if(thisClass.status=="invoiced"){return"invoiced";}if(thisClass.status=="paused"){return"paused";}return thisClass.status;});this.__defineSetter__("statusIcon",function(val){statusIcon=val;});var renewLabel="";this.__defineGetter__("renewLabel",function(){if(thisClass.status=="active"){return"Renews On";}if(thisClass.status=="cancelled"){return"Expires On";}if(thisClass.status=="expired"){return"Ended On";}if(thisClass.status=="failed"){return"Renews On";}if(thisClass.status=="invoiced"){return"Renews On";}return"Renews On";});this.__defineSetter__("renewLabel",function(val){renewLabel=val;});var statusClass="active";this.__defineGetter__("statusClass",function(){if(thisClass.status=="cancelled"){return"cancelled";}if(thisClass.status=="failed"){return"cancelled";}return"active";});this.__defineSetter__("statusClass",function(val){statusClass=val;});var billingCycle="";this.__defineGetter__("billingCycle",function(){if(thisClass.txnID.includes("--yearly--")){return"yearly";}if(thisClass.txnID.includes("--halfyearly--")){return"halfyearly";}if(thisClass.txnID.includes("--3months--")){return"3months";}if(thisClass.txnID.includes("--monthly--")){return"monthly";}return"";});this.__defineSetter__("billingCycle",function(val){billingCycle=val;});var costFormat="";this.__defineGetter__("costFormat",function(){if(thisClass.isPaddle){var arr=thisClass.txnID.split("--__--");if(arr[8]=="USD"){return"$"+thisClass.cost+" "+arr[8];}if(arr[8]=="EUR"){return"\u20AC"+thisClass.cost+" "+arr[8];}if(arr[8]=="GBP"){return"\u00A3"+thisClass.cost+" "+arr[8];}if(arr[8]=="AUD"){return"A$"+thisClass.cost+" "+arr[8];}if(arr[8]=="JPY"){return"\u00A5"+thisClass.cost+" "+arr[8];}if(arr[8]=="RUB"){return"\u20BD"+thisClass.cost+" "+arr[8];}if(arr[8]=="INR"){return"\u20B9"+thisClass.cost+" "+arr[8];}return thisClass.cost+" "+arr[8];}return thisClass.cost+" USD";});this.__defineSetter__("costFormat",function(val){costFormat=val;});var licenseTypeLabel="";this.__defineGetter__("licenseTypeLabel",function(){if(thisClass.txnID.includes("--premium--__--monthly")){return"Wireframing";}if(thisClass.txnID.includes("--teampremium--__--monthly")){return"Product Design";}if(thisClass.txnID.includes("--wireframing--")){return"Wireframing";}if(thisClass.txnID.includes("--premium--__--yearly")){return"Wireframing";}if(thisClass.txnID.includes("--teampremium--__--yearly")){return"Product Design";}if(thisClass.txnID.includes("--productdesign--")){return"Product Design";}if(thisClass.txnID.includes("--MFENTERPRISE--yearly")){return"Enterprise";}return"";});this.__defineSetter__("licenseTypeLabel",function(val){licenseTypeLabel=val;});var isProductDesign=true;this.__defineGetter__("isProductDesign",function(){if(thisClass.edition=="productdesign"){return true;}else{return false;}});this.__defineSetter__("isProductDesign",function(val){isProductDesign=val;});var showCancelBtn=true;this.__defineGetter__("showCancelBtn",function(){if(thisClass.isFastSpring){if(thisClass.status=="active"||thisClass.status=="failed"){return true;}else{return false;}}else{return true;}});this.__defineSetter__("showCancelBtn",function(val){showCancelBtn=val;});var isPayPal=false;this.__defineGetter__("isPayPal",function(){if(thisClass.txnID.substring(0,2)=="S-"||thisClass.txnID.substring(0,2)=="s-"){return true;}return false;});this.__defineSetter__("isPayPal",function(val){isPayPal=val;});var isInvoice=false;this.__defineGetter__("isInvoice",function(){if(thisClass.txnID.substring(0,4)=="INV-"||thisClass.txnID.substring(0,4)=="inv-"||thisClass.txnID.substring(0,4)=="Inv-"){return true;}return false;});this.__defineSetter__("isInvoice",function(val){isInvoice=val;});var isFastSpring=false;this.__defineGetter__("isFastSpring",function(){var arr=thisClass.txnID.split("--__--");if(arr.length==7){return true;}return false;});this.__defineSetter__("isFastSpring",function(val){isFastSpring=val;});var duration="monthly";this.__defineGetter__("duration",function(){var arr=thisClass.txnID.split("--__--");return arr[3];});this.__defineSetter__("duration",function(val){duration=val;});var subID="";this.__defineGetter__("subID",function(){var arr=thisClass.subID.split("--__--");return arr[5];});this.__defineSetter__("subID",function(val){subID=val;});var isPaddle=false;this.__defineGetter__("isPaddle",function(){var arr=thisClass.txnID.split("--__--");if(arr.length>7){return true;}return false;});this.__defineSetter__("isPaddle",function(val){isPaddle=val;});var isMonthly=false;this.__defineGetter__("isMonthly",function(){var arr=thisClass.txnID.split("--__--");if(arr.length>=6){var str=arr[3];if(str=="monthly"){return true;}else{return false;}}return false;});this.__defineSetter__("isMonthly",function(val){isMonthly=val;});var subID="";this.__defineGetter__("subID",function(){var arr=thisClass.txnID.split("--__--");if(thisClass.isFastSpring){if(arr.length==6){return arr[4];}if(arr.length==7){return arr[5];}}else{if(thisClass.isPaddle){return arr[5];}else{return thisClass.txnID;}}return thisClass.txnID;});this.__defineSetter__("subID",function(val){subID=val;});this.cast=function(obj){this.id=obj.id;this.clientid=obj.clientid;this.users=obj.users;this.edition=obj.edition;this.cost=obj.cost;this.txnID=obj.txnID;this.status=obj.status;this.period=obj.period;this.createDate=obj.createDate;};}function MF_SubscriptionOrder(){var thisClass=this;this.orderid=null;this.checkoutid=null;this.amount=null;this.currency=null;this.status=null;this.createdate=null;this.is_Subscription=null;this.is_one_off=null;this.invoiceURL=null;var amountPaid="";this.__defineGetter__("amountPaid",function(){return thisClass.amount+" "+thisClass.currency;});this.__defineSetter__("amountPaid",function(val){amountPaid=val;});this.cast=function(obj){this.orderid=obj.orderid;this.checkoutid=obj.checkoutid;this.amount=obj.amount;this.currency=obj.currency;this.status=obj.status;this.createdate=obj.createdate;this.is_Subscription=obj.is_Subscription;this.is_one_off=obj.is_one_off;this.invoiceURL=obj.invoiceURL;};}function MF_LicenseUser(){var thisClass=this;this.clientid=null;this.id=null;this.email=null;this.createDate=null;this.canDowngrade=false;this.canChangeRole=false;this.role="member";this.status="accepted";this.__defineGetter__("canDowngrade",function(){if(thisClass.email.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()||(mf_main.accountController.currentUserRole!="owner"&&(thisClass.role=="owner"||thisClass.role=="admin"))){return false;}return true;});this.__defineSetter__("canDowngrade",function(val){thisClass.canDowngrade=val;});this.__defineGetter__("canChangeRole",function(){if(thisClass.email.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()||mf_main.accountController.currentUserRole!="owner"){return false;}return true;});this.__defineSetter__("canChangeRole",function(val){thisClass.canChangeRole=val;});this.__defineGetter__("isPending",function(){if(thisClass.status=="pending"){return true;}return false;});this.__defineSetter__("isPending",function(val){});var profileImage="";this.__defineGetter__("profileImage",function(){var cr=thisClass.email;if(cr=="support@mockflow.com"){cr="dummymf";}var str=MF_Utils.get_gravatar(cr,40);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});this.cast=function(obj){this.id=obj.id;this.clientid=obj.clientid;this.email=obj.email;this.createDate=obj.createDate;this.role=obj.role;this.status=obj.status;};}function MF_LogShared(){var thisClass=this;this.id=null;this.projectName=null;this.projectid=null;this.creator=null;this.createDate=null;this.creatorName=null;this.logtype=null;this.opened=false;this.spaceName=null;this.spaceid=null;this.logdata=null;this.receiver=null;var logMessage="";this.__defineGetter__("logMessage",function(){var str=" ";var d=thisClass.createDate;if(d==null){d=new Date();}var curr_date=d.getDate();var curr_month=d.getMonth()+1;var curr_year=d.getFullYear();var curr_hours=d.getHours();var curr_minutes=(d.getMinutes()<10?"0":"")+d.getMinutes();var sprojectName=null;if(thisClass.projectName){sprojectName=Handlebars.Utils.escapeExpression(thisClass.projectName);}str=str+"<span class='mfNfUserName mfThemeColorTxt'>"+Handlebars.Utils.escapeExpression(thisClass.creatorName)+"</span>";var logMessage=mf_main.logController.getLogMessage(thisClass.logtype,thisClass.logDataObj,sprojectName);str=str+logMessage;str=str+"<span class='mfNotificationDate'>"+Handlebars.Utils.escapeExpression(curr_date)+" "+Handlebars.Utils.escapeExpression(MF_Utils.getMonthByName(d.getMonth()))+" "+Handlebars.Utils.escapeExpression(curr_year)+" <span class='mfNotificationTime'> "+Handlebars.Utils.escapeExpression(curr_hours)+":"+Handlebars.Utils.escapeExpression(curr_minutes)+"</span></span>";return str;});this.__defineSetter__("logMessage",function(val){logMessage=val;});var profileImage="";this.__defineGetter__("profileImage",function(){var cr=thisClass.creator;if(cr=="support@mockflow.com"){cr="dummymf";}var str=MF_Utils.get_gravatar(cr,30);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});var logDataObj="";this.__defineGetter__("logDataObj",function(){if(thisClass.logdata!=null&&thisClass.logdata!=""&&typeof(thisClass.logdata)=="string"){return JSON.parse(thisClass.logdata);}return{};});this.__defineSetter__("logDataObj",function(val){logDataObj=val;});this.cast=function(obj){this.id=obj.id;this.projectName=obj.projectName;this.projectid=obj.projectid;this.creator=obj.creator;this.createDate=obj.createDate;this.creatorName=obj.creatorName;this.logtype=obj.logtype;this.opened=obj.opened;this.receiver=obj.receiver;this.spaceName=obj.spaceName;this.spaceid=obj.spaceid;this.logdata=obj.logdata;};}function MF_UserLog(logtype){var thisClass=this;logtype;}function MF_UserLog(){var thisClass=this;this.id=null;this.email=null;this.ip=null;this.createDate=null;this.logtype=null;this.log=null;this.projectid=null;this.internal=false;var profileImage="";this.__defineGetter__("profileImage",function(){var cr=thisClass.email;if(cr=="support@mockflow.com"){cr="dummymf";}var str=MF_Utils.get_gravatar(cr,30);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});this.cast=function(obj){this.id=obj.id;this.email=obj.email;this.ip=obj.ip;this.createDate=obj.createDate;this.logtype=obj.logtype;this.log=obj.log;this.projectid=obj.projectid;this.internal=obj.internal;};}function MF_Image(){var thisClass=this;this.id=null;this.name=null;this.type=null;this.creator=null;this.createDate=null;this.width=0;this.height=0;this.projectid=null;this.clientid=null;var thumbnailURL="";this.__defineGetter__("thumbnailURL",function(){if(thisClass.id.indexOf(".svg")!=-1){return MF_Global.getS3CdnURL()+"app/wireframepro/company/"+thisClass.clientid+"/projects/"+thisClass.projectid+"/images/"+thisClass.id;}else{return MF_Global.getS3CdnURL()+"app/wireframepro/company/"+thisClass.clientid+"/projects/"+thisClass.projectid+"/images/thumbnails/"+thisClass.id;}});this.__defineSetter__("thumbnailURL",function(val){thumbnailURL=val;});var validID="";this.__defineGetter__("validID",function(){return thisClass.id.replaceAll(".","_");});this.__defineSetter__("validID",function(val){validID=val;});var isSVG=false;this.__defineGetter__("isSVG",function(){if(thisClass.id.indexOf(".svg")!=-1){return true;}else{return false;}});this.__defineSetter__("isSVG",function(val){isSVG=val;});this.__defineGetter__("nid",function(){if(thisClass.id.indexOf(".svg")!=-1){var pid=thisClass.id.replace(/.svg/g,"");return pid;}else{return thisClass.id;}});this.__defineSetter__("nid",function(val){});var imageURL="";this.__defineGetter__("imageURL",function(){return MF_Global.getS3CdnURL()+"app/wireframepro/company/"+thisClass.clientid+"/projects/"+thisClass.projectid+"/images/"+thisClass.id;});this.__defineSetter__("imageURL",function(val){imageURL=val;});this.cast=function(obj){this.id=obj.id;this.name=obj.name;this.type=obj.type;this.creator=obj.creator;this.createDate=obj.createDate;this.width=obj.width;this.height=obj.height;this.projectid=obj.projectid;this.clientid=obj.clientid;};}function MF_Artwork(){var thisClass=this;this.id=null;this.n=null;this.l=null;this.c=null;this.setid=null;var thumbnailURL="";this.__defineGetter__("thumbnailURL",function(){if(thisClass.id.indexOf(".svg")!=-1){return MF_Global.getS3CdnURL()+"app/wireframepro/company/"+thisClass.clientid+"/projects/"+thisClass.projectid+"/images/"+thisClass.id;}else{return MF_Global.getS3CdnURL()+"app/wireframepro/company/"+thisClass.clientid+"/projects/"+thisClass.projectid+"/images/thumbnails/"+thisClass.id;}});this.__defineSetter__("thumbnailURL",function(val){thumbnailURL=val;});var imageURL="";this.__defineGetter__("imageURL",function(){return MF_Global.getS3CdnURL()+"app/wireframepro/company/"+thisClass.clientid+"/projects/"+thisClass.projectid+"/images/"+thisClass.id;});this.__defineSetter__("imageURL",function(val){imageURL=val;});this.cast=function(obj){this.id=obj.id;this.n=obj.n;this.l=obj.l;this.c=obj.c;this.setid=obj.setid;};}function MF_Log(){var thisClass=this;this.id=null;this.projectid=null;this.clientid=null;this.log=null;this.creator=null;this.createDate=null;this.creatorName=null;this.logtype=null;this.spaceid=null;this.logdata=null;this.projectName=null;this.spaceName=null;this.coverArt=null;this.collaborators=new Array();var logMessage="";this.__defineGetter__("logMessage",function(){var str=" ";var d=thisClass.createDate;if(d==null){d=new Date();}var curr_date=d.getDate();var curr_month=d.getMonth()+1;var curr_year=d.getFullYear();str=str+"["+curr_date+"-"+curr_month+"-"+curr_year+"] - ";if(MF_UserSession.getUser()&&thisClass.creator.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()){str=str+"You have";}else{str=str+thisClass.creatorName+" has";}str=str+" "+thisClass.log;return str;});this.__defineSetter__("logMessage",function(val){logMessage=val;});this.cast=function(obj){this.id=obj.id;this.projectid=obj.projectid;this.clientid=obj.clientid;this.log=obj.log;this.creator=obj.creator;this.createDate=obj.createDate;this.creatorName=obj.creatorName;this.logtype=obj.logtype;this.spaceid=obj.spaceid;this.logdata=obj.logdata;this.projectName=obj.projectName;this.spaceName=obj.spaceName;this.coverArt=obj.coverArt;this.collaborators=obj.collaborators;};}function MF_UserInactive(){var thisClass=this;this.firstName=null;this.lastName=null;this.username=null;this.password=null;this.companyName=null;this.activateKey=null;this.expiry=null;this.createDate=null;}function MF_Company(){var thisClass=this;this.companyid=null;this.pid=null;this.dbserver=null;this.edition=null;this.createDate=null;this.creator=null;this.status=null;this.storage=null;this.plimit=1;}function MF_DashboardData(){var thisClass=this;this.logshared=null;this.labels=null;this.projects=null;this.ownedProjectsCount=0;this.sharedProjectsCount=0;this.totalProjectsCount=0;this.publicProjectsCount=0;this.trashProjectsCount=0;this.readonlyProjectsCount=0;}function MF_DashboardListing(){var thisClass=this;this.logshared=null;this.spaces=null;this.totalProjectCount=0;}function MF_ProjectLabel(){var thisClass=this;this.id=null;this.name=null;this.defaultSpace=false;}function MF_TeamMember(){var thisClass=this;this.id=null;this.userid=null;this.license=null;this.type=null;this.name=null;var profileImage="";this.__defineGetter__("profileImage",function(){var cr=thisClass.userid;if(cr=="support@mockflow.com"){cr="dummymf";}var str=MF_Utils.get_gravatar(cr,48);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});var displayName="";this.__defineGetter__("displayName",function(){if(thisClass.name==null||thisClass.name.trim().length==0){var emailArr=thisClass.userid.split("@");return emailArr[0];}return thisClass.name;});this.__defineSetter__("displayName",function(val){displayName=val;});this.cast=function(obj){this.userid=obj.userid;this.license=obj.license;this.type=obj.type;this.id=obj.id;this.name=obj.name;};}function MF_DisplayMember(){var thisClass=this;this.id=null;this.userid=null;this.type=null;this.member=false;this.canAdmin=false;this.name="";this.obj=null;this.sharePerm=null;var profileImage="";this.__defineGetter__("profileImage",function(){var str=MF_Utils.get_gravatar(thisClass.userid,64);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});var memberType="";this.__defineGetter__("memberType",function(){if(thisClass.type=="Admin"){return"Admin";}if(thisClass.type=="Editor"){return"Editor";}if(thisClass.type=="Reviewer"){return"Reviewer";}return"Owner";});this.__defineSetter__("profileImage",function(val){memberType=val;});var displayName="";this.__defineGetter__("displayName",function(){if(thisClass.name==null||thisClass.name.trim().length==0){var emailArr=thisClass.userid.split("@");return emailArr[0];}return thisClass.name;});this.__defineSetter__("displayName",function(val){displayName=val;});var owner="";this.__defineGetter__("owner",function(){if(mf_main.designSpaceController.selectedDesignSpace&&MF_UserSession.getUser()){if(!mf_main.designSpaceController.selectedDesignSpace.builtIn&&mf_main.designSpaceController.selectedDesignSpace.creator==thisClass.userid){return true;}}if(mf_main.designSpaceController.selectedDesignSpace&&mf_main.designSpaceController.selectedDesignSpace.id=="default"){if(mf_main.designSpaceController.projectController.selectedProject){if(mf_main.designSpaceController.projectController.selectedProject.creator==thisClass.userid){return true;}}}return false;});this.__defineSetter__("owner",function(val){owner=val;});this.__defineGetter__("showReviewerRole",function(){if(thisClass.type=="Reviewer"){return"none";}return"block";});this.__defineSetter__("showReviewerRole",function(val){showReviewerRole=val;});this.__defineGetter__("showEditorRole",function(){if(thisClass.type=="Editor"){return"none";}return"block";});this.__defineSetter__("showEditorRole",function(val){showEditorRole=val;});this.__defineGetter__("showAdminRole",function(){if(thisClass.type=="Admin"){return"none";}return"block";});this.__defineSetter__("showAdminRole",function(val){showAdminRole=val;});}function MF_Collaborator(){var thisClass=this;this.id=null;this.projectid=null;this.userid=null;this.type=null;this.online=false;this.name="";this.sharePerm=null;var profileImage="";this.__defineGetter__("profileImage",function(){var str=MF_Utils.get_gravatar(thisClass.userid,64);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});var memberType="";this.__defineGetter__("memberType",function(){if(thisClass.type=="Admin"){return"Admin";}if(thisClass.type=="Editor"){return"Editor";}if(thisClass.type=="Reviewer"){return"Reviewer";}return"Owner";});this.__defineSetter__("profileImage",function(val){memberType=val;});var displayName="";this.__defineGetter__("displayName",function(){if(thisClass.name==null||thisClass.name.trim().length==0){var emailArr=thisClass.userid.split("@");return emailArr[0];}return thisClass.name;});this.__defineSetter__("displayName",function(val){displayName=val;});this.cast=function(obj){this.id=obj.id;this.projectid=obj.projectid;this.userid=obj.userid;this.type=obj.type;this.online=obj.online;this.sharePerm=obj.sharePerm;this.name=obj.name;};}function MF_User(){var thisClass=this;this.firstName="dd";this.lastName="cc";this.createDate=null;this.username="";this.password="";this.company="";this.type="";this.companyName="";this.pid="";this.lastLogin=null;this.tokenKey="";this.projectsLeft=0;this.isBasic=true;this.isTrial=false;this.hadTrial=false;this.daysLeft=0;this.accountType="";this.offlineMode=false;this.ipaddress="0.0.0.0";this.teamEditor=false;this.wireframing=false;this.productdesign=false;this.teamLicenseOwner="";this.plusEdition=null;this.totalProjectCount=0;this.enterprise=false;this.licensePending=false;this.licensePendingOwner="";var createDateStr="";this.__defineGetter__("createDateStr",function(){if(thisClass.createDate!=null){var curr_date=thisClass.createDate.getDate();var curr_month=thisClass.createDate.getMonth()+1;var curr_year=thisClass.createDate.getFullYear();return curr_date+" "+MF_Utils.getMonthByName(thisClass.createDate.getMonth())+" "+curr_year;}else{return thisClass.createDate;}});this.__defineSetter__("createDateStr",function(val){createDateStr=val;});var isTeamLicenseOwner=false;this.__defineGetter__("isTeamLicenseOwner",function(){if(!thisClass.isBasic){if(thisClass.teamLicenseOwner==thisClass.username){return true;}}return false;});this.__defineSetter__("isTeamLicenseOwner",function(val){isTeamLicenseOwner=val;});var isNewLicense=false;this.__defineGetter__("isNewLicense",function(){if(thisClass.createDate!=null){var changeLicenseDate=new Date(2018,3,22);if(thisClass.createDate>changeLicenseDate){return true;}}return isNewLicense;});this.__defineSetter__("isNewLicense",function(val){});var profileImage="";this.__defineGetter__("profileImage",function(){var str=MF_Utils.get_gravatar(thisClass.username,48);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});}var MF_UserSession=(function(){var user=new MF_User();function privateMethod(){}return{getUser:function(){return user;},allowAllPowerups:function(){if(MF_UserSession.getUser()&&MF_UserSession.getUser().productdesign){return true;}return false;},isCreateAllowed:function(type){if(type=="pinpage"){return true;}if(MF_UserSession.getUser().isBasic||MF_UserSession.getUser().wireframing){var allowCount=0;if(type=="uidrawing"){if(MF_UserSession.getUser().wireframing){return true;}allowCount=1;}else{if(type=="designfile"){allowCount=10;}if(type=="designembed"){allowCount=10;}if(type=="powerup"){return true;}}var count=0;for(var i=0;i<mf_main.designSpaceController.selectedDesignSpace.projects.length;i++){var p=mf_main.designSpaceController.selectedDesignSpace.projects[i];if(p.projectType==type){count++;}}if(count>=allowCount){return false;}else{return true;}}else{return true;}},IsOpenAllowed:function(type){if(type==null){type="uidrawing";}if(MF_UserSession.getUser()){if(MF_UserSession.getUser().isBasic||MF_UserSession.getUser().wireframing){if(mf_main.designSpaceController.selectedDesignSpace==null){return true;}if(mf_main.designSpaceController.selectedDesignSpace.id=="default"){if(MF_UserSession.getUser().wireframing){return true;}var count=0;for(var i=0;i<mf_main.designSpaceController.selectedDesignSpace.projects.length;i++){var mock=mf_main.designSpaceController.selectedDesignSpace.projects[i];if(mock.company==MF_UserSession.getUser().company){count++;}if(count>1){return false;}}return true;}else{var count=0;if(type=="uidrawing"||type=="pinpage"||type=="powerup"||type=="powerupproject"){if(MF_UserSession.getUser().wireframing){return true;}}var baseCount=1;if(type=="uidrawing"){baseCount=1;}if(type=="designfile"){baseCount=10;}if(type=="designembed"){baseCount=10;}if(type=="powerup"||type=="powerupproject"){return true;}if(type=="pinpage"){baseCount=3;}var drawingcount=0;for(var i=0;i<mf_main.designSpaceController.selectedDesignSpace.projects.length;i++){var mock=mf_main.designSpaceController.selectedDesignSpace.projects[i];if(mock.projectType==type){count++;}if(mock.projectType=="uidrawing"){drawingcount++;}if(count>baseCount){return false;}}if(drawingcount>1&&type=="pinpage"){return false;}return true;}}else{return true;}}return false;},createAllowedAlertMsg:function(type){var msg="";var planType="Basic plan";if(MF_UserSession.getUser().wireframing){planType="Wireframing plan";}if(MF_UserSession.getUser().isBasic||MF_UserSession.getUser().wireframing){if(type=="designfile"){msg="Your "+planType+" MockFlow account allows maximum of 10 design files per space, Upgrade to product design plan for no limit.";}else{if(type=="designembed"){msg="Your "+planType+" MockFlow account allows maximum of 10 design embeds per space, Upgrade to product design plan for no limit";}else{if(type=="powerup"){msg="Your "+planType+" MockFlow account allows only 2 powerups per space, Upgrade to product design for full access";}else{msg="Your "+planType+" MockFlow account allows only 1 UI drawing project per space, Upgrade account for unlimited projects";}}}}if(MF_UserSession.getUser()){if(MF_UserSession.getUser().isBasic){if(MF_UserSession.getUser().hadTrial){msg="Your Trial Period has expired. Upgrade account for continued access";}}}return msg;},createAllowedAlertMsg2:function(){var msg="Your Basic MockFlow account allows only 1 project, Upgrade account at MockFlow.com for unlimited projects.";if(MF_UserSession.getUser()){if(MF_UserSession.getUser().isBasic){if(MF_UserSession.getUser().hadTrial){msg="Your Trial Period has expired. Upgrade account at MockFlow.com for continued access";}}}return msg;},createAllowed2:function(){if(MF_UserSession.getUser()){if(MF_UserSession.getUser().isBasic){if(mf_main.PROJECT_COUNT>=1){return false;}if(mf_main.isAllowedToCreateProject){return true;}return false;}else{return true;}}return false;},createSpaceAllowed:function(){if(MF_UserSession.getUser()){if(MF_UserSession.getUser().isBasic){var count=0;for(var k=0;k<mf_main.designSpaceController.designSpaceCollection.size();k++){var space=mf_main.designSpaceController.designSpaceCollection.getItemAt(k);if(!space.builtIn&&space.clientid==MF_UserSession.getUser().company){count++;if(count>=1){return false;}}}return true;}else{return true;}}return false;},openAllowed2:function(){if(MF_UserSession.getUser()){if(MF_UserSession.getUser().isBasic){if(mf_main.PROJECT_COUNT==1||mf_main.PROJECT_COUNT==0){return true;}else{return false;}if(mf_main.isAllowedToCreateProject){return true;}return false;}else{return true;}}return false;},createAllowed:function(type){if(type==null){type=="uidrawing";}if(MF_UserSession.getUser()){if(MF_UserSession.getUser().isBasic||MF_UserSession.getUser().wireframing){if(mf_main.designSpaceController.selectedDesignSpace.id=="default"){var count=0;for(var i=0;i<mf_main.designSpaceController.selectedDesignSpace.projects.length;i++){var mock=mf_main.designSpaceController.selectedDesignSpace.projects[i];if(mock.company==MF_UserSession.getUser().company){count++;}if(count>=1){return false;}}return true;}else{var count=0;if(type=="uidrawing"){if(MF_UserSession.getUser().wireframing){return true;}}var baseCount=1;if(type=="uidrawing"){baseCount=1;}if(type=="designfile"){baseCount=10;}if(type=="designembed"){baseCount=10;}if(type=="powerup"){return true;}for(var i=0;i<mf_main.designSpaceController.selectedDesignSpace.projects.length;i++){var mock=mf_main.designSpaceController.selectedDesignSpace.projects[i];if(mock.projectType==type){count++;}if(count>=baseCount){return false;}}return true;}}else{return true;}}return false;}};})();var MF_Permission=(function(){function privateMethod(){}return{deny:function(projectObj,permission){if(mf_main.PUBLIC){return true;}if(projectObj&&projectObj.checkPermission){if(projectObj.permissionType=="Admin"){return false;}if(permission=="canViewLog"){if(projectObj.permissionType=="Reviewer"){return true;}}if(permission=="canViewMembers"){if(projectObj.permissionType=="Reviewer"){return true;}}if(permission=="canUploadImage"){if(projectObj.permissionType=="Reviewer"){return true;}}if(permission=="canDeleteImage"){if(projectObj.permissionType=="Reviewer"){return true;}}if(permission=="canPreviewRevision"){if(projectObj.permissionType=="Reviewer"){return true;}}if(permission=="canDeleteRevision"){if(projectObj.permissionType=="Reviewer"){return true;}}if(permission=="canChangeSiteMap"){if(projectObj.permissionType=="Reviewer"){return true;}}if(permission=="canExportData"){if(projectObj.permissionType=="Reviewer"){return true;}}if(permission=="canUploadFont"){if(projectObj.permissionType=="Reviewer"){return true;}}}return false;}};})();function MF_WireframeTemplate(){var thisClass=this;this.id=null;this.title=null;this.tags=null;this.type=null;this.submitter=null;this.cid=null;this.createDate=null;this.rating=0;this.abuse=false;this.downloads=0;this.premium=false;this.featured=false;this.submitterName=null;this.width=0;this.height=0;var createDateStr="";this.__defineGetter__("createDateStr",function(){if(thisClass.createDate!=null){var curr_date=thisClass.createDate.getDate();var curr_month=thisClass.createDate.getMonth()+1;var curr_year=thisClass.createDate.getFullYear();var hours=thisClass.createDate.getHours();var minutes=thisClass.createDate.getMinutes();return curr_date+" "+MF_Utils.getMonthByName(thisClass.createDate.getMonth())+" "+curr_year+" - "+hours+":"+minutes;}else{return thisClass.createDate;}});this.__defineSetter__("createDateStr",function(val){createDateStr=val;});var thumbnailURL="";this.__defineGetter__("thumbnailURL",function(){return MF_Global.getS3CdnURL()+"app/wireframepro/store/templates/"+thisClass.id+"/thumbnail/"+thisClass.id;});this.__defineSetter__("thumbnailURL",function(val){thumbnailURL=val;});var pdfURL="";this.__defineGetter__("pdfURL",function(){return MF_Global.getS3CdnURL()+"app/wireframepro/store/templates/"+thisClass.id+"/pdf/"+thisClass.id+".pdf";});this.__defineSetter__("pdfURL",function(val){imageURL=val;});this.cast=function(obj){this.id=obj.id;this.title=obj.title;this.tags=obj.tags;this.type=obj.type;this.submitter=obj.submitter;this.cid=obj.cid;this.createDate=obj.createDate;this.rating=obj.rating;this.abuse=obj.abuse;this.downloads=obj.downloads;this.premium=obj.premium;this.featured=obj.featured;this.submitterName=obj.submitterName;this.width=obj.width;this.height=obj.height;};}function MF_PackData(){var thisClass=this;this.comppacks=null;this.sortpacks=null;this.teamList=null;}function MF_MeshGrid(){var thisClass=this;this.type="mesh";this.lineColor="#cccccc";this.snap=true;this.size=20;this.position="behind";this.showInViewer=false;this.meshType="line";this.getXML=function(){var xml="<grid ";xml=xml+" type='mesh' ";xml=xml+" meshType='"+thisClass.meshType+"' ";xml=xml+" lineColor='"+thisClass.lineColor+"' ";xml=xml+" snap="+thisClass.snap.toString();+" ";xml=xml+" showInViewer="+thisClass.showInViewer.toString();+" ";xml=xml+" size="+thisClass.size+" ";xml=xml+" position='"+thisClass.position+"' ";xml=xml+" ></grid>";return xml;};this.setXML=function(xmlobj){thisClass.lineColor=xmlobj.attr("lineColor");thisClass.position=xmlobj.attr("position");if(xmlobj.attr("snap")=="true"){thisClass.snap=true;}else{thisClass.snap=false;}if(xmlobj.attr("showInViewer")=="true"){thisClass.showInViewer=true;}else{thisClass.showInViewer=false;}thisClass.size=parseInt(xmlobj.attr("size"));if(xmlobj.attr("meshType")){thisClass.meshType=xmlobj.attr("meshType");}};this.cast=function(obj){thisClass.lineColor=obj.lineColor;thisClass.snap=obj.snap;thisClass.size=obj.size;thisClass.position=obj.position;thisClass.showInViewer=obj.showInViewer;if(obj.meshType){thisClass.meshType=obj.meshType;}};this.setGrid=function(count){if(mf_main.RENDER||mf_main.REVISION){return;}if(mf_main.editorController.VIEWER&&thisClass.showInViewer==false){$("#mfGrid").remove();return;}$("#mfGrid").remove();var htmldiv;if(thisClass.meshType=="line"){htmldiv="<div id='mfGrid' class='mfMeshGrid' style='background-size: "+thisClass.size+"px "+thisClass.size+"px; background-image: linear-gradient(to right, "+thisClass.lineColor+" 1px, transparent 1px), linear-gradient(to bottom, "+thisClass.lineColor+"  1px, transparent 1px); '></div>";}else{if(thisClass.meshType="dotted"){htmldiv="<div id='mfGrid' class='mfMeshGrid' style='background-size: "+thisClass.size+"px "+thisClass.size+"px; background-image: radial-gradient("+thisClass.lineColor+" 6%, transparent 2px);background-position:"+thisClass.size/2+"px "+thisClass.size/2+"px'></div>";}}if(thisClass.position=="behind"){$("#mfBackgroundPage").prepend(htmldiv);}else{$("#mfBackgroundPage").append(htmldiv);$("#mfGrid").css("z-index",mf_main.editorController.loadedPages.length+10);}};}function MF_960Grid(){var thisClass=this;this.type="960";this.columnColor="#f44336";this.columnSize=60;this.gutterSize=10;this.position="behind";this.showInViewer=false;this.getXML=function(){var xml="<grid ";xml=xml+" type='960' ";xml=xml+" columnColor='"+thisClass.columnColor+"' ";xml=xml+" showInViewer="+thisClass.showInViewer.toString();+" ";xml=xml+" columnSize="+thisClass.columnSize+" ";xml=xml+" gutterSize="+thisClass.gutterSize+" ";xml=xml+" position='"+thisClass.position+"' ";xml=xml+" ></grid>";return xml;};this.cast=function(obj){thisClass.columnColor=obj.columnColor;thisClass.columnSize=obj.columnSize;thisClass.gutterSize=obj.gutterSize;thisClass.position=obj.position;thisClass.showInViewer=obj.showInViewer;};this.setXML=function(xmlobj){thisClass.columnColor=xmlobj.attr("columnColor");thisClass.position=xmlobj.attr("position");if(xmlobj.attr("showInViewer")=="true"){thisClass.showInViewer=true;}else{thisClass.showInViewer=false;}thisClass.columnSize=parseInt(xmlobj.attr("columnSize"));thisClass.gutterSize=parseInt(xmlobj.attr("gutterSize"));};this.setGrid=function(count){if(mf_main.RENDER||mf_main.REVISION){return;}if(mf_main.editorController.VIEWER&&thisClass.showInViewer==false){$("#mfGrid").remove();return;}$("#mfGrid").remove();var colcolorrgb=MF_ComponentUtils.hexToRGB(thisClass.columnColor,0.2);var htmldiv="<div id='mfGrid' style='position: absolute; pointer-events: none; width: 100%; height: 100%; background-color: transparent; background-size: "+(thisClass.columnSize+thisClass.gutterSize)+"px "+(thisClass.columnSize+thisClass.gutterSize)+"px; background-image: linear-gradient(90deg, transparent "+thisClass.gutterSize+"px, "+colcolorrgb+" "+thisClass.gutterSize+"px); '></div>";if(thisClass.position=="behind"){$("#mfBackgroundPage").prepend(htmldiv);}else{$("#mfBackgroundPage").append(htmldiv);$("#mfGrid").css("z-index",mf_main.editorController.loadedPages.length+10);}};}function MF_FavouriteColor(){var thisClass=this;this.id=null;this.code=null;this.title=null;this.sort=null;}function MF_CustomFont(){var thisClass=this;this.id=null;this.projectid=null;this.clientid=null;this.filename=null;this.filetype=null;this.filesize=null;this.creator=null;this.preview=false;this.cast=function(obj){this.id=obj.id;this.projectid=obj.projectid;this.clientid=obj.clientid;this.filename=obj.filename;this.filetype=obj.filetype;this.filesize=obj.filesize;this.creator=obj.creator;this.preview=obj.preview;};}function MF_Powerup(){var thisClass=this;this.id=null;this.slug=null;this.name=null;this.description=null;this.details=null;this.detailsMarkdown=null;this.category=null;this.creator=null;this.source=null;this.mode="all";this.license="free";this.installed=false;this.installationid=null;this.sortorder=1;this.isPublic=false;this.isUsed=false;this.isPinnedToSpace=false;this.cast=function(obj){thisClass.id=obj.id;thisClass.slug=obj.slug;thisClass.name=obj.name;thisClass.description=obj.description;thisClass.details=obj.details;thisClass.detailsMarkdown=obj.detailsMarkdown;thisClass.category=obj.category;thisClass.creator=obj.creator;thisClass.source=obj.source;thisClass.mode=obj.mode;thisClass.license=obj.license;thisClass.installed=obj.installed;thisClass.installationid=obj.installationid;thisClass.sortorder=obj.sortorder;thisClass.isPublic=obj.isPublic;thisClass.isUsed=obj.isUsed;thisClass.isPinnedToSpace=obj.isPinnedToSpace;};var iconURL="";this.__defineGetter__("iconURL",function(){return MF_Global.getS3CdnURL()+"app/wireframepro/powerups/assets/"+thisClass.id+"/icon/"+thisClass.id;});this.__defineSetter__("iconURL",function(val){iconURL=val;});var thumbnailURL="";this.__defineGetter__("thumbnailURL",function(){return MF_Global.getS3CdnURL()+"app/wireframepro/powerups/assets/"+thisClass.id+"/thumbnail/"+thisClass.id;});this.__defineSetter__("thumbnailURL",function(val){thumbnailURL=val;});var shortDescription="";this.__defineGetter__("shortDescription",function(){var shortDesc=thisClass.description;if(thisClass.description.length>72){shortDesc=shortDesc.substring(0,72)+" ...";}return shortDesc;});this.__defineSetter__("shortDescription",function(val){shortDescription=val;});var usedPowerupClassname="";this.__defineGetter__("usedPowerupClassname",function(){if(thisClass.isUsed){return"mfPowerupItemUsed";}return"";});this.__defineSetter__("usedPowerupClassname",function(val){usedPowerupClassname=val;});var isPinned="";this.__defineGetter__("isPinned",function(){if(mf_main&&mf_main.editorController&&mf_main.editorController.projectObj){var powerupIndx=MF_Utils.searchObjArray(mf_main.editorController.projectObj.pinnedPowerups,"id",thisClass.id);if(powerupIndx!=-1){return true;}else{return false;}}else{return false;}});this.__defineSetter__("isPinned",function(val){isPinned=val;});var isProjectOwner="";this.__defineGetter__("isProjectOwner",function(){if(mf_main.PERMISSION=="Owner"||mf_main.PERMISSION=="Admin"){return true;}else{return false;}});this.__defineSetter__("isProjectOwner",function(val){isProjectOwner=val;});}function MF_PowerupScreenshot(){var thisClass=this;this.id=null;this.powerupid=null;this.mediatype=null;this.filetype=null;this.sortorder=1;this.creator=null;this.cast=function(obj){thisClass.id=obj.id;thisClass.powerupid=obj.powerupid;thisClass.mediatype=obj.mediatype;thisClass.filetype=obj.filetype;thisClass.sortorder=obj.sortorder;thisClass.creator=obj.creator;};var screenshotURL="";this.__defineGetter__("screenshotURL",function(){return MF_Global.getS3CdnURL()+"app/wireframepro/powerups/assets/"+thisClass.powerupid+"/screenshots/"+thisClass.id;});this.__defineSetter__("screenshotURL",function(val){screenshotURL=val;});var thumbnailURL="";this.__defineGetter__("thumbnailURL",function(){return MF_Global.getS3CdnURL()+"app/wireframepro/powerups/assets/"+thisClass.powerupid+"/screenshots/thumbnail/"+thisClass.id;});this.__defineSetter__("thumbnailURL",function(val){thumbnailURL=val;});}function MF_SvgIconSet(){this.l=null;this.n=null;this.cast=function(obj){this.n=obj.n;this.l=obj.l;};}function MF_SvgIconData(){var thisClass=this;this.n=null;this.l=null;this.c=null;this.svgIconPackType=null;var svgURL="";this.__defineGetter__("svgURL",function(){if(MF_Global.getS3Bucket()=="assets.mockflow.com"){return MF_Global.getS3CdnURL()+"app/wireframepro/svg/"+thisClass.svgIconPackType+"/"+thisClass.n;}else{return MF_Global.getS3CdnURL()+"app/wireframepro/svg/"+thisClass.svgIconPackType+"/"+thisClass.n;}});this.__defineSetter__("svgURL",function(val){svgURL=val;});this.cast=function(obj){this.n=obj.n;this.l=obj.l;this.c=obj.c;this.svgIconPackType=obj.svgIconPackType;};}function MF_SvgIllustrationData(){var thisClass=this;this.n=null;this.l=null;this.c=null;this.svgIconPackType=null;var svgURL="";this.__defineGetter__("svgURL",function(){if(MF_Global.getS3Bucket()=="assets.mockflow.com"){return MF_Global.getS3CdnURL()+"app/wireframepro/illustrations/"+thisClass.svgIconPackType+"/"+thisClass.n;}else{return"https://assets.mockflow.com/app/wireframepro/illustrations/"+thisClass.svgIconPackType+"/"+thisClass.n;}});this.__defineSetter__("svgURL",function(val){svgURL=val;});this.cast=function(obj){this.n=obj.n;this.l=obj.l;this.c=obj.c;this.svgIconPackType=obj.svgIconPackType;};}function MF_DashboardRTCItem(){var thisClass=this;this.messageStr=null;this.sender=MF_UserSession.getUser().username;this.senderName=MF_UserSession.getUser().firstName;this.receiver=null;this.project=null;this.space=null;this.collaborators=new Array();this.notifyCollaborators=new Array();var profileImage="";this.__defineGetter__("profileImage",function(){var str=MF_Utils.get_gravatar(MF_UserSession.getUser().username,32);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});this.cast=function(obj){this.messageStr=obj.messageStr;this.receiver=obj.receiver;this.space=obj.space;this.project=obj.project;this.collaborators=obj.collaborators;this.notifyCollaborators=obj.collaborators;};}function MF_EditorRTCItem(){var thisClass=this;this.messageStr=null;this.sender=MF_UserSession.getUser().username;this.senderName=MF_UserSession.getUser().firstName;this.receiver=null;this.project=null;this.collaborators=mf_main.editorController.powerupController.getRTCCollaboratorList();this.notifyCollaborators=new Array();var profileImage="";this.__defineGetter__("profileImage",function(){var str=MF_Utils.get_gravatar(MF_UserSession.getUser().username,32);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});var space=new Array();this.__defineGetter__("space",function(){space=mf_main.editorController.projectObj.spaceId;return space;});this.__defineSetter__("space",function(val){space=val;});this.cast=function(obj){this.messageStr=obj.messageStr;this.receiver=obj.receiver;this.space=obj.space;this.project=obj.project;this.collaborators=obj.collaborators;this.notifyCollaborators=obj.collaborators;};}function MF_CompFilter(){var thisClass=this;this.id=null;this.name=null;this.packid=null;this.clientid=null;this.sort=0;this.cast=function(obj){this.id=obj.id;this.name=obj.name;this.packid=obj.packid;this.clientid=obj.clientid;this.sort=obj.sort;};}function MF_PinnedPowerup(){var thisClass=this;this.id=null;this.name=null;this.iconURL=null;this.mode=null;this.isPublic=null;this.sort=null;}function MF_TeamData(){var thisClass=this;this.teamList=null;this.chatMembers=null;this.cast=function(obj){this.teamList=obj.teamList;this.chatMembers=obj.chatMembers;};}function MF_DesignFile(){var thisClass=this;this.id=null;this.title=null;this.status=null;this.additionaldata=null;this.masterfileid=null;this.creator=null;this.clientid=null;this.spaceid="default";this.createDate=null;this.versions=new Array();this.options=null;this.thirdpartyapp=null;this.cast=function(obj){this.id=obj.id;this.title=obj.title;this.status=obj.status;this.additionaldata=obj.additionaldata;this.masterfileid=obj.masterfileid;this.creator=obj.creator;this.clientid=obj.clientid;this.spaceid=obj.spaceid;if(obj.createDate&&typeof obj.createDate=="string"){this.createDate=new Date(obj.createDate);}else{this.createDate=obj.createDate;}if(obj.versions){this.versions=new Array();for(var i=0;i<obj.versions.length;i++){var versionObj=new MF_DesignFileVersion();versionObj.cast(obj.versions[i]);this.versions.push(versionObj);}}else{this.versions=obj.versions;}this.options=obj.options;this.thirdpartyapp=obj.thirdpartyapp;};var optionsJSON="";this.__defineGetter__("optionsJSON",function(){if(thisClass.options!=null&&thisClass.options!=""){return JSON.parse(thisClass.options);}return{};});this.__defineSetter__("optionsJSON",function(val){optionsJSON=val;this.options=JSON.stringify(optionsJSON);});}function MF_DesignEmbed(){var thisClass=this;this.id=null;this.title=null;this.status=null;this.icon=null;this.caption=null;this.creator=null;this.clientid=null;this.origurl=null;this.embedCode=null;this.embedType=null;this.embedURL=null;this.width=1200;this.height=800;this.spaceid="default";this.createDate=null;this.options=null;this.autoSize=true;this.cast=function(obj){this.id=obj.id;this.title=obj.title;this.icon=obj.icon;this.status=obj.status;this.caption=obj.caption;this.creator=obj.creator;this.clientid=obj.clientid;this.origurl=obj.origurl;this.embedCode=obj.embedCode;this.embedType=obj.embedType;this.embedURL=obj.embedURL;this.width=obj.width;this.height=obj.height;this.spaceid=obj.spaceid;if(obj.createDate&&typeof obj.createDate=="string"){this.createDate=new Date(obj.createDate);}else{this.createDate=obj.createDate;}this.options=obj.options;this.autoSize=obj.autoSize;};var optionsJSON="";this.__defineGetter__("optionsJSON",function(){if(thisClass.options!=null&&thisClass.options!=""){return JSON.parse(thisClass.options);}return{};});this.__defineSetter__("optionsJSON",function(val){optionsJSON=val;this.options=JSON.stringify(optionsJSON);});}function MF_DesignEmbedApp(){var thisClass=this;this.id=null;this.name=null;this.support=null;var icon="";this.__defineGetter__("icon",function(){return"images/designembed/"+thisClass.id+".png";});this.__defineSetter__("icon",function(val){icon=val;});}function MF_DesignFileVersion(){var thisClass=this;this.id=null;this.designfileid=null;this.filetype=null;this.filesize=0;this.height=0;this.width=0;this.clientid=null;this.version=null;this.notes=null;this.creator=null;this.createDate=null;this.sort=null;this.extension=null;this.comments=[];this.hasComments=false;this.commentsLoaded=false;var previewURL="";this.__defineGetter__("previewURL",function(){if(MF_Global.getS3Bucket()=="testmfassets"){return"https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+thisClass.clientid+"/projects/"+thisClass.designfileid+"/version/"+thisClass.id+"."+thisClass.extension;}else{return"https://"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+thisClass.clientid+"/projects/"+thisClass.designfileid+"/version/"+thisClass.id+"."+thisClass.extension;}});this.__defineSetter__("previewURL",function(val){previewURL=val;});var origURL="";this.__defineGetter__("origURL",function(){return"https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+thisClass.clientid+"/projects/"+thisClass.designfileid+"/version/"+thisClass.id+"."+thisClass.extension;});this.__defineSetter__("origURL",function(val){origURL=val;});var displayDate="";this.__defineGetter__("displayDate",function(){return moment(thisClass.createDate).format("D MMM YY");});this.__defineSetter__("displayDate",function(val){displayDate=val;});var shortDescription="";this.__defineGetter__("shortDescription",function(){var charLength=30;if(thisClass.notes!=null){if(thisClass.notes.length>charLength){return thisClass.notes.substring(0,charLength)+"...";}else{return thisClass.notes;}}return"";});this.__defineSetter__("shortDescription",function(val){shortDescription=val;});var isMasterVersion="";this.__defineGetter__("isMasterVersion",function(){if(mf_main.designSpaceController.projectController.designFilesController.selectedDesignFile!=null&&thisClass.id==mf_main.designSpaceController.projectController.designFilesController.selectedDesignFile.masterfileid){return true;}return false;});this.__defineSetter__("isMasterVersion",function(val){isMasterVersion=val;});this.cast=function(obj){this.id=obj.id;this.designfileid=obj.designfileid;this.filetype=obj.filetype;this.filesize=obj.filesize;this.height=obj.height;this.width=obj.width;this.clientid=obj.clientid;this.version=obj.version;this.notes=obj.notes;this.creator=obj.creator;if(obj.createDate&&typeof obj.createDate=="string"){this.createDate=new Date(obj.createDate);}else{this.createDate=obj.createDate;}this.sort=obj.sort;this.extension=obj.extension;this.hasComments=obj.hasComments;};}function MF_ThirdpartyApp(){var thisClass=this;this.id=null;this.name="";this.endpoint="";this.ext="";var imageURL="";this.__defineGetter__("imageURL",function(){return"thirdpartyapps/images/"+thisClass.id+"."+thisClass.ext;});this.__defineSetter__("imageURL",function(val){imageURL=val;});this.cast=function(obj){thisClass.id=obj.id;thisClass.name=obj.name;thisClass.endpoint=obj.endpoint;thisClass.ext=obj.ext;};}function MF_SSOSettings(){var thisClass=this;this.clientid=null;this.enabled=false;this.provider=null;this.issuerid=null;this.signinurl=null;this.certificate=null;this.createDate=null;this.enforce=false;this.verified=false;}function MF_CreatePowerup(){var thisClass=this;this.id=null;this.name=null;this.description=null;this.scope="";this.powerupType=null;this.editorCreate=false;this.directaccess=false;this.category="";this.paid=true;this.cast=function(obj){thisClass.id=obj.id;thisClass.description=obj.description;thisClass.name=obj.name;thisClass.scope=obj.scope;};var enable="";this.__defineGetter__("enable",function(){if(MF_UserSession.getUser().isBasic||MF_UserSession.getUser().wireframing){if(thisClass.paid==true){return false;}else{return true;}}return true;});this.__defineSetter__("enable",function(val){enable=val;});var displayTag="";this.__defineGetter__("displayTag",function(){if(MF_UserSession.getUser().isBasic||MF_UserSession.getUser().wireframing){if(thisClass.paid==true){return true;}else{return false;}}return false;});this.__defineSetter__("displayTag",function(val){displayTag=val;});var opacity="";this.__defineGetter__("opacity",function(){if(MF_UserSession.getUser().wireframing){if(thisClass.paid==true){return 0.5;}else{return 1;}}return 1;});this.__defineSetter__("opacity",function(val){opacity=val;});var iconURL="";this.__defineGetter__("iconURL",function(){return MF_Global.getS3CdnURL()+"app/wireframepro/powerups/assets/"+thisClass.id+"/icon/"+thisClass.id;});this.__defineSetter__("iconURL",function(val){iconURL=val;});var shortDescription="";this.__defineGetter__("shortDescription",function(){var shortDesc=thisClass.description;if(thisClass.description.length>57){shortDesc=shortDesc.substring(0,57)+" ...";}return shortDesc;});this.__defineSetter__("shortDescription",function(val){shortDescription=val;});var mfpinmodalthumbURL="";this.__defineGetter__("mfpinmodalthumbURL",function(){return"images/dash/pinmodal/thumbs/"+thisClass.id+".png";});this.__defineSetter__("mfpinmodalthumbURL",function(val){mfpinmodalthumbURL=val;});}function MF_PowerupPopupItem(){var thisClass=this;this.id=null;this.name=null;var iconURL="";this.__defineGetter__("iconURL",function(){return"https://assets.mockflow.com/app/wireframepro/powerups/assets/"+thisClass.id+"/icon/"+thisClass.id;});this.__defineSetter__("iconURL",function(val){iconURL=val;});this.cast=function(obj){this.id=obj.id;this.name=obj.name;};}function MF_ProductTour(){var thisClass=this;this.id="";this.steps=[];this.cast=function(obj){this.id=obj.id;this.steps=obj.steps;};}function MF_ProductTourStep(){var thisClass=this;this.title="";this.description="";this.order=1;this.displayOrder=1;this.target="";this.imageURL="";this.templateType="";this.totalSteps=0;var notFirst=true;this.__defineGetter__("notFirst",function(){if(thisClass.displayOrder>1){return true;}return false;});this.__defineSetter__("notFirst",function(val){notFirst=val;});var notLast=true;this.__defineGetter__("notLast",function(){if(thisClass.displayOrder<thisClass.totalSteps){return true;}return false;});this.__defineSetter__("notLast",function(val){notLast=val;});var isLast=true;this.__defineGetter__("isLast",function(){if(thisClass.displayOrder==thisClass.totalSteps){return true;}return false;});this.__defineSetter__("isLast",function(val){isLast=val;});var isLargeImage=true;this.__defineGetter__("isLargeImage",function(){if(thisClass.templateType=="largeimage"){return true;}return false;});this.__defineSetter__("isLargeImage",function(val){isLargeImage=val;});var isSmallImage=true;this.__defineGetter__("isSmallImage",function(){if(thisClass.templateType=="smallimage"){return true;}return false;});this.__defineSetter__("isSmallImage",function(val){isSmallImage=val;});var isTextOnly=true;this.__defineGetter__("isTextOnly",function(){if(thisClass.templateType=="text"){return true;}return false;});this.__defineSetter__("isTextOnly",function(val){isTextOnly=val;});this.cast=function(obj,tourObj){this.title=obj.title;this.description=obj.description;this.order=obj.order;this.target=obj.target;this.imageURL=obj.imageURL;this.templateType=obj.templateType;this.totalSteps=tourObj.steps.length;};}function MF_DesignFileCommentMarker(){var thisClass=this;this.id=null;this.clientid=null;this.designfileid=null;this.designfileversionid=null;this.spaceid=null;this.marker="";this.creator=null;this.messages=[];this.createDate=null;this.commentCount=0;this.cast=function(obj){this.id=obj.id;this.clientid=obj.clientid;this.designfileid=obj.designfileid;this.designfileversionid=obj.designfileversionid;this.spaceid=obj.spaceid;this.marker=obj.marker;this.creator=obj.creator;this.messages=obj.messages;this.createDate=obj.createDate;this.commentCount=obj.commentCount;};var displayDateTime=true;this.__defineGetter__("displayDateTime",function(){return moment(thisClass.createDate).format("D MMM YY");});this.__defineSetter__("displayDateTime",function(val){displayDateTime=val;});var profileImage="";this.__defineGetter__("profileImage",function(){var emailId=thisClass.creator;if(emailId=="mockflow@produle.com"){emailId="dummymf";}return MF_Utils.get_gravatar(emailId,60);});this.__defineSetter__("profileImage",function(val){profileImage=val;});var videoDisplayTime="";this.__defineGetter__("videoDisplayTime",function(){var timeInSeconds=parseInt(thisClass.marker);var minutes=Math.floor(timeInSeconds/60);if(minutes<10){minutes="0"+minutes;}var seconds=timeInSeconds%60;if(seconds<10){seconds="0"+seconds;}return minutes+":"+seconds;});this.__defineSetter__("videoDisplayTime",function(val){videoDisplayTime=val;});var videoDisplayMessage="";this.__defineGetter__("videoDisplayMessage",function(){for(var i=0;i<thisClass.messages.length;i++){if(thisClass.messages[i].isparent){var message=thisClass.messages[i].message;if(message.length>30){message=message.substr(0,30)+"...";}return message;break;}}return"";});this.__defineSetter__("videoDisplayMessage",function(val){videoDisplayTime=val;});var videoThumbnailURL="";this.__defineGetter__("videoThumbnailURL",function(){return MF_Global.getS3CdnURL()+"app/wireframepro/company/"+thisClass.clientid+"/projects/"+thisClass.designfileid+"/version/"+thisClass.designfileversionid+"/comment/"+thisClass.id+".png";});this.__defineSetter__("videoThumbnailURL",function(val){videoDisplayTime=val;});var creatorName="";this.__defineGetter__("creatorName",function(){for(var i=0;i<thisClass.messages.length;i++){if(thisClass.messages[i].isparent){return thisClass.messages[i].creatorName;break;}}return"";});this.__defineSetter__("creatorName",function(val){creatorName=val;});}function MF_DesignFileCommentMessage(){var thisClass=this;this.id=null;this.markerid=null;this.clientid=null;this.spaceid=null;this.creator=null;this.creatorName=null;this.message="";this.isparent=true;this.createDate=null;this.commentCount=0;this.cast=function(obj){this.id=obj.id;this.markerid=obj.markerid;this.clientid=obj.clientid;this.spaceid=obj.spaceid;this.creator=obj.creator;this.creatorName=obj.creatorName;this.message=obj.message;this.isparent=obj.isparent;this.createDate=obj.createDate;this.commentCount=obj.commentCount;};var displayDateTime=true;this.__defineGetter__("displayDateTime",function(){var commentDate=moment(thisClass.createDate);var nowDate=moment();if(nowDate.diff(commentDate,"days")<30){return moment(thisClass.createDate).fromNow();}else{return moment(thisClass.createDate).format("D MMM YY");}});this.__defineSetter__("displayDateTime",function(val){displayDateTime=val;});var profileImage="";this.__defineGetter__("profileImage",function(){var emailId=thisClass.creator;if(emailId=="mockflow@produle.com"){emailId="dummymf";}return MF_Utils.get_gravatar(emailId,60);});this.__defineSetter__("profileImage",function(val){profileImage=val;});}function MF_LogController(){var thisClass=this;this.constructor=function(){};this.downgradeTeamMember=function(memberid){var log=new MF_Log();log.creator=MF_UserSession.getUser().username;log.creatorName=MF_UserSession.getUser().firstName;log.id=MF_Utils.guidGenerator();log.logtype="MEMBER-DOWNGRADE";var logMessage=mf_main.logController.getLogMessage(log.logtype,"");log.log=logMessage;log.projectid="";var logshared=new MF_LogShared();logshared.creator=MF_UserSession.getUser().username;logshared.creatorName=MF_UserSession.getUser().firstName;logshared.id=MF_Utils.guidGenerator();logshared.projectName="";logshared.projectid="";logshared.logtype=log.logtype;logshared.receiver=memberid;MF_LogManager.add(MF_UserSession.getUser().company,log,logshared,{callback:function(){}});};this.upgradeTeamMember=function(memberid){var log=new MF_Log();log.creator=MF_UserSession.getUser().username;log.creatorName=MF_UserSession.getUser().firstName;log.id=MF_Utils.guidGenerator();log.logtype="MEMBER-UPGRADE-LICENCE";var logdata={licenceowner:MF_UserSession.getUser().username,accountType:MF_UserSession.getUser().accountType};var logMessage=mf_main.logController.getLogMessage(log.logtype,logdata);log.log=logMessage;log.projectid="";var logshared=new MF_LogShared();logshared.creator=MF_UserSession.getUser().username;logshared.creatorName=MF_UserSession.getUser().firstName;logshared.id=MF_Utils.guidGenerator();logshared.projectName="";logshared.projectid="";logshared.logtype=log.logtype;logshared.receiver=memberid;if(logdata!=null&&logdata!=""&&typeof(logdata)=="object"&&Object.keys(logdata).length!=0){logshared.logdata=JSON.stringify(logdata);}MF_LogManager.add(MF_UserSession.getUser().company,log,logshared,{callback:function(){}});};this.logNewMember=function(memberid,logtype,logMessage,projectid,projectName){var log=new MF_Log();log.creator=MF_UserSession.getUser().username;log.creatorName=MF_UserSession.getUser().firstName;log.id=MF_Utils.guidGenerator();log.log=logMessage;log.logtype=logtype;log.projectid=projectid;var logshared=new MF_LogShared();logshared.creator=MF_UserSession.getUser().username;logshared.creatorName=MF_UserSession.getUser().firstName;logshared.id=MF_Utils.guidGenerator();logshared.projectName=projectName;logshared.projectid=projectid;logshared.logtype=log.logtype;logshared.receiver=memberid;MF_LogManager.add(MF_UserSession.getUser().company,log,logshared,{callback:function(){}});};this.logDelMember=function(memberid,projectid,projectName,logMessage){var log=new MF_Log();log.creator=MF_UserSession.getUser().username;log.creatorName=MF_UserSession.getUser().firstName;log.id=MF_Utils.guidGenerator();log.log=logMessage;log.logtype="DEL-MEMBER";log.projectid=projectid;var logshared=new MF_LogShared();logshared.creator=MF_UserSession.getUser().username;logshared.creatorName=MF_UserSession.getUser().firstName;logshared.id=MF_Utils.guidGenerator();logshared.projectName=projectName;logshared.projectid=projectid;logshared.logtype=log.logtype;logshared.receiver=memberid;MF_LogManager.add(MF_UserSession.getUser().company,log,logshared,{callback:function(){}});};this.logSpaceAction=function(cmd,logMessage,data,collaborators){var log=new MF_Log();log.creator=MF_UserSession.getUser().username;log.creatorName=MF_UserSession.getUser().firstName;log.id=MF_Utils.guidGenerator();log.logtype=cmd;log.log=logMessage;log.collaborators=collaborators;log.clientid=MF_UserSession.getUser().company;if(data&&data.spaceid&&data.spacename){log.spaceid=data.spaceid;log.spaceName=data.spacename;}if(data&&data.projectid&&data.projectname){log.projectid=data.projectid;log.projectName=data.projectname;}if(data!=null&&data!=""&&typeof(data)=="object"&&Object.keys(data).length!=0){log.logdata=JSON.stringify(data);}if(mf_main.designSpaceController&&mf_main.designSpaceController.selectedDesignSpace&&mf_main.designSpaceController.selectedDesignSpace.coverArt){log.coverArt=mf_main.designSpaceController.selectedDesignSpace.coverArtImage;}MF_LogManager.logSpaceNotification(MF_UserSession.getUser(),log,{callback:function(){}});};this.getLogMessage=function(logtype,logdata,projectName){var projectname="";if(logdata!=null&&logdata!=""&&typeof(logdata)=="object"&&Object.keys(logdata).length!=0){if(logdata.projectname){projectname=logdata.projectname;}if(logdata.spacename=="Default space"){logdata.spacename="Default";}}else{if(projectName){projectname=projectName;}}var str="";if(logtype!="NEW"){str=str+" has";}if(logtype=="ADDSPACE-MEMBER-EDITOR"){str=str+" added you as Co-Editor to the space: "+logdata.spacename;}if(logtype=="ADDSPACE-MEMBER-REVIEWER"){str=str+" added you as Reviewer to the space: "+logdata.spacename;}if(logtype=="ADDSPACE-MEMBER-ADMIN"){str=str+" added you as Admin to the space: "+logdata.spacename;}if(logtype=="SPACE-MEMBER-EDITOR"){str=str+" changed your role to 'Co-Editor' in the space: "+logdata.spacename;}if(logtype=="SPACE-MEMBER-REVIEWER"){str=str+" changed your role to 'Reviewer' in the space: "+logdata.spacename;}if(logtype=="SPACE-MEMBER-ADMIN"){str=str+" changed your role to 'Admin' in the space: "+logdata.spacename;}if(logtype=="SPACE-RENAMED"){str=str+" renamed the space from "+logdata.oldtitle+" to "+logdata.newtitle;}if(logtype=="SPACE-TRASHED"){str=str+" moved the design space: "+logdata.spacename+" to trash";}if(logtype=="SPACE-DELETED"){str=str+" deleted the design space: "+logdata.spacename;}if(logtype=="SPACE-RESTORED"){str=str+" restored the design space: "+logdata.spacename;}if(logtype=="ADD-SPACE-OWNER"){str=str+" assigned you as 'Space Owner' in the space: "+logdata.spacename;}if(logtype=="SPACE-LEFT"){str=str+" left from the design space: "+logdata.spacename;}if(logtype=="ADD-DESIGNFILE"){str=str+" added design file: "+logdata.projectname+" inside the space "+logdata.spacename;}if(logtype=="ADD-DESIGNFILEVERSION"){str=str+" added new version: "+logdata.version.version+" inside the design file "+logdata.projectname;}if(logtype=="DELETE-DESIGNFILEVERSION"){str=str+" deleted the version: "+logdata.version.version+" inside the design file "+logdata.projectname;}if(logtype=="UPDATE-DESIGNFILESTATUS"){str=str+" updated the design file: "+projectname+" status as "+logdata.status+" in the space "+logdata.spacename;}if(logtype=="ADD-UIDRAWING"){str=str+" added UI Drawing: "+projectname+" inside the space "+logdata.spacename;}if(logtype=="ADD-DESIGNEMBED"){str=str+" added new Design embed: "+projectname+" inside the space "+logdata.spacename;}if(logtype=="SPACE-DEL-MEMBER"){str=str+" removed you from the space: "+logdata.spacename;}if(logtype=="ADD-PINPOWERUP"){str=str+" added new pin powerup: "+projectname+" inside the space "+logdata.spacename;}if(logtype=="UNPINPOWERUP"){str=str+" unpinned the powerup: "+projectname+" inside the space "+logdata.spacename;}if(logtype=="ADD-PINPAGE"){str=str+" pinned the page: "+logdata.pagename+" inside the space "+logdata.spacename;}if(logtype=="UNPINPAGE"){str=str+" unpinned the page: "+logdata.pagename+" inside the space "+logdata.spacename;}if(logtype=="MOVE-PROJECT"){str=str+" moved the "+logdata.projectType+": "+projectname+" from the space "+logdata.spacename+" to another space";}if(logtype=="PROJECT-ARCHIVED"){str=str+" locked the project: "+projectname+" inside the space "+logdata.spacename;}if(logtype=="PROJECT-UNARCHIVED"){str=str+" unlocked the project: "+projectname+" inside the space "+logdata.spacename;}if(logtype=="ITEM-TRASHED"){str=str+" moved the "+logdata.projectType+": "+projectname+" to trash";}if(logtype=="ITEM-RESTORED"){str=str+" restored the "+logdata.projectType+": "+projectname+"  from trash";}if(logtype=="ADD-MEMBER-REVIEWER"){str=str+" added you as Reviewer to the project: "+projectname;}if(logtype=="ADD-MEMBER-EDITOR"){str=str+" added you as Co-Editor to the project: "+projectname;}if(logtype=="ADD-MEMBER-ADMIN"){str=str+" added you as Admin to the project: "+projectname;}if(logtype=="ADD-MEMBER"){str=str+" added you as Team Member";}if(logtype=="MEMBER-UPGRADE"){str=str+" upgraded your account";}if(logtype=="MEMBER-DOWNGRADE"){str=str+" downgraded your account to basic";}if(logtype=="MEMBER-UPGRADE-LICENCE"){var accountType=logdata.accountType.charAt(0).toUpperCase()+logdata.accountType.slice(1);str=str+" upgraded your account to "+accountType;}if(logtype=="MEMBER-UPGRADE-LICENCEROLE"){var displayRole;if(logdata.displayRole=="member"){displayRole="Member";}else{if(logdata.displayRole=="admin"){displayRole="License Admin";}}str=str+" upgraded your license role as "+displayRole;}if(logtype=="DEL-MEMBER"){str=str+" removed you from the project: "+projectname;}if(logtype=="DISABLE-SHARE-MEMBER"){str=str+" disabled sharing with you for the project: "+projectname;}if(logtype=="ENABLE-SHARE-MEMBER"){str=str+" re-enabled sharing with you for the project: "+projectname;}if(logtype=="MEMBER-EDITOR"){str=str+" changed your role to 'Co-Editor' in the project: "+projectname;}if(logtype=="MEMBER-REVIEWER"){str=str+" changed your role to 'Reviewer' in the project: "+projectname;}if(logtype=="MEMBER-ADMIN"){str=str+" changed your role to 'Administrator' in the project: "+projectname;}if(logtype=="COMMENTED"){str=str+" added a comment to the project: "+projectname;}if(logtype=="RATING"){str=str+" rated the project: "+projectname;}if(logtype=="ADD-VARIATION"){str=str+" added a new design variation to the project: "+projectname;}if(logtype=="OWNER"){str=str+" sent a copy of the project: "+projectname;}if(logtype=="CLONED"){str=str+" cloned a copy of the project: "+projectname;}if(logtype=="NEW"){str=str+" : Notifications from other users are displayed here";}if(logtype=="PROJECT-RENAMED"){str=str+" renamed the "+logdata.projectType+" from "+logdata.oldtitle+" to "+logdata.newtitle+" inside the space "+logdata.spacename;}if(logtype=="RENAMED"){str=str+" renamed the project: "+projectname;}if(logtype=="TRASHED"){str=str+" moved the project: "+projectname+" to trash";}if(logtype=="RESTORED"){str=str+" restored the project: "+projectname+"  from trash";}if(logtype=="PROJECT-LEFT"){str=str+" left from the project: "+projectname;}if(logtype=="PROJECT-DELETED"){str=str+" deleted the project: "+projectname;}if(logtype=="PROJECT-DUPLICATE"){str=str+" duplicated the project: "+projectname;}if(logtype=="ZOOMMEETING-CREATE"){str=str+" invited Zoom Meeting for the project: "+projectname;}if(logtype=="DESIGNFILE-COMMENT-ADD"){str=str+" added a comment to the design file: "+projectname;}if(logtype=="DESIGNFILE-COMMENT-ADDREPLY"){str=str+" replied for a comment in the design file: "+projectname;}return str;};}var MF_Utils=(function(){var user=new MF_User();function privateMethod(){}var loadedScriptPaths=[];var loadedCSSPaths=[];return{getUser:function(){return user;},roundUp5:function(v){return Math.ceil(v/5)*5;},sanitizeHTML:function(decoded){decoded=decoded.replace(/<\/?html>/g,"");decoded=decoded.replace(/<\/?head>/g,"");decoded=decoded.replace(/<\/?body>/g,"");decoded=decoded.replace(/<\/?link>/g,"");decoded=decoded.replace(/<\/?meta>/g,"");decoded=decoded.replace(/<\/?iframe>/g,"");decoded=decoded.replace(/<\/?script>/g,"");decoded=decoded.replace(/<\/?font>/g,"");return decoded;},sanitizeHTMLTags:function(decoded){try{var div=document.createElement("div");div.innerHTML=decoded;var remtag=div.getElementsByTagName("iframe");var i=remtag.length;while(i--){remtag[i].parentNode.removeChild(remtag[i]);}remtag=div.getElementsByTagName("embed");var i=remtag.length;while(i--){remtag[i].parentNode.removeChild(remtag[i]);}remtag=div.getElementsByTagName("script");var i=remtag.length;while(i--){remtag[i].parentNode.removeChild(remtag[i]);}remtag=div.getElementsByTagName("object");var i=remtag.length;while(i--){remtag[i].parentNode.removeChild(remtag[i]);}remtag=div.getElementsByTagName("link");var i=remtag.length;while(i--){remtag[i].parentNode.removeChild(remtag[i]);}decoded=div.innerHTML;}catch(e){}return decoded;},scrollToSection:function(containerId,sectionId){var container=$(containerId);var section=$("#"+sectionId);var scrollTo=section.offset().top-container.offset().top+container.scrollTop();container.animate({scrollTop:scrollTo},50);},IsMacPlatform:function(){try{if(window.navigator.platform&&(window.navigator.platform.toLowerCase().indexOf("mac")!=-1)){return true;}else{return false;}}catch(e){}return false;},getIframeHost:function(app){return"https://"+app.toLowerCase()+".mockflow.com";},getCorner:function(pivotX,pivotY,cornerX,cornerY,angle){var x,y,distance,diffX,diffY;diffX=cornerX-pivotX;diffY=cornerY-pivotY;distance=Math.sqrt(diffX*diffX+diffY*diffY);angle+=Math.atan2(diffY,diffX);x=pivotX+distance*Math.cos(angle);y=pivotY+distance*Math.sin(angle);return{x:x,y:y};},getRotatedSize:function(selx,sely,selwidth,selheight,angle){var obj=new Object();var deg=angle;var ar=deg*Math.PI/180;var px=selx+selwidth*0.5;var py=sely+selheight*0.5;var c1=MF_Utils.getCorner(px,py,selx,sely,ar);var c2=MF_Utils.getCorner(px,py,selx+selwidth,sely,ar);var c3=MF_Utils.getCorner(px,py,selx+selwidth,sely+selheight,ar);var c4=MF_Utils.getCorner(px,py,selx,sely+selheight,ar);var bx1=Math.min(c1.x,c2.x,c3.x,c4.x);var by1=Math.min(c1.y,c2.y,c3.y,c4.y);var bx2=Math.max(c1.x,c2.x,c3.x,c4.x);var by2=Math.max(c1.y,c2.y,c3.y,c4.y);obj.x=bx1;obj.y=by1;obj.width=bx2-bx1;obj.height=by2-by1;return obj;},copyToClipBoard:function(){var returnState=false;try{if(document.execCommand("copy")){returnState=true;}}catch(errorMessage){console.log("HTML5 Copy to Clipboard is not supported in your browser");returnState=false;}return returnState;},copyToClipBoard2:function(elementToCopy){elementToCopy.focus();elementToCopy.select();var returnState=false;try{if(document.execCommand("copy")){returnState=true;MF_Utils.display_ActionIndicator("Copied to clipboard");}}catch(errorMessage){console.log("HTML5 Copy to Clipboard is not supported in your browser");returnState=false;}return returnState;},copyToClipBoard3:function(elementToCopy){var range=document.createRange();range.selectNode(document.getElementById(elementToCopy));window.getSelection().removeAllRanges();window.getSelection().addRange(range);document.execCommand("copy");window.getSelection().removeAllRanges();MF_Utils.display_ActionIndicator("Copied to clipboard");},copyToClipBoard4:function(stringToCopy){try{var promise=navigator.clipboard.writeText(stringToCopy);}catch(e){}MF_Utils.display_ActionIndicator("Copied to clipboard");},slideInDown:function(did){$("#tmDialogBackground").show(0,onDivShow);function onDivShow(){$(did).css("display","block");tm_main.interfaceResize();$(did).css({position:"absolute",top:-($(did).height())});$(did).animate({top:0+"px"},{duration:200,complete:function(){}});}},convertUndefinedPropToEmptyString:function(object){for(var key in object){if(typeof object[key]==undefined||object[key]=="undefined"){object[key]="";}}},htmlEscape:function(str){if(str!=""&&str){return String(str).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;");}else{return"";}},htmlUnescape:function(str){if(str!=""&&str){return String(str).replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#x27;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&#x60;/g,"`").replace(/&#x3D;/g,"=");}else{return"";}},loadsScripts:function(path,filePath){var paths=path.map(function(pathItem){pathItem=(filePath||"")+pathItem;if(loadedScriptPaths.includes(pathItem)){return new Promise(function(resolve,reject){resolve();});}else{return new Promise(function(resolve,reject){const script=document.createElement("script");document.body.appendChild(script);script.onload=function(){loadedScriptPaths.push(pathItem);resolve();};script.onerror=reject;script.async=true;script.src=pathItem;});}});return Promise.all(paths);},loadsCSS:function(path,filePath){var paths=path.map(function(pathItem){pathItem=(filePath||"")+pathItem;if(loadedCSSPaths.includes(pathItem)){return new Promise(function(resolve,reject){resolve();});}else{return new Promise(function(resolve,reject){var thirdpartyCss=document.createElement("link");document.getElementsByTagName("head")[0].appendChild(thirdpartyCss);thirdpartyCss.rel="stylesheet";thirdpartyCss.type="text/css";thirdpartyCss.onload=resolve;thirdpartyCss.onerror=reject;thirdpartyCss.href=pathItem;loadedCSSPaths.push(pathItem);});}});return Promise.all(paths);},guidGenerator:function(){var S4=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1);};return"M"+(S4()+S4()+S4()+S4()+S4()+S4()+S4()+S4())+Date.now();},smallGuidGenerator:function(){var uniqueNumber=Date.now();uniqueNumber=uniqueNumber+Math.random();uniqueNumber=uniqueNumber.toString();uniqueNumber=uniqueNumber.replace(".","");uniqueNumber="M"+AlphabeticID.encode(parseInt(uniqueNumber));return uniqueNumber;},resolveUrls:function(feedbackMsg){var resolvedMsg=feedbackMsg;var urlPattern=/\b(https?:\/\/)?[a-zA-Z0-9\/\-:]+(\.[a-z0-9-+&@#\/%?=~_|!:,;]+)+/gi;var protocolList=/^((https?):\/\/)/i;var linkTemplate="<a href='{0}' target='_blank'>{0}</a>";var urlList=urlPattern.exec(feedbackMsg),currentUrl="";while(urlList!==null){currentUrl=urlList[0];if(!protocolList.test(currentUrl)){currentUrl="http://"+currentUrl;}resolvedMsg=resolvedMsg.replace(urlList[0],linkTemplate.replace("{0}",currentUrl).replace("{0}",urlList[0]));urlList=urlPattern.exec(feedbackMsg);}return resolvedMsg;},getParameterByName:function(name,url){if(!url){url=window.location.href;}name=name.replace(/[\[\]]/g,"\\$&");var regex=new RegExp("[?&]"+name+"(=([^&#]*)|&|#|$)"),results=regex.exec(url);if(!results){return null;}if(!results[2]){return"";}return decodeURIComponent(results[2].replace(/\+/g," "));},xmlToString:function(xmlData){var xmlString=null;try{if(window.ActiveXObject){xmlString=xmlData.xml;}else{var oSerializer=new XMLSerializer();xmlString=oSerializer.serializeToString(xmlData[0]);}}catch(e){xmlString="";}return xmlString;},computePoints:function(startType,x,y,width,height){var obj=new Object();if(startType=="topLeft"){obj.startx=x;obj.starty=y;obj.endx=x+width;obj.endy=y+height;}if(startType=="topRight"){obj.startx=x+width;obj.starty=y;obj.endx=x;obj.endy=y+height;}if(startType=="bottomLeft"){obj.startx=x;obj.starty=y+height;obj.endx=x+width;obj.endy=y;}if(startType=="bottomRight"){obj.startx=x+width;obj.starty=y+height;obj.endx=x;obj.endy=y;}return obj;},pointTransform:function(point,center,angle){var theta=angle*(Math.PI/180);point.x-=center.x;point.y-=center.y;return{x:(point.x*Math.cos(theta*-1)+point.y*Math.sin(theta*-1))+center.x,y:(point.x*Math.sin(theta)+point.y*Math.cos(theta))+center.y};},getBooleanString:function(val){if(val){return"true";}else{return"false";}},rotate:function(id,angle){$("#"+id).css("-moz-transform","rotate("+angle+"deg)");$("#"+id).css("-webkit-transform","rotate("+angle+"deg)");$("#"+id).css("-o-transform","rotate("+angle+"deg)");$("#"+id).css("-ms-transform","rotate("+angle+"deg)");$("#"+id).css("transform","rotate("+angle+"deg)");},calculateDimensions:function(startx,starty,endx,endy,delta){var dim=new Object();if(endy>starty){dim.y=starty;dim.height=endy-starty;dim.starty=delta;dim.endy=dim.height+delta;}else{dim.y=endy;dim.height=starty-endy;dim.starty=dim.height+delta;dim.endy=delta;}if(endx>startx){dim.x=startx;dim.width=endx-startx;dim.startx=delta;dim.endx=dim.width+delta;}else{dim.x=endx;dim.width=startx-endx;dim.startx=dim.width+delta;dim.endx=delta;}if(dim.x>startx||dim.x>endx){dim.x=dim.x-dim.width;}if(dim.y>starty||dim.y>endy){dim.y=dim.y-dim.height;}dim.startType="topRight";var sx=dim.startx;var sy=dim.starty;if(sx==delta&&sy==delta){dim.startType="topLeft";}if(sx==(dim.width+delta)&&sy==delta){dim.startType="topRight";}if(sx==delta&&sy==(dim.height+delta)){dim.startType="bottomLeft";}if(sx==(dim.width+delta)&&sy==(dim.height+delta)){dim.startType="bottomRight";}return dim;},trim:function(s){var l=0;var r=s.length-1;while(l<s.length&&s[l]==" "){l++;}while(r>l&&s[r]==" "){r-=1;}return s.substring(l,r+1);},getCheckBoxValue:function(chkID){if($("#"+chkID).is(":checked")){return true;}else{return false;}},localToGlobal:function(_el){var target=_el,target_width=target.offsetWidth,target_height=target.offsetHeight,target_left=target.offsetLeft,target_top=target.offsetTop,gleft=0,gtop=0,rect={};var moonwalk=function(_parent){if(!!_parent){gleft+=_parent.offsetLeft;gtop+=_parent.offsetTop;moonwalk(_parent.offsetParent);}else{return rect={top:target.offsetTop+gtop,left:target.offsetLeft+gleft,bottom:(target.offsetTop+gtop)+target_height,right:(target.offsetLeft+gleft)+target_width};}};moonwalk(target.offsetParent);return rect;},globalToLocalPoint:function(e,elementid){if($("#"+elementid).length){var localoffsetX=$("#"+elementid).offset().left;var localoffsetY=$("#"+elementid).offset().top;var localx=Math.floor(e.pageX-localoffsetX);var localy=Math.floor(e.pageY-localoffsetY);var lpt=new Object();lpt.x=localx;lpt.y=localy;return lpt;}else{var lpt=new Object();lpt.x=0;lpt.y=0;return lpt;}},globalToLocalPoint2:function(x,y,elementid){if($("#"+elementid).length){var localoffsetX=$("#"+elementid).offset().left;var localoffsetY=$("#"+elementid).offset().top;var localx=Math.floor(x-localoffsetX);var localy=Math.floor(y-localoffsetY);var lpt=new Object();lpt.x=localx;lpt.y=localy;return lpt;}else{var lpt=new Object();lpt.x=0;lpt.y=0;return lpt;}},localToGlobalPoint:function(xpt,ypt,elementid){if($("#"+elementid).length){var localoffsetX=$("#"+elementid).offset().left;var localoffsetY=$("#"+elementid).offset().top;var localx=Math.floor(xpt+localoffsetX);var localy=Math.floor(ypt+localoffsetY);var lpt=new Object();lpt.x=localx;lpt.y=localy;return lpt;}else{var lpt=new Object();lpt.x=0;lpt.y=0;return lpt;}},localToGlobalPoint2:function(xpt,ypt,elementid){if($("#"+elementid).length){var localoffsetX=$("#"+elementid).offset().left;var localoffsetY=$("#"+elementid).offset().top;var originalOffset=$("#"+elementid).offset();var scaleFactor=mf_main.editorController.SCALE;var transformationDifference={left:($("#"+elementid).outerWidth()*(scaleFactor-1))/2,top:($("#"+elementid).outerHeight()*(scaleFactor-1))/2};var adjustedOffset={left:originalOffset.left+transformationDifference.left,top:originalOffset.top+transformationDifference.top};var localx=Math.floor(xpt+adjustedOffset.left);var localy=Math.floor(ypt+adjustedOffset.top);var lpt=new Object();lpt.x=localx;lpt.y=localy;return lpt;}else{var lpt=new Object();lpt.x=0;lpt.y=0;return lpt;}},getMonthByName:function(num){var m_names=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");return m_names[num];},htmlEncode:function(val){return $("<div/>").text(val).html();},htmlDecode:function(val){return $("<div/>").html(val).text();},htmlspecialchars_reverse:function(str){if(typeof(str)=="string"){str=str.replace(/&gt;/ig,">");str=str.replace(/&lt;/ig,"<");str=str.replace(/&#039;/g,"'");str=str.replace(/&quot;/ig,'"');str=str.replace(/&amp;/ig,"&");}return str;},isValidURL:function(value){return/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(value);},isValidIFrame:function(str){var pattern=new RegExp(/<iframe(.*)<\/iframe>/g);return !!pattern.test(str);},isValidEmailAddress:function(emailAddress){var pattern2=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);return pattern2.test(emailAddress);},findPos:function(obj){var curleft=curtop=0;if(obj.offsetParent){curleft=obj.offsetLeft;curtop=obj.offsetTop;while(obj=obj.offsetParent){curleft+=obj.offsetLeft;curtop+=obj.offsetTop;}}return[curleft,curtop];},display_ActionIndicator:function(msg,time,awidth){if(mf_main.PINPOWERUP){$("#mfActionIndicator").css({position:"absolute",top:0,left:(($(window).width()/2)-200)});$("#mfActionIndicatorMessage").text(msg);$("#mfActionIndicator").fadeTo("fast",1);}else{var xwidth=400;if(awidth!=null){xwidth=awidth;}$("#mfActionIndicator").width(xwidth);$("#mfActionIndicator").css({position:"absolute",top:0,left:(($(window).width()/2)-($("#mfActionIndicator").width()/2))});$("#mfActionIndicatorMessage").text(msg);$("#mfActionIndicator").fadeTo("fast",1);}var timedisp=2500;if(time!=null){timedisp=time;}setTimeout(function(){$("#mfActionIndicator").css("display","none");},timedisp);return;},display_menu:function(parent,named,e){var menu_element=document.getElementById(named);menu_element.style.display="";menu_element.style.left=e.pageX+"px";menu_element.style.top=e.pageY+"px";if((e.pageY+10+$("#"+named).height())>$(window).height()){menu_element.style.top=(e.pageY-$("#"+named).height())+"px";}return;},hide_menu:function(named){var menu_element=document.getElementById(named);if(menu_element){menu_element.style.display="none";}return;},roundedRect2:function(ctx,x,y,w,h,cornerRadius){cornerRadius=cornerRadius/2;ctx.beginPath();var theta,angle,cx,cy,px,py;if(cornerRadius>Math.min(w,h)/2){cornerRadius=Math.min(w,h)/2;}theta=Math.PI/4;ctx.moveTo(x+cornerRadius,y);ctx.lineTo(x+w-cornerRadius,y);angle=-Math.PI/2;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);ctx.lineTo(x+w,y+h-cornerRadius);angle+=theta;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);ctx.lineTo(x+cornerRadius,y+h);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);ctx.lineTo(x,y+cornerRadius);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);ctx.stroke();return;},roundedRect:function(ctx,x,y,width,height,radius){ctx.beginPath();ctx.moveTo(x,y+radius);ctx.lineTo(x,y+height-radius);ctx.quadraticCurveTo(x,y+height,x+radius,y+height);ctx.lineTo(x+width-radius,y+height);ctx.quadraticCurveTo(x+width,y+height,x+width,y+height-radius);ctx.lineTo(x+width,y+radius);ctx.quadraticCurveTo(x+width,y,x+width-radius,y);ctx.lineTo(x+radius,y);ctx.quadraticCurveTo(x,y,x,y+radius);ctx.stroke();return;},RGBToHex:function(color){if(color.substr(0,1)==="#"){return color;}var digits=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(color);var red=parseInt(digits[2]);var green=parseInt(digits[3]);var blue=parseInt(digits[4]);return"#"+MF_Utils.toHex(red)+MF_Utils.toHex(green)+MF_Utils.toHex(blue);},toHex:function(N){if(N==null){return"00";}N=parseInt(N);if(N==0||isNaN(N)){return"00";}N=Math.max(0,N);N=Math.min(N,255);N=Math.round(N);return"0123456789ABCDEF".charAt((N-N%16)/16)+"0123456789ABCDEF".charAt(N%16);},hexToRGB:function(hex,alpha){alpha=typeof(alpha)!="undefined"?alpha:"1";var rgbObj={red:((hex&16711680)>>16),green:((hex&65280)>>8),blue:((hex&255))};return"rgba("+rgbObj.red+","+rgbObj.green+","+rgbObj.blue+","+alpha+")";},randomInRange:function(min,max){var scale=max-min;return Math.floor(Math.random()*scale+min);},get_gravatar:function(email,size){if(email!=null){var userName=MF_Utils.getMD5(email);var size=size||80;var profileImgUrl=MF_Global.websiteURL()+"userProfileImage.jsp?userName="+userName+"&imageSize="+size+"&email="+email;return profileImgUrl;}return"";},getMD5:function(data){var MD5=function(s){function L(k,d){return(k<<d)|(k>>>(32-d));}function K(G,k){var I,d,F,H,x;F=(G&2147483648);H=(k&2147483648);I=(G&1073741824);d=(k&1073741824);x=(G&1073741823)+(k&1073741823);if(I&d){return(x^2147483648^F^H);}if(I|d){if(x&1073741824){return(x^3221225472^F^H);}else{return(x^1073741824^F^H);}}else{return(x^F^H);}}function r(d,F,k){return(d&F)|((~d)&k);}function q(d,F,k){return(d&k)|(F&(~k));}function p(d,F,k){return(d^F^k);}function n(d,F,k){return(F^(d|(~k)));}function u(G,F,aa,Z,k,H,I){G=K(G,K(K(r(F,aa,Z),k),I));return K(L(G,H),F);}function f(G,F,aa,Z,k,H,I){G=K(G,K(K(q(F,aa,Z),k),I));return K(L(G,H),F);}function D(G,F,aa,Z,k,H,I){G=K(G,K(K(p(F,aa,Z),k),I));return K(L(G,H),F);}function t(G,F,aa,Z,k,H,I){G=K(G,K(K(n(F,aa,Z),k),I));return K(L(G,H),F);}function e(G){var Z;var F=G.length;var x=F+8;var k=(x-(x%64))/64;var I=(k+1)*16;var aa=Array(I-1);var d=0;var H=0;while(H<F){Z=(H-(H%4))/4;d=(H%4)*8;aa[Z]=(aa[Z]|(G.charCodeAt(H)<<d));H++;}Z=(H-(H%4))/4;d=(H%4)*8;aa[Z]=aa[Z]|(128<<d);aa[I-2]=F<<3;aa[I-1]=F>>>29;return aa;}function B(x){var k="",F="",G,d;for(d=0;d<=3;d++){G=(x>>>(d*8))&255;F="0"+G.toString(16);k=k+F.substr(F.length-2,2);}return k;}function J(k){k=k.replace(/rn/g,"n");var d="";for(var F=0;F<k.length;F++){var x=k.charCodeAt(F);if(x<128){d+=String.fromCharCode(x);}else{if((x>127)&&(x<2048)){d+=String.fromCharCode((x>>6)|192);d+=String.fromCharCode((x&63)|128);}else{d+=String.fromCharCode((x>>12)|224);d+=String.fromCharCode(((x>>6)&63)|128);d+=String.fromCharCode((x&63)|128);}}}return d;}var C=Array();var P,h,E,v,g,Y,X,W,V;var S=7,Q=12,N=17,M=22;var A=5,z=9,y=14,w=20;var o=4,m=11,l=16,j=23;var U=6,T=10,R=15,O=21;s=J(s);C=e(s);Y=1732584193;X=4023233417;W=2562383102;V=271733878;for(P=0;P<C.length;P+=16){h=Y;E=X;v=W;g=V;Y=u(Y,X,W,V,C[P+0],S,3614090360);V=u(V,Y,X,W,C[P+1],Q,3905402710);W=u(W,V,Y,X,C[P+2],N,606105819);X=u(X,W,V,Y,C[P+3],M,3250441966);Y=u(Y,X,W,V,C[P+4],S,4118548399);V=u(V,Y,X,W,C[P+5],Q,1200080426);W=u(W,V,Y,X,C[P+6],N,2821735955);X=u(X,W,V,Y,C[P+7],M,4249261313);Y=u(Y,X,W,V,C[P+8],S,1770035416);V=u(V,Y,X,W,C[P+9],Q,2336552879);W=u(W,V,Y,X,C[P+10],N,4294925233);X=u(X,W,V,Y,C[P+11],M,2304563134);Y=u(Y,X,W,V,C[P+12],S,1804603682);V=u(V,Y,X,W,C[P+13],Q,4254626195);W=u(W,V,Y,X,C[P+14],N,2792965006);X=u(X,W,V,Y,C[P+15],M,1236535329);Y=f(Y,X,W,V,C[P+1],A,4129170786);V=f(V,Y,X,W,C[P+6],z,3225465664);W=f(W,V,Y,X,C[P+11],y,643717713);X=f(X,W,V,Y,C[P+0],w,3921069994);Y=f(Y,X,W,V,C[P+5],A,3593408605);V=f(V,Y,X,W,C[P+10],z,38016083);W=f(W,V,Y,X,C[P+15],y,3634488961);X=f(X,W,V,Y,C[P+4],w,3889429448);Y=f(Y,X,W,V,C[P+9],A,568446438);V=f(V,Y,X,W,C[P+14],z,3275163606);W=f(W,V,Y,X,C[P+3],y,4107603335);X=f(X,W,V,Y,C[P+8],w,1163531501);Y=f(Y,X,W,V,C[P+13],A,2850285829);V=f(V,Y,X,W,C[P+2],z,4243563512);W=f(W,V,Y,X,C[P+7],y,1735328473);X=f(X,W,V,Y,C[P+12],w,2368359562);Y=D(Y,X,W,V,C[P+5],o,4294588738);V=D(V,Y,X,W,C[P+8],m,2272392833);W=D(W,V,Y,X,C[P+11],l,1839030562);X=D(X,W,V,Y,C[P+14],j,4259657740);Y=D(Y,X,W,V,C[P+1],o,2763975236);V=D(V,Y,X,W,C[P+4],m,1272893353);W=D(W,V,Y,X,C[P+7],l,4139469664);X=D(X,W,V,Y,C[P+10],j,3200236656);Y=D(Y,X,W,V,C[P+13],o,681279174);V=D(V,Y,X,W,C[P+0],m,3936430074);W=D(W,V,Y,X,C[P+3],l,3572445317);X=D(X,W,V,Y,C[P+6],j,76029189);Y=D(Y,X,W,V,C[P+9],o,3654602809);V=D(V,Y,X,W,C[P+12],m,3873151461);W=D(W,V,Y,X,C[P+15],l,530742520);X=D(X,W,V,Y,C[P+2],j,3299628645);Y=t(Y,X,W,V,C[P+0],U,4096336452);V=t(V,Y,X,W,C[P+7],T,1126891415);W=t(W,V,Y,X,C[P+14],R,2878612391);X=t(X,W,V,Y,C[P+5],O,4237533241);Y=t(Y,X,W,V,C[P+12],U,1700485571);V=t(V,Y,X,W,C[P+3],T,2399980690);W=t(W,V,Y,X,C[P+10],R,4293915773);X=t(X,W,V,Y,C[P+1],O,2240044497);Y=t(Y,X,W,V,C[P+8],U,1873313359);V=t(V,Y,X,W,C[P+15],T,4264355552);W=t(W,V,Y,X,C[P+6],R,2734768916);X=t(X,W,V,Y,C[P+13],O,1309151649);Y=t(Y,X,W,V,C[P+4],U,4149444226);V=t(V,Y,X,W,C[P+11],T,3174756917);W=t(W,V,Y,X,C[P+2],R,718787259);X=t(X,W,V,Y,C[P+9],O,3951481745);Y=K(Y,h);X=K(X,E);W=K(W,v);V=K(V,g);}var i=B(Y)+B(X)+B(W)+B(V);return i.toLowerCase();};var hashVal=MD5(data);return hashVal;},searchObjArray:function(arr,key,val){var indx=-1;for(var i=0;i<arr.length;i++){if((arr[i][key]).toLowerCase()===val.toLowerCase()){indx=i;return indx;}}return indx;},searchObjArrayCollection:function(collection,key,val){var indx=-1;for(var i=0;i<collection.size();i++){var item=collection.getItemAt(i);if((item[key]).toLowerCase()===val.toLowerCase()){indx=i;return indx;}}return indx;},sanitizeSvgData:function(svgData){var idArrayCollection=[];var classArrayCollection=[];var currentTime=new Date().getTime();var tempSvgDivision=$("<div>");tempSvgDivision.append(svgData);var gElements=$(tempSvgDivision).find("g");gElements.each(function(){if($(this).children().length===0){$(this).remove();}});tempSvgDivision.find("[id]").each(function(){$(this).attr("id",function(index,attr){idArrayCollection.push(attr);return attr+"_"+currentTime;});});tempSvgDivision.find("[class]").each(function(){$(this).attr("class",function(index,attr){var classNameArray=[];var classArray=attr.split(" ");classArray.forEach(function(elem,idx){classArrayCollection.push(elem);classNameArray.push(elem+"_"+currentTime);});return classNameArray.join(" ");});});tempSvgDivision.find("style").each(function(){var elem=$(this).text().replace(/ /g,"");for(i=0;i<idArrayCollection.length;i++){elem=elem.replace(new RegExp("#"+idArrayCollection[i]+"{","g"),"#"+idArrayCollection[i]+"_"+currentTime+"{");elem=elem.replace(new RegExp("#"+idArrayCollection[i]+",","g"),"#"+idArrayCollection[i]+"_"+currentTime+",");}for(i=0;i<classArrayCollection.length;i++){elem=elem.replace(new RegExp("."+classArrayCollection[i]+"{","g"),"."+classArrayCollection[i]+"_"+currentTime+"{");elem=elem.replace(new RegExp("."+classArrayCollection[i]+",","g"),"."+classArrayCollection[i]+"_"+currentTime+",");}$(this).text(elem);});var modifiedSvgData=tempSvgDivision.html();for(i=0;i<idArrayCollection.length;i++){modifiedSvgData=modifiedSvgData.replace(new RegExp("url\\(\\#"+idArrayCollection[i]+"\\)","g"),"url(#"+idArrayCollection[i]+"_"+currentTime+")");modifiedSvgData=modifiedSvgData.replace(new RegExp('\\"\\#'+idArrayCollection[i]+'\\"',"g"),'"#'+idArrayCollection[i]+"_"+currentTime+'"');}return modifiedSvgData;},getClosestPoint:function(pathNode,point){var pathLength=pathNode.getTotalLength(),precision=8,best,bestLength,bestDistance=Infinity;for(var scan,scanLength=0,scanDistance;scanLength<=pathLength;scanLength+=precision){if((scanDistance=distance2(scan=pathNode.getPointAtLength(scanLength)))<bestDistance){best=scan,bestLength=scanLength,bestDistance=scanDistance;}}precision/=2;while(precision>0.5){var before,after,beforeLength,afterLength,beforeDistance,afterDistance;if((beforeLength=bestLength-precision)>=0&&(beforeDistance=distance2(before=pathNode.getPointAtLength(beforeLength)))<bestDistance){best=before,bestLength=beforeLength,bestDistance=beforeDistance;}else{if((afterLength=bestLength+precision)<=pathLength&&(afterDistance=distance2(after=pathNode.getPointAtLength(afterLength)))<bestDistance){best=after,bestLength=afterLength,bestDistance=afterDistance;}else{precision/=2;}}}best=[best.x,best.y];best.distance=Math.sqrt(bestDistance);return best;function distance2(p){var dx=p.x-point[0],dy=p.y-point[1];return dx*dx+dy*dy;}},getCompiledTemplate:function(templateId){var cachedTemplate=mf_main.getTemplateFromCache(templateId);if(cachedTemplate==null){var template=Handlebars.compile($("#"+templateId).html());mf_main.addTemplateToCache(templateId,template);return template;}else{return cachedTemplate;}},getDeviceColorScheme:function(){if(window.matchMedia){if(window.matchMedia("(prefers-color-scheme: dark)").matches){return"dark";}else{return"light";}}return"light";},};})();var currentWindow=window;function MF_Main(){var thisClass=this;this.UID=MF_Utils.guidGenerator();this.SPACEID=null;this.PUBLICID="";this.DESIGNMODE=false;this.projectID=null;this.INTEGRATION=false;this.INTEGRATION_TYPE="";this.NEWPROJECT=false;this.integrationData={};this.integrationQueryString={};this.pricingLoaded=false;this.VIEWER=false;this.INTEGRATION_INTERNAL_APP="";this.isAllowedToCreateProject=false;this.PROJECT_COUNT=0;this.prjtitle="";this.slackchannelid=null;this.slackuserid=null;this.trellocardid=null;this.trellouserid=null;this.gid=null;this.gdriveapp=null;this.gcursor=null;this.gemail=null;this.MEETINGMODE=false;this.OPEN_POWERUPID=null;this.PINPOWERUP=false;this.EXPORTMODE=false;this.RENDER=false;this.REVISION=false;this.revisionID=null;this.pageID=null;this.clientID=null;this.COMMENTMODE=false;this.COMPSHOT=false;this.COMPEXPORT=false;this.compID=null;this.workflowController=null;this.pageID=null;this.rtc=new MF_RTC();this.dashboardRtcController=new MF_DashboardRTCController();this.editorController=new MF_EditorController();this.logController=new MF_LogController();this.componentList=new MF_ComponentList();this.pushController=new MF_PushNotificationController();this.powerupInterface=new MF_PowerupInterface();this.isSafari=false;this.PERMISSION="Owner";this.PUBLIC=false;this.PUBLIC_DECRYPT_MODE=false;this.cachedTemplates=new Object();this.MEMFREE=true;this.readonly=false;this.isPowerupOpen=false;this.poweruprefId=null;this.zoomPowerupID="Dbd2f212ab357c39e5b3e367852f77053";this.createPowerupPinPage=false;this.createPowerupPinPageId=null;this.isPowerupEditorCreate=false;this.powerupEditorCreateTitle=null;this.allowBack=false;this.onLoadInterface=function(){if(mf_main.PUBLIC){$("#mfSpaceLoader").css("width","100%");}if(mf_main.SPACEID!=null&&mf_main.SPACEID!=""){mf_main.allowBack=true;if(!mf_main.PUBLIC){$("#mfNavLogoBtn").css("cursor","pointer");$("#mfNavLogoBtn").attr("data-toggle","tooltip");$("#mfNavLogoBtn").attr("data-placement","right");$("#mfNavLogoBtn").attr("data-original-title","Back to Space");$("#mfNavLogoBtn img").attr("src","images/dash/backspace.png");}$("#mfNavLogoBtn").on("mouseover",function(e){$("#mfNavLogoBtn").css("opacity",0.5);});$("#mfNavLogoBtn").on("mouseout",function(e){$("#mfNavLogoBtn").css("opacity",1);});if(!mf_main.PUBLIC){$("#mfNavLogoBtn").on("click",function(e){var stail="";if(mf_main.SPACEID&&mf_main.SPACEID!="null"){stail=mf_main.SPACEID;}else{if(mf_main.editorController&&mf_main.editorController.projectObj){stail=mf_main.editorController.projectObj.spaceId;if(stail==null||stail==""){stail="default";}}}if(mf_main.PUBLIC){location.href="https://mockflow.com";}else{if(mf_main.INTEGRATION){mf_main.openDashboard();}else{location.href=MF_Global.serverURL()+"#/space/"+stail;}}});}}$(window).blur(function(){if(mf_main.editorController){mf_main.editorController.isShift=false;mf_main.editorController.isCtrl=false;}});$(window).focus(function(){if(mf_main.editorController){mf_main.editorController.isShift=false;mf_main.editorController.isCtrl=false;}});$(".mfDummyForm").submit(function(e){e.preventDefault();});dwr.engine.setErrorHandler(thisClass.errorDWRHandler);try{var ua=navigator.userAgent.toLowerCase();if(ua.indexOf("safari")!=-1){if(ua.indexOf("chrome")>-1){}else{thisClass.isSafari=true;}}}catch(e){}if(mf_main.INTEGRATION){$("#mfExportPageRightClick").hide();if(mf_main.INTEGRATION_TYPE=="trello"||mf_main.INTEGRATION_TYPE=="office365"||mf_main.INTEGRATION_TYPE=="jira"||mf_main.INTEGRATION_TYPE=="confluence"||mf_main.INTEGRATION_TYPE=="internal"){currentWindow="#mfEditorWrapperContainer";}window.alert=function(txt){bootbox.alert(txt);};}else{currentWindow=window;}thisClass.rtc.sessionID=MF_Utils.guidGenerator();thisClass.dashboardRtcController.connect();if(thisClass.readonly){thisClass.PERMISSION="Reviewer";}if(mf_main.PUBLIC){$("#mfViewerTopBtns").hide();$("#mfViewerTopTitle").show();$("#mfOpenExportWIREBtn").hide();$("#mfOpenExportHTMLBtn").hide();$("#mfNavLogoBtn").css("cursor","pointer");$("#mfNavLogoBtn").attr("data-original-title","");$("#mfNavLogoBtn").on("click",function(e){window.open("https://mockflow.com");});}$("body").tooltip({animation:false,selector:"[data-toggle=tooltip]"});if(MF_Global.adminAllow()){$(".mfTopMenuSaveStore").show();}if(thisClass.isPowerupOpen){thisClass.PINPOWERUP=true;$("#mfPowerupPublicLoader").show();}$("#mainBody").show();$.address.change(function(event){});$.address.init(function(event){});var pathnames=window.location.hash.substr(1);patharr=new Array();if(pathnames){patharr=pathnames.split("/");}var pageid="";var sidebar="on";for(var i=0;i<patharr.length;i++){var val=patharr[i];if(val=="page"){if((i+1)<=patharr.length){pageid=patharr[i+1];}}if(val=="sidebar"){if((i+1)<=patharr.length){sidebar=patharr[i+1];}}if(val=="powerup"&&mf_main.PUBLIC){if((i+1)<=patharr.length){try{if(window.location!==window.parent.location){mf_main.PINPOWERUP=true;}}catch(e){}$("#mfPowerupPublicLoader").show();mf_main.editorController.powerupController.publicURLPowerupId=patharr[i+1];}}if(val=="powerupdata"&&mf_main.PUBLIC){if((i+1)<=patharr.length){mf_main.editorController.powerupController.publicURLPowerupData=patharr[i+1];}}}if(pageid!=""&&pageid!=null){thisClass.pageID=pageid;}if(sidebar!=""&&sidebar!=null){if(sidebar=="off"){mf_main.editorController.hideNavBar();}}$("ul.jd_menu").jdMenu({onAnimate:onAnimate});$(document).on("click",function(){if(mf_main.editorController&&mf_main.editorController.projectObj){mf_main.editorController.closeCompMode();}$(".dropdowncomp_content").hide();$("ul.jd_menu ul:visible").jdMenuHide();$("#mfCatDropdown").add($("#mfCatInput")).removeClass("open");});function onAnimate(show){if(!mf_main.editorController.pageloaded){return;}if(show){$(this).slideDown(100,"easeInCirc");}else{$(this).fadeOut("fast");}}this.editorController.RENDER=thisClass.RENDER;if(thisClass.REVISION==true){thisClass.VIEWER=true;}if(thisClass.RENDER==true){thisClass.VIEWER=true;thisClass.RENDER=true;}if(thisClass.RENDER==true){$("#mfPageArea").css("background","transparent");$("#mfPageArea").css("float","left");}this.componentList.constructor();this.editorController.constructor();this.pushController.constructor();this.logController.constructor();this.powerupInterface.constructor();this.registerHandlebarHelpers();if(thisClass.PUBLIC){thisClass.viewPublicState();}if(thisClass.RENDER){mf_main.editorController.pageAreaPadding=0;mf_main.editorController.editorHolderPadding=0;$("#mfPageArea").css("padding","0px");thisClass.viewState("render");}else{if(thisClass.VIEWER){thisClass.viewState("revision");}else{thisClass.viewState("editor");}}thisClass.changeUIByPermission();mf_main.interfaceResize();var publicid=MF_Utils.guidGenerator();var privateid=MF_Utils.guidGenerator();thisClass.PUBLICID=publicid;if(thisClass.PUBLIC){}else{MF_Authentication.addFirstSecureKeyHash(MF_UserSession.getUser(),publicid,privateid,{callback:function(str){}});}$(".close").on("click",thisClass.closeHandler);$(document).on("click",".modal-backdrop",thisClass.closeHandler);$("html").on("click",function(event){thisClass.closePopUpHandler(event);$("#mfZoomPopup").hide();});$(".mfTxtLink").on("mouseover",thisClass.txtLinkOver);$(".mfTxtLink").on("mouseout",thisClass.txtLinkOut);$(".mfImgLink").on("mouseover",thisClass.imgLinkOver);$(".mfImgLink").on("mouseout",thisClass.imgLinkOut);thisClass.applyShortcutLabelsByOS();$(document).on("shown.bs.dropdown",function(){try{var $thisDropdown=$(this);var $btn=$thisDropdown.find(".dropdown-toggle");var $menuarr=$thisDropdown.find(".snmenu");for(var j=0;j<$menuarr.length;j++){var njenu=$menuarr[j];if(njenu){$menu=$(njenu);try{var btnOffset=$btn.offset();var spaceBelow=$(window).height()-(btnOffset.top+$btn.outerHeight());var spaceAbove=btnOffset.top;var spaceLeft=btnOffset.left;var spaceRight=$(window).width()-(btnOffset.left+$btn.outerWidth());$menu.css({top:"",bottom:"",left:"",right:""});var ow=$menu.outerWidth();var oh=$menu.outerHeight();if(($menu.offset().top+oh)>(spaceBelow)){$menu.css({top:"auto",bottom:"100%"});}if($menu.offset().left+ow>spaceRight){$menu.css({left:"auto",right:"0"});}}catch(e){}}}}catch(e){}});thisClass.editorController.openEditor(thisClass.projectID);Handlebars.registerHelper("getTitleFromFontAwesomeClass",function(passedString){var theString=passedString.substring(passedString.indexOf("-")+1,passedString.length);return new Handlebars.SafeString(theString);});$('[data-toggle="tooltip"]').tooltip();document.addEventListener("contextmenu",function(e){if(thisClass.editorController.shortcutsFlag){var allow=false;var path=e.path||(e.composedPath&&e.composedPath());if(path){for(var k=0;k<path.length;k++){if(path[k].id&&path[k].id=="mfContainerPage"){allow=true;break;}}}else{allow=true;}if(allow){e.preventDefault();thisClass.editorController.mouseMoving=false;thisClass.editorController.hideSelectionBox();var tx=e.pageX;var ty=e.pageY;if((ty+$(".mfcustom-menu").height())>($(currentWindow).height()+20)){ty=e.pageY-$(".mfcustom-menu").height()-10;}if(ty<0){ty=30;}$(".mfcustom-menu").finish().fadeToggle(50).css({top:ty+"px",left:tx+"px"});}}});$(document).on("mousedown",function(e){if(!$(e.target).parents(".mfcustom-menu").length>0){$(".mfcustom-menu").hide(50);}});$(".mfcustom-menu li").on("click",function(){switch($(this).attr("data-action")){case"duplicate":thisClass.editorController.editManager.duplicateComponent();break;case"pasteinplace":thisClass.editorController.editManager.pasteComponent(true);break;case"savecomp":thisClass.editorController.editManager.saveAsComponent();break;case"undo":thisClass.editorController.editManager.undo();break;case"redo":thisClass.editorController.editManager.redo();break;case"lock":thisClass.editorController.editManager.lockComponent();break;case"unlock":thisClass.editorController.editManager.unLockComponent();break;case"unlockall":thisClass.editorController.editManager.unLockAllComponents();break;case"sendforward":thisClass.editorController.editManager.sendForward();break;case"sendbackward":thisClass.editorController.editManager.sendBackward();break;case"sendfront":thisClass.editorController.editManager.sendFront();break;case"sendback":thisClass.editorController.editManager.sendBack();break;case"selectall":mf_main.editorController.selectAll();break;case"clearselection":mf_main.editorController.clearSelection(true);break;case"comment":mf_main.editorController.commentWireframe();break;case"export":mf_main.editorController.exportWireframe();break;case"exportselected":mf_main.componentList.packController.exportComponentAsImage();break;}$(".mfcustom-menu").hide(100);});$(window).on("mousewheel DOMMouseScroll",function(event){if(event.ctrlKey==true){event.preventDefault();}});$(document).on("mouseenter",".mfiffyTip",function(){var $this=$(this);if(this.offsetWidth<this.scrollWidth&&!$this.attr("title")){$this.tooltip({placement:"bottom"});$this.attr("data-original-title",$this.text()).tooltip("show");}else{$this.tooltip("hide");}});if(mf_main.isPowerupOpen){$("#mfPowerupPublicLoader").show();}};this.applyShortcutLabelsByOS=function(){if(MF_Utils.IsMacPlatform()){$(".mfShrtClss").text("Cmd");$("#mfComponentSearchBox").attr("placeholder","Cmd+K to Search");$("#mfUnSavedBtn").attr("title","Save changes Cmd+S");$("#mfZoomBarPlusBtn").attr("title","Cmd +");$("#mfZoomBarMinusBtn").attr("title","Cmd -");}};this.viewPublicState=function(){$("#mfProjectEditBtn").hide();$("#mfPageSidebarPost").height(180);$("#mfPublicBox").show();$("#mfPublicReplyBox").show();};this.viewState=function(state){if(thisClass.PERMISSION=="Reviewer"||thisClass.PUBLIC){if(state=="editor"){state="viewer";}}if(state=="revision"){document.title="MockFlow WireframePro - Revision Viewer";this.editorController.VIEWER=true;this.editorController.EDITOR=false;$("#mfEditorHeader").hide();$("#mfEditorCompTypes").hide();$("#mfPageActionBar").hide();$("#mfComponentSettings").hide();this.editorController.resizeEditor();}else{if(state=="render"){document.title="MockFlow WireframePro - Viewer";thisClass.editorController.VIEWER=true;thisClass.editorController.EDITOR=false;thisClass.editorController.RENDER=false;$("#mfEditorBackBtn").hide();$("#mfPageManagerArea").hide();$(".mfShowSidebar").hide();mf_main.editorController.showPreview(true);thisClass.interfaceResize();}else{if(state=="viewer"){document.title="MockFlow WireframePro - Viewer";thisClass.editorController.VIEWER=true;thisClass.editorController.EDITOR=false;$("#mfEditorBackBtn").hide();mf_main.editorController.showPreview(true);thisClass.interfaceResize();}else{this.shortcutsFlag=true;this.editorController.VIEWER=false;this.editorController.EDITOR=true;$("#mfViewerHeader").hide();$("#mfEditorHeader").show();this.editorController.showEditor();this.editorController.resizeEditor();this.editorController.startAutoSave();}}}};this.openUpgradeDialog=function(){if(mf_main.INTEGRATION){window.open("https://mockflow.com/pricing","_blank");}else{if(!mf_main.pricingLoaded){mf_main.pricingLoaded=true;$("#mfUpgradePricingFrame").attr("src","https://mockflow.com/pricing?embed=true");}$("#mfUpgradePricingModal").modal();}};this.changeUIByPermission=function(){if(thisClass.PERMISSION=="Editor"){$(".mfTopMenuSharingCls").hide();}if(thisClass.PERMISSION=="Reviewer"||thisClass.PUBLIC){$("#mfProjectEditBtn").hide();}if(mf_main.PUBLIC){$("#mfViewerNavVideoChatBtn").remove();$("#mfViewerNavExportEditBtn").remove();}if(thisClass.INTEGRATION){$(".mfTopMenuSharingCls").hide();$(".mfTopMenuExportPage").hide();$(".mfTopMenuCommentsPage").hide();$("#mfViewerNavVideoChatBtn").remove();$("#mfViewerNavExportEditBtn").remove();$("#mfTopMenuToggleMode").hide();$("#mfTopMenuToggleModeSep").hide();if(mf_main.PERMISSION=="Reviewer"){$("#mfViewerNavExportBtn").remove();$("#mfViewerNavCommentBtn").remove();$("#mfViewerTopTitle").show();}$(".mfPostBtnCls").hide();if(thisClass.INTEGRATION_TYPE=="internal"){$(".mfPostToInternalAppBtn").show();$(".mfPostInternalAppImg").attr("src","images/integration/"+thisClass.INTEGRATION_INTERNAL_APP+".png");}if(thisClass.INTEGRATION_TYPE=="slack"){$(".mfPostToSlackBtn").show();}if(thisClass.INTEGRATION_TYPE=="trello"){$(".mfPostToTrelloBtn").show();}if(thisClass.INTEGRATION_TYPE=="gdocapp"){$(".mfPostToGDocBtn").show();}if(thisClass.INTEGRATION_TYPE=="gdriveapp"){$(".mfPostToGDriveBtn").show();}if(thisClass.INTEGRATION_TYPE=="jira"){$(".mfPostToJIRABtn").show();}if(thisClass.INTEGRATION_TYPE=="office365"){$(".mfPostToOffice365Btn").show();}if(thisClass.INTEGRATION_TYPE=="confluence"){$(".mfPostToConfluenceBtn").show();}if(thisClass.INTEGRATION_TYPE=="figma"){$(".mfPostToFigmaBtn").show();}if(thisClass.INTEGRATION_TYPE=="msteams"||thisClass.INTEGRATION_TYPE=="msteamschannel"){$(".mfPostToMSTeamsBtn").show();}if(thisClass.INTEGRATION_TYPE=="chromeExtension"){$(".mfExtensionDownload").show();$("#mfNavLogoBtn").hide();}}};this.errorDWRHandler=function(){};this.openUpgradeModal=function(){};this.txtLinkOver=function(e){$(this).css("text-decoration","underline");};this.txtLinkOut=function(e){$(this).css("text-decoration","none");};this.imgLinkOver=function(e){$(this).css("opacity",0.5);};this.imgLinkOut=function(e){$(this).css("opacity",1);};this.moveCategoryTop=function(e){};this.addTemplateToCache=function(key,template){this.cachedTemplates[key]=template;};this.getTemplateFromCache=function(key){return this.cachedTemplates[key];};this.closePopUpHandler=function(event){if(mf_main.INTEGRATION&&mf_main.INTEGRATION_TYPE=="jira"){if(event&&!$(event.target).hasClass("mfPostToJIRABtn")&&!$(event.target).hasClass("mfPostJIRAImg")&&$(event.target).closest(".mfPostToJIRABtn").length==0&&$(".mfPostJIRASubMenu").css("display")=="block"){$(".mfPostJIRASubMenu").hide();}}if(mf_main.INTEGRATION&&mf_main.INTEGRATION_TYPE=="figma"){if(event&&!$(event.target).hasClass("mfPostToFigmaBtn")&&!$(event.target).hasClass("mfPostFigmaImg")&&$(".mfPostFigmaSubMenu").css("display")=="block"){$(".mfPostFigmaSubMenu").hide();}}if(event&&event.target.id!="mfStoreFiltersDropdown"&&$(".mfStoreFiltersDropdownWrapper").css("display")=="block"&&$("#mfStoreFiltersBtn").has(event.target).length===0){$("#mfStoreFiltersBtn").removeClass("open");}if(event&&!$(event.target).hasClass("mfPowerupPopupBtn")){$(".mfGroupedPowerupMenu").hide();}};this.addUserLog=function(logtype,log,projectid,internal){try{var email=MF_UserSession.getUser().username;var ip=MF_UserSession.getUser().ipaddress;MF_Authentication.addUserLog(email,ip,logtype,log,projectid,internal,{callback:function(str){}});}catch(e){}};this.closeHandler=function(){thisClass.closeDialog();};this.interfaceResize=function(){if(thisClass.editorController){thisClass.editorController.resizeEditor();}if($("#mfRevisionSidebar").is(":visible")){$("#mfRevisionSidebar").css("height","100%");if($("#mfVideoChatInterface").is(":visible")){$("#mfRevisionSidebar").css("height",$(window).height()-120);}}if(thisClass.editorController.videoChatController&&$("#mfVideoChatAnnotateArrow").css("display")=="block"){thisClass.editorController.videoChatController.textChatController.hideAnnotationPointer();}if(thisClass.editorController.videoChatController&&$("#mfVideoChatAnnotateArrow2").css("display")=="block"){thisClass.editorController.videoChatController.textChatController.hideAnnotationPointer();}thisClass.closePopUpHandler();};this.registerHandlebarHelpers=function(){};this.closeDialog=function(){if(thisClass.PUBLIC_DECRYPT_MODE){if($("#mfPublicUrlKeyModal").length&&$("#mfPublicUrlKeyModal").css("display")=="block"){return;}}$(".mfPopUp").hide();$(".modal").modal("hide");$("#mfCompCategoryDialog").hide();$("#mfRevisionSidebar").hide();};this.openDashboard=function(){if(mf_main.INTEGRATION){if(mf_main.INTEGRATION_TYPE=="office365"){location.href="office365app.jsp"+mf_main.integrationQueryString;}else{if(mf_main.INTEGRATION_TYPE=="confluence"){location.href="confluenceappmain.jsp"+mf_main.integrationQueryString;}else{if(mf_main.INTEGRATION_TYPE=="figma"){location.href="figmaapp.jsp"+mf_main.integrationQueryString;}else{if(mf_main.INTEGRATION_TYPE=="gdocapp"){location.href="gdocapp.jsp"+mf_main.integrationQueryString;}else{if(mf_main.INTEGRATION_TYPE=="gdriveapp"){location.href="gdriveapp.jsp"+mf_main.integrationQueryString;}else{if(mf_main.INTEGRATION_TYPE=="internal"){var publicid=MF_Utils.guidGenerator();var privateid=MF_Utils.guidGenerator();var publicIdRegex=new RegExp(/^\?publicid\=([a-zA-Z0-9]+)\&/);var regxMatches=publicIdRegex.exec(mf_main.integrationQueryString);if(regxMatches&&regxMatches.length>1){mf_main.integrationQueryString=mf_main.integrationQueryString.replace(regxMatches[1],publicid);}MF_Authentication.addSecureKeyHash(MF_UserSession.getUser(),publicid,privateid,{callback:function(str){location.href="internalapp.jsp"+mf_main.integrationQueryString;}});}else{if(mf_main.INTEGRATION_TYPE=="jira"){location.href="jiraappmain.jsp"+mf_main.integrationQueryString;}else{if(mf_main.INTEGRATION_TYPE=="msteams"){location.href="msteamsapp.jsp"+mf_main.integrationQueryString;}else{if(mf_main.INTEGRATION_TYPE=="slack"){location.href="slackapp.jsp"+mf_main.integrationQueryString;}else{if(mf_main.INTEGRATION_TYPE=="trello"){location.href="trelloapp.jsp"+mf_main.integrationQueryString;}}}}}}}}}}}};}function receiveRTS(txt){alert(txt);}jQuery.cachedScript=function(url,options){options=$.extend(options||{},{dataType:"script",cache:true,url:url});return jQuery.ajax(options);};$.getMultiScripts=function(arr,path){var _arr=$.map(arr,function(scr){return $.cachedScript((path||"")+scr);});_arr.push($.Deferred(function(deferred){$(deferred.resolve);}));return $.when.apply($,_arr);};function imgOnLoad(){}jQuery.fn.sortDomElements=(function(){return function(comparator){return Array.prototype.sort.call(this,comparator).each(function(i){this.parentNode.appendChild(this);});};})();$.ui.ddmanager.prepareOffsets=function(t,event){var i,j,m=$.ui.ddmanager.droppables[t.options.scope]||[],type=event?event.type:null,list=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();droppablesLoop:for(i=0;i<m.length;i++){if(m[i].options.disabled||(t&&!m[i].accept.call(m[i].element[0],(t.currentItem||t.element)))){continue;}for(j=0;j<list.length;j++){if(list[j]===m[i].element[0]){m[i].proportions().height=0;continue droppablesLoop;}}m[i].visible=m[i].element.css("display")!=="none";if(!m[i].visible){continue;}if(type==="mousedown"){m[i]._activate.call(m[i],event);}m[i].offset=m[i].element.offset();m[i].proportions({width:m[i].element[0].offsetWidth*mf_main.editorController.SCALE,height:m[i].element[0].offsetHeight*mf_main.editorController.SCALE});}};String.prototype.replaceAll=function(search,replacement){var target=this;return target.split(search).join(replacement);};if(typeof Object.assign!="function"){(function(){Object.assign=function(target){if(target===undefined||target===null){throw new TypeError("Cannot convert undefined or null to object");}var output=Object(target);for(var index=1;index<arguments.length;index++){var source=arguments[index];if(source!==undefined&&source!==null){for(var nextKey in source){if(source.hasOwnProperty(nextKey)){output[nextKey]=source[nextKey];}}}}return output;};})();}function MF_EditorController(){this.SHOWGUIDELINES=true;this.SPECMODE=false;this.CROPMODE=false;this.rotated=false;this.pageAreaPadding=40;this.editorHolderPadding=50;this.layerPanelOpen=false;this.selectedFontComp=null;this.selectedByocComp=null;this.byocEditorChanged=false;this.openWizardOnLoad=false;this.isWizardActive=false;this.byocCodeEditor=null;this.byocEditorLoaded=false;this.autoSaveCounter=0;this.VISIBLE_OBSERVE=true;this.autoSaveStarted=false;this.lastOpenViewerContent="mfViewerNavPagesBtn";this.cachedDBComponents=new Object();this.settingsByCompType=new Object();this.pageEditorLocked=false;this.iobserver=null;this.teamClientList=null;this.currentPageID=null;this.powerupCallback=null;this.powerupCallbackOptions=null;this.currentSelectModeState=null;this.lastShotTime=0;this.PINPOWERUP=false;this.tempRememberGroup=new Object();this.dbComponentsWireframe=new Array();this.saveAsWireframeMode=false;this.RESTRICT_SIZE=false;this.RESTRICT_SIZE_LIMIT=4000;this.SELECTMODE=false;this.SELECTMODE_TYPE="";this.grid=null;this.showLinks=true;this.showAnnotations=true;this.startDDoffsetX=0;this.startDDoffsetY=0;this.renderImages=new Array();this.renderImageAssigned=false;this.currentGroupEdit=null;this.currentNavBarEditorShown="mfNavElementBtn";this.ctop=0;this.cleft=0;this.loadedPages=new Array();this.pageOrder=new Array();this.clicks=0;this.clicktimer=null;this.clickDELAY=200;this.editingComponent=false;this.editingComponentDiv=null;this.curYPos=0,this.curXPos=0;this.autoSize=false;this.leftMargin=320;this.dragSelector=null;this.sidebarShowVal=true;this.beforeMoveX=0;this.beforeMoveY=0;this.EDITOR=true;this.VIEWER=false;this.RENDER=false;this.SKETCHLOADED=false;this.SCALE=1;this.transformDragType="start";this.rememberToggleSettings=new Object();this.rememberToggleSpecs=new Object();this.projectObj=null;this.movedObject=false;this.timer=null;this.saveTimer=null;this.shortcutsFlag=false;this.page=null;this.componentSelect=new Array();this.selectorResize=null;this.selectorTransformStart=null;this.selectorTransformEnd=null;this.selectorTransformPath=null;this.viewerHeight=0;this.viewerWidth=0;this.editManager=new MF_EditManager();this.lastTextEditComp=null;this.hbox=null;this.wbox=null;this.movePagePosX=null;this.movePagePosY=null;this.oldPagePosX=null;this.oldPagePosY=null;this.pageDragging=false;this.pagePanning=false;this.viewerShortcuts=false;this.selectedComponent=null;this.mouseStartX=0;this.mousestartY=0;this.maxDx=0;this.maxDy=0;this.offsetMousex=0;this.offsetMousey=0;this.rotateOffset=0;this.offsetYPos=0;this.offsetXPos=0;this.lastSetting=null;this.settingManualPlace=false;this.settingPosX=0;this.settingPosY=0;this.specController=null;this.revisionController=new MF_RevisionController();this.gridController=new MF_GridController();this.exportController=new MF_ExportController();this.fontController=new MF_FontController();this.pageController=new MF_PageController();this.layersController=new MF_LayersController();this.pageLinkController=new MF_PageLinkController();this.pageMultiLinkController=new MF_PageMultiLinkController();this.iconAssignController=new MF_IconAssignController();this.storeController=new MF_StoreController();this.designStoreController=new MF_DesignStoreController();this.favouriteColorController=new MF_FavouriteColorController();this.imageController=new MF_ImageController();this.drawController=new MF_DrawController();this.powerupController=new MF_PowerupController();this.powerupStoreController=new MF_PowerupStoreController();this.contentEditController=new MF_ContentEditorController();this.commentController=new MF_CommentController();this.textChatController=new MF_TextChatController();this.aiManagerController=new MF_AIManagerController();this.aiToolsController=new MF_AIToolsController();this.videoChatController=null;this.highlightViewerLinks=new Array();this.isCtrl=false;this.isShift=false;this.isDrag=false;this.transformDrag=false;this.canSave=false;this.globalSelect=null;this.pageloaded=true;var thisClass=this;this.resized=false;this.selectorDragged=false;this.original={top:0,left:0};this.originalLocal=new Object();this.mouseMoving=false;this.onGlobalSelect=false;this.lastOpenedMfPopUp=null;this.exportMode=false;this.compMode=false;this.compModeType=null;this.pluskeyCode="187";this.minusKeyCode="189";this.videoChatInterfaceHeight=0;this.gridEditor=null;this.gest_scale=1;this.gestureStartScale=1;this.powerupData=new Object();this.constructor=function(){window.addEventListener("gesturestart",function(e){e.preventDefault();thisClass.gestureStartScale=thisClass.gest_scale;});window.addEventListener("gesturechange",function(e){e.preventDefault();if($("#mfPageGridInterface").css("display")=="block"&&$("#mfPageSiteMapView").css("display")=="block"){thisClass.pageController.sitemapController.pinchToZoomGestureChange(e);}else{if($("#mfStoreInterface").css("display")=="block"&&$("#mfStoreTemplateViewer").css("display")=="block"){thisClass.storeController.pinchToZoomGestureChange(e);}else{if($("#mfImageEditorInterface").css("display")=="block"){thisClass.imageController.imageEditorController.pinchToZoomGestureChange(e);}else{thisClass.gest_scale=thisClass.gestureStartScale*e.scale;if(thisClass.gest_scale>=0.1&&thisClass.gest_scale<=3){if(thisClass.page&&$("#mfPageLoader").css("display")=="none"){thisClass.SCALE=thisClass.gest_scale;thisClass.zoomPage();}return false;}else{return false;}}}}});window.addEventListener("gestureend",function(e){e.preventDefault();});try{window.addEventListener("wheel",function(e){if($("#mfPageGridInterface").css("display")=="block"&&$("#mfPageSiteMapView").css("display")=="block"){thisClass.pageController.sitemapController.pinchToZoom(e);}else{if($("#mfStoreInterface").css("display")=="block"&&$("#mfStoreTemplateViewer").css("display")=="block"){thisClass.storeController.pinchToZoom(e);}else{if($("#mfImageEditorInterface").css("display")=="block"){thisClass.imageController.imageEditorController.pinchToZoom(e);}else{thisClass.pinchToZoom(e);}}}},{passive:false});}catch(e){}$("#mfPageManagerArea").mouseover(function(e){if(!thisClass.EDITOR){thisClass.viewerShortcuts=false;}});$(".mfWarningLinkCls").on("click",function(e){mf_main.closeDialog();});$(".mfPopUpCloseBtn").on("click",function(e){$(".mfPopUp").hide();});$("#mfRTCEditorLock").on("wheel",function(e){var o=e.originalEvent;$("#mfEditorHolder").scrollTop($("#mfEditorHolder").scrollTop()+o.deltaY);$("#mfEditorHolder").scrollLeft($("#mfEditorHolder").scrollLeft()+o.deltaX);});$(".mftooltip").tooltip({animation:false});$("#mfProjectEditBtn").on("click",thisClass.editProjectHandler);$("#mfSaveBYOCCode").on("click",thisClass.saveBYOC);$("#mfPickImageBYOC").on("click",thisClass.pickImageBYOC);$("#mfNavLayersBtn").on("click",thisClass.openLayersHandler);$("#mfCloseLayers").on("click",thisClass.openLayersHandler);$("#mfUnSavedBtn").on("click",thisClass.saveProject);$("#mfViewerCommentNumBtn").on("click",thisClass.openCommentHandler);if(mf_main.PUBLIC){$("#mfPublicKeyApply").on("click",thisClass.decryptPublicProject);$("#mfPublicUrlKeyModal").on("shown",function(){$("#mfPublicUrlKeyVal").focus();});$("#mfPublicUrlKeyVal").on("keypress",function(event){if(event.which=="13"){thisClass.decryptPublicProject();}});}$("#mfEditorHolder").on("scroll",thisClass.pageScrollHandler);$("#mfEditorPreviewBtn").on("click",thisClass.showPreview);$("#mfEditorBackBtn").on("click",thisClass.showEditor);$(".mfEditorSaveBtnCls").on("click",thisClass.saveHandler);$("#mfNavbarZoomBtn").on("click",thisClass.showZoomPopup);$("#mfGenerateRevisionPreviewBtn").on("click",thisClass.openWireframeHandler);$("#mfGroupEditingNotifier").on("click",thisClass.closeGroupEditing);$(".mfGradientExchange").on("click",thisClass.exchangeGradientColor);$(".mfRotateComponentBtn").on("click",thisClass.rotateComponent);$("#mfRTCEditorLock").on("click",thisClass.hideRTCMessage);$(".mfCommonCompUL li").on("click",thisClass.selectCompMode);$("#mfToggleLinkHighlight").click(thisClass.toggleLinkHighlighter);$("#mfToggleAnnotations").click(thisClass.toggleAnnotationsHandler);$(".mfWireCompToolbarCls").mouseout(function(){$(".mfGroupedTooltipMenu").hide();});$(".mfDsgnCompToolbarCls").mouseout(function(){$(".mfGroupedTooltipMenu").hide();});$("#mfGroupedAnnotation").mouseover(function(){$(".mfGroupedAnnotationMenu").show();});$("#mfGroupedIcon").mouseover(function(){$(".mfGroupedIconMenu").show();});$("#mfGroupedShapes").mouseover(function(){$(".mfGroupedShapesMenu").show();});$("#mfGroupedShapesDsgn").mouseover(function(){$(".mfGroupedShapesMenuDsgn").show();});$("#mfGroupedArrow").mouseover(function(){$(".mfGroupedArrowMenu").show();});$("#mfGroupedText").mouseover(function(){$(".mfGroupedTextMenu").show();});thisClass.layersController.constructor();thisClass.editManager.constructor();thisClass.revisionController.constructor();thisClass.gridController.constructor();thisClass.exportController.constructor();thisClass.fontController.constructor();thisClass.pageController.constructor();thisClass.pageLinkController.constructor();thisClass.pageMultiLinkController.constructor();thisClass.iconAssignController.constructor();thisClass.imageController.constructor();thisClass.commentController.constructor();thisClass.textChatController.constructor();thisClass.storeController.constructor();thisClass.designStoreController.constructor();thisClass.drawController.constructor();thisClass.favouriteColorController.constructor();thisClass.powerupController.constructor();thisClass.powerupStoreController.constructor();thisClass.contentEditController.constructor();thisClass.aiManagerController.constructor();thisClass.aiToolsController.constructor();thisClass.initEditor();thisClass.keyShortcutHandler();$(".mfWizardSelectPowerupItem").click(thisClass.selectWizardPowerup);$("#mfComponentSettingsDiv").on("click",[".mfTextTypeCls",".mfLinkCls"],function(e){e.stopImmediatePropagation();if($(e.target).hasClass("mfTextTypeCls")){$("#mffontusedbtn").click();thisClass.showPopUp(e,$("#mfFontSelectionPopUp"));}else{if($(e.target).hasClass("mfLinkCls")&&!$(e.target).hasClass("mfNavAddItemCls")){thisClass.showPopUp(e,$("#mfLinkSelectionPopUp"));}}});$("input[type='text']").on("focusin",function(){if(thisClass.EDITOR&&mf_main.editorController){mf_main.editorController.disableShortcuts();}});$("input[type='text']").on("focusout",function(){if(thisClass.EDITOR&&mf_main.editorController&&thisClass.lastTextEditComp){mf_main.editorController.enableShortcuts();}});$("textarea").on("focusin",function(e){if(e.currentTarget&&e.currentTarget.id=="mfclipboard"){return;}if(thisClass.EDITOR&&mf_main.editorController){mf_main.editorController.disableShortcuts();}});$("textarea").on("focusout",function(){if(thisClass.EDITOR&&mf_main.editorController&&thisClass.lastTextEditComp){mf_main.editorController.enableShortcuts();}});$("#mfNavAIToolsBtn").on("click",thisClass.openNavBar);$(".mfNavBarButton").on("click",thisClass.openNavBar);$(".mfViewerNavBarButton").on("click",thisClass.openNavBar);$("#mfPageManagerArea").on("click","#mfNavbarToggleBtn",thisClass.hideNavBar);$(".mfShowSidebar").on("click",thisClass.showNavBar);$("#mfViewerNavVideoChatBtn").on("click",thisClass.textChatController.toggleTextChatHandler);var sidebarTogg=MF_Utils.getParameterByName("sidebar");if(sidebarTogg&&sidebarTogg==="off"){thisClass.hideNavBar(new Event(""));}window.addEventListener("dragover",function(e){e.preventDefault();},false);window.addEventListener("drop",function(e){e.preventDefault();},false);$("#mfBYOCEditor").on("hide.bs.modal",function(e){if(thisClass.byocEditorChanged){e.preventDefault();var ans=confirm("There are unsaved changes. Do you want to close without saving ?");if(ans){$("#mfBYOCPreview").scrollTop(0);$("#mfBYOCPreview").scrollLeft(0);thisClass.byocEditorChanged=false;mf_main.closeDialog();}else{e.stopImmediatePropagation();}}else{$("#mfBYOCPreview").scrollTop(0);$("#mfBYOCPreview").scrollLeft(0);}});};this.openBYOCeditor=function(comp){thisClass.byocEditorChanged=false;thisClass.selectedByocComp=comp;thisClass.displayBYOCPreview();$("#mfBYOCEditorCodeMirror").scrollTop(0);$("#mfBYOCEditorCodeMirror").scrollLeft(0);$("#mfBYOCPreview").scrollTop(0);$("#mfBYOCPreview").scrollLeft(0);$("#mfBYOCEditor").modal();};this.openWizard=function(){if(MF_UserSession.getUser()&&MF_UserSession.getUser().isBasic){$(".mfWizardtailwindBtn,.mfWizardAMPBtn").css("opacity",0.5);}$("#mfWizardStartupModal").modal();};this.setDesignMode=function(){if(mf_main.DESIGNMODE){mf_main.componentList.maincompjson="designer.json";$(".mfWireCompToolbarCls").hide();$(".mfDsgnCompToolbarCls").show();$("#mfChangeSizeToolbarBtn").show();$("#mfAIToolWizardBtn").hide();$("#mfAIToolBYOCBtn").hide();$("#mfIllustrationListBtn2").hide();$("#mfIconListBtn2").hide();$(".mfGetCustomPackBtn").hide();$(".mfNewCustomPackBtn").hide();$("#mfOpenExportHTMLBtn").hide();$("#mfExportSectionPowerupDiv").hide();$("#mfSpecModePowerupList").hide();$(".mfPowerupPopupBtn").hide();$(".mfNewMergePackBtn").hide();$("#mfImageUploadPowerupBtn").show();$(".mfPowerupTopMenuCls").hide();$("#mfPowerupTopMenuDesigner").show();if(thisClass.EDITOR){$("#mfNavPowerupBtn").hide();$("#mfNavStoreBtn").hide();$("#mfNavIllustrationsBtn").show();$("#mfNavIconsBtn").show();$("#mfNavTemplatesBtn").show();}if(thisClass.VIEWER){$("#mfViewerNavPowerupBtn").hide();$("#mfNavIllustrationsBtn").hide();$("#mfNavIconsBtn").hide();$("#mfNavTemplatesBtn").hide();}}else{$("#mfNavIllustrationsBtn").hide();$("#mfNavIconsBtn").hide();$("#mfNavTemplatesBtn").hide();}};this.selectWizardPowerup=function(){var pid=$(this).attr("data-powerupid");if(MF_UserSession.getUser()&&MF_UserSession.getUser().isBasic){if(pid=="D5474c08ea83f8574120d033473e217de"||pid=="Dbc6fd25a55de1e82b7f2567ed4eec0f3"){MF_Utils.display_ActionIndicator("This UI Builder is not available for Basic plan, start with Bootstrap");return false;}}thisClass.isWizardActive=true;mf_main.editorController.powerupController.openPowerupbyID(pid);};this.pickImageBYOC=function(){MF_Utils.display_ActionIndicator("HTML code saved successfully");thisClass.saveBYOC(true);MF_Utils.display_ActionIndicator("Select image to copy its link");mf_main.editorController.openNavBarContent("mfNavImagesBtn");mf_main.editorController.imageController.byocLinkEditorMode=true;mf_main.editorController.imageController.component=thisClass.selectedByocComp;};this.saveBYOC=function(noclose){mf_main.editorController.enableShortcuts();thisClass.byocEditorChanged=false;var txt=thisClass.byocCodeEditor.getCode();try{txt=MF_Utils.sanitizeHTML(txt);txt=MF_Utils.sanitizeHTMLTags(txt);}catch(e){}txt=MF_Utils.htmlEncode(txt);if(txt!=thisClass.selectedByocComp.text){thisClass.selectedByocComp.e2xml.addPropSingle("text",txt);thisClass.selectedByocComp.render(true);mf_main.editorController.reStackComponents();if(thisClass.lastSetting&&thisClass.lastSetting.component&&thisClass.lastSetting.component.NAME=="MF_BYOC"){thisClass.lastSetting.updateHTMLdata(txt);}}mf_main.closeDialog();MF_Utils.display_ActionIndicator("HTML code saved successfully");if(!noclose){thisClass.clearSelection();}};this.displayBYOCPreviewCompEnc=function(txt){thisClass.byocEditorChanged=true;try{txt=MF_Utils.sanitizeHTML(txt);txt=MF_Utils.sanitizeHTMLTags(txt);}catch(e){}txt=MF_Utils.htmlEncode(txt);thisClass.displayBYOCPreviewComp(txt);};this.displayBYOCPreviewComp=function(val){$("#mfBYOCPreview").empty();var rectCode='<iframe  sandbox="allow-same-origin allow-scripts" id="mfBYOCPreviewComp"  style="pointer-events: none; background: transparent; border: none; outline: none; -webkit-transform: translateZ(0); box-sizing: border-box;   padding: 0px;  margin: 0px;   width:'+(thisClass.selectedByocComp.width).toString()+"px; height:"+(thisClass.selectedByocComp.height).toString()+'px; top: 0px; left: 0px; " > ';rectCode=rectCode+"</iframe>";$("#mfBYOCPreview").append(rectCode);var fontFamily=mf_main.editorController.fontController.getFontByIDComponent(thisClass.selectedByocComp.fontType,thisClass.selectedByocComp);$("#mfBYOCPreviewComp").css("font-family",fontFamily);var decoded=$("<div/>").html(val).text();if(mf_main.FILEMODE){decoded=decoded.replace("/mfvar/mffolders",mf_main.fileProjDir);}try{decoded=MF_Utils.sanitizeHTML(decoded);decoded=MF_Utils.sanitizeHTMLTags(decoded);}catch(e){}var fontobj=mf_main.editorController.fontController.getFontByID(thisClass.selectedByocComp.fontType);var fonturl="";if(fontobj){if(fontobj.embedded){fonturl='<link type="text/css" href="css/fonts/'+fontobj.id+'/stylesheet.css" rel="stylesheet">';}else{if(fontobj.isCustomFont){fonturl='<link type="text/css" href="'+MF_Global.getS3CdnURL()+"app/wireframepro/company/"+fontobj.clientid+"/projects/"+fontobj.projectid+"/fonts/"+fontobj.customFontId+'.css" rel="stylesheet">';}}}else{var gfont=fontFamily.replaceAll(" ","+");fonturl='<link type="text/css" href="https://fonts.googleapis.com/css2?family='+gfont+'" rel="stylesheet">';}if(thisClass.fontType=="sourcesanspro"){fonturl='<link type="text/css" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,300italic,regular,italic,600,700,700italic,900" rel="stylesheet">';}var tailwindurl="";if(thisClass.selectedByocComp.tailwindVersion!="none"){tailwindurl="<script type='text/javascript' src=\"https://d20hhedk3h2l88.cloudfront.net/apps/wireframepro/external/js/tailwind.3.0.0.min.js\"><\/script>";}decoded='<html style="height: calc(100% - 22px);  min-height:calc(100% - 22px) !important; margin: 0px; padding: 10px;  "><head>'+fonturl+tailwindurl+"<style> body, input, textarea, button {font-family: "+fontFamily+'; overflow: hidden;} </style></head><body style=" height: 100%;min-height: 100% !important; margin: 0px; padding: 0px; overflow: hidden;">'+decoded+"</body></html>";$("#mfBYOCPreviewComp").attr("srcdoc",decoded);};this.displayBYOCPreview=function(val){thisClass.displayBYOCPreviewComp(thisClass.selectedByocComp.text);thisClass.disableShortcuts();var decoded=$("<div/>").html(thisClass.selectedByocComp.text).text();if(thisClass.byocEditorLoaded==false){$(".mfBYOCEditorCls").hide();$("#mfBYOCEditorLoader").show();MF_Utils.loadsScripts(["js/external/codeflask.min.js","js/external/prism.min.js"]).then(function(){$(".mfBYOCEditorCls").hide();$("#mfBYOCEditorCode").show();thisClass.byocEditorLoaded=true;thisClass.byocCodeEditor=new CodeFlask("#mfBYOCEditorCodeMirror",{language:"js"});thisClass.byocCodeEditor.updateCode(decoded);thisClass.byocCodeEditor.onUpdate(function(value){return thisClass.displayBYOCPreviewCompEnc(value);});},function(e){alert("err2"+e);});}else{thisClass.byocCodeEditor.updateCode(decoded);setTimeout(function(){$(".codeflask__textarea").scrollTop(0);$(".codeflask__textarea").scrollLeft(0);},500);}};this.pinchToZoom=function(e){if(e.ctrlKey){e.preventDefault();e.stopPropagation();thisClass.gest_scale-=e.deltaY*0.01;if(thisClass.gest_scale>=0.1&&thisClass.gest_scale<=3){if(thisClass.page&&$("#mfPageLoader").css("display")=="none"){thisClass.SCALE=thisClass.gest_scale;thisClass.zoomPage();}return false;}else{return false;}}};this.enableCropMode=function(){thisClass.CROPMODE=true;if(mf_main.editorController.selectorResize){mf_main.editorController.selectorResize.enableCropMode();}};this.disableCropMode=function(){if(thisClass.CROPMODE){thisClass.CROPMODE=false;if(mf_main.editorController.selectorResize){mf_main.editorController.selectorResize.disableCropMode();}if(thisClass.lastSetting&&thisClass.lastSetting.component&&thisClass.lastSetting.component.NAME=="MF_ImageComp"&&!thisClass.lastSetting.component.transformLock){try{thisClass.lastSetting.closeCrop();}catch(e){}}}};this.pinchToZoom=function(e){if(e.ctrlKey){e.preventDefault();e.stopPropagation();thisClass.gest_scale-=e.deltaY*0.01;if(thisClass.gest_scale>=0.1&&thisClass.gest_scale<=3){if(thisClass.page&&$("#mfPageLoader").css("display")=="none"){thisClass.SCALE=thisClass.gest_scale;thisClass.zoomPage();}return false;}else{return false;}}};this.selectCompMode=function(e){e.stopImmediatePropagation();if(!mf_main.editorController.pageloaded){return;}if(mf_main.editorController.pageEditorLocked){return;}$(".mfGroupedIconMenu,.mfGroupedAnnotationMenu,.mfGroupedArrowMenu,.mfGroupedTextMenu,.mfGroupedShapesMenu,.mfGroupedShapesMenuDsgn").hide();var comp=$(this).attr("data-comp");if(comp=="MF_Freehand"){thisClass.drawController.toggleDrawMode();}else{if(comp=="MF_Icon"){if($("#mfSvgIconSelectionPopUp").css("display")=="block"){$("#mfSvgIconSelectionPopUp").hide();}else{thisClass.closeCompMode();thisClass.clearSelection(true);mf_main.componentList.addIconMode=true;mf_main.componentList.svgIconListHandler(e);}}else{if(comp=="MF_Illustration"){if($("#mfSvgIllustrationSelectionPopUp").css("display")=="block"){$("#mfSvgIllustrationSelectionPopUp").hide();}else{thisClass.closeCompMode();thisClass.clearSelection();mf_main.componentList.addIconMode=true;mf_main.componentList.svgIllustrationListHandler(e);}}else{if(comp=="mfGroupedAnnotationMenu"){$(".mfGroupedAnnotationMenu").show();}else{if(comp=="mfGroupedIconMenu"){$(".mfGroupedIconMenu").show();}else{if(comp=="mfGroupedShapesMenu"){$(".mfGroupedShapesMenu").show();}else{if(comp=="mfGroupedShapesMenuDsgn"){$(".mfGroupedShapesMenuDsgn").show();}else{if(comp=="mfGroupedArrowMenu"){$(".mfGroupedArrowMenu").show();}else{if(comp=="mfGroupedTextMenu"){$(".mfGroupedTextMenu").show();}else{if(comp=="MF_BYOC"){if(MF_UserSession.getUser()&&MF_UserSession.getUser().isBasic){var ans=confirm("BYOC is not available in basic plan. Learn more about BYOC?");if(ans){window.open("https://support.mockflow.com/article/236-about-byoc","_blank");}return;}}MF_Utils.display_ActionIndicator("Now draw the component on page");$("#mfEditorHolder").css("cursor","crosshair");thisClass.compMode=true;thisClass.compModeType=comp;thisClass.clearSelection(true);thisClass.makeAllCompsInActive("setcompmode");}}}}}}}}}};this.internalLinkSelectModeDown=function(e){e.stopImmediatePropagation();};this.internalLinkSelectModeUp=function(e){if(mf_main.editorController.SELECTMODE){var origcomp=null;for(var k=0;k<mf_main.editorController.loadedPages.length;k++){var page=mf_main.editorController.loadedPages[k];if(page){var selector=page.getSelector($(this).attr("id"));if(selector&&selector.component){$(".mfCompSelectorCls").css("border","none");if(mf_main.editorController.SELECTMODE_TYPE=="internallink"){if(thisClass.pageLinkController.component.GROUP){var gselector=thisClass.page.groupManager.groupSelectors[thisClass.pageLinkController.component.GROUPID];if(gselector){origcomp=gselector;}}else{origcomp=thisClass.pageLinkController.component.selector;}if(selector.component.eid==thisClass.pageLinkController.component.eid){MF_Utils.display_ActionIndicator("Error! Cannot select the same component as the link");}else{MF_Utils.display_ActionIndicator("Internal link has been saved");if(selector.component.lid==null||selector.component.lid==""){selector.component.lid="lnk_"+thisClass.guidGenerator();}var lname=selector.component.LABEL;if($.trim($("#mfInternalURL").val())!=""){lname=$("#mfInternalURL").val();}thisClass.pageLinkController.saveInternalLinkHandler(selector.component.lid+"|--::--|"+lname);}}if(mf_main.editorController.SELECTMODE_TYPE=="powerup-specsmode"){if(selector.component){var comppath=MF_Global.getSpecPath();try{MF_Utils.loadsScripts([comppath+selector.component.NAME+".js"]).then(function(script,textStatus){var specsName=selector.component.NAME+"Specs";var specs=new window[specsName]();specs.component=selector.component;var csscode=null;if(specs.hasOwnProperty("getCSSCode")){csscode=specs.getCSSCode();if(csscode){csscode=csscode.replaceAll("<br/>","");}}thisClass.powerupCallback(csscode);},function(){thisClass.powerupCallback();});if(thisClass.powerupCallbackOptions&&thisClass.powerupCallbackOptions.isEnableSelectMode){thisClass.powerupCallPageReset();}}catch(e){alert("Error occurred2 "+e);}}}if(mf_main.editorController.SELECTMODE_TYPE=="powerup-selectedcomponent"){if(selector.component){try{var compStr=JSON.stringify(selector.component,function(key,value){if(key=="e2xml"){return"";}else{if(key=="selector"){return"";}else{return value;}}});thisClass.powerupCallback(compStr);}catch(e){alert("Error occurred2 "+e);}}}if(mf_main.editorController.SELECTMODE_TYPE=="internalmultilink"){if(thisClass.pageMultiLinkController.component.GROUP){var gselector=thisClass.page.groupManager.groupSelectors[thisClass.pageMultiLinkController.component.GROUPID];if(gselector){origcomp=gselector;}}else{origcomp=thisClass.pageMultiLinkController.component.selector;}if(selector.component.eid==thisClass.pageMultiLinkController.component.eid){MF_Utils.display_ActionIndicator("Error! Cannot select the same component as the link");}else{MF_Utils.display_ActionIndicator("Internal link has been saved");if(selector.component.lid==null||selector.component.lid==""){selector.component.lid="lnk_"+thisClass.guidGenerator();}var lname=selector.component.LABEL;if($.trim($("#mfInternalURL2").val())!=""){lname=$("#mfInternalURL2").val();}thisClass.pageMultiLinkController.saveInternalLinkHandler(selector.component.lid+"|--::--|"+lname);}}if(mf_main.editorController.SELECTMODE_TYPE=="powerup-compImageMode"){if(selector.component){try{mf_main.editorController.addComponentSelect(selector);mf_main.componentList.packController.exportComponentAsImage(thisClass.powerupCallback);}catch(e){alert("Error occurred powerup component select "+e);}}}thisClass.clearSelection();thisClass.removeSelectorResize();thisClass.disableSelectMode();thisClass.showNavBar();if(origcomp){if(origcomp.component&&origcomp.component.GROUPID!=""){}else{if(origcomp.GLOBAL_SELECT){var grpObj=thisClass.page.groupManager.getGroupByID(origcomp.GROUPID);if(grpObj&&grpObj.parent==""){mf_main.editorController.addSelectorResize(origcomp);}}else{mf_main.editorController.addSelectorResize(origcomp);}}}break;}else{if(mf_main.editorController.SELECTMODE_TYPE=="powerup-compImageMode"){try{if(selector==null){selector=thisClass.page.groupManager.groupSelectors[$(this).attr("group-id")];}mf_main.editorController.addComponentSelect(selector);mf_main.componentList.packController.exportComponentAsImage(thisClass.powerupCallback);}catch(e){alert("Error occurred powerup component select "+e);}}thisClass.clearSelection(true);thisClass.removeSelectorResize();thisClass.disableSelectMode();thisClass.showNavBar();break;}}}}};this.internalLinkSelectModeOver=function(e){if(mf_main.editorController.SELECTMODE){$(this).css("border","2px solid #E91E63");}};this.internalLinkSelectModeOut=function(e){if(mf_main.editorController.SELECTMODE){if(thisClass.currentSelectedID==$(this).attr("id")){}else{$(this).css("border","none");}}};this.enableSelectMode=function(type){thisClass.currentSelectModeState=thisClass.EDITOR;thisClass.closeGroupEditing();$("#mfPickLinkNotifier").off("click");if(type=="powerup-specsmode"){$("#mfPickLinkNotifier").text("Pick component for specs");}else{if(type=="powerup-selectedcomponent"){$("#mfPickLinkNotifier").text("Select a component");}else{if(type=="powerup-compImageMode"){$("#mfPickLinkNotifier").text("Select a component group to export");}else{if(type=="powerup-pagepreview"){thisClass.clearSelection(true);thisClass.disableShortcuts();$("#mfPickLinkNotifier").text("Go back to powerup");if($("#mfRTCEditorLock").css("display")=="block"){$("#mfRTCEditorLock").hide();}mf_main.VIEWER=true;mf_main.editorController.EDITOR=false;}else{$("#mfPickLinkNotifier").text("Pick component to navigate");}}}}$("#mfPickLinkNotifier").show();if(type=="powerup-pagepreview"){$("#mfPickLinkNotifier").on("click",function(){thisClass.powerupCallback();mf_main.powerupInterface.cleanupPowerupData();});}thisClass.hideNavBar();mf_main.editorController.SELECTMODE=true;mf_main.editorController.SELECTMODE_TYPE=type;mf_main.editorController.VIEWER=true;thisClass.removeSelectorResize();if(!thisClass.currentSelectModeState){$(".mfCompSelectorCls").show();}$(".mfCompSelectorCls").off("mouseup",thisClass.internalLinkSelectModeUp);$(".mfCompSelectorCls").off("mouseover",thisClass.internalLinkSelectModeOver);$(".mfCompSelectorCls").off("mouseout",thisClass.internalLinkSelectModeOut);$(".mfCompSelectorCls").off("mousedown",thisClass.internalLinkSelectModeDown);if(type!="powerup-compImageMode"){for(var n in thisClass.page.groupManager.groupSelectors){var gselector=thisClass.page.groupManager.groupSelectors[n];if(gselector){gselector.setVisible(false);}}}$(".mfCompSelectorCls").css("pointer-events","auto");if(type=="powerup-pagepreview"){}else{$(".mfCompSelectorCls").on("mousedown",thisClass.internalLinkSelectModeDown);$(".mfCompSelectorCls").on("mouseout",thisClass.internalLinkSelectModeOut);$(".mfCompSelectorCls").on("mouseup",thisClass.internalLinkSelectModeUp);$(".mfCompSelectorCls").on("mouseover",thisClass.internalLinkSelectModeOver);}};this.disableSelectMode=function(){mf_main.editorController.SELECTMODE=false;mf_main.editorController.SELECTMODE_TYPE="";$("#mfPickLinkNotifier").hide();$(".mfCompSelectorCls").off("mouseup",thisClass.internalLinkSelectModeUp);$(".mfCompSelectorCls").off("mouseover",thisClass.internalLinkSelectModeOver);$(".mfCompSelectorCls").off("mouseout",thisClass.internalLinkSelectModeOut);$(".mfCompSelectorCls").off("mousedown",thisClass.internalLinkSelectModeDown);$(".mfCompSelectorCls").css("border","none");for(var n in thisClass.page.groupManager.groupSelectors){var gselector=thisClass.page.groupManager.groupSelectors[n];if(gselector){gselector.setVisible(true);}}if(!thisClass.currentSelectModeState){thisClass.toggleLinks();}else{mf_main.editorController.VIEWER=false;}};this.closeSpecMode=function(){thisClass.SPECMODE=false;if(thisClass.specController){thisClass.specController.unsetMode();}};this.openSpecMode=function(){thisClass.SPECMODE=true;if(thisClass.specController==null){var loadFiles=["modules/specs/js/internal/specs.js"];if(MF_Global.getS3Bucket()!="testmfassets"){loadFiles=["modules/specs/js/mf_specs-min.js"];}else{loadFiles.push("modules/specs/js/internal/parts/MF_ColorSpecs.js");loadFiles.push("modules/specs/js/internal/parts/MF_TransformSpecs.js");loadFiles.push("modules/specs/js/internal/parts/MF_CodeSpecs.js");loadFiles.push("modules/specs/js/internal/parts/MF_FontSpecs.js");loadFiles.push("modules/specs/js/internal/parts/MF_TextContentSpecs.js");loadFiles.push("modules/specs/js/internal/parts/MF_ImageContentSpecs.js");loadFiles.push("modules/specs/js/internal/parts/MF_SVGContentSpecs.js");loadFiles.push("modules/specs/js/internal/parts/MF_GridHTMLSpecs.js");}loadFiles.push("modules/specs/js/external/color-thief.min.js");$("<link>").appendTo("head").attr({type:"text/css",rel:"stylesheet"}).attr("href","modules/specs/css/internal/specs.css");MF_Utils.loadsScripts(loadFiles).then(function(){$.get("modules/specs/specs.html",function(templates){$("#mfViewerContentSpecs").html(templates);thisClass.specController=new MF_SpecController();thisClass.specController.constructor();thisClass.specController.setMode();});});}else{thisClass.specController.setMode();}};this.closeCompMode=function(){if(thisClass.compMode){$("#mfEditorHolder").css("cursor","");thisClass.compMode=false;thisClass.compModeType=null;thisClass.makeAllCompsActive("unsetcompmode");}};this.hideRTCMessage=function(){bootbox.confirm("Another user is editing this same page now. To avoid conflicts, this page is now locked.<br/><br/>Co-Editors of a wireframe project can make changes at the same time but on different pages to avoid conflicts<br/><br/><br/>Un-Lock this page to make edits?",function(ans){if(ans){thisClass.page.closeRTCEditor();thisClass.page.showRTCMsg();}});};this.setMasterPage=function(){if(thisClass.EDITOR){if(thisClass.page.masterPage!=""&&thisClass.page.masterPage!=null){var masterPage=MF_PagePool.getPage(thisClass.page.masterPage);if(masterPage){$("#mfSetMasterPageTxt").text(masterPage.pageName);$(".mfMasterPageBtnSettings").show();$("#mfSetMasterPageBtn").css("width","auto");}else{mf_main.editorController.page.masterPage="";$("#mfSetMasterPageTxt").text("Select Page");$(".mfMasterPageBtnSettings").hide();$("#mfSetMasterPageBtn").css("width","100%");}}else{$("#mfSetMasterPageTxt").text("Select Page");$(".mfMasterPageBtnSettings").hide();$("#mfSetMasterPageBtn").css("width","100%");}}};this.setNavHide=function(){if(thisClass.EDITOR){if(thisClass.page.navHide){$("#mfNavHideToggle").removeClass("fa-eye").addClass("fa-eye-slash");$("#mfNavHideToggle").css("color","#ff0000");}else{$("#mfNavHideToggle").removeClass("fa-eye-slash").addClass("fa-eye");$("#mfNavHideToggle").css("color","#000000");}}};this.showZoomPopup=function(e){e.stopImmediatePropagation();var lastOpenedPopUp=thisClass.lastOpenedMfPopUp;if(lastOpenedPopUp){if(lastOpenedPopUp.attr("id")!=$("#mfZoomPopup").attr("id")){$(lastOpenedPopUp).hide();}}if($("#mfZoomPopup").css("display")=="block"){$("#mfZoomPopup").hide();return;}if(thisClass.videoChatInterfaceHeight==0){$("#mfZoomPopup").css({top:$(window).height()-85,left:65});}else{$("#mfZoomPopup").css({top:$(window).height()-(thisClass.videoChatInterfaceHeight+85),left:65});}$("#mfZoomPopup").show();thisClass.lastOpenedMfPopUp=$("#mfZoomPopup");};this.exchangeGradientColor=function(fillColors,fillColor1,fillColor2,propName){if(thisClass.lastSetting){if(propName==null){propName="fillColors";}var setting=thisClass.lastSetting;var newarray=fillColors.slice();newarray=newarray.reverse();if(mf_main.editorController.selectorResize.selector){var component=mf_main.editorController.selectorResize.selector.component;component.e2xml.addPropArray(propName,newarray,"String");component.render(false);}$(fillColor1).spectrum("set",newarray[0]);$(fillColor2).spectrum("set",newarray[1]);}};this.rotateComponent=function(rotatebox){if(thisClass.lastSetting){var setting=thisClass.lastSetting;if(mf_main.editorController.selectorResize.selector){var component=mf_main.editorController.selectorResize.selector.component;var currentAngle=component.eangle;if(currentAngle<90){currentAngle=90;}else{if(currentAngle>=90&&currentAngle<180){currentAngle=180;}else{if(currentAngle>=180&&currentAngle<270){currentAngle=270;}else{if(currentAngle>=270){currentAngle=0;}}}}component.e2xml.addPropSingle("eangle",currentAngle);component.render(false);rotatebox.value(currentAngle);mf_main.editorController.addSelectorResize(component.selector);if(currentAngle!=0){thisClass.disableCropMode();}if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}}}};this.toggleLinkHighlighter=function(e){var $this=$(this);if($this.is(":checked")){thisClass.showLinks=true;}else{thisClass.showLinks=false;}thisClass.showLinkHighlights();};this.toggleAnnotationsHandler=function(e){var $this=$(this);if($this.is(":checked")){thisClass.showAnnotations=true;}else{thisClass.showAnnotations=false;}thisClass.toggleAnnotations();};this.openLink=function(e,gid){if(thisClass.EDITOR){return;}e.stopImmediatePropagation();var compid=$(this).attr("id");if(compid==null){compid=gid;}var component=null;component=thisClass.getGroupById(compid);if(component==null){component=thisClass.getComponentById(compid);}thisClass.openCompLink(component,e);};this.openCompLink=function(component,e){if(component){if(component.NAME=="MF_AdvancedDataGrid"){try{var cellId=$(e.target).closest(".mfDataGridCell").attr("id");var cellObj=component.getCellObjbyId(cellId);component.linkObj=null;if(cellObj.linkType!=""&&cellObj.link!=""){component.linkObj=new MF_LinkObj();component.linkObj.type=cellObj.linkType;component.linkObj.link=cellObj.link;if(component.linkObj.type=="page"){component.linkObj.url=cellObj.link.split(":--:page:--:")[1];}else{if(component.linkObj.type=="web"){component.linkObj.url=cellObj.link.split(":--:web:--:")[1];}else{if(component.linkObj.type=="internal"){component.linkObj.url=cellObj.link.split(":--:internal:--:")[1];}}}}}catch(e){console.log("Error in Advanced DataGrid");}}if(component.linkObj!=null){if(component.linkObj.type=="web"){var ourl=component.linkObj.url;if(ourl.indexOf("http:")==-1&&ourl.indexOf("https:")==-1){ourl="http://"+ourl;}var safeurl="";if(MF_Global.getS3Bucket()=="testmfassets"){safeurl="safeurlcheck.jsp?url="+encodeURIComponent(ourl);}else{safeurl="https://wireframepro.mockflow.com/safeurlcheck.jsp?url="+encodeURIComponent(ourl);}$("#mfExternalLinkURLTxt").text(ourl);$("#mfOpenExternalLink").attr("href",safeurl);$("#mfWarnLinkModal").modal();}else{if(component.linkObj.type=="internal"){var cid=component.linkObj.url;var arr=cid.split("|--::--|");var comp=thisClass.getComponentByLid(arr[0]);if(comp){$("#mfEditorHolder").animate({scrollTop:(comp.y*thisClass.SCALE),scrollLeft:(comp.x*thisClass.SCALE)},1000,function(){});}else{MF_Utils.display_ActionIndicator("Component not found");}}else{var page=MF_PagePool.getPage(component.linkObj.url);if(page){if(mf_main.editorController.videoChatController==null||mf_main.editorController.videoChatController.presenter==null||mf_main.editorController.videoChatController.presenter.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()){thisClass.viewPage(page);}}}}}}};this.toggleAnnotations=function(){if(thisClass.page){var show=false;if(thisClass.EDITOR){show=true;}for(var k=0;k<thisClass.loadedPages.length;k++){var page=thisClass.loadedPages[k];for(var i=0;i<page.childComponents.size();i++){var component=page.childComponents.getItemAt(i);if(component.ANNOTATION){if(thisClass.showAnnotations||show){$("#"+component.eid).show();}else{$("#"+component.eid).hide();}}}}}};this.toggleLinks=function(){if(thisClass.page){thisClass.highlightViewerLinks=new Array();var show=true;if(thisClass.EDITOR){show=false;}for(var k=0;k<thisClass.loadedPages.length;k++){var page=thisClass.loadedPages[k];for(var i=0;i<page.childComponents.size();i++){var component=page.childComponents.getItemAt(i);if(component.NAME=="MF_AdvancedDataGrid"){component.link=component.isLinkExists();}if(component.selector&&component.link!=""){if(show){MF_ComponentSettingUtils.convert2LinkObj(component);if(component.SHOW_SELECTOR_ONPREVIEW){$("#"+component.selector.id).css("pointer-events","auto");component.selector.setVisible(true);thisClass.highlightViewerLinks.push(component.selector);}else{component.selector.setVisible(false);thisClass.highlightViewerLinks.push(component.selector);$("#"+component.eid).css("pointer-events","auto");$("#"+component.eid).on("click",thisClass.openLink);}}else{component.selector.setVisible(true);$("#"+component.eid).off("click",thisClass.openLink);}}else{if(component.selector){if(component.INTERACTIVE&&show){$("#"+component.eid).css("pointer-events","auto");}if(show){if(component.SHOW_SELECTOR_ONPREVIEW){component.selector.setVisible(true);}else{component.selector.setVisible(false);}}else{component.selector.setVisible(true);}if(component.ALLOW_MULTILINK&&component.pageSetLink){if(show){thisClass.highlightViewerLinks.push(component.selector);component.render(false);$("#"+component.eid).css("pointer-events","auto");MF_ComponentSettingUtils.assignMultiLink(component);}else{$("."+component.eid+"_itemCls").off("click");}}}}}for(var n in page.groupManager.groupSelectors){var gselector=page.groupManager.groupSelectors[n];if(gselector){var linkObj=page.groupManager.linkedGroups[n];var linkpresent=false;if(linkObj&&linkObj.link!=""){if(show){linkpresent=true;gselector.setVisible(true);MF_ComponentSettingUtils.convert2LinkObj(linkObj);$("#"+gselector.id).css("pointer-events","auto");thisClass.highlightViewerLinks.push(gselector);}else{gselector.setVisible(true);}}if(linkpresent==false){if(show){gselector.setVisible(false);}else{gselector.setVisible(true);}}}}}if(thisClass.VIEWER&&thisClass.showLinks){thisClass.showLinkHighlights();}}};this.preFetchPages=function(){if(mf_main.RENDER||mf_main.REVISION||thisClass.EDITOR){return;}prefetchPageList=new Object();for(var k=0;k<thisClass.loadedPages.length;k++){var page=thisClass.loadedPages[k];for(var i=0;i<page.childComponents.size();i++){var component=page.childComponents.getItemAt(i);if(component&&component.selector&&component.link!=""&&component.link!=null){var linkarr=component.link.split(":--:");if(linkarr&&linkarr.length==3){if(linkarr[1]=="page"){prefetchPageList[linkarr[2]]=true;}}}else{if(component&&component.selector&&component.ALLOW_MULTILINK&&component.pageSetLink&&component.linkArray){for(var key in component.linkArray){var link=component.linkArray[key];if(link!=""&&link!=null){var linkarr=link.split(":--:");if(linkarr&&linkarr.length==3){if(linkarr[1]=="page"){prefetchPageList[linkarr[2]]=true;}}}}}}}}var masterpagesPrefetch=new Object();for(var key in prefetchPageList){thisClass.getAllPages(key,masterpagesPrefetch);}for(var key in masterpagesPrefetch){prefetchPageList[key]=true;}for(var key in prefetchPageList){var page=MF_PagePool.getPage(key);if(page&&page.loaded==false&&page.noDBLoad==false){MF_ProjectManager.getPageData(MF_UserSession.getUser(),thisClass.projectObj.id,thisClass.projectObj.company,page.eid,mf_main.PUBLIC,mf_main.revisionID,{callback:function(pagedataObj){if(pagedataObj){var lpage=MF_PagePool.getPage(pagedataObj.eid);if(lpage.loaded==false&&lpage.noDBLoad==false){lpage.pagedata.data=pagedataObj.data;lpage.noDBLoad=true;var jData2=$(lpage.pagedata.data);lpage.e2xml.settingsXML=jData2;$(lpage.e2xml.settingsXML).find("children").each(function(){var jData=$("<div/>").append($(this).clone());jData.find("component").each(function(){mf_main.componentList.invokeComponent($(this).attr("type"),"noload");});});}}}});}}};this.getAllPages=function(pageid,masterpagesPrefetch){var page=MF_PagePool.getPage(pageid);if(page&&page.masterPage!=""){var masterPage=MF_PagePool.getPage(page.masterPage);if(masterPage&&!masterpagesPrefetch[masterPage.eid]){masterpagesPrefetch[masterPage.eid]=true;thisClass.getAllPages(masterPage.eid,masterpagesPrefetch);}}};this.showLinkHighlights=function(noauto){if(thisClass.VIEWER==false){return;}if(mf_main.RENDER){return;}if(noauto!=true&&thisClass.showLinks==false){return;}for(var b=0;b<thisClass.highlightViewerLinks.length;b++){var selector=thisClass.highlightViewerLinks[b];if(selector){selector.setVisible(true);$("#"+selector.id).css("background-color","rgba(255,204,51,0.5)");}}if(noauto){}else{var myVar=setInterval(function(){thisClass.hideLinkHighlights();clearInterval(myVar);},1000);}};this.hideLinkHighlights=function(){for(var b=0;b<thisClass.highlightViewerLinks.length;b++){var selector=thisClass.highlightViewerLinks[b];if(selector){if(selector.GROUP==false){if(selector.component&&selector.component.SHOW_SELECTOR_ONPREVIEW){}else{selector.setVisible(false);}}$("#"+selector.id).css("background-color","rgba(0,0,0,0)");}}};this.showPreview=function(noload){if(thisClass.EDITOR&&thisClass.projectObj==null){MF_Utils.display_ActionIndicator("Project is loading, Please wait");return;}if(mf_main.INTEGRATION&&mf_main.PERMISSION!="Reviewer"){return;}if(thisClass.EDITOR&&MF_ChangeManager.getCHANGED()==true){thisClass.saveProject();}$("#mfEditorCompToolbar").hide();$("#mfPageMoreArea").hide();thisClass.drawController.hideDrawMode();thisClass.disableCropMode();thisClass.closeCompMode();thisClass.closeGroupEditing();thisClass.closeAllSettings();thisClass.VIEWER=true;thisClass.EDITOR=false;if(mf_main.editorController.powerupController){mf_main.editorController.powerupController.powerupsListed=false;mf_main.editorController.powerupController.applyPinnedPowerupsTemplate();}thisClass.clearSelection(true);thisClass.disableShortcuts();mf_main.closeDialog();thisClass.viewerShortcuts=true;if(thisClass.pageController.treeview){}$("#mfEditorHolder").addClass("mfCursorHighlight");$("#mfEditorHeader").hide();$("#mfViewerHeader").show();$(".mfEditorUICls").hide();$(".mfViewerUICls").show();$(".mfNavBarButton").hide();$(".mfViewerNavBarButton").show();$(".mfNavBarContentHolderCls").hide();$("#mfNavbarCommentIndBtn").hide();$("#mfNavbarCommentIndBtn").hide();$("#mfViewerNavExportEditBtn").hide();$("#mfOpenPageGrid2Btn").show();$("#mfPinPage2Space").hide();$("#mfNavAIToolsBtn").hide();$(".mfViewerNavBarContentHolderCls").show();if($("#mfEditorBackBtn").css("display")=="block"&&thisClass.projectObj.share){$("#mfEmbedPage").show();}$("#mfPageSettingsBar").hide();$("#mfPageActionBar").hide();$(".mfPageBarViewTypeCls").hide();$("#mfPageToggleSettings").show();$("#mfToggleLinkHighlight").prop("checked",thisClass.showLinks);$("#mfUnSavedBtn").hide();thisClass.toggleVisibleTopBar();thisClass.openNavBarContent(thisClass.lastOpenViewerContent);thisClass.toggleLinks();thisClass.toggleAnnotations();if(noload==true){}else{if(thisClass.page){thisClass.viewPage(thisClass.page,true);}}thisClass.showCalloutTooltips();thisClass.hideHotSpots();thisClass.getAllImages();thisClass.setDesignMode();mf_main.interfaceResize();};this.hideCalloutTooltips=function(){$(".mfCalloutCls").tooltip("destroy");$(".mfCalloutCls").attr("data-toggle","");};this.showCalloutTooltips=function(){$(".mfCalloutCls").attr("data-toggle","tooltip");$('[data-toggle="tooltip"]').tooltip({container:"body"});};this.hideHotSpots=function(){$(".mfHotspotCmpCls").css("opacity",0);};this.showHotSpots=function(){$(".mfHotspotCmpCls").css("opacity",1);};this.showEditor=function(){if(mf_main.PUBLIC||mf_main.VIEWER){return;}if(mf_main.PERMISSION!=null&&mf_main.PERMISSION=="Reviewer"){return;}$("#mfEditorCompToolbar").show();if(thisClass.SPECMODE){thisClass.lastOpenViewerContent="mfViewerNavPagesBtn";}thisClass.closeSpecMode();thisClass.commentController.hideAnnotationPointer();thisClass.EDITOR=true;thisClass.VIEWER=false;if(mf_main.editorController.powerupController){mf_main.editorController.powerupController.powerupsListed=false;mf_main.editorController.powerupController.applyPinnedPowerupsTemplate();}thisClass.viewerShortcuts=false;thisClass.hideLinkHighlights();thisClass.closeCompMode();$("#mfEditorHolder").removeClass("mfCursorHighlight");$("#mfEditorHeader").show();$("#mfViewerHeader").hide();$(".mfEditorUICls").show();$(".mfViewerUICls").hide();$(".mfNavBarButton").show();$(".mfViewerNavBarButton").hide();$(".mfNavBarContentHolderCls").show();$("#mfNavbarCommentIndBtn").show();$("#mfViewerNavExportEditBtn").show();$("#mfOpenPageGrid2Btn").hide();if(mf_main.INTEGRATION){$("#mfPinPage2Space").hide();$("#mfPagesOpenWizard").hide();$("#mfTopMenuOpenWizard").hide();}else{$("#mfPinPage2Space").show();$("#mfPagesOpenWizard").show();$("#mfTopMenuOpenWizard").show();}$("#mfNavAIToolsBtn").show();$("#mfEmbedPage").hide();$(".mfViewerNavBarContentHolderCls").hide();$("#mfPageSettingsBar").show();$("#mfPageActionBar").show();$(".mfPageBarViewTypeCls").show();$("#mfPageToggleSettings").hide();$("#mfViewerCommentNumBtn").hide();thisClass.setDesignMode();if(thisClass.EDITOR&&MF_ChangeManager.getCHANGED()==true){$("#mfUnSavedBtn").show();thisClass.toggleVisibleTopBar();}thisClass.openNavBarContent(thisClass.currentNavBarEditorShown);mf_main.interfaceResize();thisClass.toggleLinks();thisClass.toggleAnnotations();thisClass.hideCalloutTooltips();thisClass.showHotSpots();thisClass.setMasterPage();thisClass.setNavHide();if(thisClass.page){thisClass.viewPage(thisClass.page,true);}mf_main.interfaceResize();};this.hideNavBar=function(ev){$(this).tooltip("hide");$("#mfPageManagerArea").fadeOut("fast",function(el){if(mf_main.editorController.SELECTMODE_TYPE=="powerup-pagepreview"){}else{$(".mfShowSidebar").fadeIn("fast");}$("#mfPageMoreArea").hide();thisClass.sidebarShow=false;mf_main.closeDialog();thisClass.formAddressHash();thisClass.resizeEditor();if(thisClass.videoChatController){$(".mfVideoChatPresenterVideo").css("left","58px");}});};this.showNavBar=function(ev){$(this).tooltip("hide");if(thisClass.SELECTMODE){thisClass.disableSelectMode();}$(".mfShowSidebar").fadeOut("fast",function(el){$("#mfPageManagerArea").fadeIn("fast",function(el){thisClass.sidebarShow=true;thisClass.formAddressHash();thisClass.resizeEditor();if(thisClass.powerupCallbackOptions&&thisClass.powerupCallbackOptions.isEnableSelectMode){thisClass.powerupCallPageReset();}});if(thisClass.videoChatController){$(".mfVideoChatPresenterVideo").css("left","335px");}});};this.formAddressHash=function(){if(mf_main.editorController.page){var urlhash="/page/"+mf_main.editorController.page.eid;if(thisClass.sidebarShow==false){urlhash=urlhash+"/sidebar/off";}if(mf_main.PUBLIC&&mf_main.editorController.powerupController.publicURLPowerupId!=""){urlhash=urlhash+"/powerup/"+mf_main.editorController.powerupController.publicURLPowerupId+"/powerupdata/"+mf_main.editorController.powerupController.publicURLPowerupData;}window.location.hash=urlhash;}};this.resetNavBar=function(e){$(".mfNavBarContentHolderCls").hide();$(".mfNavBarButton").css("color","#000");$(".mfPowerupPinnedItem").removeClass("mfPowerupPinnedItemActive");};this.resetViewNavBar=function(e){$(".mfViewerNavBarContentHolderCls").hide();$(".mfViewerNavBarButton").css("color","#000");$(".mfPowerupPinnedItem").removeClass("mfPowerupPinnedItemActive");};this.openNavBar=function(e){if(thisClass.projectObj!=null){thisClass.openNavBarContent($(this).attr("id"));}else{MF_Utils.display_ActionIndicator("Project is loading, Please wait");}};this.openLayersHandler=function(e){if($("#mfPageMoreArea").css("display")=="block"){$("#mfPageMoreArea").hide();}else{$("#mfPageMoreArea").show();thisClass.layersController.listLayers();}mf_main.interfaceResize();};this.openNavBarContent=function(nid){if(nid&&nid.includes("mfNav")){if(mf_main.PERMISSION!=null&&mf_main.PERMISSION=="Reviewer"){return;}}if(nid&&nid.includes("mfViewerNav")){if(mf_main.INTEGRATION&&mf_main.PERMISSION!="Reviewer"){return;}}if(nid&&nid.includes("mfNavIllustrationsBtn")){return;}if(nid&&nid.includes("mfNavLayersBtn")){return;}if(nid&&nid.includes("mfNavIconsBtn")){return;}if(nid&&nid.includes("mfNavTemplatesBtn")){return;}if(!mf_main.editorController.pageloaded&&!mf_main.COMMENTMODE&&nid!="mfViewerNavCommentBtn"){MF_Utils.display_ActionIndicator("Project is loading, Please wait");return;}thisClass.lastSetting=null;thisClass.drawController.hideDrawMode();mf_main.closeDialog();thisClass.closeSpecMode();thisClass.commentController.hideAnnotationPointer(false);if(nid=="mfNavStoreBtn"){thisClass.storeController.openStore(false);return;}thisClass.resetNavBar();thisClass.resetViewNavBar();$("#"+nid).css("color","#2286FB");if(nid=="mfNavElementBtn"){thisClass.currentNavBarEditorShown="mfNavElementBtn";$("#mfContentComponents").show();}if(nid=="mfNavAIToolsBtn"){thisClass.currentNavBarEditorShown="mfNavAIToolsBtn";$("#mfContentAItools").show();}if(nid=="mfNavPagesBtn"){thisClass.currentNavBarEditorShown="mfNavPagesBtn";$("#mfContentPages").show();thisClass.pageController.resize();}if(nid=="mfNavImagesBtn"){thisClass.currentNavBarEditorShown="mfNavImagesBtn";thisClass.imageController.component=null;thisClass.imageController.openImageListing();$("#mfContentImages").show();thisClass.imageController.resize();}if(nid=="mfViewerNavCommentBtn"){thisClass.lastOpenViewerContent="mfViewerNavCommentBtn";$("#mfViewerContentComments").show();}if(nid=="mfViewerNavExportBtn"){thisClass.lastOpenViewerContent="mfViewerNavExportBtn";$("#mfViewerContentExport").show();}if(nid=="mfViewerNavSpecsBtn"){thisClass.lastOpenViewerContent="mfViewerNavSpecsBtn";$("#mfViewerContentSpecs").show();thisClass.openSpecMode();}if(nid=="mfViewerNavPagesBtn"){thisClass.lastOpenViewerContent="mfViewerNavPagesBtn";$("#mfContentPages").show();thisClass.pageController.resize();}if(nid=="mfNavPowerupBtn"){thisClass.currentNavBarEditorShown="mfNavPowerupBtn";thisClass.powerupController.openPowerupList();$("#mfContentPowerup").show();if(thisClass.powerupController.selectedPinnedPowerupID!=null){$('.mfPowerupPinnedItem[data-powerupid="'+thisClass.powerupController.selectedPinnedPowerupID+'"]').addClass("mfPowerupPinnedItemActive");}}if(nid=="mfViewerNavPowerupBtn"){thisClass.lastOpenViewerContent="mfViewerNavPowerupBtn";thisClass.powerupController.openPowerupList();$("#mfContentPowerup").show();if(thisClass.powerupController.selectedPinnedPowerupID!=null){$('.mfPowerupPinnedItem[data-powerupid="'+thisClass.powerupController.selectedPinnedPowerupID+'"]').addClass("mfPowerupPinnedItemActive");}}thisClass.resizeEditor();};this.openCommentHandler=function(e){thisClass.resetNavBar();thisClass.resetViewNavBar();$("#mfViewerNavCommentBtn").css("color","#2286FB");thisClass.lastOpenViewerContent="mfViewerNavCommentBtn";$("#mfViewerContentComments").show();};this.openViewerNavBar=function(e){$(".mfViewerNavBarContentHolderCls").hide();$(".mfViewerNavBarButton").css("color","#545465");$(".mfPowerupPinnedItem").removeClass("mfPowerupPinnedItemActive");$(this).css("color","#2286FB");};this.checkLoaded=function(){if(mf_main.RENDER){if(thisClass.loadedPages.length==thisClass.pageOrder.length){var loaded=true;if(!thisClass.renderImageAssigned){loaded=false;}for(var i=0;i<thisClass.renderImages.length;i++){var comp=thisClass.renderImages[i];if(comp&&comp.NAME=="MF_ImageComp"&&!comp.imgLoaded){loaded=false;break;}if(comp&&comp.NAME=="MF_SVGIcon"&&!comp.svgLoaded){loaded=false;break;}if(comp&&comp.NAME=="MF_Illustration"&&!comp.svgLoaded){loaded=false;break;}if(comp&&comp.NAME=="MF_BYOC"&&!comp.byocLoaded){loaded=false;break;}}if(!thisClass.fontController.isAllFontsLoaded){loaded=false;}if(loaded==true){thisClass.resizePage();setTimeout(function(){$("#mfrenderbar").css("visibility","visible");},2000);}}}};this.checkImagesLoaded=function(){var loaded=true;for(var i=0;i<thisClass.renderImages.length;i++){var comp=thisClass.renderImages[i];if(comp&&comp.NAME=="MF_ImageComp"&&comp.imageID!=""&&!comp.imgLoaded){loaded=false;break;}if(comp&&comp.NAME=="MF_SVGIcon"&&comp.SVGUrl!=""&&!comp.svgLoaded){loaded=false;break;}if(comp&&comp.NAME=="MF_Illustration"&&comp.SVGUrl!=""&&!comp.svgLoaded){loaded=false;break;}if(comp&&comp.NAME=="MF_BYOC"&&!comp.byocLoaded){loaded=false;break;}}return loaded;};this.openMenuPublicHandler=function(e){thisClass.shortcutsFlag=false;$("#mfPublicLinkModal").modal();};this.exportWireframe=function(){thisClass.showPreview();thisClass.openNavBarContent("mfViewerNavExportBtn");};this.commentWireframe=function(){thisClass.openNavBarContent("mfViewerNavCommentBtn");thisClass.currentNavBarEditorShown="mfViewerNavCommentBtn";};this.setGuidelines=function(selector,resized,unscaled){if(thisClass.CROPMODE){return;}if(selector){var scale=thisClass.SCALE;var comp=false;if(selector.NAME||selector.GROUP){comp=true;}var borderval=$("#mfPageManagerArea").width();if(!thisClass.sidebarShow){borderval=50;}var selwidth=selector.width;var selheight=selector.height;var selx=selector.x;var sely=selector.y;if(comp&&unscaled){selx=selx+selector.delta;sely=sely+selector.delta;selx=selx/thisClass.SCALE;sely=sely/thisClass.SCALE;}var showguide=true;var angle=selector.angle;if(comp&&!selector.GROUP){angle=selector.eangle;}if(angle!=0&&!selector.TRANSFORM){var obj=MF_Utils.getRotatedSize(selx,sely,selwidth,selheight,angle);selx=obj.x;sely=obj.y;selwidth=obj.width;selheight=obj.height;if(thisClass.SCALE!=1&&!resized){showguide=false;}}var sheight=selheight;var swidth=selwidth;if(resized){scale=1;sheight=sheight*thisClass.SCALE;swidth=swidth*thisClass.SCALE;}if(showguide){$("#mfHorizontalTopGuide").show();var htop=((sely*thisClass.SCALE)+($("#mfContainerPage").position().top/scale))*scale;if(selector.TRANSFORM){htop=((sely*1)+($("#mfContainerPage").position().top/scale))*scale;}if(htop<0){$("#mfHorizontalTopGuide").hide();}$("#mfHorizontalTopGuide").css({position:"absolute",top:htop,left:borderval+10});$("#mfHorizontalTopGuide").width(($(window).width())-borderval-20);var hbottom=(((sely)*thisClass.SCALE)+(sheight)+($("#mfContainerPage").position().top/scale))*scale;if(selector.TRANSFORM){hbottom=((sely*1)+(sheight)+($("#mfContainerPage").position().top/scale))*scale;}$("#mfHorizontalBottomGuide").show();if(hbottom<0){$("#mfHorizontalBottomGuide").hide();}$("#mfHorizontalBottomGuide").css({position:"absolute",top:hbottom,left:borderval+10});$("#mfHorizontalBottomGuide").width(($(window).width())-borderval-20);$("#mfVerticalLeftGuide").show();var vleft=((selx*thisClass.SCALE)+($("#mfContainerPage").position().left/scale))*scale;if(selector.TRANSFORM){vleft=((selx*1)+($("#mfContainerPage").position().left/scale))*scale;}if(vleft<borderval){$("#mfVerticalLeftGuide").hide();}$("#mfVerticalLeftGuide").css({position:"absolute",left:vleft,top:10});$("#mfVerticalLeftGuide").height(($(window).height())-20);$("#mfVerticalRightGuide").show();var vright=(((selx)*thisClass.SCALE)+swidth+($("#mfContainerPage").position().left/scale))*scale;if(selector.TRANSFORM){vright=(((selx)*1)+swidth+($("#mfContainerPage").position().left/scale))*scale;}if(vright<borderval){$("#mfVerticalRightGuide").hide();}$("#mfVerticalRightGuide").css({position:"absolute",left:vright,top:10});$("#mfVerticalRightGuide").height(($(window).height())-20);}else{thisClass.removeGuides();}}};this.removeGuides=function(){$("#mfHorizontalTopGuide").hide();$("#mfHorizontalBottomGuide").hide();$("#mfVerticalLeftGuide").hide();$("#mfVerticalRightGuide").hide();};this.decryptPublicProject=function(e){var passkey=$("#mfPublicUrlKeyVal").val();passkey=passkey.trim();if(passkey==""){alert("Key cannot be empty");return;}if(passkey.length>90){alert("Key cannot exceed 90 chars.");return;}mf_main.closeDialog();$("#mfPublicUrlKeyModal").modal("hide");mf_main.PUBLIC_DECRYPT_MODE=true;thisClass.openEditor(mf_main.projectID);};this.pageScrollHandler=function(e){$(".dropdowncomp_content").hide();if($("#mfAnnotateArrow").css("display")=="block"&&$("#mfPageSidebarPost").height()>0){thisClass.commentController.placeCommentAnnotation(null,true);}if($("#mfAnnotateArrow2").css("display")=="block"){thisClass.commentController.placeCommentAnnotation("mfAnnotateArrow2",true);}if(thisClass.textChatController&&$("#mfVideoChatAnnotateArrow2").css("display")=="block"){thisClass.textChatController.placeChatAnnotation("mfVideoChatAnnotateArrow2",null,true);}};this.viewFullSize=function(e){if(e){e.stopImmediatePropagation();}thisClass.SCALE=1;$(".mfZoomBarBtns").css("color","#fff");thisClass.zoomPage();};this.zoomPage=function(){if(!thisClass.RENDER&&mf_main.editorController.page){if(mf_main.editorController.drawController&&mf_main.editorController.drawController.DRAWMODE&&mf_main.editorController.drawController.RESTRICTED){MF_Utils.display_ActionIndicator("Zoom is disabled while drawing in large pages");if(thisClass.SCALE!=1){thisClass.SCALE=1;return;}}if(thisClass.SCALE>1){if(mf_main.isSafari){thisClass.SCALE=1;}}$("#mfContainerPage").css("visibility","none");if(thisClass.autoSize||mf_main.RENDER){$("#mfContainerPage").css("transform-origin","top left");$("#mfContainerPage").css("-webkit-transform-origin","top left");}else{$("#mfContainerPage").css("transform-origin","center");$("#mfContainerPage").css("-webkit-transform-origin","center");}$("#mfContainerPage").css("-webkit-transform","scale("+thisClass.SCALE+","+thisClass.SCALE+")");$("#mfContainerPage").css("transform","scale("+thisClass.SCALE+","+thisClass.SCALE+")");$("#mfContainerPage").css("-ms-transform","scale("+thisClass.SCALE+","+thisClass.SCALE+")");$("#mfContainerPage").css("visibility","visible");mf_main.interfaceResize();thisClass.ctop=$("#mfContainerPage").position().top;thisClass.cleft=$("#mfContainerPage").position().left;if(thisClass.SCALE<1){$("#mfNavbarZoomBtnIcon").removeClass().addClass("ico-zoom_out");}else{if(thisClass.SCALE>1){$("#mfNavbarZoomBtnIcon").removeClass().addClass("ico-zoom_in");}else{$("#mfNavbarZoomBtnIcon").removeClass().addClass("ico-equal_zoom");}}thisClass.gest_scale=thisClass.SCALE;if(thisClass.selectorResize){thisClass.selectorResize.resizeHandles();}}};this.autoSaveRevisionFunc=function(){if(thisClass.EDITOR&&MF_ChangeManager.getCHANGED()==true){thisClass.autoSaveCounter++;if(thisClass.autoSaveCounter==2){thisClass.autoSaveCounter=0;thisClass.saveRevision(true);}else{thisClass.saveRevision(false);}}};this.autoSaveFunc=function(){if(thisClass.EDITOR&&MF_ChangeManager.getCHANGED()==true){thisClass.saveProject();}};this.startAutoSave=function(){if(mf_main.RENDER){return;}if(!thisClass.autoSaveStarted){thisClass.autoSaveStarted=true;thisClass.timer=setInterval(function(){thisClass.autoSaveRevisionFunc();},15000);thisClass.saveTimer=setInterval(function(){thisClass.autoSaveFunc();},150000);}};this.stopAutoSave=function(){if(thisClass.timer!=null){clearInterval(thisClass.timer);}if(thisClass.saveTimer!=null){clearInterval(thisClass.saveTimer);}};this.gotoViewer=function(){thisClass.clearSelection(true);mf_main.viewState("viewer");};this.editProjectHandler=function(){mf_main.viewState("editor");};this.closeAllSettings=function(){if(thisClass.lastSetting){thisClass.lastSetting.remove();thisClass.lastSetting=null;}$(".mfComponentSetting").hide();$(".sp-container").hide();$("#mfComponentSettingsDiv").hide();$("#mfNavPagesettingsDiv").hide();$("#mfMasterPageSettingsDiv").hide();$("#mfNavManagePage").hide();$(".mfPopUp").hide();};this.placeSettingsPanel=function(){};this.openSetting=function(selector){if(selector){thisClass.stopEditingText();if(selector.UNEDIT){return;}var gen=true;if(thisClass.lastSetting&&thisClass.lastSetting.selector){if(selector==thisClass.lastSetting.selector){gen=false;}}if(gen){thisClass.closeAllSettings();$("#mfComponentSettings").scrollTop(0);$("#mfComponentSettingsDiv").show();if(selector.GLOBAL_SELECT&&selector==thisClass.globalselect){if(mf_main.componentList.cacheSettings.global){thisClass.lastSetting=mf_main.componentList.cacheSettings.global;$(".mfFontFamilyCls").text("Select font");}else{mf_main.componentList.cacheSettings.global=new MF_GlobalSettings();mf_main.editorController.openSetting(selector);}}else{if(selector.GROUP){if(selector.locked){thisClass.lastSetting=new MF_LockSettings();}else{if(mf_main.componentList.cacheSettings.group){thisClass.lastSetting=mf_main.componentList.cacheSettings.group;}else{mf_main.componentList.cacheSettings.group=new MF_GroupSettings();mf_main.editorController.openSetting(selector);return;}}}else{if(selector.component.transformLock){thisClass.lastSetting=new MF_LockSettings();}else{if(mf_main.componentList.cacheSettings[selector.component.NAME]){thisClass.lastSetting=mf_main.componentList.cacheSettings[selector.component.NAME];}else{mf_main.componentList.invokeComponentSettings(selector.component);return;}}}}if(thisClass.page.master){$("#mfComponentSettingsBar").hide();}else{$("#mfComponentSettingsBar").show();}if(!selector.GLOBAL_SELECT){thisClass.lastSetting.component=selector.component;}thisClass.lastSetting.selector=selector;thisClass.lastSetting.setValues();thisClass.placeSettingsPanel();thisClass.resetNavBar();if(mf_main.INTEGRATION&&thisClass.lastSetting){$("#"+thisClass.lastSetting.eid+"_link").hide();}$("#mfContentSettings").show();var noscroll=false;if(thisClass.lastSetting&&thisClass.lastSetting.component){if(mf_main.componentList.settingsScrollPos[thisClass.lastSetting.component.NAME]){$("#mfComponentSettings").scrollTop(mf_main.componentList.settingsScrollPos[thisClass.lastSetting.component.NAME]);noscroll=true;}}else{if(thisClass.lastSetting&&thisClass.lastSetting.global){if(mf_main.componentList.settingsScrollPos.global){$("#mfComponentSettings").scrollTop(mf_main.componentList.settingsScrollPos.global);noscroll=true;}}}if(!noscroll){$("#mfComponentSettings").scrollTop(0);}$(".mfSettingsTextEditMsg").off("click");$(".mfSettingsTextEditMsg").on("click",function(e){if(thisClass.EDITOR){if(thisClass.lastSetting&&thisClass.lastSetting.component&&thisClass.lastSetting.component.EDITABLE){thisClass.lastTextEditComp=thisClass.lastSetting.component;thisClass.startEditingText();}}});}}};this.openPageSetting=function(){return;if(thisClass.page.master){$("#mfMasterPageSettingsDiv").show();}else{var newarr=new Array();var exitem=null;exitem=new Object();exitem.pageName="{Next Canvas}";exitem.pageid="_Next_";newarr.push(exitem);exitem=new Object();exitem.pageName="{Previous Canvas}";exitem.pageid="_Prev_";newarr.push(exitem);exitem=new Object();exitem.pageName="{First Canvas}";exitem.pageid="_First_";newarr.push(exitem);exitem=new Object();exitem.pageName="{Last Canvas}";exitem.pageid="_Last_";newarr.push(exitem);exitem=new Object();exitem.pageName="{Random Canvas}";exitem.pageid="_Random_";newarr.push(exitem);var sind=-1;var count=0;for(var k=0;k<MF_PagePool.getPages().size();k++){var litem=MF_PagePool.getPages().getItemAt(k);if(!litem.master){var newitem=new Object();newitem.pageName=litem.pageName;newitem.pageid=litem.eid;newarr.push(newitem);}}for(var k=0;k<newarr.length;k++){var litem=newarr[k];if(!litem.master){count++;if(litem.pageid==thisClass.page.timeoutLink){sind=count;}}}sind=sind-1;$("#mfNavPagesettingsDiv").show();}};this.loadProject=function(projectObj){if(thisClass.EDITOR&&MF_Global.adminAllow()){$("#mfTopMenuCreateComponent").show();}if(projectObj==null){alert("Permission denied");return;}else{thisClass.projectObj=new MF_Project();thisClass.projectObj.cast(projectObj);if(thisClass.EDITOR){mf_main.editorController.teamClientList=thisClass.projectObj.teamClientList;if(thisClass.projectObj.category!=null&&thisClass.projectObj.category!=""){var newcategory=mf_main.componentList.switch2MockStorePack(thisClass.projectObj.category);mf_main.componentList.addComponents(newcategory);}else{mf_main.componentList.addComponents("featured");}mf_main.componentList.getCustomPacks();}thisClass.loadProjectXML();if(thisClass.EDITOR&&mf_main.DESIGNMODE&&mf_main.NEWPROJECT){$("#mfNavTemplatesBtn").click();}}};this.openEditor=function(projectid){if("IntersectionObserver" in window){thisClass.VISIBLE_OBSERVE=true;}else{thisClass.VISIBLE_OBSERVE=false;}if(mf_main.RENDER){thisClass.VISIBLE_OBSERVE=false;}MF_PagePool.clean();mf_main.componentList.showComponentPlaceHolder();var newprojectid=projectid;if(mf_main.PUBLIC_DECRYPT_MODE){var passkey=$("#mfPublicUrlKeyVal").val();newprojectid=newprojectid+"--__--"+passkey;}MF_ProjectManager.getProjectObj(MF_UserSession.getUser(),newprojectid,mf_main.PUBLIC,{callback:function(projectObj){if(projectObj&&projectObj.drawingType=="designer"){mf_main.DESIGNMODE=true;$("#mfExportOfflineTypeImg").attr("src","images/editor/export/dsgn.png");thisClass.setDesignMode();}if(projectObj&&projectObj.readonly&&mf_main.PERMISSION!="Reviewer"){mf_main.PERMISSION="Reviewer";mf_main.changeUIByPermission();mf_main.viewState("viewer");}if(projectObj==null){if(mf_main.PERMISSION=="Owner"||mf_main.PERMISSION==null||mf_main.PERMISSION==""){alert("Permission denied");}else{if(MF_UserSession.getUser().isNewLicense&&MF_UserSession.getUser().isBasic){alert("Basic plan does not allow co-editing shared projects. Ask your license administrator to upgrade your account OR purchase a license");}else{alert("Permission denied. Check with project owner.");}}MF_ChangeManager.CHANGED(false);if(mf_main.PUBLIC&&mf_main.PUBLIC_DECRYPT_MODE){$("#mfPublicUrlKeyModal").modal("hide");$("#mfPublicUrlKeyModal").data("bs.modal",null);$("#mfPublicUrlKeyVal").val("");$("#mfPublicUrlKeyModal").modal();}else{window.open("https://mockflow.com","_self");}return;}if(mf_main.PUBLIC){if(projectObj.id=="encryptedurl"){mf_main.PUBLIC_DECRYPT_MODE=true;$("#mfPublicUrlKeyModal").modal();setTimeout(function(){$("#mfPublicUrlKeyVal").focus();},1000);return;}$("#mfViewerNavQRCodeBtn").show();if(!projectObj.enableComments){$("#mfViewerNavCommentBtn").hide();}if(!projectObj.enableExport){$("#mfViewerNavExportBtn").hide();}$("#mfViewerTopTitle").text(projectObj.title);}document.title="WireframePro - "+projectObj.title;if(!mf_main.PUBLIC&&thisClass.EDITOR&&MF_UserSession.getUser()&&MF_UserSession.getUser().isBasic){if(projectObj.createDate!=null){var ldate=new Date("2020-05-04");if(projectObj.createDate>ldate){thisClass.RESTRICT_SIZE=false;}}}thisClass.editManager.setPageSizeCustom();thisClass.loadProject(projectObj);if(!mf_main.PUBLIC){MF_ProjectManager.getMemberDetails(MF_UserSession.getUser(),thisClass.projectObj.id,thisClass.projectObj.collaborators,{callback:function(chatmembers){mf_main.rtc.memberCollection=new ArrayCollection();for(var i=0;i<chatmembers.length;i++){var chatMemberObj=new MF_ChatMember();chatMemberObj.cast(chatmembers[i]);chatMemberObj.id=thisClass.guidGenerator();mf_main.rtc.memberCollection.addItem(chatMemberObj);}mf_main.rtc.connect();thisClass.updatePowerupPinPageRTC();}});}else{mf_main.rtc.connect();thisClass.updatePowerupPinPageRTC();}}});};this.updatePowerupPinPageRTC=function(){if(mf_main.createPowerupPinPage&&mf_main.createPowerupPinPageId){mf_main.rtc.siteMapSync("addPage",mf_main.createPowerupPinPage);mf_main.createPowerupPinPage=null;mf_main.createPowerupPinPageId=null;}};this.loadProjectXML=function(){if(thisClass.projectObj.data!=null){try{thisClass.projectObj.data=jQuery.trim(thisClass.projectObj.data);$(thisClass.projectObj.data).find("gridSettings").each(function(){var jData=$("<div/>").append($(this).clone());jData.find("pageCommon").each(function(){thisClass.gridController.setXML($(this));});jData.find("grid").each(function(){if($(this).attr("type")=="mesh"){thisClass.grid=new MF_MeshGrid();thisClass.grid.setXML($(this));}if($(this).attr("type")=="960"){thisClass.grid=new MF_960Grid();thisClass.grid.setXML($(this));}});});}catch(e){}try{$(thisClass.projectObj.data).find("sizeSettings").each(function(){if($(this).attr("w")){thisClass.projectObj.origWidth=parseInt($(this).attr("w"));thisClass.projectObj.width=thisClass.projectObj.origWidth;}if($(this).attr("h")){thisClass.projectObj.origHeight=parseInt($(this).attr("h"));thisClass.projectObj.height=thisClass.projectObj.origHeight;}var autoVal=$(this).attr("autoResize");if(autoVal=="false"){thisClass.projectObj.autoResize=false;}else{thisClass.projectObj.autoResize=true;}if($(this).attr("sizeType")){thisClass.projectObj.sizeType=$(this).attr("sizeType");}});}catch(e){}try{$(thisClass.projectObj.data).find("mffontcollection mffont").each(function(){thisClass.fontController.addCustomFontItems($(this));});$(thisClass.projectObj.data).find("favourite-colors color").each(function(){var favColor=new MF_FavouriteColor();favColor.id=$(this).attr("id");favColor.code=$(this).attr("hexcode");favColor.title=$(this).attr("title");favColor.sort=$(this).attr("sortorder");thisClass.projectObj.favouriteColors.push(favColor);});thisClass.favouriteColorController.assignFavouriteColorPalette();}catch(e){}try{if(!mf_main.PUBLIC){$(thisClass.projectObj.data).find("pinned-powerups powerup").each(function(){var pinnedItem=new MF_PinnedPowerup();pinnedItem.id=$(this).attr("id");pinnedItem.sort=$(this).attr("sortorder");thisClass.projectObj.pinnedPowerups.push(pinnedItem);});}this.powerupController.openPowerupList();}catch(e){}try{if($(thisClass.projectObj.data).find("svgPackSettings").length>0){var activeSvgIconPackType=$(thisClass.projectObj.data).find("svgPackSettings").attr("activepack");mf_main.componentList.activeSvgIconPackType=activeSvgIconPackType;var activeSvgIllustrationPackType=$(thisClass.projectObj.data).find("svgIllustrationPackSettings").attr("activepack");mf_main.componentList.activeSvgIllustrationPackType=activeSvgIllustrationPackType;}}catch(e){}try{$(thisClass.projectObj.data).find("component[type='Page']").each(function(){var outerHtml=$("<div/>").append($(this).clone()).html();var jData=$(outerHtml);var page=new MF_Page();page.eid=jData.attr("eid");page.pageName=jData.attr("pageName");page.createPageData();if(jData.attr("parentPage")!=null){page.parentPage=jData.attr("parentPage");}else{page.parentPage="";}if(jData.attr("masterPage")!=null){page.masterPage=jData.attr("masterPage");}else{page.masterPage="";}if(jData.attr("navHide")=="true"){page.navHide=true;}if(jData.attr("folder")=="true"){page.folder=true;}page.e2xml.applySettings();MF_PagePool.addPage(page);});}catch(e){}if(MF_PagePool.getPages().size()==0){MF_PagePool.addNewPage();}if(mf_main.createPowerupPinPage&&mf_main.createPowerupPinPageId){var pinPage=MF_PagePool.addNewPage();pinPage.eid=mf_main.createPowerupPinPageId;mf_main.pageID=pinPage.eid;mf_main.editorController.saveTree();mf_main.createPowerupPinPage=pinPage;}thisClass.pageController.listPages();if(mf_main.pageID!=null){if(mf_main.REVISION&&mf_main.revisionID=="trash"){var page=MF_PagePool.addNewPage();page.eid=mf_main.pageID;thisClass.viewPage(page);}else{var page=MF_PagePool.getPage(mf_main.pageID);if(page==null){thisClass.viewPage(thisClass.get1stPage());}else{thisClass.viewPage(page);}if(mf_main.COMMENTMODE){if(thisClass.PERMISSION=="Reviewer"||thisClass.PUBLIC){}else{thisClass.showPreview(true);}thisClass.openNavBarContent("mfViewerNavCommentBtn");}}}else{thisClass.viewPage(thisClass.get1stPage());}var pageidslist=new Array();for(var i=0;i<MF_PagePool.getPages().size();i++){var item=MF_PagePool.getPages().getItemAt(i);if(item.folder==false){pageidslist.push(item.eid);}}thisClass.getOrphanedPages(pageidslist);}thisClass.canSave=true;if(thisClass.EDITOR){thisClass.shortcutsFlag=true;}MF_ChangeManager.CHANGED(false);mf_main.interfaceResize();thisClass.editorEvents();if(mf_main.PUBLIC){thisClass.pageController.lastViewOpened=null;if(thisClass.projectObj.urlview=="grid"){thisClass.pageController.openPageGrid();}if(thisClass.projectObj.urlview=="map"){thisClass.pageController.openPageSiteMap();}if(thisClass.projectObj.urlview=="workflow"){thisClass.pageController.openPageWorkflow();}}if(!mf_main.PUBLIC){if(thisClass.openWizardOnLoad){thisClass.openWizard();}}};this.getOrphanedPages=function(pageidslist){MF_ProjectManager.getOrphanedPages(MF_UserSession.getUser(),thisClass.projectObj.id,thisClass.projectObj.company,mf_main.PUBLIC,pageidslist,{callback:function(orphanarr){if(orphanarr!=null){for(var kl=0;kl<orphanarr.length;kl++){var pagedata=orphanarr[kl];var page=new MF_Page();page.eid=pagedata.eid;page.pageName=pagedata.name;page.parentPage="";page.folder=false;page.createPageData();page.e2xml.applySettings();MF_PagePool.addPage(page);}if(orphanarr.length>0){mf_main.editorController.pageController.listPages();mf_main.editorController.saveTree();}}}});};this.changeRotationWidth=function(component,newWidth){var ang=component.eangle*3.14/180;var calcX=newWidth-component.selector.width+(component.selector.delta*2);var transX=calcX/2;var newX=0;var newY=0;newX=-transX+transX*Math.cos(ang);newY=transX*Math.sin(ang);component.selector.y=component.selector.y+newY;component.selector.width=component.selector.width+calcX;component.selector.height=component.selector.height;component.selector.render(false);component.selector.setSize();thisClass.addSelectorResize(component.selector);};this.changeRotationHeight=function(component,newHeight){var ang=component.eangle*3.14/180;var calcY=newHeight-component.selector.height+(component.selector.delta*2);var transY=calcY/2;var newX=0;var newY=0;newX=-transY*Math.sin(ang);newY=-transY+transY*Math.cos(ang);component.selector.x=component.selector.x+newX;component.selector.y=component.selector.y+newY;component.selector.width=component.selector.width;component.selector.height=component.selector.height+calcY;component.selector.render(false);component.selector.setSize();thisClass.addSelectorResize(component.selector);};this.setSaveState=function(){$("#mfEditorSaveBtn").css("color","#fff");$("#mfEditorUnSavedMsg").hide();$("#mfUnSavedBtn").text("Save Changes");$("#mfUnSavedBtn").css("background","rgb(244, 67, 54)");$("#mfUnSavedBtn").hide();thisClass.toggleVisibleTopBar();if(!thisClass.imageController.fileUploadInProgress){if(ConfirmExit){ConfirmExit.setPrompt(false);}}};this.setUnSaveState=function(){$("#mfEditorSaveBtn").css("color","#FFEB3B");$("#mfUnSavedBtn").text("Save Changes");$("#mfUnSavedBtn").css("background","rgb(244, 67, 54)");$("#mfEditorUnSavedMsg").show();var bufleft=50;if($("#mfPageMoreArea").css("display")=="block"){bufleft=300;}$("#mfVisibleTopBar").css({position:"absolute",top:0,left:$(currentWindow).width()-$("#mfVisibleTopBar").width()-bufleft});if(thisClass.EDITOR&&thisClass.projectObj){$("#mfUnSavedBtn").fadeIn();thisClass.toggleVisibleTopBar();}if(ConfirmExit){ConfirmExit.setPrompt(true);}};this.toggleVisibleTopBar=function(){if($("#mfUnSavedBtn").css("display")=="block"||$("#mfGroupEditingNotifier").css("display")=="block"){$("#mfVisibleTopBar").show();var bufleft=50;if($("#mfPageMoreArea").css("display")=="block"){bufleft=300;}$("#mfVisibleTopBar").css({position:"absolute",top:0,left:$(currentWindow).width()-$("#mfVisibleTopBar").width()-bufleft});}else{$("#mfVisibleTopBar").hide();}};this.__defineGetter__("sidebarShow",function(){return thisClass.sidebarShowVal;});this.__defineSetter__("sidebarShow",function(val){thisClass.sidebarShowVal=val;if(val){thisClass.leftMargin=320;}else{thisClass.leftMargin=50;}});this.resizeEditor=function(){var currentWindow=window;if(mf_main.INTEGRATION){if(mf_main.INTEGRATION_TYPE=="trello"||mf_main.INTEGRATION_TYPE=="jira"||mf_main.INTEGRATION_TYPE=="confluence"||mf_main.INTEGRATION_TYPE=="office365"||mf_main.INTEGRATION_TYPE=="internal"){currentWindow="#mfEditorWrapperContainer";}}else{currentWindow=window;}if($("#mfVideoChatInterface").css("display")=="block"){thisClass.videoChatInterfaceHeight=120;if(thisClass.videoChatController&&(thisClass.videoChatController.presenter==null||thisClass.videoChatController.presenter.toLowerCase()==MF_UserSession.getUser().username.toLowerCase())){$(".mfShowSidebar").css({bottom:"145px","z-index":"99"});}else{$(".mfShowSidebar").css({bottom:"15px","z-index":"99"});}if(mf_main.editorController.sidebarShow){$(".mfShowSidebar").hide();}}else{thisClass.videoChatInterfaceHeight=0;$(".mfShowSidebar").css({bottom:"15px","z-index":"99"});}if($("#mfVideoTextChatWrapper").css("display")=="block"){if(thisClass.textChatController){thisClass.textChatController.hideAnnotationPointer();}}var rtcLeft=thisClass.leftMargin;$(".mfPopUp").height($(currentWindow).height()-thisClass.videoChatInterfaceHeight-30);$("#mfNavBarContent").height($(currentWindow).height()-thisClass.videoChatInterfaceHeight);if(thisClass.EDITOR){thisClass.placeSettingsPanel();if($("#mfTemplateSelectionPopUp").css("display")=="block"){$("#mfTemplateSelectionPopUp").height($(currentWindow).height()-thisClass.videoChatInterfaceHeight-50);}if($("#mfCompCategoryDialog").css("display")=="block"){$("#mfCompCategoryDialog").height($(currentWindow).height()-thisClass.videoChatInterfaceHeight);if(mf_main.componentList.isNewMergePack==true){$("#mfCompCategoryListing, #mfCompCategoryEmptyPlaceholder").height($("#mfCompCategoryDialog").height()-($("#mfCompCategoryHeader").outerHeight()+$("#mfNewMergePackForm").outerHeight()));}else{$("#mfCompCategoryListing, #mfCompCategoryEmptyPlaceholder").height($("#mfCompCategoryDialog").height()-$("#mfCompCategoryHeader").outerHeight());}}if($("#mfCompPackAddDiv").css("display")=="block"){$(".mfCreateNewPackWrapper").height($("#mfCompCategoryDialog").height()-$(".mfCreateNewPackHeader").outerHeight());}thisClass.toggleVisibleTopBar();$("#mfEditorHolder,#mfPageLoader").height($(currentWindow).height()-thisClass.videoChatInterfaceHeight-thisClass.editorHolderPadding);if($("#mfPageManagerArea").css("display")=="block"){$("#mfPageArea").width($(currentWindow).width()-$("#mfPageManagerArea").width()-2-thisClass.pageAreaPadding);}else{if(thisClass.videoChatInterfaceHeight==0){$("#mfPageArea").width($(currentWindow).width()-60-thisClass.pageAreaPadding);}else{$("#mfPageArea").width($(currentWindow).width()-thisClass.pageAreaPadding);}}$("#mfPageManagerArea").height($(currentWindow).height()-thisClass.videoChatInterfaceHeight);$("#mfPageArea").css("height","calc(100% - "+thisClass.videoChatInterfaceHeight+"px)");thisClass.pageController.resize();if($("#mfContentComponents").css("display")=="block"){$("#mfContentComponents").height($("#mfNavBarContent").height()-80);if($(".mfPackComponentBtnCls").css("display")=="block"||$(".mfPackOrganiseCls").css("display")=="block"){$("#mfEditorComponents").height($("#mfContentComponents").height()-$("#mfComponentListHeader").height()-$("#mfCompRecentPackListWrapper").outerHeight()-40-15);}else{$("#mfEditorComponents").height($("#mfContentComponents").height()-$("#mfComponentListHeader").height()-$("#mfCompRecentPackListWrapper").outerHeight()-40+20);}}if($("#mfContentDraw").css("display")=="block"){$("#mfContentDraw").height($("#mfNavBarContent").height()-80);}if($("#mfContentPages").css("display")=="block"){$("#mfContentPages").height($("#mfNavBarContent").height()-80);$("#mfPageList").height($("#mfContentPages").height()-$("#mfPageActionBar").height()-$("#mfPageSettingsBar").height()-10);}if($("#mfContentAItools").css("display")=="block"){$("#mfContentAItools").height($("#mfNavBarContent").height()-80);}if($("#mfContentImages").css("display")=="block"){$("#mfContentImages").height($("#mfNavBarContent").height()-80);$(".mfImgListCls").height($("#mfContentImages").height()-$("#mfImageListActionBar").height());}if(thisClass.EDITOR){if($(".mfPackComponentBtnCls").css("display")=="block"){$("#mfComponentSettings").height($("#mfNavBarContent").height()-80-35);$("#mfContentSettings").height($("#mfNavBarContent").height()-45-35);}else{$("#mfComponentSettings").css("height","100%");$("#mfContentSettings").height($("#mfNavBarContent").height()-80);}}thisClass.imageController.resize();thisClass.rtcReSize();thisClass.storeController.resize();$("#mfPageSidebarComments").height($("#mfViewerContentComments").height()-$("#mfPageSidebarHeader").height()-$("#mfPageSidebarPost").height()-70);if($("#mfPageMoreArea").css("display")=="block"){$("#mfPageArea").width($("#mfPageArea").width()-$("#mfPageMoreArea").width());$("#mfPageMoreArea").css("height","calc(100% - "+thisClass.videoChatInterfaceHeight+"px)");}}else{$("#mfEditorHolder,#mfPageLoader").height($(currentWindow).height()-thisClass.videoChatInterfaceHeight-thisClass.editorHolderPadding);if($("#mfPageManagerArea").css("display")=="block"){$("#mfPageArea").width($(currentWindow).width()-$("#mfPageManagerArea").width()-2-thisClass.pageAreaPadding);}else{$("#mfPageArea").width($(currentWindow).width()-60-thisClass.pageAreaPadding);}$("#mfPageManagerArea").height($(currentWindow).height()-thisClass.videoChatInterfaceHeight);$("#mfPageArea").css("height","calc(100% - "+thisClass.videoChatInterfaceHeight+"px)");if($("#mfContentPages").css("display")=="block"){$("#mfContentPages").height($("#mfNavBarContent").height()-70);$("#mfPageList").height($("#mfContentPages").height()-$("#mfPageToggleSettings").height()-50);}if(mf_main.PUBLIC){$("#mfPageSidebarComments").height($("#mfViewerContentComments").height()-$("#mfPageSidebarHeader").height()-$("#mfPageSidebarPost").height()-55);}else{$("#mfPageSidebarComments").height($("#mfViewerContentComments").height()-$("#mfPageSidebarHeader").height()-$("#mfPageSidebarPost").height()-70);}if(thisClass.VIEWER&&$("#mfAnnotateArrow2").css("display")=="block"){thisClass.commentController.placeCommentAnnotation("mfAnnotateArrow2",true);}if(thisClass.VIEWER&&$("#mfAnnotateArrow").css("display")=="block"){thisClass.commentController.placeCommentAnnotation("mfAnnotateArrow",true);}thisClass.pageController.resize();if(thisClass.specController){if(thisClass.specController.specControllerOpened){thisClass.specController.resize();}}}if($("#mfContentPowerup").css("display")=="block"){thisClass.powerupController.resize();}if($("#mfZoomPopup").css("display")=="block"){if(thisClass.videoChatInterfaceHeight==0){$("#mfZoomPopup").css({top:$(window).height()-85,left:65});}else{$("#mfZoomPopup").css({top:$(window).height()-(thisClass.videoChatInterfaceHeight+85),left:65});}}thisClass.cleft=$("#mfContainerPage").position().left;if(mf_main.RENDER||mf_main.REVISION){$("#mfPageLoader").css({position:"absolute",top:0,left:thisClass.cleft+100});$("#mfPageLoader").width($(currentWindow).width()-rtcLeft);$("#mfPageLoader").height($("#mfPageManagerArea").height());}else{if(mf_main.PUBLIC&&mf_main.editorController&&mf_main.editorController.powerupController&&!mf_main.editorController.powerupController.publicPowerupProcessInitialised&&mf_main.editorController.powerupController.publicURLPowerupId!=""){rtcLeft=0;}if(mf_main.PINPOWERUP){rtcLeft=0;}$("#mfPageLoader").css({position:"absolute",top:0,left:rtcLeft});$("#mfPageLoader").width($(currentWindow).width()-rtcLeft);$("#mfPageLoader").height($("#mfPageManagerArea").height());}$("#mfFontSelectionPopUp,#mfIconSelectionPopUp").hide();$("#mfNavBar").height($(currentWindow).height()-thisClass.videoChatInterfaceHeight);thisClass.resizePage();thisClass.drawController.createDrawingCanvas();};this.enableShortcuts=function(){if(thisClass.SELECTMODE){return;}if(!mf_main.editorController.pageloaded){return;}if(mf_main.editorController.pageEditorLocked){return;}if(thisClass.EDITOR){thisClass.shortcutsFlag=true;}else{thisClass.viewerShortcuts=true;}};this.rtcReSize=function(){if($("#mfRTCEditorLock").css("display")=="block"){var rtcLeft=thisClass.leftMargin;$("#mfRTCEditorLock").css({position:"absolute",top:0,left:rtcLeft});$("#mfRTCEditorLock").width($("#mfBackgroundPage").width());$("#mfRTCEditorLock").height($("#mfBackgroundPage").height());$("#mfRTCEditorLockInfo").css({position:"absolute",top:$(currentWindow).height()-$("#mfRTCEditorLockInfo").height(),left:0});}};this.disableShortcuts=function(){thisClass.shortcutsFlag=false;thisClass.viewerShortcuts=false;};this.saveHandler=function(){thisClass.saveProject(false);};this.keyShortcutHandler=function(){$(document).on("keyup",function(evt){thisClass.isShift=evt.shiftKey;thisClass.isCtrl=evt.ctrlKey;if(thisClass.VIEWER){if(evt.shiftKey==false){thisClass.hideLinkHighlights();}}if(evt.keyCode=="27"){return false;}if(evt.keyCode=="32"){$("#mfPanningDiv").hide();thisClass.pagePanning=false;$("#mfEditorHolder").css("cursor","");return false;}if(thisClass.EDITOR&&thisClass.shortcutsFlag==true){if(thisClass.lastTextEditComp){return;}if(thisClass.globalselect&&thisClass.componentSelect&&thisClass.componentSelect.length>1){if(!thisClass.isShift&&!thisClass.isCtrl){thisClass.showGlobalSelect();}}if(evt.keyCode=="8"){thisClass.editManager.deleteComponent();}if(evt.keyCode=="46"){thisClass.editManager.deleteComponent();}}});document.addEventListener("paste",function(e){var nativePaste=false;if(thisClass.EDITOR&&thisClass.shortcutsFlag&&!thisClass.editingComponent&&thisClass.pageloaded){try{var pastedata=e.clipboardData.getData("text/plain");var ver=$(pastedata).attr("mfxprojectid");if(ver&&ver!=null&&ver!=undefined&&ver!=""){if(ver==thisClass.projectObj.id){if(mf_main.editorController.editManager.copyComponents.length==0&&mf_main.editorController.editManager.cutComponents.length==0){nativePaste=true;}}else{if(mf_main.editorController.editManager.cutComponents.length==0){nativePaste=true;}}}if(nativePaste){var pastedImages=new Array();var clientid=$(pastedata).attr("mfxclientid");var offX=($("#mfEditorHolder").scrollLeft()/thisClass.SCALE)+100;var offY=($("#mfEditorHolder").scrollTop()/thisClass.SCALE)+100;mf_main.componentList.addPlaceHolderComponent(offX,offY);$(pastedata).find("mfximagecomp").each(function(){pastedImages.push($(this).attr("id"));});var customFontList=new Array();$(pastedata).find("mffont").each(function(){var customFontObj=new MF_CustomFont();customFontObj.id=$(this).attr("customfontid");customFontObj.projectid=$(this).attr("projectid");customFontObj.clientid=$(this).attr("clientid");customFontList.push(customFontObj);});thisClass.closeGroupEditing();if(pastedImages.length>0||customFontList.length>0){MF_WireframeStoreManager.pasteComponent(pastedImages,customFontList,ver,clientid,thisClass.projectObj.id,thisClass.projectObj.company,MF_UserSession.getUser().username,{callback:function(dbComponent){if(dbComponent){if(dbComponent.customFonts.length>0){for(var i=0;i<dbComponent.customFonts.length;i++){var customFontObj=dbComponent.customFonts[i];mf_main.editorController.fontController.addCustomFontHandler(customFontObj);mf_main.rtc.customFontSync("addcustomfont",customFontObj,true);}}thisClass.addDBComponent(pastedata,offX,offY);if(dbComponent.images.length>0){if(thisClass.imageController.listed){for(var p=0;p<dbComponent.images.length;p++){thisClass.imageController.imageCollection.addItemAt(dbComponent.images[p],0);}thisClass.imageController.applyTemplate(thisClass.imageController.imageCollection.toArray());}mf_main.rtc.imageSync("refreshImageListing",null);}}}});}else{thisClass.addDBComponent(pastedata,offX,offY);}return;}var isImageExists=false;var items=(e.clipboardData||e.originalEvent.clipboardData).items;for(var i=0;i<items.length;i++){if(items[i].type.indexOf("image")!==-1){isImageExists=true;}}if(nativePaste!=true&&!isImageExists){thisClass.editManager.pasteComponentCMD();}if(isImageExists){thisClass.imageController.handleEditorImagePasteHandler(e);}}catch(e){}}});document.addEventListener("copy",function(e){if(thisClass.EDITOR&&thisClass.shortcutsFlag){thisClass.editManager.copyComponent(e);}});if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1){thisClass.pluskeyCode="61";thisClass.minusKeyCode="173";}$(document).on("keydown",function(evt){if(evt.keyCode=="27"){if($("#mfBYOCGenerateWithAIModal").css("display")=="block"){mf_main.closeDialog();return false;}if(mf_main.PINPOWERUP&&$("#mfPowerupInterfaceModal").css("display")=="block"){}else{if($("#mfBYOCEditor").css("display")!="block"){mf_main.closeDialog();}}$(".mfPopUp").hide();if(thisClass.EDITOR){thisClass.shortcutsFlag=true;}if(thisClass.storeController){thisClass.storeController.closeStore();}if(thisClass.pageController){thisClass.pageController.closePageGrid();}if(thisClass.imageController){thisClass.imageController.closeImageEditor();}if(thisClass.EDITOR&&!thisClass.lastTextEditComp){if(thisClass.currentGroupEdit!=null){thisClass.closeGroupEditing();}else{if($("#mfBYOCEditor").css("display")!="block"){thisClass.clearSelection(true);}}}if(thisClass.EDITOR&&thisClass.shortcutsFlag==true){thisClass.stopEditingText();}return false;}if(thisClass.lastTextEditComp){return;}if(thisClass.EDITOR&&thisClass.shortcutsFlag){if(evt.keyCode=="32"){thisClass.pagePanning=true;$("#mfPanningDiv").show();$("#mfEditorHolder").css("cursor","grab");$("#mfEditorHolder").css("cursor","-webkit-grab");if(thisClass.page){$("#mfPanningDiv").width($("#mfPage"+mf_main.editorController.page.eid).width());$("#mfPanningDiv").height($("#mfPage"+mf_main.editorController.page.eid).height());}return false;}}if(thisClass.VIEWER&&$("input,textarea").is(":focus")){thisClass.viewerShortcuts=false;}if(thisClass.VIEWER&&thisClass.viewerShortcuts){if(evt.keyCode=="32"){thisClass.pagePanning=true;$("#mfPanningDiv").show();$("#mfEditorHolder").css("cursor","grab");$("#mfEditorHolder").css("cursor","-webkit-grab");if(thisClass.page){$("#mfPanningDiv").width($("#mfPage"+mf_main.editorController.page.eid).width());$("#mfPanningDiv").height($("#mfPage"+mf_main.editorController.page.eid).height());}return false;}}thisClass.isShift=evt.shiftKey;thisClass.isCtrl=evt.ctrlKey;if(thisClass.isCtrl==false){thisClass.isCtrl=evt.metaKey;}if(thisClass.EDITOR&&thisClass.isCtrl&&evt.keyCode=="75"){thisClass.openNavBarContent("mfNavElementBtn");thisClass.clearSelection(true);$("#mfComponentSearchBox").val("");mf_main.componentList.searchComponentHandler();$("#mfComponentSearchBox").focus();return false;}if(thisClass.isCtrl&&evt.keyCode=="73"){if(thisClass.EDITOR){thisClass.showPreview();}else{thisClass.showEditor();}return false;}if(thisClass.EDITOR&&thisClass.isCtrl&&evt.keyCode=="69"){thisClass.exportWireframe();return false;}if(thisClass.isCtrl&&evt.keyCode==thisClass.pluskeyCode){if($("#mfPageGridInterface").css("display")=="block"&&$("#mfPageSiteMapView").css("display")=="block"){thisClass.pageController.sitemapController.zoomPlus();}else{if($("#mfStoreInterface").css("display")=="block"&&$("#mfStoreTemplateViewer").css("display")=="block"){thisClass.storeController.zoomIn();}else{if($("#mfImageEditorInterface").css("display")=="block"){thisClass.imageController.imageEditorController.pinchToZoomScale("add");}else{thisClass.zoomPlus();}}}return false;}if(thisClass.isCtrl&&evt.keyCode==thisClass.minusKeyCode){if($("#mfPageGridInterface").css("display")=="block"&&$("#mfPageSiteMapView").css("display")=="block"){thisClass.pageController.sitemapController.zoomMinus();}else{if($("#mfStoreInterface").css("display")=="block"&&$("#mfStoreTemplateViewer").css("display")=="block"){thisClass.storeController.zoomOut();}else{if($("#mfImageEditorInterface").css("display")=="block"){thisClass.imageController.imageEditorController.pinchToZoomScale("sub");}else{thisClass.zoomMinus();}}}return false;}if(thisClass.EDITOR){if(thisClass.isCtrl&&evt.keyCode=="83"){thisClass.saveProject(false);return false;}}if(thisClass.VIEWER){if(thisClass.isShift){thisClass.showLinkHighlights(true);}}if(thisClass.EDITOR&&thisClass.shortcutsFlag==true){if(thisClass.globalselect&&thisClass.componentSelect&&thisClass.componentSelect.length>1){if(thisClass.isShift||thisClass.isCtrl){thisClass.hideGlobalSelect();}else{thisClass.showGlobalSelect();}}if(thisClass.isCtrl&&thisClass.isShift&&evt.keyCode=="76"){thisClass.editManager.unLockComponent();return false;}if(!thisClass.isShift){if(thisClass.isCtrl&&evt.keyCode=="76"){thisClass.editManager.lockComponent();return false;}if(thisClass.isCtrl&&evt.keyCode=="65"){thisClass.selectAll();return false;}if(thisClass.isCtrl&&evt.keyCode=="67"){}if(thisClass.isCtrl&&evt.keyCode=="68"){thisClass.editManager.duplicateComponent();return false;}if(thisClass.isCtrl&&evt.keyCode=="86"){}if(thisClass.isCtrl&&evt.keyCode=="88"){thisClass.editManager.cutComponent();return false;}if(thisClass.isCtrl&&evt.keyCode=="82"){thisClass.editManager.resetRotation();return false;}if(thisClass.isCtrl&&evt.keyCode=="90"){thisClass.editManager.undo();return false;}if(thisClass.isCtrl&&evt.keyCode=="89"){thisClass.editManager.redo();return false;}if(thisClass.isCtrl&&evt.keyCode=="71"){thisClass.editManager.groupComponents();return false;}if(thisClass.isCtrl&&evt.keyCode=="40"){thisClass.editManager.sendBackward();return false;}if(thisClass.isCtrl&&evt.keyCode=="38"){thisClass.editManager.sendForward();return false;}}if(thisClass.isCtrl&&thisClass.isShift&&evt.keyCode=="40"){thisClass.editManager.sendBack();return false;}if(thisClass.isCtrl&&thisClass.isShift&&evt.keyCode=="38"){thisClass.editManager.sendFront();return false;}if(thisClass.isCtrl&&thisClass.isShift&&evt.keyCode=="71"){thisClass.editManager.unGroupComponents();return false;}if(evt.keyCode=="38"){thisClass.removeSelectorResize();if(thisClass.globalselect){if(thisClass.isShift){thisClass.globalselect.y=thisClass.globalselect.y-10;thisClass.globalselect.render(false);}else{thisClass.globalselect.y=thisClass.globalselect.y-1;thisClass.globalselect.render(false);}}thisClass.movePosition(thisClass.isShift,"up");if(thisClass.componentSelect.length>0){return false;}}if(evt.keyCode=="40"){thisClass.removeSelectorResize();if(thisClass.globalselect){if(thisClass.isShift){thisClass.globalselect.y=thisClass.globalselect.y+10;thisClass.globalselect.render(false);}else{thisClass.globalselect.y=thisClass.globalselect.y+1;thisClass.globalselect.render(false);}}thisClass.movePosition(thisClass.isShift,"down");if(thisClass.componentSelect.length>0){return false;}}if(evt.keyCode=="37"){thisClass.removeSelectorResize();if(thisClass.globalselect){if(thisClass.isShift){thisClass.globalselect.x=thisClass.globalselect.x-10;thisClass.globalselect.render(false);}else{thisClass.globalselect.x=thisClass.globalselect.x-1;thisClass.globalselect.render(false);}}thisClass.movePosition(thisClass.isShift,"left");if(thisClass.componentSelect.length>0){return false;}}if(evt.keyCode=="39"){thisClass.removeSelectorResize();if(thisClass.globalselect){if(thisClass.isShift){thisClass.globalselect.x=thisClass.globalselect.x+10;thisClass.globalselect.render(false);}else{thisClass.globalselect.x=thisClass.globalselect.x+1;thisClass.globalselect.render(false);}}thisClass.movePosition(thisClass.isShift,"right");if(thisClass.componentSelect.length>0){return false;}}}});};this.getAllComponentSelects=function(){var arr=new Array();thisClass.recursiveComponentSelection(mf_main.editorController.componentSelect,arr);return arr;};this.recursiveComponentSelection=function(selections,arr){for(var key in selections){var select=selections[key];if(select.GROUP){thisClass.recursiveComponentSelection(select.globalselects,arr);}else{arr.push(select);}}};this.zoomPlus=function(e){if(e){e.stopImmediatePropagation();}$(".mfZoomBarBtns").css("color","#fff");if(thisClass.SCALE<3.1){thisClass.SCALE=thisClass.SCALE+0.1;thisClass.zoomPage();}else{$("#mfZoomBarPlusBtn").css("color","#888");}};this.zoomMinus=function(e){if(e){e.stopImmediatePropagation();}$(".mfZoomBarBtns").css("color","#fff");if(thisClass.SCALE>0.2){thisClass.SCALE=thisClass.SCALE-0.1;thisClass.zoomPage();}else{$("#mfZoomBarMinusBtn").css("color","#888");}};this.startEditingText=function(spressed,type){if(thisClass.RENDER||thisClass.VIEWER){return;}thisClass.editingComponent=true;thisClass.reStackComponents();if(thisClass.lastTextEditComp.NAME!="MF_AdvancedDataGrid"){thisClass.removeSelectorResize();}mf_main.editorController.disableShortcuts();$("#mfEditorHolder").css("user-select","text");$("#mfEditorHolder").css("-webkit-user-select","text");$("#mfEditorHolder").css("-moz-user-select","text");if(thisClass.lastTextEditComp.NAME=="MF_Text"){$("#"+thisClass.lastTextEditComp.selector.id).hide();$("#"+thisClass.lastTextEditComp.eid).css("outline","none");$("#"+thisClass.lastTextEditComp.eid).css("border","1px dotted #666");$("#"+thisClass.lastTextEditComp.eid).css("user-select","text");$("#"+thisClass.lastTextEditComp.eid).css("-webkit-user-select","text");$("#"+thisClass.lastTextEditComp.eid).css("-moz-user-select","text");var posx=parseInt((thisClass.lastTextEditComp.x+thisClass.lastTextEditComp.width)*thisClass.SCALE);var posy=parseInt((thisClass.lastTextEditComp.y+thisClass.lastTextEditComp.height)*thisClass.SCALE);var vx=$("#mfEditorHolder").width()+$("#mfEditorHolder").scrollLeft();if(posx>vx){$("#mfEditorHolder").scrollLeft($("#mfEditorHolder").scrollLeft()+(posx-vx)+200);}var vy=$("#mfEditorHolder").height()+$("#mfEditorHolder").scrollTop();if(posy>vy){$("#mfEditorHolder").scrollTop($("#mfEditorHolder").scrollTop()+(posy-vy)+50);}if(thisClass.lastTextEditComp.MULTILINE==false){$("#"+thisClass.lastTextEditComp.eid).on("keypress",function(event){if(event.which=="13"){return false;}});}if(!!document.createRange){document.getSelection().removeAllRanges();}thisClass.editingComponentDiv=$("#"+thisClass.lastTextEditComp.eid).summernote({height:200,airMode:true,focus:true,onPaste:function(e){var bufferText=((e.originalEvent||e).clipboardData||window.clipboardData).getData("Text");e.preventDefault();document.execCommand("insertText",false,bufferText);},airPopover:[["style",["bold","italic","underline","clear"]],["font",["strikethrough","superscript","subscript"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol"]]]});$("#"+thisClass.lastTextEditComp.eid).attr("contenteditable","true");$("#"+thisClass.lastTextEditComp.eid).focus();}else{if(thisClass.lastTextEditComp.NAME=="MF_BYOC"){$("#"+thisClass.lastTextEditComp.selector.id).hide();$("#"+thisClass.lastTextEditComp.eid).css("outline","none");$("#"+thisClass.lastTextEditComp.eid).css("border","1px dotted #666");$("#"+thisClass.lastTextEditComp.eid).css("user-select","text");$("#"+thisClass.lastTextEditComp.eid).css("-webkit-user-select","text");$("#"+thisClass.lastTextEditComp.eid).css("-moz-user-select","text");thisClass.contentEditController.startContentEditor(thisClass.lastTextEditComp);}else{thisClass.lastTextEditComp.selector.setVisible(true);var editingBox="";if(thisClass.lastTextEditComp.MULTILINE){editingBox='<textarea class="form-control" style="position: absolute; font-size: 16px;" id="mfEditingBox" >'+thisClass.lastTextEditComp.text+"</textarea>";}else{var txt="";if(thisClass.lastTextEditComp.text){txt=thisClass.lastTextEditComp.text.replace(/"/g,"&quot;");}editingBox='<input class="form-control" style="position: absolute; font-size: 16px;" id="mfEditingBox" value="'+txt+'"></input>';}if(thisClass.lastTextEditComp.NAME=="MF_AdvancedDataGrid"&&thisClass.lastTextEditComp.selectedCellId){editingBox='<div contenteditable="true" class="form-control" style="position: absolute;border: solid 1px #2696f3;padding: 5px;" id="mfEditingBox"></div>';}$("#mfContainerPage").append(editingBox);$("#mfEditingBox").css("z-index",(thisClass.page.stackOrder.size()*2)+100);if(thisClass.lastTextEditComp.NAME=="MF_AdvancedDataGrid"){if(thisClass.lastTextEditComp.gridEditMode&&thisClass.lastTextEditComp.selectedCellId){thisClass.lastTextEditComp.selector.setVisible(false);if(thisClass.selectorResize){$("#"+thisClass.selectorResize.id).hide();}var cellId=thisClass.lastTextEditComp.selectedCellId;var cellObj=thisClass.lastTextEditComp.getCellObjbyId(cellId);$("#mfEditingBox").css({height:cellObj.height+"px",width:cellObj.width+"px",resize:"none",display:"block","align-items":"center",overflow:"auto"});$("#mfEditingBox").html(MF_Utils.htmlDecode(cellObj.text));var offsetYPos=($("#mfContainerPage").position().top)/thisClass.SCALE;var offsetXPos=($("#mfContainerPage").position().left)/thisClass.SCALE;$("#mfEditingBox").css("top",$("#"+cellId).offset().top/thisClass.SCALE-offsetYPos+"px");$("#mfEditingBox").css("left",$("#"+cellId).offset().left/thisClass.SCALE-offsetXPos+"px");thisClass.editingComponentDiv=$("#mfEditingBox").summernote({height:200,airMode:true,focus:true,onPaste:function(e){var bufferText=((e.originalEvent||e).clipboardData||window.clipboardData).getData("Text");e.preventDefault();document.execCommand("insertText",false,bufferText);},airPopover:[["style",["bold","italic","underline","clear"]],["font",["strikethrough","superscript","subscript"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol"]]]});setTimeout(function(){if(thisClass.editingComponentDiv){$("#"+thisClass.editingComponentDiv[0].id).summernote("editor.focus");}},100);}else{thisClass.lastTextEditComp.gridEditMode=true;if(!thisClass.gridEditor){thisClass.gridEditor=new MF_AdvancedGridEditor();}thisClass.gridEditor.component=thisClass.lastTextEditComp;thisClass.gridEditor.render();thisClass.lastTextEditComp.selector.setVisible(false);thisClass.lastTextEditComp=null;$("#mfEditingBox").remove();return;}}else{if(thisClass.lastTextEditComp.width<200){$("#mfEditingBox").css("width",200);}else{$("#mfEditingBox").css("width",thisClass.lastTextEditComp.width);}if(thisClass.lastTextEditComp.MULTILINE){$("#mfEditingBox").css("height",200);}$("#mfEditingBox").css("top",thisClass.lastTextEditComp.y);$("#mfEditingBox").css("left",thisClass.lastTextEditComp.x);}$("#mfEditingBox").focus();$("#mfEditingBox").select();$("#mfEditingBox").focusout(function(){thisClass.stopEditingText();});$("#mfEditingBox").on("keypress",function(event){if(event.which=="13"){if(thisClass.lastTextEditComp&&!thisClass.lastTextEditComp.MULTILINE){thisClass.stopEditingText();return false;}}});}}};this.stopEditingText=function(spressed,type){thisClass.editingComponent=false;$("#mfEditorHolder").css("user-select","none");$("#mfEditorHolder").css("-webkit-user-select","none");$("#mfEditorHolder").css("-moz-user-select","none");if(thisClass.lastTextEditComp){if(thisClass.lastTextEditComp.NAME=="MF_Text"){try{$(".btn-sm").tooltip("destroy");}catch(e){}var txt=$("#"+thisClass.editingComponentDiv.attr("id")).html();$("#"+thisClass.lastTextEditComp.eid).summernote("destroy");$("#"+thisClass.editingComponentDiv.attr("id")).remove();$(".note-air-layout").remove();thisClass.editingComponentDiv=null;$("#"+thisClass.lastTextEditComp.selector.id).show();$("#"+thisClass.lastTextEditComp.eid).off("mousedown");$("#"+thisClass.lastTextEditComp.eid).off("focusout");$("#mfEditorHolder").css("user-select","none");$("#mfEditorHolder").css("-webkit-user-select","none");$("#mfEditorHolder").css("-moz-user-select","none");$("#"+thisClass.lastTextEditComp.eid).css("border","none");$("#"+thisClass.lastTextEditComp.eid).css("user-select","none");$("#"+thisClass.lastTextEditComp.eid).css("-webkit-user-select","none");$("#"+thisClass.lastTextEditComp.eid).css("-moz-user-select","none");$("#mfPage"+mf_main.editorController.page.eid).css("overflow","hidden");thisClass.lastTextEditComp.selector.setVisible(true);$("#"+thisClass.lastTextEditComp.eid).attr("contenteditable","false");txt=MF_Utils.htmlEncode(txt);if(thisClass.lastTextEditComp.text!=txt){thisClass.lastTextEditComp.e2xml.addPropSingle("text",txt);}}else{if(thisClass.lastTextEditComp.NAME=="MF_BYOC"){$("#"+thisClass.lastTextEditComp.selector.id).show();$("#"+thisClass.lastTextEditComp.eid).off("mousedown");$("#"+thisClass.lastTextEditComp.eid).off("focusout");$("#mfEditorHolder").css("user-select","none");$("#mfEditorHolder").css("-webkit-user-select","none");$("#mfEditorHolder").css("-moz-user-select","none");$("#"+thisClass.lastTextEditComp.eid).css("border","none");$("#"+thisClass.lastTextEditComp.eid).css("user-select","none");$("#"+thisClass.lastTextEditComp.eid).css("-webkit-user-select","none");$("#"+thisClass.lastTextEditComp.eid).css("-moz-user-select","none");$("#mfPage"+mf_main.editorController.page.eid).css("overflow","hidden");thisClass.lastTextEditComp.selector.setVisible(true);thisClass.contentEditController.stopEditor();return;}else{if(thisClass.lastTextEditComp.NAME=="MF_AdvancedDataGrid"&&thisClass.editingComponentDiv){$("#"+thisClass.lastTextEditComp.selector.id).show();thisClass.lastTextEditComp.selector.setVisible(false);var txt="";if($("#"+thisClass.editingComponentDiv.attr("id")).text().trim()!=""){txt=$("#"+thisClass.editingComponentDiv.attr("id")).html();}$("#"+thisClass.editingComponentDiv.attr("id")).summernote("destroy");$("#"+thisClass.editingComponentDiv.attr("id")).remove();$(".note-air-layout").remove();thisClass.editingComponentDiv=null;var cellObj=thisClass.lastTextEditComp.getCellObjbyId(thisClass.lastTextEditComp.selectedCellId);if(cellObj.text!=MF_Utils.htmlEncode(txt)){cellObj.text=MF_Utils.htmlEncode(txt);cellObj.text=cellObj.text.trim();thisClass.lastTextEditComp.e2xml.addPropSingle("gridLayout",JSON.stringify(thisClass.lastTextEditComp.layoutJSON));}if(thisClass.selectorResize){$("#"+thisClass.selectorResize.id).show();}}else{$("#"+thisClass.lastTextEditComp.selector.id).show();thisClass.lastTextEditComp.selector.setVisible(true);var txt=$("#mfEditingBox").val();txt=MF_Utils.htmlEncode(txt);if(thisClass.lastTextEditComp.text!=txt){thisClass.lastTextEditComp.e2xml.addPropSingle("text",txt);}}}}$("#mfEditingBox").remove();if(thisClass.lastTextEditComp.NAME=="MF_AdvancedDataGrid"){thisClass.lastTextEditComp.render(false);}else{thisClass.lastTextEditComp.render();}thisClass.lastTextEditComp=null;thisClass.reStackComponents();mf_main.editorController.enableShortcuts();}};this.movePosition=function(spressed,type){if(thisClass.globalselect){thisClass.rePositionComponents(thisClass.globalselect);}else{var undoarr=new Array();for(var i=0;i<mf_main.editorController.componentSelect.length;i++){var select=mf_main.editorController.componentSelect[i];if(!select.locked){if(!select.GROUP){if(select.component&&select.component.NAME!="MF_ArrowPath"){var undo=new MF_UndoDAO();undo.propObjectUndo(select.component,"ecoordinates",select.component.ecoordinates);undoarr.push(undo);}}if(type=="up"){if(spressed){select.y=select.y-10;}else{select.y=select.y-1;}}if(type=="down"){if(spressed){select.y=select.y+10;}else{select.y=select.y+1;}}if(type=="left"){if(spressed){select.x=select.x-10;}else{select.x=select.x-1;}}if(type=="right"){if(spressed){select.x=select.x+10;}else{select.x=select.x+1;}}if(thisClass.RESTRICT_SIZE){if((select.x+select.width)>(mf_main.editorController.RESTRICT_SIZE_LIMIT)||(select.y+select.height)>(mf_main.editorController.RESTRICT_SIZE_LIMIT)){thisClass.displaySizeRestiction();}}if(select.GROUP){var arr=thisClass.rePositionComponents(select);for(var j=0;j<arr.length;j++){var udo=arr[j];if(select.component&&select.component.NAME!="MF_ArrowPath"){undoarr[undoarr.length]=udo;}}thisClass.page.groupManager.resetParentSelectorGroups(select.GROUPID);}else{if(select.component&&select.component.TRANSFORM){select.component.x=select.x+select.delta;select.component.y=select.y+select.delta;if(select.component.NAME=="MF_ArrowPath"){select.component.isComponentMoved=true;select.component.undoFlag=true;}select.component.computePoints();}thisClass.removeSelectorResize();thisClass.removeSelectorTransform();select.setCoordinate(false,false);}MF_ChangeManager.CHANGED(true);}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);meta.reselectMeta=true;undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}}try{if(thisClass.lastSetting&&thisClass.lastSetting.selector){thisClass.lastSetting.selector.x=thisClass.lastSetting.selector.x/thisClass.SCALE;thisClass.lastSetting.selector.y=thisClass.lastSetting.selector.y/thisClass.SCALE;if(thisClass.lastSetting){thisClass.lastSetting.updateTransform();}thisClass.lastSetting.selector.x=thisClass.lastSetting.selector.x*thisClass.SCALE;thisClass.lastSetting.selector.y=thisClass.lastSetting.selector.y*thisClass.SCALE;}}catch(e){}if(thisClass.currentGroupEdit!=null){thisClass.page.groupManager.resetParentSelectorGroups(thisClass.currentGroupEdit);}};this.initEditor=function(){thisClass.editManager=new MF_EditManager();thisClass.blankProject();};this.getProjectXML=function(){var projectData="<wireframe>";projectData=projectData+"<gridSettings>";if(thisClass.grid){projectData=projectData+thisClass.grid.getXML();}projectData=projectData+thisClass.gridController.getXML();projectData=projectData+"</gridSettings>";projectData=projectData+"<sizeSettings ";if(thisClass.projectObj.autoResize){projectData=projectData+" autoResize='true' ";}else{projectData=projectData+" autoResize='false' ";}projectData=projectData+" sizeType='"+thisClass.projectObj.sizeType+"' ";projectData=projectData+" w='"+thisClass.projectObj.origWidth+"' ";projectData=projectData+" h='"+thisClass.projectObj.origHeight+"' ";projectData=projectData+"></sizeSettings>";projectData=projectData+thisClass.fontController.getFontXML();projectData=projectData+thisClass.favouriteColorController.getFavouriteColorXML();projectData=projectData+mf_main.componentList.getActiveSvgIconPackTypeXML();projectData=projectData+mf_main.componentList.getActiveSvgIllustrationPackTypeXML();projectData=projectData+thisClass.powerupController.getPinnedPowerupXML();for(var i=0;i<MF_PagePool.getPages().size();i++){var component=MF_PagePool.getPages().getItemAt(i);var eid=' eid="'+component.eid+'" ';var pname=component.pageName;if(pname==component.eid){pname="Page ";}var pageName=' pageName="'+pname+'" ';var parentPage=component.parentPage;if(parentPage==null){parentPage="";}var folder=component.folder;if(folder==null){folder="false";}var parentPageTxt=' parentPage="'+parentPage+'" ';var masterPageTxt=' masterPage="'+component.masterPage+'" ';var folderTxt=' folder="'+folder+'" ';var navHideTxt=' navHide="'+component.navHide.toString()+'" ';var master="";projectData=projectData+' <component type="Page" '+eid+pageName+parentPageTxt+masterPageTxt+folderTxt+navHideTxt+master+" ></component>";}projectData=projectData+"</wireframe>";projectData=projectData.replace(/(xmlns *= *[\"'].[^\"']*[\"'])/ig,"");return projectData;};this.saveTree=function(){if(thisClass.EDITOR){thisClass.projectObj.data=thisClass.getProjectXML();MF_ProjectManager.saveNew(MF_UserSession.getUser(),thisClass.projectObj,{callback:function(result){if(mf_main.editorController.videoChatController!=null){mf_main.editorController.videoChatController.triggerPageChange();}}});}};this.saveProject=function(createRevision){if(thisClass.VIEWER||mf_main.RENDER){return;}if(thisClass.canSave){if(thisClass.PERMISSION=="Reviewer"||thisClass.PUBLIC){return;}if(createRevision==undefined||createRevision==null){createRevision=false;}$("#mfUnSavedBtn").css("background","#ccc");$("#mfUnSavedBtn").text("Saving...");var savecount=0;thisClass.saveTree();var unsavedpages=new ArrayCollection();for(var i=0;i<MF_PagePool.getPages().size();i++){var itemsave=MF_PagePool.getPages().getItemAt(i);if(itemsave.changed&&itemsave.folder==false){unsavedpages.addItem(itemsave);}}savecount=unsavedpages.size();if(savecount<=0){MF_ChangeManager.CHANGED(false);}for(var k=0;k<unsavedpages.size();k++){var item=unsavedpages.getItemAt(k);if(item.changed&&item.folder==false){item.pagedata.data=MF_Utils.xmlToString(item.e2xml.formXML("pageonly"));item.pagedata.data=item.pagedata.data.replace(/(xmlns *= *[\"'].[^\"']*[\"'])/ig,"");item.pagedata.name=item.pageName;item.changed=false;item.pagedata.snapped=false;var unsnapArr=new Array();unsnapArr.push(item.eid);thisClass.unSnapPage(item,unsnapArr);for(var h=0;h<unsnapArr.length;h++){var pid=unsnapArr[h];thisClass.editManager.gridSS[pid]=true;thisClass.editManager.mapSS[pid]=true;thisClass.editManager.workflowSS[pid]=true;}var restored=null;var pagedata=new MF_PageData();pagedata.cast(item.pagedata);pagedata.data="";try{var binaryString=pako.gzip(item.pagedata.data,{to:"string"});restored=btoa(binaryString);}catch(e){}MF_ProjectManager.savePage(MF_UserSession.getUser(),pagedata,unsnapArr,false,restored,{callback:function(result){if(result==null){MF_ProjectManager.savePage(MF_UserSession.getUser(),item.pagedata,unsnapArr,false,{callback:function(result){savecount--;if(savecount<=0){thisClass.snapScreenshot(unsavedpages);}},errorHandler:function(errorString,exception){MF_Utils.display_ActionIndicator("Cannot save due to server issue. Try again");if(item){item.changed=true;}savecount--;if(savecount<=0){if(unsavedpages.getItemIndex(item)!=-1){unsavedpages.removeItemAt(unsavedpages.getItemIndex(item));}thisClass.snapScreenshot(unsavedpages);}MF_ChangeManager.CHANGED(true);}});}else{savecount--;if(savecount<=0){thisClass.snapScreenshot(unsavedpages);}}},errorHandler:function(errorString,exception){MF_Utils.display_ActionIndicator("Cannot save due to server issue. Try again");if(item){item.changed=true;}savecount--;if(savecount<=0){if(unsavedpages.getItemIndex(item)!=-1){unsavedpages.removeItemAt(unsavedpages.getItemIndex(item));}thisClass.snapScreenshot(unsavedpages);}MF_ChangeManager.CHANGED(true);}});}}if(thisClass.revisionController.firstAutoRevision){thisClass.revisionController.firstAutoRevision=false;}}else{MF_Utils.display_ActionIndicator("Cannot save. Try again");}};this.snapScreenshot=function(unsavedpages){var takeScreenshot=false;MF_ChangeManager.CHANGED(false);for(var m=0;m<unsavedpages.size();m++){var citem=unsavedpages.getItemAt(m);mf_main.rtc.siteMapSync("savePage",citem);mf_main.rtc.editorSync("unlockEditing",citem);}if(unsavedpages.length>1){takeScreenshot=true;}if(thisClass.lastShotTime==0){takeScreenshot=true;}if(takeScreenshot==false){try{var currentTime=Date.now();var seconds=((currentTime-thisClass.lastShotTime)/1000);if(seconds>50){takeScreenshot=true;}}catch(e){takeScreenshot=true;}}takeScreenshot=true;if(takeScreenshot==true){thisClass.lastShotTime=Date.now();for(var m=0;m<unsavedpages.size();m++){var citem=unsavedpages.getItemAt(m);MF_ProjectManager.createPageScreenshotChrome(thisClass.projectObj.id,thisClass.projectObj.company,citem.eid,{callback:function(r){}});}}};this.unSnapPage=function(pageObj,unsnapArr){for(var k=0;k<MF_PagePool.getPages().size();k++){var pitem=MF_PagePool.getPages().getItemAt(k);if(pitem.folder==false){if(pitem.masterPage==pageObj.eid){pitem.pagedata.snapped=false;var allow=true;for(var m=0;m<unsnapArr.length;m++){if(pitem.eid==unsnapArr[m]){allow=false;}}if(allow){unsnapArr.push(pitem.eid);thisClass.unSnapPage(pitem,unsnapArr);}}}}};this.saveRevision=function(createRevision){if(thisClass.VIEWER){return;}if(thisClass.canSave){if(thisClass.PERMISSION=="Reviewer"||thisClass.PUBLIC){return;}if(createRevision==undefined||createRevision==null){createRevision=false;}if(thisClass.page.changed&&thisClass.EDITOR&&MF_ChangeManager.getCHANGED()==true&&thisClass.page.revisionChanged){thisClass.page.revisionChanged=false;thisClass.page.pagedata.data=MF_Utils.xmlToString(thisClass.page.e2xml.formXML("pageonly"));thisClass.page.pagedata.data=thisClass.page.pagedata.data.replace(/(xmlns *= *[\"'].[^\"']*[\"'])/ig,"");var restored=null;var pagedata=new MF_PageData();pagedata.cast(thisClass.page.pagedata);pagedata.data="";try{var binaryString=pako.gzip(thisClass.page.pagedata.data,{to:"string"});restored=btoa(binaryString);}catch(e){}MF_ProjectManager.saveRevision(MF_UserSession.getUser(),pagedata,createRevision,thisClass.revisionController.firstAutoRevision,restored,{callback:function(result){if(result==null){MF_ProjectManager.saveRevision(MF_UserSession.getUser(),thisClass.page.pagedata,createRevision,thisClass.revisionController.firstAutoRevision,{callback:function(result){}});}}});}if(thisClass.revisionController.firstAutoRevision){thisClass.revisionController.firstAutoRevision=false;}}};this.selectHighlight=function(obj){if(thisClass.globalSelect!=null){thisClass.removeGlobalSelect();}obj.Select();thisClass.addComponentSelect(obj);};this.addComponentSelect=function(obj){var add=true;for(var i=0;i<thisClass.componentSelect.length;i++){var select=thisClass.componentSelect[i];if(select==obj){add=false;break;}}if(add){thisClass.componentSelect.push(obj);}};this.removeComponentSelect=function(obj){var arr=new Array();for(var i=0;i<thisClass.componentSelect.length;i++){var select=thisClass.componentSelect[i];if(select!=obj){arr.push(select);}}thisClass.componentSelect=arr;};this.showGlobalSelect=function(){if(thisClass.globalselect){$("#"+thisClass.globalselect.id).css("pointer-events","auto");$("#"+thisClass.globalselect.id).css("opacity",1);}if(thisClass.selectorResize){$("#"+thisClass.selectorResize.id).css("pointer-events","none");}};this.hideGlobalSelect=function(){if(thisClass.globalselect){$("#"+thisClass.globalselect.id).css("pointer-events","none");$("#"+thisClass.globalselect.id).css("opacity",0);}if(thisClass.selectorResize){$("#"+thisClass.selectorResize.id).css("pointer-events","none");}};this.editText=function(){if(thisClass.RENDER||thisClass.VIEWER){return;}thisClass.lastTextEditComp=thisClass.selectorResize.selector.component;thisClass.selectorResize.selector.setVisible(false);thisClass.selectorResize.setVisible(false);thisClass.startEditingText();};this.addSelectorResize=function(selector,nolayer){if(selector==null){return;}if(selector.component&&selector.component==thisClass.lastTextEditComp){return;}if(selector.UNEDIT){return;}thisClass.stopEditingText();if(selector&&thisClass.selectorResize){thisClass.selectorResize.x=selector.x;thisClass.selectorResize.y=selector.y;thisClass.selectorResize.width=selector.width;thisClass.selectorResize.height=selector.height;thisClass.selectorResize.angle=selector.angle;thisClass.selectorResize.selector=selector;thisClass.selectorResize.render(false);$("#"+thisClass.selectorResize.id).css("z-index",thisClass.page.stackOrder.size()+20);thisClass.selectorResize.setLocking(selector.locked);$("#mfclipboard").focus();$("#mfclipboard").blur();$("#"+thisClass.selectorResize.id+"_holder").css("pointer-events","none");$("#"+thisClass.selectorResize.id).css("pointer-events","none");if(selector&&selector.component&&selector.component.TRANSFORM){$("#"+thisClass.selectorResize.id).hide();}else{$("#"+thisClass.selectorResize.id).show();}if(selector==thisClass.globalselect){if(thisClass.isShift||thisClass.isCtrl){thisClass.hideGlobalSelect();}else{thisClass.showGlobalSelect();}}thisClass.openSetting(thisClass.selectorResize.selector);if(nolayer){}else{if(thisClass.selectorResize.selector.GROUP){thisClass.layersController.selectNode("mfgrp_"+thisClass.selectorResize.selector.GROUPID);}else{if(thisClass.selectorResize.selector.component){thisClass.layersController.selectNode("lay_"+thisClass.selectorResize.selector.component.eid);}}}}};this.addSelectorResizePerPage=function(selector){if(thisClass.selectorResize){$("#"+thisClass.selectorResize.id).remove();}thisClass.selectorResize=new MF_SelectorResize();thisClass.selectorResize.render();$("#"+thisClass.selectorResize.id).hide();$("#"+thisClass.selectorResize.id).on("dblclick",function(event){if(thisClass.RENDER||thisClass.VIEWER){return;}event.stopImmediatePropagation();if(thisClass.selectorResize.selector&&thisClass.selectorResize.selector.component&&thisClass.selectorResize.selector.component.EDITABLE){thisClass.editText();}else{if(thisClass.selectorResize.selector&&thisClass.selectorResize.selector.GROUP){if(thisClass.selectorResize.selector.GROUP&&thisClass.selectorResize.selector.GROUPID!=""){thisClass.performGroupEditing(thisClass.selectorResize.selector.GROUPID);}}}});$("#"+thisClass.selectorResize.id).on("click",function(event){if(thisClass.RENDER||thisClass.VIEWER){return;}var allow=true;var cname=$(event.target).prop("className");if(cname&&cname.indexOf("drag")>-1){allow=false;}if(thisClass.selectorResize.selector&&thisClass.selectorResize.selector.GLOBAL_SELECT){allow=true;}if(allow){event.stopImmediatePropagation();if(thisClass.selectorResize.selector&&thisClass.selectorResize.selector.GLOBAL_SELECT==false){thisClass.openSetting(thisClass.selectorResize.selector);}}});$("#"+thisClass.selectorResize.id).mousedown(function(event){if(thisClass.RENDER||thisClass.VIEWER){return;}if(thisClass.editingComponent){return;}if(!thisClass.lastTextEditComp&&thisClass.EDITOR){thisClass.shortcutsFlag=true;}$(".mfcustom-menu").hide();var cname=$(event.target).prop("className");var allowSelection=false;if(cname&&cname.indexOf("drag")>-1){allowSelection=true;}if(thisClass.selectorResize.selector&&thisClass.selectorResize.selector.GLOBAL_SELECT){allowSelection=false;}if(allowSelection){thisClass.selectComponentByUser(event);}else{event.stopPropagation();thisClass.selectedComponent=null;thisClass.isDrag=false;thisClass.movedObject=false;thisClass.stopEditingText();}});$("#"+thisClass.selectorResize.id).drag("start",function(ev,dd){if(thisClass.RENDER||thisClass.VIEWER){return;}var allow=true;if(dd.attr&&dd.attr.indexOf("drag")>-1){if(thisClass.isShift||thisClass.isCtrl){return;}}if(thisClass.selectorResize.selector&&thisClass.selectorResize.selector.GLOBAL_SELECT){allow=true;}if(allow){ev.stopImmediatePropagation();if(!thisClass.selectorResize.locked){if(thisClass.selectorResize.selector&&thisClass.selectorResize.selector.component){if(thisClass.selectorResize.selector.component.TRANSFORM){var posObject=new Object();posObject.startX=thisClass.selectorResize.selector.component.startX;posObject.startY=thisClass.selectorResize.selector.component.startY;posObject.endX=thisClass.selectorResize.selector.component.endX;posObject.endY=thisClass.selectorResize.selector.component.endY;thisClass.selectorResize.selector.component.prevEcoordinates=posObject;}else{var posObject=new Object();posObject.x=thisClass.selectorResize.selector.component.x;posObject.y=thisClass.selectorResize.selector.component.y;thisClass.selectorResize.selector.component.prevEcoordinates=posObject;var szObject=new Object();szObject.width=thisClass.selectorResize.selector.component.width;szObject.height=thisClass.selectorResize.selector.component.height;thisClass.selectorResize.selector.component.prevEsize=szObject;}}if(!thisClass.CROPMODE){if(thisClass.selectorResize.selector&&thisClass.selectorResize.selector.component&&(thisClass.selectorResize.selector.component.NAME=="MF_ImageComp"||thisClass.selectorResize.selector.component.NAME=="MF_Draw")&&thisClass.selectorResize.selector.component.maintainSize&&thisClass.selectorResize.selector.component.imageID!=""&&!thisClass.selectorResize.selector.component.canvasDraw){thisClass.selectorResize.x=thisClass.selectorResize.x;thisClass.selectorResize.y=thisClass.selectorResize.y;thisClass.selectorResize.width=parseInt($("#"+thisClass.selectorResize.selector.component.eid+"_img").css("width"))-thisClass.selectorResize.selector.component.cropWidth;thisClass.selectorResize.height=parseInt($("#"+thisClass.selectorResize.selector.component.eid+"_img").css("height"))-thisClass.selectorResize.selector.component.cropHeight;}}thisClass.selectorDragged=false;dd.attr=$(ev.target).prop("className");dd.width=$(this).width();dd.height=$(this).height()-5;this.resized=false;thisClass.offsetYPos=($("#mfContainerPage").position().top/thisClass.SCALE)-(thisClass.selectorResize.delta*2);thisClass.offsetXPos=($("#mfContainerPage").position().left/thisClass.SCALE)+thisClass.selectorResize.delta;var newx=thisClass.selectorResize.x-($("#"+thisClass.selectorResize.id).position().left/thisClass.SCALE);var newy=thisClass.selectorResize.y-($("#"+thisClass.selectorResize.id).position().top/thisClass.SCALE);thisClass.offsetXPos=thisClass.offsetXPos-newx;thisClass.offsetYPos=thisClass.offsetYPos-newy;if(mf_main.INTEGRATION){if(mf_main.INTEGRATION_TYPE=="trello"||mf_main.INTEGRATION_TYPE=="jira"||mf_main.INTEGRATION_TYPE=="confluence"||mf_main.INTEGRATION_TYPE=="office365"||mf_main.INTEGRATION_TYPE=="internal"){thisClass.offsetXPos=thisClass.offsetXPos+$("#mfEditorWrapperContainer").position().left;thisClass.offsetYPos=thisClass.offsetYPos+$("#mfEditorWrapperContainer").position().top;}}thisClass.mouseStartX=ev.pageX/thisClass.SCALE;thisClass.mouseStartY=ev.pageY/thisClass.SCALE;thisClass.maxDx=0;thisClass.maxDy=0;thisClass.selectorResize.prevX=thisClass.selectorResize.x;thisClass.selectorResize.prevY=thisClass.selectorResize.y;thisClass.selectorResize.prevAngle=thisClass.selectorResize.angle;thisClass.selectorResize.prevWidth=thisClass.selectorResize.width;thisClass.selectorResize.prevHeight=thisClass.selectorResize.height;if(thisClass.selectorResize.selector&&thisClass.selectorResize.selector.GLOBAL_SELECT){thisClass.selectorResize.selector.origW=thisClass.selectorResize.selector.width;thisClass.selectorResize.selector.origH=thisClass.selectorResize.selector.height;}thisClass.beforeMoveX=thisClass.selectorResize.x;thisClass.beforeMoveY=thisClass.selectorResize.y;}else{return false;}}else{return false;}});$("#"+thisClass.selectorResize.id).drag(function(ev,dd){if(thisClass.RENDER||thisClass.VIEWER){return;}var allow=true;if(dd.attr&&dd.attr.indexOf("drag")>-1){if(thisClass.isShift||thisClass.isCtrl){return;}}if(thisClass.selectorResize.selector&&thisClass.selectorResize.selector.GLOBAL_SELECT){allow=true;}if(allow){mf_main.editorController.disableShortcuts();ev.stopImmediatePropagation();if(thisClass.gridController.snapToGrid){var snapval=thisClass.gridController.snapPos*thisClass.SCALE;dd.deltaY=Math.round(dd.deltaY/snapval)*snapval;dd.deltaX=Math.round(dd.deltaX/snapval)*snapval;}else{dd.deltaY=Math.round(dd.deltaY/1)*1;dd.deltaX=Math.round(dd.deltaX/1)*1;}dd.deltaY=dd.deltaY/thisClass.SCALE;dd.deltaX=dd.deltaX/thisClass.SCALE;dd.originalY=dd.originalY/thisClass.SCALE;dd.originalX=dd.originalX/thisClass.SCALE;var mousePosX=ev.pageX/thisClass.SCALE;var mousePosY=ev.pageY/thisClass.SCALE;var currPoint=new Object();currPoint.x=(mousePosX-thisClass.mouseStartX);currPoint.y=(mousePosY-thisClass.mouseStartY);var ang=thisClass.selectorResize.prevAngle*3.14/180;var calcX=Math.cos(ang)*currPoint.x+Math.sin(ang)*currPoint.y;var calcY=Math.cos(ang)*currPoint.y-Math.sin(ang)*currPoint.x;var transX=calcX/2;var transY=calcY/2;var newX=0;var newY=0;var props={};if(thisClass.selectorResize.angle==0){if(dd.attr.indexOf("E")>-1){props.width=Math.max(8,dd.width+dd.deltaX);var sallow=false;if(thisClass.CROPMODE){var wval=(thisClass.selectorResize.selector.component.width+thisClass.selectorResize.selector.component.cropWidth+thisClass.selectorResize.selector.component.cropX);if((props.width)<(thisClass.selectorResize.selector.component.width+thisClass.selectorResize.selector.component.cropWidth+thisClass.selectorResize.selector.component.cropX)){sallow=true;}else{sallow=true;props.width=wval;}}else{sallow=true;}if(sallow){thisClass.selectorResize.width=props.width;}this.resized=true;}if(dd.attr.indexOf("S")>-1){props.height=Math.max(8,dd.height+dd.deltaY);var sallow=false;if(thisClass.CROPMODE){var hval=(thisClass.selectorResize.selector.component.height+thisClass.selectorResize.selector.component.cropHeight+thisClass.selectorResize.selector.component.cropY-5);if((props.height)<hval){sallow=true;}else{sallow=true;props.height=hval;}}else{sallow=true;}if(sallow){thisClass.selectorResize.height=props.height+5;}this.resized=true;}if(dd.attr.indexOf("W")>-1){props.width=Math.max(8,dd.width-dd.deltaX);props.left=dd.originalX+dd.width-props.width;props.left=props.left-thisClass.offsetXPos;var sallow=false;if(thisClass.CROPMODE){var tval=(thisClass.selectorResize.selector.component.x+thisClass.selectorResize.selector.component.cropX-1);if(props.left>tval){sallow=true;}else{sallow=false;props.left=props.left-1;var hval=(thisClass.selectorResize.selector.component.width);props.width=hval+2;}}else{sallow=true;}if(sallow){thisClass.selectorResize.x=props.left;thisClass.selectorResize.width=props.width+(thisClass.selectorResize.delta*2);this.resized=true;}}if(dd.attr.indexOf("N")>-1){props.height=Math.max(8,dd.height-dd.deltaY);props.top=dd.originalY+dd.height-props.height;props.top=props.top-thisClass.offsetYPos;var sallow=false;if(thisClass.CROPMODE){var tval=(thisClass.selectorResize.selector.component.y+thisClass.selectorResize.selector.component.cropY-1);if(props.top>tval){sallow=true;}else{sallow=false;props.top=props.top-1;var hval=(thisClass.selectorResize.selector.component.height);props.height=hval+2;}}else{sallow=true;}if(sallow){thisClass.selectorResize.y=props.top;thisClass.selectorResize.height=props.height+5;this.resized=true;}}}else{if(dd.attr.indexOf("EE")>-1){newX=-transX+transX*Math.cos(ang);newY=transX*Math.sin(ang);if((thisClass.selectorResize.prevWidth+calcX)>16){thisClass.selectorResize.x=thisClass.selectorResize.prevX+newX;thisClass.selectorResize.y=thisClass.selectorResize.prevY+newY;thisClass.selectorResize.width=thisClass.selectorResize.prevWidth+calcX;}this.resized=true;}if(dd.attr.indexOf("SS")>-1){newX=-transY*Math.sin(ang);newY=-transY+transY*Math.cos(ang);if((thisClass.selectorResize.prevHeight+calcY)>16){thisClass.selectorResize.x=thisClass.selectorResize.prevX+newX;thisClass.selectorResize.y=thisClass.selectorResize.prevY+newY;thisClass.selectorResize.height=thisClass.selectorResize.prevHeight+calcY;}this.resized=true;}if(dd.attr.indexOf("WW")>-1){newX=transX+transX*Math.cos(ang);newY=transX*Math.sin(ang);if((thisClass.selectorResize.prevWidth-calcX)>16){thisClass.selectorResize.x=thisClass.selectorResize.prevX+newX;thisClass.selectorResize.y=thisClass.selectorResize.prevY+newY;thisClass.selectorResize.width=thisClass.selectorResize.prevWidth-calcX;}this.resized=true;}if(dd.attr.indexOf("NN")>-1){newX=-transY*Math.sin(ang);newY=transY+transY*Math.cos(ang);if((thisClass.selectorResize.prevHeight-calcY)>16){thisClass.selectorResize.x=thisClass.selectorResize.prevX+newX;thisClass.selectorResize.y=thisClass.selectorResize.prevY+newY;thisClass.selectorResize.height=thisClass.selectorResize.prevHeight-calcY;}this.resized=true;}if(dd.attr.indexOf("SE")>-1){if((thisClass.selectorResize.prevHeight+calcY)>16&&(thisClass.selectorResize.prevWidth+calcX)>16){thisClass.selectorResize.prevHeight+calcY>0?(newX=-transY*Math.sin(ang),newY=-transY+transY*Math.cos(ang),thisClass.selectorResize.height=thisClass.selectorResize.prevHeight+calcY,thisClass.maxDy=Math.abs(transY)>Math.abs(thisClass.maxDy)?transY:thisClass.maxDy):(newX=-thisClass.maxDy*Math.sin(ang),newY=-thisClass.maxDy+thisClass.maxDy*Math.cos(ang));thisClass.selectorResize.prevWidth+calcX>0?(newX+=-transX+transX*Math.cos(ang),newY+=transX*Math.sin(ang),thisClass.selectorResize.width=thisClass.selectorResize.prevWidth+calcX,thisClass.maxDx=Math.abs(transX)>Math.abs(thisClass.maxDx)?transX:thisClass.maxDx):(newX+=-thisClass.maxDx+thisClass.maxDx*Math.cos(ang),newY+=thisClass.maxDx*Math.sin(ang));thisClass.selectorResize.x=thisClass.selectorResize.prevX+newX;thisClass.selectorResize.y=thisClass.selectorResize.prevY+newY;}this.resized=true;}if(dd.attr.indexOf("SW")>-1){if((thisClass.selectorResize.prevHeight+calcY)>16&&(thisClass.selectorResize.prevWidth-calcX)>16){thisClass.selectorResize.prevHeight+calcY>0?(newX=-transY*Math.sin(ang),newY=-transY+transY*Math.cos(ang),thisClass.selectorResize.height=thisClass.selectorResize.prevHeight+calcY,thisClass.maxDy=Math.abs(transY)>Math.abs(thisClass.maxDy)?transY:thisClass.maxDy):(newX=-thisClass.maxDy*Math.sin(ang),newY=-thisClass.maxDy+thisClass.maxDy*Math.cos(ang));thisClass.selectorResize.prevWidth-calcX>0?(newX+=transX+transX*Math.cos(ang),newY+=transX*Math.sin(ang),thisClass.selectorResize.width=thisClass.selectorResize.prevWidth-calcX,thisClass.maxDx=Math.abs(transX)>Math.abs(thisClass.maxDx)?transX:thisClass.maxDx):(newX+=thisClass.maxDx+thisClass.maxDx*Math.cos(ang),newY+=thisClass.maxDx*Math.sin(ang));thisClass.selectorResize.x=thisClass.selectorResize.prevX+newX;thisClass.selectorResize.y=thisClass.selectorResize.prevY+newY;}this.resized=true;}if(dd.attr.indexOf("NW")>-1){if((thisClass.selectorResize.prevHeight-calcY)>16&&(thisClass.selectorResize.prevWidth-calcX)>16){thisClass.selectorResize.prevHeight-calcY>0?(newX=-transY*Math.sin(ang),newY=transY+transY*Math.cos(ang),thisClass.selectorResize.height=thisClass.selectorResize.prevHeight-calcY,thisClass.maxDy=Math.abs(transY)>Math.abs(thisClass.maxDy)?transY:thisClass.maxDy):(newX=-thisClass.maxDy*Math.sin(ang),newY=thisClass.maxDy+thisClass.maxDy*Math.cos(ang));thisClass.selectorResize.prevWidth-calcX>0?(newX+=transX+transX*Math.cos(ang),newY+=transX*Math.sin(ang),thisClass.selectorResize.width=thisClass.selectorResize.prevWidth-calcX,thisClass.maxDx=Math.abs(transX)>Math.abs(thisClass.maxDx)?transX:thisClass.maxDx):(newX+=thisClass.maxDx+thisClass.maxDx*Math.cos(ang),newY+=thisClass.maxDx*Math.sin(ang));thisClass.selectorResize.x=thisClass.selectorResize.prevX+newX;thisClass.selectorResize.y=thisClass.selectorResize.prevY+newY;}this.resized=true;}if(dd.attr.indexOf("NE")>-1){if((thisClass.selectorResize.prevHeight-calcY)>16&&(thisClass.selectorResize.prevWidth+calcX)>16){thisClass.selectorResize.prevHeight-calcY>0?(newX=-transY*Math.sin(ang),newY=transY+transY*Math.cos(ang),thisClass.selectorResize.height=thisClass.selectorResize.prevHeight-calcY,thisClass.maxDy=Math.abs(transY)>Math.abs(thisClass.maxDy)?transY:thisClass.maxDy):(newX=-thisClass.maxDy*Math.sin(ang),newY=thisClass.maxDy+thisClass.maxDy*Math.cos(ang));thisClass.selectorResize.prevWidth+calcX>0?(newX+=-transX+transX*Math.cos(ang),newY+=transX*Math.sin(ang),thisClass.selectorResize.width=thisClass.selectorResize.prevWidth+calcX,thisClass.maxDx=Math.abs(transX)>Math.abs(thisClass.maxDx)?transX:thisClass.maxDx):(newX+=-thisClass.maxDx+thisClass.maxDx*Math.cos(ang),newY+=thisClass.maxDx*Math.sin(ang));thisClass.selectorResize.x=thisClass.selectorResize.prevX+newX;thisClass.selectorResize.y=thisClass.selectorResize.prevY+newY;}this.resized=true;}}var maspect=false;maspect=thisClass.isShift;if(maspect==false){if(thisClass.selectorResize.selector&&thisClass.selectorResize.selector.component&&(thisClass.selectorResize.selector.component.NAME=="MF_ImageComp"||thisClass.selectorResize.selector.component.NAME=="MF_Draw")&&thisClass.selectorResize.selector.component.maintainSize&&thisClass.selectorResize.selector.component.imageID!=""){maspect=true;}}if(thisClass.CROPMODE){maspect=false;}if(maspect){if(dd.attr.indexOf("SE")>-1||dd.attr.indexOf("EE")>-1||dd.attr.indexOf("WW")>-1||dd.attr.indexOf("SW")>-1){thisClass.selectorResize.height=thisClass.selectorResize.width/thisClass.selectorResize.prevWidth*thisClass.selectorResize.prevHeight;}else{thisClass.selectorResize.width=thisClass.selectorResize.height*(thisClass.selectorResize.prevWidth/thisClass.selectorResize.prevHeight);}}var cx=0;var cy=0;var cwidth=0;var cheight=0;if(dd.attr.indexOf("drag")>-1){thisClass.selectorDragged=true;props.top=dd.offsetY/thisClass.SCALE;props.left=dd.offsetX/thisClass.SCALE;props.left=props.left-thisClass.offsetXPos;props.top=props.top-thisClass.offsetYPos;thisClass.selectorResize.x=props.left;thisClass.selectorResize.y=props.top;cx=thisClass.selectorResize.x+thisClass.selectorResize.selector.delta;cy=thisClass.selectorResize.y+thisClass.selectorResize.selector.delta;cwidth=thisClass.selectorResize.width-(thisClass.selectorResize.selector.delta*2);cheight=thisClass.selectorResize.height-(thisClass.selectorResize.selector.delta*2);}else{cx=thisClass.selectorResize.x+thisClass.selectorResize.selector.delta;cy=thisClass.selectorResize.y+thisClass.selectorResize.selector.delta;cwidth=thisClass.selectorResize.width-(thisClass.selectorResize.selector.delta*2);cheight=thisClass.selectorResize.height-(thisClass.selectorResize.selector.delta*2);}thisClass.selectorResize.render(false);thisClass.setGuidelines(thisClass.selectorResize.selector,this.resized);if(thisClass.selectorResize.selector){thisClass.selectorResize.selector.width=thisClass.selectorResize.width;thisClass.selectorResize.selector.height=thisClass.selectorResize.height;thisClass.selectorResize.selector.x=thisClass.selectorResize.x;thisClass.selectorResize.selector.y=thisClass.selectorResize.y;}thisClass.selectorResize.selector.setBalpha(0);if(this.resized){if(thisClass.selectorResize.selector.component!=null&&thisClass.selectorResize.selector.GLOBAL_SELECT==false){if(!thisClass.CROPMODE){thisClass.moveComponent(thisClass.selectorResize.selector.component,cx,cy,cwidth,cheight,this.resized);}}thisClass.selectorResize.selector.x=thisClass.selectorResize.selector.x/thisClass.SCALE;thisClass.selectorResize.selector.y=thisClass.selectorResize.selector.y/thisClass.SCALE;if(thisClass.lastSetting){thisClass.lastSetting.updateTransform();}thisClass.selectorResize.selector.x=thisClass.selectorResize.selector.x*thisClass.SCALE;thisClass.selectorResize.selector.y=thisClass.selectorResize.selector.y*thisClass.SCALE;}else{$("#"+thisClass.selectorResize.id).hide();thisClass.selectorResize.selector.x=props.left/thisClass.SCALE;thisClass.selectorResize.selector.y=props.top/thisClass.SCALE;if(thisClass.lastSetting){thisClass.lastSetting.updateTransform();}thisClass.globalSelectorMoveOnDrag(thisClass.selectorResize.selector);}if(thisClass.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}}else{return false;}});$("#"+thisClass.selectorResize.id).drag("end",function(ev,dd){if(thisClass.RENDER||thisClass.VIEWER){return;}thisClass.removeGuides();var allow=true;if(thisClass.selectorResize.selector&&thisClass.selectorResize.selector.GLOBAL_SELECT){allow=true;}if(allow){mf_main.editorController.enableShortcuts();ev.stopImmediatePropagation();if(this.resized==false){thisClass.checkUnIntendedMove();}else{if(!thisClass.CROPMODE){if(thisClass.selectorResize.selector&&thisClass.selectorResize.selector.component&&(thisClass.selectorResize.selector.component.NAME=="MF_ImageComp"||thisClass.selectorResize.selector.component.NAME=="MF_Draw")&&thisClass.selectorResize.selector.component.maintainSize&&thisClass.selectorResize.selector.component.imageID!=""&&!thisClass.selectorResize.selector.component.canvasDraw){thisClass.selectorResize.x=thisClass.selectorResize.x;thisClass.selectorResize.y=thisClass.selectorResize.y;thisClass.selectorResize.width=parseInt($("#"+thisClass.selectorResize.selector.component.eid+"_img").css("width"))-thisClass.selectorResize.selector.component.cropWidth;thisClass.selectorResize.height=parseInt($("#"+thisClass.selectorResize.selector.component.eid+"_img").css("height"))-thisClass.selectorResize.selector.component.cropHeight;}}}$("#"+thisClass.selectorResize.id).show();thisClass.selectorResize.render(false);try{if(selector&&selector!=thisClass.globalselect){thisClass.selectorResize.selector.x=thisClass.selectorResize.selector.x/thisClass.SCALE;thisClass.selectorResize.selector.y=thisClass.selectorResize.selector.y/thisClass.SCALE;}else{if(this.resized&&selector&&selector==thisClass.globalselect){thisClass.selectorResize.selector.x=thisClass.selectorResize.selector.x/thisClass.SCALE;thisClass.selectorResize.selector.y=thisClass.selectorResize.selector.y/thisClass.SCALE;}}if(thisClass.lastSetting){thisClass.lastSetting.updateTransform(true);}if(selector&&selector!=thisClass.globalselect){thisClass.selectorResize.selector.x=thisClass.selectorResize.selector.x*thisClass.SCALE;thisClass.selectorResize.selector.y=thisClass.selectorResize.selector.y*thisClass.SCALE;}else{if(this.resized&&selector&&selector==thisClass.globalselect){thisClass.selectorResize.selector.x=thisClass.selectorResize.selector.x*thisClass.SCALE;thisClass.selectorResize.selector.y=thisClass.selectorResize.selector.y*thisClass.SCALE;}}}catch(e){}if(!thisClass.CROPMODE){thisClass.dragFinishOperation(this.resized);}else{var cropped=false;var origY=thisClass.selectorResize.selector.component.y;var newY=thisClass.selectorResize.y;var cropYOrigPercent=0;origY=(origY+$("#"+thisClass.selectorResize.selector.component.eid+"_img").position().top/thisClass.SCALE);var origX=thisClass.selectorResize.selector.component.x;var newX=thisClass.selectorResize.x;var cropXOrigPercent=0;origX=(origX+$("#"+thisClass.selectorResize.selector.component.eid+"_img").position().left/thisClass.SCALE);var origWidth=thisClass.selectorResize.selector.component.width;var newWidth=thisClass.selectorResize.width;var cropWidthOrigPercent=0;origWidth=$("#"+thisClass.selectorResize.selector.component.eid+"_img").width();cropWidthOrigPercent=(origWidth-newWidth)/newWidth*100;cropped=true;var origHeight=thisClass.selectorResize.selector.component.height;var newHeight=thisClass.selectorResize.height;origHeight=$("#"+thisClass.selectorResize.selector.component.eid+"_img").height();var cropHeightOrigPercent=0;cropHeightOrigPercent=(origHeight-newHeight)/newHeight*100;cropped=true;cropYOrigPercent=(newY-origY)/origHeight*100;cropped=true;cropXOrigPercent=(newX-origX)/origWidth*100;cropped=true;if(cropped){var cropVal=(parseFloat(cropYOrigPercent)).toString()+","+(parseFloat(cropWidthOrigPercent)).toString()+","+(parseFloat(cropHeightOrigPercent)).toString()+","+(parseFloat(cropXOrigPercent)).toString();var undoarr=new Array();var undo=new MF_UndoDAO();undo.propSingleUndo(thisClass.selectorResize.selector.component,"crop",thisClass.selectorResize.selector.component.crop);undoarr.push(undo);undo=new MF_UndoDAO();undo.propObjectUndo(thisClass.selectorResize.selector.component,"ecoordinates",thisClass.selectorResize.selector.component.ecoordinates);undoarr[undoarr.length]=undo;undo=new MF_UndoDAO();undo.propObjectUndo(thisClass.selectorResize.selector.component,"esize",thisClass.selectorResize.selector.component.esize);undoarr[undoarr.length]=undo;thisClass.selectorResize.selector.component.e2xml.addPropSingle("crop",cropVal,"default");var szObject=new Object();szObject.width=newWidth;szObject.height=newHeight;thisClass.selectorResize.selector.component.e2xml.addPropObject("esize",szObject,"default");var posObject=new Object();posObject.x=thisClass.selectorResize.x;posObject.y=thisClass.selectorResize.y;thisClass.selectorResize.selector.component.e2xml.addPropObject("ecoordinates",posObject,"default");thisClass.selectorResize.selector.component.render(false);if(thisClass.lastSetting){$("#mfResetCropImage_"+thisClass.lastSetting.eid).show();}var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);meta.reselectMeta=true;undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}}}else{return false;}});$("#"+thisClass.selectorResize.id+"_rotatebtn").click(function(event){event.stopPropagation();});$("#"+thisClass.selectorResize.id+"_rotatebtn").mousedown(function(event){event.stopPropagation();});$("#"+thisClass.selectorResize.id+"_rotatebtn").drag("start",function(ev,dd){ev.stopImmediatePropagation();var obj=$("#"+thisClass.selectorResize.id);thisClass.rotateOffset=obj.offset();var newx=thisClass.selectorResize.x-($("#"+thisClass.selectorResize.id).position().left/thisClass.SCALE)+10;var newy=thisClass.selectorResize.y-($("#"+thisClass.selectorResize.id).position().top/thisClass.SCALE)+10;thisClass.rotateOffset.left=(thisClass.rotateOffset.left/thisClass.SCALE)+newx;thisClass.rotateOffset.top=(thisClass.rotateOffset.top/thisClass.SCALE)+newy;});$("#"+thisClass.selectorResize.id+"_rotatebtn").drag(function(ev,dd){ev.stopImmediatePropagation();thisClass.rotated=true;var obj=$("#"+thisClass.selectorResize.id);var center_x=(thisClass.rotateOffset.left)+(obj.width()/2);var center_y=(thisClass.rotateOffset.top)+(obj.height()/2);var mouse_x=ev.pageX/thisClass.SCALE;var mouse_y=ev.pageY/thisClass.SCALE;var radians=Math.atan2(mouse_x-center_x,mouse_y-center_y);var degree=Math.abs((radians*(180/Math.PI)*-1)+180);if(degree>0&&degree<1){degree=0;}degree=Math.round(degree);thisClass.selectorResize.angle=degree;MF_Utils.rotate(thisClass.selectorResize.id,degree);thisClass.selectorResize.selector.angle=degree;MF_Utils.rotate(thisClass.selectorResize.selector.id,degree);if(thisClass.selectorResize.selector.component){MF_Utils.rotate(thisClass.selectorResize.selector.component.eid,degree);}if(thisClass.lastSetting){thisClass.lastSetting.updateTransform();}});};this.moveComponent=function(comp,x,y,width,height,resize){if(comp){if(comp.ecoordinates==null){if(!isNaN(x)){comp.x=x;}if(!isNaN(y)){comp.y=y;}}else{if(!isNaN(x)){comp.ecoordinates.x=x;}if(!isNaN(y)){comp.ecoordinates.y=y;}}if(resize){if(comp.esize==null){comp.width=width;comp.height=height;}else{comp.esize.width=width;comp.esize.height=height;}if(!comp.RENDER_ON_RESIZE){return;}comp.render(false);}else{comp.render(false);}}};this.removeSelectorTransform=function(){if(thisClass.selectorTransformStart){$("#"+thisClass.selectorTransformStart.id).remove();}if(thisClass.selectorTransformEnd){$("#"+thisClass.selectorTransformEnd.id).remove();}if(thisClass.selectorTransformPath){$(".transformPathHandle").remove();}thisClass.selectorTransformStart=null;thisClass.selectorTransformEnd=null;thisClass.selectorTransformPath=null;};this.addSelectorTransform=function(selector,nolayer){thisClass.removeSelectorTransform();thisClass.selectorTransformStart=new MF_SelectorTransform();thisClass.selectorTransformStart.type="start";thisClass.selectorTransformStart.x=selector.component.startX;thisClass.selectorTransformStart.y=selector.component.startY;thisClass.selectorTransformStart.selector=selector;thisClass.selectorTransformStart.render();$("#"+thisClass.selectorTransformStart.id).css("z-index",this.page.stackOrder.size()+10);mf_main.moveCategoryTop();thisClass.selectorTransformEnd=new MF_SelectorTransform();thisClass.selectorTransformEnd.type="end";thisClass.selectorTransformEnd.x=selector.component.endX;thisClass.selectorTransformEnd.y=selector.component.endY;thisClass.selectorTransformEnd.selector=selector;thisClass.selectorTransformEnd.render();$("#"+thisClass.selectorTransformEnd.id).css("z-index",this.page.stackOrder.size()+10);mf_main.moveCategoryTop();if(selector.component&&selector.component.NAME=="MF_ArrowPath"){try{thisClass.selectorTransformPath=new MF_SelectorTransform();thisClass.selectorTransformPath.type="path";thisClass.selectorTransformPath.selector=selector;thisClass.selectorTransformPath.render();$(".transformPathHandle").css("z-index",this.page.stackOrder.size()+10);mf_main.moveCategoryTop();}catch(e){console.log("Error in ArrowPath");}}if(nolayer){}else{thisClass.layersController.selectNode("lay_"+selector.component.eid);}};this.removeSelectorResize=function(){if(thisClass.selectorResize){thisClass.selectorResize.selector=null;$("#"+thisClass.selectorResize.id).hide();}};this.selectAll=function(){if(mf_main.editorController.pageEditorLocked){return;}thisClass.disableCropMode();if(thisClass.page.childComponents.size()==1){var component=thisClass.page.childComponents.getItemAt(0);if(!component.transformLock){mf_main.editorController.addComponentSelect(component.selector);thisClass.addSelectorResize(component.selector);}}else{if(thisClass.currentGroupEdit!=null){thisClass.componentSelect=new Array();var groupObj=thisClass.page.groupManager.groups[thisClass.currentGroupEdit];var gcomponents=new ArrayCollection();if(groupObj){gcomponents=groupObj.children;}for(var k=0;k<gcomponents.size();k++){var gcomp=gcomponents.getItemAt(k);if(!gcomp.selector.locked){thisClass.selectHighlight(gcomp.selector);}}}else{var compselected=false;for(var i=0;i<thisClass.page.childComponents.size();i++){var component=thisClass.page.childComponents.getItemAt(i);if(component.selector&&component.GROUPID==""&&!component.transformLock){compselected=true;thisClass.selectHighlight(component.selector);}}var gcount=0;var lastgselector=null;for(var k in thisClass.page.groupManager.groupSelectors){var gselector=thisClass.page.groupManager.groupSelectors[k];var nestedGroup="";if(thisClass.currentGroupEdit!=null){nestedGroup=thisClass.currentGroupEdit;}var grpObj=thisClass.page.groupManager.getGroupByID(gselector.GROUPID);if(gselector&&!gselector.locked&&grpObj&&grpObj.parent==nestedGroup){gcount++;lastgselector=gselector;thisClass.selectHighlight(gselector);}}}if(compselected==false&&gcount==1&&lastgselector){thisClass.addSelectorResize(lastgselector);}else{thisClass.performGlobalSelection();}}};this.clearSelection=function(nolayer,norestack){if(mf_main.editorController.SELECTMODE_TYPE=="powerup-pagepreview"){return;}if(thisClass.SELECTMODE&&!thisClass.powerupCallbackOptions){thisClass.showNavBar();thisClass.disableSelectMode();}thisClass.disableCropMode();$("#mfCompPlaceholder").hide();thisClass.removeGuides();thisClass.isShift=false;thisClass.isCtrl=false;thisClass.stopEditingText();thisClass.selectedComponent=null;for(var i=0;i<thisClass.componentSelect.length;i++){var compSelector=thisClass.componentSelect[i];if(compSelector){compSelector.render(false);if(compSelector.component&&compSelector.component.NAME=="MF_AdvancedDataGrid"){if(compSelector.component.gridEditMode&&thisClass.gridEditor){thisClass.gridEditor.remove();}}}}thisClass.removeGlobalSelect();if(thisClass.noSettingsClear){thisClass.noSettingsClear=false;}else{if(thisClass.EDITOR){thisClass.closeAllSettings();thisClass.openPageSetting();if(thisClass.currentNavBarEditorShown=="mfNavPagesBtn"||thisClass.currentNavBarEditorShown=="mfNavAIToolsBtn"||thisClass.currentNavBarEditorShown=="mfViewerNavCommentBtn"||thisClass.currentNavBarEditorShown=="mfNavImagesBtn"||thisClass.currentNavBarEditorShown=="mfNavStoreBtn"||thisClass.currentNavBarEditorShown=="mfNavPowerupBtn"){if(thisClass.currentNavBarEditorShown!="mfNavPowerupBtn"||$("#mfContentPowerup").css("display")=="none"){thisClass.openNavBarContent(thisClass.currentNavBarEditorShown);}}else{thisClass.openNavBarContent("mfNavElementBtn");}}}thisClass.removeSelectorTransform();thisClass.removeSelectorResize();thisClass.componentSelect=new Array();thisClass.hideSelectionBox();if(norestack){}else{thisClass.reStackComponents(null,nolayer);}if(norestack==null){thisClass.layersController.clearNodes();}};this.selectComponentByUser=function(e,chkSelector){if(thisClass.compMode){return;}if(chkSelector==undefined){chkSelector=null;}if(chkSelector!=null&&chkSelector.UNEDIT){return;}var detected=false;if(thisClass.page&&thisClass.page.childComponents){for(var i=thisClass.page.childComponents.size()-1;i>=0;i--){var comp=thisClass.page.childComponents.getItemAt(i);if(selector!=null){if(comp.selector==chkSelector){return false;}}if(!comp){return;}var cvs=document.getElementById(comp.eid);var pt=MF_Utils.globalToLocalPoint(e,comp.eid);if(comp.TRANSFORM||comp.POINTSELECT||comp.NAME=="MF_Draw"){if(comp.USEPAGE){var fx=(pt.x/thisClass.SCALE)+cvs.offsetLeft;var fy=(pt.y/thisClass.SCALE)+cvs.offsetTop;if((fx>comp.x)&&(fx<(comp.x+comp.width))){if((fy>comp.y)&&(fy<(comp.y+comp.height))){if(comp.NAME=="MF_ArrowPath"){try{var pathDis=MF_Utils.getClosestPoint($("#"+comp.eid+" .mfNodeConnectorPath")[0],[pt.x/thisClass.SCALE,pt.y/thisClass.SCALE]);if(pathDis.distance<5){detected=true;}}catch(e){console.log("Error in ArrowPath");}}else{var ctx_Cvs=(document.getElementById(comp.eid)).getContext("2d");var imageData=ctx_Cvs.getImageData(pt.x/thisClass.SCALE,pt.y/thisClass.SCALE,1,1);if(imageData.data[3]>0){detected=true;}}}}}else{var fx=(pt.x/thisClass.SCALE)+cvs.offsetLeft;var fy=(pt.y/thisClass.SCALE)+cvs.offsetTop;if((fx>comp.x)&&(fx<(comp.x+comp.width))){if((fy>comp.y)&&(fy<(comp.y+comp.height))){detected=true;}}}}else{if(chkSelector&&chkSelector.GROUP){var fx=(pt.x/thisClass.SCALE)+cvs.offsetLeft;var fy=(pt.y/thisClass.SCALE)+cvs.offsetTop;if(comp.eangle!=0){var selwidth=comp.width;var selheight=comp.height;var selx=comp.x;var sely=comp.y;var obj=MF_Utils.getRotatedSize(selx,sely,selwidth,selheight,comp.eangle);selx=obj.x;sely=obj.y;selwidth=obj.width;selheight=obj.height;if((fx>selx)&&(fx<(selx+selwidth))){if((fy>sely)&&(fy<(sely+selheight))){detected=true;}}}else{if((fx>comp.x)&&(fx<(comp.x+comp.width))){if((fy>comp.y)&&(fy<(comp.y+comp.height))){detected=true;}}}}}if(thisClass.currentGroupEdit==null&&chkSelector!=null&&chkSelector.GROUP){if(detected&&comp){if(comp.GROUPID==chkSelector.GROUPID||thisClass.page.groupManager.isChildGroup(chkSelector.GROUPID,comp.GROUPID)){return false;}else{if(comp.GROUPID!=""&&comp.GROUPID!=null){detected=true;}}}}if(thisClass.currentGroupEdit!=null){if(detected&&comp){if(comp&&comp.GROUPID==thisClass.currentGroupEdit){}else{if(comp.GROUPID==chkSelector.GROUPID||thisClass.page.groupManager.isChildGroup(chkSelector.GROUPID,comp.GROUPID)){return false;}else{if(comp.GROUPID!=""&&comp.GROUPID!=null){detected=true;}}}}}if(detected){if(!comp.transformLock){e.stopPropagation();}if(comp==thisClass.lastTextEditComp){return false;}thisClass.stopEditingText();thisClass.isDrag=true;var selector=null;if(comp){selector=comp.selector;}if(comp.GROUPID==""||comp.GROUPID==null){if(comp&&comp.selector&&comp.selector.UNEDIT){return false;}if(selector!=null&&selector.component){if(selector.component.TRANSFORM){var posObject=new Object();posObject.startX=selector.component.startX;posObject.startY=selector.component.startY;posObject.endX=selector.component.endX;posObject.endY=selector.component.endY;selector.component.prevEcoordinates=posObject;}else{var posObject=new Object();posObject.x=selector.component.x;posObject.y=selector.component.y;selector.component.prevEcoordinates=posObject;var szObject=new Object();szObject.width=selector.component.width;szObject.height=selector.component.height;selector.component.prevEsize=szObject;}}}var isGroup=false;if(comp.GROUPID!=""&&comp.GROUPID!=null){if(mf_main.editorController.currentGroupEdit!=null&&comp.GROUPID==mf_main.editorController.currentGroupEdit){}else{if(thisClass.currentGroupEdit==null){var grp=thisClass.page.groupManager.getTopMostParentGrp(comp.GROUPID);if(grp){selector=thisClass.page.groupManager.groupSelectors[grp.GROUPID];if(selector.UNEDIT){return false;}isGroup=true;}else{return false;}}else{selector=thisClass.page.groupManager.groupSelectors[comp.GROUPID];if(selector.UNEDIT){return false;}isGroup=true;}}}var alreadyPresent=false;if((!thisClass.isShift&&!thisClass.isCtrl)&&selector!=thisClass.globalselect){for(var v=0;v<thisClass.componentSelect.length;v++){var selectobj=thisClass.componentSelect[v];if(selectobj==selector){alreadyPresent=true;break;}}if(!alreadyPresent){thisClass.clearSelection(true);}}mf_main.editorController.addComponentSelect(selector);if((thisClass.isShift||thisClass.isCtrl)&&selector!=thisClass.globalselect){thisClass.performGlobalSelection();}var pt=null;if(isGroup){pt=MF_Utils.globalToLocalPoint(e,selector.id);}else{pt=MF_Utils.globalToLocalPoint(e,comp.eid);}thisClass.offsetMousex=pt.x/thisClass.SCALE;thisClass.offsetMousey=pt.y/thisClass.SCALE;if(isGroup){thisClass.selectedComponent=selector;}else{thisClass.selectedComponent=comp;}if(comp.transformLock){if(!thisClass.isShift&&!thisClass.isCtrl){if(!alreadyPresent){thisClass.openSetting(thisClass.selectedComponent.selector);}thisClass.noSettingsClear=true;}}return detected;}}}return detected;};thisClass.noSettingsClear=false;this.componentAfterMove=function(e){if(thisClass.transformDrag){thisClass.isDrag=true;thisClass.movedObject=true;thisClass.transformDrag=false;}if(thisClass.selectedComponent&&thisClass.isDrag&&thisClass.movedObject){if(thisClass.selectedComponent.TRANSFORM){thisClass.selectedComponent.selector.x=thisClass.selectedComponent.x-thisClass.selectedComponent.selector.delta;thisClass.selectedComponent.selector.y=thisClass.selectedComponent.y-thisClass.selectedComponent.selector.delta;thisClass.selectedComponent.selector.width=thisClass.selectedComponent.width;thisClass.selectedComponent.selector.height=thisClass.selectedComponent.height;thisClass.selectedComponent.selector.render(false);}else{if(thisClass.selectedComponent.NAME){var posObject=new Object();var delta=thisClass.selectedComponent.delta;if(thisClass.selectedComponent.NAME=="MF_ImageComp"||thisClass.selectedComponent.NAME=="MF_Draw"){posObject.x=thisClass.selectedComponent.x-0;posObject.y=thisClass.selectedComponent.y-0;}else{posObject.x=thisClass.selectedComponent.x+delta;posObject.y=thisClass.selectedComponent.y+delta;}thisClass.selectedComponent.ecoordinates=posObject;thisClass.selectedComponent.render(false);}}if(thisClass.selectedComponent.TRANSFORM){thisClass.selectedComponent.x=thisClass.selectedComponent.selector.x+thisClass.selectedComponent.selector.delta;thisClass.selectedComponent.y=thisClass.selectedComponent.selector.y+thisClass.selectedComponent.selector.delta;thisClass.selectedComponent.computePoints();thisClass.resizePage();}if(thisClass.selectedComponent.NAME){thisClass.selectedComponent.selector.setCoordinate();}if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}}if(thisClass.selectedComponent){if(!thisClass.isShift&&!thisClass.isCtrl){if(thisClass.selectedComponent.NAME){if(thisClass.selectedComponent.TRANSFORM){var allowsel=true;if(thisClass.selectedComponent&&thisClass.selectedComponent.GROUPID!=""){if(mf_main.editorController.currentGroupEdit!=thisClass.selectedComponent.GROUPID){allowsel=false;}}if(allowsel){thisClass.addSelectorTransform(thisClass.selectedComponent.selector);thisClass.openSetting(thisClass.selectedComponent.selector);}else{thisClass.removeComponentSelect(thisClass.selectedComponent.selector);var gselect=thisClass.page.groupManager.groupSelectors[thisClass.selectedComponent.GROUPID];if(gselect){thisClass.addSelectorResize(gselect);thisClass.openSetting(gselect);}}}else{thisClass.addSelectorResize(thisClass.selectedComponent.selector);thisClass.openSetting(thisClass.selectedComponent.selector);}}else{if(thisClass.isDrag&&thisClass.movedObject){thisClass.selectedComponent.x=Math.round(thisClass.selectedComponent.x*thisClass.SCALE);thisClass.selectedComponent.y=Math.round(thisClass.selectedComponent.y*thisClass.SCALE);thisClass.globalSelectorMove(thisClass.selectedComponent);}thisClass.addSelectorResize(thisClass.selectedComponent);thisClass.openSetting(thisClass.selectedComponent);}}var cname=$(e.target).prop("className");if(cname&&$(e.target).hasClass("mfResizeHandleBtn")){}else{e.stopPropagation();}}thisClass.movedObject=false;thisClass.isDrag=false;};this.pageEvents=function(){$("#mfPage"+mf_main.editorController.page.eid).mouseup(function(e){if(thisClass.VIEWER||thisClass.RENDER){return;}if(thisClass.editingComponent){return;}if(thisClass.rotated){thisClass.rotated=false;var selector=thisClass.selectorResize.selector;if(selector){selector.setAngle();}}thisClass.removeGuides();mf_main.editorController.enableShortcuts();if(thisClass.transformDrag==false){thisClass.componentAfterMove(e);}else{if(e.target&&thisClass.transformDrag){var ar=$(e.target).prop("className");if($(e.target).hasClass("transformstarthandle")&&thisClass.selectorTransformStart){thisClass.selectorTransformStart.selector.x=Math.round(thisClass.selectorTransformStart.selector.component.x-thisClass.selectorTransformStart.selector.delta);thisClass.selectorTransformStart.selector.y=Math.round(thisClass.selectorTransformStart.selector.component.y-thisClass.selectorTransformStart.selector.delta);thisClass.selectorTransformStart.selector.height=Math.round(thisClass.selectorTransformStart.selector.component.height+(thisClass.selectorTransformStart.selector.delta*2));thisClass.selectorTransformStart.selector.width=Math.round(thisClass.selectorTransformStart.selector.component.width+(thisClass.selectorTransformStart.selector.delta*2));thisClass.selectorTransformStart.selector.setCoordinate();thisClass.selectorTransformStart.selector.render(false);}if($(e.target).hasClass("transformendhandle")&&thisClass.selectorTransformEnd){thisClass.selectorTransformEnd.selector.x=Math.round(thisClass.selectorTransformEnd.selector.component.x-thisClass.selectorTransformEnd.selector.delta);thisClass.selectorTransformEnd.selector.y=Math.round(thisClass.selectorTransformEnd.selector.component.y-thisClass.selectorTransformEnd.selector.delta);thisClass.selectorTransformEnd.selector.height=Math.round(thisClass.selectorTransformEnd.selector.component.height+(thisClass.selectorTransformEnd.selector.delta*2));thisClass.selectorTransformEnd.selector.width=Math.round(thisClass.selectorTransformEnd.selector.component.width+(thisClass.selectorTransformEnd.selector.delta*2));thisClass.selectorTransformEnd.selector.setCoordinate();thisClass.selectorTransformEnd.selector.render(false);}if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}}}});$("#mfPage"+mf_main.editorController.page.eid).on("click",function(e){if(thisClass.VIEWER||thisClass.RENDER){return;}if(thisClass.editingComponent){return;}thisClass.enableShortcuts();thisClass.isDrag=false;if(thisClass.currentGroupEdit!=null){var gselect=thisClass.page.groupManager.groupSelectors[thisClass.currentGroupEdit];if(gselect){var cpoints=MF_Utils.globalToLocalPoint(e,"mfContainerPage");var cx=cpoints.x/thisClass.SCALE;var cy=cpoints.y/thisClass.SCALE;if(cx>=gselect.x&&cx<=(gselect.x+gselect.width)&&cy>=gselect.y&&cy<=(gselect.y+gselect.height)){}else{var gparent=thisClass.page.groupManager.withinGroupParent(thisClass.currentGroupEdit,cx,cy);if(gparent==null){thisClass.closeGroupEditing();}else{thisClass.closeGroupEditing();thisClass.performGroupEditing(gparent.GROUPID);}}}}if(thisClass.selectedComponent){var cname=$(e.target).prop("className");if(cname&&$(e.target).hasClass("mfResizeHandleBtn")){}else{e.stopPropagation();}}});$("#mfPage"+mf_main.editorController.page.eid).mousemove(function(e){if(!thisClass.EDITOR){thisClass.viewerShortcuts=true;}if(thisClass.VIEWER||thisClass.RENDER){return;}if(thisClass.editingComponent){return;}thisClass.removeGuides();var mx=e.pageX;var my=e.pageY;if(thisClass.selectedComponent&&thisClass.isDrag&&!thisClass.transformDrag&&!thisClass.selectedComponent.transformLock){var allowmove=true;if(thisClass.selectedComponent&&thisClass.selectedComponent.TRANSFORM&&thisClass.selectedComponent.GROUPID!=""){if(mf_main.editorController.currentGroupEdit!=thisClass.selectedComponent.GROUPID){allowmove=false;}}if(allowmove){mf_main.editorController.disableShortcuts();thisClass.removeSelectorTransform();thisClass.removeSelectorResize();var props={};props.left=(e.pageX-$("#mfContainerPage").position().left)/thisClass.SCALE-(thisClass.offsetMousex);props.top=(e.pageY-$("#mfContainerPage").position().top)/thisClass.SCALE-(thisClass.offsetMousey);thisClass.selectedComponent.x=props.left;thisClass.selectedComponent.y=props.top;if(thisClass.selectedComponent.NAME=="MF_ImageComp"||thisClass.selectedComponent.NAME=="MF_Draw"){thisClass.selectedComponent.x=props.left+thisClass.selectedComponent.delta;thisClass.selectedComponent.y=props.top+thisClass.selectedComponent.delta;}if(thisClass.selectedComponent.RENDER_ON_MOVE){thisClass.selectedComponent.ecoordinates.x=thisClass.selectedComponent.x;thisClass.selectedComponent.ecoordinates.y=thisClass.selectedComponent.y;thisClass.selectedComponent.render(false);}else{if(thisClass.selectedComponent.NAME){$("#"+thisClass.selectedComponent.eid).css(props);if(thisClass.selectedComponent.TRANSFORM){thisClass.setGuidelines(thisClass.selectedComponent);}else{thisClass.setGuidelines(thisClass.selectedComponent,null,true);}if(thisClass.selectedComponent.TRANSFORM){thisClass.selectedComponent.selector.x=thisClass.selectedComponent.x-thisClass.selectedComponent.selector.delta;thisClass.selectedComponent.selector.y=thisClass.selectedComponent.y-thisClass.selectedComponent.selector.delta;thisClass.selectedComponent.selector.width=thisClass.selectedComponent.width;thisClass.selectedComponent.selector.height=thisClass.selectedComponent.height;if(thisClass.selectedComponent.NAME=="MF_ArrowPath"){thisClass.selectedComponent.isComponentMoved=true;thisClass.selectedComponent.undoFlag=true;}}}else{thisClass.selectedComponent.x=props.left/thisClass.SCALE;thisClass.selectedComponent.y=props.top/thisClass.SCALE;thisClass.globalSelectorMoveOnDrag(thisClass.selectedComponent);thisClass.setGuidelines(thisClass.selectedComponent,null,false);}}if(thisClass.selectedComponent&&thisClass.selectedComponent.selector){thisClass.selectedComponent.selector.x=thisClass.selectedComponent.x;thisClass.selectedComponent.selector.y=thisClass.selectedComponent.y;if(thisClass.lastSetting){thisClass.lastSetting.updateTransform();}else{thisClass.openSetting(thisClass.selectedComponent.selector);}}}thisClass.movedObject=true;if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}}if(e.target&&thisClass.transformDrag){var ar=$(e.target).prop("className");var props={};props.left=(e.pageX-$("#mfContainerPage").position().left)/thisClass.SCALE-(thisClass.offsetMousex);props.top=(e.pageY-$("#mfContainerPage").position().top)/thisClass.SCALE-(thisClass.offsetMousey);mf_main.editorController.disableShortcuts();if(thisClass.transformDragType=="start"){if(thisClass.selectorTransformStart&&thisClass.selectorTransformStart.selector.component&&!thisClass.selectorTransformStart.selector.component.transformLock){thisClass.selectorTransformStart.x=props.left+thisClass.selectorTransformStart.delta;thisClass.selectorTransformStart.y=props.top+thisClass.selectorTransformStart.delta;thisClass.selectorTransformStart.render(false);var comp=thisClass.selectorTransformStart.selector.component;if(comp.TRANSFORM){if(comp.ecoordinates==null){comp.startX=props.left+thisClass.selectorTransformStart.delta;comp.startY=props.top+thisClass.selectorTransformStart.delta;}else{comp.ecoordinates.startX=props.left+thisClass.selectorTransformStart.delta;comp.ecoordinates.startY=props.top+thisClass.selectorTransformStart.delta;}comp.render(false);}$("#"+thisClass.selectorTransformStart.id).css("z-index",thisClass.page.stackOrder.size()+10);mf_main.moveCategoryTop();if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}}}else{if(thisClass.transformDragType=="end"){if(thisClass.selectorTransformEnd&&thisClass.selectorTransformEnd.selector.component&&!thisClass.selectorTransformStart.selector.component.transformLock){thisClass.selectorTransformEnd.x=props.left+thisClass.selectorTransformEnd.delta;thisClass.selectorTransformEnd.y=props.top+thisClass.selectorTransformEnd.delta;thisClass.selectorTransformEnd.render(false);var comp=thisClass.selectorTransformEnd.selector.component;if(comp.TRANSFORM){if(comp.ecoordinates==null){comp.endX=props.left+thisClass.selectorTransformEnd.delta;comp.endY=props.top+thisClass.selectorTransformEnd.delta;}else{comp.ecoordinates.endX=props.left+thisClass.selectorTransformEnd.delta;comp.ecoordinates.endY=props.top+thisClass.selectorTransformEnd.delta;}comp.render(false);}$("#"+thisClass.selectorTransformEnd.id).css("z-index",thisClass.page.stackOrder.size()+10);mf_main.moveCategoryTop();if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}}}else{if(thisClass.transformDragType=="path"){try{var comp=thisClass.selectedComponent;comp.mouseX=(e.pageX-$("#mfContainerPage").position().left)/thisClass.SCALE;comp.mouseY=(e.pageY-$("#mfContainerPage").position().top)/thisClass.SCALE;comp.render(false);if(thisClass.selectorTransformPath&&thisClass.selectorTransformPath.selector.component&&!thisClass.selectorTransformPath.selector.component.transformLock){thisClass.selectorTransformPath.x=props.left+thisClass.selectorTransformPath.delta;thisClass.selectorTransformPath.y=props.top+thisClass.selectorTransformPath.delta;thisClass.selectorTransformPath.render(false);$(".transformPathHandle").css("z-index",thisClass.page.stackOrder.size()+10);mf_main.moveCategoryTop();if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}}}catch(e){console.log("Error in ArrowPath");}}}}}});$("#mfPage"+mf_main.editorController.page.eid).mousedown(function(e){if(thisClass.VIEWER||thisClass.RENDER){return;}if(thisClass.editingComponent){return;}if(e.which==3){return;}if(!thisClass.lastTextEditComp&&thisClass.EDITOR){thisClass.shortcutsFlag=true;}thisClass.movedObject=false;thisClass.transformDrag=false;$(".mfcustom-menu").hide();if(e.target){var ar=$(e.target).prop("className");if($(e.target).hasClass("transformstarthandle")){e.stopImmediatePropagation();if(thisClass.selectorTransformStart&&thisClass.selectorTransformStart.selector.component){var pt=MF_Utils.globalToLocalPoint(e,thisClass.selectorTransformStart.id);thisClass.offsetMousex=pt.x/thisClass.SCALE;thisClass.offsetMousey=pt.y/thisClass.SCALE;thisClass.transformDrag=true;thisClass.transformDragType="start";var posObject=new Object();posObject.startX=thisClass.selectorTransformStart.selector.component.startX;posObject.startY=thisClass.selectorTransformStart.selector.component.startY;posObject.endX=thisClass.selectorTransformStart.selector.component.endX;posObject.endY=thisClass.selectorTransformStart.selector.component.endY;thisClass.selectorTransformStart.selector.component.prevEcoordinates=posObject;var szObject=new Object();szObject.width=thisClass.selectorTransformStart.selector.component.width;szObject.height=thisClass.selectorTransformStart.selector.component.height;thisClass.selectorTransformStart.selector.component.prevEsize=szObject;}}if($(e.target).hasClass("transformendhandle")){e.stopImmediatePropagation();if(thisClass.selectorTransformEnd&&thisClass.selectorTransformEnd.selector.component){var pt=MF_Utils.globalToLocalPoint(e,thisClass.selectorTransformEnd.id);thisClass.offsetMousex=pt.x/thisClass.SCALE;thisClass.offsetMousey=pt.y/thisClass.SCALE;thisClass.transformDrag=true;thisClass.transformDragType="end";var posObject=new Object();posObject.startX=thisClass.selectorTransformStart.selector.component.startX;posObject.startY=thisClass.selectorTransformStart.selector.component.startY;posObject.endX=thisClass.selectorTransformStart.selector.component.endX;posObject.endY=thisClass.selectorTransformStart.selector.component.endY;thisClass.selectorTransformEnd.selector.component.prevEcoordinates=posObject;var szObject=new Object();szObject.width=thisClass.selectorTransformEnd.selector.component.width;szObject.height=thisClass.selectorTransformEnd.selector.component.height;thisClass.selectorTransformEnd.selector.component.prevEsize=szObject;}}if($(e.target).hasClass("transformPathHandle")){e.stopImmediatePropagation();if(thisClass.selectedComponent){try{var pt=MF_Utils.globalToLocalPoint(e,thisClass.selectedComponent.eid);thisClass.offsetMousex=pt.x/thisClass.SCALE;thisClass.offsetMousey=pt.y/thisClass.SCALE;thisClass.transformDrag=true;thisClass.selectedComponent.selectedDragId=$(e.target).attr("id");thisClass.transformDragType="path";var posObject=new Object();posObject.startX=thisClass.selectorTransformPath.selector.component.startX;posObject.startY=thisClass.selectorTransformPath.selector.component.startY;posObject.endX=thisClass.selectorTransformPath.selector.component.endX;posObject.endY=thisClass.selectorTransformPath.selector.component.endY;thisClass.selectorTransformPath.selector.component.prevEcoordinates=posObject;var szObject=new Object();szObject.width=thisClass.selectorTransformPath.selector.component.width;szObject.height=thisClass.selectorTransformPath.selector.component.height;thisClass.selectorTransformPath.selector.component.prevEsize=szObject;}catch(e){console.log("Error in ArrowPath");}}}if(thisClass.selectedComponent&&thisClass.selectedComponent.NAME=="MF_ArrowPath"&&thisClass.transformDrag){thisClass.selectedComponent.undoFlag=true;}}if(thisClass.transformDrag==false){thisClass.selectComponentByUser(e);}});};this.editorEvents=function(){$("#mfPageArea").mousedown(function(event){try{if(event&&event.target&&event.target.id=="mfPageArea"){if(thisClass.EDITOR){thisClass.clearSelection(true);}}}catch(e){}});$("#mfPanningDiv").mousedown(function(event){event.stopImmediatePropagation();if(thisClass.pagePanning){thisClass.oldPagePosX=event.pageX;thisClass.oldPagePosY=event.pageY;thisClass.pageDragging=true;return;}});$("#mfPanningDiv").mousemove(function(event){event.stopImmediatePropagation();if(thisClass.pagePanning){thisClass.movePagePosX=event.pageX;thisClass.movePagePosY=event.pageY;if(thisClass.pageDragging){$("#mfEditorHolder").scrollTop($("#mfEditorHolder").scrollTop()+(thisClass.oldPagePosY-thisClass.movePagePosY));$("#mfEditorHolder").scrollLeft($("#mfEditorHolder").scrollLeft()+(thisClass.oldPagePosX-thisClass.movePagePosX));thisClass.oldPagePosX=thisClass.movePagePosX;thisClass.oldPagePosY=thisClass.movePagePosY;return;}}});$("#mfPanningDiv").mouseup(function(event){event.stopImmediatePropagation();thisClass.pageDragging=false;if(thisClass.pagePanning){return;}});$("#mfEditorHolder").on("click",function(event){if(thisClass.VIEWER){if(thisClass.commentController){thisClass.commentController.hideAnnotationPointer(false);}}if(thisClass.VIEWER||thisClass.RENDER){return;}if(thisClass.editingComponent){return;}var allowSelection=true;$(".mfcustom-menu").hide();if(event.target&&thisClass.lastTextEditComp){if(thisClass.lastTextEditComp.eid==event.target.id){allowSelection=false;}}if(event.target){var cname=$(event.target).prop("className");if(cname&&$(event.target).hasClass("handle")){allowSelection=false;}if(cname&&$(event.target).hasClass("ui-droppable")){allowSelection=false;}if(cname&&$(event.target).hasClass("drag")){allowSelection=false;}}if(allowSelection){}});$("#mfEditorHolder").mousedown(function(event){if(thisClass.VIEWER||thisClass.RENDER){if(mf_main.REVISION){mf_main.closeDialog();}return;}if(!thisClass.lastTextEditComp&&thisClass.EDITOR){thisClass.shortcutsFlag=true;}var allowSelection=true;if(event&&event.which==3){return;}$(".mfcustom-menu").hide();if(thisClass.lastTextEditComp){allowSelection=false;if(event.target.id==("mfPage"+thisClass.page.eid)||event.target.id=="mfContainerPage"||event.target.id=="mfEditorHolder"){allowSelection=true;}}if(thisClass.commentController.NOTEANNOTATEMODE){allowSelection=false;}if(allowSelection){thisClass.mouseMoving=true;thisClass.clearSelection(true);thisClass.offsetYPos=$("#mfContainerPage").offset().top+$("#mfEditorHolder").scrollTop();thisClass.offsetXPos=$("#mfContainerPage").offset().left+$("#mfEditorHolder").scrollLeft();if(thisClass.compMode){$("#selectionBox").css("background-color","rgba(0,0,0,0.3)");$("#selectionBox").css("opacity","1");$("#selectionBox").css("border-width","2px");}else{$("#selectionBox").css("background-color","#025ADA");$("#selectionBox").css("opacity","0.3");$("#selectionBox").css("border-width","1px");}$("#selectionBox").css("z-index",thisClass.page.stackOrder.size()+20);mf_main.moveCategoryTop();thisClass.original={top:(event.pageY-thisClass.offsetYPos),left:(event.pageX-thisClass.offsetXPos)};$("#selectionBox").css("top",(thisClass.original.top+$("#mfEditorHolder").scrollTop())/thisClass.SCALE);$("#selectionBox").css("left",(thisClass.original.left+$("#mfEditorHolder").scrollLeft())/thisClass.SCALE);thisClass.curYPos=event.pageY;thisClass.curXPos=event.pageX;thisClass.originalLocal=MF_Utils.globalToLocalPoint(event,"mfContainerPage");}});$("#mfEditorHolder").mousemove(function(event){if(thisClass.VIEWER||thisClass.RENDER){return;}if(thisClass.mouseMoving){var npt=MF_Utils.globalToLocalPoint(event,"mfContainerPage");var pos={top:(event.pageY-thisClass.offsetYPos),left:(event.pageX-thisClass.offsetXPos)};if(npt.y<thisClass.originalLocal.y){$("#selectionBox").css("top",(pos.top/thisClass.SCALE)+($("#mfEditorHolder").scrollTop()/thisClass.SCALE));}if(npt.x<thisClass.originalLocal.x){$("#selectionBox").css("left",(pos.left/thisClass.SCALE)+($("#mfEditorHolder").scrollLeft()/thisClass.SCALE));}var sh=Math.abs(pos.top-thisClass.original.top);var sw=Math.abs(pos.left-thisClass.original.left);if(npt.y>thisClass.originalLocal.y){if(npt.y>$("#selectionBox").position().top){sh=npt.y-$("#selectionBox").position().top;}if(npt.y<$("#selectionBox").position().top){sh=$("#selectionBox").position().top-npt.y;}}if(npt.x>thisClass.originalLocal.x){if(npt.x>$("#selectionBox").position().left){sw=npt.x-$("#selectionBox").position().left;}if(npt.x<$("#selectionBox").position().left){sw=$("#selectionBox").position().left-npt.x;}}if(npt.y<thisClass.originalLocal.y){if(thisClass.originalLocal.y>$("#selectionBox").position().top){sh=thisClass.originalLocal.y-$("#selectionBox").position().top;}if(thisClass.originalLocal.y<$("#selectionBox").position().top){sh=$("#selectionBox").position().top-thisClass.originalLocal.y;}}if(npt.x<thisClass.originalLocal.x){if(thisClass.originalLocal.x>$("#selectionBox").position().left){sw=thisClass.originalLocal.x-$("#selectionBox").position().left;}if(thisClass.originalLocal.x<$("#selectionBox").position().left){sw=$("#selectionBox").position().left-thisClass.originalLocal.x;}}if(event.pageY>($(window).height()-40)){if(event.pageY>thisClass.curYPos){$("#mfEditorHolder").scrollTop($("#mfEditorHolder").scrollTop()+50);}}else{if(event.pageY<40){if(event.pageY<thisClass.curYPos){$("#mfEditorHolder").scrollTop($("#mfEditorHolder").scrollTop()-50);}}}if(event.pageX>($(window).width()-40)){if(event.pageX>thisClass.curXPos){$("#mfEditorHolder").scrollLeft($("#mfEditorHolder").scrollLeft()+50);}}else{if((event.pageX-thisClass.leftMargin)<40){if(event.pageX<thisClass.curXPos){$("#mfEditorHolder").scrollLeft($("#mfEditorHolder").scrollLeft()-50);}}}sh=sh/thisClass.SCALE;sw=sw/thisClass.SCALE;$("#selectionBox").height(sh);$("#selectionBox").width(sw);$("#selectionBox").css("visibility","visible");thisClass.calculateSelection(0,0);}});$("#mfPageManagerArea").mouseup(function(event){if(thisClass.VIEWER||thisClass.RENDER){return;}thisClass.editorHolderMouseUpFn(event,true);});$("#mfPageMoreArea").mouseup(function(event){if(thisClass.VIEWER||thisClass.RENDER){return;}thisClass.editorHolderMouseUpFn(event,true);});$("#mfEditorHolder").mouseup(function(event){if(thisClass.VIEWER||thisClass.RENDER){return;}thisClass.editorHolderMouseUpFn(event);});};this.editorHolderMouseUpFn=function(event,noselect){if(thisClass.mouseMoving){try{thisClass.mouseMoving=false;thisClass.calculateSelection(0,0);thisClass.onGlobalSelect=true;if(thisClass.compMode){var twidth=$("#selectionBox").width()+5;var theight=$("#selectionBox").height()+5;var tx=$("#selectionBox").position().left;var ty=$("#selectionBox").position().top;twidth=twidth/thisClass.SCALE;theight=theight/thisClass.SCALE;if(twidth>5&&theight>5){var comptype=thisClass.compModeType;var actualCompType=thisClass.compModeType;if(thisClass.compModeType=="MF_Heading1"||thisClass.compModeType=="MF_Heading2"){comptype="MF_Text";}tx=tx/thisClass.SCALE;ty=ty/thisClass.SCALE;var acomp=mf_main.componentList.invokeComponent(comptype,"new",tx,ty);thisClass.closeCompMode();if(comptype=="MF_Text"){if(actualCompType=="MF_Heading1"){acomp.e2xml.addPropSingle("text","Heading","default");acomp.e2xml.addPropSingle("fontSize",50,"default");acomp.e2xml.addPropSingle("fontWeight","bold","default");acomp.render(false);thisClass.lastSetting=null;thisClass.openSetting(thisClass.selectorResize.selector);}if(actualCompType=="MF_Heading2"){acomp.e2xml.addPropSingle("text","Subheading","default");acomp.e2xml.addPropSingle("fontSize",36,"default");acomp.e2xml.addPropSingle("fontWeight","bold","default");acomp.render(false);thisClass.lastSetting=null;thisClass.openSetting(thisClass.selectorResize.selector);}}if(comptype=="MF_AdvancedDataGrid"){var szObject=new Object();szObject.width=acomp.width;szObject.height=acomp.height;acomp.prevEsize=szObject;acomp.render(true);mf_main.editorController.reStackComponents();}if(comptype=="MF_Arrow2"){if(thisClass.selectorResize&&thisClass.selectorResize.selector&&thisClass.selectorResize.selector.component&&thisClass.selectorResize.selector.component.NAME=="MF_Arrow2"){thisClass.selectorResize.selector.component.e2xml.addPropSingle("arrowDirection","none","default");thisClass.selectorResize.selector.component.e2xml.addPropSingle("arrowColor","#000000","default");thisClass.selectorResize.selector.component.render(false);thisClass.lastSetting=null;thisClass.openSetting(thisClass.selectorResize.selector);}}}else{thisClass.closeCompMode();}}else{thisClass.closeCompMode();if(thisClass.componentSelect.length>1){thisClass.performGlobalSelection();}if(thisClass.componentSelect.length==1){var selectSetting=thisClass.componentSelect[0];if(selectSetting&&selectSetting.component){if(selectSetting.component.GROUPID==""){thisClass.selectHighlight(selectSetting);if(selectSetting.component.TRANSFORM){thisClass.addSelectorTransform(selectSetting);}thisClass.addSelectorResize(selectSetting);}}else{if(selectSetting){if(!selectSetting.locked){thisClass.selectHighlight(selectSetting);thisClass.addSelectorResize(selectSetting);}}}}else{if(thisClass.globalselect){}}}thisClass.hideSelectionBox();}catch(err){}}else{if(!noselect){thisClass.closeCompMode();if(thisClass.selectedComponent){thisClass.componentAfterMove(event);}}}if(thisClass.drawController){thisClass.drawController.stopDrawing();}};this.hideSelectionBox=function(e,page){$("#selectionBox").css("visibility","hidden");$("#selectionBox").css("z-index",-1);$("#selectionBox").width(0);$("#selectionBox").height(0);$("#selectionBox").css({position:"absolute",top:0,left:0});};this.getMouse=function(e,page){var element=page,offsetX=0,offsetY=0;if(element.offsetParent){do{offsetX+=element.offsetLeft;offsetY+=element.offsetTop;}while((element=element.offsetParent));}mx=(e.pageX-offsetX);my=(e.pageY-offsetY);var scrollTop=document.getElementById("mfEditorHolder").scrollTop;var scrollLeft=document.getElementById("mfEditorHolder").scrollLeft;mx=mx+scrollLeft;my=my+scrollTop;var obj=new Object();obj.mx=mx;obj.my=my;return obj;};this.removeGlobalSelect=function(){if(thisClass.globalselect!=null){thisClass.globalselect.removeSelectionHighlights();$("#"+thisClass.globalselect.id).remove();thisClass.globalselect=null;}};this.rePositionComponents=function(selector,bmeta,reset){if(!reset){thisClass.tempRememberGroup=new Object();}try{if(bmeta==null){bmeta=true;}var undoarr=new Array();for(var selectid in selector.globalselects){var select=selector.globalselects[selectid];if(!select.locked||selector.GROUP){if(!select.GROUP){var undo=new MF_UndoDAO();undo.propObjectUndo(select.component,"ecoordinates",select.component.ecoordinates);undoarr[undoarr.length]=undo;if(select.component&&select.component.NAME=="MF_ArrowPath"){var undo=new MF_UndoDAO();var wayPoints=select.component.wayPoints;if(typeof(select.component.wayPoints)!="string"){wayPoints=JSON.stringify(select.component.wayPoints);}undo.propArrayUndo(select.component,"wayPoints",wayPoints);undoarr.push(undo);}}var oldy=select.y;if(select.GROUP&&thisClass.tempRememberGroup[select.GROUPID]){}else{if(selector.origX>selector.x){select.x=select.x-(selector.origX-selector.x);}else{select.x=select.x+(selector.x-selector.origX);}if(selector.origY>selector.y){select.y=select.y-(selector.origY-selector.y);}else{select.y=select.y+(selector.y-selector.origY);}select.render(false);}if(select.GROUP&&!thisClass.tempRememberGroup[select.GROUPID]){thisClass.tempRememberGroup[select.GROUPID]=true;var arr=thisClass.rePositionComponents(select,false,true);for(var j=0;j<arr.length;j++){var udo=arr[j];undoarr[undoarr.length]=udo;}}else{if(select.component){var comp=select.component;if(comp.TRANSFORM){comp.x=comp.selector.x+comp.selector.delta;comp.y=comp.selector.y+comp.selector.delta;comp.computePoints();$("#"+comp.eid).css("left",select.x+select.delta);$("#"+comp.eid).css("top",select.y+select.delta);}if(comp.NAME=="MF_ArrowPath"){comp.isComponentMoved=true;}select.setCoordinate(false,false);}}}}if(bmeta){if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);meta.reselectMeta=true;undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}}selector.origX=selector.x;selector.origY=selector.y;return undoarr;}catch(err){}return null;};this.reAngleComponents=function(selector,bmeta){try{if(bmeta==null){bmeta=true;}var undoarr=new Array();for(var selectid in selector.globalselects){var select=selector.globalselects[selectid];if(!select.locked||selector.GROUP){if(!select.GROUP){var undo=new MF_UndoDAO();undo.propObjectUndo(select.component,"eangle",select.component.eangle);undoarr[undoarr.length]=undo;}select.render(false);if(select.GROUP){var arr=thisClass.reAngleComponents(select);for(var j=0;j<arr.length;j++){var udo=arr[j];undoarr[undoarr.length]=udo;}}else{if(select.component){var comp=select.component;if(comp.TRANSFORM){}else{select.component.e2xml.addPropSingle("eangle",selector.angle,"default");MF_Utils.rotate(select.id,selector.angle);}}}}}if(bmeta){if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);meta.reselectMeta=true;undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}}return undoarr;}catch(err){}return null;};this.resetSelector=function(obj){var selector=obj.selector;if(selector!=null){thisClass.resetSelectorSize();thisClass.clearSelection(true);if(obj.NAME!="Page"){thisClass.selectHighlight(selector);}}};this.resetSelectorSize=function(obj){var selector=obj.selector;if(selector!=null){selector.x=obj.x-selector.delta;selector.y=obj.y-selector.delta;selector.width=obj.width+(selector.delta*2);selector.height=obj.height+(selector.delta*2);selector.angle=obj.eangle;}};this.globalSelectorMoveOnDrag=function(gselector,groupselect){if(groupselect==null){groupselect=gselector;}if(groupselect&&groupselect.GLOBAL_SELECT==true){for(var selectid in groupselect.globalselects){var select=groupselect.globalselects[selectid];select.setBalpha(0);var gmx=select.x;var gmy=select.y;var gx=gselector.x*thisClass.SCALE;var gy=gselector.y*thisClass.SCALE;if(gselector.origX>gx){gmx=select.x-(gselector.origX-gx);}else{gmx=select.x+(gx-gselector.origX);}if(gselector.origY>gy){gmy=select.y-(gselector.origY-gy);}else{gmy=select.y+(gy-gselector.origY);}if(select.GROUP){thisClass.globalSelectorMoveOnDrag(gselector,select);}else{if(select.component){if(select.component.TRANSFORM){$("#"+select.component.eid).css("left",gmx);$("#"+select.component.eid).css("top",gmy);}else{$("#"+select.component.eid).css("left",gmx-select.component.delta);$("#"+select.component.eid).css("top",gmy-select.component.delta);}}}}}};this.globalSelectorMove=function(selector){if(selector&&selector.GLOBAL_SELECT){var gdiffx=selector.origX-selector.x;if(selector.x>selector.origX){gdiffx=Math.round(selector.x-selector.origX);}var gdiffy=selector.origY-selector.y;if(selector.y>selector.origY){gdiffy=Math.round(selector.y-selector.origY);}if(gdiffx>1||gdiffy>1){thisClass.rePositionComponents(selector);}else{selector.x=Math.round(selector.origX);selector.y=Math.round(selector.origY);}selector.render(false);}};this.calculateGlobalSelection=function(nocreate){var selcounter=0;var minX=0;var minY=0;var maxX=0;var maxY=0;var bInclude=true;var newselect=new Array();if(thisClass.currentGroupEdit!=null){}for(var i=0;i<thisClass.componentSelect.length;i++){var select=thisClass.componentSelect[i];if(thisClass.currentGroupEdit!=null){if(select.component&&select.component.GROUPID==thisClass.currentGroupEdit){bInclude=true;}else{bInclude=false;if(select.GROUPID!=""&&select.GLOBAL_SELECT){var grp=thisClass.page.groupManager.getGroupByID(select.GROUPID);if(grp&&grp.parent==thisClass.currentGroupEdit){bInclude=true;}}}}else{if(select.component&&select.component.GROUPID!=""){bInclude=false;}else{bInclude=true;}}if(select.locked){bInclude=false;}if(bInclude){if(select.GROUP){select.UnSelect();}newselect.push(select);selcounter++;thisClass.globalselect.globalselects[select.id]=select;if(thisClass.isShift||thisClass.isCtrl){select.setBalpha(0.4);}var selwidth=select.width;var selheight=select.height;var selx=select.x;var sely=select.y;if(select.angle!=0){var obj=MF_Utils.getRotatedSize(selx,sely,selwidth,selheight,select.angle);selx=obj.x;sely=obj.y;selwidth=obj.width;selheight=obj.height;}if(selcounter==1){minX=selx;minY=sely;maxX=selx+selwidth;maxY=sely+selheight;}else{if(selx<minX){minX=selx;}if(sely<minY){minY=sely;}if((selx+selwidth)>maxX){maxX=selx+selwidth;}if((sely+selheight)>maxY){maxY=sely+selheight;}}}}if(newselect.length>1){thisClass.componentSelect=newselect;thisClass.globalselect.x=Math.round(minX);thisClass.globalselect.y=Math.round(minY);thisClass.globalselect.origX=Math.round(minX);thisClass.globalselect.origY=Math.round(minY);thisClass.globalselect.width=Math.round(maxX-minX);thisClass.globalselect.height=Math.round(maxY-minY);if(nocreate){thisClass.globalselect.render(false);thisClass.addSelectorResize(thisClass.globalselect);if(thisClass.globalselect){thisClass.openSetting(thisClass.globalselect);}}else{if(thisClass.shiftPressed){thisClass.globalselect.visible=false;}thisClass.globalselect.render();if(thisClass.isShift||thisClass.isCtrl){thisClass.hideGlobalSelect();}else{thisClass.showGlobalSelect();}thisClass.selectorEvents(thisClass.globalselect);$("#"+thisClass.globalselect.id).css("z-index",this.page.stackOrder.size()+5);mf_main.moveCategoryTop();thisClass.addSelectorResize(thisClass.globalselect);if(thisClass.globalselect){thisClass.openSetting(thisClass.globalselect);}}}};this.performGlobalSelection=function(){if(thisClass.componentSelect.length>1){thisClass.removeSelectorResize();thisClass.removeSelectorTransform();thisClass.onGlobalSelect=true;thisClass.removeGlobalSelect();thisClass.globalselect=new MF_Selector();thisClass.globalselect.GLOBAL_SELECT=true;thisClass.globalselect.Select();thisClass.globalselect.globalselects=new Object();thisClass.globalselect.id="Global_"+thisClass.guidGenerator();thisClass.calculateGlobalSelection();}else{thisClass.removeGlobalSelect();}};this.calculateSelection=function(refx,refy){thisClass.componentSelect=new Array();if($("#selectionBox")!=null&&$("#selectionBox").css("visibility")=="visible"){var twidth=$("#selectionBox").width()*thisClass.SCALE;var theight=$("#selectionBox").height()*thisClass.SCALE;var tx=$("#selectionBox").position().left;var ty=$("#selectionBox").position().top;if(twidth<0){twidth=-(twidth);refx=$("#selectionBox").width()+tx;}else{refx=tx;}if(theight<0){theight=-(theight);refy=$("#selectionBox").height()+ty;}else{refy=ty;}refx=refx/thisClass.SCALE;refy=refy/thisClass.SCALE;tx=tx/thisClass.SCALE;ty=ty/thisClass.SCALE;twidth=twidth/thisClass.SCALE;theight=theight/thisClass.SCALE;for(var i=0;i<thisClass.page.childComponents.size();i++){var component=thisClass.page.childComponents.getItemAt(i);var componentselect=component.selector;if(componentselect instanceof MF_Selector&&!componentselect.locked){var allow=true;if(thisClass.currentGroupEdit!=null){if(componentselect.component&&componentselect.component.GROUPID==thisClass.currentGroupEdit){allow=true;}else{allow=false;}}else{if(componentselect.component&&componentselect.component.GROUPID!=""){allow=false;}else{allow=true;}}if(allow){thisClass.checkSelection(componentselect,refx,refy,twidth,theight);}}}if(thisClass.currentGroupEdit!=null){for(var gid in thisClass.page.groupManager.groups){var grp=thisClass.page.groupManager.groups[gid];if(grp&&grp.parent==thisClass.currentGroupEdit){if(grp.selector){thisClass.checkSelection(grp.selector,refx,refy,twidth,theight);}}}}if(thisClass.currentGroupEdit==null){for(var k in thisClass.page.groupManager.groupSelectors){var gselector=thisClass.page.groupManager.groupSelectors[k];var nestedGroup="";if(thisClass.currentGroupEdit!=null){nestedGroup=thisClass.currentGroupEdit;}var grpObj=thisClass.page.groupManager.getGroupByID(gselector.GROUPID);if(gselector&&!gselector.locked&&grpObj&&grpObj.parent==nestedGroup){thisClass.checkSelection(gselector,refx,refy,twidth,theight);}}}}};this.checkSelection=function(componentselect,refx,refy,twidth,theight){var cx1=componentselect.x+componentselect.delta;var cx2=(componentselect.x+componentselect.delta)+(componentselect.width-(componentselect.delta*2));var cy1=componentselect.y+componentselect.delta;var cy2=(componentselect.y+componentselect.delta)+(componentselect.height-(componentselect.delta*2));if(componentselect.angle!=0){var deg=componentselect.angle;var selx=componentselect.x;var sely=componentselect.y;var selwidth=componentselect.width;var selheight=componentselect.height;var obj=MF_Utils.getRotatedSize(selx,sely,selwidth,selheight,deg);selx=obj.x;sely=obj.y;selwidth=obj.width;selheight=obj.height;cx1=selx;cy1=sely;cx2=selwidth+selx;cy2=selheight+sely;}if(((cx1<(refx+twidth))&&(cx1>refx))&&((cx2>refx)&&(cx2<(refx+twidth)))&&((cy1<(refy+theight))&&(cy1>refy))&&((cy2>refy)&&(cy2<(refy+theight)))){thisClass.selectHighlight(componentselect);}else{componentselect.setBalpha(0);componentselect.currentState="unselected";}};this.checkCloseGroup=function(ix,iy){if(thisClass.currentGroupEdit!=null){var groupcollection=thisClass.page.groupManager.groups[thisClass.currentGroupEdit].children;var highestWidth=0;var highestHeight=0;var lowestXPos=0;var lowestYPos=0;var tcount=0;var wid=0;var hei=0;if(groupcollection){for(var k=0;k<groupcollection.size();k++){var comp=groupcollection.getItemAt(k);var dim=comp.selector;wid=dim.width;hei=dim.height;if((dim.x+wid)>highestWidth){highestWidth=dim.x+wid;}if((dim.y+hei)>highestHeight){highestHeight=dim.y+hei;}if(tcount==0){lowestXPos=dim.x;lowestYPos=dim.y;}else{if(dim.x<lowestXPos){lowestXPos=dim.x;}if(dim.y<lowestYPos){lowestYPos=dim.y;}}tcount++;}if(ix>=lowestXPos&&ix<=(lowestXPos+highestWidth)&&iy>=lowestYPos&&iy<=(lowestYPos+highestHeight)){}else{thisClass.closeGroupEditing();}}}};this.handleDropEvent=function(event,ui){event.stopImmediatePropagation();if(!thisClass.pageloaded){return;}if(thisClass.pageEditorLocked){return;}thisClass.closeCompMode();var draggable=ui.draggable;var offsetXPos=parseInt(ui.offset.left);var offsetYPos=parseInt(ui.offset.top);var scrollTop=document.getElementById("mfEditorHolder").scrollTop;var scrollLeft=document.getElementById("mfEditorHolder").scrollLeft;offsetYPos=offsetYPos-50+scrollTop;offsetXPos=offsetXPos-$("#mfContainerPage").css("left").replace("px","")+scrollLeft;offsetXPos=(event.originalEvent.pageX-$("#mfContainerPage").position().left)/thisClass.SCALE;offsetYPos=(event.originalEvent.pageY-$("#mfContainerPage").position().top)/thisClass.SCALE;if(offsetXPos<0){offsetXPos=0;}if(offsetYPos<0){offsetYPos=0;}offsetXPos=MF_Utils.roundUp5(offsetXPos);offsetYPos=MF_Utils.roundUp5(offsetYPos);thisClass.checkCloseGroup(offsetXPos,offsetYPos);if(draggable.attr("data-type")=="mfimagecomp"){mf_main.componentList.invokeComponent("MF_ImageComp","new",offsetXPos,offsetYPos,draggable.attr("id").replace("mfImgItem",""));}else{var ctype=draggable.attr("id").replace("mfComponentItem_","");if(ctype=="MF_BYOC"){if(MF_UserSession.getUser()&&MF_UserSession.getUser().isBasic){var ans=confirm("BYOC is not available in basic plan. Learn more about BYOC?");if(ans){window.open("https://support.mockflow.com/article/236-about-byoc","_blank");}return;}}var isDB=draggable.attr("db-comp");var isPack=draggable.attr("db-pack");if(isPack=="true"){var packid=draggable.attr("db-packid");var masterclient=draggable.attr("db-masterclient");thisClass.loadPackComponent(ctype,offsetXPos,offsetYPos,packid,masterclient);}else{if(isDB=="true"){thisClass.loadDBComponent(ctype,offsetXPos,offsetYPos);}else{var comtype=draggable.attr("id").replace("mfComponentItem_","");if(comtype=="MF_Rectangle"){comtype="MF_Rectangle2";}if(comtype=="MF_Button"){comtype="MF_Button2";}mf_main.componentList.invokeComponent(comtype,"new",offsetXPos,offsetYPos);}}mf_main.editorController.enableShortcuts();}};this.loadPackComponent=function(ctype,offsetXPos,offsetYPos,packid,masterclient){mf_main.componentList.addPlaceHolderComponent(offsetXPos,offsetYPos);if(thisClass.cachedDBComponents[ctype]){thisClass.addDBComponent(thisClass.cachedDBComponents[ctype],offsetXPos,offsetYPos);}else{var mfOriginalPackId=mf_main.componentList.currentCategoryObj.id;var mfComponentClientId=mf_main.componentList.currentCategoryObj.masterClientid;if(mfComponentClientId==null&&!mf_main.componentList.currentCategoryObj.isMergeablePack){mfComponentClientId=mf_main.componentList.currentCategoryObj.clientid;}if(mf_main.componentList.currentCategoryObj.isMergeablePack&&mf_main.componentList.mergeablePackData&&mf_main.componentList.mergeablePackData.length>0){mfOriginalPackId=packid;mfComponentClientId=masterclient;}MF_PackManager.loadComponent(ctype,mfOriginalPackId,mfComponentClientId,mf_main.editorController.projectObj,{callback:function(dbComponent){if(dbComponent){thisClass.addDBComponent2Page(ctype,dbComponent,offsetXPos,offsetYPos);}}});}};this.addDBComponent2Page=function(ctype,dbComponent,offsetXPos,offsetYPos){if(dbComponent.customFonts&&dbComponent.customFonts.length>0){for(var i=0;i<dbComponent.customFonts.length;i++){var customFontObj=dbComponent.customFonts[i];mf_main.editorController.fontController.addCustomFontHandler(customFontObj);mf_main.rtc.customFontSync("addcustomfont",customFontObj,true);}}thisClass.cachedDBComponents[ctype]=dbComponent.data;thisClass.addDBComponent(dbComponent.data,offsetXPos,offsetYPos);if(dbComponent.images&&dbComponent.images.length>0){if(thisClass.imageController.listed){for(var p=0;p<dbComponent.images.length;p++){thisClass.imageController.imageCollection.addItemAt(dbComponent.images[p],0);}thisClass.imageController.applyTemplate(thisClass.imageController.imageCollection.toArray());}mf_main.rtc.imageSync("refreshImageListing",null);}};this.loadDBComponent=function(ctype,offsetXPos,offsetYPos){mf_main.componentList.addPlaceHolderComponent(offsetXPos,offsetYPos);if(thisClass.cachedDBComponents[ctype]){thisClass.addDBComponent(thisClass.cachedDBComponents[ctype],offsetXPos,offsetYPos);}else{MF_WireframeStoreManager.loadDBComponent(ctype,mf_main.editorController.projectObj,{callback:function(dbComponent){if(dbComponent){thisClass.addDBComponent2Page(ctype,dbComponent,offsetXPos,offsetYPos);}}});}};this.addDBComponent=function(dbCompData,offsetXPos,offsetYPos){if(mf_main.editorController.pageEditorLocked){return;}var jData=$(dbCompData);var copyComponents=new Array();var minX=-1;var minY=-1;var componentPresent=new Object();jData.find("component").each(function(){var queObjmain=new MF_ComponentQueue();queObjmain.componentXML=$(this);var ctype=$(this).attr("type");if(mf_main.componentList.loadedComponentCode[ctype]){}else{componentPresent[ctype]=true;}var thisx=parseFloat(queObjmain.componentXML.attr("x"));var thisy=parseFloat(queObjmain.componentXML.attr("y"));if(queObjmain.componentXML.attr("startX")){var thisx=parseFloat(queObjmain.componentXML.attr("startX"));var thisy=parseFloat(queObjmain.componentXML.attr("startY"));}if(minX==-1){minX=thisx;}else{if(thisx<minX){minX=thisx;}}if(minY==-1){minY=thisy;}else{if(thisy<minY){minY=thisy;}}var arr=new Array();arr.push(queObjmain);var copyObj=new MF_CopyComponent(arr);copied=true;copyComponents.push(copyObj);});for(var m=0;m<copyComponents.length;m++){var componentData=copyComponents[m];for(var k=0;k<componentData.componentQueue.length;k++){var comp=componentData.componentQueue[k];var setx=offsetXPos+(parseFloat(comp.componentXML.attr("x"))-minX);var sety=offsetYPos+(parseFloat(comp.componentXML.attr("y"))-minY);comp.componentXML.attr("x",(setx).toString());comp.componentXML.attr("y",(sety).toString());if(comp.componentXML.attr("startX")){setx=offsetXPos+(parseFloat(comp.componentXML.attr("startX"))-minX);sety=offsetYPos+(parseFloat(comp.componentXML.attr("startY"))-minY);var setx2=offsetXPos+(parseFloat(comp.componentXML.attr("endX"))-minX);var sety2=offsetYPos+(parseFloat(comp.componentXML.attr("endY"))-minY);comp.componentXML.attr("startX",(setx).toString());comp.componentXML.attr("startY",(sety).toString());comp.componentXML.attr("endX",(setx2).toString());comp.componentXML.attr("endY",(sety2).toString());if(comp.componentXML.attr("type")=="MF_ArrowPath"){thisClass.editManager.updateArrowWaypoints(comp.componentXML,offsetXPos-minX,offsetYPos-minY);}}}}var componentsToBeLoaded=new Array();for(var key in componentPresent){componentsToBeLoaded.push(key);}jData.find("mfgroup").each(function(){var propItem=$(this);var gid=propItem.attr("id");var gparent=propItem.attr("parent");var copyObj=new MF_CopyComponent();copyObj.GROUP=true;copyObj.GROUPOBJ=true;copyObj.GROUPID=gid;copyObj.parent=gparent;copyComponents.push(copyObj);});thisClass.editManager.tempPasteComponents=copyComponents;mf_main.componentList.invokeComponentsSrc(componentsToBeLoaded,thisClass.page,true);};this.loadInvokedComponent=function(component,offsetXPos,offsetYPos,imageid){if(component){if(component.NAME=="MF_ImageComp"){if(imageid!=null&&imageid!=""){component.imageID=imageid;}}if(component.NAME=="MF_SVGIcon"||component.NAME=="MF_Illustration"){if(imageid!=null&&imageid!=""){component.SVGUrl=imageid;}}thisClass.loadNewComponent(component,offsetXPos,offsetYPos);thisClass.addSelectorResize(component.selector);thisClass.openSetting(component.selector);mf_main.editorController.addComponentSelect(component.selector);thisClass.resizePage();}};this.loadNewComponent=function(component,offsetXPos,offsetYPos){if(mf_main.editorController.pageEditorLocked){return;}if(component!=null){component.eid="cmp"+thisClass.guidGenerator();if(thisClass.compMode){component.x=offsetXPos;component.y=offsetYPos;}else{component.x=offsetXPos-(component.width/2);component.y=offsetYPos-(component.height/2);}if(component.NAME=="MF_ImageComp"){if(component.imageID!=""){if(component.imageID.includes("/illustrations/")){component.width=200;component.height=200;}else{if(component.imageID.includes("/svg/")){component.width=32;component.height=32;}else{var imgObj=thisClass.imageController.getImageByID("",component.imageID);if(imgObj){component.width=imgObj.width;component.height=imgObj.height;}}}}else{}}if(thisClass.compMode){var twidth=($("#selectionBox").width()+5)*thisClass.SCALE;var theight=($("#selectionBox").height()+5)*thisClass.SCALE;component.width=twidth/thisClass.SCALE;component.height=theight/thisClass.SCALE;}if(component.NAME=="MF_Callout"){var callOutComponents=0;var childComponents=mf_main.editorController.page.childComponents.data;for(var i=0;i<childComponents.length;i++){var childComponent=childComponents[i];if(childComponent.NAME=="MF_Callout"){callOutComponents=callOutComponents+1;}}var calltxt=(callOutComponents+1).toString()+"\nEnter your message here to show on MouseOver in Review mode";component.e2xml.addPropSingle("text",calltxt,"default");}if(component.TRANSFORM){component.x=offsetXPos;component.y=offsetYPos;if(!thisClass.compMode){component.width=100;component.height=0;if(component.NAME=="MF_ArrowPath"){component.height=100;}}component.computePoints();if(thisClass.compMode){if(component.NAME!="MF_ArrowPath"){if($("#selectionBox").width()>=$("#selectionBox").height()){component.endY=component.startY;}else{component.endX=component.startX;}}}}if(component.TRANSFORM){var posObject=new Object();posObject.startX=component.startX;posObject.startY=component.startY;posObject.endX=component.endX;posObject.endY=component.endY;component.e2xml.addPropObject("ecoordinates",posObject,"default");}else{var posObject=new Object();posObject.x=component.x;posObject.y=component.y;component.e2xml.addPropObject("ecoordinates",posObject,"default");}thisClass.page.addComponent(component);thisClass.completeNewComponentLoad(component);}thisClass.editManager.setupLayersSlide();thisClass.reStackComponents();thisClass.openSetting(component.selector);};this.completeNewComponentLoad=function(component){if(component.NAME=="MF_ImageComp"){if(component.imageID!=""){if(component.imageID.includes("/illustrations/")){component.width=200;component.height=200;}else{if(component.imageID.includes("/svg/")){component.width=32;component.height=32;}else{var imgObj=thisClass.imageController.getImageByID("",component.imageID);if(imgObj){component.width=imgObj.width;component.height=imgObj.height;}}}}}var szObject=new Object();szObject.width=component.width;szObject.height=component.height;component.e2xml.addPropObject("esize",szObject,"default");if(component.NAME=="MF_ImageComp"||component.NAME=="MF_Draw"){var szObject=new Object();szObject.width=component.width;szObject.height=component.height;component.originalEsize=szObject;if(component.NAME=="MF_Draw"){component.maintainSize=true;}}component.setDefaultSettings();component.render();var newselector=thisClass.addSelector(component);if(thisClass.currentGroupEdit!=null){component.GROUPID=thisClass.currentGroupEdit;thisClass.page.groupManager.addGroup(thisClass.currentGroupEdit,component);var gselect=thisClass.page.groupManager.groupSelectors[thisClass.currentGroupEdit];if(gselect){if(gselect.globalselects){gselect.globalselects[newselector.id]=newselector;}}mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}if(component.TRANSFORM){component.transformSelector();}};this.loadComponent=function(componentName,placement,eid,asset,currentXML,copyFlag,retainID){if(retainID==undefined){retainID=true;}if(eid==undefined){eid=null;}if(asset==undefined){asset=null;}if(currentXML==undefined){currentXML=null;}if(copyFlag==undefined){copyFlag=false;}var initialPoint=placement;var component=mf_main.componentList.invokeComponent(componentName);if(component){component.x=initialPoint.x;component.y=initialPoint.y;if(eid&&retainID){if(MF_IDManager.IsIDGood(thisClass.page,eid)){component.eid=eid;if(currentXML){if(currentXML.attr("lid")){component.lid=currentXML.attr("lid");}}}else{MF_IDManager.generateComponentID(thisClass.page,component);}}else{MF_IDManager.generateComponentID(thisClass.page,component);}var posObject=new Object();posObject.x=0;posObject.y=0;component.e2xml.addPropObject("ecoordinates",posObject,"default");if(copyFlag){component.setVisible(false);component.e2xml.settingsXML=currentXML;component.e2xml.applySettings();}if(component.NAME=="MF_AdvancedDataGrid"){component.updateAdvancedGridDataId(currentXML);}component.render();var alreadyGrouped=true;var selector=thisClass.addComponent(component,thisClass.page,copyFlag,false);if(component.GROUPID!=""){if(mf_main.editorController.currentGroupEdit==null||mf_main.editorController.currentGroupEdit!=component.GROUPID){alreadyGrouped=true;}}if(thisClass.currentGroupEdit!=null&&!alreadyGrouped){var gselect=thisClass.page.groupManager.groupSelectors[thisClass.currentGroupEdit];if(gselect){if(gselect.globalselects){gselect.globalselects[selector.id]=selector;}}}thisClass.editManager.setupLayersSlide();return selector;}return null;};this.addSelector=function(component,redo,noChange){if(redo==null){redo=false;}if(noChange==null){noChange=false;}var selector=new MF_Selector();selector.x=component.x-selector.delta;selector.y=component.y-selector.delta;selector.height=component.height+(selector.delta*2);selector.width=component.width+(selector.delta*2);selector.setLocking(component.transformLock);selector.component=component;selector.angle=component.eangle;component.selector=selector;selector.render();if(component.TRANSFORM){selector.setVisible(false);}mf_main.editorController.page.stackOrder.addItem(selector);$("#"+selector.id).css("z-index",mf_main.editorController.page.stackOrder.size());mf_main.moveCategoryTop();if(!noChange){var undo=new MF_UndoDAO();undo.addUndo(new Array(selector));if(redo){MF_ChangeManager.addRedo(undo);}else{MF_ChangeManager.addUndo(undo);}}mf_main.editorController.page.addSelector(selector);if(!component.TRANSFORM){thisClass.selectorEvents(selector);if(selector.locked){selector.setLocking(component.transformLock,true);}}if(component.POINTSELECT){$("#"+selector.id).css("pointer-events","none");}if(selector.component){thisClass.startCompObserve(selector.component.eid);}return selector;};this.makeComponentsDraggable=function(){$(".mfComponentItemCls").draggable({cursor:"move",zIndex:1000000,containment:"window",start:function(){thisClass.clearSelection(true);},cursorAt:{top:12,left:65},appendTo:"#mainBody",helper:function(){return $("<div style='padding: 10px; width: 150px; height: 40px; text-align: center; background-color: #2286FB; color: #fff;'>Drop me on the Page</div>");}});};this.blankProject=function(){thisClass.addNewPage();};this.guidGenerator=function(){var S4=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1);};return"D"+(S4()+S4()+S4()+S4()+S4()+S4()+S4()+S4());};this.addNewPage=function(){thisClass.page=new MF_Page();thisClass.page.eid=thisClass.guidGenerator();thisClass.page.createPageData();thisClass.page.e2xml.applySettings();};this.removeComponent=function(component){if(component){mf_main.editorController.stopCompObserve(component.eid);}$("#"+component.eid).remove();thisClass.page.removeComponent(component.eid);if(component&&component.selector){component.selector=null;}component=null;};this.htmlspecialchars=function(str){if(typeof(str)=="string"){str=str.replace(/&/g,"&amp;");str=str.replace(/"/g,"&quot;");str=str.replace(/'/g,"&#039;");str=str.replace(/</g,"&lt;");str=str.replace(/>/g,"&gt;");}return str;};this.resizePage=function(){try{if(thisClass.page&&thisClass.page.loaded&&(thisClass.loadedPages.length==thisClass.pageOrder.length)){var autoSize=true;var pwidth=500;var pheight=500;if(mf_main.editorController.projectObj.sizeType!="sizeless"){autoSize=false;pwidth=mf_main.editorController.projectObj.origWidth;pheight=mf_main.editorController.projectObj.origHeight;}if(mf_main.editorController.page.overrideSize){if(mf_main.editorController.page.sizeType!="sizeless"){autoSize=false;pwidth=mf_main.editorController.page.origWidth;pheight=mf_main.editorController.page.origHeight;}else{autoSize=true;}}if(mf_main.COMPSHOT&&mf_main.compID!=null){autoSize=true;}if(!autoSize){mf_main.editorController.autoSize=false;for(var m=0;m<thisClass.loadedPages.length;m++){var npage=thisClass.loadedPages[m];npage.height=pheight;npage.width=pwidth;if(npage!=thisClass.page){npage.applySize(true);}else{npage.applySize();}}if(mf_main.RENDER){$("#mfrenderbar").attr("data-width",thisClass.page.width);$("#mfrenderbar").attr("data-height",thisClass.page.height);$("#mfrenderbar").attr("data-x",0);$("#mfrenderbar").attr("data-y",0);$("#mfrenderbar").attr("autosize","false");}}else{mf_main.editorController.autoSize=true;var highestWidth=0;var highestHeight=0;var lowestXPos=0;var lowestYPos=0;for(var k=0;k<thisClass.loadedPages.length;k++){var npage=thisClass.loadedPages[k];if(npage==thisClass.page){npage.calculateDimensions();lowestXPos=npage.lowestX;lowestYPos=npage.lowestY;}if(npage.highestWidth>highestWidth){highestWidth=npage.highestWidth;}if(npage.highestHeight>highestHeight){highestHeight=npage.highestHeight;}}if(thisClass.RESTRICT_SIZE){if((highestHeight)>mf_main.editorController.RESTRICT_SIZE_LIMIT){highestHeight=mf_main.editorController.RESTRICT_SIZE_LIMIT;}if((highestWidth)>mf_main.editorController.RESTRICT_SIZE_LIMIT){highestWidth=mf_main.editorController.RESTRICT_SIZE_LIMIT;}}if(thisClass.viewerHeight<(highestHeight)){thisClass.viewerHeight=highestHeight;}if(thisClass.viewerWidth<(highestWidth)){thisClass.viewerWidth=highestWidth;}var extraBuffW=300;var extraBuffH=300;if(thisClass.RESTRICT_SIZE){if((thisClass.viewerWidth+extraBuffW)>thisClass.RESTRICT_SIZE_LIMIT){extraBuffW=0;}if((thisClass.viewerHeight+extraBuffH)>thisClass.RESTRICT_SIZE_LIMIT){extraBuffH=0;}}for(var m=0;m<thisClass.loadedPages.length;m++){var npage=thisClass.loadedPages[m];if(mf_main.RENDER){if(mf_main.COMPSHOT&&mf_main.compID!=null){npage.width=highestWidth+50;npage.height=highestHeight+10;}else{npage.width=highestWidth+100;npage.height=highestHeight+100;}}else{npage.height=thisClass.viewerHeight+extraBuffH;npage.width=thisClass.viewerWidth+extraBuffW;}if(npage.lowestX<lowestXPos){lowestXPos=npage.lowestX;}if(npage.lowestY<lowestYPos){lowestYPos=npage.lowestY;}npage.applySize();}if(mf_main.RENDER){if(mf_main.COMPSHOT&&mf_main.compID!=null){$("#mfrenderbar").attr("data-width",thisClass.page.width);$("#mfrenderbar").attr("data-height",thisClass.page.height);$("#mfrenderbar").attr("data-x",lowestXPos+20);$("#mfrenderbar").attr("data-y",lowestYPos);$("#mfrenderbar").attr("autosize",autoSize.toString());}else{$("#mfrenderbar").attr("data-width",thisClass.page.width);$("#mfrenderbar").attr("data-height",thisClass.page.height);$("#mfrenderbar").attr("data-x",lowestXPos);$("#mfrenderbar").attr("data-y",lowestYPos);$("#mfrenderbar").attr("autosize",autoSize.toString());}}}}if(!mf_main.RENDER){var toppos=0;var leftpos=0;if(!thisClass.autoSize){var visualTopAfterScaling=0;var visualLeftAfterScaling=0;if(thisClass.SCALE!=1){var distanceToCenterTop=$("#mfContainerPage").height()/2;var scaledPushTop=distanceToCenterTop*(thisClass.SCALE-1);visualTopAfterScaling=toppos-scaledPushTop;var distanceToCenterLeft=$("#mfContainerPage").width()/2;var scaledPushLeft=distanceToCenterLeft*(thisClass.SCALE-1);visualLeftAfterScaling=leftpos-scaledPushLeft;}if(thisClass.SCALE<1){leftpos=leftpos-visualLeftAfterScaling;}if(thisClass.SCALE>1){leftpos=leftpos+Math.abs(visualLeftAfterScaling);}if(thisClass.SCALE<1){toppos=toppos-visualTopAfterScaling;}if(thisClass.SCALE>1){toppos=toppos+Math.abs(visualTopAfterScaling);}if(($("#mfContainerPage").width()*thisClass.SCALE)<$("#mfEditorHolder").width()){leftpos=leftpos+(($("#mfEditorHolder").width()/2)-(($("#mfContainerPage").width()*thisClass.SCALE)/2));}else{if(thisClass.SCALE==1){leftpos=0;}else{leftpos=leftpos+0;}}if(($("#mfContainerPage").height()*thisClass.SCALE)<$("#mfEditorHolder").height()){toppos=toppos+(($("#mfEditorHolder").height()/2)-(($("#mfContainerPage").height()*thisClass.SCALE)/2));}else{if(thisClass.SCALE==1){toppos=0;}else{toppos=toppos+0;}}}$("#mfContainerPage").css({top:toppos,left:leftpos});}else{$("#mfContainerPage").css({top:0,left:0});}}catch(e){console.log(e);}};this.get1stPage=function(){var page=null;for(var k=0;k<MF_PagePool.getPages().size();k++){var pitem=MF_PagePool.getPages().getItemAt(k);if(pitem.folder==false){page=pitem;if(!page.navHide){break;}}}return page;};this.cleanLoadedPages=function(page,force){for(var k=0;k<MF_PagePool.getPages().size();k++){var pitem=MF_PagePool.getPages().getItemAt(k);pitem.clean();}};this.isPageLoaded=function(pageid){for(var k=0;k<thisClass.loadedPages.length;k++){var pitem=thisClass.loadedPages[k];if(pitem.eid==pageid){return true;}}return false;};this.listPageOrder=function(page){var masterPage=MF_PagePool.getPage(page.masterPage);if(masterPage){var allow=true;for(var k=0;k<thisClass.pageOrder.length;k++){var loadedPage=thisClass.pageOrder[k];if(masterPage.eid==loadedPage.eid){allow=false;break;}}if(allow){thisClass.pageOrder.push(masterPage);thisClass.listPageOrder(masterPage);}}};this.viewMasterPage=function(page){if(page.masterPage!=""){var masterPage=MF_PagePool.getPage(page.masterPage);if(masterPage){var alreadyLoaded=thisClass.isPageLoaded(page.masterPage);if(alreadyLoaded){thisClass.loadPageComplete();}else{thisClass.loadedPages.push(masterPage);if(masterPage.loaded){}else{$("#mfContainerPage").append('<div  id="mfPage'+masterPage.eid+'" style="top: 0px; left: 0px; background-color: rgba(255,255,255,0.9);   width: 595px; height: 841px; position: absolute; overflow: hidden; " ></div>');}thisClass.loadPage(masterPage);}}else{thisClass.loadPageComplete();}}else{thisClass.loadPageComplete();}};this.viewPage=function(page,force){if(!thisClass.projectObj){return;}if(page&&page.folder){return;}if(thisClass.pageloaded==false){return;}if(mf_main.REVISION){if(mf_main.pageID!=page.eid){return;}}if(thisClass.page){thisClass.closeGroupEditing();thisClass.closeCompMode();thisClass.page.scrollPosX=$("#mfEditorHolder").scrollLeft();thisClass.page.scrollPosY=$("#mfEditorHolder").scrollTop();thisClass.page.zoomScale=thisClass.SCALE;}thisClass.openPageSetting();if(thisClass.page!=page||force){thisClass.currentPageID=page.eid;if(page.zoomScale==-1){if(thisClass.page){page.zoomScale=thisClass.page.zoomScale;}else{page.zoomScale=1;}}thisClass.stopIntersectionObserver();document.title="WireframePro - "+thisClass.projectObj.title+" / "+page.pageName;thisClass.viewerHeight=0;thisClass.viewerWidth=0;thisClass.closeSpecMode();$(".mfViewerCommentNum").hide();thisClass.loadedPages=new Array();thisClass.loadedPages.push(page);thisClass.renderImages=new Array();thisClass.pageOrder=new Array();thisClass.pageOrder.push(page);this.listPageOrder(page);if(thisClass.pageController.treeview){var pageTreeItem=thisClass.pageController.treeview.get_node(page.eid);if(pageTreeItem){setTimeout(function(){thisClass.pageController.treeview.deselect_all(true);thisClass.pageController.treeview.select_node(page.eid);},50);}}document.getElementById("mfEditorHolder").scrollTop=0;document.getElementById("mfEditorHolder").scrollLeft=0;if(page.master==false){thisClass.pageController.selectPage("mfPageItem"+page.eid);}thisClass.clearSelection(true);thisClass.cleanLoadedPages();thisClass.page=page;thisClass.pageloaded=false;$("#mfPageLoader").show();if(thisClass.page.loaded){$("#mfPage"+mf_main.editorController.page.eid).show();if(thisClass.grid){thisClass.grid.setGrid();}}else{thisClass.page.remove();$("#mfContainerPage").append('<div  id="mfPage'+thisClass.page.eid+'" style="top: 0px; left: 0px; background-color: rgba(255,255,255,0.9);   width: 595px; height: 841px; position: absolute; overflow: hidden; " ></div>');}$("#mfPage"+thisClass.page.eid).css("background-color","rgba(255,255,255,1)");if(!thisClass.page.assignedEvents){thisClass.page.assignedEvents=true;thisClass.pageEvents();$("#mfPage"+mf_main.editorController.page.eid).droppable({accept:".mfComponentItemCls",drop:thisClass.handleDropEvent});$("#mfPage"+mf_main.editorController.page.eid).droppable("enable");}else{$("#mfPage"+mf_main.editorController.page.eid).droppable({accept:".mfComponentItemCls",drop:thisClass.handleDropEvent});$("#mfPage"+mf_main.editorController.page.eid).droppable("enable");}if(!thisClass.page.loaded){thisClass.imageController.initEditorDropHandler("mfPage"+mf_main.editorController.page.eid);}if(mf_main.editorController.videoChatController!=null){mf_main.editorController.videoChatController.triggerPageChange();}$("#mfBackgroundPage").width($("#mfPage"+thisClass.page.eid).width());$("#mfBackgroundPage").height($("#mfPage"+thisClass.page.eid).height());try{$(".mfPageTracer").hide();if(thisClass.EDITOR&&$("#mfPageTracer"+thisClass.page.eid).length>0){$("#mfPageTracer"+thisClass.page.eid).show();}}catch(e){console.log("Error in wireframe tracer");}thisClass.loadPage(page);}else{if(thisClass.powerupCallbackOptions&&thisClass.powerupCallbackOptions.isEnableSelectMode){if(thisClass.powerupCallbackOptions.type=="getcomponentimage"){thisClass.enableSelectMode("powerup-compImageMode");}else{thisClass.enableSelectMode("powerup-specsmode");}}}try{if(thisClass.RENDER==false){thisClass.pageController.treeview.get_node(thisClass.page.eid,true).children(".jstree-anchor").focus();}}catch(err){}};this.loadPageComplete=function(){if(thisClass.loadedPages&&thisClass.loadedPages.length>=1){mf_main.editorController.page=thisClass.loadedPages[0];}thisClass.resizePage();$("#mfPageLoader").hide();$("#mfContainerPage").show();thisClass.pageloaded=true;mf_main.interfaceResize();$("#mfMainEditorLoader").hide();mf_main.editorController.reStackComponents();thisClass.layersController.listLayers();if(mf_main.RENDER){document.getElementById("mfEditorHolder").scrollTop=0;document.getElementById("mfEditorHolder").scrollLeft=0;}else{thisClass.SCALE=thisClass.page.zoomScale;thisClass.zoomPage();document.getElementById("mfEditorHolder").scrollTop=thisClass.page.scrollPosY;document.getElementById("mfEditorHolder").scrollLeft=thisClass.page.scrollPosX;}if(thisClass.page.layerLevel!=-1){thisClass.editManager.showAllHandler();}else{thisClass.editManager.closeLayersPanel();}var count=1;for(var k=thisClass.loadedPages.length-1;k>=0;k--){var loadedPage=thisClass.loadedPages[k];$("#mfPage"+loadedPage.eid).css("z-index",count);if(thisClass.page==loadedPage){if(thisClass.EDITOR){if(thisClass.page.overrideBackground){if(thisClass.page.backgroundColor=="transparent"){$("#mfPage"+loadedPage.eid).css("background-color","transparent");}else{$("#mfPage"+loadedPage.eid).css("background-color",MF_ComponentUtils.hexToRGB(thisClass.page.backgroundColor,0.7));}}else{if(thisClass.gridController.backgroundColor=="transparent"){$("#mfPage"+loadedPage.eid).css("background-color","transparent");}else{$("#mfPage"+loadedPage.eid).css("background-color",MF_ComponentUtils.hexToRGB(thisClass.gridController.backgroundColor,0.7));}}}else{if(mf_main.REVISION){$("#mfPage"+loadedPage.eid).css("background-color",MF_ComponentUtils.hexToRGB(thisClass.gridController.backgroundColor,0.7));}else{$("#mfPage"+loadedPage.eid).css("background-color","rgba(255,255,255,0)");}}}else{if(thisClass.EDITOR){$("#mfPage"+loadedPage.eid).droppable({accept:".mfComponentItemCls",drop:thisClass.handleDropEvent});$("#mfPage"+loadedPage.eid).droppable("disable");}$("#mfPage"+loadedPage.eid).css("background-color","rgba(255,255,255,0)");}count++;}$("#mfBackgroundPage").css("background-image","");$("#mfBackgroundPage").css("background-repeat","");if(thisClass.page.overrideBackground){if(mf_main.RENDER&&!mf_main.REVISION){$("#mfEditorHolder").css("background",thisClass.page.backgroundColor);$("#mfMainEditorUI").css("background-color",thisClass.page.backgroundColor);$("#mainBody").css("background-color",thisClass.page.backgroundColor);}if(thisClass.page.backgroundColor=="transparent"){if(mf_main.RENDER&&!mf_main.REVISION){$("#mfBackgroundPage").css("background","transparent");$("#mfBackgroundPage").css("background-color","transparent");}else{$("#mfBackgroundPage").css("background-image",'url("images/editor/transparent-BG.png")');$("#mfBackgroundPage").css("background-repeat","repeat");if(mf_main.REVISION){}}}else{$("#mfBackgroundPage").css("background-color",thisClass.page.backgroundColor);if(mf_main.REVISION){}}}else{if(mf_main.RENDER&&!mf_main.REVISION){$("#mfEditorHolder").css("background",thisClass.gridController.backgroundColor);$("#mfMainEditorUI").css("background-color",thisClass.gridController.backgroundColor);$("#mainBody").css("background-color",thisClass.gridController.backgroundColor);}if(thisClass.gridController.backgroundColor=="transparent"){if(mf_main.RENDER&&!mf_main.REVISION){$("#mfBackgroundPage").css("background","transparent");$("#mfBackgroundPage").css("background-color","transparent");}else{$("#mfBackgroundPage").css("background-image",'url("images/editor/transparent-BG.png")');$("#mfBackgroundPage").css("background-repeat","repeat");if(mf_main.REVISION){}}}else{$("#mfBackgroundPage").css("background-color",thisClass.gridController.backgroundColor);if(mf_main.REVISION){}}}for(var k=0;k<MF_PagePool.getPages().size();k++){var pitem=MF_PagePool.getPages().getItemAt(k);var pagePresentLoaded=false;for(var j=0;j<thisClass.loadedPages.length;j++){var pitemLoaded=thisClass.loadedPages[j];if(pitemLoaded.eid==pitem.eid){pagePresentLoaded=true;break;}}if(!pagePresentLoaded&&pitem.loaded){$("#mfPage"+pitem.eid).hide();}}thisClass.commentController.getCommentsByPage(thisClass.page.eid);thisClass.addSelectorResizePerPage();if(thisClass.VIEWER){thisClass.showCalloutTooltips();thisClass.hideHotSpots();$(".mfNoteArrowCls").hide();}else{thisClass.hideCalloutTooltips();thisClass.showHotSpots();thisClass.setMasterPage();thisClass.setNavHide();if(!mf_main.PUBLIC){thisClass.page.showRTCMsg();}$(".mfNoteArrowCls").show();}thisClass.getAllImages();if(thisClass.VIEWER){$(".mfWFCompCls").css("pointer-events","none");$(".mfWFTxtCls").css("pointer-events","none");$(".mfWFNoteCls").css("pointer-events","none");}else{$(".mfWFCompCls").css("pointer-events","none");$(".mfWFTxtCls").css("pointer-events","auto");$(".mfWFNoteCls").css("pointer-events","auto");}thisClass.toggleLinks();thisClass.toggleAnnotations();thisClass.checkLoaded();if(thisClass.grid){thisClass.grid.setGrid();}thisClass.preFetchPages();thisClass.formAddressHash();if(thisClass.powerupController){thisClass.powerupController.reInitPowerups("pagechange");}thisClass.startIntersectionObserver();if(mf_main.PUBLIC||thisClass.projectObj.readonly||mf_main.RENDER){}else{mf_main.editorController.fontController.loadGoogleFontStyles();}if(mf_main.REVISION&&mf_main.revisionID!="trash"){$(".mfCompareRevisionsBtn").show();}if(mf_main.MEETINGMODE==true){mf_main.MEETINGMODE=false;$("#mfViewerNavVideoChatBtn").click();$("#mfOpenVideoChatBtn").click();}if(mf_main.isPowerupOpen){var pid=mf_main.poweruprefId;mf_main.editorController.powerupController.openSpacePowerupHandler(pid);}if(thisClass.powerupCallbackOptions&&thisClass.powerupCallbackOptions.isEnableSelectMode){if(thisClass.powerupCallbackOptions.type=="getcomponentimage"){thisClass.enableSelectMode("powerup-compImageMode");}else{thisClass.enableSelectMode("powerup-specsmode");}}};this.stopIntersectionObserver=function(entries){try{if(thisClass.VISIBLE_OBSERVE&&thisClass.iobserver){thisClass.iobserver.disconnect();thisClass.iobserver=null;}}catch(e){}};this.startIntersectionObserver=function(entries){try{thisClass.stopIntersectionObserver();if(thisClass.VISIBLE_OBSERVE){var comps=null;var ccount=0;var qstring="";for(var k=thisClass.loadedPages.length-1;k>=0;k--){var loadedPage=thisClass.loadedPages[k];if(ccount==0){qstring=" #mfPage"+loadedPage.eid+" .mfWFCompCls "+qstring;}else{qstring=qstring+", #mfPage"+loadedPage.eid+" .mfWFCompCls ";}ccount++;}comps=document.querySelectorAll(qstring);const config={threshold:0,root:document.getElementById("mfEditorHolder"),rootMargin:"500px"};if("IntersectionObserver" in window){thisClass.iobserver=new IntersectionObserver(thisClass.onIntersection,config);comps.forEach(function(com){thisClass.iobserver.observe(com);});}}}catch(e){}};this.postAddToPage=function(comid){thisClass.startCompObserve(comid);};this.startCompObserve=function(comid){try{if(thisClass.VISIBLE_OBSERVE){thisClass.hideComponentObserver(comid);if(thisClass.iobserver){var elem=document.getElementById(comid);if(elem){thisClass.iobserver.observe(elem);}}}}catch(e){}};this.stopCompObserve=function(comid){try{if(thisClass.VISIBLE_OBSERVE&&thisClass.iobserver){var elem=document.getElementById(comid);if(elem){thisClass.iobserver.unobserve(elem);}}}catch(e){}};this.onIntersection=function(entries){entries.forEach(function(entry){if(entry.isIntersecting){thisClass.showComponentObserver(entry.target.id);}else{thisClass.hideComponentObserver(entry.target.id);}});};this.showComponentObserver=function(cid){var comp=thisClass.getComponentById(cid);if(comp){if(comp.NAME=="MF_Note"){return;}$("#"+comp.eid).css("visibility","visible");if(comp.selector){$("#"+comp.selector.id).css("visibility","visible");}}};this.hideComponentObserver=function(cid){var comp=thisClass.getComponentById(cid);if(comp){if(comp.NAME=="MF_Note"){return;}$("#"+comp.eid).css("visibility","hidden");if(comp.selector){$("#"+comp.selector.id).css("visibility","hidden");}}};this.finishLoadPage=function(page){if(thisClass.EDITOR){if(page.eid!=thisClass.currentPageID){$("#mfPage"+page.eid).css("pointer-events","none");}else{$("#mfPage"+page.eid).css("pointer-events","auto");}}else{$("#mfPage"+page.eid).css("pointer-events","none");}$("#mfPage"+page.eid).show();page.loaded=true;page.calculateDimensions();thisClass.viewMasterPage(page);if(mf_main.PUBLIC&&!mf_main.editorController.powerupController.publicPowerupProcessInitialised&&mf_main.editorController.powerupController.publicURLPowerupId!=""){mf_main.editorController.powerupController.getPublicPowerupDetails();}};this.changeBackgroundColor=function(){for(var k=thisClass.loadedPages.length-1;k>=0;k--){var loadedPage=thisClass.loadedPages[k];if(thisClass.page==loadedPage){if(thisClass.EDITOR){if(thisClass.page.overrideBackground){if(thisClass.page.backgroundColor=="transparent"){$("#mfPage"+loadedPage.eid).css("background-color","transparent");}else{$("#mfPage"+loadedPage.eid).css("background-color",MF_ComponentUtils.hexToRGB(thisClass.page.backgroundColor,0.7));}}else{if(thisClass.gridController.backgroundColor=="transparent"){$("#mfPage"+loadedPage.eid).css("background-color","transparent");}else{$("#mfPage"+loadedPage.eid).css("background-color",MF_ComponentUtils.hexToRGB(thisClass.gridController.backgroundColor,0.7));}}}}else{if(mf_main.REVISION){$("#mfPage"+loadedPage.eid).css("background-color",MF_ComponentUtils.hexToRGB(thisClass.gridController.backgroundColor,0.7));}else{$("#mfPage"+loadedPage.eid).css("background-color","rgba(255,255,255,0)");}}}$("#mfBackgroundPage").css("background-image","");$("#mfBackgroundPage").css("background-repeat","");if(thisClass.page.overrideBackground){if(thisClass.page.backgroundColor=="transparent"){$("#mfBackgroundPage").css("background-image",'url("images/editor/transparent-BG.png")');$("#mfBackgroundPage").css("background-repeat","repeat");}else{$("#mfBackgroundPage").css("background-color",thisClass.page.backgroundColor);}}else{if(thisClass.gridController.backgroundColor=="transparent"){$("#mfBackgroundPage").css("background-image",'url("images/editor/transparent-BG.png")');$("#mfBackgroundPage").css("background-repeat","repeat");}else{$("#mfBackgroundPage").css("background-color",thisClass.gridController.backgroundColor);}}thisClass.gridController.changedBackgroundColor=true;};this.getAllImages=function(){thisClass.renderImages=new Array();for(var k=0;k<thisClass.loadedPages.length;k++){var page=thisClass.loadedPages[k];for(var i=0;i<page.childComponents.size();i++){var component=page.childComponents.getItemAt(i);if(component&&component.NAME=="MF_ImageComp"&&component.imageID!=""){thisClass.renderImages.push(component);}if(component&&component.NAME=="MF_SVGIcon"&&component.SVGUrl!=""){thisClass.renderImages.push(component);}if(component&&component.NAME=="MF_Illustration"&&component.SVGUrl!=""){thisClass.renderImages.push(component);}}}thisClass.renderImageAssigned=true;thisClass.checkLoaded();};this.loadPageData=function(page){try{$(page.pagedata.data).find("mffontcollection mffont").each(function(){thisClass.fontController.addCustomFontItems($(this));});var jData=page.e2xml.settingsXML;var autoVal=jData.attr("autoResize");if(autoVal=="false"){page.autoResize=false;}else{page.autoResize=true;}var overrideVal=jData.attr("overrideSize");if(overrideVal=="true"){page.overrideSize=true;}else{page.overrideSize=false;}if(jData.attr("sizeType")){page.sizeType=jData.attr("sizeType");}if(jData.attr("w")){page.origWidth=parseInt(jData.attr("w"));}if(jData.attr("h")){page.origHeight=parseInt(jData.attr("h"));}var overrideBgVal=jData.attr("overrideBackground");if(overrideBgVal=="true"){page.overrideBackground=true;}else{page.overrideBackground=false;}if(jData.attr("backgroundColor")){page.backgroundColor=jData.attr("backgroundColor");}}catch(e){}var settingsData=page.e2xml.settingsXML;$(settingsData).find("children").each(function(){var jData=$("<div/>").append($(this).clone());jData.find("component").each(function(){thisClass.getComponent($(this),page);});});page.groupManager.loadGroups(settingsData);page.groupManager.addAll();for(var i=0;i<page.childComponents.data.length;i++){var comp=page.childComponents.data[i];thisClass.addFont(comp);}thisClass.fontController.loadAllFonts(page.eid);page.groupManager.loadLockedGroups(settingsData);page.groupManager.loadLinkedGroups(settingsData);thisClass.finishLoadPage(page);};this.reRenderCanvasFonts=function(pageid){var fontPage=thisClass.page;if(pageid!=null){fontPage=MF_PagePool.getPage(pageid);}var canvasFont=false;for(var i=0;i<fontPage.childComponents.data.length;i++){var comp=fontPage.childComponents.data[i];if(comp.CANVASFONT){canvasFont=true;comp.render(true,fontPage);}}if(canvasFont){thisClass.reStackComponents(fontPage);}};this.addFont=function(comp){if(comp&&comp.USEFONT&&comp.fontType!=""&&comp.fontType!=null){if(comp.isGoogleFontUsed){thisClass.fontController.addGoogleFontToArray(comp.fontType);}if(comp.fontType=="sourcesanspro"||comp.fontType=="SourceSans Pro"||comp.fontType=="Source Sans Pro"){thisClass.fontController.usedFonts.sourcesanspro={fontFamily:"Source Sans Pro",isGoogleFont:false};}else{thisClass.fontController.usedFonts[comp.fontType]={fontFamily:comp.fontType,isGoogleFont:comp.isGoogleFontUsed};}}};this.loadPageCompLib=function(page,cdata){page.createPageData();page.loaded=true;page.pagedata.data=cdata;page.pagedata.data=page.pagedata.data.replace('<library version="1.0">','<component  type="Page" eid="'+page.eid+'" w="100" h="100" overrideBackground="true" backgroundColor="transparent" autoresize="true" folder="false" navhide="false" masterpage=""><settings></settings><children>');page.pagedata.data=page.pagedata.data.replace("</library>","</children></component>");var jData=$(page.pagedata.data);page.e2xml.settingsXML=jData;thisClass.loadComponentSrc(page);};this.loadPage=function(page){if(!page.loaded){mf_main.editorController.page=page;if(page.duplicated){page.duplicated=false;thisClass.loadComponentSrc(page);}else{if(page.noDBLoad){page.noDBLoad=false;thisClass.loadComponentSrc(page);}else{if(mf_main.COMPSHOT&&mf_main.compID!=null){if(mf_main.COMPEXPORT){MF_PackManager.loadComponentSelection(mf_main.compID,{callback:function(compdata){if(compdata){thisClass.loadPageCompLib(page,compdata);}}});}else{MF_PackManager.loadComponentByID(mf_main.compID,{callback:function(dbComponent){if(dbComponent){thisClass.loadPageCompLib(page,dbComponent.data);}}});}}else{MF_ProjectManager.getPageData(MF_UserSession.getUser(),thisClass.projectObj.id,thisClass.projectObj.company,page.eid,mf_main.PUBLIC,mf_main.revisionID,{callback:function(pagedataObj){if(pagedataObj&&(pagedataObj.eid!=page.eid)){return;}if(pagedataObj==null){page.createPageData();}else{var pagedata=new MF_PageData();pagedata.cast(pagedataObj);page.pagedata=pagedata;}page.loaded=true;var jData=$(page.pagedata.data);page.e2xml.settingsXML=jData;thisClass.loadComponentSrc(page);}});}}}}else{thisClass.finishLoadPage(page);}};this.loadComponentSrc=function(page){var componentPresent=new Object();page.e2xml.settingsXML.find("component").each(function(){var ctype=$(this).attr("type");if(mf_main.componentList.loadedComponentCode[ctype]){}else{componentPresent[ctype]=true;}});var componentsToBeLoaded=new Array();for(var key in componentPresent){componentsToBeLoaded.push(key);}mf_main.componentList.invokeComponentsSrc(componentsToBeLoaded,page);};this.initComponent=function(componentXML,page){var component=mf_main.componentList.invokeComponent(componentXML.attr("type"));if(component!=null){var lid=componentXML.attr("lid");if(lid==null||lid==""){}else{component.lid=componentXML.attr("lid");}component.eid="cmp"+thisClass.guidGenerator();if(component.TRANSFORM){component.startX=parseFloat(componentXML.attr("startX"));component.startY=parseFloat(componentXML.attr("startY"));component.endX=parseFloat(componentXML.attr("endX"));component.endY=parseFloat(componentXML.attr("endY"));}else{component.x=parseFloat(componentXML.attr("x"));component.y=parseFloat(componentXML.attr("y"));if(!component.AUTOSIZE){component.width=parseFloat(componentXML.attr("w"));component.height=parseFloat(componentXML.attr("h"));}}if(component.NAME=="MF_AdvancedDataGrid"){component.updateAdvancedGridDataId(componentXML);}component.e2xml.settingsXML=componentXML;return component;}return null;};this.getComponent=function(componentXML,page){var component=thisClass.initComponent(componentXML,page);if(component){thisClass.addComponent(component,page,true);}};this.addComponent=function(component,page,undo,groupadd){if(undo==null){undo=false;}if(groupadd==null){groupadd=true;}page.addComponent(component);var groupID=String(component.e2xml.settingsXML.attr("groupID"));if(groupID==undefined||groupID=="undefined"||groupID==null){groupID="";}if(groupID==""&&thisClass.currentGroupEdit){groupID=thisClass.currentGroupEdit;}if(groupID!=""){component.GROUPID=groupID;if(groupadd==true){page.groupManager.addGroup(groupID,component);}}component.e2xml.applySettings();component.render();var newselector=null;if(undo){newselector=thisClass.addSelector(component,null,true);}else{newselector=thisClass.addSelector(component);}return newselector;};this.reStackComponents=function(page,nolayer){var mfpage=thisClass.page;if(page!=null){mfpage=page;}if(mfpage){var count=1;var groupSelects=new Object();mfpage.stackOrder=new ArrayCollection();for(var k=0;k<mfpage.childComponents.size();k++){var obj=mfpage.childComponents.getItemAt(k);if(obj){mfpage.stackOrder.addItem(obj);if(obj.selector){count++;mfpage.stackOrder.addItem(obj.selector);}count++;if(obj.GROUPID!=""&&obj.GROUPID!=null){groupSelects[obj.GROUPID]=count;}}}for(var gid in mfpage.groupManager.groups){var grp=mfpage.groupManager.groups[gid];if(grp&&grp.parent==""){mfpage.groupManager.setStackPos(gid,groupSelects);}}var zcount=1;for(var k=0;k<mfpage.stackOrder.size();k++){var obj=mfpage.stackOrder.getItemAt(k);if(obj){if(obj instanceof MF_Selector){$("#"+obj.id).css("z-index",zcount);obj.zindex=zcount;}else{$("#"+obj.eid).css("z-index",zcount);}zcount++;}}if(nolayer){}else{thisClass.layersController.listLayers();}}};this.unLockSelectorEvents=function(selector){thisClass.lockSelectorEvents(selector);thisClass.selectorEvents(selector);};this.lockSelectorEvents=function(selector){$("#"+selector.id).off("mousedown");$("#"+selector.id).off("dblclick");$("#"+selector.id).off("dragstart");$("#"+selector.id).off("drag");$("#"+selector.id).off("dragend");};this.makeAllCompsInActive=function(gid){for(var i=0;i<thisClass.page.childComponents.data.length;i++){var comp=thisClass.page.childComponents.data[i];if(comp.GROUPID!=gid){if(comp.selector){var makeInactive=true;if(gid=="setcompmode"){if(thisClass.currentGroupEdit!=null){if(comp.GROUPID!=thisClass.currentGroupEdit){makeInactive=false;}}}if(makeInactive){thisClass.setCompInActive(comp.selector);}}}}for(var k in thisClass.page.groupManager.groupSelectors){var gselector=thisClass.page.groupManager.groupSelectors[k];if(gselector&&gselector.GROUPID!=gid&&!thisClass.page.groupManager.isChildGroup(gid,gselector.GROUPID)){var makeInactive=true;if(gid=="setcompmode"){if(thisClass.currentGroupEdit!=null){makeInactive=false;}}if(makeInactive){thisClass.setCompInActive(gselector);}}}};this.setCompActive=function(gselector){gselector.UNEDIT=false;if(!gselector.locked){thisClass.unLockSelectorEvents(gselector);}gselector.setActive();};this.setCompInActive=function(gselector){gselector.UNEDIT=true;if(!gselector.locked){thisClass.lockSelectorEvents(gselector);}gselector.setInActive();};this.makeAllCompsActive=function(gid){for(var i=0;i<thisClass.page.childComponents.data.length;i++){var comp=thisClass.page.childComponents.data[i];if(comp.GROUPID!=gid){if(comp.selector){var makeActive=true;if(gid=="unsetcompmode"){if(thisClass.currentGroupEdit!=null){if(comp.GROUPID!=thisClass.currentGroupEdit){makeActive=false;}}}if(makeActive){thisClass.setCompActive(comp.selector);}}}}for(var k in thisClass.page.groupManager.groupSelectors){var gselector=thisClass.page.groupManager.groupSelectors[k];if(gselector&&gselector.GROUPID!=gid&&!thisClass.page.groupManager.isChildGroup(gid,gselector.GROUPID)){var makeActive=true;if(gid=="unsetcompmode"){if(thisClass.currentGroupEdit!=null){makeActive=false;}}if(makeActive){thisClass.setCompActive(gselector);}}}};this.performGroupEditing=function(gid){if(thisClass.compMode||!thisClass.EDITOR){return false;}thisClass.closeGroupEditing();thisClass.clearSelection(true,true);thisClass.currentGroupEdit=gid;thisClass.page.groupManager.enableParentGroups(gid);thisClass.removeSelectorResize();thisClass.makeAllCompsInActive(gid);thisClass.openGroupNotifier();};this.closeGroupEditing=function(nolayer,norestack){if(thisClass.currentGroupEdit==null){return;}try{thisClass.page.groupManager.disableParentGroups(thisClass.currentGroupEdit);thisClass.makeAllCompsActive(thisClass.currentGroupEdit);thisClass.page.groupManager.resetParentSelectorGroups(thisClass.currentGroupEdit);thisClass.closeGroupNotifier();thisClass.shiftPressed=false;thisClass.clearSelection(nolayer,norestack);thisClass.currentGroupEdit=null;}catch(e){}};this.closeGroupNotifier=function(){$("#mfGroupEditingNotifier").css("display","none");thisClass.toggleVisibleTopBar();};this.openGroupNotifier=function(){$("#mfGroupEditingNotifier").css("display","block");thisClass.toggleVisibleTopBar();};this.selectorEvents=function(selector){$("#"+selector.id).mousedown(function(event){event.stopPropagation();if(thisClass.RENDER||thisClass.VIEWER){return;}if(thisClass.compMode){return;}if(event.which==3){return;}$(".mfcustom-menu").hide();if(!thisClass.lastTextEditComp&&thisClass.EDITOR){thisClass.shortcutsFlag=true;}thisClass.stopEditingText();thisClass.selectedComponent=null;thisClass.isDrag=false;thisClass.movedObject=false;var sid=$(this).attr("id");var selector=thisClass.page.getSelector(sid);if(selector!=null&&selector.UNEDIT){return;}if(selector==null){selector=thisClass.page.groupManager.groupSelectors[$(this).attr("group-id")];}var detected=false;if(selector){detected=thisClass.selectComponentByUser(event,selector);}if(!detected){if(selector!=null&&selector.UNEDIT){return;}if(selector!=null&&selector.component){var posObject=new Object();posObject.x=selector.component.x;posObject.y=selector.component.y;selector.component.prevEcoordinates=posObject;var szObject=new Object();szObject.width=selector.component.width;szObject.height=selector.component.height;selector.component.prevEsize=szObject;}if(selector==null&&thisClass.globalselect){selector=thisClass.globalselect;}if(selector==null){selector=thisClass.page.groupManager.groupSelectors[$(this).attr("group-id")];}if(thisClass.currentGroupEdit!=null&&selector){var check_gid=selector.GROUPID;if(selector.component){check_gid=selector.component.GROUPID;}if(check_gid!=thisClass.currentGroupEdit&&!thisClass.page.groupManager.isChildGroup(thisClass.currentGroupEdit,check_gid)){if(selector!=thisClass.globalselect){thisClass.closeGroupEditing();}}}if((!thisClass.isShift&&!thisClass.isCtrl)&&selector!=thisClass.globalselect){var clearsel=true;if(thisClass.lastSetting&&thisClass.lastSetting.selector){if(selector==thisClass.lastSetting.selector){clearsel=false;}}if(clearsel&&!thisClass.SELECTMODE){thisClass.clearSelection(true);}}if(thisClass.globalselect!=selector){if((thisClass.isShift||thisClass.isCtrl)&&thisClass.globalselect){var found=false;for(var m=0;m<thisClass.componentSelect.length;m++){if(thisClass.componentSelect[m]==selector){found=true;break;}}if(found){var index=thisClass.componentSelect.indexOf(selector);if(index>-1){thisClass.componentSelect.splice(index,1);}}else{mf_main.editorController.addComponentSelect(selector);}}else{mf_main.editorController.addComponentSelect(selector);}}if(thisClass.selectorResize){if(thisClass.selectorResize.selector!=selector){if(selector.component&&selector.component.TRANSFORM){thisClass.addSelectorTransform(selector);}else{thisClass.addSelectorResize(selector);}}$("#"+thisClass.selectorResize.id).show();thisClass.openSetting(selector);}if(thisClass.isShift||thisClass.isCtrl){thisClass.performGlobalSelection();}}else{event.stopImmediatePropagation();}});$("#"+selector.id).on("dblclick",function(event){event.stopImmediatePropagation();if(thisClass.RENDER||thisClass.VIEWER){return;}if(thisClass.compMode){return;}var sid=$(this).attr("id");var selector=thisClass.page.getSelector(sid);if(selector==null){selector=thisClass.page.groupManager.groupSelectors[$(this).attr("group-id")];}if(selector!=null&&selector.UNEDIT){return;}if(selector&&selector.component){if(selector.component.EDITABLE){thisClass.lastTextEditComp=selector.component;selector.setVisible(false);thisClass.startEditingText();}}else{if(selector){if(selector.GROUP&&selector.GROUPID!=""){var cont=true;if(thisClass.componentSelect.length==1){var cselect=thisClass.componentSelect[0];if(cselect.component&&cselect.component.eangle!=0){}else{var cvs=document.getElementById(selector.id);var pt=MF_Utils.globalToLocalPoint(event,selector.id);var fx=(pt.x/thisClass.SCALE)+cvs.offsetLeft;var fy=(pt.y/thisClass.SCALE)+cvs.offsetTop;if((fx>cselect.x)&&(fx<(cselect.x+cselect.width))){if((fy>cselect.y)&&(fy<(cselect.y+cselect.height))){if(cselect.GROUP&&cselect.GROUPID!=""){cont=false;thisClass.performGroupEditing(cselect.GROUPID);}else{if(cselect.component&&cselect.component.NAME!="MF_Text"&&cselect.component.EDITABLE){cont=false;thisClass.lastTextEditComp=cselect.component;cselect.setVisible(false);thisClass.startEditingText();}}}}}}if(cont){thisClass.performGroupEditing(selector.GROUPID);}}}}});$("#"+selector.id).on("click",function(event){event.stopImmediatePropagation();thisClass.stopEditingText();if(thisClass.RENDER||thisClass.VIEWER){if($(this).attr("group-id")==""){var sid=$(this).attr("id");var selector=thisClass.page.getSelector(sid);if(selector.component&&selector.component.SHOW_SELECTOR_ONPREVIEW&&!thisClass.SPECMODE){thisClass.openCompLink(selector.component);}}else{thisClass.openLink(event,$(this).attr("group-id"));}return;}if(thisClass.compMode){return;}var sid=$(this).attr("id");var selector=thisClass.page.getSelector(sid);if(selector==null){selector=thisClass.page.groupManager.groupSelectors[$(this).attr("group-id")];}if(selector!=null&&selector.UNEDIT){return;}$("#mfclipboard").focus();$("#mfclipboard").blur();if(selector&&selector.locked&&thisClass.selectedComponent==null){thisClass.openSetting(selector);}});$("#"+selector.id).drag("start",function(ev,dd){if(thisClass.RENDER||thisClass.VIEWER){return;}if(thisClass.compMode){return;}if(thisClass.isShift||thisClass.isCtrl){return;}thisClass.removeSelectorTransform();var selector=thisClass.page.getSelector($(this).attr("id"));if(selector==null&&thisClass.globalselect){selector=thisClass.globalselect;}if(selector==null){selector=thisClass.page.groupManager.groupSelectors[$(this).attr("group-id")];}if(selector!=null&&selector.UNEDIT){return;}thisClass.dragSelector=selector;if(!selector.locked){dd.attr=$(dd.target).prop("className");dd.width=$(this).width();dd.height=$(this).height();thisClass.offsetYPos=($("#mfContainerPage").position().top)/thisClass.SCALE;thisClass.offsetXPos=($("#mfContainerPage").position().left)/thisClass.SCALE;var newx=selector.x-($("#"+selector.id).position().left/thisClass.SCALE);var newy=selector.y-($("#"+selector.id).position().top/thisClass.SCALE);thisClass.offsetXPos=thisClass.offsetXPos-newx;thisClass.offsetYPos=thisClass.offsetYPos-newy;thisClass.beforeMoveX=selector.x;thisClass.beforeMoveY=selector.y;thisClass.startDDoffsetX=dd.offsetX;thisClass.startDDoffsetY=dd.offsetY;}else{return false;}});$("#"+selector.id).drag(function(ev,dd){if(thisClass.RENDER||thisClass.VIEWER){return;}if(thisClass.compMode){return;}if(thisClass.isShift||thisClass.isCtrl){return;}var props={};var unintendedDrag=false;var selector=thisClass.dragSelector;if(selector!=null&&selector.UNEDIT){return;}if(dd&&dd.attr&&dd.attr.indexOf("sdrag")>-1){if(thisClass.startDDoffsetX==dd.offsetX&&thisClass.startDDoffsetY==dd.offsetY){unintendedDrag=true;return;}if(thisClass.gridController.snapToGrid){var snapval=thisClass.gridController.snapPos*thisClass.SCALE;dd.offsetY=Math.round(dd.offsetY/snapval)*snapval;dd.offsetX=Math.round(dd.offsetX/snapval)*snapval;}else{dd.offsetY=Math.round(dd.offsetY/1)*1;dd.offsetX=Math.round(dd.offsetX/1)*1;}mf_main.editorController.disableShortcuts();props.top=dd.offsetY/thisClass.SCALE;props.left=dd.offsetX/thisClass.SCALE;props.left=props.left-thisClass.offsetXPos;props.top=props.top-thisClass.offsetYPos;props.left=props.left+1;props.top=props.top;thisClass.selectorResize.x=props.left;thisClass.selectorResize.y=props.top;selector.x=props.left/thisClass.SCALE;selector.y=props.top/thisClass.SCALE;thisClass.selectorResize.render(false);$("#"+thisClass.selectorResize.id).hide();if(thisClass.selectorResize.selector&&thisClass.selectorResize.selector.GLOBAL_SELECT==false){var comp=thisClass.selectorResize.selector.component;if(comp.TRANSFORM){$("#"+comp.eid).css("left",props.left+thisClass.selectorResize.selector.delta);$("#"+comp.eid).css("top",props.top+thisClass.selectorResize.selector.delta);comp.x=props.left+thisClass.selectorResize.selector.delta;comp.y=props.top+thisClass.selectorResize.selector.delta;}else{var cx=props.left+selector.delta;var cy=props.top+selector.delta;$("#"+comp.eid).css("left",props.left-comp.delta);$("#"+comp.eid).css("top",props.top-comp.delta);}}selector.setBalpha(0);if(thisClass.currentGroupEdit!=null){var nselx=selector.x;var nsely=selector.y;selector.x=nselx*thisClass.SCALE;selector.y=nsely*thisClass.SCALE;mf_main.editorController.page.groupManager.resetSelector(mf_main.editorController.currentGroupEdit);selector.x=nselx;selector.y=nsely;}if(thisClass.lastSetting){thisClass.lastSetting.updateTransform();}thisClass.globalSelectorMoveOnDrag(thisClass.selectorResize.selector);thisClass.setGuidelines(selector);}if(unintendedDrag==false){$(this).css(props);}});$("#"+selector.id).drag("end",function(ev,dd){ev.stopImmediatePropagation();if(thisClass.RENDER||thisClass.VIEWER){return;}if(thisClass.compMode){return;}if(dd&&thisClass.startDDoffsetX==dd.offsetX&&thisClass.startDDoffsetY==dd.offsetY){return;}thisClass.checkUnIntendedMove();thisClass.selectorResize.x=Math.round(thisClass.selectorResize.x);thisClass.selectorResize.y=Math.round(thisClass.selectorResize.y);thisClass.selectorResize.render(false);if(thisClass.selectorResize){$("#"+thisClass.selectorResize.id).show();}mf_main.editorController.enableShortcuts();thisClass.dragFinishOperation();if(thisClass.selectorResize.selector&&thisClass.selectorResize.selector.component){if(thisClass.selectorResize.selector.component.TRANSFORM){thisClass.addSelectorTransform(thisClass.selectorResize.selector);}}});};this.displaySizeRestiction=function(){MF_Utils.display_ActionIndicator("Basic plan restricts canvas size to "+thisClass.RESTRICT_SIZE_LIMIT+"px. For unlimited size, upgrade!",5000,450);};this.checkUnIntendedMove=function(){return;if(thisClass.selectorResize.x>thisClass.beforeMoveX){var diffv=thisClass.selectorResize.x-thisClass.beforeMoveX;if(diffv<5){thisClass.selectorResize.x=thisClass.beforeMoveX;}}if(thisClass.selectorResize.x<thisClass.beforeMoveX){var diffv=thisClass.beforeMoveX-thisClass.selectorResize.x;if(diffv<5){thisClass.selectorResize.x=thisClass.beforeMoveX;}}if(thisClass.selectorResize.y>thisClass.beforeMoveY){var diffv=thisClass.selectorResize.y-thisClass.beforeMoveY;if(diffv<5){thisClass.selectorResize.y=thisClass.beforeMoveY;}}if(thisClass.selectorResize.y<thisClass.beforeMoveY){var diffv=thisClass.beforeMoveY-thisClass.selectorResize.y;if(diffv<5){thisClass.selectorResize.y=thisClass.beforeMoveY;}}};this.dragFinishOperation=function(resize){if(resize==null){resize=false;}var selector=thisClass.selectorResize.selector;if(thisClass.RESTRICT_SIZE){if((thisClass.selectorResize.x+thisClass.selectorResize.width)>(mf_main.editorController.RESTRICT_SIZE_LIMIT)||(thisClass.selectorResize.y+thisClass.selectorResize.height)>(mf_main.editorController.RESTRICT_SIZE_LIMIT)){thisClass.displaySizeRestiction();}}mf_main.editorController.enableShortcuts();if(selector&&selector.GLOBAL_SELECT){selector.x=Math.round(thisClass.selectorResize.x);selector.y=Math.round(thisClass.selectorResize.y);selector.width=Math.round(thisClass.selectorResize.width);selector.height=Math.round(thisClass.selectorResize.height);selector.render(false);$("#"+selector.id).css("left",selector.x);$("#"+selector.id).css("top",selector.y);if(resize){selector.x=Math.round(thisClass.selectorResize.x);selector.y=Math.round(thisClass.selectorResize.y);selector.setSize();if(selector.GROUP){mf_main.editorController.page.groupManager.resetChildSelectorGroups(selector.GROUPID);thisClass.addSelectorResize(selector);}else{thisClass.calculateGlobalSelection(true);}}else{thisClass.globalSelectorMove(selector);}}else{if(selector){selector.x=Math.round(thisClass.selectorResize.x);selector.y=Math.round(thisClass.selectorResize.y);selector.width=Math.round(thisClass.selectorResize.width);selector.height=Math.round(thisClass.selectorResize.height);selector.render(false);$("#"+selector.id).css("left",selector.x);$("#"+selector.id).css("top",selector.y);if(selector.component){var comp=selector.component;if(comp.TRANSFORM){$("#"+comp.eid).css("left",Math.round(selector.x+selector.delta));$("#"+comp.eid).css("top",Math.round(selector.y+selector.delta));}if(resize){selector.x=thisClass.selectorResize.x+5;selector.y=thisClass.selectorResize.y+5;selector.setSize();}else{selector.setCoordinate();}}}}thisClass.resizePage();if(thisClass.currentGroupEdit!=null){thisClass.page.groupManager.resetParentSelectorGroups(thisClass.currentGroupEdit);}};this.showPopUp=function(e,popup){var lastOpenedPopUp=thisClass.lastOpenedMfPopUp;if(lastOpenedPopUp){if(lastOpenedPopUp.attr("id")!=$(popup).attr("id")){$(lastOpenedPopUp).hide();}}mf_main.editorController.disableShortcuts();var x=0;if(e&&!isNaN(e.clientX)){x=e.clientX,y=e.clientY;}width=$(popup).width();var positionX=330+100;var positionY=10;if(e&&!isNaN(e.clientX)){positionY=(e.clientY-e.offsetY-$(popup).height())+170;}if((positionY+$(popup).height())>$(currentWindow).height()){positionY=$(currentWindow).height()-$(popup).height()-50;}if(positionY<0){positionY=10;}if((positionY+$(popup).height())>$(currentWindow).height()){positionY=$(currentWindow).height()-$(popup).height()-10;}$(popup).css({top:positionY,left:positionX});$(popup).animate({left:330+"px"},300,"easeOutBack");popup.toggle();thisClass.lastOpenedMfPopUp=$(popup);if(popup.attr("id")=="mfIconSelectionPopUp"){$("#mfIconListSearchBox").focus();}if(popup.attr("id")=="mfSvgIconSelectionPopUp"){$("#mfSvgIconListSearchBox").focus();}if(popup.attr("id")=="mfSvgIllustrationSelectionPopUp"){$("#mfSvgIllustrationListSearchBox").focus();}if(popup.attr("id")=="mfLinkSelectionPopUp"){$("#mfPageLinkSearchBox").val("");$("#mfPageLinkSearchBox").focus();}if(popup.attr("id")=="mfMasterPageSelectionPopup"){$("#mfMasterPageSearchBox").val("");$("#mfMasterPageSearchBox").focus();}if(popup.attr("id")=="mfFontSelectionPopUp"&&!thisClass.fontController.customFontListLoaded){thisClass.fontController.getCustomFontsList(null);}};this.getComponentById=function(compId){var componentMatched=null;for(var k=0;k<thisClass.loadedPages.length;k++){var page=thisClass.loadedPages[k];var sel=page.childDictionary[compId];if(sel){return sel;}}return componentMatched;};this.getSelectorById=function(selid){var sel=null;for(var k=0;k<thisClass.loadedPages.length;k++){var page=thisClass.loadedPages[k];sel=page.getSelector(selid);if(sel){return sel;}}return sel;};this.getComponentByLid=function(compId){var componentMatched=null;for(var k=0;k<thisClass.loadedPages.length;k++){var page=thisClass.loadedPages[k];for(var i=0;i<page.childComponents.data.length;i++){var component=page.childComponents.data[i];if(component.lid==compId){componentMatched=component;return componentMatched;}}}return componentMatched;};this.getGroupById=function(gid){var componentMatched=null;for(var k=0;k<thisClass.loadedPages.length;k++){var page=thisClass.loadedPages[k];var linkObj=page.groupManager.linkedGroups[gid];if(linkObj){componentMatched=linkObj;return componentMatched;}}return componentMatched;};this.openVideoChatMode=function(){if(!mf_main.PUBLIC){if(!$("#mfViewerNavVideoChatBtn").hasClass("mfVideoChatActive")){$("#mfNavBarContent").css("height",$(window).height()-$("#mfEditorHeader").height()-thisClass.videoChatInterfaceHeight);$("#mfNavBar").css("height",$(window).height()-thisClass.videoChatInterfaceHeight);$("#mfEditorHolder,  #mfPageManagerArea").css("height",$(window).height()-120-thisClass.editorHolderPadding);$("#mfVideoChatInterface,#mfVideoChatLoader").show();$(this).addClass("mfVideoChatActive mfVideoChatActionDenied");if(thisClass.videoChatController==null){var loadFiles=[];if(MF_Global.getS3Bucket()!="testmfassets"){loadFiles=["modules/videochat/js/mf_videochat-min.js"];}else{loadFiles.push("modules/videochat/js/internal/videochat.js");loadFiles.push("modules/videochat/js/internal/videochatRtc.js");}loadFiles.push("modules/videochat/js/external/RTCMultiConnection.min.js");$("<link>").appendTo("head").attr({type:"text/css",rel:"stylesheet"}).attr("href","modules/videochat/css/internal/videochat.css");MF_Utils.loadsScripts(loadFiles).then(function(){$.get("modules/videochat/videochat.html",function(templates){$("#mfVideoChatInterface").html(templates);thisClass.videoChatController=new MF_VideoChatController();thisClass.videoChatController.constructor();thisClass.videoChatController.openVideoChatHandler();});});}else{thisClass.videoChatController.openVideoChatHandler();}mf_main.interfaceResize();}else{thisClass.closeVideoChatMode();}}};this.getInitialPlacement=function(){var obj=new Object();obj.x=100;obj.y=100;if(mf_main.editorController.page.sizeType!="sizeless"){if(obj.x>mf_main.editorController.page.width){obj.x=mf_main.editorController.page.width/2;}if(obj.y>mf_main.editorController.page.height){obj.y=mf_main.editorController.page.height/2;}return obj;}else{return obj;}};this.closeVideoChatMode=function(){mf_main.editorController.videoChatController.closeVideoChat();mf_main.interfaceResize();};this.powerupCallPageReset=function(){thisClass.pageController.selectPage("mfPageItem"+thisClass.powerupCallbackOptions.currentPageId);thisClass.powerupCallbackOptions=null;thisClass.viewPage(thisClass.pageController.selectedPage);};}function MF_ContentEditorController(){var thisClass=this;this.previewDOM={};this.originalPageContent="";this.editorTargetElement=null;this.hasUnsavedChanges=false;this.diableHighlighter=false;this.assetEvent=false;this.fillType="solid";this.selectedBackgroundImage=null;this.checkForBackgroundImage=true;this.selectedComponent=null;this.injectCode='<mfstarttagremove contenteditable="false"></mfstarttagremove><div id="mfCEHighlighter" style="display:none;"><style>[contenteditable="true"]{border:none;outline:none;}.mfHighlightSelector {background: #19A9FF;position: absolute;z-index:999999;}</style><div id="mfHighlighterTitle" class="mfHighlightSelector" style="height:0px; color:#FFF; width:100px; text-overflow:ellipsis; overflow:hidden; font-size:12px;"></div><div id="mfSelector-top" class="mfHighlightSelector" style="height:3px;"></div><div id="mfSelector-left" class="mfHighlightSelector" style="width:3px; box-shadow: -3px 0px 5px 0px rgba(200,200,200,1);"></div><div id="mfSelector-right" class="mfHighlightSelector" style="width:3px; box-shadow: 3px 0px 5px 0px rgba(200,200,200,1);"></div><div id="mfSelector-bottom" class="mfHighlightSelector" style="height:3px; box-shadow: 0px 3px 5px 0px rgba(200,200,200,1);"></div></div><mfendtagremove contenteditable="false"></mfendtagremove>';this.editing=false;this.constructor=function(){};this.startContentEditor=function(comp){thisClass.selectedComponent=comp;$("#"+thisClass.selectedComponent.eid).css("pointer-events","auto");thisClass.previewDOM=$("#"+thisClass.selectedComponent.eid).contents().find("body");thisClass.previewDOM.append(thisClass.injectCode);var elements={top:thisClass.previewDOM.find("#mfSelector-top"),left:thisClass.previewDOM.find("#mfSelector-left"),right:thisClass.previewDOM.find("#mfSelector-right"),bottom:thisClass.previewDOM.find("#mfSelector-bottom"),title:thisClass.previewDOM.find("#mfHighlighterTitle")};var mouseEvent=$("#"+thisClass.selectedComponent.eid).contents().mousemove(function(event,optionalTarget){if(typeof optionalTarget!="undefined"){event.target=optionalTarget;if(thisClass.diableHighlighter){thisClass.diableHighlighter=false;}}if(thisClass.diableHighlighter||(typeof event.target.id!="undefined"&&event.target.id.indexOf("mfCEHighlighter")!==-1)||event.target.tagName=="HTML"||$(event.target).hasClass("mfHighlightSelector")){return;}if(thisClass.isTagExcluded(event.target.tagName)){event.target=thisClass.getParentDOM(event.target);}thisClass.previewDOM.find("#mfCEHighlighter").show();thisClass.editing=true;if(event.target.tagName=="IMG"){$("#mfContentEditorInfo").text("Click the image to edit");$("#mfContentEditorInfo").show();}else{$("#mfContentEditorInfo").hide();}var $target=$(event.target);targetOffset=thisClass.getOffsetPosition($target[0]);targetHeight=targetOffset.height,targetWidth=targetOffset.width;elements.top.css({left:(targetOffset.left-4),top:(targetOffset.top-4),width:(targetWidth+5)});elements.bottom.css({top:(targetOffset.top+targetHeight+1),left:(targetOffset.left-3),width:(targetWidth+4)});elements.left.css({left:(targetOffset.left-5),top:(targetOffset.top-4),height:(targetHeight+8)});elements.right.css({left:(targetOffset.left+targetWidth+1),top:(targetOffset.top-4),height:(targetHeight+8)});elements.title.css({left:(targetOffset.left-4),top:(targetOffset.top-24),});if(typeof optionalTarget!="undefined"&&!thisClass.diableHighlighter){thisClass.diableHighlighter=true;}});$("#"+thisClass.selectedComponent.eid).contents().on("click",function(event){thisClass.enableEditor(event);event.preventDefault();});$(thisClass.previewDOM).on("focus",function(){var $this=$(this);$this.data("before",$this.html());return $this;}).on("blur keyup paste",function(){var $this=$(this);if($this.data("before")!==$this.html()){$this.data("before",$this.html());$this.trigger("change");}return $this;});$(thisClass.previewDOM).on("change",function(){thisClass.hasUnsavedChanges=true;});};this.enableEditor=function(event){if(event.target.id.indexOf("selector")!==-1||event.target.tagName==="HTML"){return;}if(thisClass.isTagExcluded(event.target.tagName)){event.target=thisClass.getParentDOM(event.target);}if(thisClass.editorTargetElement==null){thisClass.editorTargetElement=event.target;if(event.target.tagName==="IMG"){thisClass.loadAssets("image");}else{$("#"+thisClass.selectedComponent.eid).contents().trigger("mousemove",thisClass.editorTargetElement);thisClass.diableHighlighter=true;$(thisClass.editorTargetElement).attr("contenteditable","true");$("#mfRichTextToolbar").show();$("#mfContentEditorInfo").hide();var fontSize=$(thisClass.editorTargetElement).css("font-size");if(fontSize!=""&&fontSize!=null){$('#mfRichTextFontSizeDropdown option:contains("'+fontSize+'")').prop("selected",true);}$("#mfContentEditorModal").on("click",function(e){if($(e.target).attr("id")!="mfContentEditorIframe"&&!$(e.target).hasClass("mfCEIgnoreClick")){$(thisClass.editorTargetElement).removeAttr("contenteditable");$("#mfRichTextToolbar").hide();$("#mfContentEditorInfo").show();thisClass.diableHighlighter=false;thisClass.previewDOM.find("#mfCEHighlighter").hide();thisClass.editorTargetElement=null;}});}}else{if(thisClass.editorTargetElement!=event.target){$(thisClass.editorTargetElement).removeAttr("contenteditable");$("#mfRichTextToolbar").hide();$("#mfContentEditorInfo").show();thisClass.diableHighlighter=false;thisClass.editorTargetElement=null;}else{if(thisClass.editorTargetElement==event.target&&event.target.tagName==="IMG"){thisClass.loadAssets("image");}}}thisClass.editing=true;event.preventDefault();};this.stopEditor=function(){try{if(!thisClass.editing){return;}thisClass.editing=false;$("#"+thisClass.selectedComponent.eid).css("pointer-events","none");$(thisClass.editorTargetElement).removeAttr("contenteditable");var htmlContent=$("#"+thisClass.selectedComponent.eid).contents().find("body")[0].innerHTML;htmlContent=htmlContent.replace(thisClass.injectCode,"");var re=/<mfstarttagremove contenteditable="false"><\/mfstarttagremove>.*<mfendtagremove contenteditable="false"><\/mfendtagremove>/i;htmlContent=htmlContent.replace(re,"");try{htmlContent=MF_Utils.sanitizeHTML(htmlContent);htmlContent=MF_Utils.sanitizeHTMLTags(htmlContent);}catch(e){}htmlContent=MF_Utils.htmlEncode(htmlContent);mf_main.editorController.lastTextEditComp.e2xml.addPropSingle("text",htmlContent);mf_main.editorController.lastTextEditComp.render(true);mf_main.editorController.reStackComponents();mf_main.editorController.lastTextEditComp=null;mf_main.editorController.enableShortcuts();if(mf_main.editorController.lastSetting){mf_main.editorController.lastSetting.updateHTMLdata(htmlContent);}}catch(e){}};this.loadAssets=function(assetEvent){thisClass.assetEvent=assetEvent;mf_main.editorController.openNavBarContent("mfNavImagesBtn");mf_main.editorController.imageController.byocMode=true;mf_main.editorController.imageController.component=thisClass.selectedComponent;};this.replaceImage=function(imageObj){var imgSrc="";if(MF_Global.getS3Bucket()=="assets.mockflow.com"){imgSrc="https://assets.mockflow.com/app/wireframepro/company/"+mf_main.editorController.projectObj.company+"/projects/"+mf_main.editorController.projectObj.id+"/images/"+imageObj.id;}else{imgSrc="https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+mf_main.editorController.projectObj.company+"/projects/"+mf_main.editorController.projectObj.id+"/images/"+imageObj.id;}if(thisClass.assetEvent=="image"){$(thisClass.editorTargetElement).attr("src",imgSrc);}else{if(thisClass.assetEvent=="background"){thisClass.checkForBackgroundImage=false;$("#mfCEBackgroundImageModal").modal("show");thisClass.selectedBackgroundImage=imgSrc;$("#mfCEBackgroundImageName").text(newImage.fileid);$("#mfCEBackgroundImageRemove").show();}}$(thisClass.previewDOM).trigger("change");};this.richTextOperator=function(action,value){if(action=="bold"||action=="italic"||action=="underline"){document.getElementById("mfContentEditorIframe").contentWindow.document.execCommand(action,false,null);}else{if(action=="forecolor"){document.getElementById("mfContentEditorIframe").contentWindow.document.execCommand(action,false,value);}else{if(action=="createlink"){if($("#mfCECreateLinkNewTab").is(":checked")){var selectionText=document.getElementById("mfContentEditorIframe").contentWindow.document.getSelection();document.getElementById("mfContentEditorIframe").contentWindow.document.execCommand("insertHTML",false,'<a href="'+value+'" target="_blank">'+selectionText+"</a>");}else{document.getElementById("mfContentEditorIframe").contentWindow.document.execCommand(action,false,value);}}else{switch(action){case"justifyleft":$(thisClass.editorTargetElement).css("text-align","left");break;case"justifycenter":$(thisClass.editorTargetElement).css("text-align","center");break;case"justifyright":$(thisClass.editorTargetElement).css("text-align","right");break;case"justifyfull":$(thisClass.editorTargetElement).css("text-align","justify");break;case"fontsize":$(thisClass.editorTargetElement).css("font-size",value+"px");$("#"+thisClass.selectedComponent.eid).contents().trigger("mousemove",thisClass.editorTargetElement);break;case"textindent":$(thisClass.editorTargetElement).css("text-indent","50px");break;}}}}};this.getOffsetPosition=function(elem){var box=elem.getBoundingClientRect();var body=document.querySelector("#"+thisClass.selectedComponent.eid).contentWindow.document.body;var docElem=document.querySelector("#"+thisClass.selectedComponent.eid).contentWindow.document.documentElement;var scrollTop=window.pageYOffset||docElem.scrollTop||body.scrollTop;var scrollLeft=window.pageXOffset||docElem.scrollLeft||body.scrollLeft;var clientTop=docElem.clientTop||body.clientTop||0;var clientLeft=docElem.clientLeft||body.clientLeft||0;var top=box.top+scrollTop-clientTop;var left=box.left+scrollLeft-clientLeft;return{top:Math.round(top),left:Math.round(left),width:box.width,height:box.height};};this.isTagExcluded=function(tagName){var excludedTags=["B","I","U","FONT"];if($.inArray(tagName,excludedTags)>=0){return true;}else{return false;}};this.changeBackgroundImage=function(){$("#mfCEBackgroundImageModal").modal();setTimeout(function(){$("#mfRichTextBackgroundImage").removeClass("active");},200);};this.backgroundSave=function(){$(thisClass.editorTargetElement).css({background:"","background-color":"","background-image":""});if(thisClass.selectedBackgroundImage!=null){$(thisClass.editorTargetElement).css({"background-image":"url("+thisClass.selectedBackgroundImage+")"});}$("#mfCEBackgroundImageModal").modal("hide");};this.getParentDOM=function(element){var parentDOM=$(element).parent()[0];if(thisClass.isTagExcluded(parentDOM.tagName)&&parentDOM.tagName!="BODY"){return thisClass.getParentDOM(parentDOM);}else{return parentDOM;}};}function MF_PageController(){var thisClass=this;this.selectedPage=null;this.hbox=null;this.wbox=null;this.displayPageThumbnail=true;this.editPage=null;this.treeview=null;this.mastertreeview=null;this.gridChanged=true;this.mapChanged=true;this.workflowChanged=true;this.sitemapController=null;this.lastViewOpened=null;this.siteMapMode="expand";this.trashCollection=new ArrayCollection();this.selectedTrashPage=null;this.isQRCodeJsLoaded=false;this.scrollPos=0;this.constructor=function(){$("#mfSetMasterPageBtn").on("click",thisClass.openMasterPageDialog);$("#mfSaveMasterPageBtn").on("click",thisClass.selectMasterHandler);$(".mfRemoveMasterPageBtn").on("click",thisClass.removeMasterHandler);$(".mfEditMasterPageBtn").on("click",thisClass.editMasterHandler);$(".mfPageTrashModalCls").on("click",thisClass.openPageTrashModal);$("#mfPinPage2Space").on("click",thisClass.pinPage);$("#mfEmptyTrashBtn").on("click",thisClass.emptyTrash);$("#mfTrashDeleteBtn").on("click",thisClass.deleteTrashItem);$("#mfTrashRestoreBtn").on("click",thisClass.restoreTrashItem);$("#mfTrashPreviewBtn").on("click",thisClass.previewTrashItem);$("#mfNavHideToggle").on("click",thisClass.toggleNavHideHandler);$("#mfToggleTreeBtn").on("click",thisClass.toggleSiteMapExpandHandler);$("#mfPageSettingsHistory").on("click",mf_main.editorController.revisionController.openRevisionListing);$("#mfPageRevBtn").on("click",mf_main.editorController.revisionController.openRevisionListing);$("#mfPageSettingsCheckIn").on("click",mf_main.editorController.revisionController.openAddRevisionDialog);$("#mfPageAddBtn").on("click",thisClass.openAddPageDialog);$("#mfPageAddFolderBtn").on("click",thisClass.openAddFolderDialog);$("#mfAddFolderModalBtn").on("click",thisClass.addFolderHandler);$("#mfPageDupBtn").on("click",thisClass.pageDuplicateHandler);$("#mfPageEditBtn").on("click",thisClass.pageEditHandler);$("#mfPageDelBtn").on("click",thisClass.deletePage);$("#mfAddPageModalBtn").on("click",thisClass.addPageHandler);$("#mfPageThumbDispBtn").on("click",thisClass.toggleThumbnail);$("#mfChangePageSizeModalBtn").on("click",thisClass.openPageSizeHandler);$("#mfPagesOpenWizard").on("click",mf_main.editorController.openWizard);$("#mfAddPageTitle").on("keypress",function(e){if(e.which==13){thisClass.addPageHandler(null);}});$("#mfAddPageModal").on("shown.bs.modal",function(){$("#mfAddPageTitle").focus();});$("#mfPageSearchBox").on("input",thisClass.searchPageHandler);$("#mfPageLinkSearchBox").on("textchange",thisClass.searchPageLinkHandler);$("#mfPageLinkSearchBox2").on("textchange",thisClass.searchPageMultiLinkHandler);$("#mfMasterPageSearchBox").on("textchange",thisClass.searchMasterPageHandler);$("#mfPageGridCloseBtn").on("click",thisClass.closePageGrid);$(".mfPageGridBtnCls").on("click",thisClass.openPageGrid);$(".mfPageSiteMapBtn").on("click",thisClass.openPageSiteMap);$("#mfSearchPageGridInput").on("textchange",thisClass.searchGridPageHandler);$("#mfViewerNavQRCodeBtn").on("click",thisClass.generateQRCode);$("#mfpagegridtype").on("click",function(e){thisClass.lastViewOpened="grid";$(".mfPageViewTypeCls").hide();$(".mfPageViewSettingsCls").hide();$("#mfPageGridListing").show();$("#mfPageGridSettings").show();thisClass.listPageGrid();thisClass.resize();});$("#mfpagemaptype").on("click",function(e){thisClass.lastViewOpened="sitemap";$(".mfPageViewTypeCls").hide();$(".mfPageViewSettingsCls").hide();$("#mfPageSiteMapView").show();$("#mfPageSiteMapSettings").show();if(thisClass.sitemapController==null){var loadFiles=["modules/sitemap/js/sitemap.js","modules/sitemap/js/dao.js"];if(MF_Global.getS3Bucket()!="testmfassets"){loadFiles=["modules/sitemap/js/mf_sitemap-min.js"];}$("<link>").appendTo("head").attr({type:"text/css",rel:"stylesheet"}).attr("href","modules/sitemap/css/sitemap.css");loadFiles.push("js/external/html2canvas.min.js");MF_Utils.loadsScripts(loadFiles).then(function(){$.get("modules/sitemap/sitemap.html",function(templates){$("#mfPageSiteMapView").html(templates);thisClass.sitemapController=new MF_SiteMapController();thisClass.sitemapController.constructor();thisClass.sitemapController.setSiteMapView();thisClass.mapChanged=false;thisClass.resize();});});}else{if(thisClass.mapChanged){mf_main.editorController.editManager.mapSS=new Object();thisClass.mapChanged=false;thisClass.sitemapController.setSiteMapView();}else{for(var pageSSid in mf_main.editorController.editManager.mapSS){var sspage=thisClass.getPagebyID("mfPageItem"+pageSSid);var srcimg="imageproxy.jsp?url=https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+mf_main.editorController.projectObj.company+"/projects/"+mf_main.editorController.projectObj.id+"/pages/"+sspage.eid+"/image/thumb/"+sspage.eid+".png";$("#mfSMapImg"+pageSSid).attr("src",srcimg+"?"+new Date().getTime());}mf_main.editorController.editManager.mapSS=new Object();return;}thisClass.resize();}});$("#mfpageworkflowtype").on("click",function(e){thisClass.lastViewOpened="workflow";$(".mfPageViewTypeCls").hide();$(".mfPageViewSettingsCls").hide();$("#mfPageWorkflowView").show();$("#mfPageWorkflowSettings").show();if(mf_main.workflowController==null){var loadFiles=["modules/workflow/js/internal/workflow.js","modules/workflow/js/internal/dao.js","modules/workflow/js/internal/boards.js","modules/workflow/js/internal/items.js"];if(MF_Global.getS3Bucket()!="testmfassets"){loadFiles=["modules/workflow/js/mf_workflow-min.js"];loadFiles.push("/dwr/interface/MF_WorkflowManager.js");loadFiles.push("/dwr/interface/MF_WorkflowItemManager.js");}else{loadFiles.push("/MockFlow-WireframePro/dwr/interface/MF_WorkflowManager.js");loadFiles.push("/MockFlow-WireframePro/dwr/interface/MF_WorkflowItemManager.js");}$("<link>").appendTo("head").attr({type:"text/css",rel:"stylesheet"}).attr("href","modules/workflow/css/internal/workflow.css");MF_Utils.loadsScripts(loadFiles).then(function(){$.get("modules/workflow/workflow.html",function(templates){$("#mfPageWorkflowView").html(templates);mf_main.workflowController=new MF_WorkflowController();mf_main.workflowController.constructor();mf_main.workflowController.openView();thisClass.workflowChanged=false;thisClass.resize();});});}else{if(thisClass.workflowChanged){mf_main.editorController.editManager.workflowSS=new Object();thisClass.workflowChanged=false;mf_main.workflowController.openView();thisClass.resize();}else{for(var pageSSid in mf_main.editorController.editManager.workflowSS){var sspage=thisClass.getPagebyID("mfPageItem"+pageSSid);$("#mfWorkflowItemItemThumbnail"+pageSSid).attr("src",sspage.thumbnailURL+"?"+new Date().getTime());}mf_main.editorController.editManager.workflowSS=new Object();}}});$(document).on("dnd_start.vakata",function(e,data){try{e.preventDefault();var treeInstance=data.data.origin;var treeElement=treeInstance.element;if($(treeElement).attr("id")=="mfPageList"){if(mf_main.editorController.VIEWER){e.preventDefault();return false;}}}catch(e){}});$(document).on("dnd_stop.vakata",function(e,data){try{var treeInstance=data.data.origin;var treeElement=treeInstance.element;if($(treeElement).attr("id")=="mfPageList"){thisClass.treeview=$("#mfPageList").jstree(true);var targetNode=thisClass.treeview.get_node(data.event.target,true);if(targetNode.length>0){thisClass.treeview.open_node(targetNode[0].id);}var targetId=thisClass.treeview.get_node(data.element).id;thisClass.onDragEnd(targetId);}if($(treeElement).attr("id")=="mfLayersList"){mf_main.editorController.layersController.treeview=$("#mfLayersList").jstree(true);var targetNode=mf_main.editorController.layersController.treeview.get_node(data.event.target,true);if(targetNode.length>0){mf_main.editorController.layersController.treeview.open_node(targetNode[0].id);}var targetId=mf_main.editorController.layersController.treeview.get_node(data.element).id;mf_main.editorController.layersController.onDragEnd(targetId);}}catch(e){}});};this.generateQRCode=function(){if(mf_main.editorController.projectObj.share){$("#mfPageUrlQRCodeLoader").show();if(thisClass.isQRCodeJsLoaded){thisClass.renderQRCode();}else{var loadFiles=["js/external/jquery.qrcode.min.js"];loadFiles.push("js/external/canvas-to-blob.min.js");MF_Utils.loadsScripts(loadFiles).then(function(){thisClass.isQRCodeJsLoaded=true;thisClass.renderQRCode();});}}else{alert("Project is not shared as public.");}};this.deleteTrashItem=function(){if(thisClass.selectedTrashPage==null){MF_Utils.display_ActionIndicator("No item selected!");}else{if(MF_Permission.deny(mf_main.editorController.projectObj,"canDeleteRevision")){MF_Utils.display_ActionIndicator("Permission denied by project owner: To delete trash item");return;}bootbox.confirm('Delete this page "'+Handlebars.Utils.escapeExpression(thisClass.selectedTrashPage.name)+'" and all it revision history permanently. Continue?',function(answer){if(answer){var rev=thisClass.selectedTrashPage;var rind=thisClass.trashCollection.getItemIndex(thisClass.selectedTrashPage);if(rind!=-1){thisClass.trashCollection.removeItemAt(rind);}thisClass.listDeletedPages(thisClass.trashCollection.toArray());MF_Utils.display_ActionIndicator("Page has been deleted!");MF_ProjectManager.deletePageForever(MF_UserSession.getUser(),rev,{callback:function(){}});}});}};this.emptyTrash=function(){bootbox.confirm("Do you want to delete all pages in trash and its revision history permanently ?<br/><br/>Note: It cannot be recovered again",function(ans){if(ans){$(".mfTrashModalCls").hide();$("#mfTrashLoadingScreen").show();MF_ProjectManager.emptyPageTrash(MF_UserSession.getUser(),thisClass.trashCollection.toArray(),mf_main.editorController.projectObj.id,{callback:function(){thisClass.trashCollection=new ArrayCollection();thisClass.listDeletedPages(thisClass.trashCollection.toArray());MF_Utils.display_ActionIndicator("All pages in trash deleted!");$(".mfTrashModalCls").hide();$("#mfTrashEmptyScreen").show();}});}});};this.pinPage=function(){if(mf_main.editorController.projectObj.spaceId==null||mf_main.editorController.projectObj.spaceId==""){alert("This project belongs to default space which does not allow pin pages.");return;}bootbox.confirm("Add direct access to this page from this project's design space.<br/><br/>Continue?",function(ans){if(ans){MF_Utils.display_ActionIndicator("Pinning page to space...");MF_ProjectManager.pinPage(MF_UserSession.getUser(),mf_main.editorController.projectObj.spaceId,mf_main.editorController.projectObj.id,mf_main.editorController.projectObj.company,thisClass.selectedPage.eid,thisClass.selectedPage.pageName,{callback:function(response){var res=response=JSON.parse(response);if(res.status=="fail"&&res.message=="Error"){alert("Error occurred! page not pinned to space ");return;}else{if(res.status=="fail"&&res.message=="exists"){alert("Page already pinned. It can be un-pinned from design space.");return;}}var p=new MF_Project();p.title=thisClass.selectedPage.pageName;p.id=thisClass.selectedPage.eid+"_"+mf_main.editorController.projectObj.id;p.category=mf_main.editorController.projectObj.id;p.creator=MF_UserSession.getUser().username;p.company=mf_main.editorController.projectObj.company;p.projectType="pinpage";p.spaceId=mf_main.editorController.projectObj.spaceId;var rtcObj=new MF_EditorRTCItem();rtcObj.collaborators=mf_main.editorController.powerupController.getRTCCollaboratorList();rtcObj.project=p;rtcObj.spaceId=mf_main.editorController.projectObj.spaceId;mf_main.dashboardRtcController.pinPowerupSync("designspacepowerup_pin",rtcObj);alert("Page has been pinned. Now this page can be directly opened from its design space.");var rtcObj=new MF_EditorRTCItem();var logcmd="ADD-PINPAGE";var logdata={spaceid:mf_main.editorController.projectObj.spaceId,spacename:res.spacename,projectid:mf_main.editorController.projectObj.id,projectname:mf_main.editorController.projectObj.title,pageid:thisClass.selectedPage.eid,pagename:thisClass.selectedPage.pageName};var logMessage=mf_main.logController.getLogMessage(logcmd,logdata);rtcObj.messageStr=logMessage;rtcObj.logcmd=logcmd;rtcObj.logdata=logdata;rtcObj.collaborators=mf_main.editorController.powerupController.getRTCCollaboratorList();mf_main.dashboardRtcController.notification_sync(rtcObj);mf_main.logController.logSpaceAction(logcmd,logMessage,logdata,rtcObj.collaborators);return;}});}});};this.previewTrashItem=function(){if(MF_Permission.deny(mf_main.editorController.projectObj,"canPreviewRevision")){MF_Utils.display_ActionIndicator("Permission denied by project owner: To preview page");return;}if(thisClass.selectedTrashPage==null){MF_Utils.display_ActionIndicator("No item selected!");}else{var publicid=MF_Utils.guidGenerator();var privateid=MF_Utils.guidGenerator();var url="preview.jsp?editor=off&publicid="+mf_main.PUBLICID+"&projectid="+mf_main.editorController.projectObj.id+"&pageid="+thisClass.selectedTrashPage.eid+"&revid=trash";window.open(url);mf_main.PUBLICID=publicid;MF_Authentication.addSecureKeyHash(MF_UserSession.getUser(),publicid,privateid,{callback:function(str){}});}};this.restoreTrashItem=function(){if(thisClass.selectedTrashPage==null){MF_Utils.display_ActionIndicator("No item selected!");}else{if(MF_Permission.deny(mf_main.editorController.projectObj,"canDeleteRevision")){MF_Utils.display_ActionIndicator("Permission denied by project owner: To restore trash item");return;}if(MF_UserSession.getUser().isBasic){bootbox.confirm("Basic MockFlow plan does not allow page restore from trash, To enable this feature upgrade now?",function(msgallow){if(msgallow){mf_main.openUpgradeDialog();}});return;}bootbox.confirm('Restore this page "'+Handlebars.Utils.escapeExpression(thisClass.selectedTrashPage.name)+'" and all it revision history. Continue?',function(answer){if(answer){var rev=thisClass.selectedTrashPage;var rind=thisClass.trashCollection.getItemIndex(thisClass.selectedTrashPage);if(rind!=-1){thisClass.trashCollection.removeItemAt(rind);}thisClass.listDeletedPages(thisClass.trashCollection.toArray());$(".mfTrashModalCls").hide();$("#mfTrashLoadingScreen").show();var page=new MF_Page();page.eid=rev.eid;page.pageName=rev.name;page.parentPage="";page.folder=false;page.createPageData();page.pageName=rev.name;MF_ProjectManager.restoreDeletedPage(MF_UserSession.getUser(),rev,{callback:function(){var pageidslist=new Array();for(var i=0;i<MF_PagePool.getPages().size();i++){var item=MF_PagePool.getPages().getItemAt(i);if(item.folder==false){pageidslist.push(item.eid);}}mf_main.editorController.getOrphanedPages(pageidslist);MF_Utils.display_ActionIndicator("Page has been restored!");$(".mfTrashModalCls").hide();$("#mfTrashListScreen").show();mf_main.rtc.siteMapSync("addPage",page);thisClass.resetSpaceCachedPowerup();MF_ProjectManager.trashRestorePinProjectPowerup(MF_UserSession.getUser(),rev.clientid,mf_main.editorController.projectObj.spaceId,mf_main.editorController.projectObj.id,rev.eid,false,{callback:function(res){if(res&&res.length>0){var rtcObj={projects:res,collaborators:mf_main.editorController.powerupController.getRTCCollaboratorList(),type:"restore"};mf_main.dashboardRtcController.pagePowerupSync("designspaceprojectpowerup_pagesync",rtcObj);}}});}});}});}};this.openPageTrashModal=function(){mf_main.editorController.disableShortcuts();thisClass.resetTrashListing();$("#mfTrashModal").modal();thisClass.listTrashFromServer();};this.resetTrashListing=function(){$(".mfTrashModalCls").hide();$("#mfTrashLoadingScreen").show();};this.listTrashFromServer=function(){$(".mfTrashModalCls").hide();$("#mfTrashLoadingScreen").show();MF_ProjectManager.listDeletedPages(MF_UserSession.getUser(),mf_main.editorController.projectObj.company,mf_main.editorController.projectObj.id,{callback:function(arr){if(arr!=null){thisClass.listDeletedPages(arr);}}});};this.listDeletedPages=function(arr){this.selectedTrashPage=null;$("#mfTrashListItems").empty();var cachedTemplate=mf_main.getTemplateFromCache("mfTrashItemTemplate");if(cachedTemplate==null){$.get("templates/editor/TrashItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfTrashItemTemplate").html());mf_main.addTemplateToCache("mfTrashItemTemplate",template);thisClass.renderTrashListing(arr,template);});}else{thisClass.renderTrashListing(arr,cachedTemplate);}};this.renderTrashListing=function(arr,template){thisClass.trashCollection=new ArrayCollection();var len=arr.length;var htmldom="";for(var i=0,j=len;i<j;i++){var citem=new MF_PageData();citem.cast(arr[i]);thisClass.trashCollection.addItem(citem);htmldom=htmldom+template(citem);}$("#mfTrashListItems").append(htmldom);$(".mfTrashItemCls").on("click",thisClass.trashItemClick);if(thisClass.trashCollection.size()==0){$(".mfTrashModalCls").hide();$("#mfTrashEmptyScreen").show();}else{$(".mfTrashModalCls").hide();$("#mfTrashListScreen").show();}};this.trashItemClick=function(e){thisClass.clearTrashSelection();$(this).css({color:"#2196F3"});thisClass.selectedTrashPage=thisClass.getTrashByHTMLID($(this).attr("id"));};this.clearTrashSelection=function(){for(var i=0;i<thisClass.trashCollection.size();i++){var item=thisClass.trashCollection.getItemAt(i);thisClass.selectedTrashPage=null;$("#mfTrashItem"+item.eid).css({color:"#444"});}};this.getTrashByHTMLID=function(pid){for(var i=0;i<thisClass.trashCollection.size();i++){var item=thisClass.trashCollection.getItemAt(i);if("mfTrashItem"+item.eid==pid){return item;break;}}return null;};this.renderQRCode=function(){$("#mfPageUrlQRCode").empty();$("#mfQRCodeDialog").modal();var url=MF_Global.serverURL()+"view/"+mf_main.editorController.projectObj.publicURL+"#/page/"+mf_main.editorController.page.eid;$("#mfPageUrlQRCode").qrcode({width:200,height:200,text:url,background:"#ffffff",foreground:"#000"});if($("#mfPageUrlQRCode canvas").length>0){var timestamp=new Date().getTime();var fileName=mf_main.editorController.page.pageName+"-"+timestamp+".png";thisClass.generateImage(function(fileObj){var downloadableUrl=window.URL.createObjectURL(fileObj);$("#mfDownloadQRCodeBtn").attr("href",downloadableUrl);$("#mfDownloadQRCodeBtn").attr("download",fileName);$("#mfDownloadQRCodeBtn").show();});}$("#mfPageUrlQRCodeLoader").hide();};this.generateImage=function(callback){var canvas=$("#mfPageUrlQRCode canvas")[0];var context=canvas.getContext("2d");canvas.toBlob(function(blob){callback(blob);});};this.setGridChanged=function(){thisClass.gridChanged=true;thisClass.mapChanged=true;thisClass.workflowChanged=true;if($("#mfPageGridInterface").css("display")=="block"){thisClass.listPageGrid();}};this.closePageGrid=function(e){if($("#mfPageGridInterface").css("display")=="block"){if(!mf_main.editorController.EDITOR){mf_main.editorController.openNavBarContent("mfViewerNavPagesBtn");}if(mf_main.editorController.EDITOR){mf_main.editorController.enableShortcuts();}$("#mfPageGridInterface").hide();}};this.toggleSiteMapExpandHandler=function(e){if(thisClass.siteMapMode=="expand"){thisClass.siteMapMode="collapse";if(thisClass.treeview){thisClass.treeview.close_all();}}else{thisClass.siteMapMode="expand";if(thisClass.treeview){thisClass.treeview.open_all();}}};this.toggleNavHideHandler=function(e){if(mf_main.editorController.page.navHide){mf_main.editorController.page.navHide=false;MF_Utils.display_ActionIndicator("This Page has been made visible in viewer");}else{mf_main.editorController.page.navHide=true;MF_Utils.display_ActionIndicator("This Page has been made hidden in viewer");}mf_main.editorController.setNavHide();mf_main.editorController.enableShortcuts();mf_main.rtc.siteMapSync("navHide",mf_main.editorController.page);mf_main.editorController.pageController.listPages();MF_ChangeManager.CHANGED(true);thisClass.resetSpaceCachedPowerup();};this.openPageSiteMap=function(){thisClass.openPageGrid("sitemap");};this.openPageWorkflow=function(){thisClass.openPageGrid("workflow");};this.openPageGrid=function(type){mf_main.editorController.disableShortcuts();$("#mfPageGridTitleBlock").text(mf_main.editorController.projectObj.title);$("#mfPageGridInterface").css("top","-500px");$("#mfPageGridInterface").show();$("#mfPageGridInterface").animate({top:"0px",},{duration:100,complete:function(){if(thisClass.lastViewOpened!=null){type=thisClass.lastViewOpened;}if(type=="sitemap"){$("#mfpagemaptype").click();}else{if(type=="workflow"){$("#mfpageworkflowtype").click();}else{$("#mfpagegridtype").click();}}thisClass.lastViewOpened=type;thisClass.resize();}});};this.listPageGrid=function(){if(thisClass.gridChanged){mf_main.editorController.editManager.gridSS=new Object();thisClass.gridChanged=false;}else{for(var pageSSid in mf_main.editorController.editManager.gridSS){var sspage=thisClass.getPagebyID("mfPageItem"+pageSSid);$("#mfPageGridItemThumb"+pageSSid).attr("src",sspage.thumbnailURL+"?"+new Date().getTime());}mf_main.editorController.editManager.gridSS=new Object();return;}var cachedTemplate=mf_main.getTemplateFromCache("mfPageGridItemTemplate");if(cachedTemplate==null){$.get("templates/editor/PageGridItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfPageGridItemTemplate").html());mf_main.addTemplateToCache("mfPageGridItemTemplate",template);thisClass.renderPageGridItem(template);});}else{thisClass.renderPageGridItem(cachedTemplate);}};this.renderPageGridItem=function(template){$("#mfPageGridListing").empty();for(var i=0;i<MF_PagePool.getPages().size();i++){var page=MF_PagePool.getPages().getItemAt(i);if(!page.navHide&&!page.folder){$("#mfPageGridListing").append(template(page));}}$(".mfPageGridItemWrapper").on("click",thisClass.gridItemClick);$(".lazyPageGridThumb").off("error");$(".lazyPageGridThumb").on("error",function(){$(this).hide();});$(".pageGridCommentNum").hide();MF_ProjectManager.getCommentData(MF_UserSession.getUser(),mf_main.editorController.projectObj.id,mf_main.editorController.projectObj.company,mf_main.PUBLIC,{callback:function(commentData){for(var i=0;i<MF_PagePool.getPages().size();i++){var page=MF_PagePool.getPages().getItemAt(i);if(commentData[page.eid]){page.comments=commentData[page.eid];if(page.comments>0){$("#mfPageGridCommentNum"+page.eid).show();}}}}});};this.gridItemClick=function(e){thisClass.closePageGrid();var pageid=$(this).attr("data-pageid");var existingPage=MF_PagePool.getPage(pageid);if(existingPage){mf_main.editorController.viewPage(existingPage);}};this.openMasterPageDialog=function(e){mf_main.editorController.showPopUp(e,$("#mfMasterPageSelectionPopup"));var mapdata=MF_PagePool.getMap("mfMasterPage");mf_main.editorController.disableShortcuts();if(thisClass.mastertreeview){$("#mfMasterPageList").jstree(true).settings.core.data=mapdata;$("#mfMasterPageList").jstree(true).refresh();thisClass.mastertreeview.open_all();}else{if(thisClass.mastertreeview){thisClass.mastertreeview.destroy();}$("#mfMasterPageList").empty();$("#mfMasterPageList").jstree({core:{animation:0,themes:{dots:false},data:mapdata,worker:false,},plugins:["search","dnd"],search:{show_only_matches:true},dnd:{is_draggable:function(nodes,e){if(e.target.className.indexOf("reorder")===-1){e.preventDefault();return false;}return true;}}}).on("dblclick",".jstree-anchor",function(e){thisClass.selectMasterHandler(e);});thisClass.mastertreeview=$("#mfMasterPageList").jstree(true);thisClass.mastertreeview.open_all();$("#mfMasterPageList").on("search.jstree",function(nodes,str,res){if(str.nodes.length===0){thisClass.mastertreeview.hide_all();}});}var pageTreeItemData=thisClass.mastertreeview.get_node("mfMasterPage_"+mf_main.editorController.page.masterPage);if(pageTreeItemData){thisClass.mastertreeview.deselect_all(true);thisClass.mastertreeview.select_node(mf_main.editorController.page.masterPage);}};this.searchGridPageHandler=function(e){var searchval=$("#mfSearchPageGridInput").val().toLowerCase().trim();var pageArr=MF_PagePool.getPages().toArray();for(var i=0;i<pageArr.length;i++){var item=pageArr[i];if(item.pageName.toLowerCase().indexOf(searchval)>=0){$("#mfPageGridItem"+item.eid).show();}else{$("#mfPageGridItem"+item.eid).hide();}}};this.searchPageHandler=function(e){var searchval=$("#mfPageSearchBox").val().trim();var query=searchval.toLowerCase();thisClass.treeview.show_all();thisClass.treeview.search(query);thisClass.setPageItemDblClickEvent();};this.searchPageLinkHandler=function(e){var searchval=$("#mfPageLinkSearchBox").val().trim();var query=searchval.toLowerCase();mf_main.editorController.pageLinkController.linktreeview.show_all();mf_main.editorController.pageLinkController.linktreeview.search(query);};this.searchPageMultiLinkHandler=function(e){var searchval=$("#mfPageLinkSearchBox2").val().trim();var query=searchval.toLowerCase();mf_main.editorController.pageMultiLinkController.linktreeview.show_all();mf_main.editorController.pageMultiLinkController.linktreeview.search(query);};this.selectMasterHandler=function(e){var selected=thisClass.mastertreeview.get_selected();if(!selected){alert("No page selected");return;}var item=thisClass.mastertreeview.get_node(selected);if(item){var chkpage=MF_PagePool.getPage(item.original.pageid);if(chkpage.folder){MF_Utils.display_ActionIndicator("Cannot select folder");return;}if(chkpage.eid==mf_main.editorController.page.eid){MF_Utils.display_ActionIndicator("Cannot set same page as background");return;}mf_main.editorController.page.masterPage=item.original.pageid;mf_main.editorController.setMasterPage();$("#mfMasterPageSelectionPopup").hide();mf_main.editorController.enableShortcuts();mf_main.editorController.viewPage(mf_main.editorController.page,true);mf_main.rtc.siteMapSync("masterPage",mf_main.editorController.page);MF_ChangeManager.CHANGED(true);}};this.removeMasterHandler=function(e){mf_main.editorController.page.masterPage="";mf_main.editorController.setMasterPage();$("#mfMasterPageSelectionPopup").hide();mf_main.editorController.enableShortcuts();mf_main.editorController.viewPage(mf_main.editorController.page,true);mf_main.rtc.siteMapSync("masterPage",mf_main.editorController.page);MF_ChangeManager.CHANGED(true);};this.editMasterHandler=function(e){var masterPage=MF_PagePool.getPage(mf_main.editorController.page.masterPage);if(masterPage){mf_main.editorController.enableShortcuts();mf_main.editorController.viewPage(masterPage);}};this.searchMasterPageHandler=function(e){var searchval=$("#mfMasterPageSearchBox").val().trim();var query=searchval.toLowerCase();thisClass.mastertreeview.show_all();thisClass.mastertreeview.search(query);};this.toggleThumbnail=function(e){if(thisClass.displayPageThumbnail){thisClass.displayPageThumbnail=false;$(".mfPageItemThumbCls").hide();$(".mfPageItemCls").height(30);$("#mfPageThumbDispBtn").css("color","#cccccc");}else{thisClass.displayPageThumbnail=true;$(".mfPageItemThumbCls").show();$(".mfPageItemCls").height(220);$("#mfPageThumbDispBtn").css("color","#fff");}};this.resize=function(){if($("#mfPageGridInterface").css("display")=="block"){if($("#mfPageGridListing").css("display")=="block"){$("#mfPageGridListing").height($(currentWindow).height()-$("#mfPageGridHeader").height()-50);}$("#mfPageGridTitleBlock").width($(window).width()-$("#mfPageGridBtnBlock").width()+100-$("#mfPageMapTypeBtn").width()-30);if($("#mfPageSiteMapView").css("display")=="block"){$("#mfPageSiteMapView").height($(currentWindow).height()-$("#mfPageSiteMapHeader").height()-50);}}};this.pageDuplicateHandler=function(e){if(!thisClass.allowPageCreation()){return;}$("#mfPageSearchBox").val("");thisClass.searchPageHandler();var pagename=mf_main.editorController.page.pageName;pagename=pagename+" Copy";var newpage=MF_PagePool.addNewPage(pagename,mf_main.editorController.page);newpage.master=mf_main.editorController.page.master;newpage.masterPage=mf_main.editorController.page.masterPage;var selectedNode=thisClass.treeview.get_selected(true)[0];if(selectedNode){var pageSelected=thisClass.getPagebyID("mfPageItem"+selectedNode.id);newpage.parentPage=pageSelected.parentPage;}if(mf_main.editorController.page.changed){newpage.e2xml.settingsXML=mf_main.editorController.page.e2xml.formXML("pageonly");}else{newpage.e2xml.settingsXML=mf_main.editorController.page.e2xml.settingsXML;}newpage.e2xml.applySettings();thisClass.refreshTree(newpage);newpage.duplicated=true;newpage.pagedata.snapped=false;mf_main.editorController.viewPage(newpage,true);mf_main.editorController.saveTree();MF_ChangeManager.CHANGED(true);mf_main.rtc.siteMapSync("addPage",newpage);thisClass.resetSpaceCachedPowerup();try{thisClass.treeview.get_node(newpage.eid,true).children(".jstree-anchor").focus();}catch(err){}};this.allowPageCreation=function(){var allow=true;if(MF_UserSession.getUser().isBasic){if(mf_main.editorController.projectObj.checkPermission&&!mf_main.editorController.projectObj.isBasic){return allow;}var cpages=MF_PagePool.getPages();var countpages=0;for(var b=0;b<cpages.size();b++){var ppage=cpages.getItemAt(b);if(ppage.folder==false){countpages++;}}if(countpages>=3){allow=false;bootbox.confirm("Basic plan allows only 3 pages. For unlimited pages, upgrade now?",function(answer){if(answer){mf_main.openUpgradeDialog();}});}}return allow;};this.openAddPageDialog=function(e){if(!thisClass.allowPageCreation()){return;}$("#mfPageSearchBox").val("");thisClass.searchPageHandler();thisClass.editPage=null;var page=MF_PagePool.addNewPage();var selectedNode=thisClass.treeview.get_selected(true)[0];if(selectedNode){var pageSelected=thisClass.getPagebyID("mfPageItem"+selectedNode.id);if(pageSelected.folder){page.parentPage=pageSelected.eid;}else{page.parentPage=pageSelected.parentPage;}}mf_main.closeDialog();thisClass.refreshTree(page);mf_main.rtc.siteMapSync("addPage",page);mf_main.editorController.viewPage(page,true);MF_ChangeManager.CHANGED(true);mf_main.editorController.saveTree();thisClass.resetSpaceCachedPowerup();try{thisClass.treeview.get_node(page.eid,true).children(".jstree-anchor").focus();}catch(err){}};this.refreshTree=function(page,folder){if(thisClass.treeview){try{var obj=new Object();obj.id=page.eid;obj.children=new Array();obj.text=page.pageName;obj.pageid=page.eid;if(folder){obj.icon="images/editor/folder.svg";}else{obj.icon="images/editor/page.svg";}var rootnode=null;if(page.parentPage&&page.parentPage!=""){obj.parentid=MF_PagePool.getPageMap()[page.parentPage];var pageTreeItemData=thisClass.treeview.get_node(page.parentPage);if(pageTreeItemData){rootnode=pageTreeItemData.id;}}if(rootnode==null){thisClass.treeview.create_node("#",obj);}else{thisClass.treeview.create_node(rootnode,obj);}MF_PagePool.mapPages();thisClass.setPageItemDblClickEvent();}catch(e){mf_main.editorController.pageController.listPages();}}else{mf_main.editorController.pageController.listPages();}};this.openAddFolderDialog=function(e){thisClass.editPage=null;$("#mfPageSearchBox").val("");thisClass.searchPageHandler();var page=MF_PagePool.addNewFolder();var selectedNode=thisClass.treeview.get_selected(true)[0];if(selectedNode){var pageSelected=thisClass.getPagebyID("mfPageItem"+selectedNode.id);page.parentPage=pageSelected.parentPage;}mf_main.closeDialog();MF_ChangeManager.CHANGED(true);thisClass.refreshTree(page,true);mf_main.editorController.saveTree();mf_main.rtc.siteMapSync("addPage",page);thisClass.resetSpaceCachedPowerup();try{thisClass.treeview.get_node(page.eid,true).children(".jstree-anchor").focus();}catch(err){}};this.openPageSizeHandler=function(e){$("#mfAddPageModal").modal("hide");$("#mfPageSizeBtn").click();};this.addPageHandler=function(e){var pagename=$.trim($("#mfAddPageTitle").val());pagename=pagename.replace(/"/g,"");pagename=pagename.replace(/'/g,"");if(pagename==""){alert("Page name cannot be empty");return;}if(pagename.length>100){alert("Page name should not exceed 100 characters!");return;}if(thisClass.editPage){thisClass.editPage.pageName=pagename;mf_main.closeDialog();MF_ChangeManager.CHANGED(true);MF_ProjectManager.renamePage(MF_UserSession.getUser(),mf_main.editorController.projectObj.id,mf_main.editorController.projectObj.company,thisClass.editPage.eid,thisClass.editPage.pageName,{callback:function(res){}});try{var pageTreeItemData=thisClass.treeview.get_node(thisClass.editPage.eid);if(pageTreeItemData){pageTreeItemData.name=pagename;thisClass.treeview.rename_node(pageTreeItemData,pagename);MF_PagePool.mapPages();thisClass.setPageItemDblClickEvent();}else{mf_main.editorController.pageController.listPages();}}catch(e){mf_main.editorController.pageController.listPages();}mf_main.rtc.siteMapSync("renamePage",thisClass.editPage);thisClass.resetSpaceCachedPowerup();}MF_ChangeManager.CHANGED(true);mf_main.editorController.saveTree();};this.addFolderHandler=function(e){var pagename=$.trim($("#mfAddFolderTitle").val());if(pagename==""){alert("Folder name cannot be empty");return;}if(thisClass.editPage){thisClass.editPage.pageName=pagename;mf_main.closeDialog();MF_ChangeManager.CHANGED(true);mf_main.editorController.pageController.listPages();}else{var page=MF_PagePool.addNewFolder($("#mfAddFolderTitle").val());mf_main.closeDialog();MF_ChangeManager.CHANGED(true);mf_main.editorController.pageController.listPages();}};this.deletePage=function(){if(MF_Permission.deny(mf_main.editorController.projectObj,"canChangeSiteMap")){MF_Utils.display_ActionIndicator("Permission denied to delete existing page");return;}var selectedNode=thisClass.treeview.get_selected(true)[0];var page=null;if(selectedNode!=null){page=thisClass.getPagebyID("mfPageItem"+selectedNode.id);}else{MF_Utils.display_ActionIndicator("No page selected");return;}if(page&&!page.folder){var pagecounter=0;for(var k=0;k<MF_PagePool.getPages().size();k++){var pitem=MF_PagePool.getPages().getItemAt(k);if(pitem.folder==false){pagecounter++;if(pagecounter>1){break;}}}if(pagecounter<=1){MF_Utils.display_ActionIndicator("Project should have atleast 1 page");return;}}if(page==null){MF_Utils.display_ActionIndicator("No page selected");return;}var msg="";if(page.folder){msg='Delete this folder "'+page.pageName+'" and not its sub items. Continue?';}else{if(MF_UserSession.getUser()&&MF_UserSession.getUser().isBasic){msg='Permanently delete this page: "'+page.pageName+'" ?<br/><br/>Note: Trash feature is not available in Basic plan.';}else{if(mf_main.editorController.projectObj.spaceId!=null){msg='Move this page "'+page.pageName+'" to trash?<br/><br/>Note: This will also remove powerups associated with page. Continue?';}else{msg='Move this page "'+page.pageName+'" to trash?';}}}bootbox.confirm(msg,function(answer){if(answer){MF_ChangeManager.CHANGED(true);var delPageData=new MF_PageData();delPageData.clientid=mf_main.editorController.projectObj.company;delPageData.projectid=mf_main.editorController.projectObj.id;delPageData.eid=page.eid;delPageData.name=page.pageName;page.pagedata.data=MF_Utils.xmlToString(page.e2xml.formXML("pageonly"));page.pagedata.data=page.pagedata.data.replace(/(xmlns *= *[\"'].[^\"']*[\"'])/ig,"");thisClass.deletePageServer(page);if(!page.folder){try{var projId=new Array();projId.push(page.eid+"_"+page.pagedata.projectid);var rtcObj={projects:projId,collaborators:mf_main.editorController.powerupController.getRTCCollaboratorList(),type:"delete"};mf_main.dashboardRtcController.pagePowerupSync("designspaceprojectpowerup_pagesync",rtcObj);}catch(e){}MF_ProjectManager.savePage(MF_UserSession.getUser(),page.pagedata,new Array(),false,{callback:function(result){if((MF_UserSession.getUser()&&MF_UserSession.getUser().isBasic)){MF_ProjectManager.deletePageForever(MF_UserSession.getUser(),delPageData,{callback:function(){}});}else{MF_ProjectManager.deletePage(MF_UserSession.getUser(),delPageData,{callback:function(res){}});}MF_ProjectManager.trashRestorePinProjectPowerup(MF_UserSession.getUser(),delPageData.clientid,mf_main.editorController.projectObj.spaceId,mf_main.editorController.projectObj.id,delPageData.eid,true,{callback:function(res){if(res&&res.length>0){var rtcObj={projects:res,collaborators:mf_main.editorController.powerupController.getRTCCollaboratorList(),type:"delete"};mf_main.dashboardRtcController.pagePowerupSync("designspaceprojectpowerup_pagesync",rtcObj);}}});}});}mf_main.editorController.saveTree();mf_main.rtc.siteMapSync("delPage",page);thisClass.resetSpaceCachedPowerup();}});};this.deletePageServer=function(page){if(page==null){return;}var resetViewPage=false;if(mf_main.editorController.page.eid==page.eid){resetViewPage=true;}if(thisClass.selectedPage.eid==page.eid){$("#mfQRCodeDialog").modal("hide");}MF_PagePool.deletePage(page);thisClass.listPages();if(resetViewPage){mf_main.editorController.viewPage(mf_main.editorController.get1stPage(),true);}else{thisClass.selectPage("mfPageItem"+mf_main.editorController.page.eid);var pageTreeItemData=thisClass.treeview.get_node(mf_main.editorController.page.eid);if(pageTreeItemData){thisClass.treeview.select_node(pageTreeItemData.id);}}};this.listPages=function(){$("#mfPageSearchBox").val("");thisClass.scrollPos=$("#mfPageList").scrollTop();MF_PagePool.mapPages();var mapdata=MF_PagePool.getMap();if(thisClass.treeview){$("#mfPageList").jstree(true).settings.core.data=mapdata;$("#mfPageList").jstree(true).refresh();thisClass.treeview.open_all();thisClass.setPageItemDblClickEvent();return;}if(thisClass.treeview){thisClass.treeview.destroy();}$("#mfPageList").empty();if(MF_Permission.deny(mf_main.editorController.projectObj,"canChangeSiteMap")||mf_main.PUBLIC){$("#mfPageList").jstree({core:{animation:0,themes:{dots:false},data:mapdata,check_callback:true,worker:false,},plugins:["search"],search:{show_only_matches:true}});}else{$("#mfPageList").jstree({core:{animation:0,themes:{dots:false},check_callback:function(operation,node,node_parent,node_position,more){if(mf_main.editorController.VIEWER){return false;}},data:mapdata,worker:false,},plugins:["search","dnd"],search:{show_only_matches:true}}).on("after_open.jstree",function(e,data){mf_main.editorController.pageController.setPageItemDblClickEvent();});}thisClass.treeview=$("#mfPageList").jstree(true);$("#mfPageList").on("search.jstree",function(nodes,str,res){if(str.nodes.length===0){thisClass.treeview.hide_all();}});$("#mfPageList").on("click",function(e,data){thisClass.pageItemClick();});thisClass.treeview.open_all();thisClass.setPageItemDblClickEvent();$("#mfPageList").scrollTop(thisClass.scrollPos);return;};this.setPageItemDblClickEvent=function(){$("#mfPageList .jstree-anchor").off("dblclick");$("#mfPageList .jstree-anchor").on("dblclick",function(e){if(mf_main.editorController.VIEWER){return;}e.stopImmediatePropagation();var node=thisClass.treeview.get_node(this);var page=MF_PagePool.getPage(node.id);if(page){thisClass.editPage=page;thisClass.editPageTitle();}});};this.pageEditHandler=function(){if(MF_Permission.deny(mf_main.editorController.projectObj,"canChangeSiteMap")){MF_Utils.display_ActionIndicator("Permission denied to rename existing page");return;}var selectedNode=thisClass.treeview.get_selected(true)[0];var page=null;if(selectedNode!=null){page=thisClass.getPagebyID("mfPageItem"+selectedNode.id);}else{MF_Utils.display_ActionIndicator("No page selected");return;}thisClass.editPage=page;thisClass.editPageTitle();thisClass.resetSpaceCachedPowerup();};this.editPageTitle=function(){if(thisClass.editPage.folder){$("#mfChangePageSizeModalBtn").hide();}else{$("#mfChangePageSizeModalBtn").show();}mf_main.editorController.disableShortcuts();$("#mfAddPageTitle").val(thisClass.editPage.pageName);$("#mfAddPageModal").modal();$("#mfAddPageModalBtn").text("Rename");$("#mfAddPageTitle").focus();};this.updateSiteMapRTC=function(){MF_ProjectManager.getProjectObj(MF_UserSession.getUser(),mf_main.editorController.projectObj.id,mf_main.PUBLIC,{callback:function(projectObj){mf_main.editorController.projectObj.data=projectObj.data;mf_main.editorController.createSiteMap();}});};this.onDragEnd=function(targetId){var collection=new ArrayCollection();var nodedata=thisClass.treeview.get_node(targetId);var data=thisClass.treeview.get_json("#",{flat:true});thisClass.flattenTreeItems(data,"",collection);MF_PagePool.setPages(collection);MF_PagePool.mapPages();MF_ChangeManager.CHANGED(true);mf_main.editorController.saveTree();var page=thisClass.getPagebyID("mfPageItem"+nodedata.id);if(page){mf_main.rtc.siteMapSync("updatePageParent",page);}thisClass.setPageItemDblClickEvent();thisClass.resetSpaceCachedPowerup();};this.flattenTreeItems=function(data,parent,collection){for(var i=0;i<data.length;i++){var item=data[i];var page=thisClass.getPagebyID("mfPageItem"+item.id);if(page){if(item.parent=="#"){page.parentPage="";}else{page.parentPage=item.parent;}collection.addItem(page);}}};this.clearPageSelection=function(){$(".mfPageItemCls").css("background-color","transparent");};this.selectPage=function(pid){thisClass.clearPageSelection();for(var i=0;i<MF_PagePool.getPages().size();i++){var item=MF_PagePool.getPages().getItemAt(i);if("mfPageItem"+item.eid==pid){thisClass.selectedPage=item;$("#mfPageItem"+item.eid).css("background-color","#2286FB");break;}}};this.getPagebyID=function(pid){for(var i=0;i<MF_PagePool.getPages().size();i++){var item=MF_PagePool.getPages().getItemAt(i);if("mfPageItem"+item.eid==pid){return item;break;}}return null;};this.pageItemClick=function(e){var nodedata=thisClass.treeview.get_selected(true)[0];if(nodedata&&nodedata.icon!="images/editor/folder.svg"){thisClass.selectPage("mfPageItem"+nodedata.id);var allow=true;if(mf_main.editorController.VIEWER){if(thisClass.selectedPage&&thisClass.selectedPage.navHide){allow=false;MF_Utils.display_ActionIndicator("This page is hidden from view");}}if(allow){mf_main.editorController.viewPage(thisClass.selectedPage);}}};this.onPageDragStart=function(e){if(mf_main.editorController.VIEWER){e.preventDefault();}};this.resetSpaceCachedPowerup=function(){if(mf_main.editorController.projectObj.spaceId){var rtcObj=new MF_EditorRTCItem();rtcObj.collaborators=mf_main.editorController.powerupController.getRTCCollaboratorList();rtcObj.spaceId=mf_main.editorController.projectObj.spaceId;mf_main.dashboardRtcController.spacePowerupPageSync("designspace_pagesync",rtcObj);}};}function MF_LayersController(){var thisClass=this;thisClass.scrollPos;thisClass.treeview=null;thisClass.hierarchyData=new Array();thisClass.groups=new Object();thisClass.editComp=null;thisClass.editCompNode=null;this.constructor=function(){$("#mfLayersSearchBox").on("textchange",thisClass.searchLayerHandler);$("#mfAddCompNameModalBtn").on("click",thisClass.renameCompHandler);$("#mfAddCompName").keypress(function(e){if(e.which==13){thisClass.renameCompHandler(null);}});};this.renameCompHandler=function(e){var compname=$.trim($("#mfAddCompName").val());compname=compname.replace(/"/g,"");compname=compname.replace(/'/g,"");if(compname.trim()==""){alert("Name cannot be empty");return;}if(compname.length>100){alert("Name should not exceed 100 characters!");return;}if(thisClass.editComp){if(thisClass.editComp.GROUPID!=""&&thisClass.editComp.GROUPID!=null&&thisClass.editComp.GROUPOBJ){if(compname!=""){thisClass.editComp.groupname=compname;}try{if(thisClass.editCompNode){thisClass.editCompNode.name=compname;thisClass.treeview.rename_node(thisClass.editCompNode,compname);thisClass.setLayerItemDblClickEvent();}}catch(e){}}else{if(compname!=""){thisClass.editComp.compname=compname;}try{if(thisClass.editCompNode){thisClass.editCompNode.name=compname;thisClass.editComp.e2xml.addPropSingle("compname",compname,"default");thisClass.treeview.rename_node(thisClass.editCompNode,compname);thisClass.setLayerItemDblClickEvent();}}catch(e){}}mf_main.closeDialog();MF_ChangeManager.CHANGED(true);}MF_ChangeManager.CHANGED(true);};this.formSiteMap=function(comps,arr,count,origArray,pre){var restack=new Array();for(var i=0;i<comps.length;i++){var comp=comps[i];if(comp.LABEL||(comp.GROUP&&comp.GROUPID!="")){var obj=new Object();if(comp.LABEL){if(pre){obj.id=pre+"_"+comp.eid;}else{obj.id=comp.eid;}obj.children=new Array();if(comp.compname&&comp.compname!=""){obj.text=comp.compname;}else{obj.text=comp.NAME.replace("MF_","");obj.text=obj.text.replace("2","");}obj.compid=comp.eid;if(comp.transformLock){obj.icon="images/editor/lock.svg";}else{obj.icon="https://assets.mockflow.com/app/wireframepro/layers/"+comp.NAME+".svg";}if(comp.GROUPID!=""&&comp.GROUPID!=null){if(thisClass.groups[comp.GROUPID]){thisClass.groups[comp.GROUPID].children.push(obj);}}else{arr.push(obj);}}else{if(comp.GROUP&&comp.GROUPID!=null){if(!thisClass.groups[comp.GROUPID]){var gobj=new Object();if(pre){gobj.id="mfgrp_"+comp.GROUPID;}else{gobj.id=comp.GROUPID;}gobj.children=new Array();var grp=mf_main.editorController.page.groupManager.groups[comp.GROUPID];if(grp.children.size()>0){if(grp.groupname){gobj.text=grp.groupname;}else{gobj.text="Group";}if(grp.selector&&grp.selector.locked){gobj.icon="images/editor/lock.svg";}else{gobj.icon="images/editor/group.svg";}gobj.groupid=comp.GROUPID;gobj.GROUP=true;thisClass.groups[comp.GROUPID]=gobj;if(grp&&grp.parent==""){arr.push(gobj);}else{if(thisClass.groups[grp.parent]){thisClass.groups[grp.parent].children.push(gobj);}}}}}}count++;}}return arr;};this.mapComps=function(){thisClass.hierarchyData=new Array();thisClass.groups=new Object();var page=mf_main.editorController.page;var rev=page.stackOrder.toArray().slice().reverse();thisClass.formSiteMap(rev,thisClass.hierarchyData,0,thisClass.hierarchyData,"lay");return thisClass.hierarchyData;};this.listLayers=function(){if(!thisClass.checkAllowed()){return;}$("#mfLayersSearchBox").val("");thisClass.scrollPos=$("#mfLayersList").scrollTop();var mapdata=thisClass.mapComps();if(thisClass.treeview){$("#mfLayersList").jstree(true).settings.core.data=mapdata;$("#mfLayersList").jstree(true).refresh();thisClass.treeview.open_all();thisClass.setLayerItemDblClickEvent();return;}if(thisClass.treeview){thisClass.treeview.destroy();}$("#mfLayersList").empty();$("#mfLayersList").jstree({core:{animation:0,themes:{dots:false},check_callback:function(operation,node,node_parent,node_position,more){if(operation==="move_node"&&node_parent&&node_parent.id.startsWith("lay_")){return false;}return true;},data:mapdata,worker:false,},plugins:["search","dnd"],search:{show_only_matches:true}}).on("after_open.jstree",function(e,data){});thisClass.treeview=$("#mfLayersList").jstree(true);$("#mfLayersList").on("search.jstree",function(nodes,str,res){if(str.nodes.length===0){thisClass.treeview.hide_all();}});$("#mfLayersList").on("click",function(e,data){thisClass.layerItemClick();});thisClass.treeview.open_all();thisClass.setLayerItemDblClickEvent();$("#mfLayersList").scrollTop(thisClass.scrollPos);return;};this.onDragEnd=function(targetId){var nodedata=thisClass.treeview.get_node(targetId);if(nodedata&&nodedata.id){var previtem=null;var parentitem=null;var parentgroup=false;var prevDomNode=thisClass.treeview.get_prev_dom(nodedata.id);if(prevDomNode&&prevDomNode.length>0){var prevNode=thisClass.treeview.get_node(prevDomNode);previtem=prevNode.id;}var parentId=thisClass.treeview.get_parent(nodedata.id);if(parentId!=="#"){parentitem=parentId;if(parentitem.startsWith("mfgrp_")){parentgroup=true;parentitem=parentitem.replace("mfgrp_","");}else{parentitem=parentitem.replace("lay_","");}}MF_ChangeManager.CHANGED(true);var mfpage=mf_main.editorController.page;var currentid=nodedata.id.replace("lay_","");var prevgroup=false;if(previtem){if(previtem.startsWith("mfgrp_")){prevgroup=true;previtem=previtem.replace("mfgrp_","");}else{previtem=previtem.replace("lay_","");}}var newcollection=new ArrayCollection();var compgroup=false;if(currentid.startsWith("mfgrp_")){currentid=nodedata.id.replace("mfgrp_","");compgroup=true;}var comp=null;if(!compgroup){comp=mf_main.editorController.getComponentById(currentid);}var data=thisClass.treeview.get_json("#",{flat:true});for(var i=0;i<data.length;i++){var item=data[i];if(item.id&&item.id.startsWith("lay_")){var cid=item.id.replace("lay_","");var compobj=mf_main.editorController.getComponentById(cid);if(compobj){newcollection.addItem(compobj);}}}if(newcollection.size()==mfpage.childComponents.size()){if(compgroup){var grp=mf_main.editorController.page.groupManager.getGroupByID(currentid);var nogroupchange=false;if(parentgroup&&parentitem&&grp.parent==parentitem){nogroupchange=true;}else{if(grp.parent!=""){var parentid=grp.parent;grp.parent="";if(parentid!=""){mf_main.editorController.page.groupManager.removeGroupComponent(parentid,grp);mf_main.editorController.page.groupManager.resetParentSelectorGroups(parentid);}}}if(!nogroupchange&&parentitem!=null&&parentgroup){var parentid=grp.parent;grp.parent=parentitem;if(parentid!=""){mf_main.editorController.page.groupManager.removeGroupComponent(parentid,grp);mf_main.editorController.page.groupManager.resetParentSelectorGroups(parentid);}mf_main.editorController.page.groupManager.addGroup(parentitem,grp);mf_main.editorController.page.groupManager.resetParentSelectorGroups(parentitem);}mf_main.editorController.page.groupManager.resetParentSelectorGroups(currentid);}else{var nogroupchange=false;if(parentgroup&&parentitem&&comp.GROUPID==parentitem){nogroupchange=true;}else{if(comp.GROUPID!=""){var cgrid=comp.GROUPID;comp.GROUPID="";mf_main.editorController.page.groupManager.removeGroupComponent(cgrid,comp);mf_main.editorController.page.groupManager.resetParentSelectorGroups(cgrid);}}if(!nogroupchange&&parentitem!=null&&parentgroup){var compgroupid=comp.GROUPID;comp.GROUPID=parentitem;if(compgroupid!=""){mf_main.editorController.page.groupManager.removeGroupComponent(compgroupid,comp);mf_main.editorController.page.groupManager.resetParentSelectorGroups(compgroupid);}mf_main.editorController.page.groupManager.addGroup(parentitem,comp);mf_main.editorController.page.groupManager.resetParentSelectorGroups(parentitem);}}mfpage.childComponents=new ArrayCollection(newcollection.toArray().reverse());mf_main.editorController.clearSelection(true);}thisClass.setLayerItemDblClickEvent();}};this.clearNodes=function(){if(!thisClass.checkAllowed()){return;}if(thisClass.treeview){thisClass.treeview.deselect_all();}};this.selectNode=function(nodeId){if(!thisClass.checkAllowed()){return;}try{thisClass.treeview.deselect_all();thisClass.treeview.select_node(nodeId);var node=thisClass.treeview.get_node(nodeId,true);if(node&&node.length){$("#mfLayersList").animate({scrollTop:$(node).offset().top-$("#mfLayersList").offset().top+$("#mfLayersList").scrollTop()});}}catch(e){}};this.checkAllowed=function(e){if(mf_main.editorController.EDITOR&&$("#mfPageMoreArea").css("display")=="block"&&$("#mfPageMoreAreaLayer").css("display")=="block"){return true;}else{return false;}};this.layerItemClick=function(e){var nodedata=thisClass.treeview.get_selected(true)[0];mf_main.editorController.closeGroupEditing(true,true);mf_main.editorController.clearSelection(true,true);if(nodedata&&nodedata.id&&nodedata.id.startsWith("mfgrp_")){var gid=nodedata.id.replace("mfgrp_","");var grpObj=mf_main.editorController.page.groupManager.getGroupByID(gid);if(grpObj){if(grpObj.parent!=null&&grpObj.parent!=""){mf_main.editorController.performGroupEditing(grpObj.parent);}var inView=thisClass.checkinViewPort(grpObj.selector.y*mf_main.editorController.SCALE,grpObj.selector.x*mf_main.editorController.SCALE);if(!inView){$("#mfEditorHolder").animate({scrollTop:(grpObj.selector.y*mf_main.editorController.SCALE),scrollLeft:(grpObj.selector.x*mf_main.editorController.SCALE)},200,function(){});}if(grpObj.selector&&grpObj.selector.locked){mf_main.editorController.openSetting(grpObj.selector);}else{mf_main.editorController.addComponentSelect(grpObj.selector);mf_main.editorController.addSelectorResize(grpObj.selector,true);}}}else{if(nodedata&&nodedata.id){var cid=nodedata.id.replace("lay_","");var comp=mf_main.editorController.getComponentById(cid);if(comp){if(comp.GROUPID!=null&&comp.GROUPID!=""){mf_main.editorController.performGroupEditing(comp.GROUPID);}if(comp.selector){var inView=thisClass.checkinViewPort(comp.y*mf_main.editorController.SCALE,comp.x*mf_main.editorController.SCALE);if(!inView){$("#mfEditorHolder").animate({scrollTop:(comp.y*mf_main.editorController.SCALE),scrollLeft:(comp.x*mf_main.editorController.SCALE)},200,function(){});}if(comp.transformLock){mf_main.editorController.openSetting(comp.selector);}else{mf_main.editorController.addComponentSelect(comp.selector);if(comp.TRANSFORM){mf_main.editorController.addSelectorTransform(comp.selector,true);}else{mf_main.editorController.addSelectorResize(comp.selector,true);}}}}}}};this.checkinViewPort=function(elemTop,elemLeft){try{var container="#mfEditorHolder";var containerTop=$(container).scrollTop();var containerBottom=containerTop+$(container).height();var containerLeft=$(container).scrollLeft();var containerRight=containerLeft+$(container).width();return((elemTop>=containerTop)&&(elemTop<=containerBottom)&&(elemLeft>=containerLeft)&&(elemLeft<=containerRight));}catch(e){}return false;};this.setLayerItemDblClickEvent=function(){$("#mfLayersList .jstree-anchor").off("dblclick");$("#mfLayersList .jstree-anchor").on("dblclick",function(e){if(mf_main.editorController.VIEWER){return;}e.stopImmediatePropagation();var nodedata=thisClass.treeview.get_node(this);if(nodedata&&nodedata.id&&nodedata.id.startsWith("mfgrp_")){var gid=nodedata.id.replace("mfgrp_","");var grpObj=mf_main.editorController.page.groupManager.getGroupByID(gid);if(grpObj){thisClass.editComp=grpObj;thisClass.editCompNode=nodedata;thisClass.editGroupName();}}else{var cid=nodedata.id.replace("lay_","");var comp=mf_main.editorController.getComponentById(cid);if(comp){thisClass.editComp=comp;thisClass.editCompNode=nodedata;thisClass.editCompName();}}});};this.editGroupName=function(){mf_main.editorController.disableShortcuts();if(thisClass.editComp.groupname&&thisClass.editComp.groupname!=""){$("#mfAddCompName").val(thisClass.editComp.groupname);}else{$("#mfAddCompName").val("Group");}$("#mfEditCompNameTitle").text("Edit Group Name");$("#mfAddCompNameModal").modal();$("#mfAddCompNameModalBtn").text("Rename");setTimeout(function(){$("#mfAddCompName").focus();},500);};this.editCompName=function(){mf_main.editorController.disableShortcuts();if(thisClass.editComp.compname&&thisClass.editComp.compname!=""){$("#mfAddCompName").val(thisClass.editComp.compname);}else{$("#mfAddCompName").val(thisClass.editComp.NAME.replace("MF_",""));}$("#mfEditCompNameTitle").text("Edit Comp Name");$("#mfAddCompNameModal").modal();$("#mfAddCompNameModalBtn").text("Rename");setTimeout(function(){$("#mfAddCompName").focus();},500);};this.searchLayerHandler=function(e){var searchval=$("#mfLayersSearchBox").val().trim();var query=searchval.toLowerCase();thisClass.treeview.show_all();thisClass.treeview.search(query);thisClass.setLayerItemDblClickEvent();};}function MF_PageLinkController(){var thisClass=this;this.component=null;this.currentLinkID=null;this.currentLinkType="page";this.compLinkType="page";this.compLinkEvent="";this.linktreeview=null;this.constructor=function(){$("#mfSaveLinkBtn").on("click",thisClass.savePageLinkHandler);$("#mfRemoveLinkBtn").on("click",thisClass.removeLinkHandler);$("#mfPickCompBtn").on("click",thisClass.selectModeHandler);$("#mfPageURL").on("keypress",function(e){if(e.which==13){e.stopPropagation();thisClass.savePageLinkHandler();}});$("#mfppage").on("click",function(e){thisClass.currentLinkType="page";$(".mfLinkTypeCls").hide();$("#mfLinkPageArea").show();});$("#mfpweb").on("click",function(e){thisClass.currentLinkType="web";$(".mfLinkTypeCls").hide();$("#mfLinkWebArea").show();});$("#mfpinternal").on("click",function(e){thisClass.currentLinkType="internal";$(".mfLinkTypeCls").hide();$("#mfLinkInternalArea").show();});};this.selectModeHandler=function(){mf_main.editorController.enableSelectMode("internallink");mf_main.closeDialog();};this.openPageLinkDialog=function(){thisClass.currentLinkType="page";if(thisClass.linktreeview){thisClass.linktreeview.destroy();}$("#mfPageLinkList").empty();mf_main.editorController.disableShortcuts();var mapdata=MF_PagePool.getMap("mfLinkTree");$("#mfPageLinkList").jstree({core:{animation:0,themes:{dots:false},data:mapdata,worker:false,},plugins:["search"],search:{show_only_matches:true}}).on("dblclick",".jstree-anchor",function(e){thisClass.savePageLinkHandler(e);});$("#mfPageLinkList").on("search.jstree",function(nodes,str,res){if(str.nodes.length===0){thisClass.linktreeview.hide_all();}});thisClass.linktreeview=$("#mfPageLinkList").jstree(true);thisClass.linktreeview.open_all();$("#mfPageURL").val("");$("#mfInternalURL").val("");if(thisClass.component.linkObj){$("#mfpweb").prop("checked",false);$("#mfppage").prop("checked",false);$("#mfpinternal").prop("checked",false);if(thisClass.component.linkObj.type=="web"){thisClass.currentLinkType="web";$("#mfpweb").prop("checked",true);$("#mfPageURL").val(thisClass.component.linkObj.url);$(".mfLinkTypeCls").hide();$("#mfLinkWebArea").show();}else{if(thisClass.component.linkObj.type=="internal"){thisClass.currentLinkType="internal";$("#mfpinternal").prop("checked",true);var urldisp=thisClass.component.linkObj.url;var arr=urldisp.split("|--::--|");var lname=urldisp;if(arr.length==2){lname=arr[1];}$("#mfInternalURL").val(lname);$(".mfLinkTypeCls").hide();$("#mfLinkInternalArea").show();}else{thisClass.currentLinkType="page";$("#mfppage").prop("checked",true);$(".mfLinkTypeCls").hide();$("#mfLinkPageArea").show();if(thisClass.component.linkObj){var pageTreeItemData=thisClass.linktreeview.get_node("mfLinkTree_"+thisClass.component.linkObj.url);if(pageTreeItemData){thisClass.linktreeview.deselect_all(true);thisClass.linktreeview.select_node("mfLinkTree_"+thisClass.component.linkObj.url);}}}}}else{$("#mfppage").prop("checked",true);$(".mfLinkTypeCls").hide();$("#mfLinkPageArea").show();}};this.removeLinkHandler=function(e){if(thisClass.component.GROUP){delete mf_main.editorController.page.groupManager.linkedGroups[thisClass.component.GROUPID];mf_main.closeDialog();mf_main.editorController.enableShortcuts();MF_ChangeManager.CHANGED(true);$(thisClass.currentLinkID).text("Select link");}else{var undoarr=new Array();var undo2=new MF_UndoDAO();if(thisClass.component.NAME=="MF_AdvancedDataGrid"){undo2.propSingleUndo(thisClass.component,"gridLayout",JSON.stringify(thisClass.component.layoutJSON));undoarr.push(undo2);thisClass.component.e2xml.addPropSingle("link","","default");thisClass.component.updateSettings("link","","default");}else{undo2.propSingleUndo(thisClass.component,"link",thisClass.component.link);undoarr.push(undo2);thisClass.component.e2xml.addPropSingle("link","","default");}var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);mf_main.closeDialog();mf_main.editorController.enableShortcuts();MF_ChangeManager.CHANGED(true);MF_ComponentSettingUtils.setLinkType(thisClass.currentLinkID,thisClass.component);}};this.savePageLinkHandler=function(e){if(thisClass.currentLinkType=="page"){var selected=thisClass.linktreeview.get_selected();if(selected){var pageTreeItem=null;var item=thisClass.linktreeview.get_node(selected);if(item){var chkpage=MF_PagePool.getPage(item.original.pageid);if(chkpage.folder){MF_Utils.display_ActionIndicator("Cannot select folder");return;}if(thisClass.component.GROUP){thisClass.component.link="onclick:--:page:--:"+item.original.pageid;mf_main.editorController.page.groupManager.linkedGroups[thisClass.component.GROUPID]=thisClass.component;}else{if(thisClass.component.NAME=="MF_AdvancedDataGrid"){thisClass.component.e2xml.addPropSingle("link","onclick:--:page:--:"+item.original.pageid,"default");thisClass.component.updateSettings("linkType","page","default");thisClass.component.updateSettings("link","onclick:--:page:--:"+item.original.pageid);}else{thisClass.component.e2xml.addPropSingle("link","onclick:--:page:--:"+item.original.pageid);}}}else{alert("No page selected");return;}}else{alert("No page selected");return;}}else{if(thisClass.currentLinkType=="internal"){var internalURL=$.trim($("#mfInternalURL").val());if(internalURL==""){alert("Name cannot be empty");return;}if(thisClass.component.linkObj){var urldisp=thisClass.component.linkObj.url;var arr=urldisp.split("|--::--|");var newname=arr[0]+"|--::--|"+internalURL;thisClass.saveInternalLinkHandler(newname);}else{alert("Select component before saving");return;}}else{var webURL=$.trim($("#mfPageURL").val());if(webURL==""){alert("Web URL cannot be empty");return;}if(thisClass.component.GROUP){thisClass.component.link="onclick:--:web:--:"+webURL;mf_main.editorController.page.groupManager.linkedGroups[thisClass.component.GROUPID]=thisClass.component;}else{thisClass.component.e2xml.addPropSingle("link","onclick:--:web:--:"+webURL,"default");if(thisClass.component.NAME=="MF_AdvancedDataGrid"){thisClass.component.updateSettings("linkType","web","default");thisClass.component.updateSettings("link","onclick:--:web:--:"+webURL);}}}}$("#mfLinkSelectionPopUp").hide();mf_main.editorController.enableShortcuts();MF_ChangeManager.CHANGED(true);MF_ComponentSettingUtils.setLinkType(thisClass.currentLinkID,thisClass.component);};this.saveInternalLinkHandler=function(eid){if(thisClass.component){if(thisClass.component.GROUP){thisClass.component.link="onclick:--:internal:--:"+eid;mf_main.editorController.page.groupManager.linkedGroups[thisClass.component.GROUPID]=thisClass.component;}else{if(thisClass.component.NAME=="MF_AdvancedDataGrid"){thisClass.component.updateSettings("linkType","internal","default");thisClass.component.updateSettings("link","onclick:--:internal:--:"+eid);}else{thisClass.component.e2xml.addPropSingle("link","onclick:--:internal:--:"+eid);}}}$("#mfLinkSelectionPopUp").hide();mf_main.editorController.enableShortcuts();MF_ChangeManager.CHANGED(true);MF_ComponentSettingUtils.setLinkType(thisClass.currentLinkID,thisClass.component);};this.getPageCount=function(eid){var count=0;for(var k=0;k<MF_PagePool.getPages().size();k++){var litem=MF_PagePool.getPages().getItemAt(k);if(!litem.master){count++;if(litem.eid==eid){return count;}}}return 0;};this.resetDialog=function(){};}function MF_PageMultiLinkController(){var thisClass=this;this.component=null;this.currentLinkID=null;this.currentLinkType="page";this.linkCollection=new ArrayCollection();this.compLinkType="page";this.compLinkEvent="";this.selectedItemObj=null;this.linktreeview=null;this.constructor=function(){$("#mfMultiLinkReset").on("click",thisClass.goBackHandler);$("#mfPickLinkBtn").on("click",thisClass.savePageLinkHandler);$("#mfRemoveLinkBtn2").on("click",thisClass.removeLinkHandler);$("#mfPickCompBtn2").on("click",thisClass.selectModeHandler);$("#mfPageURL2").on("keypress",function(e){if(e.which==13){e.stopPropagation();thisClass.savePageLinkHandler();}});$("#mfppage2").on("click",function(e){thisClass.currentLinkType="page";$(".mfLinkTypeCls2").hide();$("#mfLinkPageArea2").show();});$("#mfpweb2").on("click",function(e){thisClass.currentLinkType="web";$(".mfLinkTypeCls2").hide();$("#mfLinkWebArea2").show();});$("#mfpinternal2").on("click",function(e){thisClass.currentLinkType="internal";$(".mfLinkTypeCls2").hide();$("#mfLinkInternalArea2").show();});$("#mfEnableLinkingBtn").click(toggleSelection);function toggleSelection(e){var $this=$(this);if($this.is(":checked")){thisClass.component.e2xml.addPropSingle("pageSetLink",true,"default");}else{thisClass.component.e2xml.addPropSingle("pageSetLink",false,"default");}thisClass.linkUIToggle();}};this.selectModeHandler=function(){mf_main.editorController.enableSelectMode("internalmultilink");mf_main.closeDialog();};this.goBackHandler=function(e){$("#mfMultiLinkPickerDiv").show();$("#mfSelectMultiLinkDiv").hide();};this.linkUIToggle=function(){if(thisClass.component.pageSetLink){$("#mfMultiLinkListOver").hide();}else{$("#mfMultiLinkListOver").show();}};this.openPageLinkDialog=function(){$("#mfMultiLinkPickerDiv").show();$("#mfSelectMultiLinkDiv").hide();$("#mfPageURL2").val("");$("#mfInternalURL2").val("");if(thisClass.linktreeview){thisClass.linktreeview.destroy();}$("#mfPageLinkList2").empty();mf_main.editorController.disableShortcuts();var mapdata=MF_PagePool.getMap("mfMultiLinkTree");$("#mfPageLinkList2").empty();$("#mfPageLinkList2").jstree({core:{animation:0,themes:{dots:false},data:mapdata,worker:false,},plugins:["search"],search:{show_only_matches:true}}).on("dblclick",".jstree-anchor",function(e){thisClass.savePageLinkHandler(e);});thisClass.linktreeview=$("#mfPageLinkList2").jstree(true);thisClass.linktreeview.open_all();$("#mfPageLinkList2").on("search.jstree",function(nodes,str,res){if(str.nodes.length===0){thisClass.linktreeview.hide_all();}});thisClass.linkUIToggle();$("#mfEnableLinkingBtn").prop("checked",thisClass.component.pageSetLink);var values=thisClass.component.text;var arr=new Array();thisClass.linkCollection=new ArrayCollection();if(thisClass.component.HVALUES){arr=values.split(",");}else{arr=values.split("\n");if(arr.length==1){arr=values.split("\r");}}var count=0;if(thisClass.component.linkArray==null){thisClass.component.linkArray=new Object();}for(var k=0;k<arr.length;k++){var item=arr[k];var obj=new MF_MultiLinkObj();obj.item=item;obj.count=count;if(thisClass.component.linkArray[count]){var linkVal=thisClass.component.linkArray[count];obj.linkVal=linkVal;var larr=linkVal.split(":--:");obj.page=larr[2];var selpage=MF_PagePool.getPage(obj.page);if(selpage){obj.pageLabel=selpage.pageName;obj.isLinked=true;}else{if(obj.page){if(larr.length==3&&larr[1]=="web"){obj.pageLabel=larr[2];obj.isLinked=true;obj.url=larr[2];}else{if(larr.length==3&&larr[1]=="internal"){var urldisp2=larr[2];var arrm=urldisp2.split("|--::--|");var lname2="Internal";if(arrm.length==2){lname2="Internal:"+arrm[1];}obj.pageLabel=lname2;obj.isLinked=true;obj.url=larr[2];}else{obj.pageLabel="";}}}else{obj.pageLabel="";}}}thisClass.linkCollection.addItem(obj);count++;}thisClass.listItems();};this.getItemObj=function(count){for(var k=0;k<thisClass.linkCollection.size();k++){if(k==count){return thisClass.linkCollection.getItemAt(k);}}return null;};this.listItems=function(){var cachedTemplate=mf_main.getTemplateFromCache("mfMultiLinkItemTemplate");if(cachedTemplate==null){$.get("templates/editor/MultiLinkItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfMultiLinkItemTemplate").html());mf_main.addTemplateToCache("mfMultiLinkItemTemplate",template);thisClass.renderMultiLinkItem(template,thisClass.linkCollection.toArray());});}else{thisClass.renderMultiLinkItem(cachedTemplate,thisClass.linkCollection.toArray());}};this.renderMultiLinkItem=function(template,arr){$("#mfMultiLinkList").empty();for(var i=0,j=arr.length;i<j;i++){$("#mfMultiLinkList").append(template(arr[i]));}$(".mfMultiLinkBtnCls").on("click",thisClass.openLinkDialogHandler);$(".mfMultiLinkTrashBtnCls").on("click",thisClass.delLinkHandler);};this.openLinkDialogHandler=function(e){var itemObj=thisClass.getItemObj($(this).attr("data-itemcount"));if(itemObj){thisClass.selectedItemObj=itemObj;$("#mfMultiLinkPickerDiv").hide();$("#mfSelectMultiLinkDiv").show();if(thisClass.selectedItemObj&&thisClass.selectedItemObj.linkVal!=""){var parr=thisClass.selectedItemObj.linkVal.split(":--:");var type="page";if(parr.length>2){type=parr[1];}else{return;}$("#mfpweb2").prop("checked",false);$("#mfppage2").prop("checked",false);$("#mfpinternal2").prop("checked",false);if(type=="web"){thisClass.currentLinkType="web";$("#mfpweb2").prop("checked",true);$("#mfPageURL2").val(parr[2]);$(".mfLinkTypeCls2").hide();$("#mfLinkWebArea2").show();}else{if(type=="internal"){thisClass.currentLinkType="internal";$("#mfpinternal2").prop("checked",true);var urldisp=parr[2];var arr=urldisp.split("|--::--|");var lname=urldisp;if(arr.length==2){lname=arr[1];}$("#mfInternalURL2").val(lname);$(".mfLinkTypeCls2").hide();$("#mfLinkInternalArea2").show();}else{thisClass.currentLinkType="page";$("#mfppage2").prop("checked","checked");$(".mfLinkTypeCls2").hide();$("#mfLinkPageArea2").show();var pageTreeItem=thisClass.linktreeview.get_node("mfMultiLinkTree_"+parr[2]);if(pageTreeItem){thisClass.linktreeview.deselect_all(true);thisClass.linktreeview.select_node(pageTreeItem);}}}}else{thisClass.currentLinkType="page";$("#mfppage2").prop("checked",true);$(".mfLinkTypeCls2").hide();$("#mfLinkPageArea2").show();}}};this.delLinkHandler=function(e){e.stopImmediatePropagation();var itemObj=thisClass.getItemObj($(this).attr("data-itemcount"));if(itemObj){thisClass.delLink(itemObj);}};this.delLink=function(delobj){var newLinkArray=new Object();delobj.page=null;delobj.pageLabel=null;delobj.isLinked=false;delobj.url=null;for(var key in thisClass.component.linkArray){var num=parseInt(key);if(num!=delobj.count){newLinkArray[key]=thisClass.component.linkArray[key];}}thisClass.component.e2xml.addPropObject("linkArray",newLinkArray,"default");MF_ChangeManager.CHANGED(true);$("#mfMultiLinkPickerDiv").show();$("#mfSelectMultiLinkDiv").hide();thisClass.listItems();};this.removeLinkHandler=function(e){thisClass.delLink(thisClass.selectedItemObj);};this.savePageLinkHandler=function(e){var linklabel="";if(thisClass.currentLinkType=="page"){var selected=thisClass.linktreeview.get_selected();if(selected){var pageTreeItem=null;var item=thisClass.linktreeview.get_node(selected);if(item){var chkpage=MF_PagePool.getPage(item.original.pageid);if(chkpage.folder){MF_Utils.display_ActionIndicator("Cannot select folder");return;}linklabel="onclick:--:page:--:"+item.original.pageid;thisClass.selectedItemObj.page=item.original.pageid;thisClass.selectedItemObj.linkVal=linklabel;thisClass.selectedItemObj.pageLabel=item.text;thisClass.selectedItemObj.isLinked=true;}else{alert("No page selected");return;}}else{alert("No page selected");return;}}else{if(thisClass.currentLinkType=="internal"){var internalURL=$.trim($("#mfInternalURL2").val());if(internalURL==""){alert("Name cannot be empty");return;}if(thisClass.selectedItemObj&&thisClass.selectedItemObj.url){var urldisp=thisClass.selectedItemObj.url;var arr=urldisp.split("|--::--|");var newname=arr[0]+"|--::--|"+internalURL;thisClass.saveInternalLinkHandler(newname);}else{alert("Select component before saving");return;}}else{var webURL=$.trim($("#mfPageURL2").val());if(webURL==""){alert("Web URL cannot be empty");return;}linklabel="onclick:--:web:--:"+webURL;thisClass.selectedItemObj.linkVal=linklabel;thisClass.selectedItemObj.page=webURL;thisClass.selectedItemObj.pageLabel=webURL;thisClass.selectedItemObj.isLinked=true;thisClass.selectedItemObj.url=webURL;}}var newLinkArray=new Object();for(var key in thisClass.component.linkArray){newLinkArray[key]=thisClass.component.linkArray[key];}newLinkArray[thisClass.selectedItemObj.count]=thisClass.selectedItemObj.linkVal;thisClass.component.e2xml.addPropObject("linkArray",newLinkArray,"default");MF_ChangeManager.CHANGED(true);$("#mfMultiLinkPickerDiv").show();$("#mfSelectMultiLinkDiv").hide();thisClass.listItems();};this.getPageCount=function(eid){var count=0;for(var k=0;k<MF_PagePool.getPages().size();k++){var litem=MF_PagePool.getPages().getItemAt(k);if(!litem.master){count++;if(litem.eid==eid){return count;}}}return 0;};this.saveInternalLinkHandler=function(eid){if(thisClass.component){var linklabel="onclick:--:internal:--:"+eid;thisClass.selectedItemObj.linkVal=linklabel;thisClass.selectedItemObj.page=eid;var urldisp=eid;var arr=urldisp.split("|--::--|");var lname="Internal";if(arr.length==2){lname="Internal:"+arr[1];}thisClass.selectedItemObj.pageLabel=lname;thisClass.selectedItemObj.isLinked=true;thisClass.selectedItemObj.url=eid;}var newLinkArray=new Object();for(var key in thisClass.component.linkArray){newLinkArray[key]=thisClass.component.linkArray[key];}newLinkArray[thisClass.selectedItemObj.count]=thisClass.selectedItemObj.linkVal;thisClass.component.e2xml.addPropObject("linkArray",newLinkArray,"default");MF_ChangeManager.CHANGED(true);mf_main.editorController.enableShortcuts();MF_ComponentSettingUtils.setLinkType(thisClass.currentLinkID,thisClass.component);};this.resetDialog=function(){};}function MF_GridController(){var thisClass=this;this.meshSizeBox=null;this.column960SizeBox=null;this.gutter960SizeBox=null;this.dtype="";this.snapToGrid=false;this.snapPos=5;this.backgroundColor="#ffffff";this.backgroundColorGlobal="#ffffff";this.backgroundColorCurrent="#ffffff";this.snapPosBox=null;this.changedBackgroundColor=false;this.changedBackgroundColorCurrent=false;this.meshTypeDropdown=null;this.constructor=function(){$("#mfPageGridBtn").on("click",thisClass.openGridDialog);$("#mfgridnone").on("click",function(e){mf_main.editorController.grid=null;thisClass.handleGridTypeToggle(true);});$("#mfgridmesh").on("click",function(e){mf_main.editorController.grid=new MF_MeshGrid();thisClass.handleGridTypeToggle(true);});$("#mfgrid960").on("click",function(e){mf_main.editorController.grid=new MF_960Grid();thisClass.handleGridTypeToggle(true);});$("#mfSaveMeshGrid").on("click",thisClass.saveMesh);$("#mfResetMeshGrid").on("click",thisClass.resetMesh);$("#mfMeshSize").kendoNumericTextBox({format:"#",spinners:true,decimals:0});thisClass.meshSizeBox=$("#mfMeshSize").data("kendoNumericTextBox");var meshTypeArray=[{text:"Line",value:"line"},{text:"Dotted",value:"dotted"}];$("#mfMeshType").kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:meshTypeArray,change:function(){var mfSelectedMeshType=this.value();if(mfSelectedMeshType=="line"){$("#mfMeshTypeLinePreview").show();$("#mfMeshTypeDottedPreview").hide();if(mf_main.editorController.grid.meshType=="line"){$("#mfMeshLineColor").spectrum("set",mf_main.editorController.grid.lineColor);}else{$("#mfMeshLineColor").spectrum("set","#cccccc");}}else{if(mfSelectedMeshType=="dotted"){$("#mfMeshTypeLinePreview").hide();$("#mfMeshTypeDottedPreview").show();if(mf_main.editorController.grid.meshType=="dotted"){$("#mfMeshLineColor").spectrum("set",mf_main.editorController.grid.lineColor);}else{$("#mfMeshLineColor").spectrum("set","#757575");}}}}});thisClass.meshTypeDropdown=$("#mfMeshType").data("kendoDropDownList");$("#mfSave960Grid").on("click",thisClass.save960);$("#mfReset960Grid").on("click",thisClass.reset960);$("#mf960ColumnSize").kendoNumericTextBox({format:"#",spinners:true,decimals:0});thisClass.column960SizeBox=$("#mf960ColumnSize").data("kendoNumericTextBox");$("#mf960GutterSize").kendoNumericTextBox({format:"#",spinners:true,decimals:0});thisClass.gutter960SizeBox=$("#mf960GutterSize").data("kendoNumericTextBox");$("#mfSnapToGrid").on("click",function(){if($("#mfSnapToGrid").is(":checked")){$("#mfSnapToGridSize").data("kendoNumericTextBox").wrapper.show();thisClass.snapToGrid=true;mf_main.rtc.snapSync(thisClass.snapToGrid,thisClass.snapPos);}else{$("#mfSnapToGridSize").data("kendoNumericTextBox").wrapper.hide();thisClass.snapToGrid=false;mf_main.rtc.snapSync(thisClass.snapToGrid,thisClass.snapPos);}MF_ChangeManager.CHANGED(true);});$("#mfPageGlobalBackgroundTransparent").on("click",function(){if($("#mfPageGlobalBackgroundTransparent").is(":checked")){$("#mfPageGlobalBackgroundColorWrapper").hide();thisClass.backgroundColorGlobal="transparent";thisClass.changedBackgroundColor=true;}else{$("#mfPageGlobalBackgroundColorWrapper").show();thisClass.backgroundColorGlobal="#ffffff";$("#mfPageGlobalBackgroundColor").spectrum("set","#ffffff");thisClass.changedBackgroundColor=true;}MF_ChangeManager.CHANGED(true);});$("#mfPageCurrentBackgroundTransparent").on("click",function(){if($("#mfPageCurrentBackgroundTransparent").is(":checked")){$("#mfPageCurrentBackgroundColorWrapper").hide();thisClass.backgroundColorCurrent="transparent";}else{$("#mfPageCurrentBackgroundColorWrapper").show();thisClass.backgroundColorCurrent="#ffffff";$("#mfPageCurrentBackgroundColor").spectrum("set","#ffffff");}MF_ChangeManager.CHANGED(true);});$("#mfSnapToGridSize").kendoNumericTextBox({format:"#",spinners:true,decimals:0,spin:thisClass.onSnapPosChange});$("#mfSnapToGridSize").data("kendoNumericTextBox").wrapper.hide();thisClass.snapPosBox=$("#mfSnapToGridSize").data("kendoNumericTextBox");};this.onSnapPosChange=function(){if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}thisClass.snapPos=this.value();mf_main.rtc.snapSync(thisClass.snapToGrid,thisClass.snapPos);MF_ChangeManager.CHANGED(true);};this.handleGridTypeToggle=function(chosen){$(".mfGridSettingsCls").hide();$("#mfMeshLineColor").spectrum("destroy");$("#mf960ColumnColor").spectrum("destroy");$("#mfMeshLineColor").spectrum({showInput:true,preferredFormat:"hex6",showPalette:true,showSelectionPalette:true,palette:[MF_ComponentUtils.commonPallete()]});$("#mf960ColumnColor").spectrum({showInput:true,preferredFormat:"hex6",showPalette:true,showSelectionPalette:true,palette:[MF_ComponentUtils.commonPallete()]});$("#mfgridnone").prop("checked",false);$("#mfgridmesh").prop("checked",false);$("#mfgrid960").prop("checked",false);if(mf_main.editorController.grid==null){mf_main.editorController.grid=null;$("#mfGrid").remove();$("#mfGridSettingsNone").show();$("#mfgridnone").prop("checked",true);if(chosen){mf_main.editorController.saveTree();mf_main.rtc.gridSync(mf_main.editorController.grid);}}else{if(mf_main.editorController.grid.type=="mesh"){$("#mfGridSettingsMesh").show();$("#mfgridmesh").prop("checked",true);$("#mfMeshLineColor").spectrum("set",mf_main.editorController.grid.lineColor);if(mf_main.editorController.grid.size==""||mf_main.editorController.grid.size==null||isNaN(mf_main.editorController.grid.size)){mf_main.editorController.grid.size=20;}thisClass.meshSizeBox.value(mf_main.editorController.grid.size);$("#mfMeshShowInViewer").prop("checked",mf_main.editorController.grid.showInViewer);if(mf_main.editorController.grid.position=="over"){$("#mfMeshShowOver").prop("checked",true);}else{$("#mfMeshShowOver").prop("checked",false);}if(mf_main.editorController.grid.meshType){thisClass.meshTypeDropdown.value(mf_main.editorController.grid.meshType);thisClass.meshTypeDropdown.trigger("change");}if(chosen){thisClass.saveMesh(true);}}else{if(mf_main.editorController.grid.type=="960"){$("#mfGridSettings960").show();$("#mfgrid960").prop("checked","checked");$("#mf960ColumnColor").spectrum("set",mf_main.editorController.grid.columnColor);if(mf_main.editorController.grid.columnSize==""||mf_main.editorController.grid.columnSize==null||isNaN(mf_main.editorController.grid.columnSize)){mf_main.editorController.grid.columnSize=60;}if(mf_main.editorController.grid.gutterSize==""||mf_main.editorController.grid.gutterSize==null||isNaN(mf_main.editorController.grid.gutterSize)){mf_main.editorController.grid.gutterSize=20;}thisClass.column960SizeBox.value(mf_main.editorController.grid.columnSize);thisClass.gutter960SizeBox.value(mf_main.editorController.grid.gutterSize);$("#mf960ShowInViewer").prop("checked",mf_main.editorController.grid.showInViewer);if(mf_main.editorController.grid.position=="over"){$("#mf960ShowOver").prop("checked",true);}else{$("#mf960ShowOver").prop("checked",false);}if(chosen){thisClass.save960(true);}}}}};this.saveMesh=function(noclose){var meshObj=new MF_MeshGrid();meshObj.lineColor=$("#mfMeshLineColor").spectrum("get").toHexString();if($("#mfMeshShowInViewer").is(":checked")){meshObj.showInViewer=true;}else{meshObj.showInViewer=false;}if($("#mfMeshShowOver").is(":checked")){meshObj.position="over";}else{meshObj.position="behind";}meshObj.size=thisClass.meshSizeBox.value();meshObj.meshType=thisClass.meshTypeDropdown.value();if(meshObj.size==""||meshObj.size==null||isNaN(meshObj.size)){meshObj.size=20;}mf_main.editorController.grid=meshObj;mf_main.editorController.grid.setGrid();mf_main.editorController.saveTree();if(noclose!=true){mf_main.closeDialog();}mf_main.rtc.gridSync(mf_main.editorController.grid);};this.setXML=function(xmlobj){var snapVal=xmlobj.attr("snapToGrid");if(snapVal=="true"){thisClass.snapToGrid=true;}else{thisClass.snapToGrid=false;}if(mf_main.DESIGNMODE){var dtype=xmlobj.attr("dtype");thisClass.dtype=dtype;}thisClass.snapPos=parseInt(xmlobj.attr("snapPos"));if(thisClass.snapPos==""||thisClass.snapPos==null||isNaN(thisClass.snapPos)){thisClass.snapPos=5;}thisClass.backgroundColor=xmlobj.attr("backgroundColor");thisClass.backgroundColorGlobal=xmlobj.attr("backgroundColor");};this.getXML=function(){var xml="<pageCommon ";if(thisClass.snapToGrid){xml=xml+" snapToGrid='true' ";}else{xml=xml+" snapToGrid='false' ";}if(mf_main.DESIGNMODE){xml=xml+" dtype='"+thisClass.dtype+"' ";}if(thisClass.snapPos==""||thisClass.snapPos==null||isNaN(thisClass.snapPos)){thisClass.snapPos=5;}xml=xml+" snapPos='"+thisClass.snapPos+"' ";xml=xml+" backgroundColor='"+thisClass.backgroundColor+"' ";xml=xml+" ></pageCommon>";return xml;};this.resetMesh=function(){var meshObj=new MF_MeshGrid();mf_main.editorController.grid=meshObj;mf_main.editorController.grid.setGrid();mf_main.editorController.saveTree();thisClass.handleGridTypeToggle();mf_main.rtc.gridSync(mf_main.editorController.grid);};this.save960=function(noclose){var grid960Obj=new MF_960Grid();grid960Obj.columnColor=$("#mf960ColumnColor").spectrum("get").toHexString();if($("#mf960ShowInViewer").is(":checked")){grid960Obj.showInViewer=true;}else{grid960Obj.showInViewer=false;}if($("#mf960ShowOver").is(":checked")){grid960Obj.position="over";}else{grid960Obj.position="behind";}grid960Obj.columnSize=thisClass.column960SizeBox.value();grid960Obj.gutterSize=thisClass.gutter960SizeBox.value();if(grid960Obj.columnSize==""||grid960Obj.columnSize==null||isNaN(grid960Obj.columnSize)){grid960Obj.columnSize=60;}if(grid960Obj.gutterSize==""||grid960Obj.gutterSize==null||isNaN(grid960Obj.gutterSize)){grid960Obj.gutterSize=20;}mf_main.editorController.grid=grid960Obj;mf_main.editorController.grid.setGrid();mf_main.editorController.saveTree();if(noclose!=true){mf_main.closeDialog();}mf_main.rtc.gridSync(mf_main.editorController.grid);};this.reset960=function(){var meshObj=new MF_960Grid();mf_main.editorController.grid=meshObj;mf_main.editorController.grid.setGrid();mf_main.editorController.saveTree();thisClass.handleGridTypeToggle();mf_main.rtc.gridSync(mf_main.editorController.grid);};this.initBackgroundSettings=function(){thisClass.backgroundColorCurrent=mf_main.editorController.page.backgroundColor;$("#mfPageGlobalBackgroundColor").spectrum("destroy");$("#mfPageGlobalBackgroundColor").spectrum({showInput:true,preferredFormat:"hex6",showPalette:true,showSelectionPalette:true,change:function(color){color=MF_Utils.RGBToHex(color.toRgbString());thisClass.backgroundColorGlobal=color;thisClass.changedBackgroundColor=true;},palette:[MF_ComponentUtils.commonPallete()]});if(thisClass.backgroundColorGlobal!="transparent"&&thisClass.backgroundColorGlobal!=null){$("#mfPageGlobalBackgroundColor").spectrum("set",thisClass.backgroundColorGlobal);}else{$("#mfPageGlobalBackgroundColor").spectrum("set","#ffffff");}if(thisClass.backgroundColorGlobal=="transparent"){$("#mfPageGlobalBackgroundTransparent").prop("checked",true);$("#mfPageGlobalBackgroundColorWrapper").hide();}else{$("#mfPageGlobalBackgroundTransparent").prop("checked",false);$("#mfPageGlobalBackgroundColorWrapper").show();}$("#mfPageCurrentBackgroundColor").spectrum("destroy");$("#mfPageCurrentBackgroundColor").spectrum({showInput:true,preferredFormat:"hex6",showPalette:true,showSelectionPalette:true,change:function(color){color=MF_Utils.RGBToHex(color.toRgbString());thisClass.backgroundColorCurrent=color;},palette:[MF_ComponentUtils.commonPallete()]});if(thisClass.backgroundColorCurrent!="transparent"&&thisClass.backgroundColorCurrent!=null){$("#mfPageCurrentBackgroundColor").spectrum("set",thisClass.backgroundColorCurrent);}else{$("#mfPageCurrentBackgroundColor").spectrum("set","#ffffff");}if(thisClass.backgroundColorCurrent=="transparent"){$("#mfPageCurrentBackgroundTransparent").prop("checked",true);$("#mfPageCurrentBackgroundColorWrapper").hide();}else{$("#mfPageCurrentBackgroundTransparent").prop("checked",false);$("#mfPageCurrentBackgroundColorWrapper").show();}};this.openGridDialog=function(){mf_main.editorController.disableShortcuts();thisClass.handleGridTypeToggle();thisClass.snapPosBox.value(thisClass.snapPos);if(thisClass.snapToGrid){$("#mfSnapToGrid").prop("checked",true);$("#mfSnapToGridSize").data("kendoNumericTextBox").wrapper.show();}else{$("#mfSnapToGrid").prop("checked",false);$("#mfSnapToGridSize").data("kendoNumericTextBox").wrapper.hide();}$("#mfGridSettingsModal").modal();};}function MF_IconAssignController(){var thisClass=this;this.component=null;this.currentIconID=null;this.settingsObj=null;this.iconCollection=new ArrayCollection();this.multiIcon=true;this.iconListed=false;this.selectedItemObj=null;this.constructor=function(){$("#mfAssignIconGoBack").on("click",thisClass.goBackHandler);$("#mfFontAwesomeCategory1").change(function(e){var category=$(this).val();$("#mfAssignIcons .mfIconCategory").hide();$("#mfIconListSearchBox1").val("");if(category=="all"){$("#mfAssignIconListing .page-header").show();$("#mfAssignIcons .mfIconCategory").show();$("#mfAssignIcons .mfIconCategory").css({position:"static"});}else{$("#"+category).show();$(".mfAssignIconItemCls").css("display","block");$("#mfAssignIconListing .page-header").hide();}if($("#mfFontAwesomeCategory1").val()=="all"){$("#mfAssignIconListing h4").css("display","block");$("#mfAssignIcons .mfIconCategory, #mfAssignIcons .mfIconList").css("display","inline-block");}else{$("#mfAssignIconListing h4").css("display","none");}});$("#mfIconListSearchBox1").on("textchange",thisClass.searchIconHandler);};this.goBackHandler=function(e){$("#mfMultiIconPickerDiv").show();$("#mfSelectMultiIconDiv").hide();};this.searchIconHandler=function(e){$("#mfFontAwesomeCategory1").val("all");$("#mfAssignIconListing .page-header").show();$("#mfAssignIcons .mfIconCategory").show();$("#mfAssignIcons .mfIconCategory").css({position:"static"});var searchval=$("#mfIconListSearchBox1").val().toLowerCase().trim();var fontArray=mf_main.editorController.fontController.icons;var searchBoxText=$("#mfIconListSearchBox1").val();if(searchBoxText==""&&$("#mfFontAwesomeCategory1").val()=="all"){$("#mfAssignIconListing h4").css("display","block");$("#mfAssignIcons .mfIconCategory, #mfAssignIcons .mfIconList").css("display","inline-block");}else{$("#mfAssignIconListing h4").css("display","none");$("#mfAssignIcons .mfIconCategory, #mfAssignIcons .mfIconList").css("display","inline");}$(".mfAssignIconItemCls").css("display","none");$("#mfAssignIconListing .mfIconCategory").css("margin-bottom","0px");for(var i=0;i<fontArray.length;i++){var item=fontArray[i];if(item.toLowerCase().indexOf(searchval)>=0){if(searchBoxText!=""&&$("#mfFontAwesomeCategory1").val()=="all"){$("#mfAssignIconItem"+item).show();}else{$(".mfAssignIconItemCls[data-className="+item+"]").show();}}}};this.listIcons=function(){if(thisClass.iconListed==false){$("#mfAssignIconListing .mfIconCategory h4").hide();thisClass.iconListed=true;var cachedIconModalTemplate=mf_main.getTemplateFromCache("AssignIconItems");if(cachedIconModalTemplate==null){$.get("templates/editor/AssignIconItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfAssignIconTemplate").html());mf_main.addTemplateToCache("AssignIconItems",template);thisClass.renderIconItems(template);});}else{thisClass.renderIconItems(cachedIconModalTemplate);}}};this.renderIconItems=function(template){var i=0;$("#mfAssignIconList").empty();var htmldom="";var len=mf_main.editorController.fontController.fontAwesomeWebIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeWebIcons[i]);}$("#mfFontAwesomeWeb1 .mfIconList").append(htmldom);htmldom="";len=mf_main.editorController.fontController.fontAwesomeTransportIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeTransportIcons[i]);}$("#mfFontAwesomeTransportation1 .mfIconList").append(htmldom);htmldom="";len=mf_main.editorController.fontController.fontAwesomeGenderIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeGenderIcons[i]);}$("#mfFontAwesomeGender1 .mfIconList").append(htmldom);htmldom="";len=mf_main.editorController.fontController.fontAwesomeFileTypeIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeFileTypeIcons[i]);}$("#mfFontAwesomeFileType1 .mfIconList").append(htmldom);htmldom="";len=mf_main.editorController.fontController.fontAwesomeFormControlIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeFormControlIcons[i]);}$("#mfFontAwesomeFormControl1 .mfIconList").append(htmldom);htmldom="";len=mf_main.editorController.fontController.fontAwesomeChartIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeChartIcons[i]);}$("#mfFontAwesomeChart1 .mfIconList").append(htmldom);htmldom="";len=mf_main.editorController.fontController.fontAwesomeCurrencyIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeCurrencyIcons[i]);}$("#mfFontAwesomeCurrency1 .mfIconList").append(htmldom);htmldom="";len=mf_main.editorController.fontController.fontAwesomeTextEditorIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeTextEditorIcons[i]);}$("#mfFontAwesomeTextEditor1 .mfIconList").append(htmldom);htmldom="";len=mf_main.editorController.fontController.fontAwesomeDirectionalIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeDirectionalIcons[i]);}$("#mfFontAwesomeDirectional1 .mfIconList").append(htmldom);htmldom="";len=mf_main.editorController.fontController.fontAwesomeBrandIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeBrandIcons[i]);}$("#mfFontAwesomeBrand1 .mfIconList").append(htmldom);htmldom="";len=mf_main.editorController.fontController.fontAwesomeMedicalIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeMedicalIcons[i]);}$("#mfFontAwesomeMedical1 .mfIconList").append(htmldom);htmldom="";len=mf_main.editorController.fontController.fontAwesomeVideoPlayerIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeVideoPlayerIcons[i]);}$("#mfFontAwesomeVideoPlayers1 .mfIconList").append(htmldom);$(".mfAssignIconItemCls").each(function(){var title=$(this).attr("data-title");title=title.replace("fa-","");title=title.replace("ico-","");title=title.replace(/_/gi," ");$(this).attr("title",title);});$(".mfAssignIconItemCls").tooltip({animation:false});$("#mfAssignIconListing .mfIconCategory h4").show();$(".mfAssignIcon").on("click",function(event){event.stopImmediatePropagation();var iconcls=$(this).data("icon");if(thisClass.multiIcon){if(thisClass.selectedItemObj){thisClass.selectedItemObj.iconCls=iconcls;thisClass.selectedItemObj.isIcon=true;var newIconArray=new Object();for(var key in thisClass.component.iconArray){newIconArray[key]=thisClass.component.iconArray[key];}newIconArray[thisClass.selectedItemObj.count]=thisClass.selectedItemObj.iconCls;}thisClass.component.e2xml.addPropObject("iconArray",newIconArray,"default");thisClass.component.render(false);MF_ChangeManager.CHANGED(true);$("#mfMultiIconPickerDiv").show();$("#mfSelectMultiIconDiv").hide();thisClass.listItems();}else{if(thisClass.component.NAME=="MF_AdvancedDataGrid"){thisClass.component.updateSettings("icon",iconcls);thisClass.settingsObj.setIcon(iconcls);}else{thisClass.component.e2xml.addPropSingle("icon",iconcls);thisClass.settingsObj.setIcon();}thisClass.component.render(false);mf_main.closeDialog();MF_ChangeManager.CHANGED(true);}});};this.openPageIconDialog=function(){thisClass.multiIcon=true;$("#mfAssignIconGoBack").show();$("#mfMultiIconPickerDiv").show();$("#mfSelectMultiIconDiv").hide();thisClass.listIcons();mf_main.editorController.disableShortcuts();var values=thisClass.component.text;var arr=new Array();thisClass.iconCollection=new ArrayCollection();if(thisClass.component.HVALUES){arr=values.split(",");}else{arr=values.split("\n");if(arr.length==1){arr=values.split("\r");}}var count=0;if(thisClass.component.iconArray==null){thisClass.component.iconArray=new Object();}for(var k=0;k<arr.length;k++){var item=arr[k];var obj=new MF_MultiIconObj();obj.item=item;obj.count=count;if(thisClass.component.iconArray[count]){var iconVal=thisClass.component.iconArray[count];obj.iconCls=iconVal;obj.isIcon=true;}thisClass.iconCollection.addItem(obj);count++;}thisClass.listItems();};this.openSingleIconDialog=function(){thisClass.multiIcon=false;$("#mfAssignIconGoBack").hide();$("#mfMultiIconPickerDiv").hide();$("#mfSelectMultiIconDiv").show();thisClass.listIcons();mf_main.editorController.disableShortcuts();};this.getItemObj=function(count){for(var k=0;k<thisClass.iconCollection.size();k++){if(k==count){return thisClass.iconCollection.getItemAt(k);}}return null;};this.listItems=function(){var cachedTemplate=mf_main.getTemplateFromCache("mfMultiIconItemTemplate");if(cachedTemplate==null){$.get("templates/editor/MultiIconItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfMultiIconItemTemplate").html());mf_main.addTemplateToCache("mfMultiIconItemTemplate",template);thisClass.renderMultiIconItem(template,thisClass.iconCollection.toArray());});}else{thisClass.renderMultiIconItem(cachedTemplate,thisClass.iconCollection.toArray());}};this.renderMultiIconItem=function(template,arr){$("#mfMultiIconList").empty();for(var i=0,j=arr.length;i<j;i++){$("#mfMultiIconList").append(template(arr[i]));}$(".mfMultiIconBtnCls").on("click",thisClass.openIconDialogHandler);$(".mfMultiIconTrashBtnCls").on("click",thisClass.delIconHandler);};this.openIconDialogHandler=function(e){var itemObj=thisClass.getItemObj($(this).attr("data-itemcount"));if(itemObj){thisClass.selectedItemObj=itemObj;$("#mfMultiIconPickerDiv").hide();$("#mfSelectMultiIconDiv").show();}};this.delIconHandler=function(e){e.stopImmediatePropagation();var itemObj=thisClass.getItemObj($(this).attr("data-itemcount"));if(itemObj){thisClass.delIcon(itemObj);}};this.delIcon=function(delobj){var newIconArray=new Object();delobj.iconCls="";delobj.isIcon=false;for(var key in thisClass.component.iconArray){var num=parseInt(key);if(num!=delobj.count){newIconArray[key]=thisClass.component.iconArray[key];}}thisClass.component.e2xml.addPropObject("iconArray",newIconArray,"default");thisClass.component.render(false);MF_ChangeManager.CHANGED(true);$("#mfMultiIconPickerDiv").show();$("#mfSelectMultiIconDiv").hide();thisClass.listItems();};this.removeIconHandler=function(e){thisClass.delIcon(thisClass.selectedItemObj);};}function MF_DrawController(){var thisClass=this;this.lineThickness=2;this.lineColor="#ff0000";this.DRAWMODE=false;this.drawing=null;this.corX=new Array();this.corY=new Array();this.isLineSelectionOpen=false;this.SCALE=1;this.eraseMode=false;this.drawOpacity=1;this.lineThicknessBox=null;this.STRAIGHT=false;this.RESTRICTED=false;this.drawEnable=false;this.CHANGED=false;this.constructor=function(){thisClass.createUI();};this.toggleDrawMode=function(){if(thisClass.DRAWMODE){thisClass.hideDrawMode();mf_main.editorController.clearSelection(true);}else{thisClass.showDrawMode();}};this.showDrawMode=function(){if($("#mfBackgroundPage").width()<5000&&$("#mfBackgroundPage").height()<5000){thisClass.RESTRICTED=false;}else{thisClass.RESTRICTED=true;}if(thisClass.RESTRICTED){if(mf_main.editorController.SCALE!=1){MF_Utils.display_ActionIndicator("Zoom is disabled while drawing in large pages");}mf_main.editorController.viewFullSize();}thisClass.CHANGED=false;thisClass.disableDrawing();mf_main.editorController.closeAllSettings();mf_main.editorController.clearSelection(true);mf_main.editorController.resetNavBar();thisClass.DRAWMODE=true;thisClass.enableDrawing();$("#mfContentDraw").show();mf_main.interfaceResize();$("#mfDrawLineColor").spectrum("destroy");$("#mfDrawLineColor").spectrum({showInput:true,preferredFormat:"hex6",showPalette:true,color:"#ff0000",showSelectionPalette:true,palette:[MF_ComponentUtils.commonPallete()],show:function(color){mf_main.editorController.shortcutsFlag=false;},hide:function(color){mf_main.editorController.shortcutsFlag=true;},change:function(color){color=MF_Utils.RGBToHex(color.toRgbString());thisClass.lineColor=color;thisClass.changeDrawingProperties();}});$("#mfDrawLineColor").spectrum("set",thisClass.lineColor);};this.hideDrawMode=function(){if(thisClass.DRAWMODE){thisClass.saveUserDrawing();thisClass.DRAWMODE=false;$("#mfContentDraw").hide();thisClass.disableDrawing();}};this.createUI=function(){thisClass.DRAWMODE=false;$(".mfDrawBarCloseCls").on("click",function(){thisClass.saveUserDrawing();thisClass.hideDrawMode();mf_main.editorController.clearSelection(true);});$("#mfDrawStraightLineBtn").prop("checked",thisClass.STRAIGHT);$("#mfDrawStraightLineBtn").click(toggleStraighLine);function toggleStraighLine(e){var $this=$(this);if($this.is(":checked")){thisClass.STRAIGHT=true;}else{thisClass.STRAIGHT=false;}}$("#mfDrawLineThickness").kendoNumericTextBox({format:"#",spinners:true,change:onWidthChange,spin:onWidthChange,decimals:0,min:1,max:40});function onWidthChange(){if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}var w=this.value();thisClass.lineThickness=w;thisClass.changeDrawingProperties();}thisClass.lineThicknessBox=$("#mfDrawLineThickness").data("kendoNumericTextBox");thisClass.lineThicknessBox.value(thisClass.lineThickness);$("#mfDrawLineEraser,#mfDrawLineOpacity").removeClass("selected");$("#mfDrawLineEraser").on("click",function(){$("#mfDrawLineOpacity").removeClass("selected");thisClass.drawOpacity=1;if($(this).hasClass("selected")){thisClass.eraseMode=false;$(this).removeClass("selected");}else{thisClass.eraseMode=true;$(this).addClass("selected");}});$("#mfDrawLineOpacity").on("click",function(){$("#mfDrawLineEraser").removeClass("selected");thisClass.eraseMode=false;if($(this).hasClass("selected")){$(this).removeClass("selected");thisClass.drawOpacity=1;}else{thisClass.drawOpacity=0.5;$(this).addClass("selected");}});};this.disableDrawing=function(){$("#mfFreeDrawingCanvas,#tmp_canvas,#sketch").remove();$("#mfProxyCanvas").remove();};this.enableDrawing=function(){var mfCanvas=$("#mfBackgroundPage");thisClass.createDrawingCanvas();var track=0;var canvas=document.querySelector("#mfFreeDrawingCanvas");var ctx=canvas.getContext("2d");var sketch=document.querySelector("#sketch");var sketch_style=getComputedStyle(sketch);if(thisClass.RESTRICTED){var vwidth=$(window).width()+500;var vheight=$(window).height()+500;$("#sketch").width(vwidth);$("#sketch").height(vheight);$("#sketch").css({position:"absolute",top:$("#mfEditorHolder").scrollTop(),left:$("#mfEditorHolder").scrollLeft()});canvas.width=vwidth;canvas.height=vheight;}else{$("#sketch").width("100%");$("#sketch").height("100%");$("#sketch").css({position:"absolute",top:0,left:0});canvas.width=mfCanvas.width();canvas.height=mfCanvas.height();}var tmp_canvas=document.createElement("canvas");var tmp_ctx=tmp_canvas.getContext("2d");tmp_canvas.id="tmp_canvas";tmp_canvas.width=canvas.width;tmp_canvas.height=canvas.height;sketch.appendChild(tmp_canvas);$("#tmp_canvas").addClass("mfDrawModeCanvas");var mouse={x:0,y:0};var last_mouse={x:0,y:0};var orig_mouse={x:0,y:0};var ppts=[];if(thisClass.RESTRICTED){$("#mfEditorHolder").css("cursor","default");$("#mfEditorHolder").css("overflow","hidden");$("#mfEditorHolder").css("overflow-x","hidden");$("#mfEditorHolder").css("overflow-y","hidden");}tmp_canvas.addEventListener("mousemove",function(e){if(thisClass.drawEnable){last_mouse.x=mouse.x;last_mouse.y=mouse.y;var offx=0;var offy=0;if(thisClass.RESTRICTED){offx=$("#mfEditorHolder").scrollLeft();offy=$("#mfEditorHolder").scrollTop();}mouse.x=(e.pageX-$("#mfContainerPage").offset().left)/thisClass.SCALE-offx;mouse.y=(e.pageY-$("#mfContainerPage").offset().top)/thisClass.SCALE-offy;if(mouse.x<0){mouse.x=0;}if(mouse.y<0){mouse.y=0;}if(track==1){thisClass.corX.push(mouse.x);thisClass.corY.push(mouse.y);}}},false);tmp_ctx.lineWidth=5;tmp_ctx.lineJoin="round";tmp_ctx.lineCap="round";tmp_ctx.strokeStyle=MF_ComponentUtils.hexToRGB(thisClass.lineColor,thisClass.drawOpacity);tmp_canvas.addEventListener("mousedown",function(e){e.stopImmediatePropagation();thisClass.drawEnable=true;ctx.drawImage(tmp_canvas,0,0);tmp_ctx.clearRect(0,0,tmp_canvas.width,tmp_canvas.height);track=0;ppts=[];if(thisClass.eraseMode){tmp_canvas.addEventListener("mousemove",onErase,false);}else{tmp_canvas.addEventListener("mousemove",onPaint,false);}var offx=0;var offy=0;if(thisClass.RESTRICTED){offx=$("#mfEditorHolder").scrollLeft();offy=$("#mfEditorHolder").scrollTop();}last_mouse.x=mouse.x-offx;last_mouse.y=mouse.y-offy;mouse.x=(e.pageX-$("#mfContainerPage").offset().left)/thisClass.SCALE-offx;mouse.y=(e.pageY-$("#mfContainerPage").offset().top)/thisClass.SCALE-offy;if(mouse.x<0){mouse.x=0;}if(mouse.y<0){mouse.y=0;}if(thisClass.STRAIGHT&&!thisClass.eraseMode){orig_mouse.x=mouse.x;orig_mouse.y=mouse.y;}if(track==1){thisClass.corX.push(mouse.x);thisClass.corY.push(mouse.y);}ppts.push({x:mouse.x,y:mouse.y});track=1;onPaint();},false);tmp_canvas.addEventListener("mouseup",function(e){e.stopImmediatePropagation();thisClass.drawEnable=false;if(thisClass.eraseMode){tmp_canvas.removeEventListener("mousemove",onErase,false);}else{tmp_canvas.removeEventListener("mousemove",onPaint,false);}ctx.drawImage(tmp_canvas,0,0);tmp_ctx.clearRect(0,0,tmp_canvas.width,tmp_canvas.height);track=0;ppts=[];},false);var onPaint=function(){thisClass.CHANGED=true;if(thisClass.STRAIGHT&&!thisClass.eraseMode){tmp_ctx.clearRect(0,0,tmp_canvas.width,tmp_canvas.height);tmp_ctx.globalCompositeOperation="source-over";ctx.globalCompositeOperation="source-over";tmp_ctx.lineWidth=thisClass.lineThickness;tmp_ctx.strokeStyle=MF_ComponentUtils.hexToRGB(thisClass.lineColor,thisClass.drawOpacity);tmp_ctx.beginPath();tmp_ctx.moveTo(orig_mouse.x,orig_mouse.y);tmp_ctx.lineTo(mouse.x,mouse.y);tmp_ctx.stroke();}else{ppts.push({x:mouse.x,y:mouse.y});if(ppts.length<3){var b=ppts[0];tmp_ctx.beginPath();tmp_ctx.fill();tmp_ctx.closePath();return;}tmp_ctx.clearRect(0,0,tmp_canvas.width,tmp_canvas.height);tmp_ctx.globalCompositeOperation="source-over";ctx.globalCompositeOperation="source-over";tmp_ctx.lineWidth=thisClass.lineThickness;tmp_ctx.strokeStyle=MF_ComponentUtils.hexToRGB(thisClass.lineColor,thisClass.drawOpacity);tmp_ctx.beginPath();tmp_ctx.beginPath();tmp_ctx.moveTo(ppts[0].x,ppts[0].y);for(var i=1;i<ppts.length-2;i++){var c=(ppts[i].x+ppts[i+1].x)/2;var d=(ppts[i].y+ppts[i+1].y)/2;tmp_ctx.quadraticCurveTo(ppts[i].x,ppts[i].y,c,d);}tmp_ctx.quadraticCurveTo(ppts[i].x,ppts[i].y,ppts[i+1].x,ppts[i+1].y);tmp_ctx.stroke();}};var onErase=function(){ctx.globalCompositeOperation="destination-out";ctx.fillStyle="rgba(0,0,0,1)";ctx.strokeStyle="rgba(0,0,0,1)";ctx.lineWidth=thisClass.lineThickness;ctx.beginPath();ctx.moveTo(last_mouse.x,last_mouse.y);ctx.lineTo(mouse.x,mouse.y);ctx.closePath();ctx.stroke();};};this.stopDrawing=function(){thisClass.drawEnable=false;};this.changeDrawingProperties=function(){var canvas=document.querySelector("#mfFreeDrawingCanvas");var ctx=canvas.getContext("2d");ctx.lineWidth=thisClass.lineThickness;ctx.lineJoin="round";ctx.lineCap="round";ctx.strokeStyle=thisClass.lineColor;var proxyCanvas=document.querySelector("#mfProxyCanvas");var proxyCtx=proxyCanvas.getContext("2d");proxyCtx.lineWidth=thisClass.lineThickness;proxyCtx.lineJoin="round";proxyCtx.lineCap="round";proxyCtx.strokeStyle=thisClass.lineColor;};this.createNewDrawComponent=function(canvas,x,y){var drawnComponent=new MF_Draw();drawnComponent.dataUrl=canvas.toDataURL();drawnComponent.width=canvas.width;drawnComponent.height=canvas.height;thisClass.drawing={component:drawnComponent,x:x,y:y};};this.saveUserDrawing=function(){if(thisClass.DRAWMODE&&thisClass.CHANGED){thisClass.createComponent();thisClass.drawComponent();thisClass.drawOpacity=1;thisClass.eraseMode=false;thisClass.disableDrawing();if($("#mfDrawLineEraser").hasClass("selected")){thisClass.eraseMode=true;}if($("#mfDrawLineOpacity").hasClass("selected")){thisClass.drawOpacity=0.5;}MF_ChangeManager.CHANGED(true);}};this.drawComponent=function(){if(thisClass.drawing){var drawnComponent=thisClass.drawing.component;var x=thisClass.drawing.x,y=thisClass.drawing.y;mf_main.editorController.loadNewComponent(drawnComponent,x+(drawnComponent.width/2),y+(drawnComponent.height/2));}thisClass.drawing=null;};this.createComponent=function(){var corX=thisClass.corX;var corY=thisClass.corY;var sX=Math.min.apply(Math,corX)-thisClass.lineThickness;var gX=Math.max.apply(Math,corX)+thisClass.lineThickness;var sY=Math.min.apply(Math,corY)-thisClass.lineThickness;var gY=Math.max.apply(Math,corY)+thisClass.lineThickness;var canvas=document.querySelector("#mfFreeDrawingCanvas");if(canvas&&(thisClass.corX.length>0&&thisClass.corY.length>0)){var ctx=canvas.getContext("2d");var data=ctx.getImageData(sX,sY,gX-sX,gY-sY);var proxyCanvas=document.querySelector("#mfProxyCanvas");var proxyCtx=proxyCanvas.getContext("2d");proxyCtx.lineWidth=thisClass.lineThickness;proxyCtx.lineJoin="round";proxyCtx.lineCap="round";proxyCtx.strokeStyle=thisClass.lineColor;proxyCanvas.width=(gX-sX);proxyCanvas.height=(gY-sY);proxyCtx.putImageData(data,0,0);if(thisClass.RESTRICTED){thisClass.createNewDrawComponent(proxyCanvas,sX+$("#mfEditorHolder").scrollLeft(),sY+$("#mfEditorHolder").scrollTop());}else{thisClass.createNewDrawComponent(proxyCanvas,sX,sY);}proxyCtx.clearRect(0,0,proxyCanvas.width,proxyCanvas.height);thisClass.corX.length=0;thisClass.corY.length=0;}};this.handleErase=function(){};this.createDrawingCanvas=function(){if(thisClass.DRAWMODE&&$("#mfFreeDrawingCanvas").length==0){var freeDrawingCanvas='<div id="sketch"  style="position: absolute;display: block; left: 0px; top: 0px; width:100%; height:100%;z-index:9999; visibility: visible;"><canvas class="mfDrawModeCanvas" id="mfFreeDrawingCanvas"></canvas></div>';var proxyCanvas='<canvas id="mfProxyCanvas" style="display:none;"></canvas>';$("#mfBackgroundPage").append(freeDrawingCanvas).append(proxyCanvas);}thisClass.SCALE=mf_main.editorController.SCALE;};}function MF_TextChatController(){var thisClass=this;this.messageUnreadCount=0;this.recentChatUser=null;this.textChatCollection=[];this.selectedChat=null;this.startPos=new Object();this.draggedPos=new Object();this.dragDirection="topLeft";this.leftButtonDown=false;this.toggleVideoMode=false;this.toggleSnoozeMode=false;this.showAnnotation=null;this.loomSDKLoaded=false;this.constructor=function(){$("#mfVideoTextChatPostBtn").on("click",thisClass.postChatHandler);$("#mfVideoTextChatPost").on("keypress",thisClass.chatKeypressHandler);$("#mfVideoTextChatPost").on("focus",thisClass.unSelectTextchat);$("#mfTextChatHideBtn").on("click",thisClass.closeTextChatHandler);$("#mfOpenVideoChatBtn").on("click",thisClass.openVideoChatHandler);$("#mfOpenLoomRecordingBtn").on("click",thisClass.openLoomRecording);$("#mfSnoozeToggleBtn").on("click",thisClass.toggleSnoozeModeHandler);$("#mfShowMembersOnlineBtn").on("click",thisClass.toggleMembersScreen);$("#mfVideoTextChatWrapper").on("mousedown",function(evt){mf_main.editorController.disableShortcuts();});$("#mfVideoTextChatAnnotateBtn").on("mousedown",thisClass.mouseDownHandler);$("#mfVideoTextChatAnnotateBtn").on("dragstart",function(e){e.preventDefault();});$(document).on("mouseup",thisClass.mouseUpHandler);$(document).on("mousemove",thisClass.mouseMoveHandler);MF_ComponentSettingUtils.setCommonDragEvents("mfVideoTextChatWrapper");$("#mfVideoTextChatWrapper").tooltip({selector:".mfVideoChatTooltip",trigger:"hover"});};this.toggleTextChatHandler=function(e){if($("#mfVideoTextChatWrapper").css("display")=="block"){thisClass.closeTextChatHandler();}else{thisClass.openTextChatHandler();}};this.openTextChatHandler=function(e){if(mf_main.PUBLIC){return;}$("#mfVideoTextChatWrapper").show();$("#mfVideoTextChatPost").focus();if($("#mfVideoTextChatWrapper").position().top+$("#mfVideoTextChatWrapper").height()>$(window).height()){$("#mfVideoTextChatWrapper").css("top",$(window).height()-$("#mfVideoTextChatWrapper").height()-50);}if($("#mfVideoTextChatWrapper").position().left+$("#mfVideoTextChatWrapper").width()>$(window).width()){$("#mfVideoTextChatWrapper").css("left",$(window).width()-$("#mfVideoTextChatWrapper").width()-50);}if(($("#mfVideoTextChatWrapper").position().left+$("#mfVideoTextChatWrapper").width())<20){$("#mfVideoTextChatWrapper").css("left",50);}if(($("#mfVideoTextChatWrapper").position().top+$("#mfVideoTextChatWrapper").height())<20){$("#mfVideoTextChatWrapper").css("top",50);}};this.closeTextChatHandler=function(){$("#mfVideoTextChatWrapper").hide();thisClass.hideAnnotationPointer();};this.toggleSnoozeModeHandler=function(){if(thisClass.toggleSnoozeMode){thisClass.toggleSnoozeMode=false;$("#mfSnoozeToggleBtn").attr("data-original-title","Turn on Do-not-Disturb");$("#mfSnoozeToggleBtn").css("color","#000");}else{thisClass.toggleSnoozeMode=true;$("#mfSnoozeToggleBtn").attr("data-original-title","Turn off Do-not-Disturb");$("#mfSnoozeToggleBtn").css("color","#2196F3");}};this.listProjectMembers=function(){$("#mfChatMembersList").empty();var cachedTemplate=mf_main.getTemplateFromCache("mfProjectMemberTemplate");if(cachedTemplate==null){$.get("templates/editor/ProjectMember.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfProjectMemberTemplate").html());mf_main.addTemplateToCache("mfProjectMemberTemplate",template);thisClass.renderProjectMemberItems(template);});}else{thisClass.renderProjectMemberItems(cachedTemplate);}};this.setOnlineStatus=function(memid){$("#mfProjectMemberItemStatus"+memid).css("background","#4CAF50");$("#mfProjectMemberItemStatus"+memid).css("border-color","#4CAF50");};this.setOfflineStatus=function(memid){$("#mfProjectMemberItemStatus"+memid).css("background","transparent");$("#mfProjectMemberItemStatus"+memid).css("border-color","#9E9E9E");};this.renderProjectMemberItems=function(template,memberArr){$("#mfChatMembersList").empty();var htmldom="";for(var i=0,j=mf_main.rtc.memberCollection.size();i<j;i++){var mem=mf_main.rtc.memberCollection.getItemAt(i);$("#mfChatMembersList").append(template(mem));if(mem.online){thisClass.setOnlineStatus(mem.id);}else{thisClass.setOfflineStatus(mem.id);}if(mem.userid==MF_UserSession.getUser().username){$("#mfProjectMemberItemInvite"+mem.id).hide();}}$(".mfProjectMemberItemInviteCls").on("click",thisClass.sendInvite);};this.sendInvite=function(e){var inviteuser=$(this).attr("data-userid");MF_Utils.display_ActionIndicator("Chat invite has been sent to "+inviteuser);MF_ProjectManager.sendInvite(MF_UserSession.getUser(),mf_main.editorController.projectObj,inviteuser,{callback:function(res){}});};this.openVideoChatHandler=function(){$("#mfOpenVideoChatBtn").tooltip("hide");if(thisClass.toggleVideoMode){thisClass.closeVideoChat();}else{thisClass.openVideoChat();}};this.openLoomRecording=function(){if(MF_UserSession.getUser()&&!MF_UserSession.allowAllPowerups()){mf_main.editorController.powerupController.openPowerupbyID("D3acffd7697f806fbd0297cbcc1b27543");return;}if(navigator.userAgent.indexOf("Chrome")==-1&&navigator.userAgent.indexOf("Edge")==-1){MF_Utils.display_ActionIndicator("Recording videos is supported only in Chrome and Edge browsers");return;}if(!thisClass.loomSDKLoaded){var loomSDKJS=MF_Global.serverURL()+"powerups/loom/js/internal/loomSDK.js";MF_Utils.loadsScripts(["https://unpkg.com/@loomhq/loom-sdk@2.21.1/dist/cjs/index.js",loomSDKJS]).then(function(script,textStatus){thisClass.loomSDKLoaded=true;initLoomSDK();});}else{$("#mfStartLoomRecordingBtn").click();}};this.openVideoChat=function(){thisClass.toggleVideoMode=true;$("#mfOpenVideoChatBtn").attr("data-original-title","Exit meeting");$("#mfOpenVideoChatBtn").css("color","#2196F3");var vbottom=$(window).height()-($("#mfVideoTextChatWrapper").position().top+$("#mfVideoTextChatWrapper").outerHeight(true));if(vbottom<160){$("#mfVideoTextChatWrapper").css("bottom","170px");}mf_main.editorController.openVideoChatMode();};this.closeVideoChat=function(){thisClass.toggleVideoMode=false;$("#mfOpenVideoChatBtn").attr("data-original-title","Start meeting");$("#mfOpenVideoChatBtn").css("color","#000");$("#mfVideoTextChatWrapper").css("bottom","50px");mf_main.editorController.closeVideoChatMode();};this.toggleMembersScreen=function(e){if($("#mfChatMessagesScreen").css("display")=="block"){$("#mfChatMessagesScreen").hide();$("#mfChatMembersScreen").show();$("#mfMembersOnlineLabel").hide();$("#mfShowChatMessagesLabel").show();thisClass.listProjectMembers();}else{$("#mfChatMessagesScreen").show();$("#mfChatMembersScreen").hide();$("#mfMembersOnlineLabel").show();$("#mfShowChatMessagesLabel").hide();}};this.chatKeypressHandler=function(e){var keycode=(e.keyCode?e.keyCode:e.which);if(keycode=="13"&&!e.shiftKey){e.preventDefault();e.stopImmediatePropagation();thisClass.postChatHandler();}};this.postChatHandler=function(e){if(e){e.stopImmediatePropagation();}var chatMessage=$("#mfVideoTextChatPost").val().trim();chatMessage=Handlebars.Utils.escapeExpression(chatMessage);try{chatMessage=linkifyHtml(chatMessage,{className:""});}catch(err){chatMessage=MF_Utils.htmlEncode(chatMessage);}if(chatMessage!=""){$("#mfVideoTextChatPost").val("");var activeuser=MF_UserSession.getUser().username;var chatItem=new MF_VideoTextChatItem();chatItem.id=MF_Utils.guidGenerator();chatItem.message=chatMessage;chatItem.imageUrl=MF_Utils.get_gravatar(activeuser,24);chatItem.creator=activeuser;chatItem.creatorFirstName=MF_UserSession.getUser().firstName;chatItem.createDate=new Date();chatItem.annotatePageId=mf_main.editorController.page.eid;if($("#mfVideoChatAnnotateArrow").css("display")=="block"){if(thisClass.draggedPos.x>=0&&thisClass.draggedPos.y>=0){chatItem.pos=thisClass.draggedPos.x.toString()+","+thisClass.draggedPos.y.toString();chatItem.isAnnotate=true;}}thisClass.updateMessage(chatItem);mf_main.rtc.sendChatMsg("textmsg",chatItem);}};this.updateMessage=function(chatItem){if(MF_UserSession.getUser().username==chatItem.creator){chatItem.isCreator=true;}else{chatItem.isCreator=false;thisClass.messageUnreadCount+=1;}thisClass.textChatCollection.push(chatItem);if(thisClass.recentChatUser==chatItem.creator){chatItem.showUsername=false;}else{chatItem.showUsername=true;}thisClass.recentChatUser=chatItem.creator;thisClass.applyChatTemplate(chatItem);thisClass.hideAnnotationPointer();};this.applyChatTemplate=function(chatItem){var cachedTemplate=mf_main.getTemplateFromCache("mfVideoTextChatItemTemplate");if(cachedTemplate==null){$.get("templates/editor/VideoTextChatItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfVideoTextChatItemTemplate").html());mf_main.addTemplateToCache("mfVideoTextChatItemTemplate",template);thisClass.renderChatListing(chatItem,template);});}else{thisClass.renderChatListing(chatItem,cachedTemplate);}};this.renderChatListing=function(chatItem,template){var chatPanel="#mfVideoTextChatConversationPanel";$(chatPanel).scrollTop($(chatPanel).prop("scrollHeight"));if($.type(chatItem)=="object"){$(chatPanel).append(template(chatItem));}else{var htmldom="";for(var i=0;i<chatItem.length;i++){if(MF_UserSession.getUser().username==chatItem[i].creator){chatItem[i].isCreator=true;}else{chatItem[i].isCreator=false;}htmldom=htmldom+template(chatItem[i]);}$(chatPanel).empty();$(chatPanel).html(htmldom);}$(chatPanel).scrollTop($(chatPanel).prop("scrollHeight"));$(".mfVideoTextChatUserMessage").off("click");$(".mfVideoTextChatUserMessage").on("click",thisClass.showAnnotateForChat);$(".mfVideoChatAddasComment").off("click");$(".mfVideoChatAddasComment").on("click",thisClass.addAsComment);};this.resetTextChatInterface=function(){$("#mfVideoTextChatConversationPanel").html("");thisClass.messageUnreadCount=0;thisClass.hideAnnotationPointer();};this.selectChat=function(chatId){var chatItem=null;if(chatId){for(var i=0;i<thisClass.textChatCollection.length;i++){if(chatId==thisClass.textChatCollection[i].id){chatItem=thisClass.textChatCollection[i];break;}}}return chatItem;};this.unSelectTextchat=function(){if(thisClass.selectedChat){thisClass.selectedChat=null;thisClass.draggedPos.x=-1;thisClass.draggedPos.y=-1;}};this.addAsComment=function(e){e.stopImmediatePropagation();var chatId=$(this).closest(".mfVideoTextChatItem").attr("data-chatid");var chatItem=thisClass.selectChat(chatId);var feedback=null;var pos;if(chatItem!=null){feedback=new MF_Feedback();feedback.id=MF_Utils.guidGenerator();feedback.creator=MF_UserSession.getUser().username;feedback.creatorName=MF_UserSession.getUser().firstName+" "+MF_UserSession.getUser().lastName;feedback.clientid=mf_main.editorController.projectObj.company;feedback.createDate=new Date();feedback.projectid=mf_main.editorController.projectObj.id;feedback.pageid=mf_main.editorController.page.eid;feedback.message=chatItem.messageStr;feedback.canDelete=true;if(chatItem.isAnnotate&&feedback.pageid==chatItem.annotatePageId){pos=chatItem.pos.split(",");pos[0]=parseInt(pos[0]);pos[1]=parseInt(pos[1]);if(thisClass.dragDirection=="topLeft"){pos[0]+=24;}else{if(thisClass.dragDirection=="downRight"){pos[1]-=20;}else{if(thisClass.dragDirection=="downLeft"){pos[0]+=25;pos[1]-=4;}}}feedback.annotate=true;feedback.pos=pos[0].toString()+","+pos[1].toString();}MF_FeedbackManager.create(MF_UserSession.getUser(),mf_main.PUBLIC,mf_main.editorController.projectObj.company,feedback,false,{callback:function(arr){if(arr!=null){mf_main.editorController.commentController.cachedPageComments[feedback.pageid]=arr;mf_main.editorController.commentController.listCommentsByPage(arr);mf_main.editorController.page.comments=arr.length;mf_main.editorController.commentController.setCommentNum();if(feedback&&feedback.reply==null){$("#mfPageSidebarComments").scrollTop(0);}mf_main.rtc.commentSync("addComment",feedback);MF_Utils.display_ActionIndicator("Comment has been posted");var logcmd="COMMENTED";var logdata={projectid:mf_main.editorController.projectObj.id,projectname:mf_main.editorController.projectObj.title};var logMessage=mf_main.logController.getLogMessage(logcmd,logdata);var rtcObj=new MF_EditorRTCItem();rtcObj.logcmd=logcmd;rtcObj.logdata=logdata;rtcObj.messageStr=logMessage;rtcObj.collaborators=mf_main.editorController.powerupController.getRTCCollaboratorList();mf_main.dashboardRtcController.notification_sync(rtcObj);mf_main.logController.logSpaceAction(logcmd,logMessage,logdata,rtcObj.collaborators);}}});}};this.mouseDownHandler=function(e){if(e.which===1){mf_main.editorController.commentController.hideAnnotationPointer(false);thisClass.leftButtonDown=true;$("#mfVideoChatAnnotateArrow2").css("display","none");$("#mfVideoChatAnnotateArrow").css("display","block");$("#mfVideoChatAnnotateArrow").width(0);$("#mfVideoChatAnnotateArrow").height(0);thisClass.startPos.x=e.pageX;thisClass.startPos.y=e.pageY;thisClass.draggedPos.x=-1;thisClass.draggedPos.y=-1;thisClass.selectedChat=null;}};this.mouseUpHandler=function(e){if($("#mfVideoTextChatWrapper").css("display")=="block"){var detectOffsetParent=e.srcElement&&e.srcElement.offsetParent;var detectMouseUpEle=e.target.id!="mfVideoTextChatPost"&&e.target.id!="mfVideoTextChatPostBtn"&&e.target.id!="mfVideoTextChatPostBtnIcon";if($("#mfVideoChatAnnotateArrow2").css("display")=="block"){thisClass.hideAnnotationPointer();}if(!thisClass.leftButtonDown&&$("#mfVideoChatAnnotateArrow").css("display")=="block"&&detectMouseUpEle){thisClass.hideAnnotationPointer();}if(thisClass.leftButtonDown&&$("#mfVideoChatAnnotateArrow").css("display")=="block"){var xCordModeBased=304;var detectAnnotateInEditorArea=(e.pageX<xCordModeBased)||e.pageY<0||e.pageY>$("#mfEditorHolder").height()-10||e.pageX>$(window).width();if(detectAnnotateInEditorArea||(detectOffsetParent&&e.srcElement.offsetParent.id=="mfVideoTextChatWrapper")){thisClass.hideAnnotationPointer();}else{thisClass.saveAnnotation(e.pageX,e.pageY);thisClass.leftButtonDown=false;}}}};this.mouseMoveHandler=function(e){if($("#mfVideoTextChatWrapper").css("display")=="block"){if($("#mfVideoChatAnnotateArrow").css("display")=="block"){if(thisClass.leftButtonDown){thisClass.drawAndPlaceAnnotation(e.pageX,e.pageY);}}}};this.drawAndPlaceAnnotation=function(endx,endy,annotatestr){if(annotatestr==null){annotatestr="mfVideoChatAnnotateArrow";}var direction="topLeft";var ctx_Div=(document.getElementById(annotatestr)).getContext("2d");ctx_Div.clearRect(0,0,$("#"+annotatestr).width(),$("#"+annotatestr).height());var newX=endx+5;var newY=endy+5;var minusY=false;var minusX=false;if(thisClass.startPos.y>endy){$("#"+annotatestr).height(thisClass.startPos.y-endy);}else{$("#"+annotatestr).height(endy-thisClass.startPos.y);newY=endy-$("#"+annotatestr).height();minusY=true;}if(thisClass.startPos.x>endx){$("#"+annotatestr).width(thisClass.startPos.x-endx);}else{$("#"+annotatestr).width(endx-thisClass.startPos.x);newX=endx-$("#"+annotatestr).width();minusX=true;}if(minusX&&minusY){direction="downRight";}if(minusX&&!minusY){direction="topRight";}if(!minusX&&minusY){direction="downLeft";}if(direction=="topLeft"||direction=="downLeft"){if($("#"+annotatestr).width()<30){$("#"+annotatestr).width($("#"+annotatestr).width()+20);}if($("#"+annotatestr).height()<30){$("#"+annotatestr).height($("#"+annotatestr).height()+20);}}else{$("#"+annotatestr).width($("#"+annotatestr).width());}$("#"+annotatestr).css({position:"absolute",top:newY,left:newX});var c=document.getElementById(annotatestr);c.width=$("#"+annotatestr).width();c.height=$("#"+annotatestr).height();if(direction=="topLeft"){thisClass.drawAnnotationArrow($("#"+annotatestr).width(),$("#"+annotatestr).height(),10,10,annotatestr);}if(direction=="downRight"){thisClass.drawAnnotationArrow(0,0,$("#"+annotatestr).width()-10,$("#"+annotatestr).height()-10,annotatestr);}if(direction=="topRight"){thisClass.drawAnnotationArrow(0,$("#"+annotatestr).height(),$("#"+annotatestr).width()-10,10,annotatestr);}if(direction=="downLeft"){thisClass.drawAnnotationArrow($("#"+annotatestr).width(),0,10,$("#"+annotatestr).height()-10,annotatestr);}thisClass.dragDirection=direction;};this.drawAnnotationArrow=function(start_x,start_y,end_x,end_y,annotatestr){var ctx_Div=(document.getElementById(annotatestr)).getContext("2d");thisClass.drawArrow(start_x,start_y,end_x,end_y,ctx_Div,"rgba(255, 0, 0, 1)");};this.drawArrow=function(start_x,start_y,end_x,end_y,ctx_Arrow,arrowColor){var asize=30;var apoint=asize-5;var angle1=(Math.PI)/8;var angle2=(15*Math.PI)/8;if((end_y>start_y)&&(end_x>start_x)){var slope_sign=1;var x_sign=-1;}if((end_y<start_y)&&(end_x<start_x)){var slope_sign=1;var x_sign=1;}if((end_y<start_y)&&(end_x>start_x)){var slope_sign=-1;var x_sign=-1;}if((end_y>start_y)&&(end_x<start_x)){var slope_sign=-1;var x_sign=1;}if(end_y==start_y){var slope_sign=1;var x_sign=-((end_x-start_x)/Math.abs(end_x-start_x));}var arrow_height=Math.abs(end_y-start_y);var arrow_width=Math.abs(end_x-start_x);ctx_Arrow.shadowOffsetX=0;ctx_Arrow.shadowOffsetY=2;ctx_Arrow.shadowBlur=10;ctx_Arrow.shadowColor="rgba(0, 0, 0, 0.5)";ctx_Arrow.strokeStyle=arrowColor;ctx_Arrow.moveTo(start_x,start_y);ctx_Arrow.lineTo(end_x,end_y);ctx_Arrow.fillStyle=arrowColor;if(arrow_width!=0){var slope=slope_sign*(arrow_height/arrow_width);var d=asize;var x=x_sign*(Math.sqrt((d*d)/(1+(slope*slope))));var y=slope*x;d=apoint;var x3=x_sign*(Math.sqrt((d*d)/(1+(slope*slope))));var y3=slope*x3;}else{var y_sign=-((end_y-start_y)/Math.abs(end_y-start_y));var x=0;var y=y_sign*asize;var x3=0;var y3=y_sign*apoint;}ctx_Arrow.save();ctx_Arrow.translate(end_x,end_y);var x1=(x*Math.cos(angle1))-(y*Math.sin(angle1));var y1=(x*Math.sin(angle1))+(y*Math.cos(angle1));var x2=(x*Math.cos(angle2))-(y*Math.sin(angle2));var y2=(x*Math.sin(angle2))+(y*Math.cos(angle2));var x4=(x1+x3)/3;var y4=(y1+y3)/3;var x5=(x3+x2)/3;var y5=(y3+y2)/3;var s_x=x_sign*arrow_width;var s_y=slope*s_x;ctx_Arrow.fillStyle=arrowColor;ctx_Arrow.strokeStyle=arrowColor;ctx_Arrow.beginPath();ctx_Arrow.moveTo(0,0);ctx_Arrow.lineTo(x1,y1);ctx_Arrow.lineTo(x3,y3);ctx_Arrow.lineTo(x2,y2);ctx_Arrow.moveTo(x3,y3);ctx_Arrow.lineTo(x4,y4);ctx_Arrow.lineTo(s_x,s_y);ctx_Arrow.lineTo(x5,y5);ctx_Arrow.closePath();ctx_Arrow.fill();ctx_Arrow.shadowOffsetX=0;ctx_Arrow.shadowOffsetY=0;ctx_Arrow.shadowBlur=0;ctx_Arrow.shadowColor="rgba(0, 0, 0, 0)";ctx_Arrow.fillStyle=arrowColor;ctx_Arrow.beginPath();ctx_Arrow.moveTo(x3,y3);ctx_Arrow.lineTo(x4,y4);ctx_Arrow.lineTo(s_x,s_y);ctx_Arrow.lineTo(x5,y5);ctx_Arrow.closePath();ctx_Arrow.fill();ctx_Arrow.shadowOffsetX=0;ctx_Arrow.shadowOffsetY=2;ctx_Arrow.shadowBlur=10;ctx_Arrow.shadowColor="rgba(0, 0, 0, 0.5)";ctx_Arrow.beginPath();ctx_Arrow.moveTo(x4,y4);ctx_Arrow.lineTo(s_x,s_y);ctx_Arrow.restore();};this.saveAnnotation=function(x,y){if($("#mfVideoChatAnnotateArrow").css("display")=="block"&&thisClass.leftButtonDown){var imageref="mfContainerPage";thisClass.draggedPos=MF_Utils.globalToLocalPoint2(x,y,imageref);thisClass.draggedPos.x=Math.round(thisClass.draggedPos.x/mf_main.editorController.SCALE);thisClass.draggedPos.y=Math.round(thisClass.draggedPos.y/mf_main.editorController.SCALE);var autoSize=true;var pageWidth=500;var pageHeight=500;if(mf_main.editorController.projectObj.sizeType!="sizeless"){autoSize=false;pageWidth=mf_main.editorController.projectObj.origWidth;pageHeight=mf_main.editorController.projectObj.origHeight;}if(mf_main.editorController.page.overrideSize){if(mf_main.editorController.page.sizeType!="sizeless"){autoSize=false;pageWidth=mf_main.editorController.page.origWidth;pageHeight=mf_main.editorController.page.origHeight;}else{autoSize=true;}}if(autoSize==false){var saveptr=false;if(thisClass.draggedPos.x<=pageWidth-15&&thisClass.draggedPos.y<=pageHeight-15){saveptr=true;}if(saveptr==false){thisClass.hideAnnotationPointer(false);}}}};this.placeChatAnnotation=function(annotatestr,chatItem,noscroll){if(annotatestr==null){annotatestr="mfVideoChatAnnotateArrow";}if(thisClass.selectedChat&&thisClass.selectedChat.pos){var arr=thisClass.selectedChat.pos.split(",");if(arr.length==2){$("#"+annotatestr).css("display","block");$("#"+annotatestr).width(0);$("#"+annotatestr).height(0);var rect=MF_Utils.localToGlobal(document.getElementById("mfVideoTextChatAnnotateBtn"));thisClass.startPos.x=rect.left;thisClass.startPos.y=rect.top;thisClass.draggedPos.x=Math.round(parseInt(arr[0])*mf_main.editorController.SCALE);thisClass.draggedPos.y=Math.round(parseInt(arr[1])*mf_main.editorController.SCALE);var imageref="mfContainerPage";var gcoord=MF_Utils.localToGlobalPoint(thisClass.draggedPos.x,thisClass.draggedPos.y,imageref);thisClass.drawAndPlaceAnnotation(gcoord.x,gcoord.y,annotatestr);if(noscroll){}else{if($("#"+annotatestr).css("display")=="block"){$("#mfEditorHolder").animate({scrollTop:(thisClass.draggedPos.y-100),scrollLeft:(thisClass.draggedPos.x-100)},1000,function(){});}}}}else{if($("#mfVideoChatAnnotateArrow").css("display")!="block"){thisClass.hideAnnotationPointer();}}};this.showAnnotateForChat=function(){mf_main.editorController.commentController.hideAnnotationPointer();var chatitemId=$(this).closest(".mfVideoTextChatItem").attr("data-chatid");thisClass.selectedChat=thisClass.selectChat(chatitemId);if(thisClass.selectedChat!=null&&thisClass.selectedChat.isAnnotate){if(thisClass.selectedChat.annotatePageId!=mf_main.editorController.page.eid){MF_Utils.display_ActionIndicator("The selected annotation is not available for this page.");return;}if(thisClass.showAnnotation==null||(thisClass.showAnnotation!=thisClass.selectedChat.id)){thisClass.showAnnotation=thisClass.selectedChat.id;thisClass.placeChatAnnotation("mfVideoChatAnnotateArrow2");}else{thisClass.showAnnotation=null;}}else{thisClass.showAnnotation=null;}};this.hideAnnotationPointer=function(){$("#mfVideoChatAnnotateArrow").css("display","none");$("#mfVideoChatAnnotateArrow2").css("display","none");thisClass.draggedPos.x=-1;thisClass.draggedPos.y=-1;thisClass.selectedChat=null;};}function MF_VideoTextChatItem(){var thisClass=this;this.id=null;this.creator=null;this.creatorFirstName=null;this.isCreator=false;this.imageUrl=null;this.message=null;this.createDate=null;this.isAnnotate=false;this.pos="";this.annotatePageId=null;var messageStr="";this.__defineGetter__("messageStr",function(){var str=thisClass.message.replace(/(\r\n|\n|\r)/gm,"<br/>");return str;});this.__defineSetter__("messageStr",function(val){messageStr=val;});}function MF_SelectorTransform(){var thisClass=this;this.x=0;this.y=0;this.selector=null;this.component=null;this.id=mf_main.editorController.guidGenerator();this.delta=5;this.type="start";this.remove=function(){$("#"+this.id).remove();};this.render=function(redraw){$("#"+this.id).remove();var rectCode="";if(thisClass.type=="start"){rectCode=rectCode+'<div  id="'+this.id+'" class="transformhandle transformstarthandle mfResizeHandleBtn" style="-webkit-transform: translateZ(0); position:absolute;  top:'+(thisClass.y).toString()+"px; left:"+(thisClass.x).toString()+'px; " > ';rectCode=rectCode+"</div>";}else{if(thisClass.type=="end"){rectCode=rectCode+'<div  id="'+this.id+'" class="transformhandle transformendhandle mfResizeHandleBtn" style="-webkit-transform: translateZ(0); position:absolute;  top:'+(thisClass.y).toString()+"px; left:"+(thisClass.x).toString()+'px; " > ';rectCode=rectCode+"</div>";}else{if(thisClass.type=="path"){try{var dragArray=thisClass.selector.component.dragPoints;$(".transformPathHandle").remove();for(i=0;i<dragArray.length;i++){rectCode=rectCode+'<div  id="'+dragArray[i].id+'" class="transformhandle transformPathHandle mfResizeHandleBtn" style="-webkit-transform: translateZ(0); position:absolute;  top:'+(dragArray[i].y-5).toString()+"px; left:"+(dragArray[i].x-5).toString()+'px; " > ';rectCode=rectCode+"</div>";}}catch(e){console.log("Error in ArrowPath");}}}}$("#mfPage"+mf_main.editorController.page.eid).append(rectCode);var scalehandle=mf_main.editorController.SCALE;if(scalehandle>1){scalehandle=1;}$(".transformhandle").css("height",9/scalehandle);$(".transformhandle").css("width",9/scalehandle);$(".transformhandle").css("border-radius",(9/scalehandle).toString()+"px");$(".transformhandle").css("-moz-border-radius",(9/scalehandle).toString()+"px");$(".transformhandle").css("-webkit-border-radius",(9/scalehandle).toString()+"px");$("#"+thisClass.id).css("top",thisClass.y-(9/scalehandle)/2);$("#"+thisClass.id).css("left",thisClass.x-(9/scalehandle)/2);if(thisClass.selector.locked){$(".transformhandle").css("background-color","#000000");$(".transformhandle").css("border-color","#ffffff");}else{$(".transformhandle").css("background-color","#ffffff");$(".transformhandle").css("border-color","#2196F3");}};}function MF_SelectorResize(){var thisClass=this;this.x=0;this.y=0;this.angle=0;this.width=100;this.height=100;this.prevX=0;this.prevY=0;this.prevAngle=0;this.prevWidth=100;this.prevHeight=100;this.selector=null;this.id=mf_main.editorController.guidGenerator();this.locked=false;this.delta=0;this.setVisible=function(val){this.visible=val;if($("#"+this.id)!=null){if(this.visible){$("#"+this.id).css("display","block");if(thisClass.component){if(thisClass.component.TRANSFORM){$("#"+this.id).hide();}}}else{$("#"+this.id).css("display","none");}}};this.getVisible=function(){return this.visible;};this.setLocking=function(locked){this.locked=locked;if(locked){$(".handle").css("background-color","#000");$(".handle").css("border-color","#fff");}else{$(".handle").css("background-color","#ffffff");$(".handle").css("border-color","#2196F3");}};this.resize=function(nx,ny,nwidth,nheight){this.x=nx;this.y=ny;this.width=nwidth;this.height=nheight;var cwidth=this.width;var cheight=this.height;var ctop=this.y;var cleft=this.x;thisClass.refresh();};this.setRotationHandle=function(){if(thisClass.selector&&thisClass.selector.GLOBAL_SELECT){$("#"+this.id+"_rotateline").hide();$("#"+this.id+"_rotatebtn").hide();}else{if(thisClass.selector&&thisClass.selector.component&&thisClass.selector.component.CANNOT_ROTATE){$("#"+this.id+"_rotateline").hide();$("#"+this.id+"_rotatebtn").hide();}else{$("#"+this.id+"_rotatebtn").show();$("#"+this.id+"_rotateline").hide();}}if(thisClass.selector&&thisClass.selector.locked){$("#"+this.id+"_rotateline").hide();$("#"+this.id+"_rotatebtn").hide();}};this.refresh=function(){$("#"+this.id).css("top",this.y-(thisClass.delta*3)+thisClass.delta);$("#"+this.id).css("left",this.x+thisClass.delta);$("#"+this.id).css("width",this.width-(thisClass.delta*2));$("#"+this.id).css("height",this.height+thisClass.delta);$("#"+this.id+"_rotatebtn").css("left","15px");$("#"+this.id+"_holder").css("top",(thisClass.delta*3));$("#"+this.id+"_holder").css("left",0);$("#"+this.id+"_holder").css("width",this.width-(thisClass.delta*2));$("#"+this.id+"_holder").css("height",this.height-(thisClass.delta*2));MF_Utils.rotate(thisClass.id,thisClass.angle);thisClass.setRotationHandle();thisClass.checkHandlesReq();};this.enableCropMode=function(){if(mf_main.editorController.CROPMODE){$(".NW").hide();$(".SW").hide();$(".NE").hide();$(".SE").hide();$(".EE").addClass("cropHandle");$(".WW").addClass("cropHandle");$(".NN").addClass("cropHandle");$(".SS").addClass("cropHandle");}};this.disableCropMode=function(){$(".NW").show();$(".SW").show();$(".NE").show();$(".SE").show();$(".EE").removeClass("cropHandle");$(".WW").removeClass("cropHandle");$(".NN").removeClass("cropHandle");$(".SS").removeClass("cropHandle");};this.checkHandlesReq=function(){var hideHandles=false;if(thisClass.width<16&&thisClass.height<16){hideHandles=true;}if(hideHandles){$(".mfResizeHandleBtn").hide();}else{$(".mfResizeHandleBtn").show();if(thisClass.width<60){$(".rotatehandle").hide();}if(thisClass.selector&&thisClass.selector.component&&thisClass.selector.component.CANNOT_ROTATE){$("#"+this.id+"_rotateline").hide();$("#"+this.id+"_rotatebtn").hide();}if(thisClass.selector&&thisClass.selector.GLOBAL_SELECT){$("#"+this.id+"_rotateline").hide();$("#"+this.id+"_rotatebtn").hide();}if(thisClass.selector){if(thisClass.selector.height<20){$(".EE").hide();$(".WW").hide();}else{$(".EE").show();$(".WW").show();}if(thisClass.selector.width<20){$(".NN").hide();$(".SS").hide();}else{$(".NN").show();$(".SS").show();}}}};this.remove=function(){$("#"+this.id).remove();};this.render=function(redraw){if(redraw==null){redraw=true;}var rectCode="";var cwidth=this.width;var cheight=this.height;var ctop=this.y;var cleft=this.x;if(redraw){$("#"+this.id).remove();rectCode=rectCode+'<div  unselectable="on"  id="'+this.id+"\" class='drag' style=\" -webkit-transform: translateZ(0); pointer-events: none; text-align: center; -webkit-user-select: none; -moz-user-select: none; user-select:none; position:absolute; width:"+(cwidth+(thisClass.delta*2)).toString()+"px; height:"+(cheight+(thisClass.delta*2)).toString()+"px; top:"+(ctop-(thisClass.delta)).toString()+"px; left:"+(cleft-(thisClass.delta)).toString()+'px; " > ';rectCode=rectCode+'<div  id="'+this.id+'_holder"  style="-webkit-transform: translateZ(0); pointer-events: none; border: 1px solid #2286FB; -webkit-user-select: none; -moz-user-select: none; user-select:none; position:absolute; width:'+(cwidth).toString()+"px; height:"+(cheight).toString()+"px; top:"+(thisClass.delta).toString()+"px; left:"+(thisClass.delta).toString()+'px; " > ';rectCode=rectCode+"</div>";rectCode=rectCode+"<div style='-webkit-transform: translateZ(0); pointer-events: auto;' class='handle NE mfResizeHandleBtn mfRectResizeBtn'></div>";rectCode=rectCode+"<div style='-webkit-transform: translateZ(0); pointer-events: auto; position: absolute;' class='handle NN mfResizeHandleBtn mfRectResizeBtn'></div>";rectCode=rectCode+"<div style='-webkit-transform: translateZ(0); pointer-events: auto;' class='handle NW mfResizeHandleBtn mfRectResizeBtn'></div>";rectCode=rectCode+"<div style='-webkit-transform: translateZ(0); pointer-events: auto;' class='handle WW mfResizeHandleBtn mfRectResizeBtn'></div>";rectCode=rectCode+"<div style='-webkit-transform: translateZ(0); pointer-events: auto;' class='handle EE mfResizeHandleBtn mfRectResizeBtn'></div>";rectCode=rectCode+"<div style='-webkit-transform: translateZ(0); pointer-events: auto;' class='handle SW mfResizeHandleBtn mfRectResizeBtn'></div>";rectCode=rectCode+"<div style='-webkit-transform: translateZ(0); pointer-events: auto;' class='handle SS mfResizeHandleBtn mfRectResizeBtn'></div>";rectCode=rectCode+"<div style='-webkit-transform: translateZ(0); pointer-events: auto;' class='handle SE mfResizeHandleBtn mfRectResizeBtn'></div>";rectCode=rectCode+'<div id="'+this.id+'_rotatebtn" class="mfResizeHandleBtn rotatehandle" style="-webkit-transform: translateZ(0); pointer-events: auto; position: absolute; top: -3px; left:100px;  ">';rectCode=rectCode+"</div>";rectCode=rectCode+"</div>";$("#mfPage"+mf_main.editorController.page.eid).append(rectCode);}else{thisClass.refresh();}$("#"+this.id).css("pointer-events","none");thisClass.resizeHandles();if(thisClass.selector&&thisClass.selector.component&&thisClass.selector.component.TRANSFORM){$("#"+this.id).hide();}else{if(thisClass.selector&&thisClass.selector.component&&thisClass.selector.component.AUTOSIZE){$(".mfRectResizeBtn").hide();}else{$(".mfRectResizeBtn").show();}}thisClass.setRotationHandle();thisClass.checkHandlesReq();thisClass.enableCropMode();MF_Utils.rotate(thisClass.id,thisClass.angle);};this.resizeHandles=function(){var cwidth=this.width;var cheight=this.height;var ctop=this.y;var cleft=this.x;var rsize=9;var scalehandle=mf_main.editorController.SCALE;if(scalehandle>1){scalehandle=1;}rsize=rsize/scalehandle;rsize=Math.round(rsize);$(".mfRectResizeBtn").css("height",rsize);$(".mfRectResizeBtn").css("width",rsize);$(".mfRectResizeBtn").css("border-radius",rsize);$("#"+this.id+"_rotatebtn").css("height",9/scalehandle);$("#"+this.id+"_rotatebtn").css("width",9/scalehandle);$("#"+this.id+"_rotatebtn").css("margin-left",-1/scalehandle);$("#"+this.id+"_rotatebtn").css("left",(((cwidth)/2)+(2/scalehandle)+15).toString()+"px");$("#"+this.id+"_rotatebtn").css("top",-3/scalehandle);$(".NN").css("left",(((cwidth)/2)+(2/scalehandle)).toString()+"px");$(".SS").css("left",(((cwidth)/2)+(2/scalehandle)).toString()+"px");$(".EE").css("top",(((cheight)/2)-(5/scalehandle)).toString()+"px");$(".WW").css("top",(((cheight)/2)-(5/scalehandle)).toString()+"px");$(".NN").css("margin-left",-7/scalehandle);$(".SS").css("margin-left",-7/scalehandle);$(".EE").css("margin-top",1/scalehandle);$(".WW").css("margin-top",1/scalehandle);$(".NN,.NW,.NE").css("top",-3/scalehandle);$(".SS,.SW,.SE").css("bottom",-4/scalehandle);$(".WW,.SW,.NW").css("left",-4/scalehandle);$(".EE,.SE,.NE").css("right",-4/scalehandle);};}function MF_Selector(){var thisClass=this;this.UNEDIT=false;this.x=0;this.y=0;this.width=100;this.height=100;this.angle=0;this.component=null;this.id=mf_main.editorController.guidGenerator();this.locked=false;this.GROUP=false;this.GROUPID="";this.GLOBAL_SELECT=false;this.currentState="select";this.globalselects=new Object();this.balpha=1;this.visible=true;this.origX=0;this.origY=0;this.origW=0;this.origH=0;this.POS=0;this.mouseEnabled=true;this.delta=0;this.zindex=0;this.setLocking=function(locked,force){var change=false;if(force==undefined){force=false;}if(this.locked!=locked){change=true;}if(force){change=true;}this.locked=locked;if(locked){if(change){mf_main.editorController.lockSelectorEvents(thisClass);}}else{if(change){mf_main.editorController.unLockSelectorEvents(thisClass);}}};this.toggleMouseAction=function(val){if(val){this.mouseEnabled=true;$("#"+thisClass.id).css("pointer-events","none");}else{this.mouseEnabled=false;$("#"+thisClass.id).css("pointer-events","auto");}};this.removeSelectionHighlights=function(val){for(var selectid in this.globalselects){var select=this.globalselects[selectid];select.setBalpha(0);}};this.transform=function(comp){thisClass.x=comp.x-thisClass.delta;thisClass.y=comp.y-thisClass.delta;thisClass.width=comp.width+(thisClass.delta*2);thisClass.height=comp.height+(thisClass.delta*2);thisClass.render(false);};this.getGlobalSelectsArray=function(){var arr=new Array();for(var selectid in this.globalselects){var select=this.globalselects[selectid];arr[arr.length]=select;}return arr;};this.setSize=function(force,undo){if(force==null){force=false;}if(undo==null){undo=true;}this.width=parseInt(this.width);this.height=parseInt(this.height);try{var undoarr=new Array();if(this.GLOBAL_SELECT){var allselections=this.globalselects;if(this.GROUP){var coll=new Object();allselections=mf_main.editorController.page.groupManager.getAllChildComponents(this.GROUPID,coll);}var sw=(this.width-(thisClass.delta*2))/(this.origW-(thisClass.delta*2));var sh=(this.height-(thisClass.delta*2))/(this.origH-(thisClass.delta*2));for(var selectid in allselections){var select=allselections[selectid];var nosize=false;if(select.component&&select.component.LOCK_SIZE){nosize=true;}if(!select.GROUP){var undo1=new MF_UndoDAO();undo1.propObjectUndo(select.component,"ecoordinates",select.component.ecoordinates);undoarr.push(undo1);if(!nosize){var undo2=new MF_UndoDAO();undo2.propObjectUndo(select.component,"esize",select.component.esize);undoarr.push(undo2);if(select.component&&select.component.NAME=="MF_ArrowPath"){var undo3=new MF_UndoDAO();var wayPoints=select.component.wayPoints;if(typeof(select.component.wayPoints)!="string"){wayPoints=JSON.stringify(select.component.wayPoints);}undo3.propArrayUndo(select.component,"wayPoints",wayPoints);undoarr.push(undo3);}}}var nwidth=(select.width-(thisClass.delta*2))*sw-10;var nheight=(select.height-(thisClass.delta*2))*sh-10;if(nwidth<1){nwidth=1;}if(nheight<1){nheight=1;}select.origW=select.width;select.origH=select.height;select.origX=select.x;select.origY=select.y;select.y=((select.y-thisClass.origY)*sh)+thisClass.y+10;select.x=((select.x-thisClass.origX)*sw)+thisClass.x+10;select.setBalpha(0);if(!nosize){if(select.component){if(!select.component.VRESIZE){select.width=nwidth+(thisClass.delta*2);}if(!select.component.HRESIZE){select.height=nheight+(thisClass.delta*2);}}else{select.width=nwidth+(thisClass.delta*2);select.height=nheight+(thisClass.delta*2);}}if(select.GROUP){var globarr=select.setSize(force,false);for(var k=0;k<globarr.length;k++){undoarr.push(globarr[k]);}select.origW=select.width;select.origH=select.height;select.origX=select.x;select.origY=select.y;}else{if(select.component){if(!select.component.AUTOSIZE){var nscwidth=select.width-(thisClass.delta*2);var nscheight=select.height-(thisClass.delta*2);if(nscwidth<1){nscwidth=1;}if(nscheight<1){nscheight=1;}if(select.component.NAME=="MF_ArrowPath"){select.component.updateDimensions(nscwidth,nscheight,thisClass.x,thisClass.y,thisClass.origX,thisClass.origY);}select.component.height=nscheight;select.component.width=nscwidth;}if(select.component.TRANSFORM){select.component.x=select.x+select.delta;select.component.y=select.y+select.delta;select.component.computePoints();}}select.setCoordinate(false,false,false);if(!nosize){select.setSize(force,false);}}}if(undo){if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);if(undoarr.length>2){meta.reselectMeta=true;}undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}}this.origW=this.width;this.origH=this.height;this.origX=this.x;this.origY=this.y;mf_main.editorController.addSelectorResize(this);}else{if(!this.component.LOCK_SIZE||force){if(undo){if(this.component&&this.component.LOCK_SIZE){nosize=true;}if(!this.GROUP){var undo1=new MF_UndoDAO();undo1.propObjectUndo(this.component,"ecoordinates",this.component.prevEcoordinates);undoarr.push(undo1);if(!nosize){var undo2=new MF_UndoDAO();undo2.propObjectUndo(this.component,"esize",this.component.prevEsize);undoarr.push(undo2);}}}if(!this.component.AUTOSIZE){this.component.height=this.height-(thisClass.delta*2);this.component.width=this.width-(thisClass.delta*2);}this.component.x=this.x+thisClass.delta;this.component.y=this.y+thisClass.delta;var sizeUI=new Object();sizeUI.height=this.component.height;sizeUI.width=this.component.width;if(this.component.prevEsize!=null){this.component.esize=this.component.prevEsize;}if(undo){this.component.e2xml.addPropObject("esize",sizeUI);}else{this.component.e2xml.addPropObject("esize",sizeUI,"default");}this.setCoordinate(false,false,false);this.render(false);if(this.component){this.component.render(false);}if(undo){if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);if(undoarr.length>2){meta.reselectMeta=true;}undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}}}}MF_Utils.rotate(thisClass.id,thisClass.angle);return undoarr;}catch(err){}return null;};this.setCoordinate=function(undo,resizePage,render){if(undo==null){undo=true;}if(resizePage==null){resizePage=true;}if(render==null){render=true;}if(this.GROUP){mf_main.editorController.rePositionComponents(this);}else{if(!this.component.LOCK_POSITION){if(this.component.TRANSFORM){var posObject=new Object();posObject.startX=this.component.startX;posObject.startY=this.component.startY;posObject.endX=this.component.endX;posObject.endY=this.component.endY;if(this.component.prevEcoordinates!=null){this.component.ecoordinates=this.component.prevEcoordinates;}if(undo){if(this.component.NAME!="MF_ArrowPath"){this.component.e2xml.addPropObject("ecoordinates",posObject);}}else{this.component.e2xml.addPropObject("ecoordinates",posObject,"default");}if(render){this.component.render(false);}}else{this.component.x=this.x+thisClass.delta;this.component.y=this.y+thisClass.delta;var posObject=new Object();posObject.x=this.component.x;posObject.y=this.component.y;if(this.component.prevEcoordinates!=null){this.component.ecoordinates=this.component.prevEcoordinates;}if(undo){this.component.e2xml.addPropObject("ecoordinates",posObject);}else{this.component.e2xml.addPropObject("ecoordinates",posObject,"default");}if(!this.component.AUTOSIZE){this.component.width=this.width-(thisClass.delta*2);this.component.height=this.height-(thisClass.delta*2);}if(render){this.component.render(false);}}}}MF_Utils.rotate(thisClass.id,thisClass.angle);};this.setAngle=function(undo,render,add){if(undo==null){undo=true;}if(render==null){render=true;}if(add==null){add=true;}if(this.component&&!this.component.LOCK_POSITION){if(add){if(undo){this.component.e2xml.addPropSingle("eangle",thisClass.angle);}else{this.component.e2xml.addPropSingle("eangle",thisClass.angle,"default");}}MF_Utils.rotate(thisClass.id,thisClass.angle);if(render){this.component.render(false);}}else{return;var undoarr=new Array();for(var i=0;i<mf_main.editorController.componentSelect.length;i++){var select=mf_main.editorController.componentSelect[i];if(!select.locked){select.angle=thisClass.angle;if(!select.GROUP){var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"eangle",select.component.eangle);undoarr.push(undo);}if(select.GROUP){var arr=mf_main.editorController.reAngleComponents(select,false);for(var j=0;j<arr.length;j++){var udo=arr[j];undoarr[undoarr.length]=udo;}}else{if(select.component&&select.component.TRANSFORM){}else{select.component.e2xml.addPropSingle("eangle",thisClass.angle,"default");MF_Utils.rotate(select.id,thisClass.angle);}}}}MF_ChangeManager.CHANGED(true);if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);meta.reselectMeta=true;undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}}};this.setBalpha=function(val){this.balpha=val;if(val==0){$("#"+this.id).css("background-color","transparent");}else{$("#"+this.id).css("background-color","rgb(68,68,68,0.5)");}};this.getBalpha=function(){return this.balpha;};this.setVisible=function(val){this.visible=val;if($("#"+this.id)!=null){if(this.visible){$("#"+this.id).css("display","block");if(thisClass.component){if(thisClass.component.TRANSFORM){$("#"+this.id).hide();}}}else{$("#"+this.id).css("display","none");}}};this.setInActive=function(val){if($("#"+this.id)!=null){$("#"+this.id).css("pointer-events","none");}};this.setActive=function(val){if($("#"+this.id)!=null){$("#"+this.id).css("pointer-events","auto");}};this.enableGroup=function(){if($("#"+this.id)!=null){$("#"+this.id).css("pointer-events","none");$("#"+this.id).css("border","2px solid #ff0000");$("#"+this.id).css("outline","1px solid #ffffff");}};this.disableGroup=function(){if($("#"+this.id)!=null){$("#"+this.id).css("pointer-events","auto");$("#"+this.id).css("border","none");$("#"+this.id).css("outline","none");}};this.setComponentVisible=function(val){if(thisClass.component){thisClass.visible=val;if($("#"+thisClass.id)!=null){if(thisClass.visible){$("#"+thisClass.id).css("display","block");}else{$("#"+thisClass.id).css("display","none");}thisClass.component.setVisible(val);if(thisClass.component){if(thisClass.component.TRANSFORM){$("#"+thisClass.id).hide();}}}}};this.getVisible=function(){return this.visible;};this.setCurrentState=function(val){this.currentState=val;};this.getCurrentState=function(){return this.currentState;};this.Select=function(){if(thisClass.GLOBAL_SELECT&&!thisClass.GROUP){thisClass.currentState="unselected";}else{}};this.UnSelect=function(){};this.remove=function(){$("#"+this.id).remove();};this.render=function(redraw){if(redraw==null){redraw=true;}var rectCode="";var cwidth=this.width;var cheight=this.height;var ctop=this.y;var cleft=this.x;if(redraw){$("#"+this.id).remove();rectCode=rectCode+'<div unselectable="on"  id="'+this.id+'"  group-id="'+this.GROUPID+"\" class='sdrag mfCompSelectorCls' width=\""+(cwidth).toString()+'" height="'+(cheight).toString()+'" style="overflow: hidden; -webkit-transform: translateZ(0);  -webkit-user-select: none; -moz-user-select: none; user-select:none; position:absolute; width:'+(cwidth).toString()+"px; height:"+(cheight).toString()+"px; top:"+(ctop).toString()+"px; left:"+(cleft).toString()+'px; " > ';rectCode=rectCode+'<div id="'+this.id+'_base" width="'+(cwidth-(thisClass.delta*2)).toString()+'" height="'+(cheight-(thisClass.delta*2)).toString()+'" style="-webkit-transform: translateZ(0);  background-color: #878D99; opacity: 0.0; border: 0px solid; position:absolute; width:'+(cwidth-(thisClass.delta*2)).toString()+"px; height:"+(cheight-(thisClass.delta*2)).toString()+"px; top:"+thisClass.delta.toString()+"px; left:"+thisClass.delta.toString()+'px; " > ';rectCode=rectCode+"</div>";rectCode=rectCode+"</div>";$("#mfPage"+mf_main.editorController.page.eid).append(rectCode);}else{$("#"+this.id).css("left",this.x);$("#"+this.id).css("top",this.y);$("#"+this.id).css("width",this.width);$("#"+this.id).css("height",this.height);}if(thisClass.GLOBAL_SELECT&&thisClass.GROUP==false){$("#"+this.id).css("background-color","rgba(135,141,153,0.3)");}if(thisClass.component){if(thisClass.component.TRANSFORM){$("#"+this.id).hide();}}MF_Utils.rotate(thisClass.id,thisClass.angle);};}function tabWedgeRect(ctx,x,y,width,height,radius){ctx.beginPath();ctx.moveTo(x,height);ctx.lineTo(radius,x);ctx.lineTo(width-radius,y);ctx.lineTo(width,height);}function topWedgeRect(ctx,x,y,width,height,radius){ctx.beginPath();ctx.moveTo(x,height);ctx.lineTo(radius,x);ctx.lineTo(width-radius,y);ctx.lineTo(width,height);}function rightRoundRect(ctx,x,y,width,height,radius){ctx.beginPath();ctx.moveTo(x,y);ctx.lineTo(x,y+height);ctx.lineTo(x+width-radius,y+height);ctx.quadraticCurveTo(x+width,y+height,x+width,y+height-radius);ctx.lineTo(x+width,y+radius);ctx.quadraticCurveTo(x+width,y,x+width-radius,y);ctx.lineTo(x,y);}function leftRoundRect(ctx,x,y,width,height,radius){ctx.beginPath();ctx.moveTo(x,y+radius);ctx.lineTo(x,y+height-radius);ctx.quadraticCurveTo(x,y+height,x+radius,y+height);ctx.lineTo(x+width,y+height);ctx.lineTo(x+width,y);ctx.lineTo(x+radius,y);ctx.quadraticCurveTo(x,y,x,y+radius);}function topRoundRect(ctx,x,y,width,height,radius){ctx.beginPath();ctx.moveTo(x,y+radius);ctx.lineTo(x,y+height);ctx.lineTo(x+width,y+height);ctx.lineTo(x+width,y+radius);ctx.quadraticCurveTo(x+width,y,x+width-radius,y);ctx.lineTo(x+radius,y);ctx.quadraticCurveTo(x,y,x,y+radius);}function tabRoundRect(ctx,x,y,width,height,radius){ctx.beginPath();ctx.moveTo(x,y+radius);ctx.lineTo(x,y+height);ctx.moveTo(x+width,y+height);ctx.lineTo(x+width,y+radius);ctx.quadraticCurveTo(x+width,y,x+width-radius,y);ctx.lineTo(x+radius,y);ctx.quadraticCurveTo(x,y,x,y+radius);}function topRoundRect2(ctx,x,y,w,h,cornerRadius){cornerRadius=cornerRadius/2;ctx.beginPath();var theta,angle,cx,cy,px,py;if(cornerRadius>Math.min(w,h)/2){cornerRadius=Math.min(w,h)/2;}theta=Math.PI/4;ctx.moveTo(x+cornerRadius,y);ctx.lineTo(x+w-cornerRadius,y);angle=-Math.PI/2;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);ctx.lineTo(x+w,y+h-cornerRadius);var brc=0;angle+=theta;cx=x+w-brc+(Math.cos(angle+(theta/2))*brc/Math.cos(theta/2));cy=y+h-brc+(Math.sin(angle+(theta/2))*brc/Math.cos(theta/2));px=x+w-brc+(Math.cos(angle+theta)*brc);py=y+h-brc+(Math.sin(angle+theta)*brc);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+w-brc+(Math.cos(angle+(theta/2))*brc/Math.cos(theta/2));cy=y+h-brc+(Math.sin(angle+(theta/2))*brc/Math.cos(theta/2));px=x+w-brc+(Math.cos(angle+theta)*brc);py=y+h-brc+(Math.sin(angle+theta)*brc);ctx.quadraticCurveTo(cx,cy,px,py);ctx.lineTo(x+cornerRadius,y+h);angle+=theta;var blr=0;cx=x+blr+(Math.cos(angle+(theta/2))*blr/Math.cos(theta/2));cy=y+h-blr+(Math.sin(angle+(theta/2))*blr/Math.cos(theta/2));px=x+blr+(Math.cos(angle+theta)*blr);py=y+h-blr+(Math.sin(angle+theta)*blr);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+blr+(Math.cos(angle+(theta/2))*blr/Math.cos(theta/2));cy=y+h-blr+(Math.sin(angle+(theta/2))*blr/Math.cos(theta/2));px=x+blr+(Math.cos(angle+theta)*blr);py=y+h-blr+(Math.sin(angle+theta)*blr);ctx.quadraticCurveTo(cx,cy,px,py);ctx.lineTo(x,y+cornerRadius);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);}function bottomRoundRect2(ctx,x,y,w,h,cornerRadius){cornerRadius=cornerRadius/2;ctx.beginPath();var theta,angle,cx,cy,px,py;if(cornerRadius>Math.min(w,h)/2){cornerRadius=Math.min(w,h)/2;}theta=Math.PI/4;ctx.moveTo(x+cornerRadius,y);ctx.lineTo(x+w-cornerRadius,y);angle=-Math.PI/2;var trad=0;cx=x+w-trad+(Math.cos(angle+(theta/2))*trad/Math.cos(theta/2));cy=y+trad+(Math.sin(angle+(theta/2))*trad/Math.cos(theta/2));px=x+w-trad+(Math.cos(angle+theta)*trad);py=y+trad+(Math.sin(angle+theta)*trad);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+w-trad+(Math.cos(angle+(theta/2))*trad/Math.cos(theta/2));cy=y+trad+(Math.sin(angle+(theta/2))*trad/Math.cos(theta/2));px=x+w-trad+(Math.cos(angle+theta)*trad);py=y+trad+(Math.sin(angle+theta)*trad);ctx.quadraticCurveTo(cx,cy,px,py);ctx.lineTo(x+w,y+h-cornerRadius);angle+=theta;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);ctx.lineTo(x+cornerRadius,y+h);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);ctx.lineTo(x,y+cornerRadius);angle+=theta;cx=x+trad+(Math.cos(angle+(theta/2))*trad/Math.cos(theta/2));cy=y+trad+(Math.sin(angle+(theta/2))*trad/Math.cos(theta/2));px=x+trad+(Math.cos(angle+theta)*trad);py=y+trad+(Math.sin(angle+theta)*trad);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+trad+(Math.cos(angle+(theta/2))*trad/Math.cos(theta/2));cy=y+trad+(Math.sin(angle+(theta/2))*trad/Math.cos(theta/2));px=x+trad+(Math.cos(angle+theta)*trad);py=y+trad+(Math.sin(angle+theta)*trad);ctx.quadraticCurveTo(cx,cy,px,py);}function roundedRect2(ctx,x,y,w,h,cornerRadius){cornerRadius=cornerRadius/2;ctx.beginPath();var theta,angle,cx,cy,px,py;if(cornerRadius>Math.min(w,h)/2){cornerRadius=Math.min(w,h)/2;}theta=Math.PI/4;ctx.moveTo(x+cornerRadius,y);ctx.lineTo(x+w-cornerRadius,y);angle=-Math.PI/2;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);ctx.lineTo(x+w,y+h-cornerRadius);angle+=theta;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);ctx.lineTo(x+cornerRadius,y+h);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);ctx.lineTo(x,y+cornerRadius);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);}function sketchRoundedRect(rough2,x,y,w,h,cornerRadius,obj){cornerRadius=cornerRadius/2;rough2.polygon([[x+cornerRadius,y],[x+w-cornerRadius,y],[x+w,y+cornerRadius],[x+w,y+h-cornerRadius],[x+w-cornerRadius,y+h],[x+cornerRadius,y+h],[x,y+h-cornerRadius],[x,y+cornerRadius],[x+cornerRadius,y]],obj);return;var theta,angle,cx,cy,px,py;if(cornerRadius>Math.min(w,h)/2){cornerRadius=Math.min(w,h)/2;}theta=Math.PI/4;rough.line(x+(cornerRadius/2),y,x+w-(cornerRadius/2),y,obj);angle=-Math.PI/2;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);var c1=cx;var c2=cy;var p1=px;var p2=py;angle+=theta;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);rough.curve([[c1,c2],[p1,p2],[cx,cy],[px,py]],obj);rough.line(px,py,x+w,y+h-(cornerRadius/2),obj);angle+=theta;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);c1=cx;c2=cy;p1=px;p2=py;angle+=theta;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);rough.curve([[c1,c2],[p1,p2],[cx,cy],[px,py]],obj);rough.line(px,py,x+(cornerRadius/2),y+h,obj);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);c1=cx;c2=cy;p1=px;p2=py;angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);rough.curve([[c1,c2],[p1,p2],[cx,cy],[px,py]],obj);rough.line(px,py,x,y+(cornerRadius/2),obj);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);c1=cx;c2=cy;p1=px;p2=py;angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);rough.curve([[c1,c2],[p1,p2],[cx,cy],[px,py]],obj);rough.line(x,y+(cornerRadius/2),x,y,obj);rough.line(x,y,x+cornerRadius,y,obj);}function MF_CommentController(){var thisClass=this;var startPos=new Object();var draggedPos=new Object();var hammer;var dstart=false;var leftButtonDown=false;var touchX=-1;var touchY=-1;this.commentCollection=new ArrayCollection();this.selectedComment=null;this.uploadFileTemp=null;this.replyUploadFileTemp=null;this.replyEnableHide=true;var newFeedbackObj=null;this.annotateUpdated=false;this.editCommentPos=null;this.noteAnnotateID="mfVideoChatAnnotateArrow";this.noteComp=null;this.noteArrowDirection="left";this.NOTEANNOTATEMODE=false;this.cachedPageComments=new Object();this.constructor=function(){$("#mfViewerContentComments").on("click",thisClass.commentSideBarClickHandler);$("#mfCommentPostBtn").on("click",thisClass.postCommentHandler);$("#mfCommentNewBtn").on("click",thisClass.postCommentHandler2);$("#mfCloseComment").on("click",thisClass.closeCommentHandler);$("#mfCommentAnnotateBtn,#mfReplyAnnotateBtn,#mfEditAnnotateBtn").on("mousedown",thisClass.mouseDownHandler);$("#mfCommentAnnotateBtn,#mfReplyAnnotateBtn,#mfEditAnnotateBtn").on("dragstart",function(event){event.preventDefault();});$(document).on("mousemove",thisClass.mouseMoveHandler);$(document).on("mouseup",thisClass.mouseUpHandler);$("#mfCommentAttachFile").on("click",thisClass.removeFileHandler);$("#mfAttachUploadFile").on("change",thisClass.fileSelectedHandler);$("#mfAnnotateArrow").on("click",thisClass.hideAnnotationPointer);$("#mfAnnotateArrow2").on("click",thisClass.hideAnnotationPointer);$(document).on("click",".mfCommentReplyInlineBtn",function(e){if($(this).text()=="Close"){$(this).text("Reply");thisClass.resetCommentBox();mf_main.interfaceResize();}else{thisClass.hideAnnotationPointer();thisClass.resetEditBox();$(".mfCommentReplyInlineBtn").text("Reply");$(this).text("Close");thisClass.commentReplyHandler(e);mf_main.interfaceResize();}thisClass.resetReplyAttachment();});$(document).on("blur","#mfCommentReplyContainer",function(e){setTimeout(function(){if($("#mfCommentReplyPost").val()==""&&thisClass.replyEnableHide==true){$(".mfCommentReplyInlineBtn").text("Reply");thisClass.resetCommentBox();mf_main.interfaceResize();}else{thisClass.replyEnableHide=true;}},500);});$("#mfCommentReplyPostBtn").on("click",thisClass.replyCommentHandler);$("#mfCommentReplyattach").on("click",function(){thisClass.replyEnableHide=false;thisClass.replyFileHandler();});$("#mfReplyAttachUploadFile").on("change",thisClass.fileSelectedHandler);$("#mfCommentReplyPost,#mfPublicReplyNameInput").on("focus",function(){thisClass.replyEnableHide=false;});$("#mfCommentEditPostBtn").on("click",thisClass.updateCommentHandler);};this.closeCommentHandler=function(e){$("#mfPageWriteComment").show();$("#mfPagePostComment").hide();};this.commentSideBarClickHandler=function(e){};this.showCommentPlaceholder=function(e){thisClass.hideCommentPlaceholder();var componentPlaceholderCount=(Math.floor($("#mfViewerContentComments").height()/$("#mfCommentListPlaceHolderContent").height())-1);if(componentPlaceholderCount>10||componentPlaceholderCount==null||componentPlaceholderCount==0){componentPlaceholderCount=10;}for(var i=0;i<componentPlaceholderCount;i++){$("#mfCommentListLoader").append($("#mfCommentListPlaceHolderContent").html());}$("#mfCommentListLoader").show();$("#mfPageSidebarCommentsBlock").hide();};this.hideCommentPlaceholder=function(e){$("#mfPageSidebarCommentsBlock").show();$("#mfCommentListLoader").hide();$("#mfCommentListLoader").empty();};this.replyFileHandler=function(){if($("#mfReplyAttachBtn").hasClass("ico-trash3")){thisClass.resetReplyAttachment();}else{$("#mfReplyAttachUploadFile").trigger("click");}};this.resetReplyAttachment=function(){thisClass.replyUploadFileTemp=null;$("#mfReplyAttachFileName").text("");$("#mfReplyAttachBtn").removeClass("ico-trash3").addClass("ico-attachment");$("#mfReplyAttachBtn").attr("src","images/editor/attachment.png");$("#mfReplyAttachBtn").parent("span").attr("data-original-title","Attach a file");$("#mfReplyAttachUploadFile").show();$("#mfReplyAttachUploadFile").attr({value:""});};this.uploadAttachment=function(isReply){var fileToUpload=null;if(isReply){fileToUpload=thisClass.replyUploadFileTemp;}else{fileToUpload=thisClass.uploadFileTemp;}if(fileToUpload==null){alert("No file selected");return;}thisClass.showCommentPlaceholder();var currentUploadID=MF_Utils.guidGenerator();var attached="file";var filetype="";var arr2=fileToUpload.name.split(".");if(arr2.length>1){filetype=arr2[arr2.length-1];}else{filetype="";}if(filetype=="png"||filetype=="gif"||filetype=="jpg"){attached="image";}thisClass.newFeedbackObj.attached=filetype;var fd=new FormData();fd.append("company",mf_main.editorController.projectObj.company);fd.append("type",attached);fd.append("ext",filetype);fd.append("size",(parseInt(fileToUpload.size/1024,10)).toString());if(mf_main.PUBLIC){fd.append("username","anonymous@produle.com");}else{fd.append("username",MF_UserSession.getUser().username);}fd.append("projectid",mf_main.editorController.projectObj.id);fd.append("name","Html 5 File API/FormData");fd.append("fileToUpload",fileToUpload);fd.append("mime",fileToUpload.type);fd.append("uid",currentUploadID);fd.append("pageid",mf_main.editorController.page.eid);fd.append("feedbackid",thisClass.newFeedbackObj.id);var xhr=new XMLHttpRequest();xhr.upload.addEventListener("progress",thisClass.uploadProgress,false);xhr.addEventListener("load",thisClass.uploadComplete,false);xhr.addEventListener("error",thisClass.uploadFailed,false);xhr.addEventListener("abort",thisClass.uploadCanceled,false);xhr.open("POST","attach");xhr.send(fd);thisClass.resetAttachment();};this.uploadComplete=function(evt){thisClass.postComment("attachment");};this.uploadProgress=function(evt){if(evt.lengthComputable){var percentComplete=Math.round(evt.loaded*100/evt.total);}else{}};this.resetAttachment=function(){$("#mfAttachBtn").removeClass("ico-trash3").addClass("ico-attachment");thisClass.uploadFileTemp=null;$("#mfAttachFileName").text("");$("#mfAttachBtn").attr("src","images/editor/attachment.png");$("#mfAttachBtn").parent("span").attr("data-original-title","Attach a file");$("#mfAttachUploadFile").show();$("#mfAttachUploadFile").attr({value:""});};this.removeFileHandler=function(){if($("#mfAttachBtn").hasClass("ico-trash3")){thisClass.resetAttachment();}else{$("#mfAttachUploadFile").trigger("click");}};this.uploadFailed=function(evt){alert("There was an error attempting to upload the file.");};this.uploadCanceled=function(evt){alert("The upload has been canceled by the user or the browser dropped the connection.");};this.fileSelectedHandler=function(e){var reply=false;if(e.target.id=="mfReplyAttachUploadFile"){var idPrefix="mfReplyAttach";reply=true;}else{var idPrefix="mfAttach";}var file=document.getElementById(idPrefix+"UploadFile").files[0];var pass=true;if(file){var fileSize=0;fileSize=parseInt(file.size/1024,10);fileSize=fileSize/1000;if(fileSize>50){pass=false;alert("The allowed file size is 50 MB or less.");$("#"+idPrefix+"UploadFile").attr({value:""});thisClass.uploadFileTemp=null;return false;}if(pass){if(reply){thisClass.replyUploadFileTemp=file;}else{thisClass.uploadFileTemp=file;}var filename=$(this).val();var lastIndex=filename.lastIndexOf("\\");if(lastIndex>=0){filename=filename.substring(lastIndex+1);}$("#"+idPrefix+"FileName").text(filename);$("#"+idPrefix+"Btn").removeClass("ico-attachment").addClass("ico-trash3");$("#"+idPrefix+"Btn").attr("src","images/editor/waste2.png");$("#"+idPrefix+"Btn").parent("span").attr("data-original-title","Remove Attachment");$("#"+idPrefix+"UploadFile").hide();}}};this.postCommentHandler=function(e){if(mf_main.PUBLIC){if($.trim($("#mfPublicCommentNameInput").val())==""){MF_Utils.display_ActionIndicator("Name is required");return;}}var feedbackmsg=$.trim($("#mfCommentPost").val());if(feedbackmsg==""){MF_Utils.display_ActionIndicator("Message cannot be empty");return;}thisClass.postComment(null);};this.postCommentHandler2=function(e){if(mf_main.PUBLIC){if($.trim($("#mfPublicCommentNameInput").val())==""){MF_Utils.display_ActionIndicator("Name is required");return;}}var feedbackmsg=$.trim($("#mfCommentPost").val());if(feedbackmsg==""){MF_Utils.display_ActionIndicator("Message cannot be empty");return;}thisClass.postComment(null);};this.replyCommentHandler=function(e){thisClass.replyEnableHide=false;if(mf_main.PUBLIC){if($.trim($("#mfPublicReplyNameInput").val())==""){MF_Utils.display_ActionIndicator("Name is required");return;}}var feedbackmsg=$.trim($("#mfCommentReplyPost").val());if(feedbackmsg==""){MF_Utils.display_ActionIndicator("Message cannot be empty");return;}if(thisClass.selectedComment){var replyid=thisClass.selectedComment.id;if(thisClass.selectedComment.reply!=null){replyid=thisClass.selectedComment.reply;}thisClass.postComment(replyid);}};this.postComment=function(replyid){var feedback=new MF_Feedback();if(replyid=="attachment"){feedback=thisClass.newFeedbackObj;thisClass.newFeedbackObj=null;}else{var hasAnnotation=false;if($("#mfAnnotateArrow").css("display")=="block"){hasAnnotation=true;}$("#mfAnnotateArrow").css("display","none");$("#mfAnnotateArrow2").css("display","none");if(replyid!=null){var feedbackmsg=$.trim($("#mfCommentReplyPost").val());$("#mfCommentReplyPost").val("");$(".mfCommentReplyInlineBtn").text("Reply");$(".mfCommentsHideableElement").show();if(mf_main.PUBLIC){$("#mfPageSidebarPost").height(175);}else{$("#mfPageSidebarPost").height(130);}$("#mfPageSidebarComments").height($("#mfPageSidebarCommentsBlock").height()-$("#mfPageSidebarHeader").height()-$("#mfPageSidebarPost").height()-20);$("#mfPageSidebarPost").prepend($("#mfCommentReplyContainer"));$("#mfCommentReplyContainer").hide();}else{var feedbackmsg=$.trim($("#mfCommentPost").val());}if(feedbackmsg==""){MF_Utils.display_ActionIndicator("Message cannot be empty");return;}feedbackmsg=feedbackmsg.replaceAll("&nbsp;"," ");feedbackmsg=Handlebars.Utils.escapeExpression(feedbackmsg);mf_main.editorController.commentController.cachedPageComments[mf_main.editorController.page.eid]=null;feedback=new MF_Feedback();feedback.id=MF_Utils.guidGenerator();thisClass.closeCommentHandler();if(!mf_main.PUBLIC){feedback.creator=MF_UserSession.getUser().username;}feedback.clientid=mf_main.editorController.projectObj.company;feedback.createDate=new Date();feedback.projectid=mf_main.editorController.projectObj.id;feedback.pageid=mf_main.editorController.page.eid;feedback.message=feedbackmsg;feedback.canDelete=true;if(!mf_main.PUBLIC){feedback.canEdit=true;}if(replyid!=null){feedback.reply=replyid;}var emailReplyID=feedback.reply;if(emailReplyID==null){emailReplyID=feedback.id;}if(mf_main.PUBLIC){feedback.creator="anonymous@produle.com";if(replyid!=null){feedback.creatorName=$("#mfPublicReplyNameInput").val();}else{feedback.creatorName=$("#mfPublicCommentNameInput").val();}}else{feedback.creatorName=MF_UserSession.getUser().firstName+" "+MF_UserSession.getUser().lastName;}if(hasAnnotation&&draggedPos.x>=0&&draggedPos.y>=0){feedback.pos=draggedPos.x.toString()+","+draggedPos.y.toString();}draggedPos.x=-1;draggedPos.y=-1;if(replyid==null&&thisClass.uploadFileTemp!=null){thisClass.newFeedbackObj=feedback;thisClass.uploadAttachment(false);return;}if(replyid!=null&&thisClass.replyUploadFileTemp!=null){thisClass.newFeedbackObj=feedback;thisClass.uploadAttachment(true);return;}}if(replyid!=null){thisClass.replyUploadFileTemp=null;$("#mfReplyAttachFileName").text("");$("#mfReplyAttachBtn").removeClass("ico-trash3").addClass("ico-attachment");$("#mfReplyAttachBtn").attr("src","images/editor/attachment.png");$("#mfReplyAttachBtn").parent("span").attr("data-original-title","Attach a file");$("#mfReplyAttachUploadFile").show();$("#mfReplyAttachUploadFile").attr({value:""});$("#mfPublicReplyNameInput").val("");}thisClass.showCommentPlaceholder();thisClass.cachedPageComments[mf_main.editorController.page.eid]=null;var template=mf_main.getTemplateFromCache("mfCommentItemTemplate");if(feedback.reply!=null){var currentSibling=$("#mfCommentItem"+feedback.reply);var nextSibling=$("#mfCommentItem"+feedback.reply).next();var isReplyAppended=false;if(nextSibling.length>0){while(!isReplyAppended){if(nextSibling.attr("data-isreply")=="false"){$(template(feedback)).insertAfter(currentSibling);isReplyAppended=true;}else{currentSibling=nextSibling;nextSibling=nextSibling.next();if(nextSibling.length==0){$(template(feedback)).insertAfter(currentSibling);isReplyAppended=true;}}}}else{$(template(feedback)).insertAfter(currentSibling);}}else{if(template){$("#mfPageSidebarComments").prepend(template(feedback));}}$("#mfCommentPost").val("");thisClass.hideCommentPlaceholder();mf_main.editorController.page.comments++;thisClass.bindCommentEvents();thisClass.setCommentNum();MF_FeedbackManager.create(MF_UserSession.getUser(),mf_main.PUBLIC,mf_main.editorController.projectObj.company,feedback,false,{callback:function(arr){MF_Utils.display_ActionIndicator("Comment has been posted");if(arr!=null){thisClass.cachedPageComments[mf_main.editorController.page.eid]=arr;thisClass.listCommentsByPage(arr);mf_main.editorController.page.comments=arr.length;thisClass.setCommentNum();if(feedback&&feedback.reply==null){$("#mfPageSidebarComments").scrollTop(0);}mf_main.rtc.commentSync("addComment",feedback);var logcmd="COMMENTED";var logdata={projectid:mf_main.editorController.projectObj.id,projectname:mf_main.editorController.projectObj.title,pageid:mf_main.editorController.page.eid};var logMessage=mf_main.logController.getLogMessage(logcmd,logdata);var rtcObj=new MF_EditorRTCItem();rtcObj.logcmd=logcmd;rtcObj.logdata=logdata;rtcObj.messageStr=logMessage;rtcObj.collaborators=mf_main.editorController.powerupController.getRTCCollaboratorList();mf_main.dashboardRtcController.notification_sync(rtcObj);mf_main.logController.logSpaceAction(logcmd,logMessage,logdata,rtcObj.collaborators);}}});MF_LogManager.sendNotification2(mf_main.editorController.projectObj,feedback.creator,feedback.creatorName,feedback.message,mf_main.editorController.page.eid,mf_main.editorController.page.pageName,feedback.id,{callback:function(){}});mf_main.interfaceResize();};this.bindCommentEvents=function(){$(".mfCommentListItemCls").off("mouseover",thisClass.commentItemOver);$(".mfCommentListItemCls").off("mouseout",thisClass.commentItemOut);$(".mfCommentItemWrapper").off("click",thisClass.commentItemClick);$(".mfCommentListItemCls").on("mouseover",thisClass.commentItemOver);$(".mfCommentListItemCls").on("mouseout",thisClass.commentItemOut);$(".mfCommentItemWrapper").on("click",thisClass.commentItemClick);$(".mfCommentDeleteBtn").off("click",thisClass.deleteCommentHandler);$(".mfCommentEditBtn").off("click",thisClass.editCommentHandler);$(".mfCommentDeleteBtn").on("click",thisClass.deleteCommentHandler);$(".mfCommentEditBtn").on("click",thisClass.editCommentHandler);};this.deleteCommentHandler=function(e){e.stopPropagation();thisClass.resetEditBox();thisClass.resetCommentBox();mf_main.interfaceResize();var commentId=$(this).closest(".mfCommentDeleteBtn").attr("id").replace("mfCommentDeleteBtn","");bootbox.confirm("Do you want to delete this comment and its replies?",function(answer){if(answer){thisClass.selectedComment=thisClass.getCommentbyID("mfCommentItem"+commentId);if(thisClass.selectedComment){$(".tooltip").tooltip("hide");var feedback=thisClass.selectedComment;thisClass.cachedPageComments[mf_main.editorController.page.eid]=null;thisClass.showCommentPlaceholder();var selid=mf_main.editorController.page.eid;if(feedback!=null){var find=thisClass.commentCollection.getItemIndex(feedback);if(find!=-1){var delcount=0;var farr=thisClass.commentCollection.toArray();for(var i=0;i<farr.length;i++){var item=farr[i];if(item.reply==feedback.id){var gind=thisClass.commentCollection.getItemIndex(item);if(gind!=-1){thisClass.commentCollection.removeItemAt(gind);delcount++;}}}thisClass.commentCollection.removeItemAt(find);var arr=thisClass.commentCollection.toArray();var pageid1=mf_main.editorController.page.eid;mf_main.editorController.page.comments=arr.length;thisClass.cachedPageComments[mf_main.editorController.page.eid]=arr;thisClass.listCommentsByPage(arr);}var selfeed=thisClass.selectedComment;if(selfeed!=null){thisClass.selectComment("mfCommentItem"+selfeed.id);}thisClass.hideCommentPlaceholder();thisClass.hideAnnotationPointer();thisClass.setCommentNum();thisClass.selectedComment=null;MF_FeedbackManager.deleteFeedback(MF_UserSession.getUser(),mf_main.PUBLIC,mf_main.editorController.projectObj.company,feedback,{callback:function(arr){MF_Utils.display_ActionIndicator("Comment has been deleted");if(arr!=null){thisClass.cachedPageComments[mf_main.editorController.page.eid]=arr;thisClass.listCommentsByPage(arr,false);mf_main.rtc.commentSync("delComment",feedback);}}});}}}});};this.editCommentHandler=function(e){e.stopPropagation();var commentId=$(this).attr("id").replace("mfCommentEditBtn","");thisClass.hideAnnotationPointer();if($("#mfCommentEditBtn"+commentId+" i").hasClass("fa-close")){thisClass.resetEditBox();mf_main.interfaceResize();$("#mfCommentEditBtn"+commentId).tooltip("show");}else{$(".mfCommentEditBtn i").removeClass("fa-close");$(".mfCommentEditBtn i").addClass("fa-edit");$(".mfCommentEditBtn").attr("title","Edit").tooltip("fixTitle");thisClass.resetCommentBox();thisClass.selectedComment=thisClass.getCommentbyID("mfCommentItem"+commentId);if(thisClass.selectedComment){$("#mfCommentEditPost").val(MF_Utils.htmlUnescape(thisClass.selectedComment.message));thisClass.annotateUpdated=false;thisClass.editCommentPos=thisClass.selectedComment.pos;thisClass.placeCommentAnnotation("mfAnnotateArrow2");thisClass.selectedComment=thisClass.getCommentbyID("mfCommentItem"+commentId);thisClass.highlightSelectedComment(thisClass.selectedComment.id);$("#mfCommentEditBtn"+commentId+" i").removeClass("fa-edit");$("#mfCommentEditBtn"+commentId+" i").addClass("fa-close");$("#mfCommentEditBtn"+commentId).attr("title","Close").tooltip("fixTitle").tooltip("show");$(".mfCommentReplyInlineBtn").text("Reply");$("#mfCommentReplyContainer").hide();$("#mfCommentEditContainer").insertAfter($("#mfCommentItem"+commentId));$("#mfCommentEditContainer").show();$("#mfCommentEditPost").focus();var editCoordinates=MF_Utils.localToGlobal(document.getElementById("mfCommentEditPost"));var commentListCoordinates=$("#mfPageSidebarComments");var viewport={top:commentListCoordinates.scrollTop(),left:commentListCoordinates.scrollLeft()};viewport.right=viewport.left+commentListCoordinates.width();viewport.bottom=viewport.top+commentListCoordinates.height();if(editCoordinates.top>(viewport.bottom-100)){$("#mfPageSidebarComments").scrollTop(viewport.top+100);}$(".mfCommentsHideableElement").hide();$("#mfPageSidebarPost").height(0);$("#mfPageSidebarComments").height($("#mfPageSidebarCommentsBlock").height()-$("#mfPageSidebarHeader").height());}mf_main.interfaceResize();}};this.resetEditBox=function(){$(".mfCommentEditBtn i").removeClass("fa-close");$(".mfCommentEditBtn i").addClass("fa-edit");$(".mfCommentEditBtn").attr("title","Edit").tooltip("fixTitle");thisClass.hideAnnotationPointer();if($("#mfCommentEditContainer").css("display")=="block"){$(".mfCommentsHideableElement").show();if(mf_main.PUBLIC){$("#mfPageSidebarPost").height(175);}else{$("#mfPageSidebarPost").height(130);}$("#mfPageSidebarComments").height($("#mfPageSidebarCommentsBlock").height()-$("#mfPageSidebarHeader").height()-$("#mfPageSidebarPost").height()-20);$("#mfPageSidebarPost").prepend($("#mfCommentEditContainer"));$("#mfCommentEditContainer").hide();}};this.refreshCommentHandler=function(){thisClass.reset();thisClass.cachedPageComments[mf_main.editorController.page.eid]=null;thisClass.getCommentsByPage(mf_main.editorController.page.eid);};this.reset=function(){thisClass.resetCommentBox();thisClass.resetEditBox();thisClass.commentCollection=new ArrayCollection();$("#mfPageSidebarComments").empty();thisClass.selectedComment=null;};this.resetCommentBox=function(){if($("#mfCommentReplyContainer").css("display")=="block"){$(".mfCommentsHideableElement").show();if(mf_main.PUBLIC){$("#mfPageSidebarPost").height(175);}else{$("#mfPageSidebarPost").height(130);}$("#mfPageSidebarComments").height($("#mfPageSidebarCommentsBlock").height()-$("#mfPageSidebarHeader").height()-$("#mfPageSidebarPost").height()-20);$("#mfPageSidebarPost").prepend($("#mfCommentReplyContainer"));$("#mfCommentReplyContainer").hide();$(".mfCommentReplyInlineBtn").text("Reply");thisClass.hideAnnotationPointer();}};this.setCommentNum=function(){if(mf_main.editorController.page.comments>0){$(".mfViewerCommentNum").show();$(".mfViewerCommentNum").text(mf_main.editorController.page.commentStr);if(mf_main.editorController.EDITOR){$("#mfViewerCommentNumBtn").hide();}}else{$(".mfViewerCommentNum").hide();}};this.getCommentsByPage=function(pageid){if(mf_main.RENDER||mf_main.REVISION||mf_main.INTEGRATION){return;}var commentArr=thisClass.cachedPageComments[pageid];thisClass.showCommentPlaceholder();if(commentArr!=null){thisClass.listCommentsByPage(commentArr);thisClass.setCommentNum();}else{if(mf_main.PUBLIC){if(mf_main.editorController.projectObj.enableComments==false){return;}}MF_FeedbackManager.listByPage(MF_UserSession.getUser(),mf_main.PUBLIC,mf_main.editorController.projectObj.company,mf_main.editorController.projectObj.id,pageid,false,{callback:function(arr){if(arr!=null){thisClass.cachedPageComments[pageid]=arr;thisClass.listCommentsByPage(arr);if(pageid==mf_main.editorController.page.eid){mf_main.editorController.page.comments=arr.length;thisClass.setCommentNum();}}}});}};this.listCommentsByPage=function(arr,resetSelectedComment){if(typeof resetSelectedComment=="undefined"){resetSelectedComment=true;}thisClass.resetCommentBox();thisClass.resetEditBox();if(resetSelectedComment){thisClass.selectedComment=null;}$("#mfPageSidebarComments").empty();var cachedTemplate=mf_main.getTemplateFromCache("mfCommentItemTemplate");if(cachedTemplate==null){$.get("templates/editor/CommentItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfCommentItemTemplate").html());mf_main.addTemplateToCache("mfCommentItemTemplate",template);thisClass.renderCommentListing(arr,template);});}else{thisClass.renderCommentListing(arr,cachedTemplate);}};this.renderCommentListing=function(arr,template){thisClass.commentCollection=new ArrayCollection();$("#mfPageSidebarComments").empty();for(var i=0,j=arr.length;i<j;i++){var citem=new MF_Feedback();citem.cast(arr[i]);thisClass.commentCollection.addItem(citem);$("#mfPageSidebarComments").append(template(citem));}$("[class=mfcommenttooltip]").tooltip({animation:false});thisClass.hideCommentPlaceholder();thisClass.bindCommentEvents();};this.commentItemOver=function(e){var div=thisClass.getCommentByHTMLID($(this).attr("id"),"mfCommentItemMsg");if(thisClass.selectedComment!=null&&("mfCommentItemMsg"+thisClass.selectedComment.id)==$(this).attr("id")){}else{if(div){$("#mfCommentItemCreator"+div.id).css({color:"#000"});$("#mfCommentItemMessage"+div.id).css({color:"#000"});}}};this.commentItemOut=function(e){var div=thisClass.getCommentByHTMLID($(this).attr("id"),"mfCommentItemMsg");if(thisClass.selectedComment!=null&&("mfCommentItemMsg"+thisClass.selectedComment.id)==$(this).attr("id")){}else{if(div){$("#mfCommentItemCreator"+div.id).css({color:"#3D4F9B"});$("#mfCommentItemMessage"+div.id).css({color:"#666"});}}};this.clearCommentSelection=function(){thisClass.selectedComment=null;for(var i=0;i<thisClass.commentCollection.size();i++){var item=thisClass.commentCollection.getItemAt(i);$("#mfCommentItemContainer"+item.id).css({"background-color":"transparent"});$("#mfCommentItemCreator"+item.id).css({color:"#3D4F9B"});$("#mfCommentItemMessage"+item.id).css({color:"#666"});}};this.selectComment=function(pid,mid){if(mid==null){mid="mfCommentItem";}var currentSelection=thisClass.selectedComment;thisClass.clearCommentSelection();$(".mfCommentReplyInlineBtn").text("Reply");thisClass.resetCommentBox();thisClass.resetEditBox();mf_main.interfaceResize();for(var i=0;i<thisClass.commentCollection.size();i++){var item=thisClass.commentCollection.getItemAt(i);if(mid+item.id==pid){if(currentSelection==item){thisClass.clearCommentSelection();}else{thisClass.selectedComment=item;thisClass.highlightSelectedComment(item.id);}break;}}};this.highlightSelectedComment=function(pid){$("#mfCommentItemCreator"+pid).css({color:"#0000FF"});$("#mfCommentItemMessage"+pid).css({color:"#0000FF"});};this.getCommentByHTMLID=function(pid,mid){if(mid==null){mid="mfCommentItem";}for(var i=0;i<thisClass.commentCollection.size();i++){var item=thisClass.commentCollection.getItemAt(i);if(mid+item.id==pid){return item;break;}}return null;};this.getCommentbyID=function(pid){thisClass.clearCommentSelection();for(var i=0;i<thisClass.commentCollection.size();i++){var item=thisClass.commentCollection.getItemAt(i);if("mfCommentItem"+item.id==pid){return item;break;}}return null;};this.commentItemClick=function(e){var scid="";if(thisClass.selectedComment){scid=thisClass.selectedComment.id;}if(thisClass.selectedComment){thisClass.hideAnnotationPointer();thisClass.clearCommentSelection();}if(("mfCommentItem"+scid)!=$(this).attr("id")){thisClass.hideAnnotationPointer();thisClass.selectComment($(this).attr("id"));if(thisClass.selectedComment&&thisClass.selectedComment.pos){thisClass.placeCommentAnnotation("mfAnnotateArrow2");}}else{if(!$(e.target).hasClass("mfCommentReplyInlineBtn")&&!$(e.target.parentElement).hasClass("mfCommentEditBtn")){$(".mfCommentReplyInlineBtn").text("Reply");thisClass.resetCommentBox();thisClass.resetEditBox();mf_main.interfaceResize();}}};this.mouseDownHandler=function(e){if(e.which===1){thisClass.leftButtonDown=true;try{if(e.target.id=="mfCommentAnnotateBtn"){thisClass.clearCommentSelection();}}catch(e){}$("#mfAnnotateArrow2").css("display","none");$("#mfAnnotateArrow").css("display","block");$("#mfAnnotateArrow").width(0);$("#mfAnnotateArrow").height(0);startPos.x=e.pageX;startPos.y=e.pageY;draggedPos.x=-1;draggedPos.y=-1;}};this.drawAndPlaceAnnotation=function(endx,endy,annotatestr){if(annotatestr==null){annotatestr="mfAnnotateArrow";}var direction="topLeft";var ctx_Div=(document.getElementById(annotatestr)).getContext("2d");ctx_Div.clearRect(0,0,$("#"+annotatestr).width(),$("#"+annotatestr).height());var newX=endx+5;var newY=endy+5;var minusY=false;var minusX=false;if(startPos.y>endy){$("#"+annotatestr).height(startPos.y-endy);}else{$("#"+annotatestr).height(endy-startPos.y);newY=endy-$("#"+annotatestr).height();minusY=true;}if(startPos.x>endx){$("#"+annotatestr).width(startPos.x-endx);}else{$("#"+annotatestr).width(endx-startPos.x);newX=endx-$("#"+annotatestr).width();minusX=true;}if(minusX&&minusY){direction="downRight";}if(minusX&&!minusY){direction="topRight";}if(!minusX&&minusY){direction="downLeft";}if(direction=="topLeft"||direction=="downLeft"){if($("#"+annotatestr).width()<30){$("#"+annotatestr).width($("#"+annotatestr).width()+20);}if($("#"+annotatestr).height()<30){$("#"+annotatestr).height($("#"+annotatestr).height()+20);}}else{$("#"+annotatestr).width($("#"+annotatestr).width());}$("#"+annotatestr).css({position:"absolute",top:newY,left:newX});var c=document.getElementById(annotatestr);c.width=$("#"+annotatestr).width();c.height=$("#"+annotatestr).height();if(direction=="topLeft"){thisClass.drawAnnotationArrow($("#"+annotatestr).width(),$("#"+annotatestr).height(),10,10,annotatestr);}if(direction=="downRight"){thisClass.drawAnnotationArrow(0,0,$("#"+annotatestr).width()-10,$("#"+annotatestr).height()-10,annotatestr);}if(direction=="topRight"){thisClass.drawAnnotationArrow(0,$("#"+annotatestr).height(),$("#"+annotatestr).width()-10,10,annotatestr);}if(direction=="downLeft"){thisClass.drawAnnotationArrow($("#"+annotatestr).width(),0,10,$("#"+annotatestr).height()-10,annotatestr);}};this.mouseMoveHandler=function(e){if($("#mfAnnotateArrow").css("display")=="block"){if(thisClass.leftButtonDown){thisClass.annotateUpdated=true;thisClass.drawAndPlaceAnnotation(e.pageX,e.pageY);}}if(($("#"+thisClass.noteAnnotateID).css("display")=="block")&&thisClass.NOTEANNOTATEMODE){if(thisClass.leftButtonDown){thisClass.drawAndPlaceNoteAnnotation(e.pageX,e.pageY);}}};this.setNoteArrow=function(sx,sy,noteid,notecomp,direction){startPos.x=sx;startPos.y=sy;draggedPos.x=-1;draggedPos.y=-1;$("#mfVideoChatAnnotateArrow").width(0);$("#mfVideoChatAnnotateArrow").height(0);thisClass.noteAnnotateID="mfVideoChatAnnotateArrow";thisClass.leftButtonDown=true;thisClass.noteComp=notecomp;thisClass.NOTEANNOTATEMODE=true;thisClass.noteArrowDirection=direction;$("#mfVideoChatAnnotateArrow").css("display","block");};this.drawAndPlaceNoteAnnotation=function(endx,endy,annotatestr){if(annotatestr==null){annotatestr="mfVideoChatAnnotateArrow";}var direction="topLeft";var ctx_Div=(document.getElementById(annotatestr)).getContext("2d");ctx_Div.clearRect(0,0,$("#"+annotatestr).width(),$("#"+annotatestr).height());var newX=endx+5;var newY=endy+5;var minusY=false;var minusX=false;if(startPos.y>endy){$("#"+annotatestr).height(startPos.y-endy);}else{$("#"+annotatestr).height(endy-startPos.y);newY=endy-$("#"+annotatestr).height();minusY=true;}if(startPos.x>endx){$("#"+annotatestr).width(startPos.x-endx);}else{$("#"+annotatestr).width(endx-startPos.x);newX=endx-$("#"+annotatestr).width();minusX=true;}if(minusX&&minusY){direction="downRight";}if(minusX&&!minusY){direction="topRight";}if(!minusX&&minusY){direction="downLeft";}if(direction=="topLeft"||direction=="downLeft"){if($("#"+annotatestr).width()<30){$("#"+annotatestr).width($("#"+annotatestr).width()+20);}if($("#"+annotatestr).height()<30){$("#"+annotatestr).height($("#"+annotatestr).height()+20);}}else{$("#"+annotatestr).width($("#"+annotatestr).width());}$("#"+annotatestr).css({position:"absolute",top:newY,left:newX});var c=document.getElementById(annotatestr);c.width=$("#"+annotatestr).width();c.height=$("#"+annotatestr).height();if(direction=="topLeft"){thisClass.drawAnnotationNoteArrow($("#"+annotatestr).width(),$("#"+annotatestr).height(),10,10,annotatestr);}if(direction=="downRight"){thisClass.drawAnnotationNoteArrow(0,0,$("#"+annotatestr).width()-10,$("#"+annotatestr).height()-10,annotatestr);}if(direction=="topRight"){thisClass.drawAnnotationNoteArrow(0,$("#"+annotatestr).height(),$("#"+annotatestr).width()-10,10,annotatestr);}if(direction=="downLeft"){thisClass.drawAnnotationNoteArrow($("#"+annotatestr).width(),0,10,$("#"+annotatestr).height()-10,annotatestr);}};this.drawAnnotationNoteArrow=function(start_x,start_y,end_x,end_y,arrowid){var ctx_Div=(document.getElementById(arrowid)).getContext("2d");thisClass.drawArrow(start_x,start_y,end_x,end_y,ctx_Div,"rgba(255, 0, 0, 1)");};this.mouseUpHandler=function(e){if($("#mfAnnotateArrow").css("display")=="block"){if((e.pageX<$("#mfAnnotateArrow").offset().left+30)&&thisClass.leftButtonDown){thisClass.hideAnnotationPointer(false);}else{thisClass.saveAnnotation(e.pageX,e.pageY);}}if(thisClass.noteComp&&thisClass.NOTEANNOTATEMODE){var imageref="mfContainerPage";$("#mfVideoChatAnnotateArrow").hide();var ndraggedPos=MF_Utils.globalToLocalPoint2(e.pageX,e.pageY,imageref);if($("#"+thisClass.noteAnnotateID).width()<5){thisClass.noteComp.e2xml.addPropSingle("notePointer","");thisClass.noteComp.render(false);}else{ndraggedPos.x=ndraggedPos.x+5;ndraggedPos.y=ndraggedPos.y+5;if(!mf_main.editorController.sidebarShow){ndraggedPos.x=ndraggedPos.x-10;ndraggedPos.y=ndraggedPos.y;}ndraggedPos.x=Math.round(ndraggedPos.x/mf_main.editorController.SCALE);ndraggedPos.y=Math.round(ndraggedPos.y/mf_main.editorController.SCALE);thisClass.noteComp.e2xml.addPropSingle("notePointer",ndraggedPos.x+","+ndraggedPos.y+","+thisClass.noteArrowDirection);thisClass.noteComp.render(false);}}thisClass.noteAnnotateID="mfVideoChatAnnotateArrow";thisClass.noteComp=null;thisClass.NOTEANNOTATEMODE=false;if(e.which===1){thisClass.leftButtonDown=false;}};this.drawAndPlaceSavedNoteAnnotation=function(endx,endy,arrowid,direction,lx,ly){var direction="topLeft";var stx=startPos.x;var sty=startPos.y;if(lx!=null){stx=lx;}if(ly!=null){sty=ly;}var ctx_Div=(document.getElementById(arrowid)).getContext("2d");ctx_Div.clearRect(0,0,$("#"+arrowid).width(),$("#"+arrowid).height());var newX=endx+5;var newY=endy+5;var minusY=false;var minusX=false;if(sty>endy){$("#"+arrowid).height(sty-endy);}else{$("#"+arrowid).height(endy-sty);newY=endy-$("#"+arrowid).height();minusY=true;}if(stx>endx){$("#"+arrowid).width(stx-endx);}else{$("#"+arrowid).width(endx-stx);newX=endx-$("#"+arrowid).width();minusX=true;}if(minusX&&minusY){direction="downRight";}if(minusX&&!minusY){direction="topRight";}if(!minusX&&minusY){direction="downLeft";}if(direction=="topLeft"||direction=="downLeft"){if($("#"+arrowid).width()<30){$("#"+arrowid).width($("#"+arrowid).width()+20);}if($("#"+arrowid).height()<30){$("#"+arrowid).height($("#"+arrowid).height()+20);}}else{$("#"+arrowid).width($("#"+arrowid).width());}var nx=newX;if(mf_main.editorController.sidebarShow){if(direction=="left"){nx=nx-mf_main.editorController.leftMargin-20;}else{nx=nx-mf_main.editorController.leftMargin;}}else{if(direction=="left"){nx=nx-0;}else{nx=nx-mf_main.editorController.leftMargin;}}var ny=newY;if(!mf_main.RENDER){}nx=nx+mf_main.editorController.leftMargin-$("#mfContainerPage").offset().left;ny=ny-$("#mfContainerPage").offset().top;$("#"+arrowid).css({position:"absolute",top:ny,left:nx});var c=document.getElementById(arrowid);c.width=$("#"+arrowid).width();c.height=$("#"+arrowid).height();if(direction=="topLeft"){thisClass.drawAnnotationNoteArrow($("#"+arrowid).width(),$("#"+arrowid).height(),10,10,arrowid);}if(direction=="downRight"){thisClass.drawAnnotationNoteArrow(0,0,$("#"+arrowid).width()-10,$("#"+arrowid).height()-10,arrowid);}if(direction=="topRight"){thisClass.drawAnnotationNoteArrow(0,$("#"+arrowid).height(),$("#"+arrowid).width()-10,10,arrowid);}if(direction=="downLeft"){thisClass.drawAnnotationNoteArrow($("#"+arrowid).width(),0,10,$("#"+arrowid).height()-10,arrowid);}};this.saveAnnotation=function(x,y){if($("#mfAnnotateArrow").css("display")=="block"&&thisClass.leftButtonDown){var imageref="mfContainerPage";draggedPos=MF_Utils.globalToLocalPoint2(x,y,imageref);draggedPos.x=Math.round(draggedPos.x/mf_main.editorController.SCALE);draggedPos.y=Math.round(draggedPos.y/mf_main.editorController.SCALE);var autoSize=true;var pwidth=500;var pheight=500;if(mf_main.editorController.projectObj.sizeType!="sizeless"){autoSize=false;pwidth=mf_main.editorController.projectObj.origWidth;pheight=mf_main.editorController.projectObj.origHeight;}if(mf_main.editorController.page.overrideSize){if(mf_main.editorController.page.sizeType!="sizeless"){autoSize=false;pwidth=mf_main.editorController.page.origWidth;pheight=mf_main.editorController.page.origHeight;}else{autoSize=true;}}if(autoSize==false){var saveptr=false;if(draggedPos.x<=pwidth&&draggedPos.y<=pheight-15){saveptr=true;}if(saveptr==false){thisClass.hideAnnotationPointer(false);}}}};this.placeCommentAnnotation=function(annotatestr,noscroll){if(annotatestr==null){annotatestr="mfAnnotateArrow";}if(thisClass.selectedComment&&thisClass.selectedComment.pos){var arr=thisClass.selectedComment.pos.split(",");if(arr.length==2){$("#"+annotatestr).css("display","block");$("#"+annotatestr).width(0);$("#"+annotatestr).height(0);var rect=MF_Utils.localToGlobal(document.getElementById("mfCommentAnnotateBtn"));startPos.x=rect.left;startPos.y=rect.top;if(annotatestr=="mfAnnotateArrow2"){startPos.y=10;startPos.x=mf_main.editorController.leftMargin;}draggedPos.x=Math.round(parseInt(arr[0])*mf_main.editorController.SCALE);draggedPos.y=Math.round(parseInt(arr[1])*mf_main.editorController.SCALE);if(annotatestr=="mfAnnotateArrow2"){draggedPos.y=draggedPos.y+25;}var imageref="mfContainerPage";var gcoord=MF_Utils.localToGlobalPoint(draggedPos.x,draggedPos.y,imageref);thisClass.drawAndPlaceAnnotation(gcoord.x,gcoord.y,annotatestr);if(noscroll){}else{if($("#mfAnnotateArrow").css("display")=="block"||$("#mfAnnotateArrow2").css("display")=="block"){$("#mfEditorHolder").animate({scrollTop:(draggedPos.y-100),scrollLeft:(draggedPos.x-100)},1000,function(){});}}}}else{if($("#mfAnnotateArrow").css("display")!="block"){thisClass.hideAnnotationPointer(false);}}};this.placeNoteAnnotation=function(notepointid,notearrowid,direction,x,y,comp){if(mf_main.editorController.SCALE!=1&&!mf_main.editorController.autoSize){$("#mfContainerPage").css("transform-origin","top left");$("#mfContainerPage").css("-webkit-transform-origin","top left");}$("#"+notearrowid).css("display","block");$("#"+notearrowid).width(0);$("#"+notearrowid).height(0);var rect=MF_Utils.localToGlobal(document.getElementById(notepointid));var stx=rect.left-comp.x+20;var sty=rect.top-comp.y+20;stx=stx-$("#mfEditorHolder").scrollLeft();sty=sty-$("#mfEditorHolder").scrollTop();var imageref="mfContainerPage";var gcoord=MF_Utils.localToGlobalPoint(parseInt(x),parseInt(y),imageref);if(!mf_main.RENDER){}else{}thisClass.drawAndPlaceSavedNoteAnnotation(gcoord.x-comp.x,gcoord.y-comp.y,notearrowid,direction,stx,sty);if(mf_main.editorController.SCALE!=1&&!mf_main.editorController.autoSize){$("#mfContainerPage").css("transform-origin","center");$("#mfContainerPage").css("-webkit-transform-origin","center");}};this.drawAnnotationArrow=function(start_x,start_y,end_x,end_y,annotatestr){if(annotatestr==null){annotatestr="mfAnnotateArrow";}var ctx_Div=(document.getElementById(annotatestr)).getContext("2d");thisClass.drawArrow(start_x,start_y,end_x,end_y,ctx_Div,"rgba(255, 0, 0, 1)");};this.drawArrow=function(start_x,start_y,end_x,end_y,ctx_Arrow,arrowColor){var asize=30;var apoint=asize-5;var angle1=(Math.PI)/8;var angle2=(15*Math.PI)/8;if((end_y>start_y)&&(end_x>start_x)){var slope_sign=1;var x_sign=-1;}if((end_y<start_y)&&(end_x<start_x)){var slope_sign=1;var x_sign=1;}if((end_y<start_y)&&(end_x>start_x)){var slope_sign=-1;var x_sign=-1;}if((end_y>start_y)&&(end_x<start_x)){var slope_sign=-1;var x_sign=1;}if(end_y==start_y){var slope_sign=1;var x_sign=-((end_x-start_x)/Math.abs(end_x-start_x));}var arrow_height=Math.abs(end_y-start_y);var arrow_width=Math.abs(end_x-start_x);ctx_Arrow.shadowOffsetX=0;ctx_Arrow.shadowOffsetY=2;ctx_Arrow.shadowBlur=10;ctx_Arrow.shadowColor="rgba(0, 0, 0, 0.5)";ctx_Arrow.strokeStyle=arrowColor;ctx_Arrow.moveTo(start_x,start_y);ctx_Arrow.lineTo(end_x,end_y);ctx_Arrow.fillStyle=arrowColor;if(arrow_width!=0){var slope=slope_sign*(arrow_height/arrow_width);var d=asize;var x=x_sign*(Math.sqrt((d*d)/(1+(slope*slope))));var y=slope*x;d=apoint;var x3=x_sign*(Math.sqrt((d*d)/(1+(slope*slope))));var y3=slope*x3;}else{var y_sign=-((end_y-start_y)/Math.abs(end_y-start_y));var x=0;var y=y_sign*asize;var x3=0;var y3=y_sign*apoint;}ctx_Arrow.save();ctx_Arrow.translate(end_x,end_y);var x1=(x*Math.cos(angle1))-(y*Math.sin(angle1));var y1=(x*Math.sin(angle1))+(y*Math.cos(angle1));var x2=(x*Math.cos(angle2))-(y*Math.sin(angle2));var y2=(x*Math.sin(angle2))+(y*Math.cos(angle2));var x4=(x1+x3)/3;var y4=(y1+y3)/3;var x5=(x3+x2)/3;var y5=(y3+y2)/3;var s_x=x_sign*arrow_width;var s_y=slope*s_x;ctx_Arrow.fillStyle=arrowColor;ctx_Arrow.strokeStyle=arrowColor;ctx_Arrow.beginPath();ctx_Arrow.moveTo(0,0);ctx_Arrow.lineTo(x1,y1);ctx_Arrow.lineTo(x3,y3);ctx_Arrow.lineTo(x2,y2);ctx_Arrow.moveTo(x3,y3);ctx_Arrow.lineTo(x4,y4);ctx_Arrow.lineTo(s_x,s_y);ctx_Arrow.lineTo(x5,y5);ctx_Arrow.closePath();ctx_Arrow.fill();ctx_Arrow.shadowOffsetX=0;ctx_Arrow.shadowOffsetY=0;ctx_Arrow.shadowBlur=0;ctx_Arrow.shadowColor="rgba(0, 0, 0, 0)";ctx_Arrow.fillStyle=arrowColor;ctx_Arrow.beginPath();ctx_Arrow.moveTo(x3,y3);ctx_Arrow.lineTo(x4,y4);ctx_Arrow.lineTo(s_x,s_y);ctx_Arrow.lineTo(x5,y5);ctx_Arrow.closePath();ctx_Arrow.fill();ctx_Arrow.shadowOffsetX=0;ctx_Arrow.shadowOffsetY=2;ctx_Arrow.shadowBlur=10;ctx_Arrow.shadowColor="rgba(0, 0, 0, 0.5)";ctx_Arrow.beginPath();ctx_Arrow.moveTo(x4,y4);ctx_Arrow.lineTo(s_x,s_y);ctx_Arrow.restore();};this.hideAnnotationPointer=function(clearSelection){if(typeof clearSelection=="undefined"){clearSelection=true;}if(clearSelection){thisClass.clearCommentSelection();}$("#mfAnnotateArrow").css("display","none");$("#mfAnnotateArrow2").css("display","none");draggedPos.x=-1;draggedPos.y=-1;};this.commentReplyHandler=function(e){var commentId=e.target.id.replace("mfCommentReplyInlineBtn","");thisClass.selectedComment=thisClass.getCommentbyID("mfCommentItem"+commentId);if(thisClass.selectedComment){$("#mfCommentReplyContainer").insertAfter($("#mfCommentItem"+commentId));$("#mfCommentReplyContainer").show();if(mf_main.PUBLIC){$("#mfPublicReplyNameInput").focus();}else{$("#mfCommentReplyPost").focus();}var replyCoordinates=MF_Utils.localToGlobal(document.getElementById("mfCommentReplyPost"));var commentListCoordinates=$("#mfPageSidebarComments");var viewport={top:commentListCoordinates.scrollTop(),left:commentListCoordinates.scrollLeft()};viewport.right=viewport.left+commentListCoordinates.width();viewport.bottom=viewport.top+commentListCoordinates.height();if(replyCoordinates.top>(viewport.bottom-100)){$("#mfPageSidebarComments").scrollTop(viewport.top+100);}$(".mfCommentsHideableElement").hide();$("#mfPageSidebarPost").height(0);$("#mfPageSidebarComments").height($("#mfPageSidebarCommentsBlock").height()-$("#mfPageSidebarHeader").height());thisClass.placeCommentAnnotation("mfAnnotateArrow2");thisClass.highlightSelectedComment(thisClass.selectedComment.id);}else{$("#"+e.target.id).text("Reply");}};this.updateCommentHandler=function(){var feedback=thisClass.selectedComment;if(feedback!=null){var feedbackmsg=$.trim($("#mfCommentEditPost").val());if(feedbackmsg==""){MF_Utils.display_ActionIndicator("Message cannot be empty");return;}feedbackmsg=feedbackmsg.replaceAll("&nbsp;"," ");feedbackmsg=Handlebars.Utils.escapeExpression(feedbackmsg);feedback.message=feedbackmsg;if($("#mfAnnotateArrow").css("display")!="block"){$("#mfCommentItemContainer"+feedback.id).find(".annotateSpan").remove();feedback.pos=null;}$("#mfAnnotateArrow").css("display","none");if(thisClass.annotateUpdated){if(draggedPos.x>=0&&draggedPos.y>=0){feedback.pos=draggedPos.x.toString()+","+draggedPos.y.toString();}}else{if($("#mfAnnotateArrow2").css("display")=="none"){feedback.pos=null;}else{feedback.pos=thisClass.editCommentPos;}}thisClass.selectComment(feedback.id);thisClass.resetEditBox();thisClass.cachedPageComments[mf_main.editorController.page.eid]=thisClass.commentCollection.toArray();thisClass.listCommentsByPage(thisClass.commentCollection.toArray());thisClass.setCommentNum();MF_Utils.display_ActionIndicator("Comment has been updated");mf_main.interfaceResize();MF_FeedbackManager.updateFeedback(MF_UserSession.getUser(),mf_main.editorController.projectObj.company,feedback,{callback:function(arr){if(arr!=null){mf_main.rtc.commentSync("editComment",feedback);}}});}};}function MF_FontController(){var thisClass=this;this.fontArray=new Array();this.googleFontArray=new Array();this.customFontArray=new Array();this.icons=new Array();this.fontAwesomeWebIcons=new Array();this.fontAwesomeTransportIcons=new Array();this.fontAwesomeGenderIcons=new Array();this.fontAwesomeFileTypeIcons=new Array();this.fontAwesomeFormControlIcons=new Array();this.fontAwesomeChartIcons=new Array();this.fontAwesomeCurrencyIcons=new Array();this.fontAwesomeTextEditorIcons=new Array();this.fontAwesomeDirectionalIcons=new Array();this.fontAwesomeVedioPlayerIcons=new Array();this.fontAwesomeBrandIcons=new Array();this.fontAwesomeMedicalIcons=new Array();this.googleFontFamilyItems=null;this.googleSearchedFonts=null;this.googleTempVariants=new Object();this.googleFontSliceStartIndex=0;this.googleFontSliceEndIndex=50;this.currentFontType="BuiltIn";this.googleSearchedFontSliceStartIndex=0;this.googleSearchedFontSliceEndIndex=50;this.isGoogleFontGlobal=false;this.usedFonts=new Object();this.loadedFonts=new Object();this.fontActive=new Array();this.isAllFontsLoaded=false;this.uploadFiles=null;this.uploadFileTemp=null;this.filename=null;this.totalCount=0;this.customFontListLoaded=false;this.customFontInUpload=null;this.constructor=function(){thisClass.addFonts();thisClass.addIcons();var fontObj=new MF_Font();fontObj.id="sourcesanspro";fontObj.name="Source Sans Pro";fontObj.type="Source Sans Pro";fontObj.fontFamily="Source Sans Pro";fontObj.embedded=true;fontObj.isGoogleFont=false;thisClass.usedFonts.sourcesanspro=fontObj;$("#mffontbuiltinbtn").on("click",function(e){thisClass.currentFontType="BuiltIn";thisClass.handleFontTypeToggle();});$("#mffontgooglebtn").on("click",function(e){thisClass.currentFontType="Google";thisClass.handleFontTypeToggle();});$("#mffontusedbtn").on("click",function(e){thisClass.currentFontType="Used";thisClass.handleFontTypeToggle();});$("#mfRestoreDefaultFontBtn").on("click",thisClass.restoreDefault);$("#mfGoogleFontListing .mfFontList").on("scroll",thisClass.onGoogleFontDivScroll);$("#mfGoogleFontSearchListing .mfFontList").on("scroll",thisClass.onGoogleSearchFontDivScroll);$("#mfGoogleFontListing").on("click",".mfGoogleFontCls",thisClass.handleGoogleFontSelectionByUser);$("#mfGoogleFontSearchListing").on("click",".mfGoogleFontCls",thisClass.handleGoogleFontSelectionByUser);$("#mfCustomFontUpload").off("change");$("#mfCustomFontUpload").on("change",thisClass.fileSelectedHandler);$("#mfGoogleFontExplorer").on("click",function(){window.open("https://www.google.com/fonts");});};this.loadFont=function(fontid,component,x,y){var fontLoaded=false;if(thisClass.loadedFonts[fontid]){fontLoaded=true;}if(fontid=="sourcesanspro"||fontid=="SourceSans Pro"||fontid=="Source Sans Pro"){fontid="sourcesanspro";fontLoaded=true;thisClass.loadedFonts[fontid]=true;}if(!fontLoaded){var fontObj=thisClass.getFontByID(fontid);if(fontObj){thisClass.loadedFonts[fontObj.id]=true;}if(fontObj&&fontObj.embedded){WebFontConfig={custom:{families:[fontObj.type],urls:["css/fonts/"+fontObj.id+"/stylesheet.css"]},inactive:function(){thisClass.fontActive[fontObj.type]=true;var idname=null;idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",fontObj.type);$("#"+idname).css("font-weight","normal");$("#"+idname).css("font-style","normal");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",fontObj.type);$("#"+idname).css("font-weight","bold");$("#"+idname).css("font-style","normal");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",fontObj.type);$("#"+idname).css("font-weight","normal");$("#"+idname).css("font-style","italic");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",fontObj.type);$("#"+idname).css("font-weight","bold");$("#"+idname).css("font-style","italic");if(component!=null){mf_main.editorController.loadNewComponent(component,x,y);mf_main.editorController.addSelectorResize(component.selector);}else{mf_main.componentList.reRenderCanvasFonts();}},active:function(){thisClass.fontActive[fontObj.type]=true;var idname=null;idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",fontObj.type);$("#"+idname).css("font-weight","normal");$("#"+idname).css("font-style","normal");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",fontObj.type);$("#"+idname).css("font-weight","bold");$("#"+idname).css("font-style","normal");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",fontObj.type);$("#"+idname).css("font-weight","normal");$("#"+idname).css("font-style","italic");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",fontObj.type);$("#"+idname).css("font-weight","bold");$("#"+idname).css("font-style","italic");if(component!=null){mf_main.editorController.loadNewComponent(component,x,y);mf_main.editorController.addSelectorResize(component.selector);}else{mf_main.componentList.reRenderCanvasFonts();}}};(function(){var wf=document.createElement("script");wf.src="js/external/webfont.js";wf.type="text/javascript";wf.async="true";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(wf,s);})();}else{if(fontObj){thisClass.fontActive[fontObj.id]=true;}if(component!=null){mf_main.editorController.loadNewComponent(component,x,y);mf_main.editorController.addSelectorResize(component.selector);}}}else{if(component!=null){mf_main.editorController.loadNewComponent(component,x,y);mf_main.editorController.addSelectorResize(component.selector);}}};this.loadAllFonts=function(pageid){var fonturls=new Array();var fontfamilies=new Array();var googleFontFamilies=new Array();var builtinfonts=new Object();for(var key in thisClass.usedFonts){if(key=="sourcesanspro"||key=="SourceSans Pro"||key=="Source Sans Pro"){key="sourcesanspro";thisClass.loadedFonts[key]=true;}if(thisClass.loadedFonts[key]!=true){var font=thisClass.usedFonts[key];if(font.isGoogleFont){googleFontFamilies.push(font.fontFamily);}else{var fontobj=thisClass.getFontByID(font.fontFamily);if(fontobj&&fontobj.embedded){fonturls.push("css/fonts/"+fontobj.id+"/stylesheet.css");fontfamilies.push(fontobj.type);builtinfonts[fontobj.type]=true;}if(fontobj&&fontobj.isCustomFont){fonturls.push(MF_Global.getS3CdnURL()+"app/wireframepro/company/"+fontobj.clientid+"/projects/"+fontobj.projectid+"/fonts/"+fontobj.customFontId+".css");fontfamilies.push(fontobj.type);builtinfonts[fontobj.type]=true;}if(fontobj){thisClass.loadedFonts[fontobj.id]=true;}}}}if(fonturls.length==0&&googleFontFamilies.length==0){for(var key in builtinfonts){thisClass.fontActive[key]=true;}mf_main.editorController.reRenderCanvasFonts(pageid);if(mf_main.RENDER){thisClass.isAllFontsLoaded=true;mf_main.editorController.checkLoaded();}}else{WebFontConfig={custom:{families:fontfamilies,urls:fonturls},inactive:function(){for(var key in builtinfonts){thisClass.fontActive[key]=true;var idname=null;idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",key);$("#"+idname).css("font-weight","normal");$("#"+idname).css("font-style","normal");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",key);$("#"+idname).css("font-weight","bold");$("#"+idname).css("font-style","normal");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",key);$("#"+idname).css("font-weight","normal");$("#"+idname).css("font-style","italic");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",key);$("#"+idname).css("font-weight","bold");$("#"+idname).css("font-style","italic");}for(var key in googleFontsToLoadArr){try{var font=googleFontsToLoadArr[key];var fontArr=font.split(":");font=fontArr[0];thisClass.fontActive[font]=true;var idname=null;idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",font);$("#"+idname).css("font-weight","normal");$("#"+idname).css("font-style","normal");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",font);$("#"+idname).css("font-weight","bold");$("#"+idname).css("font-style","normal");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",font);$("#"+idname).css("font-weight","normal");$("#"+idname).css("font-style","italic");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",font);$("#"+idname).css("font-weight","bold");$("#"+idname).css("font-style","italic");}catch(e){}}mf_main.editorController.reRenderCanvasFonts(pageid);if(mf_main.RENDER){thisClass.isAllFontsLoaded=true;mf_main.editorController.checkLoaded();}},active:function(){for(var key in builtinfonts){thisClass.fontActive[key]=true;var idname=null;idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",key);$("#"+idname).css("font-weight","normal");$("#"+idname).css("font-style","normal");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",key);$("#"+idname).css("font-weight","bold");$("#"+idname).css("font-style","normal");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",key);$("#"+idname).css("font-weight","normal");$("#"+idname).css("font-style","italic");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",key);$("#"+idname).css("font-weight","bold");$("#"+idname).css("font-style","italic");}for(var key in googleFontsToLoadArr){try{var font=googleFontsToLoadArr[key];var fontArr=font.split(":");font=fontArr[0];thisClass.fontActive[font]=true;var idname=null;idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",font);$("#"+idname).css("font-weight","normal");$("#"+idname).css("font-style","normal");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",font);$("#"+idname).css("font-weight","bold");$("#"+idname).css("font-style","normal");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",font);$("#"+idname).css("font-weight","normal");$("#"+idname).css("font-style","italic");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",font);$("#"+idname).css("font-weight","bold");$("#"+idname).css("font-style","italic");}catch(e){}}mf_main.editorController.reRenderCanvasFonts(pageid);if(mf_main.RENDER){thisClass.isAllFontsLoaded=true;mf_main.editorController.checkLoaded();}}};if(googleFontFamilies.length>0){var googleFontsToLoadArr=new Array();for(var googleFontIndex in googleFontFamilies){var tempFontFamily=googleFontFamilies[googleFontIndex];if(tempFontFamily=="Architects Daughter"||tempFontFamily=="architectsdaughter"){WebFontConfig.custom.families.push("Architects Daughter");WebFontConfig.custom.urls.push("css/fonts/architectsdaughter/stylesheet.css");}else{googleFontsToLoadArr.push(tempFontFamily+":"+thisClass.googleTempVariants[tempFontFamily]);}}if(googleFontsToLoadArr.length>0){WebFontConfig.google={families:googleFontsToLoadArr};}thisClass.insertWebFontLoaderScript();}else{thisClass.insertWebFontLoaderScript();}}};this.insertWebFontLoaderScript=function(){(function(){var wf=document.createElement("script");wf.src="js/external/webfont.js";wf.type="text/javascript";wf.async="true";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(wf,s);})();};this.addFonts=function(){thisClass.fontArray=new Array();var fontObj;fontObj=new MF_Font();fontObj.id="sourcesanspro";fontObj.name="SourceSansPro";fontObj.type="'Source Sans Pro'";fontObj.embedded=false;thisClass.fontArray.push(fontObj);fontObj=new MF_Font();fontObj.id="architectsdaughter";fontObj.name="Hand-written font";fontObj.type="'Architects Daughter'";fontObj.embedded=true;thisClass.fontArray.push(fontObj);fontObj=new MF_Font();fontObj.id="mockflowfont1";fontObj.name="MockFlow Font1";fontObj.type="'MockFlowFont1'";fontObj.embedded=true;thisClass.fontArray.push(fontObj);fontObj=new MF_Font();fontObj.id="mockflowfont2";fontObj.name="MockFlow Font2";fontObj.type="'MockFlowFont2'";fontObj.embedded=true;thisClass.fontArray.push(fontObj);fontObj=new MF_Font();fontObj.id="blokk-neueregular";fontObj.name="Blokk Font 1";fontObj.type="'BLOKKNeue-Regular'";fontObj.embedded=true;thisClass.fontArray.push(fontObj);fontObj=new MF_Font();fontObj.id="redacted-scriptbold";fontObj.name="Script Bold - Redacted";fontObj.type="'redacted_scriptbold'";fontObj.embedded=true;thisClass.fontArray.push(fontObj);fontObj=new MF_Font();fontObj.id="redacted-scriptlight";fontObj.name="Script Light - Redacted";fontObj.type="'redacted_scriptlight'";fontObj.embedded=true;thisClass.fontArray.push(fontObj);fontObj=new MF_Font();fontObj.id="redacted-scriptregular";fontObj.name="Script Regular - Redacted";fontObj.type="'redacted_scriptregular'";fontObj.embedded=true;thisClass.fontArray.push(fontObj);fontObj=new MF_Font();fontObj.id="redacted-regular";fontObj.name="Block Font - Redacted";fontObj.type="'redactedregular'";fontObj.embedded=true;thisClass.fontArray.push(fontObj);fontObj=new MF_Font();fontObj.id="ubuntu";fontObj.name="Ubuntu";fontObj.type="'UbuntuFont'";fontObj.embedded=true;thisClass.fontArray.push(fontObj);fontObj=new MF_Font();fontObj.id="roboto";fontObj.name="Roboto";fontObj.type="'RobotoFont'";fontObj.embedded=true;thisClass.fontArray.push(fontObj);fontObj=new MF_Font();fontObj.id="cartoonist";fontObj.name="Cartoonist";fontObj.type="'SFCartoonistFont'";fontObj.embedded=true;thisClass.fontArray.push(fontObj);fontObj=new MF_Font();fontObj.id="blokletters";fontObj.name="BlokLetters";fontObj.type="'BloklettersFont'";fontObj.embedded=true;thisClass.fontArray.push(fontObj);fontObj=new MF_Font();fontObj.id="arial";fontObj.name="Arial";fontObj.type="'Arial'";fontObj.embedded=false;thisClass.fontArray.push(fontObj);fontObj=new MF_Font();fontObj.id="times";fontObj.name="times";fontObj.type="'Times'";thisClass.fontArray.push(fontObj);fontObj=new MF_Font();fontObj.id="courier";fontObj.name="Courier";fontObj.type="'Courier'";fontObj.embedded=false;thisClass.fontArray.push(fontObj);};this.getFontByID=function(id){var i=0;if(id=="sourcesanspro"||id=="SourceSans Pro"||id=="Source Sans Pro"){id="sourcesanspro";}for(i=0;i<=thisClass.fontArray.length-1;i++){var fontObj=thisClass.fontArray[i];if(fontObj.id==id){return fontObj;}}return null;};this.restoreDefault=function(){var fontcomp=mf_main.editorController.selectedFontComp;thisClass.isGoogleFontGlobal=false;if(fontcomp){if(fontcomp=="global"){var undoarr=new Array();var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){if(select.component.hasOwnProperty("fontType")){var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"fontType",select.component.fontType);undoarr.push(undo);undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"isGoogleFontUsed",select.component.isGoogleFontUsed);undoarr.push(undo);undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"fontWeight",select.component.fontWeight);undoarr.push(undo);if(select.component.fontWeight=="normal"||select.component.fontWeight=="bold"){select.component.e2xml.addPropSingle("fontWeight",select.component.fontWeight,"default");}else{select.component.e2xml.addPropSingle("fontWeight","normal","default");}select.component.e2xml.addPropSingle("fontType","Source Sans Pro","default");select.component.e2xml.addPropSingle("isGoogleFontUsed",false,"default");if(select.component.RENDER_ON_FONT){select.component.render(true);mf_main.editorController.reStackComponents();}else{select.component.render(false);}}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}else{var undoarr=new Array();var undo=new MF_UndoDAO();undo.propSingleUndo(fontcomp,"fontType",fontcomp.fontType);undoarr.push(undo);undo=new MF_UndoDAO();undo.propSingleUndo(fontcomp,"isGoogleFontUsed",fontcomp.isGoogleFontUsed);undoarr.push(undo);undo=new MF_UndoDAO();undo.propSingleUndo(fontcomp,"fontWeight",fontcomp.fontWeight);undoarr.push(undo);if(fontcomp.fontWeight=="normal"||fontcomp.fontWeight=="bold"){fontcomp.e2xml.addPropSingle("fontWeight",fontcomp.fontWeight,"default");}else{fontcomp.e2xml.addPropSingle("fontWeight","normal","default");}fontcomp.e2xml.addPropSingle("fontType","Source Sans Pro","default");fontcomp.e2xml.addPropSingle("isGoogleFontUsed",false,"default");if(fontcomp.RENDER_ON_FONT){fontcomp.render(true);mf_main.editorController.reStackComponents();}else{fontcomp.render(false);}var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}mf_main.editorController.enableShortcuts();MF_ChangeManager.CHANGED(true);$(".mfFontFamilyCls").text("SourceSans Pro");$("#mfFontSelectionPopUp").hide();if(mf_main.editorController.lastSetting){mf_main.editorController.lastSetting.setValues();}}mf_main.editorController.stopEditingText();};this.getFontByIDComponent=function(id,component){var fontFamily="Source Sans Pro";if(component.isGoogleFontUsed){fontFamily=component.fontType;}else{var fontObj=thisClass.getFontByID(component.fontType);if(fontObj){fontFamily=fontObj.type;}}return fontFamily;};this.handleFontTypeToggle=function(){$("#mfFontSearchBoxWrapper").show();$("#mfFontSearchBox").val("");$("#mfFontSearchBox").show();$(".mfFontListingCls").hide();$("#mfGoogleFontExplorer").hide();if(thisClass.currentFontType=="BuiltIn"){if($("#mfFontSearchBox").val()==""){$("#mfFontSearchBox").val("");mf_main.componentList.searchFontsHandler(null);}$("#mfFontListing").show();}else{if(thisClass.currentFontType=="Google"){thisClass.loadGoogleFontsInformationFromServer();$("#mfGoogleFontListing").show();$("#mfGoogleFontExplorer").show();}else{if(thisClass.currentFontType=="Used"){$("#mfFontSearchBoxWrapper").hide();$("#mfUsedFontListing").show();thisClass.applyUsedFontTemplate();}}}};this.applyUsedFontTemplate=function(){var cachedTextModalTemplate=mf_main.getTemplateFromCache("mfUsedFontItemTemplate");if(cachedTextModalTemplate==null){$.get("templates/editor/UsedFontItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfUsedFontItemTemplate").html());mf_main.addTemplateToCache("mfUsedFontItemTemplate",template);thisClass.renderUsedFontItems(template);});}else{thisClass.renderUsedFontItems(cachedTextModalTemplate);}};this.renderUsedFontItems=function(template){$("#mfUsedFontListing").empty();var i=0;var htmldom="";for(key in thisClass.usedFonts){var fontObj=thisClass.usedFonts[key];if(fontObj.isGoogleFont){htmldom=htmldom+template(fontObj);}else{var fontobjbuiltin=thisClass.getFontByID(fontObj.fontFamily);if(fontobjbuiltin){htmldom=htmldom+template(fontobjbuiltin);}}}$("#mfUsedFontListing").append(htmldom);$(".mfUsedFontItemCls").on("click",thisClass.usedFontItemClick);};this.usedFontItemClick=function(e){var fontfamily=$(this).attr("data-fontfamily");var googlefont=$(this).attr("data-googlefont");var googlefontbool=false;if(googlefont=="true"){googlefontbool=true;}thisClass.isGoogleFontGlobal=googlefontbool;if(mf_main.editorController.selectedFontComp){if(mf_main.editorController.selectedFontComp=="global"){var undoarr=new Array();var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){if(select.component.hasOwnProperty("fontType")){var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"fontType",select.component.fontType);undoarr.push(undo);undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"isGoogleFontUsed",select.component.isGoogleFontUsed);undoarr.push(undo);undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"fontWeight",select.component.fontWeight);undoarr.push(undo);if(select.component.fontWeight=="normal"||select.component.fontWeight=="bold"){select.component.e2xml.addPropSingle("fontWeight",select.component.fontWeight,"default");}else{var vpresent=false;if(select.component.isGoogleFontUsed&&googlefontbool){var variants=thisClass.getGoogleFontVariants(fontfamily);for(var j=0;j<variants.length;j++){var vitem=variants[j];if(vitem==select.component.fontWeight){vpresent=true;select.component.e2xml.addPropSingle("fontWeight",select.component.fontWeight,"default");break;}}if(!vpresent){select.component.e2xml.addPropSingle("fontWeight","normal","default");}}else{select.component.e2xml.addPropSingle("fontWeight","normal","default");}}select.component.e2xml.addPropSingle("fontType",fontfamily,"default");select.component.e2xml.addPropSingle("isGoogleFontUsed",googlefontbool,"default");if(select.component.RENDER_ON_FONT){select.component.render(true);mf_main.editorController.reStackComponents();}else{select.component.render(false);}}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}else{var undoarr=new Array();var undo=new MF_UndoDAO();undo.propSingleUndo(mf_main.editorController.selectedFontComp,"fontType",mf_main.editorController.selectedFontComp.fontType);undoarr.push(undo);undo=new MF_UndoDAO();undo.propSingleUndo(mf_main.editorController.selectedFontComp,"isGoogleFontUsed",mf_main.editorController.selectedFontComp.isGoogleFontUsed);undoarr.push(undo);undo=new MF_UndoDAO();undo.propSingleUndo(mf_main.editorController.selectedFontComp,"fontWeight",mf_main.editorController.selectedFontComp.fontWeight);undoarr.push(undo);if(mf_main.editorController.selectedFontComp.fontWeight=="normal"||mf_main.editorController.selectedFontComp.fontWeight=="bold"){mf_main.editorController.selectedFontComp.e2xml.addPropSingle("fontWeight",mf_main.editorController.selectedFontComp.fontWeight,"default");}else{var vpresent=false;if(mf_main.editorController.selectedFontComp.isGoogleFontUsed&&googlefontbool){var variants=thisClass.getGoogleFontVariants(fontfamily);for(var j=0;j<variants.length;j++){var vitem=variants[j];if(vitem==mf_main.editorController.selectedFontComp.fontWeight){vpresent=true;mf_main.editorController.selectedFontComp.e2xml.addPropSingle("fontWeight",mf_main.editorController.selectedFontComp.fontWeight,"default");break;}}if(!vpresent){mf_main.editorController.selectedFontComp.e2xml.addPropSingle("fontWeight","normal","default");}}else{mf_main.editorController.selectedFontComp.e2xml.addPropSingle("fontWeight","normal","default");}}mf_main.editorController.selectedFontComp.e2xml.addPropSingle("fontType",fontfamily,"default");mf_main.editorController.selectedFontComp.e2xml.addPropSingle("isGoogleFontUsed",googlefontbool,"default");if(mf_main.editorController.selectedFontComp.RENDER_ON_FONT){mf_main.editorController.selectedFontComp.render(true);mf_main.editorController.reStackComponents();}else{mf_main.editorController.selectedFontComp.render(false);}var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}mf_main.editorController.enableShortcuts();MF_ChangeManager.CHANGED(true);mf_main.editorController.stopEditingText();$(".mfFontFamilyCls").text(fontfamily);$("#mfFontSelectionPopUp").hide();if(mf_main.editorController.lastSetting){mf_main.editorController.lastSetting.setValues();}}};this.loadGoogleFontsInformationFromServer=function(){if(!thisClass.googleFontFamilyItems){$(".mfGoogleFontLoadingAjaxImgCls").show();$.getJSON("https://www.googleapis.com/webfonts/v1/webfonts?key=AIzaSyDGNhE7kwuJ3A1JejMnkwSRQfFci1Y9Nzk&sort=popularity",function(obj){thisClass.googleFontFamilyItems=obj.items;thisClass.listGoogleFontToUser();$(".mfGoogleFontLoadingAjaxImgCls").hide();}).fail(function(error){$.getJSON("https://www.googleapis.com/webfonts/v1/webfonts?key=AIzaSyC9krD0pbw8uURZPTjBI6u9x7uXYrYkK-M&sort=popularity",function(obj){thisClass.googleFontFamilyItems=obj.items;thisClass.listGoogleFontToUser();$(".mfGoogleFontLoadingAjaxImgCls").hide();}).fail(function(error){});});}else{thisClass.listGoogleFontToUser();}};this.getGoogleFontVariants=function(fontName){if(thisClass.googleTempVariants&&thisClass.googleTempVariants[fontName]){var arr=thisClass.googleTempVariants[fontName].split(",");return arr;}if(thisClass.googleFontFamilyItems){for(var i=0;i<thisClass.googleFontFamilyItems.length;i++){var gitem=thisClass.googleFontFamilyItems[i];if(gitem.family==fontName){if(gitem.variants){thisClass.googleTempVariants[fontName]=gitem.variants.toString();return gitem.variants;}else{return(new Array());}break;}}}return(new Array());};this.loadGoogleFontStyles=function(loadall){if(!thisClass.googleFontFamilyItems){thisClass.googleFontFamilyItems=new Array();$.getJSON("https://www.googleapis.com/webfonts/v1/webfonts?key=AIzaSyDGNhE7kwuJ3A1JejMnkwSRQfFci1Y9Nzk&sort=popularity",function(obj){thisClass.googleFontFamilyItems=obj.items;if(loadall){thisClass.loadAllFonts();}}).fail(function(error){$.getJSON("https://www.googleapis.com/webfonts/v1/webfonts?key=AIzaSyC9krD0pbw8uURZPTjBI6u9x7uXYrYkK-M&sort=popularity",function(obj){thisClass.googleFontFamilyItems=obj.items;if(loadall){thisClass.loadAllFonts();}}).fail(function(error){});});}else{}};this.listGoogleFontToUser=function(){if(thisClass.googleFontFamilyItems){var reducedArray=thisClass.googleFontFamilyItems.slice(thisClass.googleFontSliceStartIndex,thisClass.googleFontSliceEndIndex);if(thisClass.googleFontSliceEndIndex==thisClass.googleFontFamilyItems.length){$(".mfOnScorllLoaderCls").remove();}for(var i=0;i<reducedArray.length;i++){var fontFamily=reducedArray[i].family.replace(/ /g,"+");if(!fontFamily.includes("Material")){var variant=reducedArray[i].variants.indexOf("regular")>0?400:reducedArray[i].variants[0];thisClass.loadAGoogleFont(fontFamily.replace(/\+/g," "),fontFamily+":"+variant+":latin");}}}};this.applyAGoogleFont=function(fontFamily,font,rerender){WebFontConfig={inactive:function(){if(rerender){var idname=null;idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",fontFamily);$("#"+idname).css("font-weight","normal");$("#"+idname).css("font-style","normal");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",fontFamily);$("#"+idname).css("font-weight","bold");$("#"+idname).css("font-style","normal");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",fontFamily);$("#"+idname).css("font-weight","normal");$("#"+idname).css("font-style","italic");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",fontFamily);$("#"+idname).css("font-weight","bold");$("#"+idname).css("font-style","italic");mf_main.componentList.reRenderCanvasFonts();}},active:function(){if(rerender){var idname=null;idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",fontFamily);$("#"+idname).css("font-weight","normal");$("#"+idname).css("font-style","normal");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",fontFamily);$("#"+idname).css("font-weight","bold");$("#"+idname).css("font-style","normal");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",fontFamily);$("#"+idname).css("font-weight","normal");$("#"+idname).css("font-style","italic");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",fontFamily);$("#"+idname).css("font-weight","bold");$("#"+idname).css("font-style","italic");mf_main.componentList.reRenderCanvasFonts();}}};WebFontConfig.google={families:[font]};};this.loadAGoogleFont=function(fontFamily,font,rerender){WebFont.load({google:{families:[font]},fontloading:function(){$(".mfOnScorllLoaderCls").remove();$("#mfGoogleFontListing .mfFontList").after('<img class="mfOnScorllLoaderCls mfSVGLoader" src="images/general/mf_loader.svg"></img>');},fontinactive:function(){if($(".mfGoogleFontCls[data-fontfamily="+fontFamily.replace(/ /g,"-")+"]").length==0){setTimeout(function(){$("#mfGoogleFontListing .mfFontList").append('<span class="mfGoogleFontCls" data-fontfamily='+fontFamily.replace(/ /g,"-")+'  style="font-family: '+fontFamily+';padding:13px;margin:10px;display:inline-block;font-size:20px;cursor:pointer">'+fontFamily+"</span>");},6000);}$(".mfOnScorllLoaderCls").remove();},fontactive:function(){if($(".mfGoogleFontCls[data-fontfamily="+fontFamily.replace(/ /g,"-")+"]").length==0){$("#mfGoogleFontListing .mfFontList").append('<span class="mfGoogleFontCls" data-fontfamily='+fontFamily.replace(/ /g,"-")+'  style="font-family: '+fontFamily+';padding:13px;margin:10px;display:inline-block;font-size:20px;cursor:pointer">'+fontFamily+"</span>");}$(".mfOnScorllLoaderCls").remove();},timeout:80000});};this.handleGoogleFontSelectionByUser=function(e){e.stopImmediatePropagation();var fontcomp=mf_main.editorController.selectedFontComp;var fontFamily=$(this).html();thisClass.isGoogleFontGlobal=true;var fontPresent=false;var fontObj=new MF_Font();for(var i=0;i<thisClass.googleFontArray.length;i++){var font=thisClass.googleFontArray[i];if(font.type==fontFamily){fontPresent=true;break;}}if(!fontPresent){fontObj.id=fontFamily;fontObj.name=fontFamily;fontObj.type=fontFamily;fontObj.embedded=true;fontObj.isGoogleFont=true;thisClass.googleFontArray.push(fontObj);thisClass.usedFonts[fontObj.id]={fontFamily:fontObj.id,isGoogleFont:fontObj.isGoogleFont};var variants=thisClass.getGoogleFontVariants(fontFamily);thisClass.usedFonts[fontObj.id].variants=variants;thisClass.loadAGoogleFont(fontFamily,fontFamily.replace(/ /g,"+")+":"+variants,true);}if(fontcomp=="global"){var undoarr=new Array();var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){if(select.component.hasOwnProperty("fontType")){var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"fontType",select.component.fontType);undoarr.push(undo);undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"isGoogleFontUsed",select.component.isGoogleFontUsed);undoarr.push(undo);undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"fontWeight",select.component.fontWeight);undoarr.push(undo);if(select.component.fontWeight=="normal"||select.component.fontWeight=="bold"){select.component.e2xml.addPropSingle("fontWeight",select.component.fontWeight,"default");}else{var vpresent=false;if(select.component.isGoogleFontUsed){var variants=thisClass.getGoogleFontVariants(fontFamily);for(var j=0;j<variants.length;j++){var vitem=variants[j];if(vitem==select.component.fontWeight){vpresent=true;select.component.e2xml.addPropSingle("fontWeight",select.component.fontWeight,"default");break;}}if(!vpresent){select.component.e2xml.addPropSingle("fontWeight","normal","default");}}else{select.component.e2xml.addPropSingle("fontWeight","normal","default");}}select.component.e2xml.addPropSingle("fontType",fontFamily,"default");select.component.e2xml.addPropSingle("isGoogleFontUsed",true,"default");if(select.component.RENDER_ON_FONT){select.component.render(true);mf_main.editorController.reStackComponents();}else{select.component.render(false);}}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}else{var undoarr=new Array();var undo=new MF_UndoDAO();undo.propSingleUndo(fontcomp,"isGoogleFontUsed",fontcomp.isGoogleFontUsed);undoarr.push(undo);undo=new MF_UndoDAO();undo.propSingleUndo(fontcomp,"fontType",fontcomp.fontType);undoarr.push(undo);undo=new MF_UndoDAO();undo.propSingleUndo(fontcomp,"fontWeight",fontcomp.fontWeight);undoarr.push(undo);if(fontcomp.fontWeight=="normal"||fontcomp.fontWeight=="bold"){fontcomp.e2xml.addPropSingle("fontWeight",fontcomp.fontWeight,"default");}else{var vpresent=false;if(fontcomp.isGoogleFontUsed){var variants=thisClass.getGoogleFontVariants(fontFamily);for(var j=0;j<variants.length;j++){var vitem=variants[j];if(vitem==fontcomp.fontWeight){vpresent=true;fontcomp.e2xml.addPropSingle("fontWeight",fontcomp.fontWeight,"default");break;}}if(!vpresent){fontcomp.e2xml.addPropSingle("fontWeight","normal","default");}}else{fontcomp.e2xml.addPropSingle("fontWeight","normal","default");}}fontcomp.e2xml.addPropSingle("fontType",fontFamily,"default");fontcomp.e2xml.addPropSingle("isGoogleFontUsed",true,"default");if(fontcomp.RENDER_ON_FONT){fontcomp.render(true);mf_main.editorController.reStackComponents();}else{fontcomp.render(false);}MF_ChangeManager.CHANGED(true);var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}mf_main.editorController.enableShortcuts();$("#mfFontSelectionPopUp").hide();mf_main.editorController.stopEditingText();$(".mfFontFamilyCls").text(fontFamily);$("#mfFontSelectionPopUp").hide();if(mf_main.editorController.lastSetting){mf_main.editorController.lastSetting.setValues();}};this.onGoogleFontDivScroll=function(){if($(this).scrollTop()+$(this).innerHeight()>=this.scrollHeight){$(".mfOnScorllLoaderCls").remove();$("#mfGoogleFontListing .mfFontList").after('<img class="mfOnScorllLoaderCls mfSVGLoader" src="images/general/mf_loader.svg"></img>');if(thisClass.googleFontFamilyItems&&thisClass.googleFontSliceEndIndex==thisClass.googleFontFamilyItems.length){$(".mfOnScorllLoaderCls").remove();}if(thisClass.googleFontFamilyItems&&thisClass.googleFontSliceEndIndex<=thisClass.googleFontFamilyItems.length){thisClass.googleFontSliceStartIndex=thisClass.googleFontSliceEndIndex;thisClass.googleFontSliceEndIndex=thisClass.googleFontSliceEndIndex+20>=thisClass.googleFontFamilyItems.length?thisClass.googleFontFamilyItems.length:thisClass.googleFontSliceEndIndex+20;thisClass.listGoogleFontToUser();}}};this.addGoogleFontToArray=function(fontFamily){var fontPresent=false;for(var i=0;i<thisClass.googleFontArray.length;i++){var font=thisClass.googleFontArray[i];if(font.type==fontFamily){fontPresent=true;break;}}if(!fontPresent){var fontObj=new MF_Font();fontObj.id=fontFamily;fontObj.name=fontFamily;fontObj.type=fontFamily;fontObj.embedded=true;fontObj.isGoogleFont=true;thisClass.googleFontArray.push(fontObj);}};this.updateFontArrayWithGoogleFont=function(){for(var key in thisClass.usedFonts){var font=thisClass.usedFonts[key];var fontFamily=font.fontFamily;var fontObj=new MF_Font();fontObj.id=fontFamily;fontObj.name=fontFamily;fontObj.type=fontFamily;fontObj.embedded=true;fontObj.isGoogleFont=true;thisClass.fontArray.push(fontObj);}};this.searchGoogleFonts=function(searchValue){thisClass.googleSearchedFontSliceStartIndex=0;thisClass.googleSearchedFontSliceEndIndex=50;$(".mfFontListingCls").hide();$("#mfGoogleFontSearchListing").show();$("#mfGoogleFontSearchListing .mfFontList").html("");if(searchValue==""){$("#mfGoogleFontSearchListing .mfFontList").html("");$(".mfFontListingCls").hide();$("#mfGoogleFontListing").show();$("#mfGoogleFontExplorer").show();return;}thisClass.googleSearchedFonts=$.grep(thisClass.googleFontFamilyItems,function(value,i){var str1=value.family.toLowerCase();var str2=searchValue;if(str1.indexOf(str2)>=0){return str1;}});thisClass.listSearchedGoogleFonts();};this.listSearchedGoogleFonts=function(){if(thisClass.googleSearchedFonts){thisClass.googleSearchedFontSliceEndIndex=thisClass.googleSearchedFontSliceEndIndex>=thisClass.googleSearchedFonts.length?thisClass.googleSearchedFonts.length:thisClass.googleSearchedFontSliceEndIndex;var filteredValues=thisClass.googleSearchedFonts.slice(thisClass.googleSearchedFontSliceStartIndex,thisClass.googleSearchedFontSliceEndIndex);for(var i=0;i<filteredValues.length;i++){var fontFamily=filteredValues[i].family.replace(/ /g,"+");var variant=filteredValues[i].variants.indexOf("regular")>0?400:filteredValues[i].variants[0];var font=fontFamily+":"+variant;thisClass.loadSearchedGoogleFonts(font);$("#mfGoogleFontSearchListing .mfFontList").append('<span class="mfGoogleFontCls" data-searchresult="true"  style="font-family: '+fontFamily.replace(/\+/g," ")+';padding:13px;margin:10px;display:inline-block;font-size:20px;cursor:pointer">'+fontFamily.replace(/\+/g," ")+"</span>");}}};this.onGoogleSearchFontDivScroll=function(){if($(this).scrollTop()+$(this).innerHeight()>=this.scrollHeight){$(".mfOnScorllLoaderCls").remove();$("#mfGoogleFontSearchListing .mfFontList").after('<img class="mfOnScorllLoaderCls mfSVGLoader" src="images/general/mf_loader.svg"></img>');if(thisClass.googleSearchedFonts){if(thisClass.googleSearchedFontSliceEndIndex==thisClass.googleSearchedFonts.length){$(".mfOnScorllLoaderCls").remove();}if(thisClass.googleSearchedFontSliceEndIndex<=thisClass.googleSearchedFonts.length){thisClass.googleSearchedFontSliceStartIndex=thisClass.googleSearchedFontSliceEndIndex;thisClass.googleSearchedFontSliceEndIndex=thisClass.googleSearchedFontSliceEndIndex+20>=thisClass.googleSearchedFonts.length?thisClass.googleSearchedFonts.length:thisClass.googleSearchedFontSliceEndIndex+20;thisClass.listSearchedGoogleFonts();}}}};this.loadSearchedGoogleFonts=function(font){WebFont.load({google:{families:[font]}});};this.loadArchitectDaughterFont=function(){WebFont.load({custom:{families:["Architects Daughter"],urls:["css/fonts/architectsdaughter/stylesheet.css"]}});};this.addIcons=function(){thisClass.fontAwesomeWebIcons=["ico-cloud-download","ico-cloud-upload","ico-download_from_cloud","ico-upload_to_cloud","ico-exit","ico-enter","ico-external_link","ico-flip_vertical","ico-flip_horizontal","ico-upload","ico-download","ico-advance","ico-export","ico-paper-plane","ico-gps_device","ico-sent","ico-sent_filled","ico-update","ico-replace","ico-upload_to_cloud_filled","ico-upload_to_cloud_filled2","ico-export","ico-buy_upgrade_filled","ico-user_male_filled","ico-user_female_circle_filled","ico-user_male2","ico-worker_filled","ico-user_male_circle","ico-user_male","ico-user_female","ico-user_female_circle","ico-remove_user","ico-group","ico-find_user","ico-edit_user","ico-checked_user","ico-administrator","ico-user_male_3","ico-add_user","ico-users","ico-user_female_4","ico-user_female_3","ico-vip_filled","ico-vip","ico-cloud","ico-speech_bubble","ico-cloud_storage","ico-drawer","ico-shared_filled","ico-about_filled","ico-speech_bubble_filled","ico-ask_question","ico-image","ico-about","ico-help1","ico-topic","ico-help","ico-flag2_filled","ico-flag_filled","ico-flag","ico-flag2","ico-electric_megaphone","ico-price_tag_USD_filled","ico-price_tag_filled","ico-price_tag","ico-buy_upgrade","ico-cheap_2","ico-us_dollar","ico-bitcoin","ico-star_filled","ico-star","ico-add_to_favorites","ico-smile","ico-wink","ico-sad","ico-lol","ico-happy","ico-reply","ico-forward2","ico-inspection","ico-diploma","ico-select_all","ico-invite","ico-message","ico-create_new","ico-deleted_message","ico-message_group","ico-mail-open-file","ico-mail-open","ico-read_message","ico-paste","ico-paste_special","ico-specifications","ico-check","ico-close2","ico-close-circle","ico-close","ico-near_me","ico-less","ico-plus2","ico-poor_quality","ico-good_quality","ico-folder_filled","ico-folder","ico-opened_folder_filled","ico-opened_folder","ico-xlarge_icons","ico-system_report","ico-presentation","ico-stack_of_photos","ico-photo-gallery","ico-combo_chart","ico-photo","ico-phone1","ico-multiple_devices","ico-iphone_copyrighted","ico-ipad_copyrighted","ico-display1","ico-albums","ico-tv_show","ico-system_information","ico-picture","ico-workstation","ico-code","ico-business","ico-briefcase","ico-copy","ico-document","ico-fav_document","ico-video_camera_filled","ico-micro","ico-mouse2","ico-mouse","ico-camera","ico-web_camera","ico-video_camera","ico-high_volume","ico-mute","ico-waste","ico-trash2","ico-trash","ico-trash_filled","ico-calendar","ico-date","ico-clock","ico-alarm_clock","ico-today","ico-leave","ico-watch","ico-like_filled","ico-hearts","ico-dislike","ico-like3","ico-like","ico-drop","ico-blur","ico-location","ico-user_shield","ico-shield","ico-delete_shield","ico-geo_fence","ico-map_marker","ico-paint_bucket","ico-background_color","ico-paint_basket","ico-paint_palette","ico-paint_brush","ico-color_dropper","ico-chisel_tip_marker","ico-brush","ico-border_color","ico-ball_point_pen","ico-roller_brush","ico-cardboard_box","ico-sign_up","ico-menu_filled","ico-QR_code","ico-visible_filled","ico-birthday","ico-thumbnails","ico-paid","ico-fantasy","ico-albums","ico-attention","ico-ball","ico-bell","ico-box1","ico-box2","ico-browser","ico-checkmark","ico-config","ico-edit2","ico-expand1","ico-filter2","ico-gleam","ico-help22","ico-home2","ico-keypad","ico-light","ico-link2","ico-look","ico-loop","ico-more","ico-more2","ico-more3","ico-shuffle","ico-tools","ico-hashtag","ico-insert_table","ico-horizontal_line","ico-infinity","ico-password2","ico-password","ico-medium_priority","ico-box","ico-settings_wrench","ico-drafting_compass","ico-settings3","ico-plus","ico-minus","ico-menu","ico-error","ico-email","ico-delete_sign","ico-checklist","ico-wifi","ico-domain","ico-bluetooth","ico-christmas_star","ico-credit_card","ico-banknotes","ico-resize","ico-rename","ico-pen","ico-line","ico-italic","ico-increase_font","ico-eraser","ico-ellipse","ico-edit","ico-cut","ico-shopping_cart_empty","ico-shopping_bag","ico-shop","ico-put_in","ico-gift","ico-empty_box","ico-recycle_sign_filled","ico-recycle_sign","ico-questions","ico-answers","ico-zoom_out","ico-zoom_in","ico-equal_zoom","ico-unlock_filled","ico-unlock","ico-share","ico-settings","ico-search","ico-plugin","ico-paper_clip","ico-lock_filled","ico-lock","ico-key","ico-info","ico-idea","ico-home","ico-help2","ico-filter","ico-design","ico-cancel","ico-bookmark","ico-binoculars","ico-archive","ico-visible","ico-rss","ico-pin","ico-online","ico-link_broken","ico-link","ico-invisible","ico-inbox","ico-contacts","ico-contact_card","ico-stop","ico-globe","ico-engineering","ico-automatic","ico-print","ico-bill","ico-note","ico-note2","ico-survey","ico-copy","ico-document","fa-adjust","fa-anchor","fa-archive","fa-area-chart","fa-arrows","fa-arrows-h","fa-arrows-v","fa-asterisk","fa-at","fa-automobile","fa-ban","fa-bank","fa-bar-chart","fa-bar-chart-o","fa-barcode","fa-bars","fa-bed","fa-beer","fa-bell","fa-bell-o","fa-bell-slash","fa-bell-slash-o","fa-bicycle","fa-binoculars","fa-birthday-cake","fa-bolt","fa-bomb","fa-book","fa-bookmark","fa-bookmark-o","fa-briefcase","fa-bug","fa-building","fa-building-o","fa-bullhorn","fa-bullseye","fa-bus","fa-cab","fa-calculator","fa-calendar","fa-calendar-o","fa-camera","fa-camera-retro","fa-car","fa-caret-square-o-down","fa-caret-square-o-left","fa-caret-square-o-right","fa-caret-square-o-up","fa-cart-arrow-down","fa-cart-plus","fa-cc","fa-certificate","fa-check","fa-check-circle","fa-check-circle-o","fa-check-square","fa-check-square-o","fa-child","fa-circle","fa-circle-o","fa-circle-o-notch","fa-circle-thin","fa-clock-o","fa-close","fa-cloud","fa-cloud-download","fa-cloud-upload","fa-code","fa-code-fork","fa-coffee","fa-cog","fa-cogs","fa-comment","fa-comment-o","fa-comments","fa-comments-o","fa-compass","fa-copyright","fa-credit-card","fa-crop","fa-crosshairs","fa-cube","fa-cubes","fa-cutlery","fa-dashboard","fa-database","fa-desktop","fa-diamond","fa-dot-circle-o","fa-download","fa-edit","fa-ellipsis-h","fa-ellipsis-v","fa-envelope","fa-envelope-o","fa-envelope-square","fa-eraser","fa-exchange","fa-exclamation","fa-exclamation-circle","fa-exclamation-triangle","fa-external-link","fa-external-link-square","fa-eye","fa-eye-slash","fa-eyedropper","fa-fax","fa-female","fa-fighter-jet","fa-file-archive-o","fa-file-audio-o","fa-file-code-o","fa-file-excel-o","fa-file-image-o","fa-file-movie-o","fa-file-pdf-o","fa-file-powerpoint-o","fa-file-sound-o","fa-file-video-o","fa-file-word-o","fa-file-zip-o","fa-film","fa-filter","fa-fire","fa-fire-extinguisher","fa-flag","fa-flag-checkered","fa-flag-o","fa-flash","fa-flask","fa-folder","fa-folder-o","fa-folder-open","fa-folder-open-o","fa-frown-o","fa-futbol-o","fa-gamepad","fa-gavel","fa-gear","fa-gears","fa-genderless","fa-gift","fa-glass","fa-globe","fa-graduation-cap","fa-group","fa-hdd-o","fa-headphones","fa-heart","fa-heart-o","fa-heartbeat","fa-history","fa-home","fa-hotel","fa-image","fa-inbox","fa-info","fa-info-circle","fa-institution","fa-key","fa-keyboard-o","fa-language","fa-laptop","fa-leaf","fa-legal","fa-lemon-o","fa-level-down","fa-level-up","fa-life-bouy","fa-lightbulb-o","fa-line-chart","fa-location-arrow","fa-lock","fa-magic","fa-magnet","fa-mail-forward","fa-mail-reply","fa-mail-reply-all","fa-male","fa-map-marker","fa-meh-o","fa-microphone","fa-microphone-slash","fa-minus","fa-minus-circle","fa-minus-square","fa-minus-square-o","fa-mobile","fa-money","fa-moon-o","fa-mortar-board","fa-motorcycle","fa-music","fa-navicon","fa-newspaper-o","fa-paint-brush","fa-paper-plane","fa-paper-plane-o","fa-paw","fa-pencil","fa-pencil-square","fa-pencil-square-o","fa-phone","fa-phone-square","fa-photo","fa-picture-o","fa-pie-chart","fa-plane","fa-plug","fa-plus","fa-plus-circle","fa-plus-square","fa-plus-square-o","fa-power-off","fa-print","fa-puzzle-piece","fa-qrcode","fa-question","fa-question-circle","fa-quote-left","fa-quote-right","fa-random","fa-recycle","fa-refresh","fa-remove","fa-reorder","fa-reply","fa-reply-all","fa-retweet","fa-road","fa-rocket","fa-rss","fa-rss-square","fa-search","fa-search-minus","fa-search-plus","fa-send","fa-send-o","fa-server","fa-share","fa-share-alt","fa-share-alt-square","fa-share-square","fa-share-square-o","fa-shield","fa-ship","fa-shopping-cart","fa-sign-in","fa-sign-out","fa-signal","fa-sitemap","fa-sliders","fa-smile-o","fa-soccer-ball-o","fa-sort","fa-sort-alpha-asc","fa-sort-alpha-desc","fa-sort-amount-asc","fa-sort-amount-desc","fa-sort-asc","fa-sort-desc","fa-sort-down","fa-sort-numeric-asc","fa-sort-numeric-desc","fa-sort-up","fa-space-shuttle","fa-spinner","fa-spoon","fa-square","fa-square-o","fa-star","fa-star-half","fa-star-half-empty","fa-star-half-full","fa-star-half-o","fa-star-o","fa-street-view","fa-suitcase","fa-sun-o","fa-support","fa-tablet","fa-tachometer","fa-tag","fa-tags","fa-tasks","fa-taxi","fa-terminal","fa-thumb-tack","fa-thumbs-down","fa-thumbs-o-down","fa-thumbs-o-up","fa-thumbs-up","fa-ticket","fa-times","fa-times-circle","fa-times-circle-o","fa-tint","fa-toggle-down","fa-toggle-left","fa-toggle-off","fa-toggle-on","fa-toggle-right","fa-toggle-up","fa-trash","fa-trash-o","fa-tree","fa-trophy","fa-truck","fa-tty","fa-umbrella","fa-university","fa-unlock","fa-unlock-alt","fa-unsorted","fa-upload","fa-user","fa-user-plus","fa-user-secret","fa-user-times","fa-users","fa-video-camera","fa-volume-down","fa-volume-off","fa-volume-up","fa-warning","fa-wheelchair","fa-wifi","fa-wrench"];thisClass.fontAwesomeTransportIcons=["fa-ambulance","fa-bicycle","fa-bus","fa-cab","fa-car","fa-fighter-jet","fa-motorcycle","fa-plane","fa-rocket","fa-ship","fa-space-shuttle","fa-subway","fa-train","fa-truck","fa-wheelchair","ico-airport"];thisClass.fontAwesomeGenderIcons=["fa-genderless","fa-mars","fa-mars-double","fa-mars-stroke","fa-mars-stroke-h","fa-mars-stroke-v","fa-mercury","fa-neuter","fa-transgender","fa-transgender-alt","fa-venus","fa-venus-double","fa-venus-mars"];thisClass.fontAwesomeFileTypeIcons=["ico-view_file","ico-bill","ico-note","ico-note2","ico-survey","ico-copy","ico-document","fa-file","fa-file-archive-o","fa-file-audio-o","fa-file-code-o","fa-file-excel-o","fa-file-image-o","fa-file-movie-o","fa-file-o","fa-file-pdf-o","fa-file-photo-o","fa-file-picture-o","fa-file-powerpoint-o","fa-file-text","fa-file-text-o","fa-file-video-o","fa-file-word-o","fa-file-zip-o"];thisClass.fontAwesomeFormControlIcons=["fa-check-square","fa-check-square-o","fa-circle","fa-circle-o","fa-dot-circle-o","fa-minus-square","fa-minus-square-o","fa-plus-square","fa-plus-square-o","fa-square","fa-square-o"];thisClass.fontAwesomeChartIcons=["ico-mind_map","ico-workflow","ico-workflow2","ico-kanban_board","ico-pie_chart","ico-flow_chart","fa-area-chart","fa-bar-chart","fa-line-chart","fa-pie-chart"];thisClass.fontAwesomeCurrencyIcons=["fa-bitcoin","fa-cny","fa-dollar","fa-euro","fa-gbp","fa-ils","fa-inr","fa-krw","fa-money","fa-rouble","fa-ruble","fa-rupee","fa-sheqel","fa-turkish-lira","fa-won"];thisClass.fontAwesomeTextEditorIcons=["fa-align-center","fa-align-justify","fa-align-left","fa-align-right","fa-bold","fa-chain","fa-chain-broken","fa-clipboard","fa-columns","fa-copy","fa-cut","fa-dedent","fa-eraser","fa-file","fa-file-o","fa-file-text","fa-file-text-o","fa-files-o","fa-floppy-o","fa-font","fa-header","fa-indent","fa-italic","fa-link","fa-list","fa-list-alt","fa-list-ol","fa-list-ul","fa-outdent","fa-paperclip","fa-paragraph","fa-paste","fa-rotate-left","fa-rotate-right","fa-save","fa-scissors","fa-strikethrough","fa-subscript","fa-superscript","fa-table","fa-text-height","fa-text-width","fa-th","fa-th-large","fa-th-list","fa-underline","fa-unlink","ico-numbered_list","ico-to_do"];thisClass.fontAwesomeDirectionalIcons=["ico-up3_filled","ico-up2_filled","ico-right2_filled","ico-forward","ico-back","ico-angle-down-circle","ico-angle-down","ico-angle-left-circle","ico-angle-right-circle","ico-angle-left","ico-angle-right","ico-angle-up-circle","ico-angle-up","ico-back2","ico-back-2","ico-up2","ico-up3","ico-right3","ico-up4","ico-up","ico-left3","ico-right2","ico-right","ico-left","ico-left2","ico-down3","ico-down4","ico-down","ico-down2","ico-bottom-arrow","ico-left-arrow","ico-right-arrow","fa-angle-double-down","fa-angle-double-left","fa-angle-double-right","fa-angle-double-up","fa-angle-down","fa-angle-left","fa-angle-right","fa-angle-up","fa-arrow-circle-down","fa-arrow-circle-left","fa-arrow-circle-o-down","fa-arrow-circle-o-left","fa-arrow-circle-o-right","fa-arrow-circle-o-up","fa-arrow-circle-right","fa-arrow-circle-up","fa-arrow-down","fa-arrow-left","fa-arrow-right","fa-arrow-up","fa-arrows","fa-arrows-alt","fa-arrows-h","fa-arrows-v","fa-caret-down","fa-caret-left","fa-caret-right","fa-caret-square-o-down","fa-caret-square-o-left","fa-caret-square-o-right","fa-caret-square-o-up","fa-caret-up","fa-chevron-circle-down","fa-chevron-circle-left","fa-chevron-circle-right","fa-chevron-circle-up","fa-chevron-down","fa-chevron-left","fa-chevron-right","fa-chevron-up","fa-hand-o-down","fa-hand-o-left","fa-hand-o-right","fa-hand-o-up","fa-long-arrow-down","fa-long-arrow-left","fa-long-arrow-right","fa-long-arrow-up","fa-toggle-down","fa-toggle-left","fa-toggle-right","fa-toggle-up","ico-rotation_cw","ico-rotation_ccw","ico-rotate_left","ico-rotate_right","ico-refresh","ico-reload","ico-right-arrow","ico-bottom-arrow"];thisClass.fontAwesomeVideoPlayerIcons=["ico-rewind","ico-fast_forward","fa-arrows-alt","fa-backward","fa-compress","fa-eject","fa-expand","fa-fast-backward","fa-fast-forward","fa-forward","fa-pause","fa-play","fa-play-circle","fa-play-circle-o","fa-step-backward","fa-step-forward","fa-stop","fa-youtube-play"];thisClass.fontAwesomeBrandIcons=["ico-rss","fa-warning","fa-adn","fa-android","fa-angellist","fa-apple","fa-behance","fa-behance-square","fa-bitbucket","fa-bitbucket-square","fa-bitcoin","fa-buysellads","fa-cc-amex","fa-cc-discover","fa-cc-mastercard","fa-cc-paypal","fa-cc-stripe","fa-cc-visa","fa-codepen","fa-connectdevelop","fa-css3","fa-dashcube","fa-delicious","fa-deviantart","fa-digg","fa-dribbble","fa-dropbox","fa-drupal","fa-empire","fa-facebook","fa-facebook-official","fa-facebook-square","fa-flickr","fa-forumbee","fa-foursquare","fa-ge","fa-git","fa-git-square","fa-github","fa-github-alt","fa-github-square","fa-gittip","fa-google","fa-google-plus","fa-google-plus-square","fa-google-wallet","fa-gratipay","fa-hacker-news","fa-html5","fa-instagram","fa-ioxhost","fa-joomla","fa-jsfiddle","fa-lastfm","fa-lastfm-square","fa-leanpub","fa-linkedin","fa-linkedin-square","fa-linux","fa-maxcdn","fa-meanpath","fa-medium","fa-openid","fa-pagelines","fa-paypal","fa-pied-piper","fa-pied-piper-alt","fa-pinterest","fa-pinterest-p","fa-pinterest-square","fa-qq","fa-rebel","fa-reddit","fa-reddit-square","fa-renren","fa-sellsy","fa-share-alt","fa-share-alt-square","fa-shirtsinbulk","fa-simplybuilt","fa-skyatlas","fa-skype","fa-slack","fa-slideshare","fa-soundcloud","fa-spotify","fa-stack-exchange","fa-stack-overflow","fa-steam","fa-steam-square","fa-stumbleupon","fa-stumbleupon-circle","fa-tencent-weibo","fa-trello","fa-tumblr","fa-tumblr-square","fa-twitch","fa-twitter","fa-twitter-square","fa-viacoin","fa-vimeo-square","fa-vine","fa-vk","fa-wechat","fa-weibo","fa-whatsapp","fa-windows","fa-wordpress","fa-xing","fa-xing-square","fa-yahoo","fa-yelp","fa-youtube","fa-youtube-play","fa-youtube-square"];thisClass.fontAwesomeMedicalIcons=["fa-ambulance","fa-h-square","fa-heart","fa-heart-o","fa-heartbeat","fa-hospital-o","fa-medkit","fa-plus-square","fa-stethoscope","fa-user-md","fa-wheelchair"];thisClass.icons=thisClass.fontAwesomeWebIcons;thisClass.icons=thisClass.icons.concat(thisClass.fontAwesomeTransportIcons);thisClass.icons=thisClass.icons.concat(thisClass.fontAwesomeGenderIcons);thisClass.icons=thisClass.icons.concat(thisClass.fontAwesomeFileTypeIcons);thisClass.icons=thisClass.icons.concat(thisClass.fontAwesomeFormControlIcons);thisClass.icons=thisClass.icons.concat(thisClass.fontAwesomeChartIcons);thisClass.icons=thisClass.icons.concat(thisClass.fontAwesomeCurrencyIcons);thisClass.icons=thisClass.icons.concat(thisClass.fontAwesomeTextEditorIcons);thisClass.icons=thisClass.icons.concat(thisClass.fontAwesomeDirectionalIcons);thisClass.icons=thisClass.icons.concat(thisClass.fontAwesomeVideoPlayerIcons);thisClass.icons=thisClass.icons.concat(thisClass.fontAwesomeBrandIcons);thisClass.icons=thisClass.icons.concat(thisClass.fontAwesomeMedicalIcons);};this.getCustomFontsList=function(callback){$("#mfCustomFontLoading").show();MF_FontManager.listCustomFonts(MF_UserSession.getUser(),mf_main.editorController.projectObj.id,mf_main.PUBLIC,{callback:function(customFontList){var newFontArray=new Array();for(var i=0;i<thisClass.fontArray.length;i++){var fontObj=thisClass.fontArray[i];if(!fontObj.isCustomFont){newFontArray.push(thisClass.fontArray[i]);}}thisClass.fontArray=newFontArray;for(var i=0;i<customFontList.length;i++){var customFontObj=customFontList[i];fontObj=new MF_Font();fontObj.id=customFontObj.filename;fontObj.name=customFontObj.filename;fontObj.type=customFontObj.filename;fontObj.embedded=false;fontObj.isCustomFont=true;fontObj.projectid=customFontObj.projectid;fontObj.clientid=customFontObj.clientid;fontObj.customFontId=customFontObj.id;fontObj.extType=customFontObj.filetype;thisClass.fontArray.push(fontObj);if(customFontObj&&customFontObj.projectid==mf_main.editorController.projectObj.id){fontObj.canDelete=true;}var cachedFontItemTemplate=mf_main.getTemplateFromCache("mfFontItemTemplate");if(cachedFontItemTemplate!=null){$("#mfFontListing").append(cachedFontItemTemplate(fontObj));}var existCustomFont=thisClass.getCustomFontObjByName(customFontObj.filename);if(existCustomFont==null){customFontObj.loaded=false;thisClass.customFontArray.push(customFontObj);if(!mf_main.PUBLIC&&mf_main.PERMISSION!="Reviewer"){thisClass.loadCustomFont(customFontObj);}}else{if(!existCustomFont.loaded){if(!mf_main.PUBLIC&&mf_main.PERMISSION!="Reviewer"){thisClass.loadCustomFont(existCustomFont);}}}}thisClass.customFontListLoaded=true;$("#mfCustomFontLoading").hide();mf_main.componentList.setupFontClickEvents();if(callback!=null){callback();}}});};this.getCustomFontObjByName=function(fontfamily){for(var i=0;i<thisClass.customFontArray.length;i++){var customFontObj=thisClass.customFontArray[i];if(customFontObj.filename==fontfamily){return customFontObj;}}return null;};this.loadCustomFont=function(customFontObj,rerender){if(customFontObj!=null&&!customFontObj.loaded){var customFontUrl=MF_Global.getS3CdnURL()+"app/wireframepro/company/"+customFontObj.clientid+"/projects/"+customFontObj.projectid+"/fonts/"+customFontObj.id+".css";WebFont.load({custom:{families:[customFontObj.filename],urls:[customFontUrl],inactive:function(){if(rerender){thisClass.fontActive[customFontObj.filename]=true;var idname=null;idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",customFontObj.filename);$("#"+idname).css("font-weight","normal");$("#"+idname).css("font-style","normal");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",customFontObj.filename);$("#"+idname).css("font-weight","bold");$("#"+idname).css("font-style","normal");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",customFontObj.filename);$("#"+idname).css("font-weight","normal");$("#"+idname).css("font-style","italic");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",customFontObj.filename);$("#"+idname).css("font-weight","bold");$("#"+idname).css("font-style","italic");mf_main.componentList.reRenderCanvasFonts();}},active:function(){if(rerender){thisClass.fontActive[customFontObj.filename]=true;var idname=null;idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",customFontObj.filename);$("#"+idname).css("font-weight","normal");$("#"+idname).css("font-style","normal");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",customFontObj.filename);$("#"+idname).css("font-weight","bold");$("#"+idname).css("font-style","normal");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",customFontObj.filename);$("#"+idname).css("font-weight","normal");$("#"+idname).css("font-style","italic");idname="mfTextDummy"+mf_main.editorController.guidGenerator();$("#mfTextDummy").append('<span  id="'+idname+'" >&nbsp;</span>');$("#"+idname).css("font-family",customFontObj.filename);$("#"+idname).css("font-weight","bold");$("#"+idname).css("font-style","italic");mf_main.componentList.reRenderCanvasFonts();}}}});customFontObj.loaded=true;}};this.deleteCustomFontHandler=function(e){e.stopPropagation();var fontFamily=$(this).attr("data-customfont");bootbox.hideAll();bootbox.confirm("Do you want to permanently delete this custom font '"+Handlebars.Utils.escapeExpression(fontFamily)+"'?<br/><br/>Note: Components using this font will revert to default on reopening project.",function(ans){if(ans){var deleteCustomFontObj=null;for(var i=0;i<thisClass.customFontArray.length;i++){if(thisClass.customFontArray[i].filename==fontFamily){deleteCustomFontObj=thisClass.customFontArray[i];thisClass.customFontArray.splice(i,1);break;}}for(var i=0;i<thisClass.fontArray.length;i++){if(thisClass.fontArray[i].id==fontFamily){thisClass.fontArray.splice(i,1);break;}}for(key in thisClass.usedFonts){var fontObj=thisClass.usedFonts[key];if(fontObj.fontFamily==fontFamily){delete thisClass.usedFonts[key];break;}}$("#mfFontListing").find('[data-id="mfFontItem'+fontFamily+'"]').remove();if(deleteCustomFontObj!=null){MF_FontManager.deleteCustomFont(MF_UserSession.getUser(),deleteCustomFontObj,{callback:function(customFont){}});mf_main.rtc.customFontSync("deletecustomfont",deleteCustomFontObj,false);}MF_ChangeManager.CHANGED(true);}});};this.clearFileSelection=function(){$("#mfCustomFontUpload").attr({value:""});this.uploadFileTemp=null;addFile=false;};this.fileSelectedHandler=function(){if(MF_Permission.deny(mf_main.editorController.projectObj,"canUploadFont")){thisClass.clearFileSelection();MF_Utils.display_ActionIndicator("Permission denied by project owner: To add fonts");return;}if(MF_UserSession.getUser().isBasic){thisClass.clearFileSelection();alert("Custom fonts feature is not available in Basic plan");return;}thisClass.uploadFiles=new Array();for(var i=0;i<document.getElementById("mfCustomFontUpload").files.length;i++){var file=document.getElementById("mfCustomFontUpload").files[i];if(file){var addFile=true;var fileSize=0;fileSize=parseInt(file.size/1024,10);var allow=false;var fileType=file.name.split(".").pop();if(fileType=="ttf"||fileType=="woff"||fileType=="otf"){allow=true;}if(!allow){addFile=false;alert("Font files should be in format ttf, woff, otf ");}fileSize=fileSize/1000;if(fileSize>50){addFile=false;alert("File size cannot exceed 50 MB");}if(addFile){thisClass.uploadFileTemp=file;thisClass.filename=$(this).val();var lastIndex=thisClass.filename.lastIndexOf("\\");if(lastIndex>=0){thisClass.filename=thisClass.filename.substring(lastIndex+1);}thisClass.uploadFiles.push(file);}}}if(thisClass.uploadFiles.length>10){alert("Maximum of 10 images can be selected at once");return false;}thisClass.totalCount=thisClass.uploadFiles.length;if(thisClass.uploadFiles.length>0){thisClass.addFontHandler();}else{thisClass.clearFileSelection();}};this.addFontHandler=function(){thisClass.uploadFileTemp=thisClass.uploadFiles.pop();if(thisClass.uploadFileTemp==null){alert("No file selected");$("#mfCustomFontUpload").attr({value:""});this.uploadFileTemp=null;return;}var fontFamilyArr=thisClass.filename.split(".");fontFamilyArr.pop();var fontFamily=fontFamilyArr.toString();for(var i=0;i<thisClass.customFontArray.length;i++){if(thisClass.customFontArray[i].filename==fontFamily){alert("The selected font already exist");$("#mfCustomFontUpload").attr({value:""});this.uploadFileTemp=null;return;}}$("#mfFontItemNewCustomBtn").css("display","none");$("#mfFontItemNewCustomLoader").css("display","block");var customFontObj=new MF_CustomFont();customFontObj.id=MF_Utils.guidGenerator();customFontObj.projectid=mf_main.editorController.projectObj.id;customFontObj.clientid=mf_main.editorController.projectObj.company;customFontObj.filename=fontFamily;customFontObj.filetype=thisClass.filename.split(".").pop();customFontObj.filesize=(parseInt(thisClass.uploadFileTemp.size/1024,10)).toString();customFontObj.creator=MF_UserSession.getUser().username;customFontObj.uploaded=false;customFontObj.loaded=false;mf_main.componentList.selectedFont=customFontObj;fontObj=new MF_Font();fontObj.id=customFontObj.filename;fontObj.name=customFontObj.filename;fontObj.type=customFontObj.filename;fontObj.embedded=false;fontObj.isCustomFont=true;fontObj.projectid=customFontObj.projectid;fontObj.clientid=customFontObj.clientid;fontObj.customFontId=customFontObj.id;thisClass.fontArray.push(fontObj);thisClass.customFontArray.push(customFontObj);thisClass.customFontInUpload=fontObj;var fd=new FormData();fd.append("company",mf_main.editorController.projectObj.company);fd.append("size",customFontObj.filesize);fd.append("creator",customFontObj.creator);fd.append("project",customFontObj.projectid);fd.append("name","Html 5 File API/FormData");fd.append("fileToUpload",thisClass.uploadFileTemp);fd.append("filetype",customFontObj.filetype);fd.append("filename",customFontObj.filename);fd.append("uid",customFontObj.id);var xhr=new XMLHttpRequest();xhr.upload.addEventListener("progress",thisClass.uploadProgress,false);xhr.addEventListener("load",thisClass.uploadComplete,false);xhr.addEventListener("error",thisClass.uploadFailed,false);xhr.addEventListener("abort",thisClass.uploadCanceled,false);xhr.open("POST","fontupload");xhr.send(fd);};this.uploadComplete=function(evt){var customFontObj=thisClass.getCustomFontObjByName(thisClass.customFontInUpload.name);thisClass.loadCustomFont(customFontObj);thisClass.customFontInUpload.canDelete=true;var cachedFontItemTemplate=mf_main.getTemplateFromCache("mfFontItemTemplate");if(cachedFontItemTemplate!=null){$("#mfFontListing").append(cachedFontItemTemplate(thisClass.customFontInUpload));mf_main.componentList.setupFontClickEvents();}if(thisClass.uploadFiles&&thisClass.uploadFiles.length>0){thisClass.addFontHandler();}else{$("#mfFontItemNewCustomBtn").css("display","block");$("#mfFontItemNewCustomLoader").css("display","none");thisClass.clearFileSelection();var customFontObj=thisClass.getCustomFontObjByName(thisClass.customFontInUpload.name);mf_main.rtc.customFontSync("addcustomfont",customFontObj,false);}};this.uploadProgress=function(evt){$("#mfFontItemNewCustomBtn").css("display","none");$("#mfFontItemNewCustomLoader").css("display","block");};this.uploadFailed=function(evt){alert("There was an error attempting to upload the file.");};this.uploadCanceled=function(evt){alert("The upload has been canceled by the user or the browser dropped the connection.");};this.getFontXML=function(){try{var fontXML="<mffontcollection>";var userFontsArr=thisClass.usedFonts;for(var key in userFontsArr){var fontObj=userFontsArr[key];var customFontObj=thisClass.getCustomFontObjByName(fontObj.fontFamily);if(customFontObj){fontXML+='<mffont fontFamily="'+fontObj.fontFamily+'" isGoogleFont="false" iscustomfont="true" customfontid="'+customFontObj.id+'" projectid="'+customFontObj.projectid+'" clientid="'+customFontObj.clientid+'"></mffont>';}else{if(fontObj.isGoogleFont){var variants=null;if(fontObj.variants&&fontObj.variants!="undefined"){variants=fontObj.variants;}else{variants=thisClass.getGoogleFontVariants(fontObj.fontFamily);}fontXML+='<mffont fontFamily="'+fontObj.fontFamily+'" isGoogleFont="true" iscustomfont="false" variants="'+variants+'" ></mffont>';}}}fontXML+="</mffontcollection>";return fontXML;}catch(e){}return"";};this.getCustomFontXML=function(customFontName){try{var fontXML="";var customFontObj=thisClass.getCustomFontObjByName(customFontName);if(customFontObj){fontXML+='<mffont fontFamily="'+customFontName+'" isGoogleFont="false" iscustomfont="true" customfontid="'+customFontObj.id+'" projectid="'+customFontObj.projectid+'" clientid="'+customFontObj.clientid+'"></mffont>';}return fontXML;}catch(e){}return"";};this.addCustomFontItems=function(element){var fontFamily=element.attr("fontFamily");if(element.attr("iscustomfont")=="true"){var customFontObj=new MF_CustomFont();customFontObj.id=element.attr("customfontid");customFontObj.projectid=element.attr("projectid");customFontObj.clientid=element.attr("clientid");customFontObj.filename=fontFamily;thisClass.customFontArray.push(customFontObj);fontObj=new MF_Font();fontObj.id=customFontObj.filename;fontObj.name=customFontObj.filename;fontObj.type=customFontObj.filename;fontObj.embedded=false;fontObj.isCustomFont=true;fontObj.projectid=customFontObj.projectid;fontObj.clientid=customFontObj.clientid;fontObj.customFontId=customFontObj.id;thisClass.fontArray.push(fontObj);}if(element.attr("isGoogleFont")=="true"){thisClass.googleTempVariants[fontFamily]=element.attr("variants");}};this.addCustomFontHandler=function(customFontObj){var tmpCustomFontObj=null;var customFontIndex=null;for(var i=0;i<thisClass.customFontArray.length;i++){if(thisClass.customFontArray[i].filename==customFontObj.filename){tmpCustomFontObj=thisClass.customFontArray[i];customFontIndex=i;break;}}if(tmpCustomFontObj!=null&&tmpCustomFontObj.projectid!=mf_main.editorController.projectObj.id){thisClass.customFontArray.splice(customFontIndex,1);}if(tmpCustomFontObj==null||(tmpCustomFontObj!=null&&tmpCustomFontObj.projectid!=mf_main.editorController.projectObj.id)){customFontObj.loaded=false;fontObj=new MF_Font();fontObj.id=customFontObj.filename;fontObj.name=customFontObj.filename;fontObj.type=customFontObj.filename;fontObj.embedded=false;fontObj.isCustomFont=true;fontObj.projectid=customFontObj.projectid;fontObj.clientid=customFontObj.clientid;fontObj.customFontId=customFontObj.id;thisClass.fontArray.push(fontObj);thisClass.customFontArray.push(customFontObj);thisClass.loadCustomFont(customFontObj);fontObj.canDelete=true;if(thisClass.customFontListLoaded){var cachedFontItemTemplate=mf_main.getTemplateFromCache("mfFontItemTemplate");if(cachedFontItemTemplate!=null){$("#mfFontListing").append(cachedFontItemTemplate(fontObj));mf_main.componentList.setupFontClickEvents();}}}};}function MF_LockSettings(){var thisClass=this;thisClass.eid=mf_main.editorController.guidGenerator();thisClass.transformLock=false;thisClass.component=null;thisClass.selector=null;thisClass.x=0;thisClass.y=0;thisClass.angle=0;thisClass.RENDERDOM=true;thisClass.updateTransform=function(){};thisClass.remove=function(delSet){$("#"+thisClass.eid).hide();if(delSet){$("#"+thisClass.eid).remove();}};thisClass.setValues=function(){if(thisClass.RENDERDOM){thisClass.render();}else{thisClass.setupEvents();$("#"+thisClass.eid).show();}};thisClass.setupEvents=function(){if(thisClass.RENDERDOM){MF_ComponentSettingUtils.setDragEvents(thisClass);$("#mfUnlock"+thisClass.eid).on("click",function(event){if(thisClass.selector&&thisClass.selector.GROUP){mf_main.editorController.componentSelect=new Array();mf_main.editorController.addComponentSelect(thisClass.selector);mf_main.editorController.editManager.unLockComponent();}else{mf_main.editorController.componentSelect=new Array();mf_main.editorController.addComponentSelect(thisClass.component.selector);mf_main.editorController.editManager.unLockComponent();}});}if(thisClass.RENDERDOM==true){thisClass.RENDERDOM=false;}};thisClass.render=function(redraw){if(redraw==null){redraw=true;}var htmlCode="";if(redraw){$("#"+thisClass.eid).remove();htmlCode=htmlCode+"<div class='mfComponentSetting' id=\""+thisClass.eid+'" style="display: none; width:240px;" > ';htmlCode=htmlCode+'<div  style="overflow: hidden; position: relative; width:100%;height: 320px;" >';htmlCode=htmlCode+'<span style="position: absolute; left: 50px; top: 50px; color: #ccc; font-size: 100px;" class="ico-lock" ></span> ';htmlCode=htmlCode+'<a class="btn mfSidebarBlueButton" id="mfUnlock'+thisClass.eid+'" style="border-color: #2196F3; border-radius: 20px !important; color: #2196F3; left: 50px; top: 200px; position: absolute; width: 130px;" >Un-Lock</a> ';htmlCode=htmlCode+"</div></div>";$("#mfComponentSettings").append(htmlCode);thisClass.setupEvents();$("#"+thisClass.eid).show();}else{$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);}};}function MF_GroupSettings(){var thisClass=this;thisClass.eid=mf_main.editorController.guidGenerator();thisClass.transformLock=false;thisClass.component=null;thisClass.selector=null;thisClass.RENDERDOM=true;thisClass.transformSettings=null;thisClass.linkSettings=null;thisClass.remove=function(delSet){$("#"+thisClass.eid).hide();if(delSet){$("#"+thisClass.eid).remove();}};thisClass.setValues=function(){if(thisClass.RENDERDOM){thisClass.render();thisClass.transformSettings=new MF_TransformSettings();thisClass.transformSettings.init(thisClass);thisClass.linkSettings=new MF_GroupLinkSettings();thisClass.linkSettings.init(thisClass);}else{if(thisClass.transformSettings){thisClass.transformSettings.init(thisClass);}if(thisClass.linkSettings){thisClass.linkSettings.init(thisClass);}thisClass.setupEvents();$("#"+thisClass.eid).show();}};thisClass.updateTransform=function(noscale){thisClass.transformSettings.updateTransform(noscale);};thisClass.setupEvents=function(){if(thisClass.RENDERDOM){MF_ComponentSettingUtils.setupToggle(thisClass);$("#mfUnGroupBtn"+thisClass.eid).on("click",function(){mf_main.editorController.editManager.unGroupComponents();});$("#mfExportImg_"+thisClass.eid).on("click",function(){mf_main.componentList.packController.exportComponentAsImage();});$("#mfSaveComp_"+thisClass.eid).on("click",function(){mf_main.componentList.packController.openAddComponentHandler();});$("#mfEditGroupBtn"+thisClass.eid).on("click",function(){for(var i=0;i<mf_main.editorController.componentSelect.length;i++){var select=mf_main.editorController.componentSelect[i];if(select.GROUP&&select.GROUPID!=""){mf_main.editorController.performGroupEditing(select.GROUPID);break;}}});}if(thisClass.RENDERDOM==true){thisClass.RENDERDOM=false;}};thisClass.render=function(redraw){if(redraw==null){redraw=true;}var htmlCode="";if(redraw){$("#"+thisClass.eid).remove();htmlCode=multiline(function(){
/*!
				
					
					<div class="mfComponentSetting" id="{{eid}}" style=" position: relative; display: none; width:250px; height: 640px; overflow: hidden; " >
					<div  style="overflow: hidden;  width:100%; height: 100%;" >
					
						
						<div class="mfSettingsTextEditMsg" >
							Double-Click on Group to Edit
						</div>
					
						<div id="{{eid}}_transform"  style="overflow: hidden; width:100%; " >
							
						</div>
						
						<div id="{{eid}}_link"  style="overflow: hidden; width:100%; " >
							
						</div>
						
						<div id="{{eid}}_groupsettings"  style="overflow: hidden; width:100%; " >
							
								<div id="{{eid}}_settingToggle"  class="mfImgLink mfSettingsToggleBtn" style=" " >
				
										<div style="float: left; width: 185px; padding-left: 5px;">Group</div>
										
										<div style="float: left; width: 50px; text-align: right;">
											<span id="{{eid}}_settingToggleHide"  style="display: none; font-size: 20px;" class="ico-angle-right"></span>
											<span id="{{eid}}_settingToggleShow"  style="font-size: 20px;" class="ico-angle-down"></span>
										</div>
								</div>
											
								<div id="{{eid}}_partSetting" style="overflow: hidden; position: relative; width:100%; height: 190px;" >		
													
										<a style="position: absolute; left: 10px; top: 10px; width: 220px; border-color: #2196F3;" class="btn mfSidebarBlueButton" id="mfEditGroupBtn{{eid}}" >Edit Group</a>

										<a style="position: absolute; left: 10px; top: 60px; width: 220px; border-color: #2196F3; " class="btn mfSidebarShadowButton" id="mfUnGroupBtn{{eid}}" >Un-Group</a>
										 
										 <div style="position: absolute; left: 10px; top: 120px; font-weight: normal;">
										Export: </div>
										<div id="mfExportImg_{{eid}}"style="cursor: pointer; color: #2196F3; position: absolute; left: 50px; top: 120px; font-weight: normal;">
										 Group as image
										</div>
										
										 <div style="position: absolute; left: 10px; top: 150px; font-weight: normal;">
										Save: </div>
										<div id="mfSaveComp_{{eid}}"style="cursor: pointer; color: #2196F3; position: absolute; left: 50px; top: 150px; font-weight: normal;">
										 Create component
										</div>
								
								</div>
						</div>
						
					
					</div></div>
					 
				
				*/
console.log;});var compiled_template=Handlebars.compile(htmlCode);var context={eid:thisClass.eid};var compiled_code=compiled_template(context);$("#mfComponentSettings").append(compiled_code);thisClass.setupEvents();$("#"+thisClass.eid).show();}else{$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);}};}function MF_GlobalSettings(){var thisClass=this;thisClass.eid=mf_main.editorController.guidGenerator();thisClass.transformLock=false;thisClass.component=null;thisClass.selector=null;thisClass.RENDERDOM=true;thisClass.transformSettings=null;thisClass.backgroundSettings=null;thisClass.borderSettings=null;thisClass.fontSettings=null;thisClass.shadowSettings=null;thisClass.global=true;thisClass.remove=function(delSet){$("#"+thisClass.eid).hide();if(delSet){$("#"+thisClass.eid).remove();}};thisClass.setValues=function(){if(thisClass.RENDERDOM){thisClass.render();thisClass.transformSettings=new MF_TransformSettings();thisClass.transformSettings.init(thisClass);thisClass.backgroundSettings=new MF_BackgroundSettings();thisClass.backgroundSettings.global=true;thisClass.backgroundSettings.init(thisClass);thisClass.borderSettings=new MF_BorderSettings3();thisClass.borderSettings.global=true;thisClass.borderSettings.init(thisClass);thisClass.fontSettings=new MF_FontSettings2();thisClass.fontSettings.global=true;thisClass.fontSettings.init(thisClass);thisClass.shadowSettings=new MF_ShadowSettings();thisClass.shadowSettings.global=true;thisClass.shadowSettings.init(thisClass);}else{thisClass.transformSettings.init(thisClass);thisClass.backgroundSettings.global=true;thisClass.backgroundSettings.init(thisClass);thisClass.borderSettings.global=true;thisClass.borderSettings.init(thisClass);thisClass.fontSettings.global=true;thisClass.fontSettings.init(thisClass);thisClass.shadowSettings.global=true;thisClass.shadowSettings.init(thisClass);thisClass.setupEvents();$("#"+thisClass.eid).show();}};thisClass.updateTransform=function(noscale){thisClass.transformSettings.updateTransform(noscale);};thisClass.setupEvents=function(){if(thisClass.RENDERDOM){MF_ComponentSettingUtils.setupToggle(thisClass);$("#mfGroupBtn"+thisClass.eid).on("click",function(){mf_main.editorController.editManager.groupComponents();});$("#mfExportImgComp_"+thisClass.eid).on("click",function(){mf_main.componentList.packController.exportComponentAsImage();});$("#mfRepeatItems_"+thisClass.eid).on("click",function(){$("#mfRepeatItems_"+thisClass.eid).hide();$("#mfOpenRepeatItems_"+thisClass.eid).show();});$("#mfCloseRepeatItems_"+thisClass.eid).on("click",function(){$("#mfRepeatItems_"+thisClass.eid).show();$("#mfOpenRepeatItems_"+thisClass.eid).hide();});$(".mfRepeatTimesCls").on("click",function(){if(mf_main.editorController.componentSelect.length>2){MF_Utils.display_ActionIndicator("Exactly select only 2 components. Not more than 2.");}else{var repeatTimes=$(this).text();mf_main.editorController.editManager.repeatTimes=parseInt(repeatTimes);mf_main.editorController.editManager.repeatComponent();}});$("#aleft_"+thisClass.eid).on("click",function(){mf_main.editorController.editManager.alignLeftHandler();});$("#acenter_"+thisClass.eid).on("click",function(){mf_main.editorController.editManager.alignMiddleHandler();});$("#aright_"+thisClass.eid).on("click",function(){mf_main.editorController.editManager.alignRightHandler();});$("#atop_"+thisClass.eid).on("click",function(){mf_main.editorController.editManager.alignTopHandler();});$("#amiddle_"+thisClass.eid).on("click",function(){mf_main.editorController.editManager.alignCenterHandler();});$("#abottom_"+thisClass.eid).on("click",function(){mf_main.editorController.editManager.alignBottomHandler();});$("#dhorizontal_"+thisClass.eid).on("click",function(){mf_main.editorController.editManager.distributeWidthHandler();});$("#dvertical_"+thisClass.eid).on("click",function(){mf_main.editorController.editManager.distributeHeightHandler();});$(".mfAlignToolsCls").tooltip({position:"bottom",animation:false});}if(thisClass.RENDERDOM==true){thisClass.RENDERDOM=false;}};thisClass.render=function(redraw){if(redraw==null){redraw=true;}var htmlCode="";if(redraw){$("#"+thisClass.eid).remove();htmlCode=multiline(function(){
/*!
				
					
					<div class="mfComponentSetting" id="{{eid}}" style=" position: relative; display: none; width:250px; height: 1650px; overflow: hidden; " >
					<div  style="overflow: hidden;  width:100%; height: 100%;" >
					
					
					
						<div id="{{eid}}_transform"  style="overflow: hidden; width:100%; " >
							
						</div>
						
						<div id="{{eid}}_groupsettings"  style="overflow: hidden; width:100%; " >
							
								<div id="{{eid}}_settingToggle"  class="mfImgLink mfSettingsToggleBtn" style=" " >
				
										<div style="float: left; width: 185px; padding-left: 5px;">Selected</div>
										
										<div style="float: left; width: 50px; text-align: right;">
											<span id="{{eid}}_settingToggleHide"  style="display: none; font-size: 20px;" class="ico-angle-right"></span>
											<span id="{{eid}}_settingToggleShow"  style="font-size: 20px;" class="ico-angle-down"></span>
										</div>
								</div>
											
								<div id="{{eid}}_partSetting" style="overflow: hidden; position: relative; width:100%; height: 360px;" >		
																							
										<a style="position: absolute; left: 10px; top: 20px; width: 220px; border-color: #2196F3;" class="btn mfSidebarBlueButton" id="mfGroupBtn{{eid}}" >Group Components</a>

																							
										
										<a data-original-title="Export selected components as image" data-toggle="tooltip" data-placement="bottom" title="" style="border-color: #2196F3; position: absolute; display: block; left: 10px; top: 80px; width: 220px;" class="btn mfSidebarShadowButton" id="mfExportImgComp_{{eid}}" >Export to Image</a>

										
										<div data-original-title="On selecting 2 components, you can repeat copy-paste the items with same spacing. Useful for quickly creating list items." data-toggle="tooltip" data-placement="bottom" title=""  id="mfOpenRepeatItems_{{eid}}" style=" position: absolute;  left: 10px; top: 140px; width: 220px; height: 30px;">
											<div style="line-height: 20px; float: left; margin-right: 10px; ">
											Repeat Times:
											</div>
											
											<div class="mfRepeatTimesCls">1</div>
											<div class="mfRepeatTimesCls">2</div>
											<div class="mfRepeatTimesCls">3</div>
											<div class="mfRepeatTimesCls">4</div>
											<div class="mfRepeatTimesCls">5</div>
											<div class="mfRepeatTimesCls">6</div>
											
											
										</div>
										
										
										<span style="position: absolute; left: 10px; top: 200px; color: #000;" >Align:</span>
										
										<img class="mfAlignToolsCls" title="Align Left" id="aleft_{{eid}}" style="cursor: pointer; position: absolute; left: 10px; top: 230px;" src="images/editor/editicons/aleft.png" alt='' />
										<img class="mfAlignToolsCls" title="Align Center" id="amiddle_{{eid}}" style="cursor: pointer; position: absolute; left: 35px; top: 230px;" src="images/editor/editicons/amiddle.png" alt='' />
										<img class="mfAlignToolsCls" title="Align Right" id="aright_{{eid}}" style="cursor: pointer; position: absolute; left: 60px; top: 230px;" src="images/editor/editicons/aright.png" alt='' />
										
										<img class="mfAlignToolsCls" title="Align Top" id="atop_{{eid}}" style="cursor: pointer; position: absolute; left: 150px; top: 230px;" src="images/editor/editicons/atop.png" alt='' />
										<img class="mfAlignToolsCls" title="Align Middle" id="acenter_{{eid}}" style="cursor: pointer; position: absolute; left: 175px; top: 230px;" src="images/editor/editicons/acenter.png" alt='' />
										<img class="mfAlignToolsCls" title="Align Bottom" id="abottom_{{eid}}" style="cursor: pointer; position: absolute; left: 200px; top: 230px;" src="images/editor/editicons/abottom.png" alt='' />
										
										
										<span style="position: absolute; left: 10px; top: 270px; color: #000;" >Distribute:</span>
										
										<img class="mfAlignToolsCls" title="Distribute Horizontal Space" id="dhorizontal_{{eid}}" style="cursor: pointer; position: absolute; left: 10px; top: 300px;" src="images/editor/editicons/dhorizontal.png" alt='' />
										<img class="mfAlignToolsCls" title="Distribute Vertical Space" id="dvertical_{{eid}}" style="cursor: pointer; position: absolute; left: 35px; top: 300px;" src="images/editor/editicons/dvertical.png" alt='' />
										
								</div>
								
								
						</div>
						
						<div id="{{eid}}_font"  style="overflow: hidden; width:100%; " >
							
						</div>
						
						<div id="{{eid}}_background"  style="overflow: hidden; width:100%; " >
							
						</div>
						
						<div id="{{eid}}_border"  style="overflow: hidden; width:100%; " >
							
						</div>
						
						<div id="{{eid}}_shadow"  style="overflow: hidden; width:100%; " >
							
						</div>
						
					 
					</div></div>
					 
				
				*/
console.log;});var compiled_template=Handlebars.compile(htmlCode);var context={eid:thisClass.eid};var compiled_code=compiled_template(context);$("#mfComponentSettings").append(compiled_code);thisClass.setupEvents();$("#"+thisClass.eid).show();}else{$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);}};}var MF_ComponentUtils=(function(){function privateMethod(){}return{setDimensions:function(thisClass,ecoordinates,esize){if(ecoordinates!=null){thisClass.x=ecoordinates.x;thisClass.y=ecoordinates.y;}if(esize!=null){thisClass.width=esize.width;thisClass.height=esize.height;}},applyCSS:function(thisClass){if(thisClass.CSSCOMP){try{if(thisClass.cssJson.trim()!=""){var cssObj=new Object();cssObj=thisClass.cssObj;cssObj=JSON.parse(thisClass.cssJson);if(cssObj){for(var j=0;j<thisClass.cssClasses.length;j++){var cls=thisClass.cssClasses[j];var cssClsObj=cssObj[cls];for(var prop in cssClsObj){try{$("."+cls+"_"+thisClass.eid).css(prop,cssClsObj[prop]);}catch(e){}}}}}}catch(e){}}},getCSSCode:function(thisClass){var csstxt="";if(thisClass.CSSCOMP){try{if(thisClass.cssJson.trim()!=""){var cssObj=new Object();cssObj=thisClass.cssObj;cssObj=JSON.parse(thisClass.cssJson);if(cssObj){csstxt=csstxt+"<br/>/* Custom CSS */<br/>";for(var j=0;j<thisClass.cssClasses.length;j++){var cls=thisClass.cssClasses[j];var cssClsObj=cssObj[cls];csstxt=csstxt+"."+cls+" {<br/>";for(var prop in cssClsObj){try{csstxt=csstxt+prop+": "+cssClsObj[prop]+";<br/>";}catch(e){}}csstxt=csstxt+"}<br/><br/>";}}}}catch(e){}}return csstxt;},applyCSSPropSingle:function(settingsHolder,propName,propVal,cjson,rerender){var undoarr=new Array();var undo=new MF_UndoDAO();undo.propSingleUndo(settingsHolder.component,"cssJson",settingsHolder.component.cssJson);undoarr.push(undo);undo=new MF_UndoDAO();undo.propSingleUndo(settingsHolder.component,propName,settingsHolder.component[propName]);undoarr.push(undo);settingsHolder.component.e2xml.addPropSingle("cssJson",cjson,"default");settingsHolder.component.e2xml.addPropSingle(propName,propVal,"default");if(rerender){settingsHolder.component.render(true);mf_main.editorController.reStackComponents();}else{settingsHolder.component.render(false);}var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);settingsHolder.cssSettings.init(settingsHolder);},applyCSSPropArray:function(settingsHolder,propName,propVal,propType,cjson,rerender){var undoarr=new Array();var undo=new MF_UndoDAO();undo.propSingleUndo(settingsHolder.component,"cssJson",settingsHolder.component.cssJson);undoarr.push(undo);undo=new MF_UndoDAO();undo.propArrayUndo(settingsHolder.component,propName,settingsHolder.component[propName].slice(),propType);undoarr.push(undo);settingsHolder.component.e2xml.addPropSingle("cssJson",cjson,"default");settingsHolder.component.e2xml.addPropArray(propName,propVal,propType,"default");if(rerender){settingsHolder.component.render(true);mf_main.editorController.reStackComponents();}else{settingsHolder.component.render(false);}var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);settingsHolder.cssSettings.init(settingsHolder);},addCSSUndo:function(comp,cjson,undoarr){var undo=new MF_UndoDAO();undo.propSingleUndo(comp,"cssJson",comp.cssJson);undoarr.push(undo);comp.e2xml.addPropSingle("cssJson",cjson,"default");return undoarr;},updateCSS:function(thisClass,propArr,propVal){if(thisClass.CSSCOMP){try{if(thisClass.cssJson.trim()!=""){var cssObj=new Object();cssObj=thisClass.cssObj;cssObj=JSON.parse(thisClass.cssJson);if(cssObj){var present=false;for(var j=0;j<thisClass.cssClasses.length;j++){var cls=thisClass.cssClasses[j];var cssClsObj=cssObj[cls];for(var prop in cssClsObj){for(var k=0;k<propArr.length;k++){if(prop==propArr[k]){delete cssClsObj[prop];present=true;}}}}if(present){var cjson=JSON.stringify(cssObj);return cjson;}}}}catch(e){}}return"";},getMaxRadius:function(rad,w,h){var min=w;if(h<min){min=h;}if(min<rad){return min;}else{return rad;}},getRefactoredText:function(inputTxt){inputTxt=inputTxt.replace(/</gi,"&lt;").replace(/>/gi,"&gt;");inputTxt=inputTxt.replace(/&lt;br&gt;/gi,"<br>");inputTxt=inputTxt.replace(/ /gi,"&nbsp;<wbr>");return inputTxt;},computeShadowDelta:function(shadowType){var delta=0;try{if(shadowType){if(shadowType=="all"){return 10;}if(shadowType=="top"){return 5;}if(shadowType=="right"){return 5;}if(shadowType=="bottom"){return 5;}if(shadowType=="left"){return 5;}if(shadowType.indexOf("custom")!=-1){var customarr=shadowType.split("::");if(customarr.length>=7){var maxshadownum=Math.max(customarr[1],customarr[2],customarr[3],customarr[4]);delta=maxshadownum;}}}}catch(e){}return delta;},getComponentShadowSpecs:function(shadowType){var code="";if(shadowType=="all"){code="box-shadow: 0 0 5px #333; <br/>";}if(shadowType=="top"){code="box-shadow: 0 -5px 5px -5px #333; <br/>";}if(shadowType=="right"){code="box-shadow: 5px 0 5px -5px #333; <br/>";}if(shadowType=="bottom"){code="box-shadow: 0 5px 5px -5px #333; <br/>";}if(shadowType=="left"){code="box-shadow: -5px 0 5px -5px #333; <br/>";}if(shadowType.indexOf("custom")!=-1){var customarr=shadowType.split("::");if(customarr.length>=7){var c1=MF_ComponentUtils.hexToRGB(customarr[5],customarr[6]);var str=customarr[1]+"px "+customarr[2]+"px "+customarr[3]+"px "+customarr[4]+"px "+c1;code="box-shadow:"+str+"; <br/>";}}return code;},setComponentShadow:function(ctx,shadowType){if(shadowType=="all"){ctx.shadowOffsetX=0;ctx.shadowOffsetY=0;ctx.shadowBlur=10;ctx.shadowColor="rgba(0, 0, 0, 0.6)";}if(shadowType=="top"){ctx.shadowOffsetX=0;ctx.shadowOffsetY=-2;ctx.shadowBlur=5;ctx.shadowColor="rgba(0, 0, 0, 0.3)";}if(shadowType=="right"){ctx.shadowOffsetX=2;ctx.shadowOffsetY=0;ctx.shadowBlur=5;ctx.shadowColor="rgba(0, 0, 0, 0.3)";}if(shadowType=="bottom"){ctx.shadowOffsetX=0;ctx.shadowOffsetY=2;ctx.shadowBlur=5;ctx.shadowColor="rgba(0, 0, 0, 0.3)";}if(shadowType=="left"){ctx.shadowOffsetX=-2;ctx.shadowOffsetY=0;ctx.shadowBlur=5;ctx.shadowColor="rgba(0, 0, 0, 0.3)";}if(shadowType.indexOf("custom")!=-1){var customarr=shadowType.split("::");if(customarr.length>=7){var c1=MF_ComponentUtils.hexToRGB(customarr[5],customarr[6]);ctx.shadowOffsetX=customarr[1];ctx.shadowOffsetY=customarr[2];ctx.shadowBlur=customarr[3];ctx.shadowColor=c1;}}},setComponentShadowImageCSS:function(domID,shadowType){if(mf_main.RENDER){$("#"+domID).css("filter","none");$("#"+domID).css("box-shadow","none");var filterStr="";if(shadowType=="all"){filterStr="drop-shadow(0px 0px 5px rgba(0, 0, 0, 0.5))";}if(shadowType=="top"){filterStr="drop-shadow(0px -4px 2px rgba(0, 0, 0, 0.5))";}if(shadowType=="right"){filterStr="drop-shadow(4px 0px 2px rgba(0, 0, 0, 0.5))";}if(shadowType=="bottom"){filterStr="drop-shadow(0px 4px 2px rgba(0, 0, 0, 0.5))";}if(shadowType=="left"){filterStr="drop-shadow(-4px 0px 2px rgba(0, 0, 0, 0.5))";}if(shadowType.indexOf("custom")!=-1){var customarr=shadowType.split("::");if(customarr.length>=7){var c1=MF_ComponentUtils.hexToRGB(customarr[5],customarr[6]);filterStr="drop-shadow("+customarr[1]+"px "+customarr[2]+"px "+customarr[3]+"px "+c1+") ";}}if(filterStr!=""){$("#"+domID).css("filter",filterStr);if(mf_main.RENDER){$("#"+domID).css("-webkit-filter",filterStr);}}}else{$("#"+domID).css("filter","none");$("#"+domID).css("box-shadow","none");if(shadowType=="all"){$("#"+domID).css("filter","drop-shadow(0 0 5px rgba(0, 0, 0, 0.5)");}if(shadowType=="top"){$("#"+domID).css("filter","drop-shadow(0px -4px 2px rgba(0, 0, 0, 0.5))");}if(shadowType=="right"){$("#"+domID).css("filter","drop-shadow(4px 0px 2px rgba(0, 0, 0, 0.5))");}if(shadowType=="bottom"){$("#"+domID).css("filter","drop-shadow(0px 4px 2px rgba(0, 0, 0, 0.5))");}if(shadowType=="left"){$("#"+domID).css("filter","drop-shadow(-4px 0px 2px rgba(0, 0, 0, 0.5))");}if(shadowType.indexOf("custom")!=-1){var customarr=shadowType.split("::");if(customarr.length>=7){var c1=MF_ComponentUtils.hexToRGB(customarr[5],customarr[6]);var str="drop-shadow("+customarr[1]+"px "+customarr[2]+"px "+customarr[3]+"px "+c1+") ";$("#"+domID).css("filter",str);}}}},setComponentShadowCSS:function(domID,shadowType){$("#"+domID).css("box-shadow","none");if(shadowType=="all"){$("#"+domID).css("box-shadow","0 0 5px #333");}if(shadowType=="top"){$("#"+domID).css("box-shadow","0 -5px 5px -5px #333");}if(shadowType=="right"){$("#"+domID).css("box-shadow","5px 0 5px -5px #333");}if(shadowType=="bottom"){$("#"+domID).css("box-shadow","0 5px 5px -5px #333");}if(shadowType=="left"){$("#"+domID).css("box-shadow","-5px 0 5px -5px #333");}if(shadowType.indexOf("custom")!=-1){var customarr=shadowType.split("::");if(customarr.length>=7){var c1=MF_ComponentUtils.hexToRGB(customarr[5],customarr[6]);var str=customarr[1]+"px "+customarr[2]+"px "+customarr[3]+"px "+customarr[4]+"px "+c1;$("#"+domID).css("box-shadow",str);}}},getRefactoredText2:function(inputTxt){inputTxt=inputTxt.replace(/</gi,"&lt;").replace(/>/gi,"&gt;");inputTxt=inputTxt.replace(/&lt;br&gt;/gi,"<br>");inputTxt=inputTxt.replace(/ /gi,"&nbsp;");return inputTxt;},nl2br:function(str,is_xhtml){var breakTag="<br />";return(str+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+breakTag+"$2");},commonPallete:function(){return["#ffffff","#FAFAFA","#F5F5F5","#E0E0E0","#BDBDBD","#9E9E9E","#757575","#616161","#424242","#212121","#000000","#f44336","#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F3","#03A9F4","#00BCD4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FF9800","#795548","#607D8B"];},setDimensionsTransform:function(thisClass,ecoordinates,esize){if(ecoordinates!=null){thisClass.startX=ecoordinates.startX;thisClass.startY=ecoordinates.startY;thisClass.endX=ecoordinates.endX;thisClass.endY=ecoordinates.endY;}if(esize!=null){thisClass.width=esize.width;thisClass.height=esize.height;}},clearPage:function(thisClass){if(document.getElementById(thisClass.eid)){var ctx_cvs=(document.getElementById(thisClass.eid)).getContext("2d");if(ctx_cvs){ctx_cvs.clearRect(0,0,$("#"+thisClass.eid).width(),$("#"+thisClass.eid).height());document.getElementById(thisClass.eid).width=thisClass.width;$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);$("#"+thisClass.eid).css("width",thisClass.width);$("#"+thisClass.eid).css("height",thisClass.height);document.getElementById(thisClass.eid).width=thisClass.width;document.getElementById(thisClass.eid).height=thisClass.height;}}},hexToRGB:function(hex,alpha){hex="0x"+hex.replace("#","");alpha=typeof(alpha)!="undefined"?alpha:"1";var rgbObj={red:((hex&16711680)>>16),green:((hex&65280)>>8),blue:((hex&255))};return"rgba("+rgbObj.red+","+rgbObj.green+","+rgbObj.blue+","+alpha+")";},hexToRGB2:function(hex,alpha){hex="0x"+hex.replace("#","");alpha=typeof(alpha)!="undefined"?alpha:"1";var rgbObj={red:((hex&16711680)>>16),green:((hex&65280)>>8),blue:((hex&255))};return rgbObj.red+","+rgbObj.green+","+rgbObj.blue;},randomInRange:function(min,max){var scale=max-min;return Math.floor(Math.random()*scale+min);},atLevel:function(str){var level=0;for(var i=0;i<str.length;i++){if(str.charAt(i)=="*"){level++;}else{break;}}return level;},roundedRect2:function(ctx,x,y,w,h,cornerRadius){cornerRadius=cornerRadius/2;ctx.beginPath();var theta,angle,cx,cy,px,py;if(cornerRadius>Math.min(w,h)/2){cornerRadius=Math.min(w,h)/2;}theta=Math.PI/4;ctx.moveTo(x+cornerRadius,y);ctx.lineTo(x+w-cornerRadius,y);angle=-Math.PI/2;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);ctx.lineTo(x+w,y+h-cornerRadius);angle+=theta;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);ctx.lineTo(x+cornerRadius,y+h);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);ctx.lineTo(x,y+cornerRadius);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);ctx.stroke();return null;},roundedRect:function(ctx,x,y,width,height,radius){ctx.beginPath();ctx.moveTo(x,y+radius);ctx.lineTo(x,y+height-radius);ctx.quadraticCurveTo(x,y+height,x+radius,y+height);ctx.lineTo(x+width-radius,y+height);ctx.quadraticCurveTo(x+width,y+height,x+width,y+height-radius);ctx.lineTo(x+width,y+radius);ctx.quadraticCurveTo(x+width,y,x+width-radius,y);ctx.lineTo(x+radius,y);ctx.quadraticCurveTo(x,y,x,y+radius);ctx.stroke();return null;},bottomRoundRect:function(ctx,x,y,width,height,radius){ctx.beginPath();ctx.moveTo(x,y+radius);ctx.lineTo(x,y+height-radius);ctx.quadraticCurveTo(x,y+height,x+radius,y+height);ctx.lineTo(x+width-radius,y+height);ctx.quadraticCurveTo(x+width,y+height,x+width,y+height-radius);ctx.lineTo(x+width,y);ctx.lineTo(x,y);ctx.lineTo(x,y+radius);ctx.stroke();return null;},rightRoundRect:function(ctx,x,y,width,height,radius){ctx.beginPath();ctx.moveTo(x,y);ctx.lineTo(x,y+height);ctx.lineTo(x+width-radius,y+height);ctx.quadraticCurveTo(x+width,y+height,x+width,y+height-radius);ctx.lineTo(x+width,y+radius);ctx.quadraticCurveTo(x+width,y,x+width-radius,y);ctx.lineTo(x,y);ctx.stroke();return null;},leftRoundRect:function(ctx,x,y,width,height,radius){ctx.beginPath();ctx.moveTo(x,y+radius);ctx.lineTo(x,y+height-radius);ctx.quadraticCurveTo(x,y+height,x+radius,y+height);ctx.lineTo(x+width,y+height);ctx.lineTo(x+width,y);ctx.lineTo(x+radius,y);ctx.quadraticCurveTo(x,y,x,y+radius);ctx.stroke();return null;},topRoundRect:function(ctx,x,y,width,height,radius){ctx.beginPath();ctx.moveTo(x,y+radius);ctx.lineTo(x,y+height);ctx.lineTo(x+width,y+height);ctx.lineTo(x+width,y+radius);ctx.quadraticCurveTo(x+width,y,x+width-radius,y);ctx.lineTo(x+radius,y);ctx.quadraticCurveTo(x,y,x,y+radius);ctx.stroke();return null;},leftTopRoundRect:function(ctx,x,y,width,height,radius){radius=radius/2;ctx.beginPath();ctx.moveTo(x,y);ctx.lineTo(x,y+height);ctx.quadraticCurveTo(x,y+height,x,y+height);ctx.lineTo(x+width,y+height);ctx.lineTo(x+width,y);ctx.lineTo(x+radius,y);ctx.quadraticCurveTo(x,y,x,y+radius);},rightTopRoundRect:function(ctx,x,y,width,height,radius){radius=radius/2;ctx.beginPath();ctx.moveTo(x,y);ctx.lineTo(x,y+height);ctx.lineTo(x+width,y+height);ctx.quadraticCurveTo(x+width,y+height,x+width,y+height);ctx.lineTo(x+width,y+radius);ctx.quadraticCurveTo(x+width,y,x+width-radius,y);ctx.lineTo(x,y);},leftBottomRoundRect:function(ctx,x,y,width,height,radius){radius=radius/2;ctx.beginPath();ctx.moveTo(x,y+radius);ctx.lineTo(x,y+height-radius);ctx.quadraticCurveTo(x,y+height,x+radius,y+height);ctx.lineTo(x+width,y+height);ctx.lineTo(x+width,y);ctx.lineTo(x,y);ctx.quadraticCurveTo(x,y,x,y);},rightBottomRoundRect:function(ctx,x,y,width,height,radius){radius=radius/2;ctx.beginPath();ctx.moveTo(x,y);ctx.lineTo(x,y+height);ctx.lineTo(x+width-radius,y+height);ctx.quadraticCurveTo(x+width,y+height,x+width,y+height-radius);ctx.lineTo(x+width,y);ctx.quadraticCurveTo(x+width,y,x+width,y);ctx.lineTo(x,y);},};})();function MF_CopyComponent(_componentQueue){this.componentQueue=_componentQueue;}function MF_ComponentQueue(){this.componentObj=null;this.componentXML=null;this.pasteInPlace=false;this.componentParent=null;}function MF_EditManager(){var thisClass=this;var selectors=new Object();var copiedPage=null;this.copyComponents=new Array();this.cutComponents=new Array();this.tempPasteComponents=new Array();this.tempCopyGroups=new Object();this.topCopyGroups=new Object();this.positionDelArray=new Array();this.templateTypeList=null;this.byocSamplesLoaded=false;this.byocSamples=new Array();this.layerSlider=null;this.repeatMode=false;this.repeatTimes=3;this.repeatX=0;this.repeatY=0;this.repeatCount=0;this.adjustX=0;this.adjustY=0;this.minx=0;this.miny=0;this.storeCategoryArray=[{text:"Web frameworks",value:"web"},{text:"Mobile frameworks",value:"mobile"},{text:"Desktop frameworks",value:"desktop"},{text:"Enterprise",value:"enterprise"},{text:"Other",value:"other"}];this.pagePresetArray=[{text:"Auto Size",value:"sizeless",width:"",height:""},{text:"Custom",value:"custom",width:"800",height:"600"},{text:"iPhone X",value:"iphonex_2",width:"375",height:"812"},{text:"iPhone 8",value:"iphone8",width:"375",height:"667"},{text:"iPhone 8 plus",value:"iphone8_2",width:"414",height:"736"},{text:"iPad Pro",value:"ipadpro_2",width:"1024",height:"1366"},{text:"iPad mini",value:"ipadmini",width:"768",height:"1024"},{text:"Pixel 2",value:"pixel2",width:"411",height:"731"},{text:"Pixel 2XL",value:"pixel2xl",width:"411",height:"823"},{text:"Samsung Note 5",value:"galaxynote5",width:"480",height:"853"},{text:"Samsung Galaxy S9",value:"galaxys9",width:"360",height:"740"},{text:"Apple Watch 5 40mm",value:"applewatch5_40mm",width:"324",height:"394"},{text:"Apple Watch 5 44mm",value:"applewatch5_44mm",width:"368",height:"448"},{text:"Android Watch",value:"androidwatch",width:"160",height:"160"},{text:"Apple TV",value:"appletv",width:"1920",height:"1080"},{text:"Web HD",value:"webhd",width:"1920",height:"1080"},{text:"Web Wide",value:"webwide",width:"1600",height:"900"},{text:"Web Standard",value:"webstandard",width:"1024",height:"768"}];this.gridSS=new Object();this.mapSS=new Object();this.workflowSS=new Object();this.constructor=function(){$(".mfSaveBtnCls").on("click",thisClass.saveProject);$("#mfTopMenuSave").on("click",thisClass.saveProject);$("#mfTopMenuBackView").on("click",mf_main.editorController.gotoViewer);$(".mfTopMenuSaveStore").on("click",thisClass.saveToStore);$(".mfTopMenuSaveComp").on("click",thisClass.saveAsComponent);$(".mfTopMenuSavedComplist").on("click",mf_main.componentList.openSavedComponents2);$("#mfTopMenuRevHis").on("click",mf_main.editorController.revisionController.openRevisionListing);$("#mfTopMenuNewRev").on("click",mf_main.editorController.revisionController.openAddRevisionDialog);$("#mfTopMenuExpImg").on("click",mf_main.editorController.downloadPDFHandler);$("#mfTopMenuFont").on("click",mf_main.editorController.fontController.openFontSettings);$("#mfTopMenuUndo").on("click",thisClass.undo);$("#mfTopMenuRedo").on("click",thisClass.redo);$("#mfTopMenuDuplicate").on("click",thisClass.duplicateComponent);$("#mfTopMenuCut").on("click",thisClass.cutComponent);$("#mfTopMenuCopy").on("click",thisClass.copyComponent);$("#mfTopMenuPaste").on("click",thisClass.pasteComponentCMD);$("#mfTopMenuDelete").on("click",thisClass.deleteComponentHandler);$("#mfTopMenuSelectAll").on("click",mf_main.editorController.selectAll);$("#mfTopMenuClearSel").on("click",mf_main.editorController.clearSelection);$("#mfTopMenuSendFwd").on("click",thisClass.sendForward);$("#mfTopMenuSendBck").on("click",thisClass.sendBackward);$("#mfTopMenuToTop").on("click",thisClass.sendFront);$("#mfTopMenuToBottom").on("click",thisClass.sendBack);$("#mfTopMenuLock").on("click",thisClass.lockComponent);$("#mfTopMenuUnLock").on("click",thisClass.unLockComponent);$("#mfTopMenuUnLockAll").on("click",thisClass.unLockAllComponents);$("#mfTopMenuResetRotation").on("click",thisClass.resetRotation);$("#mfTopMenuDocsLink").on("click",thisClass.openDocumentation);$("#mfTopMenuVideoLink").on("click",thisClass.openVideoTutorials);$("#mfTopMenuFeedback").on("click",thisClass.openFeedbackModel);$("#mfTopMenuOpenWizard").on("click",mf_main.editorController.openWizard);$("#mfTopMenuCreateComponent").on("click",thisClass.createNewDBComponentHandler);$("#mfAddDBComponentBtb").on("click",thisClass.createDBComponent);$("#mfTopMenuGroup").on("click",thisClass.groupComponents);$("#mfTopMenuUnGroup").on("click",thisClass.unGroupComponentsHandler);$("#mfTopMenuViewLayers").on("click",thisClass.openLayersDialog);$("#mfTopMenuSharing").on("click",mf_main.editorController.openMenuPublicHandler);$("#mfTopMenuGrid").on("click",mf_main.editorController.gridController.openGridDialog);$("#mfTopMenuPageSize, #mfPageSizeBtn, #mfChangeSizeToolbarBtn").on("click",thisClass.openPageSizeDialog);$("#mfTopMenuDesktopApp").on("click",thisClass.openDesktopApp);$(".mfTopMenuExportPage").on("click",mf_main.editorController.exportWireframe);$(".mfTopMenuCommentsPage").on("click",mf_main.editorController.commentWireframe);$("#mfTopMenuToggleMode").on("click",mf_main.editorController.showPreview);$("#mfTopMenuZoomPlus").on("click",mf_main.editorController.zoomPlus);$("#mfTopMenuZoomMinus").on("click",mf_main.editorController.zoomMinus);$("#mfTopMenuZoom100").on("click",mf_main.editorController.viewFullSize);$("#mfZoomBarPlusBtn").on("click",mf_main.editorController.zoomPlus);$("#mfZoomBarMinusBtn").on("click",mf_main.editorController.zoomMinus);$("#mfZoomBar100Btn").on("click",mf_main.editorController.viewFullSize);$("#mfTopMenuAlignLeft").on("click",thisClass.alignLeftHandler);$("#mfTopMenuAlignCenter").on("click",thisClass.alignCenterHandler);$("#mfTopMenuAlignRight").on("click",thisClass.alignRightHandler);$("#mfTopMenuAlignTop").on("click",thisClass.alignTopHandler);$("#mfTopMenuAlignMiddle").on("click",thisClass.alignMiddleHandler);$("#mfTopMenuAlignBottom").on("click",thisClass.alignBottomHandler);$("#mfTopMenuDistributeW").on("click",thisClass.distributeWidthHandler);$("#mfTopMenuDistributeH").on("click",thisClass.distributeHeightHandler);$("#mfSubmitTemplateBtn").on("click",thisClass.submitTemplate);$("#mfCurrentPageSizeOverride").on("click",thisClass.toggleCurrentPageSettings);$("#mfCurrentPageBackgroundOverride").on("click",thisClass.toggleCurrentPageBGSettings);MF_ComponentSettingUtils.setCommonDragEvents("mfViewLayers");$("#mfViewerLayersCloseBtn").on("click",thisClass.openLayersDialog);$("#mfShowAllLayersBtn").on("click",thisClass.showAllHandler);$("#mfSubmitFeedback").on("click",thisClass.submitMessage);$("#mfEmbedPage").click(function(e){$("#mfDrawingEmbedWidth").val(700);$("#mfDrawingEmbedHeight").val(500);thisClass.formDrawingEmbedCode();$("#mfEmbedPageModal").modal();});$("#mfDrawingEmbedCode").on("click",thisClass.copyEmbedCodeHandler);$("#mfDrawingEmbedCopyOembed").click(function(e){e.stopImmediatePropagation();thisClass.formDrawingEmbedCode("oembed");MF_Utils.copyToClipBoard2($("#mfDrawingCopyHidden"));});$("#mfDrawingEmbedCopyEmbedURL").click(function(e){e.stopImmediatePropagation();thisClass.formDrawingEmbedCode("embedurl");MF_Utils.copyToClipBoard2($("#mfDrawingCopyHidden"));});$("#mfDrawingEmbedWidth").bind("keyup mouseup",function(){thisClass.formDrawingEmbedCode();});$("#mfDrawingEmbedHeight").bind("keyup mouseup",function(){thisClass.formDrawingEmbedCode();});$("#mfDrawingEmbedShowPages").change(function(){thisClass.formDrawingEmbedCode();});$("#mfDrawingEmbedZoom").change(function(){thisClass.formDrawingEmbedCode();});$("#mfLayerDragContainer").drag(function(ev,dd){ev.stopImmediatePropagation();});$("#mfSavePageSizeSettings").on("click",thisClass.savePageSizeSettings);$("#mfResetPageSizeSettings").on("click",thisClass.resetPageSizeSettings);$("#mfGlobalPageType").kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:thisClass.pagePresetArray,change:function(){var mfGlobalPageSelectedPreset=this.value();thisClass.globalPageSizeSettings(mfGlobalPageSelectedPreset);}});$("#mfCurrentPageType").kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:thisClass.pagePresetArray,change:function(){var mfCurrentPageSelectedPreset=this.value();thisClass.currentPageSizeSettings(mfCurrentPageSelectedPreset);}});$("#mfTemplateType").kendoDropDownList({optionLabel:"Select Type...",dataTextField:"text",dataValueField:"value",dataSource:thisClass.storeCategoryArray,});thisClass.templateTypeList=$("#mfTemplateType").data("kendoDropDownList");$("#mfGlobalPageSizeValueExchange").on("click",thisClass.globalPageSizeValueExchange);$("#mfCurrentPageSizeValueExchange").on("click",thisClass.currentPageSizeValueExchange);$("#mfAddToStoreModal").on("shown.bs.modal",function(){$("#mfTemplateTitle").focus();});$("#mfFeedbackForm").on("shown.bs.modal",function(){$("#mfFeedbackSubject").focus();});$("#mfAddDBComponentModal").on("shown.bs.modal",function(){$("#mfAddDBComponentTitleInput").focus();});$("#mfBYOCExamples").on("show.bs.modal",function(){if(!thisClass.byocSamplesLoaded){$.getJSON("images/data/byoc/components.json",function(obj){if(obj){thisClass.byocSamples=obj;thisClass.byocSamplesLoaded=true;$("#builder_block_listing_blocks").empty();var cachedTemplate=mf_main.getTemplateFromCache("mfBYOCSampleItemTemplate");if(cachedTemplate==null){$.get("templates/editor/byocSampleItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfBYOCSampleItemTemplate").html());mf_main.addTemplateToCache("mfBYOCSampleItemTemplate",template);thisClass.renderBYOCSampleListing(thisClass.byocSamples,template);});}else{thisClass.renderBYOCSampleListing(thisClass.byocSamples,cachedTemplate);}}});}});};this.renderBYOCSampleListing=function(arr,template){$("#mfBYOCSampleListing").empty();var bhtml="";for(var i=0;i<arr.length;i++){bhtml=bhtml+template(arr[i]);}$("#mfBYOCSampleListing").append(bhtml);$(".mfBYOCSampleItem").off("click",thisClass.importBYOCSample);$(".mfBYOCSampleItem").on("click",thisClass.importBYOCSample);};this.importBYOCSample=function(e){if(MF_UserSession.getUser()&&MF_UserSession.getUser().isBasic){MF_Utils.display_ActionIndicator("Not permitted in basic plan");return;}mf_main.editorController.enableShortcuts();var itemid=$(this).attr("data-id");var item=null;for(var i=0;i<thisClass.byocSamples.length;i++){if(thisClass.byocSamples[i].id==itemid){item=thisClass.byocSamples[i];break;}}if(item){$.get("images/data/byoc/"+itemid+"/index.html",function(html_string){var comp=null;if(mf_main.editorController.lastSetting&&mf_main.editorController.lastSetting.component){comp=mf_main.editorController.lastSetting.component;}if(comp&&comp.NAME=="MF_BYOC"){var txt=html_string;try{txt=MF_Utils.sanitizeHTML(txt);txt=MF_Utils.sanitizeHTMLTags(txt);}catch(e){}txt=MF_Utils.htmlEncode(txt);var byoccomp=comp;var undoarr=new Array();if(byoccomp.tailwindVersion=="none"){var undo=new MF_UndoDAO();undo.propSingleUndo(comp,"tailwindVersion",comp.tailwindVersion);undoarr.push(undo);byoccomp.e2xml.addPropSingle("tailwindVersion","3","default");mf_main.editorController.lastSetting.checkTailWind();}var undo=new MF_UndoDAO();undo.propSingleUndo(comp,"text",comp.text);undoarr.push(undo);byoccomp.e2xml.addPropSingle("text",txt,"default");byoccomp.render(true);mf_main.editorController.reStackComponents();mf_main.editorController.lastSetting.updateHTMLdata(txt);var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);meta.reselectMeta=true;undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);mf_main.closeDialog();MF_Utils.display_ActionIndicator("HTML code saved successfully");}},"html");}};this.formDrawingEmbedCode=function(type){var ew=$("#mfDrawingEmbedWidth").val();var eh=$("#mfDrawingEmbedHeight").val();var showPages="";if($("#mfDrawingEmbedShowPages").is(":checked")){showPages="&showpages=true";}var zoom=$("#mfDrawingEmbedZoom").val();if(zoom>100||zoom>100){zoom=100;}$("#mfDrawingEmbedZoomVal").text(zoom+"%");var zoomLevel="&zoom="+zoom;var viewpage="&pageid="+mf_main.editorController.page.eid;var eurl="";if(MF_Global.getS3Bucket()=="assets.mockflow.com"){eurl="https://wireframepro.mockflow.com/get/embed/"+mf_main.editorController.projectObj.publicURL+viewpage+showPages+zoomLevel;}else{eurl="http://localhost:8080/MockFlow-WireframePro/mobile/embed.jsp?id="+mf_main.editorController.projectObj.publicURL+viewpage+showPages+zoomLevel;}if(type=="oembed"){eurl=encodeURIComponent(eurl);$("#mfDrawingCopyHidden").val("https://wireframepro.mockflow.com/oembed?url="+eurl+"&format=json");}else{if(type=="embedurl"){$("#mfDrawingCopyHidden").val(eurl);}else{var embedCode='<iframe style="border: 1px solid #f0f0f0;"  width="'+ew+'" height="'+eh+'" src="'+eurl+'" frameBorder="0" scrolling="no" allowFullScreen></iframe>';$("#mfDrawingEmbedCode").text(embedCode);}}};this.copyEmbedCodeHandler=function(){MF_Utils.copyToClipBoard2($("#mfDrawingEmbedCode"));};this.setPageSizeCustom=function(e){var maxval=30000;if(mf_main.editorController.RESTRICT_SIZE){maxval=mf_main.editorController.RESTRICT_SIZE_LIMIT;}$("#mfGlobalPageWidth, #mfGlobalPageHeight, #mfCurrentPageWidth, #mfCurrentPageHeight").kendoNumericTextBox({format:"#",spinners:true,spin:thisClass.onPageSizeChange,decimals:0,min:"10",max:maxval});};this.onPageSizeChange=function(e){if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}var s=this.value();if(mf_main.editorController.RESTRICT_SIZE){if((s)>mf_main.editorController.RESTRICT_SIZE_LIMIT-1){mf_main.editorController.displaySizeRestiction();}}};this.savePageSizeSettings=function(e){mf_main.editorController.enableShortcuts();var globalSizeType=$("#mfGlobalPageType").data("kendoDropDownList").dataItem().value;var globalWidth=$("#mfGlobalPageWidth").data("kendoNumericTextBox").value();var globalHeight=$("#mfGlobalPageHeight").data("kendoNumericTextBox").value();var pageSizeType=$("#mfCurrentPageType").data("kendoDropDownList").dataItem().value;var pageWidth=$("#mfCurrentPageWidth").data("kendoNumericTextBox").value();var pageHeight=$("#mfCurrentPageHeight").data("kendoNumericTextBox").value();if(globalSizeType!="sizeless"){mf_main.editorController.projectObj.autoResize=false;if(Number.isInteger(globalWidth)){mf_main.editorController.projectObj.width=globalWidth;}if(Number.isInteger(globalHeight)){mf_main.editorController.projectObj.height=globalHeight;}if(Number.isInteger(globalWidth)){mf_main.editorController.projectObj.origWidth=globalWidth;}if(Number.isInteger(globalHeight)){mf_main.editorController.projectObj.origHeight=globalHeight;}}else{mf_main.editorController.projectObj.autoResize=true;}mf_main.editorController.projectObj.sizeType=globalSizeType;var pagesizeOverride=$("#mfCurrentPageSizeOverride").prop("checked");if(pagesizeOverride){mf_main.editorController.page.overrideSize=true;if(pageSizeType!="sizeless"){mf_main.editorController.page.autoResize=false;if(Number.isInteger(pageWidth)){mf_main.editorController.page.width=pageWidth;}if(Number.isInteger(pageHeight)){mf_main.editorController.page.height=pageHeight;}if(Number.isInteger(pageWidth)){mf_main.editorController.page.origWidth=pageWidth;}if(Number.isInteger(pageHeight)){mf_main.editorController.page.origHeight=pageHeight;}}else{mf_main.editorController.page.autoResize=true;}mf_main.editorController.page.sizeType=pageSizeType;}else{mf_main.editorController.page.overrideSize=false;}MF_ChangeManager.CHANGED(true);mf_main.editorController.resizePage();thisClass.passSizeSettingsRTC();mf_main.closeDialog();mf_main.editorController.gridController.backgroundColor=mf_main.editorController.gridController.backgroundColorGlobal;var pagebgOverride=$("#mfCurrentPageBackgroundOverride").prop("checked");if(pagebgOverride){mf_main.editorController.page.overrideBackground=true;}else{mf_main.editorController.page.overrideBackground=false;}mf_main.editorController.page.backgroundColor=mf_main.editorController.gridController.backgroundColorCurrent;mf_main.editorController.changeBackgroundColor();if(mf_main.editorController.gridController.changedBackgroundColorCurrent||mf_main.editorController.gridController.changedBackgroundColor){mf_main.rtc.bgSync(mf_main.editorController.gridController.backgroundColor,mf_main.editorController.page.eid,mf_main.editorController.page.overrideBackground,mf_main.editorController.page.backgroundColor);mf_main.editorController.gridController.changedBackgroundColorCurrent=false;mf_main.editorController.gridController.changedBackgroundColor=false;MF_ProjectManager.unSnapAllPages(MF_UserSession.getUser(),mf_main.editorController.projectObj,{callback:function(result){}});}};this.passSizeSettingsRTC=function(){var sizeRT=new Object();sizeRT.projectWidth=mf_main.editorController.projectObj.origWidth;sizeRT.projectHeight=mf_main.editorController.projectObj.origHeight;sizeRT.projectSizeType=mf_main.editorController.projectObj.sizeType;sizeRT.projectAutoSize=mf_main.editorController.projectObj.autoResize;sizeRT.pageID=mf_main.editorController.page.eid;sizeRT.pageWidth=mf_main.editorController.page.origWidth;sizeRT.pageHeight=mf_main.editorController.page.origHeight;sizeRT.pageSizeType=mf_main.editorController.page.sizeType;sizeRT.pageAutoSize=mf_main.editorController.page.autoResize;sizeRT.pageOverride=mf_main.editorController.page.overrideSize;mf_main.rtc.pagesizeSync(sizeRT);};this.getSizeSettingsRTC=function(sizeRT){mf_main.editorController.projectObj.origWidth=sizeRT.projectWidth;mf_main.editorController.projectObj.origHeight=sizeRT.projectHeight;mf_main.editorController.projectObj.sizeType=sizeRT.projectSizeType;mf_main.editorController.projectObj.autoResize=sizeRT.projectAutoSize;for(var k=mf_main.editorController.loadedPages.length-1;k>=0;k--){var loadedPage=mf_main.editorController.loadedPages[k];if(loadedPage.eid==sizeRT.pageID){loadedPage.origWidth=sizeRT.pageWidth;loadedPage.origHeight=sizeRT.pageHeight;loadedPage.sizeType=sizeRT.pageSizeType;loadedPage.autoResize=sizeRT.pageAutoSize;loadedPage.overrideSize=sizeRT.pageOverride;break;}}mf_main.editorController.resizePage();};this.getPageBackgroundRTC=function(bgRT){for(var k=mf_main.editorController.loadedPages.length-1;k>=0;k--){var loadedPage=mf_main.editorController.loadedPages[k];if(loadedPage.eid==bgRT.pageid){loadedPage.overrideBackground=bgRT.pageoverride;loadedPage.backgroundColor=bgRT.pagecolor;if(loadedPage.eid==mf_main.editorController.page.eid){mf_main.editorController.changeBackgroundColor();}break;}}mf_main.editorController.resizePage();};this.resetPageSizeSettings=function(e){bootbox.hideAll();bootbox.confirm("This will reset to default size settings. Continue ? ",function(ans){if(ans){mf_main.editorController.enableShortcuts();mf_main.editorController.projectObj.autoResize=true;mf_main.editorController.page.overrideSize=false;mf_main.editorController.projectObj.sizeType="sizeless";MF_ChangeManager.CHANGED(true);mf_main.editorController.resizePage();thisClass.passSizeSettingsRTC();mf_main.closeDialog();}});};this.openDocumentation=function(e){window.open("https://support.mockflow.com/category/49-wireframepro");};this.openVideoTutorials=function(e){wt_openvideo("wireframing","category");};this.openFeedbackModel=function(e){mf_main.editorController.disableShortcuts();$("#mfFeedbackForm").modal();mf_main.editorController.disableShortcuts();};this.submitMessage=function(){var subject=$.trim($("input#mfFeedbackSubject").val());if(subject==""){$("input#mfFeedbackSubject").focus();alert("Subject cannot be empty");return;}var message=$.trim($("textarea#mfFeedbackMessage").val());if(message==""){$("textarea#mfFeedbackMessage").focus();alert("Message cannot be empty");return;}mf_main.closeDialog();alert("Message sent");$("input#mfFeedbackSubject").val("");$("textarea#mfFeedbackMessage").val("");MF_FeedbackManager.contactCustomerSupport(MF_UserSession.getUser(),subject,message,navigator.appVersion,function(){});};this.openDesktopApp=function(e){window.open("https://mockflow.com/desktop");};this.createNewDBComponentHandler=function(e){$("#mfDBComponentLoadingScreen").hide();$("#mfDBComponentInputScreen").show();mf_main.editorController.shortcutsFlag=false;$("#mfAddDBComponentModal").modal();};this.createDBComponent=function(){var componentName=$.trim($("#mfAddDBComponentTitleInput").val());if(componentName==""){alert("Component name cannot be empty");return;}var exportObj=thisClass.exportComponents();var components=exportObj.components;var images=exportObj.images;if(components.length>0){var lib='<library version="1.0">';var customFontXML="";for(var i=0;i<components.length;i++){var componentData=components[i];for(var k=0;k<componentData.componentQueue.length;k++){var currentQueue=componentData.componentQueue[k];var copyXML=currentQueue.componentXML;lib=lib+MF_Utils.xmlToString(copyXML);if($(copyXML).find("settings").find('property[name="isGoogleFontUsed"]').text()=="false"){var customFontName=$(copyXML).find("settings").find('property[name="fontType"]').text();customFontXML=customFontXML+mf_main.editorController.fontController.getCustomFontXML(customFontName);}}}if(customFontXML!=""){customFontXML="<mffontcollection>"+customFontXML+"</mffontcollection>";lib=lib+customFontXML;}lib=lib+"</library>";$("#mfDBComponentLoadingScreen").show();$("#mfDBComponentInputScreen").hide();if($("#mfCompThemeChk").is(":checked")){var cname=mf_main.editorController.componentSelect[0].component.NAME;MF_WireframeStoreManager.addDBComponent(lib,componentName,MF_UserSession.getUser(),mf_main.editorController.projectObj,images,cname,true,1,{callback:function(result){mf_main.closeDialog();alert("DB component ID in console.");console.log("DB component has been submitted."+componentName+" ComponentID: "+result);}});}else{MF_WireframeStoreManager.addDBComponent(lib,componentName,MF_UserSession.getUser(),mf_main.editorController.projectObj,images,{callback:function(result){mf_main.closeDialog();alert("DB component ID in console.");console.log("DB component has been submitted."+componentName+" ComponentID: "+result);}});}}else{MF_Utils.display_ActionIndicator("No components selected in page");}};this.setupLayersSlide=function(){var layerLevel=mf_main.editorController.page.childComponents.size();if(mf_main.editorController.layerPanelOpen){layerLevel=mf_main.editorController.page.childComponents.size();if(thisClass.layerSlider!=null){$("#mfLayerDragSlider").data("kendoSlider").destroy();$("#mfLayerDragSlider").closest(".k-slider").remove();$("#mfLayerDragSlider").remove();$("#mfLayerDragContainer").empty();$("#mfLayerDragContainer").append('<input id="mfLayerDragSlider" style=" width: 450px;" class="balSlider" value="0" />');}function sliderOnSlide(e){mf_main.editorController.clearSelection(true);mf_main.editorController.page.layerLevel=e.value;for(var i=0;i<mf_main.editorController.page.childComponents.size();i++){var comp=mf_main.editorController.page.childComponents.getItemAt(i);if(comp.TRANSFORM){if(comp.selector){if(i<mf_main.editorController.page.layerLevel){comp.setVisible(true);}else{comp.setVisible(false);}}}else{if(comp.selector){if(i<mf_main.editorController.page.layerLevel){comp.selector.setComponentVisible(true);}else{comp.selector.setComponentVisible(false);}}}}}$("#mfViewLayers").css("z-index",mf_main.editorController.page.stackOrder.size()+600);thisClass.layerSlider=$("#mfLayerDragSlider").kendoSlider({showButtons:false,change:sliderOnSlide,slide:sliderOnSlide,tickPlacement:"none",min:0,max:mf_main.editorController.page.childComponents.size(),smallStep:1,largeStep:1,tooltip:{enabled:false},value:layerLevel}).data("kendoSlider");}};this.openLayersDialog=function(){if(!mf_main.editorController.layerPanelOpen){mf_main.editorController.layerPanelOpen=true;thisClass.setupLayersSlide();$("#mfViewLayers").show();}else{thisClass.showAllHandler();}};this.showAllHandler=function(){mf_main.editorController.page.layerLevel=-1;thisClass.closeLayersPanel();for(var i=0;i<mf_main.editorController.page.childComponents.size();i++){var comp=mf_main.editorController.page.childComponents.getItemAt(i);if(comp.TRANSFORM){if(comp.selector){comp.setVisible(true);}}else{if(comp.selector){comp.selector.setComponentVisible(true);}}}};this.closeLayersPanel=function(){mf_main.editorController.layerPanelOpen=false;$("#mfViewLayers").hide();};this.saveAsComponent=function(){mf_main.componentList.packController.openAddComponentHandler();};this.saveToStore=function(){$("#mfStorePackNameInput").val(mf_main.componentList.currentCategoryObj.name);mf_main.editorController.storeController.closeStore();mf_main.editorController.disableShortcuts();$("#mfAddToStoreLoadingScreen").hide();$("#mfAddToStoreInputScreen").show();$("#mfTemplateTitle").val(mf_main.editorController.page.pageName);$("#mfAddToStoreModal").modal();};this.saveProject=function(){mf_main.editorController.saveProject(false);};this.submitTemplate=function(){var templateName=$.trim($("#mfTemplateTitle").val());if(templateName==""){alert("Template name cannot be empty");return;}if(templateName.length>100){alert("Template Title should not exceed 100 characters!");return;}var temptype=thisClass.templateTypeList.dataItem().value;if(mf_main.DESIGNMODE){temptype=mf_main.editorController.designStoreController.getDtype();}if(temptype==""){alert("Select a template type");return;}$("#mfAddToStoreLoadingScreen").show();$("#mfAddToStoreInputScreen").hide();thisClass.tempCopyGroups=new Object();for(var k=mf_main.editorController.loadedPages.length-1;k>=0;k--){var page=mf_main.editorController.loadedPages[k];for(var gid in page.groupManager.groups){if(page.groupManager.groups[gid]){thisClass.tempCopyGroups[gid]=true;}}}var exportObj=thisClass.exportComponents(true);var components=exportObj.components;var images=exportObj.images;var premiumStore=false;var hWidth=0;var hHeight=0;var storeTemplateID=MF_Utils.guidGenerator();if(components.length>0){var lib='<library version="1.0">';var stype="sizeless";if(!mf_main.editorController.autoSize){stype="customsize";lib=lib+"<size type='"+stype+"' w='"+mf_main.editorController.page.width+"' h='"+mf_main.editorController.page.height+"' ></size>";}else{lib=lib+"<size type='"+stype+"' ></size>";}lib=lib+mf_main.editorController.fontController.getFontXML();for(var i=0;i<components.length;i++){var componentData=components[i];for(var k=0;k<componentData.componentQueue.length;k++){var currentQueue=componentData.componentQueue[k];var copyXML=currentQueue.componentXML;if(mf_main.DESIGNMODE&&copyXML.attr("type")=="MF_ImageComp"){var imageID=$(copyXML).find("settings").find('property[name="imageID"]').text();if(imageID!=null&&!imageID.includes("/")){if(MF_Global.getS3Bucket()=="assets.mockflow.com"){imageIDURL="https://assets.mockflow.com/app/wireframepro/store/"+storeTemplateID+"/images/"+imageID;}else{imageIDURL="https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/store/"+storeTemplateID+"/images/"+imageID;}$(copyXML).find("settings").find('property[name="imageID"]').text(imageIDURL);}}lib=lib+MF_Utils.xmlToString(copyXML);var thisx=parseFloat(currentQueue.componentXML.attr("x"));var thisy=parseFloat(currentQueue.componentXML.attr("y"));var thisw=0;var thish=0;if(!currentQueue.componentXML.attr("startX")){try{thisw=parseFloat(currentQueue.componentXML.attr("w"));thish=parseFloat(currentQueue.componentXML.attr("h"));}catch(e){}}if((thisx+thisw)>mf_main.editorController.RESTRICT_SIZE_LIMIT||(thisy+thish)>mf_main.editorController.RESTRICT_SIZE_LIMIT){premiumStore=true;}}}lib=lib+"<mfGroupList>";for(var k=mf_main.editorController.loadedPages.length-1;k>=0;k--){var page=mf_main.editorController.loadedPages[k];for(var gid in page.groupManager.groups){if(page.groupManager.groups[gid]){lib=lib+page.groupManager.groups[gid].getXML();}}}lib=lib+"</mfGroupList>";lib=lib+"</library>";var storeTemplate=new MF_StoreTemplate();storeTemplate.id=storeTemplateID;storeTemplate.name=templateName;storeTemplate.type=temptype;storeTemplate.submitter=MF_UserSession.getUser().username;storeTemplate.submitterName=MF_UserSession.getUser().firstName+" "+MF_UserSession.getUser().lastName;storeTemplate.data=lib;storeTemplate.clientId=MF_UserSession.getUser().company;storeTemplate.itemType="template";storeTemplate.premium=premiumStore;if(mf_main.DESIGNMODE){storeTemplate.modeType="designmode";}MF_WireframeStoreManager.addStoreTemplate(storeTemplate,mf_main.editorController.page.eid,MF_UserSession.getUser(),mf_main.editorController.projectObj,images,{callback:function(result){mf_main.closeDialog();alert("Template has been submitted to MockStore for review. After approval it will display in the store");}});}else{mf_main.closeDialog();alert("Page is blank");}};this.undo=function(){mf_main.editorController.clearSelection();MF_ChangeManager.execUndo();};this.redo=function(){mf_main.editorController.clearSelection();MF_ChangeManager.execRedo();};this.groupComponents=function(){var selections=new Array();var selDictionary=new Array();var groups=new Object();mf_main.editorController.removeGlobalSelect();var prevGroupID="";var comps=new Array();if(mf_main.editorController.componentSelect.length>1){var gid="G"+mf_main.editorController.guidGenerator();for(var i=0;i<mf_main.editorController.componentSelect.length;i++){var select=mf_main.editorController.componentSelect[i];if(select.GROUP){var grp=mf_main.editorController.page.groupManager.getGroupByID(select.GROUPID);if(grp){if(grp.parent!=""){prevGroupID=grp.parent;mf_main.editorController.page.groupManager.removeGroupComponent(grp.parent,grp);}mf_main.editorController.page.groupManager.addGroup(gid,grp);comps.push(grp);}}else{if(select.component.GROUPID!=""){prevGroupID=select.component.GROUPID;mf_main.editorController.page.groupManager.removeGroupComponent(select.component.GROUPID,select.component);}select.component.e2xml.addPropSingle("transformLock",false,"default");mf_main.editorController.page.groupManager.addGroup(gid,select.component);comps.push(select.component);}}var gselect=mf_main.editorController.page.groupManager.addGroupSelector(gid);gselect.Select();if(mf_main.editorController.currentGroupEdit!=null){var grp=mf_main.editorController.page.groupManager.getGroupByID(gid);if(grp){mf_main.editorController.page.groupManager.addGroup(mf_main.editorController.currentGroupEdit,grp);}mf_main.editorController.setCompActive(gselect);mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}var undoarr=new Array();var undoobj=new MF_UndoDAO();undoobj.groupUndo(gid,false,mf_main.editorController.page,comps,prevGroupID);undoarr.push(undoobj);var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);mf_main.editorController.clearSelection();mf_main.editorController.addComponentSelect(gselect);mf_main.editorController.addSelectorResize(gselect);}};this.unGroupComponentsHandler=function(e){thisClass.unGroupComponents();};this.unGroupComponents=function(gcomps){try{var glist=mf_main.editorController.componentSelect;if(gcomps){glist=gcomps;}MF_Utils.display_ActionIndicator("Un-Grouping components... ");var undoarr=new Array();for(var i=0;i<glist.length;i++){var select=glist[i];if(select.GROUP){var comps=mf_main.editorController.page.groupManager.getGroupComponents(select.GROUPID);var grpParent=mf_main.editorController.page.groupManager.getGroupByID(select.GROUPID);var parentGroupID="";if(grpParent){parentGroupID=grpParent.parent;}var undo=new MF_UndoDAO();undo.groupUndo(select.GROUPID,true,mf_main.editorController.page,comps.toArray(),parentGroupID);undoarr.push(undo);mf_main.editorController.page.groupManager.clearGroupSelectorByID(select.GROUPID);if(mf_main.editorController.currentGroupEdit!=null){for(var j=0;j<comps.size();j++){var gcomp=comps.getItemAt(j);if(gcomp.GROUPOBJ){var grp=mf_main.editorController.page.groupManager.getGroupByID(gcomp.GROUPID);if(grp){mf_main.editorController.page.groupManager.addGroup(mf_main.editorController.currentGroupEdit,grp);if(grp.selector){mf_main.editorController.setCompActive(grp.selector);}}}else{mf_main.editorController.page.groupManager.addGroup(mf_main.editorController.currentGroupEdit,gcomp);mf_main.editorController.setCompActive(gcomp.selector);}}}}}if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}mf_main.editorController.clearSelection();}catch(e){}};this.addToQueue=function(selector,componentxml,qCollection){var queObjmain=new MF_ComponentQueue();queObjmain.componentXML=componentxml;queObjmain.componentXML.attr("x",(parseFloat(queObjmain.componentXML.attr("x"))+10).toString());queObjmain.componentXML.attr("y",(parseFloat(queObjmain.componentXML.attr("y"))+10).toString());if(selector&&selector.component&&selector.component.TRANSFORM){queObjmain.componentXML.attr("startX",(parseFloat(queObjmain.componentXML.attr("startX"))+10).toString());queObjmain.componentXML.attr("startY",(parseFloat(queObjmain.componentXML.attr("startY"))+10).toString());queObjmain.componentXML.attr("endX",(parseFloat(queObjmain.componentXML.attr("endX"))+10).toString());queObjmain.componentXML.attr("endY",(parseFloat(queObjmain.componentXML.attr("endY"))+10).toString());if(selector.component.NAME=="MF_ArrowPath"){if(!mf_main.componentList.packController.isExportComponentAsImage){thisClass.updateArrowWaypoints(queObjmain.componentXML,20,20);}else{thisClass.updateArrowWaypoints(queObjmain.componentXML,10,10);}}}if(selector&&selector.component&&!selector.component.AUTO_SIZE){var w=selector.width;var h=selector.height;queObjmain.componentXML.attr("w",w);queObjmain.componentXML.attr("h",h);}qCollection[qCollection.length]=queObjmain;};this.checkGroupSelect=function(select){if(mf_main.editorController.currentGroupEdit!=null){return true;}if(select.component&&select.component.GROUPID!=""){return false;}else{return true;}};this.sortX=function(){var num=new Array();var sortedArray=new Array();for(var i=0;i<mf_main.editorController.componentSelect.length;i++){var select=mf_main.editorController.componentSelect[i];num.push(select.x);}num=num.sort(function(a,b){return a-b;});for(var k=0;k<num.length;k++){var numx=num[k];for(var i=0;i<mf_main.editorController.componentSelect.length;i++){var select2=mf_main.editorController.componentSelect[i];if(select2.x==numx){sortedArray.push(select2);}}}return sortedArray;};this.sortY=function(){var num=new Array();var sortedArray=new Array();for(var i=0;i<mf_main.editorController.componentSelect.length;i++){var select=mf_main.editorController.componentSelect[i];num.push(select.y);}num=num.sort(function(a,b){return a-b;});for(var k=0;k<num.length;k++){var numy=num[k];for(var i=0;i<mf_main.editorController.componentSelect.length;i++){var select2=mf_main.editorController.componentSelect[i];if(select2.y==numy){sortedArray.push(select2);}}}return sortedArray;};this.sendBackward=function(){try{mf_main.editorController.removeSelectorResize();var selections=new Array();var selDictionary=new Array();var groups=new Object();if(mf_main.editorController.componentSelect.length>0){MF_Utils.display_ActionIndicator("Sending backward...");}else{return;}for(var i=0;i<mf_main.editorController.componentSelect.length;i++){var cselect=mf_main.editorController.componentSelect[i];selDictionary.push(cselect);if(!cselect.GROUP&&cselect.component.GROUPID!=""){groups[cselect.component.GROUPID]=true;}}thisClass.getComponents(selDictionary,selections,groups);var undoarr=new Array();var orderArr=thisClass.orderSelection(selections);var sendBackward=true;for(var k=0;k<orderArr.length;k++){var select2=orderArr[k];if(select2.component.eid==mf_main.editorController.page.childComponents.getItemAt(0).eid){sendBackward=false;break;}}if(sendBackward){orderArr=orderArr.reverse();for(var k=0;k<orderArr.length;k++){var select2=orderArr[k];var curind=mf_main.editorController.page.childComponents.getItemIndex(select2.component);if(curind!=-1){var undo=new MF_PositionObj(select2.component,curind-1,curind);undoarr.push(undo);}}orderArr=orderArr.reverse();for(var k=0;k<orderArr.length;k++){var select2=orderArr[k];var curind=mf_main.editorController.page.childComponents.getItemIndex(select2.component);if(curind!=-1){mf_main.editorController.page.childComponents.removeItemAt(curind);mf_main.editorController.page.childComponents.addItemAt(select2.component,curind-1);}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();undoObj.positionUndo(undoarr);MF_ChangeManager.addUndo(undoObj);}mf_main.editorController.reStackComponents();}}catch(err){}};this.sendForward=function(){try{mf_main.editorController.removeSelectorResize();var selections=new Array();var selDictionary=new Array();var groups=new Object();if(mf_main.editorController.componentSelect.length>0){MF_Utils.display_ActionIndicator("Sending forward...");}else{return;}for(var i=0;i<mf_main.editorController.componentSelect.length;i++){var cselect=mf_main.editorController.componentSelect[i];selDictionary.push(cselect);if(!cselect.GROUP&&cselect.component.GROUPID!=""){groups[cselect.component.GROUPID]=true;}}thisClass.getComponents(selDictionary,selections,groups);var undoarr=new Array();var orderArr=thisClass.orderSelection(selections);orderArr=orderArr.reverse();var sendForward=true;var totalSize=mf_main.editorController.page.childComponents.size();for(var k=0;k<orderArr.length;k++){var select2=orderArr[k];if(select2.component==mf_main.editorController.page.childComponents.getItemAt(totalSize-1)){sendForward=false;break;}}if(sendForward){orderArr=orderArr.reverse();for(var k=0;k<orderArr.length;k++){var select2=orderArr[k];var curind=mf_main.editorController.page.childComponents.getItemIndex(select2.component);if(curind!=-1){var undo=new MF_PositionObj(select2.component,curind+1,curind);undoarr.push(undo);}}orderArr=orderArr.reverse();for(var k=0;k<orderArr.length;k++){var select2=orderArr[k];var curind=mf_main.editorController.page.childComponents.getItemIndex(select2.component);if(curind!=-1){mf_main.editorController.page.childComponents.removeItemAt(curind);mf_main.editorController.page.childComponents.addItemAt(select2.component,curind+1);}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();undoObj.positionUndo(undoarr);MF_ChangeManager.addUndo(undoObj);}mf_main.editorController.reStackComponents();}}catch(err){}};this.sendFront=function(){try{mf_main.editorController.removeSelectorResize();var selections=new Array();var selDictionary=new Array();var groups=new Object();if(mf_main.editorController.componentSelect.length>0){MF_Utils.display_ActionIndicator("Sending to front...");}else{return;}for(var i=0;i<mf_main.editorController.componentSelect.length;i++){var cselect=mf_main.editorController.componentSelect[i];selDictionary.push(cselect);if(!cselect.GROUP&&cselect.component.GROUPID!=""){groups[cselect.component.GROUPID]=true;}}thisClass.getComponents(selDictionary,selections,groups);var undoarr=new Array();var frontindex=mf_main.editorController.page.childComponents.size();var orderArr=thisClass.orderSelection(selections);var undoindex=frontindex;for(var k=0;k<orderArr.length;k++){var select2=orderArr[k];var curind=mf_main.editorController.page.childComponents.getItemIndex(select2.component);if(curind!=-1){var undo=new MF_PositionObj(select2.component,undoindex,curind);undoarr.push(undo);undoindex++;}}for(var k=0;k<orderArr.length;k++){var select2=orderArr[k];var curind=mf_main.editorController.page.childComponents.getItemIndex(select2.component);if(curind!=-1){mf_main.editorController.page.childComponents.removeItemAt(curind);mf_main.editorController.page.childComponents.addItemAt(select2.component,frontindex);}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();undoObj.positionUndo(undoarr);MF_ChangeManager.addUndo(undoObj);}mf_main.editorController.reStackComponents();}catch(err){}};this.sendBack=function(){try{mf_main.editorController.removeSelectorResize();var selections=new Array();var selDictionary=new Array();var groups=new Object();if(mf_main.editorController.componentSelect.length>0){MF_Utils.display_ActionIndicator("Sending to back...");}else{return;}for(var i=0;i<mf_main.editorController.componentSelect.length;i++){var cselect=mf_main.editorController.componentSelect[i];selDictionary.push(cselect);if(!cselect.GROUP&&cselect.component.GROUPID!=""){groups[cselect.component.GROUPID]=true;}}thisClass.getComponents(selDictionary,selections,groups);var undoarr=new Array();var frontindex=0;var orderArr=thisClass.orderSelection(selections);orderArr=orderArr.reverse();var undoindex=frontindex;for(var k=0;k<orderArr.length;k++){var select2=orderArr[k];var curind=mf_main.editorController.page.childComponents.getItemIndex(select2.component);if(curind!=-1){var undo=new MF_PositionObj(select2.component,undoindex,curind);undoarr.push(undo);undoindex--;}}for(var k=0;k<orderArr.length;k++){var select2=orderArr[k];var curind=mf_main.editorController.page.childComponents.getItemIndex(select2.component);if(curind!=-1){mf_main.editorController.page.childComponents.removeItemAt(curind);mf_main.editorController.page.childComponents.addItemAt(select2.component,frontindex);}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();undoObj.positionUndo(undoarr);MF_ChangeManager.addUndo(undoObj);}mf_main.editorController.reStackComponents();}catch(err){}};this.resetRotation=function(){var undoarr=new Array();if(mf_main.editorController.componentSelect.length>0){MF_Utils.display_ActionIndicator("Reset rotation angle to '0'...");}for(var i=0;i<mf_main.editorController.componentSelect.length;i++){var selector=mf_main.editorController.componentSelect[i];if(selector.GROUP){}else{if(selector.component&&selector.component.NAME!="Page"){var undo=new MF_UndoDAO();undo.propSingleUndo(selector.component,"eangle",selector.component.eangle);undoarr.push(undo);selector.component.e2xml.addPropSingle("eangle",0);}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}mf_main.editorController.clearSelection();};this.unLockComponent=function(populate){if(populate==undefined){populate=true;}var lastcomponent;var undoarr=new Array();var sarr=mf_main.editorController.componentSelect;if(sarr.length==0){if(mf_main.editorController.lastSetting&&mf_main.editorController.lastSetting.selector){sarr.push(mf_main.editorController.lastSetting.selector);}}if(sarr.length>0){MF_Utils.display_ActionIndicator("Un-Lock selected...");}for(var i=0;i<sarr.length;i++){var lock=sarr[i];if(lock!=null&&lock.locked){if(lock.GROUP){lock.setLocking(false);var gundo=new MF_UndoDAO();gundo.lockGroupUndo(lock.GROUPID,true,mf_main.editorController.page);undoarr.push(gundo);mf_main.editorController.page.groupManager.unLockGroup(lock.GROUPID);}else{if(lock.component&&lock.component.NAME!="Page"){var undo=new MF_UndoDAO();undo.propSingleUndo(lock.component,"transformLock",true);undoarr.push(undo);lock.setLocking(false);lock.component.e2xml.addPropSingle("transformLock",false);}}lastcomponent=lock.component;}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}mf_main.editorController.clearSelection();};this.alignLeftHandler=function(){var lowestX=0;var count=0;for(var i=0;i<mf_main.editorController.componentSelect.length;i++){var select=mf_main.editorController.componentSelect[i];if(thisClass.checkGroupSelect(select)){if(count==0){lowestX=select.x;}else{if(select.x<lowestX){lowestX=select.x;}}count++;}}if(count>1){var undoarr=new Array();for(var y=0;y<mf_main.editorController.componentSelect.length;y++){var select2=mf_main.editorController.componentSelect[y];if(thisClass.checkGroupSelect(select2)){select2.x=lowestX;if(select2.GROUP){var arr=mf_main.editorController.rePositionComponents(select2);for(var n=0;n<arr.length;n++){var udo=arr[n];undoarr.push(udo);}}else{var undo=new MF_UndoDAO();undo.propObjectUndo(select2.component,"ecoordinates",select2.component.ecoordinates);undoarr.push(undo);select2.setCoordinate(false,false);}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);meta.reselectMeta=true;undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}mf_main.editorController.performGlobalSelection();if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}}};this.alignCenterHandler=function(){if(mf_main.editorController.componentSelect.length>0&&mf_main.editorController.globalselect){var midX=mf_main.editorController.globalselect.x+(mf_main.editorController.globalselect.width/2);var undoarr=new Array();for(var y=0;y<mf_main.editorController.componentSelect.length;y++){var select2=mf_main.editorController.componentSelect[y];if(thisClass.checkGroupSelect(select2)){select2.x=midX-(select2.width/2);if(select2.GROUP){var arr=mf_main.editorController.rePositionComponents(select2);for(var n=0;n<arr.length;n++){var udo=arr[n];undoarr.push(udo);}}else{var undo=new MF_UndoDAO();undo.propObjectUndo(select2.component,"ecoordinates",select2.component.ecoordinates);undoarr.push(undo);select2.setCoordinate(false,false);}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);meta.reselectMeta=true;undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}mf_main.editorController.performGlobalSelection();if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}}};this.alignMiddleHandler=function(){if(mf_main.editorController.componentSelect.length>0&&mf_main.editorController.globalselect){var midY=mf_main.editorController.globalselect.y+(mf_main.editorController.globalselect.height/2);var undoarr=new Array();for(var y=0;y<mf_main.editorController.componentSelect.length;y++){var select2=mf_main.editorController.componentSelect[y];if(thisClass.checkGroupSelect(select2)){select2.y=midY-(select2.height/2);if(select2.GROUP){var arr=mf_main.editorController.rePositionComponents(select2);for(var n=0;n<arr.length;n++){var udo=arr[n];undoarr.push(udo);}}else{var undo=new MF_UndoDAO();undo.propObjectUndo(select2.component,"ecoordinates",select2.component.ecoordinates);undoarr.push(undo);select2.setCoordinate(false,false);}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);meta.reselectMeta=true;undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}mf_main.editorController.performGlobalSelection();if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}}};this.alignRightHandler=function(){var highestX=0;var count=0;for(var i=0;i<mf_main.editorController.componentSelect.length;i++){var select=mf_main.editorController.componentSelect[i];if(thisClass.checkGroupSelect(select)){if(count==0){highestX=select.x+select.width;}else{if((select.x+select.width)>highestX){highestX=select.x+select.width;}}count++;}}if(count>1){var undoarr=new Array();for(var y=0;y<mf_main.editorController.componentSelect.length;y++){var select2=mf_main.editorController.componentSelect[y];if(thisClass.checkGroupSelect(select2)){select2.x=highestX-select2.width;if(select2.GROUP){var arr=mf_main.editorController.rePositionComponents(select2);for(var n=0;n<arr.length;n++){var udo=arr[n];undoarr.push(udo);}}else{var undo=new MF_UndoDAO();undo.propObjectUndo(select2.component,"ecoordinates",select2.component.ecoordinates);undoarr.push(undo);select2.setCoordinate(false,false);}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);meta.reselectMeta=true;undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}mf_main.editorController.performGlobalSelection();if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}}};this.alignTopHandler=function(){var lowestY=0;var count=0;for(var i=0;i<mf_main.editorController.componentSelect.length;i++){var select=mf_main.editorController.componentSelect[i];if(thisClass.checkGroupSelect(select)){if(count==0){lowestY=select.y;}else{if(select.y<lowestY){lowestY=select.y;}}count++;}}if(count>1){var undoarr=new Array();for(var y=0;y<mf_main.editorController.componentSelect.length;y++){var select2=mf_main.editorController.componentSelect[y];if(thisClass.checkGroupSelect(select2)){select2.y=lowestY;if(select2.GROUP){var arr=mf_main.editorController.rePositionComponents(select2);for(var n=0;n<arr.length;n++){var udo=arr[n];undoarr.push(udo);}}else{var undo=new MF_UndoDAO();undo.propObjectUndo(select2.component,"ecoordinates",select2.component.ecoordinates);undoarr.push(undo);select2.setCoordinate(false,false);}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);meta.reselectMeta=true;undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}mf_main.editorController.performGlobalSelection();if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}}};this.alignBottomHandler=function(){var highestY=0;var count=0;for(var i=0;i<mf_main.editorController.componentSelect.length;i++){var select=mf_main.editorController.componentSelect[i];if(thisClass.checkGroupSelect(select)){if(count==0){highestY=select.y+select.height;}else{if((select.y+select.height)>highestY){highestY=select.y+select.height;}}count++;}}if(count>1){var undoarr=new Array();for(var y=0;y<mf_main.editorController.componentSelect.length;y++){var select2=mf_main.editorController.componentSelect[y];if(thisClass.checkGroupSelect(select2)){select2.y=highestY-select2.height;if(select2.GROUP){var arr=mf_main.editorController.rePositionComponents(select2);for(var n=0;n<arr.length;n++){var udo=arr[n];undoarr.push(udo);}}else{var undo=new MF_UndoDAO();undo.propObjectUndo(select2.component,"ecoordinates",select2.component.ecoordinates);undoarr.push(undo);select2.setCoordinate(false,false);}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);meta.reselectMeta=true;undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}mf_main.editorController.performGlobalSelection();if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}}};this.distributeWidthHandler=function(){var totalWidth=0;var actualWidth=0;var lowestX=0;var highestX=0;var count=0;var rev=thisClass.sortX();for(var i=0;i<rev.length;i++){var select=rev[i];if(thisClass.checkGroupSelect(select)){actualWidth=actualWidth+select.width;if(count==0){lowestX=select.x;}else{if(select.x<lowestX){lowestX=select.x;}}if(count==0){highestX=select.x+select.width;}else{if((select.x+select.width)>highestX){highestX=select.x+select.width;}}count++;}}totalWidth=highestX-lowestX;var distX=(totalWidth-actualWidth)/(count-1);if(count>2){var icount=0;var lastX=0;var undoarr=new Array();for(var i=0;i<rev.length;i++){var select2=rev[i];if(thisClass.checkGroupSelect(select2)){if(icount==0){select2.x=lowestX;lastX=select2.x+select2.width;}else{if(icount!=rev.length){select2.x=lastX+distX;lastX=select2.x+select2.width;}}if(select2.GROUP){var arr=mf_main.editorController.rePositionComponents(select2);for(var n=0;n<arr.length;n++){var udo=arr[n];undoarr.push(udo);}}else{var undo=new MF_UndoDAO();undo.propObjectUndo(select2.component,"ecoordinates",select2.component.ecoordinates);undoarr.push(undo);select2.setCoordinate(false,false);}icount++;}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);meta.reselectMeta=true;undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}mf_main.editorController.performGlobalSelection();if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}}};this.distributeHeightHandler=function(){var totalHeight=0;var actualHeight=0;var lowestY=0;var highestY=0;var count=0;var rev=thisClass.sortY();for(var i=0;i<rev.length;i++){var select=rev[i];if(thisClass.checkGroupSelect(select)){actualHeight=actualHeight+select.height;if(count==0){lowestY=select.y;}else{if(select.y<lowestY){lowestY=select.y;}}if(count==0){highestY=select.y+select.height;}else{if((select.y+select.height)>highestY){highestY=select.y+select.height;}}count++;}}totalHeight=highestY-lowestY;var distY=(totalHeight-actualHeight)/(count-1);if(count>2){var icount=0;var lastY=0;var undoarr=new Array();for(var i=0;i<rev.length;i++){var select2=rev[i];if(thisClass.checkGroupSelect(select2)){if(icount==0){select2.y=lowestY;lastY=select2.y+select2.height;}else{if(icount!=rev.length){select2.y=lastY+distY;lastY=select2.y+select2.height;}}if(select2.GROUP){var arr=mf_main.editorController.rePositionComponents(select2);for(var n=0;n<arr.length;n++){var udo=arr[n];undoarr.push(udo);}}else{var undo=new MF_UndoDAO();undo.propObjectUndo(select2.component,"ecoordinates",select2.component.ecoordinates);undoarr.push(undo);select2.setCoordinate(false,false);}icount++;}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);meta.reselectMeta=true;undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}mf_main.editorController.performGlobalSelection();if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}}};this.unLockAllComponents=function(populate){if(populate==undefined){populate=true;}var arr=new Array();var undoarr=new Array();MF_Utils.display_ActionIndicator("Un-Lock all components");for(var j=0;j<mf_main.editorController.page.childComponents.size();j++){var component=mf_main.editorController.page.childComponents.getItemAt(j);arr.push(component.selector);}for(var k in mf_main.editorController.page.groupManager.groupSelectors){var gselector=mf_main.editorController.page.groupManager.groupSelectors[k];arr.push(gselector);}var lastcomponent;for(var i=0;i<arr.length;i++){var lock=arr[i];if(lock!=null&&lock.locked){if(lock.GROUP){lock.setLocking(false);var gundo=new MF_UndoDAO();gundo.lockGroupUndo(lock.GROUPID,true,mf_main.editorController.page);undoarr.push(gundo);mf_main.editorController.page.groupManager.unLockGroup(lock.GROUPID);}else{if(lock.component.NAME!="Page"){if(lock.locked){var undo=new MF_UndoDAO();undo.propSingleUndo(lock.component,"transformLock",true);undoarr.push(undo);lock.setLocking(false);lock.component.e2xml.addPropSingle("transformLock",false);}}}lastcomponent=lock.component;}}mf_main.editorController.page.groupManager.unLockAllGroups();if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}mf_main.editorController.clearSelection();};this.lockComponent=function(populate){if(populate==undefined){populate=true;}var lastcomponent;var undoarr=new Array();if(mf_main.editorController.componentSelect.length>0){MF_Utils.display_ActionIndicator("Lock selected...");}for(var i=0;i<mf_main.editorController.componentSelect.length;i++){var lock=mf_main.editorController.componentSelect[i];if(lock!=null&&!lock.locked){if(lock.GROUP){lock.setLocking(true);var gundo=new MF_UndoDAO();gundo.lockGroupUndo(lock.GROUPID,false,mf_main.editorController.page);undoarr.push(gundo);mf_main.editorController.page.groupManager.lockGroup(lock.GROUPID);}else{if(lock.component&&lock.component.NAME!="Page"){if(lock.component.GROUPID==""||lock.component.GROUPID==mf_main.editorController.currentGroupEdit){var undo=new MF_UndoDAO();undo.propSingleUndo(lock.component,"transformLock",false);undoarr.push(undo);lock.setLocking(true);lock.component.e2xml.addPropSingle("transformLock",true,"default");}}}lastcomponent=lock.component;}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}mf_main.editorController.clearSelection();};this.prepareLoadComponent=function(selector,undocopy){if(undocopy==null){undocopy=true;}var qCollection=new Array();var settings=selector.component.exml();settings.attr("eid",selector.component.eid);var grpPresent=false;if(settings.attr("groupid")!=""){if(thisClass.tempCopyGroups[settings.attr("groupid")]){grpPresent=true;}}if(!grpPresent){settings.attr("groupid","");}thisClass.addToQueue(selector,settings,qCollection);var qArray=qCollection;qArray=qArray.reverse();return qArray;};this.positionRecursively=function(component){var ind=0;var index=$("#"+component.eid).css("z-index");if(index=="auto"){index=0;}for(var j=0;j<mf_main.editorController.page.childComponents.size();j++){if(mf_main.editorController.page.childComponents.getItemAt(j)==component){ind=j;break;}}var undo=new MF_PositionObj(null,component,ind);undo.eid=component.eid;thisClass.positionDelArray.push(undo);};this.getComponents=function(dict,compArray,groups){if(groups==undefined){groups=null;}for(var i=0;i<dict.length;i++){var selector=dict[i];if(selector.GROUP){thisClass.getComponents(selector.getGlobalSelectsArray(),compArray,groups);}else{if(groups!=null&&selector.component.GROUPID!=""){groups[selector.component.GROUPID]=true;}compArray.push(selector);}}return compArray;};this.orderSelection=function(arr){var order=new Array();var min=0;var dict=new Object();for(var i=0;i<arr.length;i++){var comp=arr[i];var ind=comp.zindex;dict[ind]=comp;order[order.length]=ind;}order=order.sort(function(a,b){return a-b;});var newOrder=new Array();for(var b=0;b<order.length;b++){var num=order[b];newOrder[newOrder.length]=dict[num];}return newOrder;};this.deleteRecursively=function(component,iddel,groups){if(component.GROUPID!=""){groups[component.GROUPID]=true;}if(component){var ind=mf_main.editorController.page.childComponents.getItemIndex(component);if(ind==-1){component=mf_main.editorController.page.childDictionary[component.eid];ind=mf_main.editorController.page.childComponents.getItemIndex(component);}if(ind>=0){mf_main.editorController.page.childComponents.removeItemAt(ind);}mf_main.editorController.stopCompObserve(component.eid);delete mf_main.editorController.page.childDictionary[component.eid];}if(iddel){MF_IDManager.deleteID(mf_main.editorController.page,component.eid);}mf_main.editorController.removeComponent(component);};this.deleteComponentHandler=function(e){thisClass.deleteComponent();};this.deleteComponent=function(darr,_action){try{var deleted=false;var delarray=new Array();thisClass.positionDelArray=new Array();var groups=new Object();var selections=new Array();var selDictionary=new Array();var delSelectArr=mf_main.editorController.componentSelect;if(darr){delSelectArr=darr;}if(delSelectArr.length>0){MF_Utils.display_ActionIndicator("Delete selected...");}else{return;}thisClass.tempCopyGroups=new Object();var grplist=new Array();var fullDeleteGroups=new Object();for(var i=0;i<delSelectArr.length;i++){var cselect=delSelectArr[i];if(darr){if(cselect.GROUPOBJ){thisClass.tempCopyGroups[cselect.GROUPID]=true;grplist.push(cselect);}}else{if(cselect.GROUP&&(cselect.GLOBAL_SELECT||cselect.GROUPOBJ)&&cselect.GROUPID!=""&&!thisClass.tempCopyGroups[cselect.GROUPID]){thisClass.addChildGroups(cselect.GROUPID,grplist);}}if(cselect.GROUP&&cselect.GROUPID!=""){fullDeleteGroups[cselect.GROUPID]=true;}if(cselect.component&&cselect.component.GROUPID!=""){thisClass.tempCopyGroups[cselect.component.GROUPID]=true;}}for(var i=0;i<delSelectArr.length;i++){var cselect=delSelectArr[i];if(!cselect.GROUPOBJ){var add=true;for(var j=0;j<selDictionary.length;j++){var cselect2=selDictionary[j];if(cselect2==cselect){add=false;}}if(add){selDictionary[selDictionary.length]=cselect;}}}thisClass.getComponents(selDictionary,selections);var newselections=thisClass.orderSelection(selections);for(var i=0;i<newselections.length;i++){var posget=newselections[i];if(posget!=null){var select;if(posget instanceof MF_Selector){select=posget;}else{select=posget.select;}thisClass.positionRecursively(select.component);}}for(var i=0;i<newselections.length;i++){var del=newselections[i];if(del!=null){deleted=true;var mcopy=new MF_CopyComponent(thisClass.prepareLoadComponent(del));delarray.push(mcopy);thisClass.deleteAnComponent(del,groups,true,false);}}var delgroups=new Object();for(var groupid in groups){var grp=mf_main.editorController.page.groupManager.groups[groupid];if(grp&&grp.children.size()==0){delgroups[groupid]=true;}}for(var k=0;k<grplist.length;k++){delarray.push(grplist[k]);if(!delgroups[grplist[k].GROUPID]){delgroups[grplist[k].GROUPID]=true;}}var currentGroupDeleted=false;var currentGroup=mf_main.editorController.currentGroupEdit;for(var groupid in delgroups){var grp=mf_main.editorController.page.groupManager.groups[groupid];var par="";if(grp){par=grp.parent;}if(mf_main.editorController.currentGroupEdit!=null&&groupid==mf_main.editorController.currentGroupEdit){if(grp&&grp.parent!=""){currentGroup=grp.parent;}currentGroupDeleted=true;}mf_main.editorController.page.groupManager.clearGroupSelectorByID(groupid);if(par!=""){mf_main.editorController.page.groupManager.resetParentSelectorGroups(par);}}var delarray2=new Array();for(var groupid in mf_main.editorController.page.groupManager.groups){var grp=mf_main.editorController.page.groupManager.groups[groupid];if(grp&&grp.children.size()==0){var par=grp.parent;if(mf_main.editorController.currentGroupEdit!=null&&groupid==mf_main.editorController.currentGroupEdit){if(grp&&grp.parent!=""){currentGroup=grp.parent;}currentGroupDeleted=true;}thisClass.addChildGroups(groupid,delarray2);mf_main.editorController.page.groupManager.clearGroupSelectorByID(groupid);if(par!=""){mf_main.editorController.page.groupManager.resetParentSelectorGroups(par);}}}for(var k=0;k<delarray2.length;k++){delarray.push(delarray2[k]);}thisClass.undoDelObjects(delarray,_action);if(currentGroup!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(currentGroup);}else{for(var lgid in thisClass.tempCopyGroups){mf_main.editorController.page.groupManager.resetParentSelectorGroups(lgid);}}mf_main.editorController.clearSelection();thisClass.setupLayersSlide();}catch(error){}};this.undoDelObjects=function(arr,_action){var undoobj=new MF_UndoDAO();thisClass.positionDelArray=thisClass.positionDelArray.reverse();undoobj.delUndo(arr,thisClass.positionDelArray);if(_action=="false"){MF_ChangeManager.addRedo(undoobj);}else{MF_ChangeManager.addUndo(undoobj);}};this.duplicateComponent=function(){thisClass.copyComponent();thisClass.pasteComponent(false,true,false,true);};this.repeatComponent=function(){thisClass.repeatMode=true;thisClass.repeatCount=2;var selector1=mf_main.editorController.componentSelect[0];var selector2=mf_main.editorController.componentSelect[1];var rx=0;var ry=0;thisClass.repeatX=0;thisClass.repeatY=0;if(selector1.x>selector2.x){rx=selector1.x-selector2.x;}else{rx=selector2.x-selector1.x;}if(selector1.y>selector2.y){ry=selector1.y-selector2.y;}else{ry=selector2.y-selector1.y;}thisClass.copyComponent();thisClass.repeatMode=true;rx=rx*thisClass.repeatCount;ry=ry*thisClass.repeatCount;for(var i=0;i<thisClass.repeatTimes;i++){thisClass.repeatX=thisClass.repeatX+rx;thisClass.repeatY=thisClass.repeatY+ry;thisClass.pasteComponent(false,true,false,false);}thisClass.repeatMode=false;};this.pasteInPlace=function(){for(var i=0;i<thisClass.copyComponents.length;i++){if(!thisClass.copyComponents[i].GROUP){for(var j=0;j<thisClass.copyComponents[i].componentQueue.length;j++){thisClass.copyComponents[i].componentQueue[j].pasteInPlace=true;}}}for(var i=0;i<thisClass.cutComponents.length;i++){if(!thisClass.cutComponents[i].GROUP){for(var j=0;j<thisClass.cutComponents[i].componentQueue.length;j++){thisClass.cutComponents[i].componentQueue[j].pasteInPlace=true;}}}};this.deleteAnComponent=function(obj,groups,iddel,restack){try{if(iddel==undefined){iddel=true;}if(restack==undefined){restack=true;}var select;if(obj instanceof MF_Selector){select=obj;}else{select=obj.selector;}var ind=mf_main.editorController.page.stackOrder.getItemIndex(select.component);if(ind==-1){if(mf_main.editorController.page.childDictionary[select.component.eid]){select=mf_main.editorController.page.childDictionary[select.component.eid].selector;}ind=mf_main.editorController.page.stackOrder.getItemIndex(select.component.eid);}if(ind!=-1){mf_main.editorController.page.stackOrder.removeItemAt(ind);}if(select.component.GROUPID!=""){mf_main.editorController.page.groupManager.removeGroupComponent(select.component.GROUPID,select.component);}thisClass.deleteRecursively(select.component,iddel,groups);if(obj instanceof MF_Selector){var sind=mf_main.editorController.page.stackOrder.getItemIndex(select);if(sind==-1){if(mf_main.editorController.page.selectors[select.id]){select=mf_main.editorController.page.selectors[select.id];}sind=mf_main.editorController.page.stackOrder.getItemIndex(select);}if(sind!=-1){mf_main.editorController.page.stackOrder.removeItemAt(sind);}$("#"+select.id).remove();}if(restack){mf_main.editorController.clearSelection();}}catch(Error){console.log(Error);}};this.cutComponent=function(){thisClass.copyComponent();thisClass.deleteComponent();};this.addChildGroups=function(gid,comps,noparent){var grp=mf_main.editorController.page.groupManager.getGroupByID(gid);if(grp&&!thisClass.tempCopyGroups[grp.GROUPID]){thisClass.tempCopyGroups[grp.GROUPID]=true;var copyObj=new MF_CopyComponent();copyObj.GROUP=true;copyObj.GROUPID=grp.GROUPID;if(noparent){copyObj.parent="";}else{copyObj.parent=grp.parent;}copyObj.GROUPOBJ=true;comps.push(copyObj);for(var i=0;i<grp.children.size();i++){var ch=grp.children.getItemAt(i);if(ch.GROUPOBJ){thisClass.addChildGroups(ch.GROUPID,comps);}}}};this.cloneCopyArray=function(copyarr){var arr=new Array();for(var j=0;j<copyarr.length;j++){var copy=copyarr[j];if(copy.GROUPOBJ){var copyObj=new MF_CopyComponent();copyObj.GROUP=copy.GROUP;copyObj.GROUPID=copy.GROUPID;copyObj.parent=copy.parent;copyObj.GROUPOBJ=true;arr.push(copyObj);}else{arr.push(copy);}}return arr;};this.copyComponent=function(e){try{if(mf_main.INTEGRATION){$("mfclipboard").val("");$("#mfclipboard").focus().select();document.execCommand("copy");}else{if(navigator.clipboard){navigator.clipboard.writeText("");}else{if(e){e.clipboardData.setData("text/plain","");}}}}catch(e){console.log(e);}var nativeCopy=false;var lib="";thisClass.copyComponents=new Array();thisClass.cutComponents=new Array();if(mf_main.editorController.componentSelect.length>0){MF_Utils.display_ActionIndicator("Copy selected...");}else{return;}thisClass.tempCopyGroups=new Object();thisClass.topCopyGroups=new Object();var cmplist=new Array();for(var i=0;i<mf_main.editorController.componentSelect.length;i++){var cselect=mf_main.editorController.componentSelect[i];if(cselect.GROUP&&cselect.GLOBAL_SELECT&&cselect.GLOBAL_SELECT&&cselect.GROUPID!=""&&!thisClass.tempCopyGroups[cselect.GROUPID]){thisClass.topCopyGroups[cselect.GROUPID]=true;thisClass.addChildGroups(cselect.GROUPID,cmplist,true);}}thisClass.copyComponents=cmplist;if(e){try{var exportObj=thisClass.exportComponents();var components=exportObj.components;var images=exportObj.images;if(components.length>0){lib='<wireframeprocopy mfxprojectid="'+mf_main.editorController.projectObj.id+'" mfxclientid="'+mf_main.editorController.projectObj.company+'" >';var customFontXML="";for(var b=0;b<images.length;b++){var imageid=images[b];lib=lib+'<mfximagecomp id="'+imageid+'"  ></mfximagecomp>';}for(var i=0;i<components.length;i++){var componentData=components[i];for(var k=0;k<componentData.componentQueue.length;k++){var currentQueue=componentData.componentQueue[k];var copyXML=currentQueue.componentXML;var grpPresent=false;if(copyXML.attr("groupid")!=""){if(thisClass.tempCopyGroups[copyXML.attr("groupid")]){grpPresent=true;}}if(!grpPresent){copyXML.attr("groupid","");}lib=lib+MF_Utils.xmlToString(copyXML);if($(copyXML).find("settings").find('property[name="isGoogleFontUsed"]').text()=="false"){var customFontName=$(copyXML).find("settings").find('property[name="fontType"]').text();customFontXML=customFontXML+mf_main.editorController.fontController.getCustomFontXML(customFontName);}}}if(customFontXML!=""){customFontXML="<mffontcollection>"+customFontXML+"</mffontcollection>";lib=lib+customFontXML;}lib=lib+"<mfGroupList>";for(var c in thisClass.tempCopyGroups){var grp=mf_main.editorController.page.groupManager.getGroupByID(c);if(grp){if(thisClass.topCopyGroups[grp.GROUPID]){lib=lib+grp.getXML(true);}else{lib=lib+grp.getXML();}}}lib=lib+"</mfGroupList>";lib=lib+"</wireframeprocopy>";}}catch(err){console.log(err);}}thisClass.repeatMode=false;var copied=false;var selections=new Array();var selDictionary=new Array();for(var i=0;i<mf_main.editorController.componentSelect.length;i++){var cselect=mf_main.editorController.componentSelect[i];var add=true;for(var j=0;j<selDictionary.length;j++){var cselect2=selDictionary[j];if(cselect2==cselect){add=false;}}if(add){selDictionary[selDictionary.length]=cselect;}}copiedPage=mf_main.editorController.page.eid;thisClass.getComponents(selDictionary,selections);var arr=thisClass.orderSelection(selections);for(var i=0;i<arr.length;i++){var copy=arr[i];if(copy!=null){var copyObj=new MF_CopyComponent(thisClass.prepareLoadComponent(copy));copied=true;thisClass.copyComponents.push(copyObj);}}if(e&&lib!=""){try{if(mf_main.INTEGRATION){var textbox=document.getElementById("mfclipboard");textbox.value=lib;$("#mfclipboard").focus().select();e.clipboardData.setData("text/plain",lib);}else{if(navigator.clipboard){navigator.clipboard.writeText(lib);}else{var textbox=document.getElementById("mfclipboard");textbox.value=lib;$("#mfclipboard").focus().select();e.clipboardData.setData("text/plain",lib);}}nativeCopy=true;}catch(err){console.log(err);try{var textbox=document.getElementById("mfclipboard");textbox.value=lib;$("#mfclipboard").focus().select();e.clipboardData.setData("text/plain",lib);}catch(er){console.log(er);}}}};this.exportComponents=function(allcomps){var exportObj=new Object();var exportedComponents=new Array();var images=new Array();var selections=new Array();var selDictionary=new Array();mf_main.editorController.exportMode=true;if(allcomps){for(var k=mf_main.editorController.loadedPages.length-1;k>=0;k--){var page=mf_main.editorController.loadedPages[k];for(var i=0;i<page.childComponents.size();i++){var component=page.childComponents.getItemAt(i);if(component.selector){var cselect=component.selector;selections.push(cselect);}}}}else{for(var i=0;i<mf_main.editorController.componentSelect.length;i++){var cselect=mf_main.editorController.componentSelect[i];var add=true;for(var j=0;j<selDictionary.length;j++){var cselect2=selDictionary[j];if(cselect2==cselect){add=false;}}if(add){selDictionary[selDictionary.length]=cselect;}}thisClass.getComponents(selDictionary,selections);selections=thisClass.orderSelection(selections);}for(var i=0;i<selections.length;i++){var copy=selections[i];if(copy!=null){if(copy.component&&copy.component.NAME=="MF_ImageComp"){if(copy.component.imageID!=""&&copy.component.imageID!=null){images.push(copy.component.imageID);}}var copyObj=new MF_CopyComponent(thisClass.prepareLoadComponent(copy));exportedComponents.push(copyObj);}}mf_main.editorController.exportMode=false;exportObj.components=exportedComponents;exportObj.images=images;return exportObj;};this.pasteComponentCMD=function(e){if(mf_main.editorController.editingComponent){}else{return thisClass.pasteComponent(false,true,false,true);}};this.globalPageSizeSettings=function(mfGlobalPageSelectedPreset){if(mfGlobalPageSelectedPreset=="sizeless"){$(".mfModalGlobalPageOptions").hide();}else{if(mfGlobalPageSelectedPreset=="custom"){$(".mfModalGlobalPageOptions").show();$("#mfGlobalPageWidth").data("kendoNumericTextBox").value(thisClass.pagePresetArray[1].width);$("#mfGlobalPageHeight").data("kendoNumericTextBox").value(thisClass.pagePresetArray[1].height);$("#mfGlobalPageWidth").data("kendoNumericTextBox").enable(true);$("#mfGlobalPageHeight").data("kendoNumericTextBox").enable(true);}else{var index=MF_Utils.searchObjArray(thisClass.pagePresetArray,"value",mfGlobalPageSelectedPreset);$(".mfModalGlobalPageOptions").show();$("#mfGlobalPageWidth").data("kendoNumericTextBox").value(thisClass.pagePresetArray[index].width);$("#mfGlobalPageHeight").data("kendoNumericTextBox").value(thisClass.pagePresetArray[index].height);$("#mfGlobalPageWidth").data("kendoNumericTextBox").enable(false);$("#mfGlobalPageHeight").data("kendoNumericTextBox").enable(false);}}};this.currentPageSizeSettings=function(mfCurrentPageSelectedPreset){if(mfCurrentPageSelectedPreset=="sizeless"){$(".mfModalCurrentPageOptions").hide();}else{if(mfCurrentPageSelectedPreset=="custom"){$(".mfModalCurrentPageOptions").show();$("#mfCurrentPageWidth").data("kendoNumericTextBox").value(thisClass.pagePresetArray[1].width);$("#mfCurrentPageHeight").data("kendoNumericTextBox").value(thisClass.pagePresetArray[1].height);$("#mfCurrentPageWidth").data("kendoNumericTextBox").enable(true);$("#mfCurrentPageHeight").data("kendoNumericTextBox").enable(true);}else{var index=MF_Utils.searchObjArray(thisClass.pagePresetArray,"value",mfCurrentPageSelectedPreset);$(".mfModalCurrentPageOptions").show();$("#mfCurrentPageWidth").data("kendoNumericTextBox").value(thisClass.pagePresetArray[index].width);$("#mfCurrentPageHeight").data("kendoNumericTextBox").value(thisClass.pagePresetArray[index].height);$("#mfCurrentPageWidth").data("kendoNumericTextBox").enable(false);$("#mfCurrentPageHeight").data("kendoNumericTextBox").enable(false);}}};this.toggleCurrentPageSettings=function(){if($("#mfCurrentPageSizeOverride").prop("checked")){$(".mfCurrentPageSizeSettingsPanel").show();thisClass.currentPageSizeSettings($("#mfCurrentPageType").data("kendoDropDownList").dataItem().value);}else{$(".mfCurrentPageSizeSettingsPanel").hide();}};this.toggleCurrentPageBGSettings=function(){if($("#mfCurrentPageBackgroundOverride").prop("checked")){$(".mfCurrentPageBackgroundSettingsPanel").show();}else{$(".mfCurrentPageBackgroundSettingsPanel").hide();}};this.openPageSizeDialog=function(){mf_main.editorController.disableShortcuts();var sizeDict=new Object();for(var k=0;k<thisClass.pagePresetArray.length;k++){sizeDict[thisClass.pagePresetArray[k].value]=true;}if(mf_main.editorController.projectObj.sizeType!="sizeless"){if(!sizeDict[mf_main.editorController.projectObj.sizeType]){mf_main.editorController.projectObj.sizeType="custom";}}if(mf_main.DESIGNMODE){$("#mfGlobalPageType").data("kendoDropDownList").value(mf_main.editorController.designStoreController.getDtype());}else{$("#mfGlobalPageType").data("kendoDropDownList").value(mf_main.editorController.projectObj.sizeType);}if(mf_main.editorController.projectObj.sizeType!="sizeless"){$(".mfModalGlobalPageOptions").show();}else{$(".mfModalGlobalPageOptions").hide();}$("#mfGlobalPageWidth").data("kendoNumericTextBox").value(mf_main.editorController.projectObj.origWidth);$("#mfGlobalPageHeight").data("kendoNumericTextBox").value(mf_main.editorController.projectObj.origHeight);if(mf_main.editorController.page.sizeType!="sizeless"){if(!sizeDict[mf_main.editorController.page.sizeType]){mf_main.editorController.page.sizeType="custom";}}if(mf_main.DESIGNMODE){$("#mfCurrentPageType").data("kendoDropDownList").value(mf_main.editorController.designStoreController.getDtype());}else{$("#mfCurrentPageType").data("kendoDropDownList").value(mf_main.editorController.page.sizeType);}if(mf_main.editorController.page.sizeType!="sizeless"){$(".mfModalCurrentPageOptions").show();}else{$(".mfModalCurrentPageOptions").hide();}$("#mfglobalpage_settingtab").tab("show");if(!mf_main.editorController.page.overrideSize){$("#mfCurrentPageSizeOverride").prop("checked",false);$(".mfCurrentPageSizeSettingsPanel").hide();}else{$("#mfCurrentPageSizeOverride").prop("checked",true);$(".mfCurrentPageSizeSettingsPanel").show();$("#mfcurrentpage_settingtab").tab("show");}if(!mf_main.editorController.page.overrideBackground){$("#mfCurrentPageBackgroundOverride").prop("checked",false);$(".mfCurrentPageBackgroundSettingsPanel").hide();}else{$("#mfCurrentPageBackgroundOverride").prop("checked",true);$(".mfCurrentPageBackgroundSettingsPanel").show();$("#mfcurrentpage_settingtab").tab("show");}$("#mfCurrentPageWidth").data("kendoNumericTextBox").value(mf_main.editorController.page.origWidth);$("#mfCurrentPageHeight").data("kendoNumericTextBox").value(mf_main.editorController.page.origHeight);mf_main.editorController.gridController.initBackgroundSettings();$("#mfPageSizeModal").modal();};this.globalPageSizeValueExchange=function(){var globalPageWidth=$("#mfGlobalPageWidth").data("kendoNumericTextBox").value();var globalPageHeight=$("#mfGlobalPageHeight").data("kendoNumericTextBox").value();$("#mfGlobalPageWidth").data("kendoNumericTextBox").value(globalPageHeight);$("#mfGlobalPageHeight").data("kendoNumericTextBox").value(globalPageWidth);};this.currentPageSizeValueExchange=function(){var currentPageWidth=$("#mfCurrentPageWidth").data("kendoNumericTextBox").value();var currentPageHeight=$("#mfCurrentPageHeight").data("kendoNumericTextBox").value();$("#mfCurrentPageWidth").data("kendoNumericTextBox").value(currentPageHeight);$("#mfCurrentPageHeight").data("kendoNumericTextBox").value(currentPageWidth);};this.pasteComponent=function(inPlace,undo,retainID,selection,nopaste){if(!mf_main.editorController.pageloaded){return;}if(mf_main.editorController.pageEditorLocked){return;}if(inPlace==undefined){inPlace=false;}if(undo==undefined){undo=true;}if(retainID==undefined){retainID=false;}if(selection==undefined){selection=false;}if(nopaste==undefined){nopaste=false;}try{var pastedComponents=new Array();var pasteComponents=new Array();if(nopaste==true){pasteComponents=thisClass.tempPasteComponents;for(var i=0;i<thisClass.tempPasteComponents.length;i++){var cmp=thisClass.tempPasteComponents[i];if(!cmp.GROUP){for(var j=0;j<cmp.componentQueue.length;j++){cmp.componentQueue[j].pasteInPlace=true;}}}thisClass.tempPasteComponents=new Array();}else{if(thisClass.cutComponents.length>0){thisClass.copyComponents=new Array();thisClass.pasteInPlace();inPlace=true;pasteComponents=thisClass.cloneCopyArray(thisClass.cutComponents);thisClass.cutComponents=new Array();}else{pasteComponents=thisClass.cloneCopyArray(thisClass.copyComponents);if(inPlace){thisClass.pasteInPlace();}}}var tempCopyComponents=new Array();if(inPlace){thisClass.repeatMode=false;}var groupComponents=new Array();if(pasteComponents.length>0){if(nopaste==true){}else{MF_Utils.display_ActionIndicator("Paste selected...");}for(var i=0;i<pasteComponents.length;i++){var pcomp=pasteComponents[i];if(!pcomp.GROUP){tempCopyComponents.push(pasteComponents[i]);}else{groupComponents.push(pasteComponents[i]);}}tempCopyComponents=tempCopyComponents.reverse();var len=tempCopyComponents.length;thisClass.minx=null;thisClass.miny=null;thisClass.adjustX=0;thisClass.adjustY=0;for(var k=0;k<len;k++){var currentObj=tempCopyComponents[k];thisClass.findMinDim(currentObj);}if(thisClass.miny!=null){thisClass.miny=thisClass.miny-50;}if(thisClass.minx!=null){thisClass.minx=thisClass.minx-50;}if(thisClass.minx==null){thisClass.minx=0;}if(thisClass.miny==null){thisClass.miny=0;}var actx=thisClass.minx;var acty=thisClass.miny;var win=$("#mfEditorHolder");var viewport={top:win.scrollTop(),left:win.scrollLeft()};var sw=win.width();var sh=win.height();if(mf_main.editorController.page.height<sh){sh=mf_main.editorController.page.height;}if(mf_main.editorController.page.width<sw){sw=mf_main.editorController.page.width;}viewport.right=viewport.left+sw;viewport.bottom=viewport.top+sh;var inViewport=!(viewport.right<thisClass.minx||viewport.left>thisClass.minx||viewport.bottom<thisClass.miny||viewport.top>thisClass.miny);var portpass=true;if(mf_main.editorController.componentSelect.length>0&&!inPlace){var selectedComp=mf_main.editorController.componentSelect[0];if(selectedComp.x>(viewport.left/mf_main.editorController.SCALE)&&selectedComp.x<(viewport.right/mf_main.editorController.SCALE)&&selectedComp.y>(viewport.top/mf_main.editorController.SCALE)&&selectedComp.y<(viewport.bottom/mf_main.editorController.SCALE)){if(thisClass.miny<selectedComp.y){thisClass.miny=-(thisClass.miny);thisClass.adjustY=(selectedComp.y)+thisClass.miny;}else{thisClass.miny=-(thisClass.miny);thisClass.adjustY=(selectedComp.y)+thisClass.miny;}if(thisClass.minx<selectedComp.x){thisClass.minx=-(thisClass.minx);thisClass.adjustX=(selectedComp.x)+thisClass.minx;}else{thisClass.minx=-(thisClass.minx);thisClass.adjustX=(selectedComp.x)+thisClass.minx;}portpass=false;}}if(!inViewport&&portpass){var autoSize=true;if(mf_main.editorController.projectObj.sizeType!="sizeless"){autoSize=false;}if(mf_main.editorController.page.overrideSize){if(mf_main.editorController.page.sizeType!="sizeless"){autoSize=false;}else{autoSize=true;}}if(thisClass.miny<$("#mfEditorHolder").scrollTop()){thisClass.miny=-(thisClass.miny);thisClass.adjustY=($("#mfEditorHolder").scrollTop()/mf_main.editorController.SCALE)+thisClass.miny;}else{if(thisClass.miny>(($("#mfEditorHolder").scrollTop()+$("#mfEditorHolder").height())/mf_main.editorController.SCALE)){thisClass.miny=-(thisClass.miny);thisClass.adjustY=thisClass.miny+viewport.top+10;}}if(thisClass.minx<$("#mfEditorHolder").scrollLeft()){thisClass.minx=-(thisClass.minx);thisClass.adjustX=($("#mfEditorHolder").scrollLeft()/mf_main.editorController.SCALE)+thisClass.minx;}else{if(thisClass.minx>((($("#mfEditorHolder").scrollLeft()+$("#mfEditorHolder").width())/mf_main.editorController.SCALE)-330)){thisClass.minx=-(thisClass.minx);thisClass.adjustX=thisClass.minx+viewport.left+10;}}if(!autoSize){if(thisClass.miny>viewport.bottom){thisClass.miny=-(thisClass.miny);thisClass.adjustY=thisClass.miny+viewport.top+10;}if(thisClass.minx>viewport.right){thisClass.minx=-(thisClass.minx);thisClass.adjustX=thisClass.minx+viewport.left+10;}}}for(var i=0;i<len;i++){var currentObj=tempCopyComponents.pop();var select=thisClass.startCopyComponent(currentObj,retainID,len);if(select){pastedComponents.push(select);}}thisClass.pasteComplete(pastedComponents,groupComponents,undo,retainID,nopaste);}if(selection){thisClass.makeSelection(pastedComponents,groupComponents,false);if(mf_main.editorController.saveAsWireframeMode){if(mf_main.editorController.dbComponentsWireframe.length==0){mf_main.editorController.saveAsWireframeMode=false;mf_main.editorController.clearSelection(true);}else{var db1=mf_main.editorController.dbComponentsWireframe.pop();var gx=100;var gy=100;if(mf_main.editorController.globalselect){gy=mf_main.editorController.globalselect.y+mf_main.editorController.globalselect.height+10;}else{if(mf_main.editorController.componentSelect&&mf_main.editorController.componentSelect.length>0){var select=mf_main.editorController.componentSelect[0];gy=select.y+select.height+10;}}mf_main.editorController.addDBComponent2Page(db1.id,db1,100,gy);}}}return pastedComponents;}catch(err){alert(err);}return null;};this.makeSelection=function(selectionComponents,groupComponents,displaySettings){if(displaySettings==undefined){displaySettings=true;}try{mf_main.editorController.clearSelection(true);var groupHighlights=new Object();if(selectionComponents.length==1){var singleselect=selectionComponents[0];if(singleselect.component&&(singleselect.component.GROUPID==""||mf_main.editorController.currentGroupEdit!=null)){mf_main.editorController.componentSelect=selectionComponents;mf_main.editorController.selectHighlight(singleselect);mf_main.editorController.addSelectorResize(singleselect);}}else{var numcomp=0;var newarr=new Array();for(var j=0;j<selectionComponents.length;j++){var gselect=selectionComponents[j];if(gselect.component&&(gselect.component.GROUPID!=""&&mf_main.editorController.currentGroupEdit==null)){groupHighlights[gselect.component.GROUPID]=true;}else{if(gselect.component&&mf_main.editorController.currentGroupEdit!=null&&gselect.component.GROUPID!=""&&(gselect.component.GROUPID==mf_main.editorController.currentGroupEdit)){newarr[newarr.length]=gselect;}else{if(gselect.component&&gselect.component.GROUPID==""){newarr[newarr.length]=gselect;}}}}if(groupComponents){for(var k=0;k<groupComponents.length;k++){var gcomp=groupComponents[k];groupHighlights[gcomp.GROUPID]=true;}}var newGroupHighlights=new Object();for(var gid in groupHighlights){var gcomp=mf_main.editorController.page.groupManager.getGroupByID(gid);if(gcomp){if(mf_main.editorController.currentGroupEdit==null){if(gcomp.parent==""){newGroupHighlights[gid]=true;}}else{if(gcomp.parent==mf_main.editorController.currentGroupEdit){newGroupHighlights[gid]=true;}}}}for(var gid in newGroupHighlights){var groupSelect=mf_main.editorController.page.groupManager.groupSelectors[gid];if(groupSelect){newarr[newarr.length]=groupSelect;}}if(newarr.length>1){mf_main.editorController.componentSelect=newarr;mf_main.editorController.performGlobalSelection();}else{if(newarr.length==1){var selector=newarr[0];mf_main.editorController.addComponentSelect(selector);mf_main.editorController.addSelectorResize(selector);}}}}catch(err){}};this.startCopyComponent=function(currentCopy,retainID,len){var queueArray=new Array();for(var i=0;i<currentCopy.componentQueue.length;i++){queueArray.push(currentCopy.componentQueue[i]);}var currentQueue=queueArray.pop();var nstr=MF_Utils.xmlToString(currentQueue.componentXML);var copyXML=$(nstr);if(currentQueue.pasteInPlace){copyXML.attr("x",(parseFloat(copyXML.attr("x"))-10).toString());copyXML.attr("y",(parseFloat(copyXML.attr("y"))-10).toString());if(copyXML.attr("startX")){copyXML.attr("startX",(parseFloat(copyXML.attr("startX"))-10).toString());copyXML.attr("startY",(parseFloat(copyXML.attr("startY"))-10).toString());copyXML.attr("endX",(parseFloat(copyXML.attr("endX"))-10).toString());copyXML.attr("endY",(parseFloat(copyXML.attr("endY"))-10).toString());}if(copyXML.attr("type")=="MF_ArrowPath"){thisClass.updateArrowWaypoints(copyXML,-20,-20);}currentQueue.pasteInPlace=false;}else{if(!thisClass.repeatMode){copyXML.attr("x",(parseFloat(copyXML.attr("x"))+thisClass.adjustX).toString());copyXML.attr("y",(parseFloat(copyXML.attr("y"))+thisClass.adjustY).toString());if(copyXML.attr("startX")){copyXML.attr("startX",(parseFloat(copyXML.attr("startX"))+thisClass.adjustX).toString());copyXML.attr("startY",(parseFloat(copyXML.attr("startY"))+thisClass.adjustY).toString());copyXML.attr("endX",(parseFloat(copyXML.attr("endX"))+thisClass.adjustX).toString());copyXML.attr("endY",(parseFloat(copyXML.attr("endY"))+thisClass.adjustY).toString());}if(copyXML.attr("type")=="MF_ArrowPath"){thisClass.updateArrowWaypoints(copyXML,thisClass.adjustX-10,thisClass.adjustY-10);}}}if(thisClass.repeatMode){copyXML.attr("x",(parseFloat(copyXML.attr("x"))+thisClass.repeatX-10).toString());copyXML.attr("y",(parseFloat(copyXML.attr("y"))+thisClass.repeatY-10).toString());if(copyXML.attr("startX")){copyXML.attr("startX",(parseFloat(copyXML.attr("startX"))+thisClass.repeatX-10).toString());copyXML.attr("startY",(parseFloat(copyXML.attr("startY"))+thisClass.repeatY-10).toString());copyXML.attr("endX",(parseFloat(copyXML.attr("endX"))+thisClass.repeatX-10).toString());copyXML.attr("endY",(parseFloat(copyXML.attr("endY"))+thisClass.repeatY-10).toString());}if(copyXML.attr("type")=="MF_ArrowPath"){thisClass.updateArrowWaypoints(copyXML,thisClass.repeatX-10,thisClass.repeatY-10);}}var pt=new Object();pt.x=0;pt.y=0;return mf_main.editorController.loadComponent(currentQueue.componentXML.attr("type"),pt,currentQueue.componentXML.attr("eid"),null,copyXML,true,retainID);};this.findMinDim=function(currentCopy){var queueArray=new Array();for(var i=0;i<currentCopy.componentQueue.length;i++){queueArray.push(currentCopy.componentQueue[i]);}var currentQueue=queueArray.pop();var nstr=MF_Utils.xmlToString(currentQueue.componentXML);var copyXML=$(nstr);if(copyXML.attr("startX")){var sx1=parseFloat(copyXML.attr("startX"));var sy1=parseFloat(copyXML.attr("startY"));var ex1=parseFloat(copyXML.attr("endX"));var ey1=parseFloat(copyXML.attr("endY"));var mx=sx1;if(ex1<sx1){mx=ex1;}var my=sy1;if(ey1<sy1){my=ey1;}if(thisClass.minx==null){thisClass.minx=mx;}else{if(mx<thisClass.minx){thisClass.minx=mx;}}if(thisClass.miny==null){thisClass.miny=my;}else{if(my<thisClass.miny){thisClass.miny=my;}}}else{var mx=parseFloat(copyXML.attr("x"));var my=parseFloat(copyXML.attr("y"));if(thisClass.minx==null){thisClass.minx=mx;}else{if(mx<thisClass.minx){thisClass.minx=mx;}}if(thisClass.miny==null){thisClass.miny=my;}else{if(my<thisClass.miny){thisClass.miny=my;}}}};this.pasteComplete=function(pastedComponents,groupComponents,undo,retainID,nopaste){try{var existingGroups=new Object();var callLoadAllFonts=false;for(var i=0;i<pastedComponents.length;i++){var pcomp=pastedComponents[i];if(pcomp.component.GROUPID!=""){existingGroups[pcomp.component.GROUPID]="";}if(pcomp.component&&pcomp.component.mfwprosketchmode){pcomp.component.seed=0;pcomp.component.e2xml.settings.properties.seed=0;}if(pcomp.component&&pcomp.component.USEFONT&&pcomp.component.fontType!=""&&pcomp.component.fontType!=null){var fontExist=false;for(var key in mf_main.editorController.fontController.usedFonts){if(key==pcomp.component.fontType){fontExist=true;}}if(!fontExist){mf_main.editorController.addFont(pcomp.component);if(pcomp.component.isGoogleFontUsed){if(pcomp.component.fontType=="Architects Daughter"||pcomp.component.fontType=="architectsdaughter"){mf_main.editorController.fontController.loadArchitectDaughterFont();}else{mf_main.editorController.fontController.loadSearchedGoogleFonts(pcomp.component.fontType+":"+mf_main.editorController.fontController.getGoogleFontVariants(pcomp.component.fontType));}}else{callLoadAllFonts=true;}}}}if(callLoadAllFonts){mf_main.editorController.fontController.loadAllFonts();}for(var oldgid in existingGroups){if(mf_main.editorController.currentGroupEdit==null&&!retainID){existingGroups[oldgid]="G"+mf_main.editorController.guidGenerator();}else{if(mf_main.editorController.currentGroupEdit!=null&&mf_main.editorController.currentGroupEdit==oldgid){existingGroups[oldgid]=oldgid;}else{if(mf_main.editorController.currentGroupEdit!=null&&!retainID){existingGroups[oldgid]="G"+mf_main.editorController.guidGenerator();}else{existingGroups[oldgid]=oldgid;}}}}var undoarr=new Array();var hWidth=0;var hHeight=0;var resetgroupsel=false;var allgroupedcomponents=Object();var addedgroupedcomponents=new Object();var existinggroupedcomponents=new Object();for(var i=0;i<pastedComponents.length;i++){var comp=pastedComponents[i];comp.component.setVisible(true);undoarr.push(comp);if(comp.component.x>hWidth){hWidth=comp.component.x;}if(comp.component.y>hHeight){hHeight=comp.component.y;}var alreadyGrouped=false;if(comp.component.GROUPID!=""){addedgroupedcomponents[comp.component.GROUPID]=true;if(mf_main.editorController.currentGroupEdit==null||mf_main.editorController.currentGroupEdit!=comp.component.GROUPID){allgroupedcomponents[comp.component.GROUPID]=true;comp.component.GROUPID=existingGroups[comp.component.GROUPID];mf_main.editorController.page.groupManager.addGroup(comp.component.GROUPID,comp.component);alreadyGrouped=true;}}if(mf_main.editorController.currentGroupEdit!=null&&!alreadyGrouped){comp.component.GROUPID=mf_main.editorController.currentGroupEdit;comp.GROUPID=mf_main.editorController.currentGroupEdit;resetgroupsel=true;mf_main.editorController.page.groupManager.addGroup(mf_main.editorController.currentGroupEdit,comp.component);var gselect=mf_main.editorController.page.groupManager.groupSelectors[mf_main.editorController.currentGroupEdit];if(gselect){if(gselect.globalselects){gselect.globalselects[comp.id]=comp;}}}}for(var k=0;k<groupComponents.length;k++){var gcomp=groupComponents[k];if(!existingGroups[gcomp.GROUPID]){if(mf_main.editorController.currentGroupEdit==null&&!retainID){existingGroups[gcomp.GROUPID]="G"+mf_main.editorController.guidGenerator();}else{if(mf_main.editorController.currentGroupEdit!=gcomp.GROUPID&&!retainID){existingGroups[gcomp.GROUPID]="G"+mf_main.editorController.guidGenerator();}else{existingGroups[gcomp.GROUPID]=gcomp.GROUPID;}}}if(!mf_main.editorController.page.groupManager.groups[existingGroups[gcomp.GROUPID]]){var group=new MF_Group();group.GROUPID=existingGroups[gcomp.GROUPID];if(gcomp.parent!=""&&mf_main.editorController.page.groupManager.groups[gcomp.parent]){group.parent=gcomp.parent;}mf_main.editorController.page.groupManager.addGroupOnly(group);}if(gcomp.parent!=""&&mf_main.editorController.page.groupManager.groups[existingGroups[gcomp.GROUPID]]){mf_main.editorController.page.groupManager.groups[existingGroups[gcomp.GROUPID]].parent=gcomp.parent;}else{if(gcomp.parent==""&&mf_main.editorController.page.groupManager.groups[existingGroups[gcomp.GROUPID]]&&mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.groups[existingGroups[gcomp.GROUPID]].parent=mf_main.editorController.currentGroupEdit;gcomp.parent=mf_main.editorController.currentGroupEdit;}}}if(mf_main.editorController.currentGroupEdit!=null){for(var gkey in allgroupedcomponents){if(mf_main.editorController.page.groupManager.groups[existingGroups[gkey]]){if(mf_main.editorController.page.groupManager.groups[existingGroups[gkey]].parent==""){mf_main.editorController.page.groupManager.addGroup(mf_main.editorController.currentGroupEdit,mf_main.editorController.page.groupManager.groups[existingGroups[gkey]]);}}}}for(var k=0;k<groupComponents.length;k++){var gcomp=groupComponents[k];if(mf_main.editorController.page.groupManager.groups[existingGroups[gcomp.GROUPID]]){var grp=mf_main.editorController.page.groupManager.groups[existingGroups[gcomp.GROUPID]];if(grp){if(existingGroups[gcomp.parent]){grp.parent=existingGroups[gcomp.parent];}else{grp.parent=gcomp.parent;}if(grp.parent!=""){var gparentGrp=mf_main.editorController.page.groupManager.groups[grp.parent];if(gparentGrp){gparentGrp.add(grp);}else{mf_main.editorController.page.groupManager.addGroup(grp.parent,grp);}}}if(existingGroups[gcomp.GROUPID]){gcomp.GROUPID=existingGroups[gcomp.GROUPID];}if(gcomp.parent!=""&&existingGroups[gcomp.parent]){gcomp.parent=existingGroups[gcomp.parent];}undoarr.push(gcomp);existinggroupedcomponents[gcomp.GROUPID]=true;}else{var ngid=existingGroups[gcomp.GROUPID];}}if(resetgroupsel){mf_main.editorController.page.groupManager.resetSelector(mf_main.editorController.currentGroupEdit);}if(mf_main.editorController.RESTRICT_SIZE){if((hWidth)>mf_main.editorController.RESTRICT_SIZE_LIMIT||(hHeight)>mf_main.editorController.RESTRICT_SIZE_LIMIT){mf_main.editorController.displaySizeRestiction();}}for(var oldid in existingGroups){if(!mf_main.editorController.page.groupManager.groupSelectors[existingGroups[oldid]]){var coll=mf_main.editorController.page.groupManager.getGroupComponents(existingGroups[oldid]);if(coll.size()>1){mf_main.editorController.page.groupManager.addGroupSelector(existingGroups[oldid]);var lpage=mf_main.editorController.page.groupManager.linkedGroups[oldid];if(lpage!=null){var nLinkPage=JSON.parse(JSON.stringify(lpage));mf_main.editorController.page.groupManager.linkedGroups[existingGroups[oldid]]=nLinkPage;}else{try{for(var k=0;k<MF_PagePool.getPages().size();k++){var litem=MF_PagePool.getPages().getItemAt(k);if(litem&&litem.groupManager&&litem.groupManager.linkedGroups){var lpage2=litem.groupManager.linkedGroups[oldid];if(lpage2!=null){var nLinkPage=JSON.parse(JSON.stringify(lpage2));mf_main.editorController.page.groupManager.linkedGroups[existingGroups[oldid]]=nLinkPage;}}}}catch(e){}}mf_main.editorController.page.groupManager.resetParentSelectorGroups(oldid);}else{mf_main.editorController.page.groupManager.clearGroupSelectorByID(existingGroups[oldid]);}}}if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}if(nopaste){for(var gid in addedgroupedcomponents){if(!existinggroupedcomponents[gid]){if(existingGroups[gid]){var copyObj=new MF_CopyComponent();copyObj.GROUP=true;copyObj.GROUPID=existingGroups[gid];copyObj.parent="";if(mf_main.editorController.currentGroupEdit!=null){copyObj.parent=mf_main.editorController.currentGroupEdit;}copyObj.GROUPOBJ=true;undoarr.push(copyObj);}}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();undoObj.addUndo(undoarr);if(undo){MF_ChangeManager.addUndo(undoObj);}else{MF_ChangeManager.addRedo(undoObj);}}}catch(err){}mf_main.editorController.clearSelection();};this.updateArrowWaypoints=function(xmlData,xValue,yValue){try{var wayPoints=$(xmlData).find("settings").find('property[name="wayPoints"]').text();if(typeof(wayPoints)=="string"){wayPoints=JSON.parse(wayPoints);}for(var i=0;i<wayPoints.length;i++){wayPoints[i].x+=xValue;wayPoints[i].y+=yValue;}$(xmlData).find("settings").find('property[name="wayPoints"]').text(JSON.stringify(wayPoints));}catch(e){console.log("Error in ArrowPath");}};}function MF_Page(){var thisClass=this;this.NAME="Page";this.x=0;this.y=0;this.transformLock=false;this.eid="";this.e2xml=new MF_ComponentXML(this);this.pageName="Page";this.loaded=false;this.changed=false;this.assignedEvents=false;this.backgroundColor="#ffffff";this.overrideBackground=false;this.revisionChanged=false;this.duplicated=false;this.pagedata=null;this.width=800;this.height=600;this.origWidth=800;this.origHeight=600;this.noDBLoad=false;this.overrideSize=false;this.sizeType="sizeless";this.autoResize=true;this.comments=0;this.rtcEditor=null;this.rtcEditorName=null;this.children=new ArrayCollection();this.navHide=false;this.folder=false;this.parentPage="";this.layerLevel=-1;this.master=false;this.masterPage="";this.content=null;this.childComponents=new ArrayCollection();this.childDictionary=new Object();this.stackOrder=new ArrayCollection();this.selectors=new Object();this.groupManager=new MF_GroupManager(this);this.undo=new Array();this.redo=new Array();this.highestWidth=800;this.highestHeight=600;this.lowestX=0;this.lowestY=0;this.scrollPosX=0;this.scrollPosY=0;this.zoomScale=-1;this.cast=function(obj){thisClass.pageName=obj.pageName;thisClass.eid=obj.eid;thisClass.parentPage=obj.parentPage;thisClass.folder=obj.folder;thisClass.master=obj.master;thisClass.masterPage=obj.masterPage;thisClass.navHide=obj.navHide;};var thumbnailURL="";this.__defineGetter__("thumbnailURL",function(){return"https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+mf_main.editorController.projectObj.company+"/projects/"+mf_main.editorController.projectObj.id+"/pages/"+thisClass.eid+"/image/thumb/"+thisClass.eid+".png?"+new Date().getTime();});this.__defineSetter__("thumbnailURL",function(val){thumbnailURL=val;});var commentStr="";this.__defineGetter__("commentStr",function(){return"";if(thisClass.comments<10){return thisClass.comments.toString();}else{return"";}});this.__defineSetter__("commentStr",function(val){commentStr=val;});this.closeRTCEditor=function(){thisClass.rtcEditor=null;thisClass.rtcEditorName=null;};this.showRTCMsg=function(){if(mf_main.editorController.SELECTMODE_TYPE=="powerup-pagepreview"){mf_main.powerupInterface.cleanupPowerupData();}if(thisClass.rtcEditor==null){$("#mfRTCEditorLock").hide();mf_main.editorController.pageEditorLocked=false;if(mf_main.editorController.EDITOR){mf_main.editorController.enableShortcuts();}}else{if(thisClass.eid==mf_main.editorController.page.eid&&mf_main.editorController.EDITOR){if(mf_main.editorController.EDITOR){$("#mfRTCEditorLock").show();mf_main.editorController.pageEditorLocked=true;mf_main.editorController.clearSelection(true);if(thisClass.rtcEditor!=null){$("#mfRTCEditorImg").css("background-image",'url("'+MF_Utils.get_gravatar(thisClass.rtcEditor,32)+'")');}$("#mfRTCEditorMsg").text(thisClass.rtcEditorName+" is now editing this page");mf_main.editorController.disableShortcuts();mf_main.editorController.rtcReSize();}}}};this.createPageData=function(){thisClass.pagedata=new MF_PageData();thisClass.pagedata.eid=thisClass.eid;thisClass.pagedata.name=thisClass.pageName;if(mf_main.editorController.projectObj){thisClass.pagedata.projectid=mf_main.editorController.projectObj.id;thisClass.pagedata.clientid=mf_main.editorController.projectObj.company;}};this.calculateDimensions=function(){var wid=0;var hei=0;var sx=0;var sy=0;thisClass.highestWidth=0;thisClass.highestHeight=0;thisClass.lowestX=0;thisClass.lowestY=0;var c1,c2,c3,c4={};var bx1,by1,bx2,by2;var px,py;var tcount=0;for(var i=0;i<thisClass.childComponents.size();i++){var component=thisClass.childComponents.getItemAt(i);var dim=component;if(component.TRANSFORM){dim=MF_Utils.calculateDimensions(component.startX,component.startY,component.endX,component.endY,component.delta);if(component.NAME=="MF_ArrowPath"){dim=MF_Utils.calculateDimensions(component.connectorMinXpos,component.connectorMinYpos,component.connectorMaxXpos,component.connectorMaxYpos,component.delta);}}wid=dim.width;hei=dim.height;sx=dim.x;sy=dim.y;if(!component.TRANSFORM&&component.eangle!=0){var deg=component.eangle;var ar=deg*Math.PI/180;px=dim.x+dim.width*0.5;py=dim.y+dim.height*0.5;c1=MF_Utils.getCorner(px,py,dim.x,dim.y,ar);c2=MF_Utils.getCorner(px,py,dim.x+dim.width,dim.y,ar);c3=MF_Utils.getCorner(px,py,dim.x+dim.width,dim.y+dim.height,ar);c4=MF_Utils.getCorner(px,py,dim.x,dim.y+dim.height,ar);bx1=Math.min(c1.x,c2.x,c3.x,c4.x);by1=Math.min(c1.y,c2.y,c3.y,c4.y);bx2=Math.max(c1.x,c2.x,c3.x,c4.x);by2=Math.max(c1.y,c2.y,c3.y,c4.y);sx=bx1;sy=by1;wid=bx2-bx1;hei=by2-by1;}if((sx+wid)>thisClass.highestWidth){thisClass.highestWidth=sx+wid;}if((sy+hei)>thisClass.highestHeight){thisClass.highestHeight=sy+hei;}if(tcount==0){thisClass.lowestX=sx;thisClass.lowestY=sy;}else{if(sx<thisClass.lowestX){thisClass.lowestX=sx;}if(sy<thisClass.lowestY){thisClass.lowestY=sy;}}tcount++;}if(thisClass.lowestX>10){thisClass.lowestX=thisClass.lowestX-10;}if(thisClass.lowestY>10){thisClass.lowestY=thisClass.lowestY-10;}};this.addComponent=function(component){if(thisClass.layerLevel!=-1){thisClass.childComponents.addItemAt(component,thisClass.layerLevel);}else{thisClass.childComponents.addItem(component);}thisClass.childDictionary[component.eid]=component;if(thisClass.layerLevel!=-1){this.stackOrder.addItemAt(component,thisClass.layerLevel);}else{this.stackOrder.addItem(component);}$("#"+component.eid).css("z-index",this.stackOrder.size());};this.clean=function(){$("#mfPage"+thisClass.eid).hide();};this.remove=function(){thisClass.loaded=false;thisClass.changed=false;thisClass.assignedEvents=false;thisClass.revisionChanged=false;thisClass.children=new ArrayCollection();thisClass.childComponents=new ArrayCollection();thisClass.stackOrder=new ArrayCollection();thisClass.selectors=new Object();thisClass.groupManager=new MF_GroupManager(this);thisClass.undo=new Array();thisClass.redo=new Array();thisClass.childDictionary=new Object();$("#mfPage"+thisClass.eid).remove();};this.applySize=function(force){var autoSize=true;if(mf_main.editorController.projectObj.sizeType!="sizeless"){autoSize=false;}if(thisClass.overrideSize){if(thisClass.sizeType!="sizeless"){autoSize=false;}else{autoSize=true;}}if(force){autoSize=false;}if(autoSize){if(thisClass.eid==mf_main.editorController.page.eid){mf_main.editorController.autoSize=true;}if(mf_main.editorController.drawController&&mf_main.editorController.drawController.DRAWMODE&&mf_main.editorController.drawController.RESTRICTED){}else{$("#mfEditorHolder").css("overflow-x","auto");$("#mfEditorHolder").css("overflow-y","auto");}$("#mfEditorHolder").width($("#mfPageArea").width());$("#mfEditorHolder").height($("#mfPageArea").height());if($("#mfEditorHolder").width()>=thisClass.width){$("#mfPage"+thisClass.eid).width($("#mfEditorHolder").width());}else{$("#mfPage"+thisClass.eid).width(thisClass.width);}if($("#mfEditorHolder").height()>=thisClass.height){$("#mfPage"+thisClass.eid).height($("#mfEditorHolder").height());}else{$("#mfPage"+thisClass.eid).height(thisClass.height);}}else{if(thisClass.eid==mf_main.editorController.page.eid){mf_main.editorController.autoSize=false;}$("#mfEditorHolder").width($("#mfPageArea").width());$("#mfEditorHolder").height($("#mfPageArea").height());if(mf_main.editorController.drawController&&mf_main.editorController.drawController.DRAWMODE&&mf_main.editorController.drawController.RESTRICTED){}else{$("#mfEditorHolder").css("overflow-x","auto");$("#mfEditorHolder").css("overflow-y","auto");}$("#mfPage"+thisClass.eid).width(thisClass.width);$("#mfPage"+thisClass.eid).height(thisClass.height);}if(mf_main.RENDER&&mf_main.REVISION==false){$("#mfEditorHolder").css("overflow-x","hidden");$("#mfEditorHolder").css("overflow-y","hidden");}if(thisClass.eid==mf_main.editorController.page.eid){$("#mfBackgroundPage").css("height",$("#mfPage"+thisClass.eid).height());$("#mfBackgroundPage").css("width",$("#mfPage"+thisClass.eid).width());$("#mfContainerPage").css("height",$("#mfPage"+thisClass.eid).height());$("#mfContainerPage").css("width",$("#mfPage"+thisClass.eid).width());}};this.removeComponent=function(component){var cmp=thisClass.getComponentByID(component);var cind=thisClass.childComponents.getItemIndex(cmp);if(cind!=-1){thisClass.childComponents.removeItemAt(cind);}delete thisClass.childDictionary[component];};this.addGroupChildAt=function(select,pos){var maxindex=mf_main.editorController.page.stackOrder.size()-1;var maxCindex=mf_main.editorController.page.childComponents.size()-1;frontindex=mf_main.editorController.page.stackOrder.getItemIndex(select);ind=mf_main.editorController.page.childComponents.getItemIndex(select.component);var count=2;for(var j=frontindex-1;j<maxindex-1;j++){var existingSelect=mf_main.editorController.page.stackOrder.getItemAt(j+2);mf_main.editorController.page.stackOrder.setItemAt(existingSelect,j);count++;}mf_main.editorController.page.stackOrder.setItemAt(select,maxindex);mf_main.editorController.page.stackOrder.setItemAt(select.component,maxindex-1);count=0;for(var k=ind;k<maxCindex;k++){var existingComp=mf_main.editorController.page.childComponents.getItemAt(k+1);mf_main.editorController.page.childComponents.setItemAt(existingComp,k);count++;}mf_main.editorController.page.childComponents.setItemAt(select.component,maxCindex);};this.getComponentByID=function(id){return thisClass.childDictionary[id];};this.addSelector=function(selector){thisClass.selectors[selector.id]=selector;};this.getSelector=function(sid){return thisClass.selectors[sid];};}var MF_PagePool=(function(){var pages=new ArrayCollection();var pageMapCollection=new ArrayCollection();var pageMap=new Object();var revPageMap=new Object();var hierarchyData=new Array();function privateMethod(){}return{addNewPage:function(pageName,copyPage){var page=new MF_Page();page.eid=mf_main.editorController.guidGenerator();var num=MF_PagePool.getPages().size();num=num+1;if(pageName==null||pageName==""){page.pageName="Page "+num.toString();}else{page.pageName=pageName;}page.parentPage="";page.folder=false;page.createPageData();page.e2xml.applySettings();page.changed=true;MF_PagePool.addPage(page);return page;},addNewFolder:function(pageName){var page=new MF_Page();page.eid=mf_main.editorController.guidGenerator();page.createPageData();var num=MF_PagePool.getPages().size();num=num+1;if(pageName==null||pageName==""){page.pageName="Folder "+num.toString();}else{page.pageName=pageName;}page.e2xml.applySettings();page.changed=true;page.folder=true;MF_PagePool.addPage(page);return page;},addPage:function(page){MF_PagePool.getPages().addItem(page);return null;},clean:function(page){pages=new ArrayCollection();pageMap=new Object();revPageMap=new Object();hierarchyData=new Array();pageMapCollection=new ArrayCollection();return null;},setPages:function(newcollection){pages=newcollection;return null;},mapPages:function(){pageMap=new Object();revPageMap=new Object();hierarchyData=new Array();pageMapCollection=new ArrayCollection();var tempPages=new Object();for(var j=0;j<MF_PagePool.getPages().size();j++){var page=MF_PagePool.getPages().getItemAt(j);pageMap[page.eid]="p"+j;revPageMap["p"+j]=page.eid;tempPages[page.eid]=page;page.children=new ArrayCollection();}for(var i=0;i<MF_PagePool.getPages().size();i++){var page=MF_PagePool.getPages().getItemAt(i);if(pageMap[page.parentPage]){var parentPage=tempPages[page.parentPage];if(parentPage&&parentPage.parentPage!=page.eid){parentPage.children.addItem(page);}else{page.parentPage="";pageMapCollection.addItem(page);}}else{pageMapCollection.addItem(page);}}if(pageMapCollection.size()>0){hierarchyData=formSiteMap(pageMapCollection,hierarchyData,0,hierarchyData,null);}return hierarchyData;},getPageMapCollection:function(){return pageMapCollection;},getPageMap:function(){return pageMap;},getRevPageMap:function(){return revPageMap;},getMap:function(pre){if(pre){MF_PagePool.mapPages();}if(pre&&pageMapCollection.size()>0){var pdata=new Array();pdata=formSiteMap(pageMapCollection,pdata,0,pdata,pre);return pdata;}return hierarchyData;},deletePage:function(delpage){for(var k=0;k<delpage.children.length;k++){var litem=delpage.children[k];litem.parentPage=delpage.parentPage;}$("#mfPage"+delpage.eid).remove();for(var k=0;k<MF_PagePool.getPages().size();k++){var mpage=MF_PagePool.getPages().data[k];if(mpage.eid!=delpage.eid){if(mpage.masterPage==delpage.eid){mpage.masterPage="";}}}var pind=(MF_PagePool.getPages().getItemIndex(delpage));if(pind!=-1){MF_PagePool.getPages().removeItemAt(pind);}return null;},getPages:function(){return pages;},changeList:function(newlist){pages=newlist;return null;},getPage:function(eid){for(var i=0;i<pages.size();i++){var page=pages.getItemAt(i);if(page.eid==eid){return page;}}return null;}};})();function formSiteMap(pages,arr,count,origArray,pre){for(var i=0;i<pages.size();i++){var page=pages.getItemAt(i);var obj=new Object();if(pre){obj.id=pre+"_"+page.eid;}else{obj.id=page.eid;}obj.children=new Array();obj.text=page.pageName;obj.navHide=page.navHide;obj.pageid=page.eid;obj.parentid=MF_PagePool.getPageMap()[page.parentPage];if(page.folder){obj.icon="images/editor/folder.svg";}else{if(page.navHide){obj.icon="images/editor/pagehide.svg";}else{obj.icon="images/editor/page.svg";}}if(count>35){obj.parentid="";page.parentPage="";origArray.push(obj);}else{arr.push(obj);}if(page.children.size()>0){count++;formSiteMap(page.children,obj.children,count,origArray,pre);}}return arr;}var MF_IDManager=(function(){function privateMethod(){}return{generateComponentID:function(page,component){var name=component.NAME;var uid=mf_main.editorController.guidGenerator();component.eid=uid;return component.eid;},deleteID:function(page,id){page.removeComponent(id);return null;},IsIDGood:function(page,id){if(page.getComponentByID(id)==null){return true;}else{return false;}}};})();function MF_ComponentSettings(component){this.propertiesXML=new Object();this.properties=new Array();this.component=component;var thisClass=this;this.getXML=function(){var xmlString="<settings>";for(var prop in this.propertiesXML){if(prop!="ecoordinates"&&prop!="esize"&&prop!="eangle"&&prop!="transformLock"){if((prop=="link"||prop=="pageSetLink"||prop=="linkArray")&&mf_main.editorController.exportMode){}else{xmlString=xmlString+(this.propertiesXML[prop]);}}}xmlString=xmlString+"</settings>";return xmlString;};this.typeConverter=function(val,type){var newval;if(type=="Number"){newval=parseFloat(val);}if(type=="String"){newval=String(val);}if(type=="uint"){newval=parseInt(val);}if(type=="Boolean"){if(val=="true"){newval=true;}if(val=="false"){newval=false;}}return newval;};this.setProperty=function(pname,pval,ptype,pxml){this.propertiesXML[pname]=pxml;this.properties[pname]=pval;thisClass.component[pname]=pval;};this.getProperty=function(pname){return this.properties[pname];};}function MF_ComponentXML(component){this.settingsXML=$();this.component=component;this.settings=new MF_ComponentSettings();this.settings.component=component;var thisClass=this;this.getComponent=function(){return this.component;};this.formXML=function(nodata){var xmlString=this.formComponentXML(this.component,nodata);var outerHtml=$("<div/>").append(xmlString).html();this.settingsXML=$(outerHtml);return this.settingsXML;};this.formComponentXML=function(component,nodata){var xmlString;var typename=component.NAME;if(typename=="Page"){var eid=' eid="'+component.eid+'" ';var pageName=' pageName="'+component.pageName+'" ';if(component.masterPage==null){component.masterPage="";}var masterPage=' masterPage="'+component.masterPage+'" ';var dimensions=' w="'+component.origWidth+'"  h="'+component.origHeight+'"  autoResize="'+component.autoResize.toString()+'"  overrideSize="'+component.overrideSize.toString()+'"  sizeType="'+component.sizeType.toString()+'" ';var folder=component.folder;if(folder==null){folder="false";}var folderTxt=' folder="'+folder+'" ';var navHideTxt=' navHide="'+component.navHide.toString()+'" ';var bgTxt=' overrideBackground="'+component.overrideBackground.toString()+'"  backgroundColor="'+component.backgroundColor.toString()+'" ';var master="";xmlString='<component type="'+typename+'" '+eid+dimensions+folderTxt+navHideTxt+bgTxt+masterPage+master+" >";xmlString=xmlString+component.e2xml.settings.getXML();}else{var locked="";if(component.transformLock){locked='locked="true"';}var wei=component.width;var hei=component.height;var nx=component.x;var ny=component.y;var groupID="";var lid="";if(component.lid!=""){lid=' lid="'+component.lid+'" ';}if(component.GROUPID!=""){groupID='groupID="'+component.GROUPID+'"';}if(component.AUTO_SIZE){wei=component.mwidth;hei=component.mheight;}var ecoord='x="'+nx+'" y="'+ny+'" ';if(component.TRANSFORM){ecoord='startX="'+component.startX+'" startY="'+component.startY+'" endX="'+component.endX+'" endY="'+component.endY+'" ';}xmlString='<component type="'+typename+'" '+lid+' angle="'+component.eangle.toString()+'" w="'+wei+'" h="'+hei+'"'+ecoord+" "+locked+" "+groupID+" >";xmlString=xmlString+component.e2xml.settings.getXML();}if(component.NAME=="Page"&&nodata!="true"){xmlString=xmlString+component.groupManager.getGroupXML();xmlString=xmlString+component.groupManager.getLockedGroups();xmlString=xmlString+component.groupManager.getLinkedGroups();xmlString=xmlString+"<children>";for(var i=0;i<component.childComponents.size();i++){var childComponent=component.childComponents.getItemAt(i);xmlString=xmlString+thisClass.formComponentXML(childComponent);}xmlString=xmlString+"</children>";}xmlString=xmlString+"</component>";return xmlString;};this.applySettings=function(){try{if(this.component.NAME=="Page"){}else{var w=Number(this.settingsXML.attr("w"));var h=Number(this.settingsXML.attr("h"));var x=Number(this.settingsXML.attr("x"));var y=Number(this.settingsXML.attr("y"));if(this.component.TRANSFORM){var startX=Number(this.settingsXML.attr("startX"));var startY=Number(this.settingsXML.attr("startY"));var endX=Number(this.settingsXML.attr("endX"));var endY=Number(this.settingsXML.attr("endY"));var posObject=new Object();posObject.startX=startX;posObject.startY=startY;posObject.endX=endX;posObject.endY=endY;this.addPropObject("ecoordinates",posObject,"default");}else{var posObject=new Object();posObject.x=x;posObject.y=y;this.addPropObject("ecoordinates",posObject,"default");}var angle=Number(this.settingsXML.attr("angle"));if(this.settingsXML.attr("locked")!=null){var lock=this.settingsXML.attr("locked");if(lock=="true"){this.component.transformLock=true;}}var sizeObject=new Object();sizeObject.width=w;sizeObject.height=h;this.addPropObject("esize",sizeObject,"default");this.addPropSingle("eangle",angle,"default");}var thisClass=this;$(this.settingsXML).find("settings").each(function(){if(thisClass.component.NAME!="Page"){thisClass.applyComponentSettings($(this));}});}catch(err){}};this.applyComponentSettings=function(dataxml){try{var editValue="";var editPresent=false;var thisClass=this;$(dataxml).find("property").each(function(){var propItem=$(this);var propName=propItem.attr("name");var propType=propItem.attr("type");var propValue=propItem.text();if(propName=="text"||propName=="gridLayout"){propValue=propItem.html();}if(propName=="content"&&thisClass.component.NAME=="MF_HTMLEmbed"){propValue=MF_Utils.htmlEncode(propValue);}if(propType=="Object"){var obj=thisClass.decodeObjectXML(propItem.find("object"));thisClass.addPropObject(propName,obj,"default");}else{if(propType=="Array"){var arr=new Array();var arrType=propItem.find("array").attr("type");if(arrType=="Object"){$(propItem.find("array")).find("object").each(function(){arr[arr.length]=(thisClass.decodeObjectXML($(this)));});}else{$(propItem.find("array")).find("val").each(function(){arr[arr.length]=(thisClass.setType(arrType,$(this)["0"].textContent));});}thisClass.addPropArray(propName,arr,arrType,"default");}else{if(propName!="editValue"){thisClass.addPropSingle(propName,thisClass.setType(propType,propValue),"default");}else{editPresent=true;editValue=thisClass.setType(propType,propValue);}}}});if(editPresent){thisClass.addPropSingle("editValue",editValue,"default");}}catch(err){alert(err);}};this.decodeObjectXML=function(xml){var thisClass=this;var obj=new Object();var pcount=0;$(xml).find("prop").each(function(){var p=$(this).attr("name");var type=$(this).attr("type");obj[p]=thisClass.setType(type,$(this).text());pcount++;});if(pcount==0){obj=null;}return obj;};this.setType=function(type,val){if(type=="Number"){return parseFloat(val);}if(type=="int"){return parseInt(val);}if(type=="Boolean"){if(val=="true"){return true;}else{return false;}}return val;};this.getType=function(val){var type="String";if(typeof(val)=="int"){type="int";}if(typeof(val)=="number"){type="Number";}if(typeof(val)=="boolean"){type="Boolean";}return type;};this.undoManager=function(val,undoObj){if(val=="true"){MF_ChangeManager.addUndo(undoObj);}if(val=="false"){MF_ChangeManager.addRedo(undoObj);}if(val=="redo"){MF_ChangeManager.addUndo(undoObj);}};this.addPropSingle=function(propName,propValue,bUndo){bUndo=typeof(bUndo)!="undefined"?bUndo:"true";if(thisClass.component.GENONLY){bUndo="default";}if(bUndo!="default"){var undoObj=new MF_UndoDAO();undoObj.propSingleUndo(thisClass.component,propName,thisClass.component[propName]);thisClass.undoManager(bUndo,undoObj);}var propType=this.getType(propValue);var propXMLText='<property name="'+propName+'" type="'+propType+'">'+propValue+"</property>";var propXML=propXMLText;this.settings.setProperty(propName,propValue,propType,propXML);if(propName=="eangle"){var selector=thisClass.component.selector;if(selector){selector.angle=propValue;selector.setAngle(false,true,false);}}};this.addPropObject=function(propName,propValue,bUndo){bUndo=typeof(bUndo)!="undefined"?bUndo:"true";if(thisClass.component.GENONLY){bUndo="default";}if(bUndo!="default"){var undoObj=new MF_UndoDAO();undoObj.propObjectUndo(thisClass.component,propName,thisClass.component[propName]);thisClass.undoManager(bUndo,undoObj);}var objXML=this.encodeObjectXML(propValue);var propType="Object";var propXMLText='<property name="'+propName+'" type="'+propType+'">'+objXML+"</property>";var propXML=propXMLText;this.settings.setProperty(propName,propValue,propType,propXML);if(propName=="ecoordinates"||propName=="esize"){if(propName=="ecoordinates"){if(thisClass.component.TRANSFORM){thisClass.component.startX=propValue.startX;thisClass.component.startY=propValue.startY;thisClass.component.endX=propValue.endX;thisClass.component.endY=propValue.endY;}else{thisClass.component.x=propValue.x;thisClass.component.y=propValue.y;}}if(propName=="esize"){if(!thisClass.component.AUTOSIZE){thisClass.component.width=propValue.width;thisClass.component.height=propValue.height;}}var selector=thisClass.component.selector;if(selector){selector.x=thisClass.component.x-5;selector.y=thisClass.component.y-5;if(!thisClass.component.AUTOSIZE){selector.width=thisClass.component.width+10;selector.height=thisClass.component.height+10;}}}else{}};this.addPropArray=function(propName,propValue,arrayType,bUndo){bUndo=typeof(bUndo)!="undefined"?bUndo:"true";if(thisClass.component.GENONLY){bUndo="default";}if(bUndo!="default"){var undoObj=new MF_UndoDAO();undoObj.propArrayUndo(thisClass.component,propName,thisClass.component[propName],arrayType);thisClass.undoManager(bUndo,undoObj);}var propType="Array";var arrXML='<array type="'+arrayType+'">';if(arrayType=="Object"){for(var i=0;i<propValue.length;i++){var objval=propValue[i];arrXML=arrXML+thisClass.encodeObjectXML(objval);}}else{for(var i=0;i<propValue.length;i++){var val=propValue[i];arrXML=arrXML+"<val>"+val+"</val>";}}arrXML=arrXML+"</array>";var propXMLText='<property name="'+propName+'" type="'+propType+'">'+arrXML+"</property>";var propXML=propXMLText;this.settings.setProperty(propName,propValue,propType,propXML);};this.encodeObjectXML=function(obj){var objXML="<object>";for(var p in obj){var ptype=this.getType(obj[p]);objXML=objXML+'<prop type="'+ptype+'" name="'+p+'">'+obj[p]+"</prop>";}objXML=objXML+"</object>";return objXML;};}function MF_Group(){var thisClass=this;this.GROUPOBJ=true;this.GROUPID="";this.selector=null;this.groupname=null;this.parent="";this.children=new ArrayCollection();this.add=function(elem){if(elem.GROUPOBJ&&thisClass.GROUPID==elem.GROUPID){}else{if(elem.GROUPOBJ&&thisClass.parent!=""&&thisClass.parent==elem.GROUPID){}else{this.children.addItem(elem);}}};this.getXML=function(noparent){var xml="<mfgroup ";xml=xml+' id="'+this.GROUPID+'" ';if(this.groupname){xml=xml+' name="'+this.groupname+'" ';}if(noparent){xml=xml+' parent="" ';}else{xml=xml+' parent="'+this.parent+'" ';}xml=xml+" ></mfgroup> ";return xml;};this.remove=function(elem){if(this.children.getItemIndex(elem)!=-1){this.children.removeItemAt(elem,this.children.getItemIndex(elem));}};}function MF_GroupManager(caller){var thisClass=this;this.callerPage=caller;this.groups=new Object();this.groupSelectors=new Object();this.lockedGroups=new Object();this.linkedGroups=new Object();this.getLockedGroups=function(){var count=0;var lockXML="<lockedGroups>";for(var gid in this.lockedGroups){count++;if(this.groups[gid]){lockXML=lockXML+"<gid>"+gid+"</gid>";}}lockXML=lockXML+"</lockedGroups>";if(count>0){return lockXML;}else{return"";}};this.getGroupXML=function(){var grpXML="<mfGroupList>";for(var gid in this.groups){if(this.groups[gid]){grpXML=grpXML+this.groups[gid].getXML();}}grpXML=grpXML+"</mfGroupList>";return grpXML;};this.getLinkedGroups=function(){var count=0;var linkXML="<linkedGroups>";for(var gid in this.linkedGroups){count++;if(this.groups[gid]){linkXML=linkXML+"<linkgid group='"+gid+"' >"+this.linkedGroups[gid].link+"</linkgid>";}}linkXML=linkXML+"</linkedGroups>";if(count>0){return linkXML;}else{return"";}};this.loadLockedGroups=function(xml){if(xml){$(xml).find("gid").each(function(){var propItem=$(this);var gid=propItem.text();if(gid!=""){thisClass.lockGroup(gid);}});}};this.loadLinkedGroups=function(xml){if(xml){$(xml).find("linkgid").each(function(){var propItem=$(this);var gid=propItem.attr("group");var linkObj=new Object();linkObj.link=propItem.text();linkObj.GROUP=true;linkObj.GROUPID=gid;thisClass.linkedGroups[gid]=linkObj;});}};this.loadGroups=function(xml){if(xml){$(xml).find("mfgroup").each(function(){var propItem=$(this);var gid=propItem.attr("id");var gparent=propItem.attr("parent");if(thisClass.groups[gid]){var grp=thisClass.groups[gid];grp.parent=gparent;try{if(propItem.attr("name")){grp.groupname=propItem.attr("name");}}catch(e){}if(gparent!=""){var gparentGrp=thisClass.groups[gparent];if(gparentGrp){gparentGrp.add(grp);}else{thisClass.addGroup(gparent,grp);}}}});}};this.addGroup=function(gid,comp){if(comp.GROUPOBJ&&comp.parent!=""){mf_main.editorController.page.groupManager.removeGroupComponent(comp.parent,comp);}else{if(comp.GROUPID!=""&&!comp.GROUPOBJ){mf_main.editorController.page.groupManager.removeGroupComponent(comp.GROUPID,comp);}}if(!comp.GROUPOBJ){comp.GROUPID=gid;}else{comp.parent=gid;}var groupObj=thisClass.groups[gid];if(groupObj){if(comp.GROUPOBJ){if(groupObj.parent!=""&&groupObj.parent==comp.GROUPID){groupObj.parent="";}}if(groupObj.parent!=""&&groupObj.parent==groupObj.GROUPID){groupObj.parent="";}groupObj.add(comp);}else{var group=new MF_Group();group.GROUPID=gid;group.add(comp);thisClass.groups[gid]=group;}};this.addGroupOnly=function(grp){thisClass.groups[grp.GROUPID]=grp;};this.lockGroup=function(gid){if(thisClass.groups[gid]){thisClass.lockedGroups[gid]=true;var groupselect=thisClass.groupSelectors[gid];if(groupselect){groupselect.setLocking(true);}}};this.unLockGroup=function(gid){if(thisClass.lockedGroups[gid]){delete thisClass.lockedGroups[gid];var groupselect=thisClass.groupSelectors[gid];if(groupselect){groupselect.setLocking(false);}}};this.unLockAllGroups=function(){for(var gid in thisClass.lockedGroups){delete thisClass.lockedGroups[gid];var groupselect=thisClass.groupSelectors[gid];if(groupselect){groupselect.setLocking(false);}}};this.addAll=function(){for(var gid in thisClass.groups){thisClass.addGroupSelector(gid);}mf_main.editorController.reStackComponents();};this.resetSelector=function(gid){try{var groupselect=this.groupSelectors[gid];if(groupselect){var selcounter=0;var minX=0;var minY=0;var maxX=0;var maxY=0;var pos=0;var grp=thisClass.getGroupByID(gid);groupselect.globalselects=new Object();if(grp){for(var i=0;i<grp.children.size();i++){var ch=grp.children.getItemAt(i);if(ch.selector){groupselect.globalselects[ch.selector.id]=ch.selector;}}}for(var selectid in groupselect.globalselects){var select=groupselect.globalselects[selectid];var comp=select.component;selcounter++;var selwidth=select.width;var selheight=select.height;var selx=select.x;var sely=select.y;if(select.angle!=0){var deg=select.angle;var ar=deg*Math.PI/180;px=selx+selwidth*0.5;py=sely+selheight*0.5;c1=MF_Utils.getCorner(px,py,selx,sely,ar);c2=MF_Utils.getCorner(px,py,selx+selwidth,sely,ar);c3=MF_Utils.getCorner(px,py,selx+selwidth,sely+selheight,ar);c4=MF_Utils.getCorner(px,py,selx,sely+selheight,ar);bx1=Math.min(c1.x,c2.x,c3.x,c4.x);by1=Math.min(c1.y,c2.y,c3.y,c4.y);bx2=Math.max(c1.x,c2.x,c3.x,c4.x);by2=Math.max(c1.y,c2.y,c3.y,c4.y);selx=bx1;sely=by1;selwidth=bx2-bx1;selheight=by2-by1;}var ind=mf_main.editorController.page.stackOrder.getItemIndex(select);if(ind>pos){pos=ind;}if(selcounter==1){minX=selx;minY=sely;maxX=selx+selwidth;maxY=sely+selheight;}else{if(selx<minX){minX=selx;}if(sely<minY){minY=sely;}if((selx+selwidth)>maxX){maxX=selx+selwidth;}if((sely+selheight)>maxY){maxY=sely+selheight;}}}groupselect.x=minX;groupselect.y=minY;groupselect.origX=minX;groupselect.origY=minY;groupselect.width=maxX-minX;groupselect.height=maxY-minY;groupselect.POS=pos;groupselect.render(false);if(mf_main.editorController.page.stackOrder.getItemIndex(groupselect)!=-1){$("#"+groupselect.id).css("z-index",mf_main.editorController.page.stackOrder.getItemIndex(groupselect)+1);}else{if((pos+1)<=(mf_main.editorController.page.stackOrder.size())){$("#"+groupselect.id).css("z-index",pos+1);}else{$("#"+groupselect.id).css("z-index",mf_main.editorController.page.stackOrder.size()+1);}}}}catch(e){console.log(e);}};this.isChildGroup=function(pid,cid){var ret=false;var grp=thisClass.getGroupByID(pid);if(grp){for(var i=0;i<grp.children.size();i++){var ch=grp.children.getItemAt(i);if(ch.GROUPOBJ){if(ch.GROUPID==cid){return true;}else{var found=thisClass.isChildGroup(ch.GROUPID,cid);if(found){return true;}}}}}return ret;};this.addGroupSelector=function(gid){if(thisClass.groupSelectors[gid]){return;}var selcounter=0;var minX=0;var minY=0;var maxX=0;var maxY=0;var pos=0;var groupselect=new MF_Selector();groupselect.GLOBAL_SELECT=true;groupselect.GROUPID=gid;groupselect.GROUP=true;groupselect.globalselects=new Object();var grp=thisClass.getGroupByID(gid);if(grp){grp.selector=groupselect;}var coll=thisClass.getGroupComponents(gid);for(var k=0;k<coll.size();k++){var comp=coll.getItemAt(k);var select=comp.selector;if(select==null){var grp=thisClass.getGroupByID(comp.GROUPID);if(grp&&grp.selector){select=grp.selector;}else{select=thisClass.addGroupSelector(grp.GROUPID);}}selcounter++;groupselect.globalselects[select.id]=select;var selwidth=select.width;var selheight=select.height;var selx=select.x;var sely=select.y;if(select.angle!=0){var deg=select.angle;var ar=deg*Math.PI/180;px=selx+selwidth*0.5;py=sely+selheight*0.5;c1=MF_Utils.getCorner(px,py,selx,sely,ar);c2=MF_Utils.getCorner(px,py,selx+selwidth,sely,ar);c3=MF_Utils.getCorner(px,py,selx+selwidth,sely+selheight,ar);c4=MF_Utils.getCorner(px,py,selx,sely+selheight,ar);bx1=Math.min(c1.x,c2.x,c3.x,c4.x);by1=Math.min(c1.y,c2.y,c3.y,c4.y);bx2=Math.max(c1.x,c2.x,c3.x,c4.x);by2=Math.max(c1.y,c2.y,c3.y,c4.y);selx=bx1;sely=by1;selwidth=bx2-bx1;selheight=by2-by1;}var ind=mf_main.editorController.page.stackOrder.getItemIndex(select);if(ind>pos){pos=ind;}if(selcounter==1){minX=selx;minY=sely;maxX=selx+selwidth;maxY=sely+selheight;}else{if(selx<minX){minX=selx;}if(sely<minY){minY=sely;}if((selx+selwidth)>maxX){maxX=selx+selwidth;}if((sely+selheight)>maxY){maxY=sely+selheight;}}}groupselect.x=minX;groupselect.y=minY;groupselect.origX=minX;groupselect.origY=minY;groupselect.width=maxX-minX;groupselect.height=maxY-minY;if(this.lockedGroups[gid]){groupselect.setLocking(true);}groupselect.POS=pos;groupselect.id=groupselect.GROUPID+"_"+thisClass.callerPage.eid;groupselect.render();if((pos+1)<=(mf_main.editorController.page.stackOrder.size())){$("#"+groupselect.id).css("z-index",pos+1);}else{$("#"+groupselect.id).css("z-index",mf_main.editorController.page.stackOrder.size()+1);}mf_main.editorController.page.stackOrder.addItem(groupselect);thisClass.groupSelectors[groupselect.GROUPID]=groupselect;mf_main.editorController.selectorEvents(groupselect);return groupselect;};this.getGroupComponents=function(gid){var groupObj=thisClass.groups[gid];if(groupObj){return groupObj.children;}else{return(new ArrayCollection());}};this.getGroupByID=function(gid){var groupObj=thisClass.groups[gid];if(groupObj){return groupObj;}else{return null;}};this.resetParentSelectorGroups=function(gid){var grp=thisClass.getGroupByID(gid);if(grp){thisClass.resetSelector(gid);if(grp.parent!=""){thisClass.resetParentSelectorGroups(grp.parent);}}};this.resetChildSelectorGroups=function(gid){var grp=thisClass.getGroupByID(gid);if(grp){for(var i=0;i<grp.children.size();i++){var ch=grp.children.getItemAt(i);if(ch.GROUPOBJ){thisClass.resetChildSelectorGroups(ch.GROUPID);}}thisClass.resetSelector(gid);}};this.getAllChildComponents=function(gid,collection){var grp=thisClass.getGroupByID(gid);if(grp){for(var i=0;i<grp.children.size();i++){var ch=grp.children.getItemAt(i);if(ch.GROUPOBJ){thisClass.getAllChildComponents(ch.GROUPID,collection);}else{collection[ch.selector.id]=ch.selector;}}}return collection;};this.enableParentGroups=function(gid){var grp=thisClass.getGroupByID(gid);if(grp){var gselect=thisClass.groupSelectors[gid];if(gselect){gselect.enableGroup();}if(grp.parent!=""){thisClass.enableParentGroups(grp.parent);}}};this.disableParentGroups=function(gid){var grp=thisClass.getGroupByID(gid);if(grp){var gselect=thisClass.groupSelectors[gid];if(gselect){gselect.disableGroup();}if(grp.parent!=""){thisClass.disableParentGroups(grp.parent);}}};this.withinGroupParent=function(gid,cx,cy){var grp=thisClass.getGroupByID(gid);if(grp){var gselect=thisClass.groupSelectors[gid];if(gselect){if(cx>=gselect.x&&cx<=(gselect.x+gselect.width)&&cy>=gselect.y&&cy<=(gselect.y+gselect.height)){return gselect;}}if(grp.parent!=""){return thisClass.withinGroupParent(grp.parent,cx,cy);}}return null;};this.getTopMostParentGrp=function(gid){var grp=thisClass.getGroupByID(gid);if(grp){if(grp.parent!=""){return thisClass.getTopMostParentGrp(grp.parent);}else{return grp;}}return grp;};this.clearGroupSelectorByID=function(gid){if(mf_main.editorController.currentGroupEdit==gid){mf_main.editorController.closeGroupEditing();}var selector=thisClass.groupSelectors[gid];delete thisClass.groupSelectors[gid];var groupObj=thisClass.groups[gid];var collection=new ArrayCollection();if(groupObj){if(groupObj.parent!=""){mf_main.editorController.page.groupManager.removeGroupComponent(groupObj.parent,groupObj);}collection=groupObj.children;}for(var k=0;k<collection.size();k++){var comp=collection.getItemAt(k);if(!comp.GROUPOBJ){comp.GROUPID="";}else{comp.parent="";}if(comp.component){comp.component.GROUPID="";}if(comp.selector){mf_main.editorController.setCompActive(comp.selector);}}delete thisClass.groups[gid];delete thisClass.lockedGroups[gid];if(selector){var sind=mf_main.editorController.page.stackOrder.getItemIndex(selector);if(sind!=-1){mf_main.editorController.page.stackOrder.removeItemAt(sind);}$("#"+selector.id).remove();}delete thisClass.groupSelectors[gid];delete thisClass.groups[gid];delete thisClass.lockedGroups[gid];delete thisClass.linkedGroups[gid];};this.setStackPos=function(gid,groupSelects){var grp=thisClass.groups[gid];if(grp){var lastpos=0;for(var k=0;k<grp.children.size();k++){var childObj=grp.children.getItemAt(k);var childPos=mf_main.editorController.page.stackOrder.getItemIndex(childObj.selector);if(childObj.GROUPOBJ){thisClass.setStackPos(childObj.GROUPID,groupSelects);}var pos=mf_main.editorController.page.stackOrder.getItemIndex(childObj.selector);if(pos!=-1){if(pos>lastpos){lastpos=pos;}}}var gselect=thisClass.groupSelectors[gid];if(gselect){var newpos=0;for(var k=0;k<grp.children.size();k++){var childObj=grp.children.getItemAt(k);var childPos=mf_main.editorController.page.stackOrder.getItemIndex(childObj.selector);if(childPos!=-1){if(childPos>newpos){newpos=childPos;}}}newpos=newpos+1;groupSelects[gid]=newpos;mf_main.editorController.page.stackOrder.addItemAt(gselect,newpos);}}};this.removeGroupComponent=function(gid,comp){var groupObj=thisClass.groups[gid];var collection=null;if(groupObj){collection=groupObj.children;}if(collection&&collection.getItemIndex(comp)!=-1){collection.removeItemAt(collection.getItemIndex(comp));}var groupselect=this.groupSelectors[gid];if(groupselect){if(comp.selector){delete groupselect.globalselects[comp.selector.id];}}};this.clear=function(){this.groups=new Object();this.groupSelectors=new Object();this.lockedGroups=new Object();this.linkedGroups=new Object();};}var MF_ComponentSettingUtils=(function(){function privateMethod(){}return{rememberToggle:function(refClass){if(mf_main.editorController.rememberToggleSettings[refClass.NAME]){if(mf_main.editorController.rememberToggleSettings[refClass.NAME]=="hide"){MF_ComponentSettingUtils.hideSettings(refClass);}else{MF_ComponentSettingUtils.showSettings(refClass);}}},rememberSpecToggle:function(refClass){if(mf_main.editorController.rememberToggleSpecs[refClass.NAME]){if(mf_main.editorController.rememberToggleSpecs[refClass.NAME]=="hide"){MF_ComponentSettingUtils.hideSpecs(refClass);}else{MF_ComponentSettingUtils.showSpecs(refClass);}}},showSettings:function(refClass){refClass.showSetting=true;$("#"+refClass.eid+"_partSetting").show();$("#"+refClass.eid+"_settingToggleHide").hide();$("#"+refClass.eid+"_settingToggleShow").show();},hideSettings:function(refClass){refClass.showSetting=false;$("#"+refClass.eid+"_partSetting").hide();$("#"+refClass.eid+"_settingToggleHide").show();$("#"+refClass.eid+"_settingToggleShow").hide();},showSpecs:function(refClass){refClass.showSpec=true;$("#"+refClass.eid+"_partSpec").show();$("#"+refClass.eid+"_specToggleHide").hide();$("#"+refClass.eid+"_specToggleShow").show();},hideSpecs:function(refClass){refClass.showSpec=false;$("#"+refClass.eid+"_partSpec").hide();$("#"+refClass.eid+"_specToggleHide").show();$("#"+refClass.eid+"_specToggleShow").hide();},setupToggle:function(refClass){$("#"+refClass.eid+"_settingToggle").on("click",function(event){if(refClass.showSetting){refClass.showSetting=false;$("#"+refClass.eid+"_partSetting").hide();$("#"+refClass.eid+"_settingToggleHide").show();$("#"+refClass.eid+"_settingToggleShow").hide();mf_main.editorController.rememberToggleSettings[refClass.NAME]="hide";}else{refClass.showSetting=true;$("#"+refClass.eid+"_partSetting").show();$("#"+refClass.eid+"_settingToggleHide").hide();$("#"+refClass.eid+"_settingToggleShow").show();mf_main.editorController.rememberToggleSettings[refClass.NAME]="show";}});if(mf_main.DESIGNMODE){$("#"+refClass.eid+"_powerup").hide();}},setupSpecToggle:function(refClass){$("#"+refClass.eid+"_specToggle").on("click",function(event){if(refClass.showSpec){refClass.showSpec=false;$("#"+refClass.eid+"_partSpec").hide();$("#"+refClass.eid+"_specToggleHide").show();$("#"+refClass.eid+"_specToggleShow").hide();mf_main.editorController.rememberToggleSpecs[refClass.NAME]="hide";}else{refClass.showSpec=true;$("#"+refClass.eid+"_partSpec").show();$("#"+refClass.eid+"_specToggleHide").hide();$("#"+refClass.eid+"_specToggleShow").show();mf_main.editorController.rememberToggleSpecs[refClass.NAME]="show";}});},setupTransform:function(refClass){$("#rotate_"+refClass.eid).focusin(function(){mf_main.editorController.disableShortcuts();});$("#rotate_"+refClass.eid).focusout(function(){mf_main.editorController.enableShortcuts();});$("#rotate_"+refClass.eid).kendoNumericTextBox({format:"#",spinners:true,spin:onRotateChange,decimals:0});$("#rotate_"+refClass.eid).focus(function(){$("#rotate_"+refClass.eid).data("kendoNumericTextBox").unbind("change",onRotateChange);$("#rotate_"+refClass.eid).data("kendoNumericTextBox").bind("change",onRotateChange);});function onRotateChange(){$("#rotate_"+refClass.eid).data("kendoNumericTextBox").unbind("change",onRotateChange);$("#mfclipboard").focus();if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}var angle=this.value();if(refClass.settingsHolder.component){refClass.angle=angle;refClass.settingsHolder.component.e2xml.addPropSingle("eangle",refClass.angle);refClass.settingsHolder.component.render(false);mf_main.editorController.addSelectorResize(refClass.settingsHolder.component.selector);if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}}if(angle!=0){mf_main.editorController.disableCropMode();}}refClass.rotatebox=$("#rotate_"+refClass.eid).data("kendoNumericTextBox");$("#x_"+refClass.eid).focusin(function(){mf_main.editorController.disableShortcuts();});$("#x_"+refClass.eid).focusout(function(){mf_main.editorController.enableShortcuts();});var maxval=10000000;if(mf_main.editorController.RESTRICT_SIZE){maxval=mf_main.editorController.RESTRICT_SIZE_LIMIT;}$("#x_"+refClass.eid).kendoNumericTextBox({format:"#",spinners:true,spin:onXChange,decimals:0,max:maxval});$("#x_"+refClass.eid).focus(function(){$("#x_"+refClass.eid).data("kendoNumericTextBox").unbind("change",onXChange);$("#x_"+refClass.eid).data("kendoNumericTextBox").bind("change",onXChange);});function onXChange(){$("#x_"+refClass.eid).data("kendoNumericTextBox").unbind("change",onXChange);$("#mfclipboard").focus();if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}var x=this.value();if(mf_main.editorController.RESTRICT_SIZE){if((x)>mf_main.editorController.RESTRICT_SIZE_LIMIT-1){mf_main.editorController.displaySizeRestiction();x=x-20;this.value(x);}}if(refClass.settingsHolder.component){var posObject=new Object();posObject.y=refClass.settingsHolder.component.ecoordinates.y;posObject.x=x;refClass.settingsHolder.component.e2xml.addPropObject("ecoordinates",posObject);refClass.settingsHolder.component.render(false);mf_main.editorController.addSelectorResize(refClass.settingsHolder.component.selector);}else{refClass.settingsHolder.selector.x=x;refClass.settingsHolder.selector.render(false);mf_main.editorController.rePositionComponents(refClass.settingsHolder.selector);if(mf_main.editorController.selectorResize){mf_main.editorController.selectorResize.x=x;$("#"+mf_main.editorController.selectorResize.id).css("left",refClass.settingsHolder.selector.x);$("#"+mf_main.editorController.selectorResize.id).css("top",refClass.settingsHolder.selector.y);}}mf_main.editorController.resizePage();if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}}refClass.xbox=$("#x_"+refClass.eid).data("kendoNumericTextBox");$("#y_"+refClass.eid).focusin(function(){mf_main.editorController.disableShortcuts();});$("#y_"+refClass.eid).focusout(function(){mf_main.editorController.enableShortcuts();});$("#y_"+refClass.eid).kendoNumericTextBox({format:"#",spinners:true,spin:onYChange,decimals:0,max:maxval});$("#y_"+refClass.eid).focus(function(){$("#y_"+refClass.eid).data("kendoNumericTextBox").unbind("change",onYChange);$("#y_"+refClass.eid).data("kendoNumericTextBox").bind("change",onYChange);});function onYChange(){$("#y_"+refClass.eid).data("kendoNumericTextBox").unbind("change",onYChange);$("#mfclipboard").focus();if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}var y=this.value();if(mf_main.editorController.RESTRICT_SIZE){if((y)>mf_main.editorController.RESTRICT_SIZE_LIMIT-1){mf_main.editorController.displaySizeRestiction();y=y-20;this.value(y);}}if(refClass.settingsHolder.component){var posObject=new Object();posObject.x=refClass.settingsHolder.component.ecoordinates.x;posObject.y=y;refClass.settingsHolder.component.e2xml.addPropObject("ecoordinates",posObject);refClass.settingsHolder.component.render(false);mf_main.editorController.addSelectorResize(refClass.settingsHolder.component.selector);}else{refClass.settingsHolder.selector.y=y;refClass.settingsHolder.selector.render(false);mf_main.editorController.rePositionComponents(refClass.settingsHolder.selector);if(mf_main.editorController.selectorResize){mf_main.editorController.selectorResize.y=y;$("#"+mf_main.editorController.selectorResize.id).css("left",refClass.settingsHolder.selector.x);$("#"+mf_main.editorController.selectorResize.id).css("top",refClass.settingsHolder.selector.y);}}mf_main.editorController.resizePage();if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}}refClass.ybox=$("#y_"+refClass.eid).data("kendoNumericTextBox");$("#w_"+refClass.eid).focusin(function(){mf_main.editorController.disableShortcuts();});$("#w_"+refClass.eid).focusout(function(){mf_main.editorController.enableShortcuts();});$("#w_"+refClass.eid).kendoNumericTextBox({format:"#",spinners:true,spin:onWChange,decimals:0,max:maxval});$("#w_"+refClass.eid).focus(function(){$("#w_"+refClass.eid).data("kendoNumericTextBox").unbind("change",onWChange);$("#w_"+refClass.eid).data("kendoNumericTextBox").bind("change",onWChange);});function onWChange(){$("#w_"+refClass.eid).data("kendoNumericTextBox").unbind("change",onWChange);$("#mfclipboard").focus();if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}var w=this.value();if(w<2){return;}if(mf_main.editorController.RESTRICT_SIZE){if((w)>mf_main.editorController.RESTRICT_SIZE_LIMIT-1){mf_main.editorController.displaySizeRestiction();w=w-20;this.value(w);}}if(refClass.settingsHolder.component){var sizeUI=new Object();sizeUI.height=refClass.settingsHolder.component.height;sizeUI.width=w;if(refClass.settingsHolder.component.NAME=="MF_ImageComp"&&refClass.settingsHolder.component.maintainSize&&refClass.settingsHolder.component.imageID!=""&&!refClass.settingsHolder.component.canvasDraw){var undo2=new MF_UndoDAO();undo2.propObjectUndo(refClass.settingsHolder.component,"esize",refClass.settingsHolder.component.esize);var prevwidth=refClass.settingsHolder.component.width;var preheight=refClass.settingsHolder.component.height;refClass.settingsHolder.component.e2xml.addPropObject("esize",sizeUI,"default");refClass.settingsHolder.component.render(false);var vheight=w/prevwidth*preheight;var sizeUI=new Object();sizeUI.height=vheight;sizeUI.width=w;refClass.hbox.value(vheight);refClass.settingsHolder.component.e2xml.addPropObject("esize",sizeUI,"default");refClass.settingsHolder.component.render(false);MF_ChangeManager.addUndo(undo2);mf_main.editorController.addSelectorResize(refClass.settingsHolder.component.selector);}else{refClass.settingsHolder.component.e2xml.addPropObject("esize",sizeUI);refClass.settingsHolder.component.render(false);mf_main.editorController.addSelectorResize(refClass.settingsHolder.component.selector);}}else{refClass.settingsHolder.selector.origH=refClass.settingsHolder.selector.height;refClass.settingsHolder.selector.origW=refClass.settingsHolder.selector.width;refClass.settingsHolder.selector.width=w;refClass.settingsHolder.selector.render(false);refClass.settingsHolder.selector.setSize();if(refClass.settingsHolder.selector.GLOBAL_SELECT&&refClass.settingsHolder.selector.GROUP){mf_main.editorController.page.groupManager.resetChildSelectorGroups(refClass.settingsHolder.selector.GROUPID);mf_main.editorController.addSelectorResize(refClass.settingsHolder.selector);}if(refClass.settingsHolder.selector.GLOBAL_SELECT&&!refClass.settingsHolder.selector.GROUP){mf_main.editorController.calculateGlobalSelection(true);}}mf_main.editorController.resizePage();if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}}refClass.wbox=$("#w_"+refClass.eid).data("kendoNumericTextBox");$("#h_"+refClass.eid).kendoNumericTextBox({format:"#",spinners:true,spin:onHChange,decimals:0,max:maxval});$("#h_"+refClass.eid).focus(function(){$("#h_"+refClass.eid).data("kendoNumericTextBox").unbind("change",onHChange);$("#h_"+refClass.eid).data("kendoNumericTextBox").bind("change",onHChange);});$("#h_"+refClass.eid).focusin(function(){mf_main.editorController.disableShortcuts();});$("#h_"+refClass.eid).focusout(function(){mf_main.editorController.enableShortcuts();});function onHChange(){$("#h_"+refClass.eid).data("kendoNumericTextBox").unbind("change",onHChange);$("#mfclipboard").focus();if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}var h=this.value();if(h<2){return;}if(mf_main.editorController.RESTRICT_SIZE){if((h)>mf_main.editorController.RESTRICT_SIZE_LIMIT-1){mf_main.editorController.displaySizeRestiction();h=h-20;this.value(h);}}if(refClass.settingsHolder.component){var sizeUI=new Object();sizeUI.height=h;sizeUI.width=refClass.settingsHolder.component.width;if(refClass.settingsHolder.component.NAME=="MF_ImageComp"&&refClass.settingsHolder.component.maintainSize&&refClass.settingsHolder.component.imageID!=""&&!refClass.settingsHolder.component.canvasDraw){var undo2=new MF_UndoDAO();undo2.propObjectUndo(refClass.settingsHolder.component,"esize",refClass.settingsHolder.component.esize);var prevwidth=refClass.settingsHolder.component.width;var preheight=refClass.settingsHolder.component.height;refClass.settingsHolder.component.e2xml.addPropObject("esize",sizeUI,"default");refClass.settingsHolder.component.render(false);var vwidth=h*(prevwidth/preheight);var sizeUI=new Object();sizeUI.height=h;sizeUI.width=vwidth;refClass.wbox.value(vwidth);refClass.settingsHolder.component.e2xml.addPropObject("esize",sizeUI,"default");refClass.settingsHolder.component.render(false);MF_ChangeManager.addUndo(undo2);mf_main.editorController.addSelectorResize(refClass.settingsHolder.component.selector);}else{refClass.settingsHolder.component.e2xml.addPropObject("esize",sizeUI);refClass.settingsHolder.component.render(false);mf_main.editorController.addSelectorResize(refClass.settingsHolder.component.selector);}}else{refClass.settingsHolder.selector.origH=refClass.settingsHolder.selector.height;refClass.settingsHolder.selector.origW=refClass.settingsHolder.selector.width;refClass.settingsHolder.selector.height=h;refClass.settingsHolder.selector.render(false);refClass.settingsHolder.selector.setSize();if(refClass.settingsHolder.selector.GLOBAL_SELECT&&refClass.settingsHolder.selector.GROUP){mf_main.editorController.page.groupManager.resetChildSelectorGroups(refClass.settingsHolder.selector.GROUPID);mf_main.editorController.addSelectorResize(refClass.settingsHolder.selector);}if(refClass.settingsHolder.selector.GLOBAL_SELECT&&!refClass.settingsHolder.selector.GROUP){mf_main.editorController.calculateGlobalSelection(true);}}mf_main.editorController.resizePage();if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}}refClass.hbox=$("#h_"+refClass.eid).data("kendoNumericTextBox");if(refClass.settingsHolder.component){refClass.xbox.value(refClass.settingsHolder.component.ecoordinates.x);refClass.ybox.value(refClass.settingsHolder.component.ecoordinates.y);refClass.wbox.value(refClass.settingsHolder.component.esize.width);refClass.hbox.value(refClass.settingsHolder.component.esize.height);refClass.rotatebox.value(refClass.settingsHolder.component.eangle);}else{refClass.xbox.value(refClass.settingsHolder.selector.x);refClass.ybox.value(refClass.settingsHolder.selector.y);refClass.wbox.value(refClass.settingsHolder.selector.width);refClass.hbox.value(refClass.settingsHolder.selector.height);}},updateTransform:function(xbox,ybox,wbox,hbox,rotatebox,selector,noscale){if(xbox!=null){if(noscale){xbox.value(selector.x);}else{xbox.value(selector.x*mf_main.editorController.SCALE);}}if(ybox!=null){if(noscale){ybox.value(selector.y);}else{ybox.value(selector.y*mf_main.editorController.SCALE);}}if(wbox!=null){wbox.value(selector.width);}if(hbox!=null){hbox.value(selector.height);}if(selector.component){if(rotatebox!=null){rotatebox.value(selector.angle);}}},setDragEvents:function(settingsClass){$("#"+settingsClass.eid).drag("start",function(ev,dd){ev.stopImmediatePropagation();});$("#"+settingsClass.eid).drag(function(ev,dd){ev.stopImmediatePropagation();var props={};props.top=dd.offsetY;props.left=dd.offsetX;mf_main.editorController.settingPosX=props.left;mf_main.editorController.settingPosY=props.top;$(this).css(props);});$("#"+settingsClass.eid).drag("end",function(ev,dd){ev.stopImmediatePropagation();mf_main.editorController.settingManualPlace=true;});},setCommonDragEvents:function(eid){$("#"+eid).drag("start",function(ev,dd){ev.stopImmediatePropagation();});$("#"+eid).drag(function(ev,dd){ev.stopImmediatePropagation();var props={};props.top=dd.offsetY;props.left=dd.offsetX;$(this).css(props);});$("#"+eid).drag("end",function(ev,dd){ev.stopImmediatePropagation();});},setLinkType:function(lid,component){MF_ComponentSettingUtils.convert2LinkObj(component);if(component.link!=""){if(component.linkObj.type=="web"){$(lid).text(""+component.linkObj.url);}else{if(component.linkObj.type=="internal"){var urldisp=component.linkObj.url;var arr=urldisp.split("|--::--|");if(arr.length==2){$(lid).text("Internal: "+arr[1]);}else{$(lid).text("Internal link");}}else{var res="Select link";for(var k=0;k<MF_PagePool.getPages().size();k++){var litem=MF_PagePool.getPages().getItemAt(k);if(litem.eid==component.linkObj.url){res=litem.pageName;break;}}if(res=="Select link"){if(component.linkObj.url=="_Next_"){res="Next Page";}if(component.linkObj.url=="_Prev_"){res="Previous Page";}if(component.linkObj.url=="_First_"){res="First Page";}if(component.linkObj.url=="_Last_"){res="Last Page";}}$(lid).text(res);}}}else{$(lid).text("Select link");}},openLinkModal:function(lid,holder){mf_main.editorController.pageLinkController.currentLinkID=lid;if(holder.settingsHolder.component){mf_main.editorController.pageLinkController.component=holder.settingsHolder.component;}else{mf_main.editorController.pageLinkController.component=holder.linkObj;}mf_main.editorController.pageLinkController.openPageLinkDialog();},openMultiLinkModal:function(lid,holder){mf_main.editorController.pageMultiLinkController.currentLinkID=lid;mf_main.editorController.pageMultiLinkController.component=holder.settingsHolder.component;mf_main.editorController.pageMultiLinkController.openPageLinkDialog();},openMultiIconModal:function(lid,holder){mf_main.editorController.iconAssignController.currentIconID=lid;mf_main.editorController.iconAssignController.component=holder.settingsHolder.component;mf_main.editorController.iconAssignController.openPageIconDialog();},openSingleIconModal:function(lid,holder){mf_main.editorController.iconAssignController.currentIconID=lid;if(holder.settingsHolder){mf_main.editorController.iconAssignController.component=holder.settingsHolder.component;}else{mf_main.editorController.iconAssignController.component=holder.component;}mf_main.editorController.iconAssignController.settingsObj=holder;mf_main.editorController.iconAssignController.openSingleIconDialog();},convert2LinkObj:function(component){if(component.link!=""&&component.link!=null){var linkarr=component.link.split(":--:");if(linkarr.length==3){component.linkObj=new MF_LinkObj();component.linkObj.event=linkarr[0];if(linkarr[1]=="page"){component.linkObj.type="page";var page=MF_PagePool.getPage(linkarr[2]);if(page){component.linkObj.url=page.eid;component.linkObj.pageName=page.pageName;}}if(linkarr[1]=="internal"){component.linkObj.type="internal";component.linkObj.url=linkarr[2];}if(linkarr[1]=="web"){component.linkObj.type="web";component.linkObj.url=linkarr[2];}}}else{component.linkObj=null;}},getMultiLinkHighlightObj:function(component,arr){var linkcount=0;var linkSelectObj=null;if(mf_main.editorController.VIEWER&&component.pageSetLink){for(var n=0;n<arr.length;n++){var obj=MF_ComponentSettingUtils.highlightMultiLink(component,linkcount,n);if(obj.select){linkSelectObj=obj;}linkcount=obj.linkcount;}}return linkSelectObj;},highlightMultiLink:function(component,linkcount,i){var obj=new Object();obj.highlightItem=true;obj.select=false;obj.linkcount=linkcount;if(mf_main.editorController.VIEWER&&component.pageSetLink){var highlightPass=false;if(component.showDivider){if(i%2==0){highlightPass=true;}}else{highlightPass=true;}if(highlightPass){if(component&&component.linkArray){var plink=component.linkArray[obj.linkcount];if(plink){var plinkarr=plink.split(":--:");if(plinkarr.length==3){if(plinkarr[1]=="page"){var page=MF_PagePool.getPage(plinkarr[2]);if(page){if(page.eid==mf_main.editorController.page.eid){obj.select=true;obj.highlightItem=false;obj.count=i;}}}}}obj.linkcount++;}}}return obj;},assignMultiLink:function(component){if(component.ALLOW_MULTILINK&&component.pageSetLink){if(component.linkArray){$("."+component.eid+"_itemCls").off("click");component.assignedLinkItems=new Object();for(var key in component.linkArray){var num=parseInt(key);if(component.tempLinkItems[num]){var domID=component.tempLinkItems[num];var link=component.linkArray[key];component.assignedLinkItems[domID]=link;$("."+domID).on("click",function(e){if(mf_main.editorController.EDITOR){return;}var link=component.assignedLinkItems[$(this).attr("data-cls")];if(link){var linkarr=link.split(":--:");if(linkarr.length==3){if(linkarr[1]=="page"){var page=MF_PagePool.getPage(linkarr[2]);if(page){mf_main.editorController.viewPage(page);}}if(linkarr[1]=="web"){var ourl=linkarr[2];if(ourl.indexOf("http:")==-1&&ourl.indexOf("https:")==-1){ourl="http://"+ourl;}var safeurl="";if(MF_Global.getS3Bucket()=="testmfassets"){safeurl="safeurlcheck.jsp?url="+encodeURIComponent(ourl);}else{safeurl="https://wireframepro.mockflow.com/safeurlcheck.jsp?url="+encodeURIComponent(ourl);}$("#mfExternalLinkURLTxt").text(ourl);$("#mfOpenExternalLink").attr("href",safeurl);$("#mfWarnLinkModal").modal();}if(linkarr[1]=="internal"){var cid=linkarr[2];var arr=cid.split("|--::--|");var comp=mf_main.editorController.getComponentByLid(arr[0]);if(comp){$("#mfEditorHolder").animate({scrollTop:(comp.y*mf_main.editorController.SCALE),scrollLeft:(comp.x*mf_main.editorController.SCALE)},1000,function(){});}else{MF_Utils.display_ActionIndicator("Component not found");}}}}});}}}}else{component.linkObj=null;}}};})();var MF_IDConverter=(function(){canvasDictionary=new Array();rectangle=0;triangle=0;circle=0;image=0;canvas=0;codeblock=0;ellipse=0;text=0;simpletext=0;button=0;return{reset:function(){canvasDictionary=new Array();rectangle=0;triangle=0;circle=0;image=0;canvas=0;codeblock=0;ellipse=0;text=0;simpletext=0;button=0;},putCanvasID:function(cname,cid){canvas++;canvasDictionary[cid]="Canvas_"+canvas.toString();},getCanvasID:function(eid){return canvasDictionary[eid];},getID:function(type){if(type=="MF_Rectangle"){rectangle++;return type+rectangle.toString();}if(type=="MF_Rectangle2"){rectangle++;return type+rectangle.toString();}if(type=="MF_Circle"){circle++;return type+circle.toString();}if(type=="MF_Circle2"){circle++;return type+circle.toString();}if(type=="MF_Triangle"){triangle++;return type+triangle.toString();}if(type=="MF_Text"){text++;return type+text.toString();}if(type=="MF_SimpleText"){simpletext++;return type+simpletext.toString();}if(type=="MF_Button"){button++;return type+button.toString();}if(type=="MF_Button2"){button++;return type+button.toString();}if(type=="MF_Ellipse"){ellipse++;return type+ellipse.toString();}if(type=="MF_Ellipse2"){ellipse++;return type+ellipse.toString();}if(type=="MF_CodeBlock"){codeblock++;return type+codeblock.toString();}if(type=="MF_ImageComp"){image++;return type+image.toString();}return MF_Utils.guidGenerator();}};})();var MF_ChangeManager=(function(){var _CHANGED=false;function privateMethod(){}return{CHANGED:function(val){_CHANGED=val;if(val){if(mf_main.editorController.page){mf_main.editorController.page.changed=true;mf_main.editorController.page.revisionChanged=true;mf_main.rtc.editorSync("lockEditing",mf_main.editorController.page);}mf_main.editorController.revisionController.revisionChanged=true;mf_main.editorController.setUnSaveState();}else{mf_main.editorController.setSaveState();}},getCHANGED:function(val){return _CHANGED;},clean:function(page){mf_main.editorController.page.undo=new Array();mf_main.editorController.page.redo=new Array();return null;},addUndo:function(undoObj){MF_ChangeManager.CHANGED(true);if(mf_main.editorController.page.undo.length>100){mf_main.editorController.page.undo.splice(0,1);}mf_main.editorController.page.undo[mf_main.editorController.page.undo.length]=undoObj;return null;},addRedo:function(redoObj){MF_ChangeManager.CHANGED(true);if(mf_main.editorController.page.redo.length>100){mf_main.editorController.page.redo.splice(0,1);}mf_main.editorController.page.redo[mf_main.editorController.page.redo.length]=redoObj;return null;},execUndo:function(){if(mf_main.editorController.page.undo.length>0){var undoObj=mf_main.editorController.page.undo.pop();undoObj.undoMe("false");return undoObj;}else{return null;}},execRedo:function(){if(mf_main.editorController.page.redo.length>0){var undoObj=mf_main.editorController.page.redo.pop();undoObj.undoMe("redo");return undoObj;}else{return null;}}};})();function MF_UndoDAO(){this.undoObj=null;this.name="";this.clone=function(){var undo=new MF_UndoDAO();undo.undoObj=this.undoObj.clone();return undo;};this.addUndo=function(selectorArr){this.undoObj=new MF_AddUndo(selectorArr);};this.delUndo=function(cutObj,posArray){this.undoObj=new MF_DelUndo(cutObj,posArray);};this.positionUndo=function(posArray){this.undoObj=new MF_PositionUndo(posArray);};this.groupUndo=function(gid,group,page,comps,prevGroupID){this.undoObj=new MF_GroupUndo(gid,group,page,comps,prevGroupID);};this.lockGroupUndo=function(gid,lock,page){this.undoObj=new MF_LockGroupUndo(gid,lock,page);};this.propObjectUndo=function(_obj,_name,_val){this.undoObj=new MF_PropObjectUndo(_obj,_name,_val);this.name=_obj.NAME+" "+_name;};this.propSingleUndo=function(_obj,_name,_val){this.undoObj=new MF_PropSingleUndo(_obj,_name,_val);this.name=_obj.NAME+" "+_name;};this.propArrayUndo=function(_obj,_name,_val){this.undoObj=new MF_PropArrayUndo(_obj,_name,_val);this.name=_obj.NAME+" "+_name;};this.styleSingleUndo=function(_obj,_name,_val){this.undoObj=new MF_StyleSingleUndo(_obj,_name,_val);this.name=_obj.NAME+" "+_name;};this.styleArrayUndo=function(_obj,_name,_val){this.undoObj=new MF_StyleArrayUndo(_obj,_name,_val);this.name=_obj.NAME+" "+_name;};this.metaUndo=function(_obj){this.undoObj=_obj;};this.undoMe=function(_action){this.undoObj.undoChange(_action);};}function MF_PropObjectUndo(_obj,_name,_val){this.obj=_obj;this.name=_name;this.val=_val;this.clone=function(){var newobj=new MF_PropObjectUndo(this.obj,this.name,this.val);newobj.val=this.obj[this.name];return newobj;};this.undoChange=function(_action){var newobj=mf_main.editorController.page.getComponentByID(this.obj.eid);if(newobj){if(newobj.NAME==this.obj.NAME){this.obj=newobj;}}this.obj.e2xml.addPropObject(this.name,this.val,_action);this.obj.render(false);var selector=this.obj.selector;if(selector){selector.x=this.obj.x-selector.delta;selector.y=this.obj.y-selector.delta;selector.width=this.obj.width+(selector.delta*2);selector.height=this.obj.height+(selector.delta*2);selector.render(false);if(this.obj.GROUPID!=""){mf_main.editorController.page.groupManager.resetParentSelectorGroups(this.obj.GROUPID);}}};}function MF_PositionObj(_obj,_spos,_opos){this.obj=_obj;this.opos=_opos;this.spos=_spos;this.eid=null;this.execute=function(changeposition){if(changeposition==undefined){changeposition=true;}if(this.obj==null){this.obj=mf_main.editorController.page.getComponentByID(this.eid);}else{this.obj=mf_main.editorController.page.getComponentByID(this.obj.eid);}var select=null;if(this.obj){select=this.obj.selector;}var newposObj=null;if(select&&select.component){if(this.opos<=(mf_main.editorController.page.childComponents.size())&&this.opos>=0){var curind=mf_main.editorController.page.childComponents.getItemIndex(select.component);if(curind!=-1){mf_main.editorController.page.childComponents.removeItemAt(curind);mf_main.editorController.page.childComponents.addItemAt(select.component,this.opos);newposObj=new MF_PositionObj(select.component,this.opos,curind);}}}return newposObj;};}function MF_PropSingleUndo(_obj,_name,_val){this.obj=_obj;this.name=_name;this.val=_val;this.clone=function(){var newobj=new MF_PropSingleUndo(this.obj,this.name,this.val);newobj.val=this.obj[this.name];return newobj;};this.undoChange=function(_action){var newobj=mf_main.editorController.page.getComponentByID(this.obj.eid);if(newobj){if(newobj.NAME==this.obj.NAME){this.obj=newobj;}}this.obj.e2xml.addPropSingle(this.name,this.val,_action);if(this.obj.NAME=="MF_SVGIcon"&&this.name=="SVGUrl"){this.obj.render(true);mf_main.editorController.reStackComponents();}else{if(this.obj.NAME=="MF_Illustration"&&(this.name=="SVGUrl"||this.name=="currentColorsData")){this.obj.render(true);mf_main.editorController.reStackComponents();}else{if(this.name=="cssJson"){this.obj.render(true);mf_main.editorController.reStackComponents();}else{if(this.obj.NAME=="MF_BYOC"&&(this.name=="text"||this.name=="tailwindVersion"||this.name=="fontType"||this.name=="isGoogleFontUsed")){this.obj.render(true);mf_main.editorController.reStackComponents();}else{if(this.obj.NAME=="MF_ImageComp"&&this.name=="imageID"){this.obj.render(true);mf_main.editorController.reStackComponents();}else{if(this.obj.NAME=="MF_ImageComp"&&this.name=="text"){this.obj.render(true);mf_main.editorController.reStackComponents();}else{this.obj.render(false);}}}}}}if(this.name=="transformLock"){if(this.obj.selector){this.obj.selector.setLocking(this.val);mf_main.editorController.clearSelection();}}if(this.obj.GROUPID!=""){mf_main.editorController.page.groupManager.resetParentSelectorGroups(this.obj.GROUPID);}};}function MF_PropArrayUndo(_obj,_name,_val,_arrType){this.obj=_obj;this.name=_name;this.val=_val;this.arrType=_arrType;this.clone=function(){var newobj=new MF_PropArrayUndo(this.obj,this.name,this.val,this.arrType);newobj.val=this.obj[this.name];return newobj;};this.undoChange=function(_action){var newobj=mf_main.editorController.page.getComponentByID(this.obj.eid);if(newobj){if(newobj.NAME==this.obj.NAME){this.obj=newobj;}}var newarr=this.val.slice();this.obj.e2xml.addPropArray(this.name,this.val,this.arrType,_action);this.obj.render(false);if(this.obj.GROUPID!=""){mf_main.editorController.page.groupManager.resetParentSelectorGroups(this.obj.GROUPID);}};}function MF_StyleSingleUndo(_obj,_name,_val){this.obj=_obj;this.name=_name;this.val=_val;this.clone=function(){var newobj=new MF_StyleSingleUndo(this.obj,this.name,this.val);newobj.val=this.obj[this.name];return newobj;};this.undoChange=function(_action){var newobj=mf_main.editorController.page.getComponentByID(this.obj.eid);if(newobj){if(newobj.NAME==this.obj.NAME){this.obj=newobj;}}this.obj.e2xml.addPropSingle(this.name,this.val,_action);this.obj.render(false);if(this.obj.GROUPID!=""){mf_main.editorController.page.groupManager.resetParentSelectorGroups(this.obj.GROUPID);}};}function MF_StyleArrayUndo(_obj,_name,_val,_arrType){this.obj=_obj;this.name=_name;this.val=_val;this.arrType=_arrType;this.clone=function(){var newobj=new MF_StyleArrayUndo(this.obj,this.name,this.val,this.arrType);newobj.val=this.obj[this.name];return newobj;};this.undoChange=function(_action){var newobj=mf_main.editorController.page.getComponentByID(this.obj.eid);if(newobj){if(newobj.NAME==this.obj.NAME){this.obj=newobj;}}this.obj.e2xml.addPropArray(this.name,this.val,this.arrType,_action);this.obj.render(false);if(this.obj.GROUPID!=""){mf_main.editorController.page.groupManager.resetParentSelectorGroups(this.obj.GROUPID);}};}function MF_MetaUndo(_metaObj,_reselectMeta){this.metaObj=_metaObj;this.reselectMeta=_reselectMeta;if(_reselectMeta==null){this.reselectMeta=false;}this.clone=function(){return this;};this.getType=function(){return"meta";};this.undoChange=function(_action){var undoObj=new MF_UndoDAO();undoObj.metaUndo(this);var groups=new Object();var temp=this.metaObj;this.metaObj=new Array();var pastedComponents=new Array();for(var i=0;i<temp.length;i++){var change=temp[i];this.metaObj[this.metaObj.length]=change.clone();}if(_action=="false"){MF_ChangeManager.addRedo(undoObj);}else{MF_ChangeManager.addUndo(undoObj);}var lastobj=null;for(var i=0;i<temp.length;i++){var undo=temp[i];undo.undoMe("default");if(undo.undoObj.obj){if(undo.undoObj.obj.GROUPID!=""){groups[undo.undoObj.obj.GROUPID]=true;}lastobj=undo.undoObj.obj;mf_main.editorController.resetSelectorSize(undo.undoObj.obj);}}for(var group in groups){mf_main.editorController.page.groupManager.resetParentSelectorGroups(group);}if(this.reselectMeta){var tempChk=new Object();for(var i=0;i<temp.length;i++){var change2=temp[i];if(change2 instanceof MF_UndoDAO){if(change2.undoObj instanceof MF_PropObjectUndo){var obj=change2.undoObj.obj;}if(obj&&obj.selector&&!tempChk[obj.selector.id]){tempChk[obj.selector.id]=true;pastedComponents[pastedComponents.length]=obj.selector;}}}}if(this.reselectMeta&&pastedComponents.length>1){mf_main.editorController.editManager.makeSelection(pastedComponents);}if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}temp=new Array();};}function MF_AddUndo(_addarr){this.addarr=_addarr;this.clone=function(){return this;};this.getType=function(){return"add";};this.undoChange=function(_action){mf_main.editorController.editManager.deleteComponent(this.addarr,_action);if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}else{}mf_main.editorController.clearSelection();mf_main.editorController.removeGlobalSelect();};}function MF_DelUndo(_cutObj,_posArray){this.cutObj=_cutObj;this.posArray=_posArray;this.clone=function(){return this;};this.getType=function(){return"del";};this.undoChange=function(_action){mf_main.editorController.editManager.cutComponents=this.cutObj;if(_action=="false"){mf_main.editorController.editManager.pasteComponent(true,false,true,true);}else{mf_main.editorController.editManager.pasteComponent(true,true,true,true);}var groups=new Object();var revArray=this.posArray.reverse();for(var i=0;i<revArray.length;i++){var posObj=revArray[i];posObj.execute();if(posObj.obj&&posObj.obj.GROUPID!=""){groups[posObj.obj.GROUPID]=true;}}for(var group in groups){mf_main.editorController.page.groupManager.resetParentSelectorGroups(group);}mf_main.editorController.reStackComponents();if(mf_main.editorController.currentGroupEdit!=null){mf_main.editorController.page.groupManager.resetParentSelectorGroups(mf_main.editorController.currentGroupEdit);}};}function MF_PositionUndo(_posarr){this.posarr=_posarr;this.clone=function(){var newobj=new MF_PositionUndo(this.posarr);return newobj;};this.getType=function(){return"position";};this.orderSelection=function(arr){var order=new Array();var min=0;var dict=new Object();for(var i=0;i<arr.length;i++){var pos=arr[i];var comp=pos.obj;if(comp&&mf_main.editorController.page){var ind=mf_main.editorController.page.stackOrder.getItemIndex(comp);if(ind!=-1){dict[ind]=pos;order.push(ind);}}}order.sort(function(a,b){return a-b;});var newOrder=new Array();for(var i=0;i<order.length;i++){var num=order[i];newOrder.push(dict[num]);}return newOrder;};this.undoChange=function(_action){var newposarr=new Array();var newArr=this.posarr;for(var i=0;i<this.posarr.length;i++){var posObj=this.posarr[i];var newposObj=posObj.execute(false);if(newposObj!=null){newposarr.push(newposObj);}}var undo=new MF_UndoDAO();undo.positionUndo(newposarr);newposarr=newposarr.reverse();if(_action=="false"){MF_ChangeManager.addRedo(undo);}else{MF_ChangeManager.addUndo(undo);}mf_main.editorController.reStackComponents();};}function MF_LockGroupUndo(_gid,_lock,_page){this.gid=_gid;this.lock=_lock;this.obj=null;this.clone=function(){var tlock=true;if(this.lock){tlock=false;}var gundo=new MF_LockGroupUndo(this.gid,tlock,null);return gundo;};this.getType=function(){return"setting";};this.undoChange=function(_action){if(this.lock){mf_main.editorController.page.groupManager.lockGroup(this.gid);}else{mf_main.editorController.page.groupManager.unLockGroup(this.gid);}};}function MF_GroupUndo(_gid,_group,_page,_comps,_prevGroupID){var thisClass=this;this.gid=_gid;this.group=_group;this.comps=_comps;this.prevGroupID="";if(_prevGroupID!=null){this.prevGroupID=_prevGroupID;}this.obj=null;this.clone=function(){var tgroup=true;if(thisClass.group){tgroup=false;}var gundo=new MF_GroupUndo(thisClass.gid,tgroup,mf_main.editorController.page,thisClass.comps,thisClass.prevGroupID);return gundo;};this.getType=function(){return"setting";};this.undoChange=function(_action){mf_main.editorController.clearSelection();if(thisClass.group){for(var i=0;i<thisClass.comps.length;i++){var gcomp=thisClass.comps[i];if(gcomp.GROUPOBJ&&mf_main.editorController.page.groupManager.getGroupByID(gcomp.GROUPID)){var childGroup=mf_main.editorController.page.groupManager.getGroupByID(gcomp.GROUPID);mf_main.editorController.page.groupManager.addGroup(thisClass.gid,childGroup);}else{var gcopChk=mf_main.editorController.getComponentById(gcomp.eid);if(gcopChk){mf_main.editorController.page.groupManager.addGroup(thisClass.gid,gcopChk);}}}var grp=mf_main.editorController.page.groupManager.getGroupByID(thisClass.gid);if(grp){mf_main.editorController.page.groupManager.addGroupSelector(thisClass.gid);}if(thisClass.prevGroupID!=""){var grp=mf_main.editorController.page.groupManager.getGroupByID(thisClass.gid);if(mf_main.editorController.page.groupManager.getGroupByID(thisClass.prevGroupID)){mf_main.editorController.page.groupManager.addGroup(thisClass.prevGroupID,grp);mf_main.editorController.page.groupManager.resetParentSelectorGroups(thisClass.prevGroupID);}}}else{mf_main.editorController.page.groupManager.clearGroupSelectorByID(thisClass.gid);if(thisClass.prevGroupID!=""){for(var i=0;i<thisClass.comps.length;i++){var gcomp=thisClass.comps[i];if(gcomp.GROUPOBJ&&mf_main.editorController.page.groupManager.getGroupByID(thisClass.prevGroupID)){var childGroup=mf_main.editorController.page.groupManager.getGroupByID(gcomp.GROUPID);if(childGroup){mf_main.editorController.page.groupManager.addGroup(thisClass.prevGroupID,childGroup);}else{mf_main.editorController.page.groupManager.addGroup(thisClass.prevGroupID,gcomp);}}else{if(mf_main.editorController.page.groupManager.getGroupByID(thisClass.prevGroupID)){var gcopChk=mf_main.editorController.getComponentById(gcomp.eid);if(gcopChk){mf_main.editorController.page.groupManager.addGroup(thisClass.prevGroupID,gcopChk);}}}}mf_main.editorController.page.groupManager.resetParentSelectorGroups(thisClass.prevGroupID);}}mf_main.editorController.reStackComponents();};}function MF_ComponentList(){var thisClass=this;this.compArray=new Array();this.cacheSettings=new Object();this.loadedComponentCode=new Object();this.categories=new Array();this.searchedallicons=false;this.searchedallillustrations=false;this.currentCategory="featured";this.previousCategory=null;this.maincompjson="featured.json";thisClass.cachedThemeComponents=new Object();thisClass.initCategoryList=false;this.featuredComponents=new Array();this.catids=new Object();this.featureLoaded=false;this.recentPacks=new Object();this.packListLoaded=false;this.lastTemplate=null;this.filterProp=new Object();this.cacheCategory=new Object();this.settingsScrollPos=new Object();this.categoryListed=false;this.currentCategoryObj=null;this.dbCategories=new Object();this.packController=new MF_ComponentPackController();this.addIconMode=false;this.sortPacks=new Object();this.cacheClearArr=new Array();this.cacheDBClearArr=new Array();this.compTemplates=new Object();this.isNewMergePack=false;this.mergeablePackMode=false;this.mergeablePackData=new Array();this.switchMockStoreCats=new Object();this.packidToIdCats=new Object();this.idToPackidCats=new Object();this.svgIconComponents=new Array();this.svgIllustrationComponents=new Array();this.svgIconCategories=new Object();this.svgIllustrationCategories=new Object();this.activeSvgIconPackType=null;this.activeSvgIllustrationPackType=null;this.defaultSortOrder=new Array();this.iobserver=null;this.iconObserver=null;this.illustrationObserver=null;this.scrollRemember=new Object();this.currentComponentFilterList=new Object();this.currentComponentFilter=null;this.addCompPropFilters=function(){thisClass.filterProp.NAME=true;thisClass.filterProp.LABEL=true;thisClass.filterProp.GENONLY=true;thisClass.filterProp.TRANSFORM=true;thisClass.filterProp.VRESIZE=true;thisClass.filterProp.HRESIZE=true;thisClass.filterProp.USEFONT=true;thisClass.filterProp.ANNOTATION=true;thisClass.filterProp.MULTILINE=true;thisClass.filterProp.EDITABLE=true;thisClass.filterProp.AUTOSIZE=true;thisClass.filterProp.HIDE=true;thisClass.filterProp.USEPAGE=true;thisClass.filterProp.RENDER_ON_MOVE=true;thisClass.filterProp.RENDER_ON_RESIZE=true;thisClass.filterProp.RENDER=true;thisClass.filterProp.ALLOW_MULTILINK=true;thisClass.filterProp.CSSCOMP=true;thisClass.filterProp.cssObj=true;thisClass.filterProp.x=true;thisClass.filterProp.y=true;thisClass.filterProp.width=true;thisClass.filterProp.height=true;thisClass.filterProp.eangle=true;thisClass.filterProp.eid=true;thisClass.filterProp.lid=true;thisClass.filterProp.transformLock=true;thisClass.filterProp.e2xml=true;thisClass.filterProp.selector=true;thisClass.filterProp.ecoordinates=true;thisClass.filterProp.prevEcoordinates=true;thisClass.filterProp.prevEsize=true;thisClass.filterProp.esize=true;thisClass.filterProp.GROUPID=true;thisClass.filterProp.delta=true;thisClass.filterProp.linkType=true;thisClass.filterProp.link=true;thisClass.filterProp.linkObj=true;thisClass.filterProp.templateID=true;thisClass.filterProp.text=true;thisClass.filterProp.fontType=true;thisClass.filterProp.isGoogleFontUsed=true;thisClass.filterProp.icon=true;thisClass.filterProp.fontClass=true;thisClass.filterProp.iconPlace=true;thisClass.filterProp.imageID=true;thisClass.filterProp.isSVG=true;thisClass.filterProp.svgData=true;thisClass.filterProp.originalEsize=true;thisClass.filterProp.crop=true;thisClass.filterProp.showAltText=true;};this.constructor=function(){this.addCompPropFilters();thisClass.addCategories();thisClass.packController.constructor();$("#mfComponentSearchBoxClose").on("click",function(e){$("#mfComponentSearchBox").val("");$("#mfComponentSearchBox").trigger("input");$("#mfComponentSearchBox").focus();});$("#mfComponentSettings").on("scroll",function(e){if(mf_main.editorController.lastSetting&&mf_main.editorController.lastSetting.component){thisClass.settingsScrollPos[mf_main.editorController.lastSetting.component.NAME]=$("#mfComponentSettings").scrollTop();}else{if(mf_main.editorController.lastSetting&&mf_main.editorController.lastSetting.global){thisClass.settingsScrollPos.global=$("#mfComponentSettings").scrollTop();}}});$("#mfFontAwesomeCategory").change(function(e){var category=$(this).val();$("#mfIconListing .mfIconCategory").hide();$("#mfIconListSearchBox").val("");if(category=="all"){$("#mfIconListing .page-header").show();$("#mfIconListing .mfIconCategory").show();$("#mfIconListing .mfIconCategory").css({position:"static"});}else{$("#"+category).show();$(".mfIconItemCls").css("display","block");$("#mfIconListing .page-header").hide();}var searchBoxText=$("#mfIconListSearchBox").val();if(searchBoxText==""&&$("#mfFontAwesomeCategory").val()=="all"){$("#mfIconListing h4").css("display","block");$("#mfIconListing .mfIconCategory, #mfIconListing .mfIconList").css("display","inline-block");}else{if($("#mfFontAwesomeCategory").val()=="all"){$("#mfIconListing h4").css("display","none");$("#mfIconListing .mfIconCategory, #mfIconListing .mfIconList").css("display","inline");}else{$("#mfIconListing h4").css("display","none");}}});$("#mfSvgIconCategory").change(function(e){$("#mfSvgIconListSearchBox").val("");$("#mfSvgIconListing").scrollTop(0);var category=$(this).val();thisClass.getSvgIconItems(category);});$("#mfSvgIllustrationCategory").change(function(e){$("#mfSvgIllustrationListSearchBox").val("");$("#mfSvgIllustrationListing").scrollTop(0);var category=$(this).val();thisClass.getSvgIllustrationItems(category);});$("#mfFontSearchBox").on("textchange",function(e){var str=$("#mfFontSearchBox").val();str=str.trim();if(str==""){thisClass.searchFontsHandler(e);}});$("#mfThemeListSearchBox").on("textchange",function(e){thisClass.searchThemesHandler(e);});thisClass.loadedComponentCode.MF_Rectangle=true;thisClass.loadedComponentCode.MF_Circle=true;thisClass.loadedComponentCode.MF_Circle2=true;thisClass.loadedComponentCode.MF_BYOC=true;thisClass.loadedComponentCode.MF_Text=true;thisClass.loadedComponentCode.MF_Arrow2=true;thisClass.loadedComponentCode.MF_Hotspot=true;thisClass.loadedComponentCode.MF_Icon=true;thisClass.loadedComponentCode.MF_Button=true;thisClass.loadedComponentCode.MF_Button2=true;thisClass.loadedComponentCode.MF_Draw=true;thisClass.loadedComponentCode.MF_Rectangle2=true;thisClass.loadedComponentCode.MF_AdvancedDataGrid=true;thisClass.loadedComponentCode.MF_Note=true;thisClass.loadedComponentCode.MF_Callout=true;thisClass.loadedComponentCode.MF_VerticalBracket=true;thisClass.loadedComponentCode.MF_Arrow=true;thisClass.loadedComponentCode.MF_Tooltip=true;thisClass.loadedComponentCode.MF_ImageComp=true;thisClass.loadedComponentCode.MF_ArrowPath=true;$("#mfFontSearchBox").keyup(function(e){if(e.keyCode==13){thisClass.searchFontsHandler(e);}});$("#mfIconListSearchBox").on("textchange",thisClass.searchIconHandler);$("#mfSvgIconListSearchBox").on("textchange",thisClass.searchSvgHandler2);$("#mfSvgIllustrationListSearchBox").on("textchange",thisClass.searchIllustrationHandler2);$("#mfSvgIconListSearchBox").keyup(function(e){if(e.keyCode==13){thisClass.searchSvgHandler(e);}});$("#mfSvgIllustrationListSearchBox").keyup(function(e){if(e.keyCode==13){thisClass.searchIllustrationHandler(e);}});$("#mfComponentSearchBox").on("textchange",thisClass.searchComponentHandler);$("#mfComponentSearchBox").keyup(function(e){if(e.keyCode==13){thisClass.addComponentHandler(e);}});$("#mfCategoryListSearchClearBtn").on("click",function(e){$("#mfCategoryListSearchBox").val("");thisClass.searchCategoryHandler();});$("#mfCategoryListSearchBox").on("textchange",thisClass.searchCategoryHandler);$(".mfCategoryListingCloseBtn").on("click",mf_main.closeDialog);$("#mfCompCategoryListing").on("click",mf_main.closeDialog);$("#mfProjectUIPackBtn").on("click",thisClass.openSavedComponents);$("#mfSortMergeablePackBtn").on("click",thisClass.sortMergeablePackHandler);$(".mfSwitchPackCls").on("click",function(e){if(e){e.preventDefault();e.stopImmediatePropagation();}if($("#mfCompCategoryDialog").css("display")=="none"){thisClass.openPackListing();}else{mf_main.closeDialog();}});$(".mfNewMergePackBtn").on("click",function(e){$(".mfCompCategoryTitleCls").hide();$("#mfNewMergePackForm, #mfMergePackTitle").show();thisClass.mergeablePackMode=true;thisClass.isNewMergePack=true;thisClass.listCategoriesHandler();$(".mfComponentCategoryItemCls .mfMergeablePackCheckBox").prop("checked",false);$("#mfCompCategoryListing, #mfCompCategoryEmptyPlaceholder").height($(currentWindow).height()-($("#mfCompCategoryHeader").outerHeight()+$("#mfNewMergePackForm").outerHeight()));});$("#mfOrganisePackBtn").on("click",function(e){if($("#mfCompCategoryDialog").css("display")=="none"){$("#mfNewMergePackForm, .mfCompCategoryTitleCls").hide();$("#mfOrganizePackTitle").show();thisClass.isNewMergePack=false;thisClass.mergeablePackMode=true;thisClass.listCategoriesHandler();}else{mf_main.closeDialog();}});thisClass.applyTextTemplate();thisClass.applyIconTemplate();$("#mfIconListBtn2,#mfNavIconsBtn").on("click",function(e){if($("#mfSvgIconSelectionPopUp").css("display")=="block"){$("#mfSvgIconSelectionPopUp").hide();}else{mf_main.editorController.clearSelection(true);thisClass.addIconMode=true;thisClass.svgIconListHandler(e);}});$("#mfIllustrationListBtn2,#mfNavIllustrationsBtn").on("click",function(e){if($("#mfSvgIllustrationSelectionPopUp").css("display")=="block"){$("#mfSvgIllustrationSelectionPopUp").hide();}else{mf_main.editorController.clearSelection(true);thisClass.addIconMode=true;thisClass.svgIllustrationListHandler(e);}});$("#mfIconListModal .mfModalClose").on("click",function(){$("#mfIconListModal").modal("hide");});$("#mfMergeablePackMoveTopBtn").on("click",thisClass.moveToTopHandler);$("#mfMergeablePackMoveBottomBtn").on("click",thisClass.moveToBottomHandler);$("#mfComponentSearchFilterTrigger,#mfComponentSearchFilterDisplay").on("click",function(){if($(".mfPackFiltersMenuWrapper").hasClass("mfPackFiltersMenuWrapperShow")){$(".mfPackFiltersMenuWrapper").removeClass("mfPackFiltersMenuWrapperShow");}else{$(".mfPackFiltersMenuWrapper").addClass("mfPackFiltersMenuWrapperShow");}});$(".mfPackFiltersMenuWrapper,#mfComponentSearchFilterTrigger,#mfComponentSearchFilterDisplay").mouseleave(function(e){if(!$(e.relatedTarget).hasClass("mfPackFiltersMenuWrapper")&&!$(e.relatedTarget).hasClass("mfPackFiltersMenuContainer")&&$(e.relatedTarget).attr("id")!="mfComponentSearchFilterTrigger"&&$(e.relatedTarget).attr("id")!="mfComponentSearchFilterDisplay"&&!$(e.relatedTarget).hasClass("mfComponentSearchWrapper")){$(".mfPackFiltersMenuWrapper").removeClass("mfPackFiltersMenuWrapperShow");}});};this.openPackListing=function(){$("#mfNewMergePackForm, .mfCompCategoryTitleCls, .mfPopUp").hide();$("#mfCompListingTitle").show();thisClass.isNewMergePack=false;thisClass.mergeablePackMode=false;thisClass.listCategoriesHandler();$("#mfCompCategoryDialog").height($(currentWindow).height()-mf_main.editorController.videoChatInterfaceHeight);};this.listRecentComponentPacks=function(narr){var cachedTemplate=mf_main.getTemplateFromCache("mfPackRecentTemplate");if(cachedTemplate==null){var template=Handlebars.compile($("#mfPackRecentTemplate").html());mf_main.addTemplateToCache("mfPackRecentTemplate",template);thisClass.renderRecentPackItems(narr,template);}else{thisClass.renderRecentPackItems(narr,cachedTemplate);}};this.renderRecentPackItems=function(arr,template){var htmldom="";arr=arr.reverse();var maxcount=5;var tempobj=new Object();var ncount=0;for(var n=0;n<arr.length;n++){var citem=arr[n];var allow=true;if(mf_main.DESIGNMODE){}if(allow){var pid=citem.id;if(citem.builtInID){pid=citem.packId;}if(!tempobj[pid]){tempobj[pid]=true;if(thisClass.recentPacks[pid]){maxcount--;}ncount++;}}if(ncount==5){break;}}if(maxcount>0){$("#mfCompRecentPackList").empty();tempobj=new Object();var count=0;var isfeatured=false;for(var n=0;n<arr.length;n++){var citem=arr[n];var allow=true;if(mf_main.DESIGNMODE){}if(allow){var pid=citem.id;if(citem.builtInID){pid=citem.packId;}if(!tempobj[pid]){tempobj[pid]=true;if(pid=="featured"||mf_main.DESIGNMODE){isfeatured=true;}if(count==4&&isfeatured==false){htmldom=htmldom+template(thisClass.catids.featured);thisClass.recentPacks.featured=true;}else{htmldom=htmldom+template(citem);thisClass.recentPacks[pid]=true;}count++;}}if(count==5){break;}}var obj=new Object();obj.id="sprecentpackadd";obj.name="More Packs...";obj.add=true;htmldom=htmldom+template(obj);$("#mfCompRecentPackList").append(htmldom);$(".mfCompRecentPackItem").tooltip({animation:false});$(".mfCompRecentPackItem").off("click");$(".mfCompRecentPackItem").on("click",thisClass.loadRecentPack);$(".mfCompRecentPackItem[data-id='"+thisClass.currentCategory+"']").addClass("recentactive");}};this.loadRecentPack=function(e){e.preventDefault();e.stopImmediatePropagation();var cid=$(this).attr("data-id");if(cid=="sprecentpackadd"){if($("#mfCompCategoryDialog").css("display")=="none"){thisClass.openPackListing();}else{mf_main.closeDialog();}}else{thisClass.viewCategory(cid,this);}};this.applyThemeTemplate=function(type,arr){if(mf_main.RENDER||mf_main.PUBLIC){return;}var cachedTemplate=mf_main.getTemplateFromCache("CompThemeItemTemplate");if(cachedTemplate==null){$.get("templates/editor/CompThemeItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#CompThemeItemTemplate").html());mf_main.addTemplateToCache("CompThemeItemTemplate",template);thisClass.renderThemeItems(template,type,arr);});}else{thisClass.renderThemeItems(cachedTemplate,type,arr);}};this.renderThemeItems=function(template,type,arr){$("#mfThemeSelectionList").empty();var htmldom="";for(i=0;i<arr.length;i++){var themeObj=arr[i];themeObj.thumbnail=MF_Global.getS3CdnURL()+"app/wireframepro/dbcomponents/thumbnails/"+themeObj.id+".png";htmldom=htmldom+template(themeObj);}$("#mfThemeSelectionList").append(htmldom);$(".mfThemeItemCls").off("click",thisClass.themeItemClick);$(".mfThemeItemCls").on("click",thisClass.themeItemClick);$("#mfThemeModalLoader").hide();$("#mfThemeSelectionList").show();};this.themeItemClick=function(e){var cid=$(this).attr("data-id");var ctype=$(this).attr("data-type");var comp=null;if(mf_main.editorController.selectorResize&&mf_main.editorController.selectorResize.selector){comp=mf_main.editorController.selectorResize.selector.component;}if(comp){if(thisClass.cachedThemeComponents[cid]){$("#mfThemeSelectionPopUp").hide();thisClass.importThemeComponent(thisClass.cachedThemeComponents[cid].data,comp);}else{$("#mfThemeModalLoader").show();$("#mfThemeSelectionList").hide();MF_WireframeStoreManager.loadDBComponent(cid,mf_main.editorController.projectObj,{callback:function(dbComponent){$("#mfThemeModalLoader").hide();$("#mfThemeSelectionList").show();$("#mfThemeSelectionPopUp").hide();if(dbComponent){thisClass.cachedThemeComponents[cid]=dbComponent;thisClass.importThemeComponent(dbComponent.data,comp);}}});}}};this.importThemeComponent=function(dbcomponent,comp){var compxml=null;var jData=$(dbcomponent);jData.find("component").each(function(){compxml=$(this);});var component=mf_main.componentList.invokeComponent(comp.NAME);component.e2xml.settingsXML=compxml;component.e2xml.applySettings();var undoarr=new Array();for(var key in component.e2xml.settings.properties){var doNotPass=thisClass.filterProp[key];if(key=="icon"&&component.e2xml.settings.properties[key]!=null&&component.e2xml.settings.properties[key]!=""){doNotPass=false;}if(!doNotPass){var cval=component.e2xml.settings.properties[key];var undo=new MF_UndoDAO();if(Array.isArray(cval)){undo.propArrayUndo(comp,key,comp[key]);}else{if((typeof cval==="object"||typeof cval==="function")&&(cval!==null)){undo.propObjectUndo(comp,key,comp[key]);}else{undo.propSingleUndo(comp,key,comp[key]);}}if(Array.isArray(cval)){comp.e2xml.addPropArray(key,cval,"String","default");}else{if((typeof cval==="object"||typeof cval==="function")&&(cval!==null)){comp.e2xml.addPropObject(key,cval,"default");}else{comp.e2xml.addPropSingle(key,cval,"default");}}undoarr[undoarr.length]=undo;}}for(var key in component.e2xml.settings.styles){if(!thisClass.filterProp[key]){var cval=component.e2xml.settings.properties[key];var undo=new MF_UndoDAO();if(Array.isArray(cval)){undo.styleArrayUndo(comp,key,comp[key]);}else{if((typeof cval==="object"||typeof cval==="function")&&(cval!==null)){undo.styleObjectUndo(comp,key,comp[key]);}else{undo.styleSingleUndo(comp,key,comp[key]);}}if(Array.isArray(cval)){comp.e2xml.addStyleArray(key,cval,"String","default");}else{if((typeof cval==="object"||typeof cval==="function")&&(cval!==null)){comp.e2xml.addStyleArray(key,cval,"default");}else{comp.e2xml.addStyleSingle(key,cval,"default");}}undoarr[undoarr.length]=undo;}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);meta.reselectMeta=true;undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}MF_ChangeManager.CHANGED(true);comp.render(true);mf_main.editorController.reStackComponents();mf_main.editorController.lastSetting=null;mf_main.editorController.openSetting(comp.selector);};this.getThemeObj=function(ctype,cid){var arr=thisClass.compTemplates[ctype];if(arr){for(var j=0;j<arr.length;j++){var cobj=arr[j];if(cobj.id==cid){return cobj;}}}return null;};this.listThemeTemplates=function(type){if(thisClass.compTemplates[type]){if(thisClass.lastTemplate!=type){thisClass.lastTemplate=type;$("#mfThemeModalLoader").show();$("#mfThemeSelectionList").hide();thisClass.applyThemeTemplate(type,thisClass.compTemplates[type]);}else{$("#mfThemeModalLoader").hide();$("#mfThemeSelectionList").show();}}else{$("#mfThemeModalLoader").show();$("#mfThemeSelectionList").hide();MF_WireframeStoreManager.listThemeComponents(type,{callback:function(arr){thisClass.lastTemplate=type;thisClass.compTemplates[type]=arr;thisClass.applyThemeTemplate(type,arr);}});}};this.startIntersectionObserver=function(entries){try{thisClass.stopIntersectionObserver();if(mf_main.editorController.VISIBLE_OBSERVE){var comps=null;comps=document.querySelectorAll("#mfEditorComponents .mfComponentThumbItemCls");const config={threshold:0,root:document.getElementById("mfEditorComponents"),rootMargin:"100px"};if("IntersectionObserver" in window){thisClass.iobserver=new IntersectionObserver(thisClass.onIntersection,config);comps.forEach(function(com){thisClass.iobserver.observe(com);});}}}catch(e){}};this.stopIntersectionObserver=function(entries){try{if(mf_main.editorController.VISIBLE_OBSERVE&&thisClass.iobserver){thisClass.iobserver.disconnect();thisClass.iobserver=null;}}catch(e){}};this.onIntersection=function(entries){entries.forEach(function(entry){if(entry.isIntersecting){$("#"+entry.target.id).attr("src",$("#"+entry.target.id).attr("data-src"));if(thisClass.iobserver){thisClass.iobserver.unobserve(entry.target);}}else{}});};this.startIconIntersectionObserver=function(svgImages,svgListing){try{thisClass.stopIconIntersectionObserver();if(mf_main.editorController.VISIBLE_OBSERVE){var comps=null;comps=document.querySelectorAll(svgImages);const config={threshold:0,root:document.getElementById(svgListing),rootMargin:"100px"};if("IntersectionObserver" in window){thisClass.iconObserver=new IntersectionObserver(thisClass.onIconIntersection,config);comps.forEach(function(com){thisClass.iconObserver.observe(com);});}}}catch(e){}};this.startIllustrationIntersectionObserver=function(svgImages,svgListing){try{thisClass.stopIllustrationIntersectionObserver();if(mf_main.editorController.VISIBLE_OBSERVE){var comps=null;comps=document.querySelectorAll(svgImages);const config={threshold:0,root:document.getElementById(svgListing),rootMargin:"100px"};if("IntersectionObserver" in window){thisClass.illustrationObserver=new IntersectionObserver(thisClass.onIllustrationIntersection,config);comps.forEach(function(com){thisClass.illustrationObserver.observe(com);});}}}catch(e){}};this.stopIconIntersectionObserver=function(entries){try{if(mf_main.editorController.VISIBLE_OBSERVE&&thisClass.iconObserver){thisClass.iconObserver.disconnect();thisClass.iconObserver=null;}}catch(e){}};this.stopIllustrationIntersectionObserver=function(entries){try{if(mf_main.editorController.VISIBLE_OBSERVE&&thisClass.illustrationObserver){thisClass.illustrationObserver.disconnect();thisClass.illustrationObserver=null;}}catch(e){}};this.onIconIntersection=function(entries){entries.forEach(function(entry){if(entry.isIntersecting){$(entry.target).attr("src",$(entry.target).attr("data-src"));$(entry.target).css("visibility","visible");if(thisClass.iconObserver){thisClass.iconObserver.unobserve(entry.target);}}else{}});};this.onIllustrationIntersection=function(entries){entries.forEach(function(entry){if(entry.isIntersecting){$(entry.target).attr("src",$(entry.target).attr("data-src"));$(entry.target).css("visibility","visible");if(thisClass.illustrationObserver){thisClass.illustrationObserver.unobserve(entry.target);}}else{}});};this.listCategoriesHandler=function(){$("#mfCompCategoryDialog").show();$(".mfCompPackCls").hide();$("#mfCompPackListDiv").show();$("#mfCategoryListSearchBox").focus();mf_main.interfaceResize();thisClass.listCategories();};this.loadSortPacks=function(sorttxt){if(sorttxt==null){return;}var packlistarr=sorttxt.split("--__--");for(var n=0;n<packlistarr.length;n++){var packarr=packlistarr[n].split("--||--");thisClass.sortPacks[packarr[0]]=parseInt(packarr[1]);}};this.openSavedComponents=function(){mf_main.editorController.openNavBarContent("mfNavElementBtn");if(thisClass.currentCategory==mf_main.editorController.projectObj.id&&thisClass.previousCategory!=null){thisClass.viewCategory(thisClass.previousCategory.id,thisClass.previousCategory.mockstore);}else{thisClass.viewCategory(mf_main.editorController.projectObj.id,"no");}};this.openSavedComponents2=function(){mf_main.editorController.openNavBarContent("mfNavElementBtn");thisClass.viewCategory(mf_main.editorController.projectObj.id,"no");};this.sortComponentPacks=function(){var rarr=new Array();var scount=Object.keys(thisClass.sortPacks).length;if(scount<=1){for(var p=0;p<thisClass.defaultSortOrder.length-1;p++){scount++;if(!thisClass.sortPacks[thisClass.defaultSortOrder[p]]){thisClass.sortPacks[thisClass.defaultSortOrder[p]]=scount;}}}var numarr=new Array();var sortobj=new Object();for(var key in thisClass.sortPacks){if(thisClass.sortPacks.hasOwnProperty(key)){var num=thisClass.sortPacks[key];if(sortobj[num]){sortobj[num]=sortobj[num]+","+key;}else{numarr.push(num);sortobj[num]=key;}}}numarr=numarr.sort(function(a,b){return b-a;});var len=numarr.length;for(i=0;i<=len-1;i++){var nu=numarr[i];if(sortobj[nu]){var catarr=(sortobj[nu]).split(",");for(var k=0;k<catarr.length;k++){var sk=catarr[k];if($("#mfComponentCategoryItem_"+sk).length==0){var ckObj=thisClass.switchMockStoreCats[sk];if(ckObj){rarr.push(ckObj);sk=ckObj.id;if(sk!="common"&&sk!="featured"){if($("#mfComponentCategoryItem_"+sk).length==0){var cobj=thisClass.idToPackidCats[sk];if(cobj){$("#mfComponentCategoryItem_"+cobj.packId).insertAfter(".mfComponentCategoryItemCls:eq(0)");}}else{$("#mfComponentCategoryItem_"+sk).insertAfter(".mfComponentCategoryItemCls:eq(0)");}}}else{var cobj=thisClass.packidToIdCats[sk];if(cobj){rarr.push(cobj);sk=cobj.id;if(sk!="common"&&sk!="featured"){$("#mfComponentCategoryItem_"+sk).insertAfter(".mfComponentCategoryItemCls:eq(0)");}}}}else{rarr.push(thisClass.catids[sk]);if(sk!="common"&&sk!="featured"){$("#mfComponentCategoryItem_"+sk).insertAfter(".mfComponentCategoryItemCls:eq(0)");}}}}}thisClass.listRecentComponentPacks(rarr);};this.unloadSortPacks=function(){var str="";var count=0;for(var key in thisClass.sortPacks){if(thisClass.sortPacks.hasOwnProperty(key)){if(count==0){str=key+"--||--"+thisClass.sortPacks[key];}else{str=str+"--__--"+key+"--||--"+thisClass.sortPacks[key];}count++;}}return str;};this.addCategories=function(){var cat=null;if(mf_main.DESIGNMODE){cat=new MF_CompCategory();cat.id="M2f6e06c70a6d9395d1a0239c4c0d40a21695832585913";cat.name="Designer";cat.mockstore=true;cat.packId="M30d40c40787d14617e5d5b0891914c871695830318516___DBPACK";cat.modeType="designmode";thisClass.categories.push(cat);thisClass.defaultSortOrder.push(cat.packId);cat=new MF_CompCategory();cat.id="Ma075999a4338333eed91b3af8ac6507f1583824829811";cat.name="Mockup UI";cat.mockstore=true;cat.packId="Mc711c63114df7b779703af95c7bc8e481583760971668___DBPACK";cat.modeType="designmode";thisClass.categories.push(cat);thisClass.defaultSortOrder.push(cat.packId);cat=new MF_CompCategory();cat.id="Ma904dc78e1616358fca229ba358768ce1684242036468";cat.name="Social Media Icons";cat.mockstore=true;cat.packId="M810e0c53edf1adabd663c3b68d7a1b361683784290695___DBPACK";cat.modeType="designmode";thisClass.categories.push(cat);thisClass.defaultSortOrder.push(cat.packId);}cat=new MF_CompCategory();cat.id="featured";cat.name="Common";thisClass.previousCategory=cat;cat.modeType="designmode";thisClass.categories.push(cat);cat=new MF_CompCategory();cat.id="M49270c72ac9a5c50820d0651a62fbf421539449954731";cat.name="Web";cat.mockstore=true;cat.builtInID="web";cat.packId="M17ac9d1dc782ea73c432aa88d6e6726c1537857491098___DBPACK";if(!mf_main.DESIGNMODE){thisClass.categories.push(cat);thisClass.defaultSortOrder.push(cat.packId);}cat=new MF_CompCategory();cat.id="Mb5e8dbe1803d50e58218427a9a54d0871539450051755";cat.name="Hand drawn UI";cat.mockstore=true;cat.builtInID="sketchui";cat.packId="Mecfc78553b6b326413c659187de41a2c1537857472982___DBPACK";if(!mf_main.DESIGNMODE){thisClass.categories.push(cat);thisClass.defaultSortOrder.push(cat.packId);}cat=new MF_CompCategory();cat.id="M8109b08cbb31f7575d869e0b164269401681294000748";cat.name="Block Style UI";cat.mockstore=true;cat.packId="M7a9cf8eac6f3a5325564c2b7ce82e6e41681220420039___DBPACK";if(!mf_main.DESIGNMODE){thisClass.categories.push(cat);thisClass.defaultSortOrder.push(cat.packId);}cat=new MF_CompCategory();cat.id="M2fd5038689df5c920de12cabe83f90ad1539450641673";cat.name="Annotate";cat.mockstore=true;cat.builtInID="annotate";cat.packId="M8cd08cce4dcef8e027f26b7d125f72421537857472071___DBPACK";if(!mf_main.DESIGNMODE){thisClass.categories.push(cat);thisClass.defaultSortOrder.push(cat.packId);}cat=new MF_CompCategory();cat.id="Md69a1267a7b8a06b40bf05d54c7166a91539450768124";cat.name="Shapes";cat.mockstore=true;cat.builtInID="shapes";cat.packId="Me63cac5ddc9fb59f950fe01e81b3d78e1537857471131___DBPACK";cat.modeType="designmode";thisClass.categories.push(cat);thisClass.defaultSortOrder.push(cat.packId);cat=new MF_CompCategory();cat.id="Mc2c0862db0b8d1e8d5d5785fc6a85e091539450885782";cat.name="Text";cat.mockstore=true;cat.builtInID="text";cat.packId="M52e0fa1d3232db016a8f3047c5a4a4d71537857465304___DBPACK";if(!mf_main.DESIGNMODE){thisClass.categories.push(cat);thisClass.defaultSortOrder.push(cat.packId);}cat=new MF_CompCategory();cat.id="Mc5be8d0cd3a2bacfd8b5251297ffd23e1539594657777";cat.name="Containers";cat.mockstore=true;cat.builtInID="containers";cat.packId="M05c58be7d078374f3c5a4ab05a82fdf91537857464373___DBPACK";if(!mf_main.DESIGNMODE){thisClass.categories.push(cat);thisClass.defaultSortOrder.push(cat.packId);}cat=new MF_CompCategory();cat.id="M44b5d27e367c7af416fd816e220b2b5d1539451161393";cat.name="Navigation";cat.mockstore=true;cat.builtInID="navigation";cat.packId="Md2f5ce12502eaa7edd60e7d79f63d30f1537857462221___DBPACK";if(!mf_main.DESIGNMODE){thisClass.categories.push(cat);thisClass.defaultSortOrder.push(cat.packId);}cat=new MF_CompCategory();cat.id="M88b691cd1c093121087b4772f40e9b841539451237497";cat.name="Form";cat.mockstore=true;cat.builtInID="form";cat.packId="M62793c0dfc9704d4a58e5ce38f56c0231537857457306___DBPACK";if(!mf_main.DESIGNMODE){thisClass.categories.push(cat);thisClass.defaultSortOrder.push(cat.packId);}cat=new MF_CompCategory();cat.id="M329ecab5dd154c68ef88abfde0ea25381539451317276";cat.name="Flowchart";cat.mockstore=true;cat.builtInID="flowchart";cat.packId="M8d10ed78314bb3ef470a463455b1adfd1537857430272___DBPACK";if(!mf_main.DESIGNMODE){thisClass.categories.push(cat);thisClass.defaultSortOrder.push(cat.packId);}cat=new MF_CompCategory();cat.id="M2c28bbc7d4efa9eec78e2372cf4277e51640780654410";cat.name="Bootstrap 5";cat.mockstore=true;cat.packId="M03b7e69c3c362c6fa4c9e80a934c3b6c1640068766067___DBPACK";if(!mf_main.DESIGNMODE){thisClass.categories.push(cat);thisClass.defaultSortOrder.push(cat.packId);}cat=new MF_CompCategory();cat.id="M4154b31972411666bb02be3978ce72611664643823021";cat.name="Material 3";cat.mockstore=true;cat.packId="M35375fc575b813649112813385220f091664514859444___DBPACK";if(!mf_main.DESIGNMODE){thisClass.categories.push(cat);thisClass.defaultSortOrder.push(cat.packId);}cat=new MF_CompCategory();cat.id="M0c6a682ddaedebcad407470060b5da971656074110469";cat.name="iPhone iOS 16";cat.mockstore=true;cat.packId="Mb7939a6172699b5c83b4bcea03d7ea6f1655880561644___DBPACK";if(!mf_main.DESIGNMODE){thisClass.categories.push(cat);thisClass.defaultSortOrder.push(cat.packId);}cat=new MF_CompCategory();cat.id="M2d676e90f637be8ea5fe1880e91be7e41657248077301";cat.name="iPadOS 16";cat.mockstore=true;cat.packId="M94db4c1c3dd015e57fd5d4dc623863da1657011983438___DBPACK";if(!mf_main.DESIGNMODE){thisClass.categories.push(cat);thisClass.defaultSortOrder.push(cat.packId);}cat=new MF_CompCategory();cat.id="Mf8cb67d289aaf1dae74e73260af814731669358440149";cat.name="Android 13";cat.type=["all","devices"];cat.mockstore=true;cat.packId="Mf36d85a2c9c1e12bc7bc75182fcabae31669294225237___DBPACK";if(!mf_main.DESIGNMODE){thisClass.categories.push(cat);thisClass.defaultSortOrder.push(cat.packId);}cat=new MF_CompCategory();cat.id="M3366de42224c7185e9ea0afbc8f7a79d1622720896435";cat.name="Apple watchOS 7";cat.mockstore=true;cat.packId="M3495b1eb26d595a9740a55051cfca15f1622696568884___DBPACK";if(!mf_main.DESIGNMODE){thisClass.categories.push(cat);}cat=new MF_CompCategory();cat.id="M1c0c1ba73938395ede5cc027a90424541623918553096";cat.name="Apple tvOS 14";cat.mockstore=true;cat.packId="M51074d5da2b3d9b80948c6643c2e384c1623903829985___DBPACK";if(!mf_main.DESIGNMODE){thisClass.categories.push(cat);}cat=new MF_CompCategory();cat.id="Md28d3eb382c49acd3c90e11f8678569a1539493537710";cat.name="Stamps";cat.mockstore=true;cat.builtInID="stamps";cat.packId="Mcac0d9148799dbf14dcc5394031200d11537856646599___DBPACK";cat.modeType="designmode";thisClass.categories.push(cat);if(mf_main.DESIGNMODE){thisClass.defaultSortOrder.push(cat.packId);}cat=new MF_CompCategory();cat.id="Meaa43ebef373ee5281db35697a4c586d1539493612291";cat.name="Browser Frames";cat.mockstore=true;cat.builtInID="browserframe";cat.packId="M445bd8013967e42c288a6828b8b15e2f1537856635536___DBPACK";if(!mf_main.DESIGNMODE){thisClass.categories.push(cat);}cat=new MF_CompCategory();cat.id="M9b233189b2891469815f530e3d402afc1539493690499";cat.name="Special Buttons";cat.mockstore=true;cat.builtInID="specialbuttons";cat.packId="M094cec7ffb67fb65f0c73dc9f1d006251537856615897___DBPACK";cat.modeType="designmode";thisClass.categories.push(cat);if(mf_main.DESIGNMODE){thisClass.defaultSortOrder.push(cat.packId);}cat=new MF_CompCategory();cat.id="M76f72072f4c50f3d34fd200fbff3d2f91539493760448";cat.name="Maps";cat.mockstore=true;cat.builtInID="maps";cat.packId="M2563fd66c28053afdf4b8cfe0a39d9491537856594316___DBPACK";if(!mf_main.DESIGNMODE){thisClass.categories.push(cat);}cat=new MF_CompCategory();cat.id="M8477c9540a851746fe2b85eb4f4460ba1539493827058";cat.name="Charts";cat.mockstore=true;cat.builtInID="charts";cat.packId="M52b10cfe5fb8f8e4de204471f0aecafd1537856587455___DBPACK";cat.modeType="designmode";thisClass.categories.push(cat);if(mf_main.DESIGNMODE){thisClass.defaultSortOrder.push(cat.packId);}cat=new MF_CompCategory();cat.id="M5bb90c8b6084d437ef9459f88aba42ac1539493900241";cat.name="Windows 10 Desktop";cat.mockstore=true;cat.builtInID="windows10desktop";cat.packId="M1132680526361f1b86bc56244a49c04d1537856555516___DBPACK";if(!mf_main.DESIGNMODE){thisClass.categories.push(cat);}cat=new MF_CompCategory();cat.id="Mfb53a1f544905a48e946ba3720a2ba561675081684186";cat.name="Windows 11";cat.type=["all","devices"];cat.mockstore=true;cat.packId="M1c3afd0b63449289d4cd6ce1dbe632951674825462922___DBPACK";if(!mf_main.DESIGNMODE){thisClass.categories.push(cat);thisClass.defaultSortOrder.push(cat.packId);}cat=new MF_CompCategory();cat.id="Mdbf39f47e044e9ddc5212a6fb4e438ae1675937231531";cat.name="mac OS 13";cat.type=["all","devices"];cat.mockstore=true;cat.packId="Mb91895177c936b15e2cf8cf5cf475a351675860224885___DBPACK";if(!mf_main.DESIGNMODE){thisClass.categories.push(cat);thisClass.defaultSortOrder.push(cat.packId);}cat=new MF_CompCategory();cat.id="Mc9e4c49a89d46d4baf0b764ece8eb3601539495428303";cat.name="Avatars";cat.mockstore=true;cat.builtInID="avatars";cat.packId="Me1cd255767f83e92d0191a80360cc4791537856326489___DBPACK";cat.modeType="designmode";thisClass.categories.push(cat);if(mf_main.DESIGNMODE){thisClass.defaultSortOrder.push(cat.packId);}cat=new MF_CompCategory();cat.id="M626f2582251e52c5c1235effd5e950661697815930234";cat.name="Text Styles";cat.mockstore=true;cat.packId="Mb6afe00036a17a3472b0be719e4a12911697809423922___DBPACK";cat.modeType="designmode";if(mf_main.DESIGNMODE){thisClass.categories.push(cat);thisClass.defaultSortOrder.push(cat.packId);}cat=new MF_CompCategory();cat.id="Maa73c3c320c65d4abdeb838c14d3524a1539496005676";cat.name="Emoji";cat.mockstore=true;cat.builtInID="emoji";cat.packId="Mce64991c62a4e689eb2d70a64430330d1537855793488___DBPACK";cat.modeType="designmode";thisClass.categories.push(cat);if(mf_main.DESIGNMODE){thisClass.defaultSortOrder.push(cat.packId);}for(var p=0;p<thisClass.categories.length;p++){var cobj=thisClass.categories[p];if(cobj.mockstore){var allow=true;if(mf_main.DESIGNMODE){if(cobj.modeType!="designmode"){allow=false;}}if(allow){thisClass.switchMockStoreCats[cobj.builtInID]=cobj;thisClass.packidToIdCats[cobj.packId]=cobj;thisClass.idToPackidCats[cobj.id]=cobj;}}}};this.listCategories=function(){if(mf_main.RENDER||mf_main.PUBLIC){return;}$(".mfCompPackCls").hide();$("#mfCompPackListDiv").show();if(thisClass.categoryListed==true){thisClass.updatePackSelectionHandler();return;}thisClass.categoryListed=true;var cachedTemplate=mf_main.getTemplateFromCache("mfComponentCategoryItemTemplate");if(cachedTemplate==null){var template=Handlebars.compile($("#mfComponentCategoryItemTemplate").html());mf_main.addTemplateToCache("mfComponentCategoryItemTemplate",template);thisClass.renderCategoryItems(template);}else{thisClass.renderCategoryItems(cachedTemplate);}$("#mfCategoryListSearchBox").val("");};this.updatePackSelectionHandler=function(){if(thisClass.mergeablePackMode==true){$(".mfMergeablePackSelection").show();if(thisClass.isNewMergePack==false){$("#mfMergePackBtn").show();}$("#mfAddPackDiv,.mfPackEditBtnCls,.mfPackDelBtnCls").hide();$("#mfComponentCategoryItem_featured").find(".mfMergeablePackCheckBox").remove();$(".mfMergeablePackCheckBox").prop("checked",false);var mPackData=thisClass.mergeablePackData;for(i=0;i<mPackData.length;i++){$("#mfMergeItem_"+mPackData[i].id).prop("checked",true);}}else{$(".mfMergeablePackSelection,#mfMergePackBtn").hide();$("#mfAddPackDiv,.mfPackEditBtnCls,.mfPackDelBtnCls").show();}};this.renderCategoryItems=function(template){$("#mfCompCategoryListing").empty();var i=0;var len=thisClass.categories.length;var htmldom="";var catids=new Object();var n=0;for(n=0;n<=len-1;n++){var catObj=thisClass.categories[n];catids[catObj.id]=catObj;}thisClass.catids=catids;for(i=0;i<=len-1;i++){var catObj=thisClass.categories[i];catObj.mergeablePackMode=thisClass.mergeablePackMode;var allowlist=thisClass.checkOutDatedPacks(catObj.id);if(catObj.mockstore){if(catids[catObj.packId]){allowlist=false;var tempObj=catids[catObj.packId];if(tempObj){tempObj.noAllowDelete=true;}}if(thisClass.mergeablePackMode){allowlist=false;}}if(mf_main.DESIGNMODE){if(catObj.modeType!="designmode"){allowlist=false;}}if(allowlist==true){htmldom=htmldom+template(catObj);}}$("#mfCompCategoryListing").append(htmldom);thisClass.categoryCommonEvents();};this.switch2MockStorePack=function(chkid){if(thisClass.switchMockStoreCats[chkid]){thisClass.currentCategoryObj=thisClass.switchMockStoreCats[chkid];return thisClass.switchMockStoreCats[chkid].packId;}return chkid;};this.checkOutDatedPacks=function(chkid){var outdated=["android7","iphone_ios10","ipad_ios10","bootstrap3"];var checkCategory=false;var allowlist=true;for(var k=0;k<outdated.length;k++){if(chkid==outdated[k]){checkCategory=true;break;}}if(checkCategory){allowlist=false;for(var key in thisClass.sortPacks){if(key==chkid){allowlist=true;break;}}if(mf_main.editorController.projectObj.category==chkid){allowlist=true;}}return allowlist;};this.getCustomPacks=function(){if(mf_main.PINPOWERUP){return;}if(mf_main.PUBLIC){return;}if(mf_main.DESIGNMODE){thisClass.updatePackSelectionHandler();thisClass.sortComponentPacks();thisClass.packListLoaded=true;}else{thisClass.packListLoaded=false;$("#mfCompCustomPackLoader").show();MF_PackManager.getPackData(MF_UserSession.getUser(),mf_main.editorController.projectObj.id,mf_main.editorController.projectObj.company,mf_main.editorController.teamClientList,{callback:function(packdataObj){var arr=packdataObj.comppacks;var spacks=packdataObj.sortpacks;if(spacks&&mf_main.editorController.projectObj&&mf_main.editorController.projectObj.category&&spacks.indexOf(mf_main.editorController.projectObj.category+"--||--1")==-1){spacks=mf_main.editorController.projectObj.category+"--||--1--__--"+spacks;}thisClass.loadSortPacks(spacks);$("#mfCompCustomPackLoader").hide();var i=0;var len=arr.length;for(i=0;i<=len-1;i++){var pack=new MF_CompCategory();pack.cast(arr[i]);thisClass.categories.push(pack);pack.mergeablePackMode=thisClass.mergeablePackMode;}var cachedTemplate=mf_main.getTemplateFromCache("mfComponentCategoryItemTemplate");if(cachedTemplate==null){var template=Handlebars.compile($("#mfComponentCategoryItemTemplate").html());mf_main.addTemplateToCache("mfComponentCategoryItemTemplate",template);thisClass.renderCategoryItems(template);}else{thisClass.renderCategoryItems(cachedTemplate);}thisClass.categoryListed=true;thisClass.updatePackSelectionHandler();thisClass.sortComponentPacks();thisClass.packListLoaded=true;}});}};this.categoryCommonEvents=function(e){$(".mfComponentCategoryItemCls").off("click");$(".mfComponentCategoryItemCls").on("click",thisClass.categoryItemClick);$(".mfPackEditBtnCls").off("click");$(".mfPackEditBtnCls").on("click",thisClass.categoryEditItemClick);$(".mfPackDelBtnCls").off("click");$(".mfPackDelBtnCls").on("click",thisClass.categoryDelItemClick);$(".mfMergeablePackCheckBox").on("click",thisClass.mergeableItemClick);$("#mfMergePackBtn").off("click");$("#mfMergePackBtn").on("click",thisClass.mergePackHandler);$(".lazyCatThumb").off("error");$(".lazyCatThumb").on("error",function(){$(this).hide();});$(".lazyCatThumbCustom").off("error");$(".lazyCatThumbCustom").on("error",function(){$(this).attr("src","images/editor/category/custom.png");});};this.showComponentListing=function(e){$(".mfCompListing").hide();$("#mfEditorComponentsLoader").hide();$("#mfEditorComponentsLoader").empty();$("#mfEditorComponents").show();$("#mfComponentSearchBox").val("");$("#mfComponentSearchBox").trigger("input");$("#mfComponentSearchBoxClose").hide();};this.showComponentPlaceHolder=function(e){if(!mf_main.RENDER&&mf_main.PERMISSION!="Reviewer"&&!mf_main.PUBLIC){try{$("#mfEditorComponentsLoader").empty();var componentPlaceholderCount=(Math.floor($("#mfEditorComponentsLoader").height()/$("#mfComponentPlaceHolderContent").height())-1)*2;if(componentPlaceholderCount>10||componentPlaceholderCount==null||componentPlaceholderCount==0){componentPlaceholderCount=10;}for(var i=0;i<componentPlaceholderCount;i++){$("#mfEditorComponentsLoader").append($("#mfComponentPlaceHolderContent").html());}$("#mfEditorComponentsLoader").show();$("#mfEditorComponents").hide();$("#mfEditorComponentsEmpty").hide();$("#mfComponentSearchBox").val("");$("#mfComponentSearchBoxClose").hide();}catch(e){}}};this.categoryItemClick=function(e){e.stopImmediatePropagation();if(thisClass.mergeablePackMode==true){return;}var category=null;if($("#mfCompCategoryListing .mfComponentCategoryItemCls").length==0){category=$(this).attr("data-id");}else{category=$(this).attr("id");}thisClass.viewCategory(category,this);};this.viewCategory=function(category,domvar){if(thisClass.currentCategory==category){return;}$(".mfCompRecentPackItem").removeClass("recentactive");if(thisClass.recentPacks[category]){$(".mfCompRecentPackItem[data-id='"+category+"']").addClass("recentactive");}var obj=new Object();obj.search=$("#mfComponentSearchBox").val().trim();obj.scrollpos=$("#mfEditorComponents").scrollTop();thisClass.scrollRemember[thisClass.currentCategory]=obj;category=category.replace("mfComponentCategoryItem_","");var mockstore="yes";$("#mfProjectUIPackBtn").attr("data-original-title","View Saved Components");$("#mfProjectUIPackBtn").tooltip("hide");if(domvar=="no"){mockstore="no";$("#mfCatInputTxt").text("Saved Components");$("#mfProjectUIPackBtnIcon").css("color","#666");$("#mfProjectUIPackBtn").attr("data-original-title","Close Saved Components");}else{if(domvar=="yes"){mockstore="yes";$("#mfCatInputTxt").text("");$("#mfProjectUIPackBtnIcon").css("color","#85f");}else{mockstore=$(domvar).attr("data-store");$("#mfCatInputTxt").text($(domvar).attr("data-name"));$("#mfProjectUIPackBtnIcon").css("color","#85f");}}mf_main.closeDialog();thisClass.showComponentPlaceHolder();thisClass.currentCategory=category;var allow=true;var getpackID=category;var catObj=null;for(var n=0;n<thisClass.categories.length;n++){var cat=thisClass.categories[n];if(cat.id==category){catObj=cat;break;}}if(catObj){thisClass.currentCategoryObj=catObj;if(thisClass.currentCategoryObj.mockstore){getpackID=thisClass.currentCategoryObj.packId;}}if(allow){var sortobj=new Object();var numarr=new Array();for(var key in thisClass.sortPacks){if(thisClass.sortPacks.hasOwnProperty(key)){var num=thisClass.sortPacks[key];if(sortobj[num]){sortobj[num]=key;}else{numarr.push(num);sortobj[num]=key;}}}numarr=numarr.sort(function(a,b){return a-b;});var len=numarr.length;var count=2;for(i=0;i<=len-1;i++){var nu=numarr[i];if(sortobj[nu]){thisClass.sortPacks[sortobj[nu]]=count;count++;}}thisClass.sortPacks[getpackID]=1;thisClass.addComponents(getpackID);var packsort_txt=thisClass.unloadSortPacks();if(category!=mf_main.editorController.projectObj.id){var categoryPath=getpackID;if(getpackID!="featured"&&thisClass.currentCategoryObj&&thisClass.currentCategoryObj.clientid!=null&&getpackID!=mf_main.editorController.projectObj.id){categoryPath=categoryPath+"--__--"+thisClass.currentCategoryObj.clientid;}MF_ProjectManager.updateCategory(MF_UserSession.getUser(),mf_main.editorController.projectObj.id,mf_main.editorController.projectObj.company,categoryPath,packsort_txt,{callback:function(){}});}thisClass.sortComponentPacks();}};this.categoryDelItemClick=function(e){e.stopImmediatePropagation();var category=$(this).attr("data-category");var categoryObj=null;for(var i=0;i<thisClass.categories.length;i++){var item=thisClass.categories[i];if(item.id==category){categoryObj=item;break;}}if(categoryObj){thisClass.packController.currentPack=categoryObj;thisClass.packController.deletePackHandler();}};this.categoryEditItemClick=function(e){e.stopImmediatePropagation();var category=$(this).attr("data-category");var categoryObj=null;for(var i=0;i<thisClass.categories.length;i++){var item=thisClass.categories[i];if(item.id==category){categoryObj=item;break;}}if(categoryObj){thisClass.packController.currentPack=categoryObj;thisClass.packController.openEditPackHandler();}};this.mergePackHandler=function(e){if(e){e.stopImmediatePropagation();if($(".mfComponentCategoryItemCls .mfMergeablePackCheckBox:checked").length==0){alert("No packs selected");return;}}var mPackArray=new Array();$(".mfComponentCategoryItemCls .mfMergeablePackCheckBox").each(function(indx){if($(this).prop("disabled")==false){var packId=$(this).attr("id");packId=packId.split("mfMergeItem_")[1];if($(this).prop("checked")==true){var packData=$.grep(thisClass.categories,function(e){return e.id==packId;});var mpack=new MF_MergeablePackData();mpack.id=packData[0].id;mpack.name=packData[0].name;mpack.mockstore=packData[0].mockstore;mpack.packId=packData[0].packId;mpack.mfClientId=packData[0].masterClientid;mpack.customPack=packData[0].custompack;mPackArray.push(mpack);}}});if(mPackArray!=null&&mPackArray!=""){var newMergeArray=new Array();for(var h=0;h<mPackArray.length;h++){var mitem=mPackArray[h];if(mitem.mockstore){var compCat=new Object();compCat.id=mitem.packId;compCat.mfClientId=MF_UserSession.getUser().company;compCat.customPack=true;compCat.name=mitem.name;compCat.packId=mitem.id;compCat.mockstore=false;compCat.icon="https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/uipack/"+mitem.packId+"/preview/thumb/"+mitem.packId+".png";newMergeArray.push(compCat);}else{newMergeArray.push(mitem);}}if(e){thisClass.saveMergeablePackData(JSON.stringify(newMergeArray));}else{return JSON.stringify(newMergeArray);}}return null;};this.saveMergeablePackData=function(packdata){if(packdata){if($("#mfCompCategoryListing").is(":visible")){thisClass.showComponentPlaceHolder();mf_main.closeDialog();}MF_PackManager.updateMergeablePackData(MF_UserSession.getUser(),thisClass.currentCategory,packdata,mf_main.editorController.projectObj,mf_main.editorController.teamClientList,{callback:function(result){delete thisClass.dbCategories[thisClass.currentCategory];thisClass.addComponentCallBack(thisClass.currentCategory);thisClass.categories=new Array();mf_main.componentList.categoryListed=false;thisClass.mergeablePackMode=false;thisClass.addCategories();mf_main.componentList.listCategories();}});thisClass.displayMultiSelectAction();$(".mfMergeablePackCheckboxCls").change(function(){thisClass.displayMultiSelectAction();});}};this.sortMergeablePackHandler=function(){$("#mfMergeablePackListModal").modal();thisClass.applyMergeablePackTemplate();};this.applyMergeablePackTemplate=function(){if(mf_main.RENDER||mf_main.PUBLIC){return;}var cachedTemplate=mf_main.getTemplateFromCache("mfMergeablePackItemTemplate");if(cachedTemplate==null){$.get("templates/editor/MergeablePackItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfMergeablePackItemTemplate").html());mf_main.addTemplateToCache("mfMergeablePackItemTemplate",template);thisClass.renderMergeablePackItems(template);});}else{thisClass.renderMergeablePackItems(cachedTemplate);}};this.renderMergeablePackItems=function(template){var i=0;$("#mfMergeablePackListItems").empty();var sortableItems="";var sortableCount=0;var mPackData=thisClass.mergeablePackData;var len=mPackData.length;var htmldom="";var arr=new Array();for(i=0;i<=len-1;i++){var packitem=mPackData[i];var allow=true;if(thisClass.packListLoaded){allow=false;for(var k=0;k<thisClass.categories.length;k++){var item=thisClass.categories[k];if(item.id==packitem.id){packitem.name=item.name;allow=true;break;}}}if(allow){htmldom=htmldom+template(packitem);if(sortableCount==0){sortableItems="#mfMergeablePackItem_"+packitem.id;}else{sortableItems=sortableItems+",#mfMergeablePackItem_"+packitem.id;}sortableCount++;arr.push(packitem);}}thisClass.mergeablePackData=arr;$("#mfMergeablePackListItems").append(htmldom);$(".lazyMergeablePackThumb").off("error");$(".lazyMergeablePackThumb").on("error",function(){$(this).hide();});$(".lazyMergeablePackThumbCustom").off("error");$(".lazyMergeablePackThumbCustom").on("error",function(){$(this).attr("src","images/editor/category/custom.png");});$("#mfMergeablePackListItems").sortable({items:sortableItems,placeholder:"mfPackItemPlaceholder",start:function(event,ui){$(ui.item).addClass("mfSortableActiveCls");},stop:function(event,ui){$(ui.item).removeClass("mfSortableActiveCls");thisClass.sortMergeablePackItems();}});thisClass.displayMultiSelectAction();$(".mfMergeablePackCheckboxCls").change(function(){thisClass.displayMultiSelectAction();});};this.displayMultiSelectAction=function(){var checkboxes=$(".mfMergeablePackCheckboxCls:checked");$(".mfMergeablePackSortCls").hide();if(checkboxes.length>0){$(".mfMergeablePackSortCls").show();}};this.moveToTopHandler=function(){$($(".mfMergeablePackCheckboxCls:checked").get().reverse()).each(function(){var compid=$(this).val();var prevSection=$("#mfMergeablePackItem_"+compid).prev(".mfMergeablePackItemCls").prevObject;if(prevSection.length==1){var tmpHtml=$("#mfMergeablePackItem_"+compid)[0].outerHTML;$("#mfMergeablePackItem_"+compid).remove();$("#mfMergeablePackListItems").prepend(tmpHtml);thisClass.sortMergeablePackItems();}});};this.moveToBottomHandler=function(){var checkboxes=$(".mfMergeablePackCheckboxCls:checked");checkboxes.each(function(){var compid=$(this).val();var nextSection=$("#mfMergeablePackItem_"+compid).next(".mfMergeablePackItemCls").prevObject;if(nextSection.length==1){var tmpHtml=$("#mfMergeablePackItem_"+compid)[0].outerHTML;$("#mfMergeablePackItem_"+compid).remove();$("#mfMergeablePackListItems").append(tmpHtml);thisClass.sortMergeablePackItems();}});};this.sortMergeablePackItems=function(e){var mergeablePackArray=new Array;if(thisClass.mergeablePackData.length>0){$("#mfMergeablePackListItems").children().each(function(){var packId=$(this).attr("id").split("mfMergeablePackItem_")[1];var arr=$.grep(thisClass.mergeablePackData,function(e){return e.id==packId;});mergeablePackArray.push(arr[0]);});thisClass.saveMergeablePackData(JSON.stringify(mergeablePackArray));}};this.addComponentHandler=function(e){var comp=null;if(thisClass.compArray){for(var i=0;i<thisClass.compArray.length;i++){var item=thisClass.compArray[i];if($("#mfComponentItem_"+item.n).css("display")=="block"){comp=item;break;}}}if(comp){var initoffset=mf_main.componentList.getInitOffsets();if(comp.pack){var packid=comp.packid;var masterclient=comp.masterClientid;mf_main.editorController.loadPackComponent(comp.n,initoffset.offsetXPos,initoffset.offsetYPos,packid,masterclient);}else{if(comp.db){mf_main.editorController.loadDBComponent(comp.n,initoffset.offsetXPos,initoffset.offsetYPos);}else{var comtype=comp.n;if(comtype=="MF_Rectangle"){comtype="MF_Rectangle2";}if(comtype=="MF_Button"){comtype="MF_Button2";}mf_main.componentList.invokeComponent(comtype,"new",initoffset.offsetXPos,initoffset.offsetYPos);}}}};this.searchComponentHandler=function(e){var searchval=$("#mfComponentSearchBox").val().trim();if(searchval==""){$("#mfComponentSearchBoxClose").hide();}else{$("#mfComponentSearchBoxClose").show();}searchval=searchval.toLowerCase();var itemPresent=false;var ecount=1;var lastItem=null;var lastItem2=null;if(thisClass.compArray){for(var i=0;i<thisClass.compArray.length;i++){var item=thisClass.compArray[i];if(item.l.toLowerCase().indexOf(searchval)>=0&&(thisClass.currentComponentFilter==null||thisClass.currentComponentFilter==item.filter)){$("#mfComponentItem_"+item.n).show();$("#mfComponentItem_"+item.n).css("border","none");if(lastItem){lastItem2=lastItem;}lastItem=item;itemPresent=true;ecount++;}else{$("#mfComponentItem_"+item.n).hide();}}}if(lastItem){$("#mfComponentItem_"+lastItem.n).css("border","none");}if(lastItem2){$("#mfComponentItem_"+lastItem2.n).css("border-bottom","none");}if(itemPresent==false){if(thisClass.compArray.length!=0){$(".mfCompListing").hide();$("#mfEditorComponentsEmpty").show();}}else{$(".mfCompListing").hide();$("#mfEditorComponents").show();}$("#mfEditorComponents").scrollTop(0);};this.searchCategoryHandler=function(e){var categoryPresent=false;var searchval=$("#mfCategoryListSearchBox").val().trim().toLowerCase();if(searchval==""){$("#mfCategoryListSearchClearBtn").hide();}else{$("#mfCategoryListSearchClearBtn").show();}for(var i=0;i<thisClass.categories.length;i++){var item=thisClass.categories[i];if(item.name.toLowerCase().indexOf(searchval)>=0){$("#mfComponentCategoryItem_"+item.id).show();categoryPresent=true;}else{$("#mfComponentCategoryItem_"+item.id).hide();}}$("#mfComponentCategoryItem_featured").show();if(categoryPresent){$(".mfComplCategoryCls").hide();$("#mfCompCategoryListing").show();}else{$(".mfComplCategoryCls").hide();$("#mfCompCategoryEmptyPlaceholder").show();}};this.getInitOffsets=function(){var initoffset=new Object();var offsetYPos=$("#mfContainerPage").offset().top/mf_main.editorController.SCALE;var offsetXPos=($("#mfContainerPage").offset().left/mf_main.editorController.SCALE)-(mf_main.editorController.leftMargin/mf_main.editorController.SCALE);offsetXPos=($("#mfContainerPage").offset().left/mf_main.editorController.SCALE);var scrollTop=(document.getElementById("mfEditorHolder").scrollTop/mf_main.editorController.SCALE);var scrollLeft=(document.getElementById("mfEditorHolder").scrollLeft/mf_main.editorController.SCALE);scrollTop=0;scrollLeft=0;if(offsetYPos<0){offsetYPos=-(offsetYPos);}if(offsetXPos<0){offsetXPos=-(offsetXPos);}var initPlace=mf_main.editorController.getInitialPlacement();offsetYPos=offsetYPos+scrollTop+initPlace.y;offsetXPos=offsetXPos+scrollLeft+initPlace.x;if(offsetXPos>mf_main.editorController.page.width){offsetXPos=100;}if(offsetYPos>mf_main.editorController.page.height){offsetYPos=100;}initoffset.offsetXPos=offsetXPos;initoffset.offsetYPos=offsetYPos;return initoffset;};this.searchIconHandler=function(e){$("#mfFontAwesomeCategory").val("all");$("#mfIconListing .page-header").show();$("#mfIconListing .mfIconCategory").show();$("#mfIconListing .mfIconCategory").css({position:"static"});var searchval=$("#mfIconListSearchBox").val().trim().toLowerCase();var fontArray=mf_main.editorController.fontController.icons;if(searchval==""){$("#mfIconListing h4").css("display","block");$("#mfIconListing .mfIconCategory, #mfIconListing .mfIconList").css("display","inline-block");$(".mfIconItemCls").show();return;}else{$("#mfIconListing h4").css("display","none");$("#mfIconListing .mfIconCategory, #mfIconListing .mfIconList").css("display","inline");}$(".mfIconItemCls").css("display","none");$("#mfIconListing .mfIconCategory").css("margin-bottom","0px");for(var k=0;k<fontArray.length;k++){if(fontArray[k].toLowerCase().indexOf(searchval)>=0){$("#mfIconItem"+fontArray[k]).css("display","block");}}};this.searchSvgHandler2=function(e){var svgName=$("#mfSvgIconListSearchBox").val().trim().toLowerCase();if(svgName==""){thisClass.searchSvgHandler(e);}};this.searchSvgHandler=function(e){var svgName=$("#mfSvgIconListSearchBox").val().trim().toLowerCase();var opttype=$("#mfSvgIconSearchType").val();if(svgName==""){opttype="current";}$(".mfSvgItemCls, .mfSvgIconList h3 ").hide();$(".mfSvgListWrapper:first-child").css("margin-top","0px");if(opttype=="all"){thisClass.searchedallicons=true;MF_ImageManager.listArtwork(svgName,"icons",true,{callback:function(resarr){var arr=new Array();for(var k=0;k<resarr.length;k++){var svgItem=new MF_SvgIconData();resarr[k].svgIconPackType=resarr[k].setid;svgItem.cast(resarr[k]);arr.push(svgItem);}thisClass.svgIconComponents=arr;thisClass.applySvgTemplate();$(".mfSvgIconCategoryTitle").hide();}});}else{if(thisClass.searchedallicons){if(thisClass.svgIconCategories[thisClass.activeSvgIconPackType]){thisClass.svgIconComponents=thisClass.svgIconCategories[thisClass.activeSvgIconPackType];thisClass.applySvgTemplate();}}thisClass.searchedallicons=false;$(".mfSvgItemCls, .mfSvgIconList h3 ").hide();$("#mfSvgIconListing .mfSvgIconList .mfSvgItemCls").each(function(i){if($(this).attr("data-title").toLowerCase().indexOf(svgName)>=0){$(this).show();}});}if($("#mfSvgIconListSearchBox").val()==""){$(".mfSvgIconList h3 ").show();$(".mfSvgListWrapper:first-child").css("margin-top","-20px");}};this.searchIllustrationHandler2=function(e){var svgName=$("#mfSvgIllustrationListSearchBox").val().trim().toLowerCase();if(svgName==""){thisClass.searchIllustrationHandler(e);}};this.searchIllustrationHandler=function(e){var svgName=$("#mfSvgIllustrationListSearchBox").val().trim().toLowerCase();var opttype=$("#mfSvgIllustrationSearchType").val();if(svgName==""){opttype="current";}$(".mfSvgIllustrationItemCls, .mfSvgIllustrationList h3 ").hide();$(".mfSvgIllustrationListWrapper:first-child").css("margin-top","0px");if(opttype=="all"){thisClass.searchedallillustrations=true;MF_ImageManager.listArtwork(svgName,"illustrations",true,{callback:function(resarr){var arr=new Array();for(var k=0;k<resarr.length;k++){var svgItem=new MF_SvgIllustrationData();resarr[k].svgIconPackType=resarr[k].setid;svgItem.cast(resarr[k]);arr.push(svgItem);}thisClass.svgIllustrationComponents=arr;thisClass.applySvgIllustrationTemplate();$(".mfSvgIllustrationCategoryTitle").hide();}});}else{if(thisClass.searchedallillustrations){if(thisClass.svgIllustrationCategories[thisClass.activeSvgIllustrationPackType]){thisClass.svgIllustrationComponents=thisClass.svgIllustrationCategories[thisClass.activeSvgIllustrationPackType];thisClass.applySvgIllustrationTemplate();}}thisClass.searchedallillustrations=false;$(".mfSvgIllustrationItemCls, .mfSvgIllustrationList h3 ").hide();$("#mfSvgIllustrationListing .mfSvgIllustrationList .mfSvgIllustrationItemCls").each(function(i){if($(this).attr("data-title").toLowerCase().indexOf(svgName)>=0){$(this).show();}});}if($("#mfSvgIllustrationListSearchBox").val()==""){$(".mfSvgIllustrationList h3 ").show();$(".mfSvgIllustrationListWrapper:first-child").css("margin-top","-20px");}};this.searchFontsHandler=function(e){if(mf_main.editorController.fontController.currentFontType=="BuiltIn"){var searchval=$("#mfFontSearchBox").val().trim().toLowerCase();for(var i=0;i<mf_main.editorController.fontController.fontArray.length;i++){var item=mf_main.editorController.fontController.fontArray[i];if(item.id.toLowerCase().indexOf(searchval)>=0){$("#mfFontListing").find('[data-id="mfFontItem'+item.id+'"]').show();$("#mfFontListing").find('[data-id="mfFontItem'+item.id+'"]').css("height","100px");}else{$("#mfFontListing").find('[data-id="mfFontItem'+item.id+'"]').hide();$("#mfFontListing").find('[data-id="mfFontItem'+item.id+'"]').css("height","0px");}}}else{if(mf_main.editorController.fontController.currentFontType=="Google"){var searchValue=$("#mfFontSearchBox").val().trim().toLowerCase();mf_main.editorController.fontController.searchGoogleFonts(searchValue);}}};this.searchThemesHandler=function(e){var searchval=$("#mfThemeListSearchBox").val().trim().toLowerCase();for(var i=0;i<thisClass.compTemplates[thisClass.lastTemplate].length;i++){var item=thisClass.compTemplates[thisClass.lastTemplate][i];if(item.name.toLowerCase().indexOf(searchval)>=0){$("#mfThemeItem"+item.id).show();}else{$("#mfThemeItem"+item.id).hide();}}};this.addComponentCallBack=function(category){var dbpack=false;var catarr=category.split("___");if(catarr.length==2&&catarr[1]=="DBPACK"){dbpack=true;}if(category==mf_main.editorController.projectObj.id){dbpack=true;}var catObj=null;if(dbpack==false){for(var n=0;n<thisClass.categories.length;n++){var cat=thisClass.categories[n];if(cat.id==category){catObj=cat;break;}}if(catObj==null){for(var n=0;n<thisClass.categories.length;n++){var cat=thisClass.categories[n];if(cat.id=="featured"){catObj=cat;break;}}}$(".mfPackComponentBtnCls,.mfPackOrganiseCls").hide();mf_main.interfaceResize();thisClass.loadCategory(catObj);}else{if(thisClass.dbCategories[category]){var cateObj=thisClass.dbCategories[category];thisClass.loadCategory(cateObj,true);mf_main.interfaceResize();}else{var comppackid=category;var storeid=null;var categoryClientId=null;if(mf_main.editorController.projectObj.categoryClientid!=null){categoryClientId=mf_main.editorController.projectObj.categoryClientid;mf_main.editorController.projectObj.categoryClientid=null;}if(thisClass.currentCategoryObj&&thisClass.currentCategoryObj.mockstore){comppackid=thisClass.currentCategoryObj.packId;storeid=thisClass.currentCategoryObj.id;if(thisClass.currentCategoryObj.clientid!=null){categoryClientId=thisClass.currentCategoryObj.clientid;}}MF_PackManager.getComponentPack(MF_UserSession.getUser(),mf_main.editorController.projectObj,comppackid,storeid,categoryClientId,mf_main.editorController.teamClientList,{callback:function(packObj){if(packObj==null){thisClass.addComponents("featured");}else{var cpack=new MF_CompCategory();cpack.cast(packObj);if(MF_UserSession.getUser().isBasic&&MF_UserSession.getUser().company!=cpack.clientid&&(cpack.id!=mf_main.editorController.projectObj.id)){thisClass.addComponents("featured");}else{thisClass.flushDBCategoryData();thisClass.cacheDBClearArr.push(cpack.id);thisClass.dbCategories[category]=cpack;thisClass.loadCategory(cpack);}}}});}}};this.addComponents=function(category){thisClass.currentCategory=category;if(thisClass.featuredComponents.length>2){thisClass.addComponentCallBack(category);}else{$.getJSON("images/data/"+thisClass.maincompjson,function(data){if(data){var arr=new Array();for(var k=0;k<data.components.length;k++){var compitem=new MF_ComponentItem();compitem.cast(data.components[k]);arr.push(compitem);}thisClass.cacheCategory.featured=arr;thisClass.featuredComponents=arr;thisClass.cacheClearArr.push("featured");thisClass.flushCategoryData();thisClass.addComponentCallBack(category);}});}};this.loadCategory=function(catObj,nocommon){thisClass.currentCategoryObj=catObj;$(".mfCompRecentPackItem").removeClass("recentactive");if(thisClass.recentPacks[catObj.id]){$(".mfCompRecentPackItem[data-id='"+catObj.id+"']").addClass("recentactive");}thisClass.mergeablePackData=[];if(catObj.isMergeablePack){if(catObj.mergeablePackData!=null&&catObj.mPackData!=""){thisClass.mergeablePackData=JSON.parse(catObj.mergeablePackData);}}this.compArray=new Array();thisClass.currentCategory=catObj.id;$("#mfCatInputTxt").css("display","inline-block");$("#mfCatInputTxt").text(catObj.nameLabel);if(!thisClass.currentCategoryObj.builtin){$(".mfPackComponentBtnCls").hide();$(".mfEditPackDetailsIcon").hide();$(".mfSharePackDetailsIcon").hide();$("#mfStoreShareUiPackBtn").hide();$("#mfStoreEditUiPackBtn").hide();$("#mfStoreDeleteUiPackBtn").hide();$(".mfPackOrganiseCls").hide();if(thisClass.currentCategoryObj.isMaster&&thisClass.currentCategoryObj.isShared&&!thisClass.currentCategoryObj.isMergeablePack){$(".mfPackComponentBtnCls").show();$(".mfEditPackDetailsIcon").show();$("#mfStoreEditUiPackBtn").show();$("#mfStoreDeleteUiPackBtn").show();}else{if(thisClass.currentCategoryObj.isMaster&&!thisClass.currentCategoryObj.isShared&&!thisClass.currentCategoryObj.isMergeablePack){$(".mfPackComponentBtnCls").show();if(MF_Global.adminAllow()){$(".mfSharePackDetailsIcon").show();}$("#mfStoreShareUiPackBtn").show();}else{if(thisClass.currentCategoryObj.isMergeablePack){$(".mfPackOrganiseCls").show();}else{}}}mf_main.interfaceResize();}if(thisClass.cacheCategory[catObj.id]&&$("#mfEditorComponentsLoader").css("display")=="none"){thisClass.compArray=thisClass.cacheCategory[catObj.id];thisClass.applyTemplate();}else{if(thisClass.currentCategoryObj&&thisClass.currentCategoryObj.builtin==true){$.getJSON("images/data/"+thisClass.maincompjson,function(data){if(data){if(thisClass.currentCategoryObj.id=="featured"){thisClass.compArray=data.components;thisClass.featuredComponents=data.components;}else{if(data.include_featured=="false"){thisClass.compArray=data.components;}else{thisClass.compArray=data.components;for(var k=0;k<thisClass.featuredComponents.length;k++){thisClass.compArray.push(thisClass.featuredComponents[k]);}}}thisClass.applyTemplate();thisClass.flushCategoryData();}});}else{thisClass.compArray=catObj.componentItemList;if(nocommon){}else{if(thisClass.currentCategoryObj.includeCommon==true){for(var k=0;k<thisClass.featuredComponents.length;k++){thisClass.compArray.push(thisClass.featuredComponents[k]);}}}thisClass.applyTemplate();thisClass.flushCategoryData();}}thisClass.packController.listPackFiltersHandler();};this.flushCategoryData=function(){if(thisClass.cacheClearArr.length>1){var cname=thisClass.cacheClearArr.shift();if(thisClass.cacheCategory&&thisClass.cacheCategory[cname]){delete thisClass.cacheCategory[cname];thisClass.cacheCategory[cname]=null;}}};this.flushDBCategoryData=function(){if(thisClass.cacheDBClearArr.length>2){var cname=thisClass.cacheDBClearArr.shift();if(thisClass.dbCategories&&thisClass.dbCategories[cname]){delete thisClass.dbCategories[cname];thisClass.dbCategories[cname]=null;}}};this.applyTemplate=function(){if(mf_main.RENDER||mf_main.PUBLIC){return;}$("#mfEditorComponents").empty();var cachedTemplate=mf_main.getTemplateFromCache("mfComponentItemTemplate");if(cachedTemplate==null){$.get("templates/editor/ComponentItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfComponentItemTemplate").html());mf_main.addTemplateToCache("mfComponentItemTemplate",template);thisClass.renderItems(template);});}else{thisClass.renderItems(cachedTemplate);}if(thisClass.scrollRemember[thisClass.currentCategory]){var obj=thisClass.scrollRemember[thisClass.currentCategory];if(obj.search!=""){$("#mfComponentSearchBox").val(obj.search);thisClass.searchComponentHandler();}setTimeout(function(){$("#mfEditorComponents").scrollTop(obj.scrollpos);},100);}if(thisClass.currentCategory!=mf_main.editorController.projectObj.id){thisClass.previousCategory=thisClass.currentCategoryObj;}if(mf_main.editorController.EDITOR&&!thisClass.initCategoryList){thisClass.initCategoryList=true;mf_main.componentList.listCategories();}};this.applyTextTemplate=function(){var cachedTextModalTemplate=mf_main.getTemplateFromCache("mfFontItemTemplate");if(cachedTextModalTemplate==null){$.get("templates/editor/FontItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfFontItemTemplate").html());mf_main.addTemplateToCache("mfFontItemTemplate",template);thisClass.renderTextModalItems(template);});}else{thisClass.renderTextModalItems(cachedTextModalTemplate);}};this.applyIconTemplate=function(){var cachedIconModalTemplate=mf_main.getTemplateFromCache("IconItems");if(cachedIconModalTemplate==null){$.get("templates/editor/IconItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfIconTemplate").html());mf_main.addTemplateToCache("IconItems",template);thisClass.renderIconItems(template);});}else{thisClass.renderIconItems(cachedIconModalTemplate);}};this.fontItemClick=function(e){var fontcomp=mf_main.editorController.selectedFontComp;mf_main.editorController.fontController.isGoogleFontGlobal=false;var fontobj=thisClass.getFontByHTMLID($(this).attr("data-id"));if(fontobj){var customFontLoadedInCopy=false;var customFontObj=null;if(fontobj.isCustomFont){var customFontIndex=null;for(var i=0;i<mf_main.editorController.fontController.customFontArray.length;i++){if(mf_main.editorController.fontController.customFontArray[i].filename==fontobj.name){customFontObj=mf_main.editorController.fontController.customFontArray[i];customFontIndex=i;break;}}if(customFontObj!=null&&customFontObj.projectid!=mf_main.editorController.projectObj.id){var newCustomFontObj=new MF_CustomFont();newCustomFontObj.id=customFontObj.id;newCustomFontObj.projectid=mf_main.editorController.projectObj.id;newCustomFontObj.clientid=mf_main.editorController.projectObj.company;newCustomFontObj.filename=customFontObj.filename;newCustomFontObj.filetype=customFontObj.filetype;newCustomFontObj.filesize=customFontObj.filesize;newCustomFontObj.creator=MF_UserSession.getUser().username;newCustomFontObj.uploaded=true;newCustomFontObj.preview=customFontObj.preview;mf_main.editorController.fontController.loadCustomFont(customFontObj,true);customFontLoadedInCopy=true;mf_main.editorController.fontController.customFontArray.splice(customFontIndex,1);mf_main.editorController.fontController.customFontArray.push(newCustomFontObj);$("#mfFontListing").find('[data-id="mfFontItem'+customFontObj.filename+'"]').remove();fontobj.canDelete=true;fontobj.projectid=newCustomFontObj.projectid;fontobj.clientid=newCustomFontObj.clientid;fontobj.customFontId=newCustomFontObj.id;var cachedFontItemTemplate=mf_main.getTemplateFromCache("mfFontItemTemplate");if(cachedFontItemTemplate!=null){$("#mfFontListing").append(cachedFontItemTemplate(fontobj));thisClass.setupFontClickEvents();}MF_FontManager.copyCustomFont(customFontObj,newCustomFontObj,{callback:function(customFont){}});}}var fontPresent=false;if(mf_main.editorController.fontController.loadedFonts[fontobj.id]){fontPresent=true;}if(!fontPresent){mf_main.editorController.fontController.usedFonts[fontobj.id]={fontFamily:fontobj.id,isGoogleFont:false};mf_main.editorController.fontController.loadFont(fontobj.id,null,0,0);if(fontobj.isCustomFont&&!customFontLoadedInCopy&&customFontObj){mf_main.editorController.fontController.loadCustomFont(customFontObj);}}$("#mfFontSelectScreen").hide();$("#mfFontLoadScreen").show();if(fontcomp=="global"){var undoarr=new Array();var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){if(select.component.hasOwnProperty("fontType")){var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"fontType",select.component.fontType);undoarr.push(undo);undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"isGoogleFontUsed",select.component.isGoogleFontUsed);undoarr.push(undo);undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"fontWeight",select.component.fontWeight);undoarr.push(undo);if(select.component.fontWeight=="normal"||select.component.fontWeight=="bold"){select.component.e2xml.addPropSingle("fontWeight",select.component.fontWeight,"default");}else{select.component.e2xml.addPropSingle("fontWeight","normal","default");}select.component.fontFamily=fontobj.id;select.component.e2xml.addPropSingle("fontType",fontobj.id,"default");select.component.e2xml.addPropSingle("isGoogleFontUsed",false,"default");select.component.render(false);}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}else{var undoarr=new Array();var undo=new MF_UndoDAO();undo.propSingleUndo(fontcomp,"fontType",fontcomp.fontType);undoarr.push(undo);undo=new MF_UndoDAO();undo.propSingleUndo(fontcomp,"isGoogleFontUsed",fontcomp.isGoogleFontUsed);undoarr.push(undo);undo=new MF_UndoDAO();undo.propSingleUndo(fontcomp,"fontWeight",fontcomp.fontWeight);undoarr.push(undo);fontcomp.fontFamily=fontobj.id;fontcomp.e2xml.addPropSingle("fontType",fontobj.id,"default");if(fontcomp.fontWeight=="normal"||fontcomp.fontWeight=="bold"){fontcomp.e2xml.addPropSingle("fontWeight",fontcomp.fontWeight,"default");}else{fontcomp.e2xml.addPropSingle("fontWeight","normal","default");}fontcomp.e2xml.addPropSingle("isGoogleFontUsed",false,"default");if(fontcomp.RENDER_ON_FONT){fontcomp.render(true);mf_main.editorController.reStackComponents();}else{fontcomp.render(false);}var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);}mf_main.editorController.enableShortcuts();MF_ChangeManager.CHANGED(true);$(".mfFontFamilyCls").text(fontobj.name);$("#mfFontSelectionPopUp").hide();if(mf_main.editorController.lastSetting){mf_main.editorController.lastSetting.setValues();}}};this.reRenderCanvasFonts=function(){var allselections=mf_main.editorController.getAllComponentSelects();var canvasfont=false;for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component&&select.component.CANVASFONT){canvasfont=true;select.component.render(true);}}if(canvasfont){mf_main.editorController.reStackComponents();}};this.renderIconItems=function(template){var i=0;$("#mfIcons .mfIconList").empty();var htmldom="";var len=mf_main.editorController.fontController.fontAwesomeWebIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeWebIcons[i]);}$("#mfFontAwesomeWeb .mfIconList").append(htmldom);htmldom="";len=mf_main.editorController.fontController.fontAwesomeTransportIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeTransportIcons[i]);}$("#mfFontAwesomeTransportation .mfIconList").append(htmldom);htmldom="";len=mf_main.editorController.fontController.fontAwesomeGenderIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeGenderIcons[i]);}$("#mfFontAwesomeGender .mfIconList").append(htmldom);htmldom="";len=mf_main.editorController.fontController.fontAwesomeFileTypeIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeFileTypeIcons[i]);}$("#mfFontAwesomeFileType .mfIconList").append(htmldom);htmldom="";len=mf_main.editorController.fontController.fontAwesomeFormControlIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeFormControlIcons[i]);}$("#mfFontAwesomeFormControl .mfIconList").append(htmldom);htmldom="";len=mf_main.editorController.fontController.fontAwesomeChartIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeChartIcons[i]);}$("#mfFontAwesomeChart .mfIconList").append(htmldom);htmldom="";len=mf_main.editorController.fontController.fontAwesomeCurrencyIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeCurrencyIcons[i]);}$("#mfFontAwesomeCurrency .mfIconList").append(htmldom);htmldom="";len=mf_main.editorController.fontController.fontAwesomeTextEditorIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeTextEditorIcons[i]);}$("#mfFontAwesomeTextEditor .mfIconList").append(htmldom);htmldom="";len=mf_main.editorController.fontController.fontAwesomeDirectionalIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeDirectionalIcons[i]);}$("#mfFontAwesomeDirectional .mfIconList").append(htmldom);htmldom="";len=mf_main.editorController.fontController.fontAwesomeBrandIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeBrandIcons[i]);}$("#mfFontAwesomeBrand .mfIconList").append(htmldom);htmldom="";len=mf_main.editorController.fontController.fontAwesomeMedicalIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeMedicalIcons[i]);}$("#mfFontAwesomeMedical .mfIconList").append(htmldom);htmldom="";len=mf_main.editorController.fontController.fontAwesomeVideoPlayerIcons.length;for(i=0;i<=len-1;i++){htmldom=htmldom+template(mf_main.editorController.fontController.fontAwesomeVideoPlayerIcons[i]);}$("#mfFontAwesomeVideoPlayers .mfIconList").append(htmldom);$(".mfIconItemCls").each(function(){var title=$(this).attr("data-title");title=title.replace("fa-","");title=title.replace("ico-","");title=title.replace(/_/gi," ");$(this).attr("title",title);});$(".mfIconItemCls").tooltip({animation:false});$(".mfIcon").on("click",function(event){event.stopImmediatePropagation();var font=$(this).data("icon");if(mf_main.editorController.selectorResize.selector){mf_main.editorController.selectorResize.selector.component.e2xml.addPropSingle("fontClass",font);mf_main.editorController.selectorResize.selector.component.render(false);}$("#mfIconSelectionPopUp").hide();mf_main.editorController.shortcutsFlag=true;});$(".mfIconItemCls").on("drag",function(e){MF_Utils.display_ActionIndicator("Click to add icon");});};this.getFontByHTMLID=function(pid){var i=0;for(i=0;i<=mf_main.editorController.fontController.fontArray.length-1;i++){var item=mf_main.editorController.fontController.fontArray[i];if("mfFontItem"+item.id==pid){return item;break;}}return null;};this.renderItems=function(template){var i=0;$(".mfComponentItemCls").draggable("destroy");$("#mfEditorComponents").empty();if(thisClass.compArray){var temparray=new Array();var len=thisClass.compArray.length;var htmldom="";for(i=0;i<=len-1;i++){var compitem=new MF_ComponentItem();compitem.cast(thisClass.compArray[i]);if(thisClass.currentCategoryObj&&compitem.pack){compitem.clientid=thisClass.currentCategoryObj.clientid;}temparray.push(compitem);htmldom=htmldom+template(compitem);}if(htmldom==""&&!thisClass.currentCategoryObj.isMergeablePack){htmldom="<div class='mfCenterAlign' id='mfCompListingPlaceholder'><i class='ico-box'></i>Click 'Add' button below to save and reuse components for this project.</div>";}$("#mfEditorComponents").append(htmldom);thisClass.compArray=temparray;thisClass.showComponentListing();$(".lazycompThumb").off("error");$(".lazycompThumb").on("error",function(){$(this).hide();});$(".lazycompThumb").off("load");$(".lazycompThumb").on("load",function(){mf_main.componentList.resizeComponentItem(this);});}mf_main.editorController.makeComponentsDraggable();$("#mfEditorComponents").scrollTop(0);if(thisClass.compArray){var len=thisClass.compArray.length;for(i=0;i<=len-1;i++){var compitem=thisClass.compArray[i];if(compitem){$("#mfComponentThumbItem_"+compitem.n).attr("src",$("#mfComponentThumbItem_"+compitem.n).attr("data-src"));}}}};this.compLoadHandler=function(e){var type=$(this).attr("data-compid");var comppath=MF_Global.getCompPath();if(!thisClass.loadedComponentCode[type]){MF_Utils.loadsScripts([comppath+type+".js?v=5"]).then(function(script,textStatus){thisClass.loadedComponentCode[type]=true;});}};this.renderTextModalItems=function(template){$("#mfFontListing .mfFontItemCls").remove();var i=0;var len=mf_main.editorController.fontController.fontArray.length;var htmldom="";for(i=0;i<=len-1;i++){var fontObj=mf_main.editorController.fontController.fontArray[i];if(fontObj.id!="ubuntu"&&fontObj.id!="roboto"&&fontObj.id!="cartoonist"&&fontObj.id!="blokletters"&&fontObj.id!="arial"&&fontObj.id!="times"&&fontObj.id!="courier"){fontObj.canDelete=false;htmldom=htmldom+template(mf_main.editorController.fontController.fontArray[i]);}}$("#mfFontListing").append(htmldom);thisClass.setupFontClickEvents();};this.setupFontClickEvents=function(){$(".mfFontItemCls").off("click",thisClass.fontItemClick);$(".mfCustomFontDeleteBtn").off("click",mf_main.editorController.fontController.deleteCustomFontHandler);$(".mfFontItemCls").on("click",thisClass.fontItemClick);$(".mfCustomFontDeleteBtn").on("click",mf_main.editorController.fontController.deleteCustomFontHandler);$(".lazyFontThumb").off("error");$(".lazyFontThumb").on("error",function(){$(this).hide();});};this.invokeComponent=function(type,loadtype,offsetXPos,offsetYPos,imageid){var component=null;$("#mfCompPlaceholder").remove();if(thisClass.loadedComponentCode[type]){if(loadtype!="noload"){component=thisClass.getComponentObj(type);}if(loadtype=="new"){mf_main.editorController.loadInvokedComponent(component,offsetXPos,offsetYPos,imageid);}return component;}else{var comppath=MF_Global.getCompPath();if(loadtype=="new"){thisClass.addPlaceHolderComponent(offsetXPos,offsetYPos);}MF_Utils.loadsScripts([comppath+type+".js?v=5"]).then(function(script,textStatus){if(loadtype!="noload"){component=thisClass.getComponentObj(type);}thisClass.loadedComponentCode[type]=true;if(loadtype!="noload"){$("#mfCompPlaceholder").remove();}if(loadtype=="new"){mf_main.editorController.loadInvokedComponent(component,offsetXPos,offsetYPos,imageid);}});}};this.addPlaceHolderComponent=function(offsetXPos,offsetYPos){$("#mfCompPlaceholder").remove();var addPlaceHolder="<div id='mfCompPlaceholder' style='background: #EEEEEE; z-index: 50000000; width: 100px; height: 100px; position: absolute;  '><img alt='Loading' src='images/general/mf_loader.svg' class='mfSVGLoader' style='top:calc(50% - 12.5px); left: calc(50% - 12.5px); position: relative'></div>";$("#mfPage"+mf_main.editorController.page.eid).append(addPlaceHolder);$("#mfCompPlaceholder").css("top",(offsetYPos-50)+"px");$("#mfCompPlaceholder").css("left",(offsetXPos-50)+"px");};this.invokeComponentsSrc=function(arr,page,paste){if(arr.length==0){if(paste){mf_main.editorController.editManager.pasteComponent(true,true,false,true,true);$("#mfCompPlaceholder").remove();}else{mf_main.editorController.loadPageData(page);}}else{var newarr=new Array();for(var l=0;l<arr.length;l++){newarr.push(arr[l]+".js?v=5");}var comppath="js/internal/editor/components/";if(MF_Global.getS3Bucket()=="testmfassets"){comppath="js/src/internal/editor/components/";}MF_Utils.loadsScripts(newarr,comppath).then(function(){for(var k=0;k<arr.length;k++){thisClass.loadedComponentCode[arr[k]]=true;}if(paste){mf_main.editorController.editManager.pasteComponent(true,true,false,true,true);$("#mfCompPlaceholder").remove();}else{mf_main.editorController.loadPageData(page);}});}};this.getComponentObj=function(type){var component=null;component=new window[type]();return component;};this.invokeComponentSettings=function(comp){var settings=null;var settingsName=comp.NAME+"Settings";settings=new window[settingsName]();thisClass.cacheSettings[comp.NAME]=settings;mf_main.editorController.openSetting(comp.selector);};thisClass.svgIconListHandler=function(e){if(mf_main.OFFLINE){alert("Icons are not available in Offline mode");return;}mf_main.editorController.disableShortcuts();mf_main.editorController.showPopUp(e,$("#mfSvgIconSelectionPopUp"));if(mf_main.componentList.svgIconComponents.length==0){var svgItemSetCollection=[{l:"Default",n:"default"},{l:"Font-Awesome 5",n:"fontawesome5"},{l:"Bootstrap 5",n:"bootstrap5"},{l:"Emojis",n:"emoji-nocolor"},{l:"ProfilePics",n:"profileicons-nocolor"},{l:"Material 3",n:"material3"},{l:"Heroicons Outline",n:"heroicons-outline"},{l:"Heroicons Solid",n:"heroicons-solid"},{l:"Feather 4",n:"feather4"},{l:"Sketchy icons",n:"handdrawnicons"},{l:"Github Octicons 8",n:"githubocticons8"},{l:"Glyph",n:"glyph"},{l:"Iconic 1",n:"iconic1"},{l:"Ionicons iOS 4",n:"ioniconsios4"},{l:"AWS icons 6",n:"aws6"},{l:"Web Layouts",n:"weblayouts"},{l:"Mobile Layouts",n:"mobilelayouts"},{l:"Flag icons",n:"flagicons-nocolor"}];var svgItemSetArray=new Array();for(var k=0;k<svgItemSetCollection.length;k++){var svgItemSet=new MF_SvgIconSet();svgItemSet.cast(svgItemSetCollection[k]);svgItemSetArray.push(svgItemSet);}var svgCategoryElem="#mfSvgIconCategory";$(svgCategoryElem).html("");$.each(svgItemSetArray,function(i,item){$(svgCategoryElem).append($("<option>",{value:item.n,text:item.l}));});var svgPackType=mf_main.componentList.activeSvgIconPackType;if(svgPackType!=null){$(svgCategoryElem).val(svgPackType);}else{$(svgCategoryElem).val("default");svgPackType=$(svgCategoryElem).val();}thisClass.getSvgIconItems(svgPackType);}};thisClass.svgIllustrationListHandler=function(e){if(mf_main.OFFLINE){alert("Illustrations are not available in Offline mode");return;}mf_main.editorController.disableShortcuts();mf_main.editorController.showPopUp(e,$("#mfSvgIllustrationSelectionPopUp"));if(mf_main.componentList.svgIllustrationComponents.length==0){var svgItemSetCollection=[{l:"Ira Design",n:"iradesign"},{l:"Reshot Illustrations",n:"reshot"},{l:"Highlights",n:"highlights"},{l:"Shapes Monica",n:"shapes-monica"},{l:"UnDraw MIT",n:"undraw-mit"},{l:"Doodles by Maria",n:"megadoodles-maria"}];var svgItemSetArray=new Array();for(var k=0;k<svgItemSetCollection.length;k++){var svgItemSet=new MF_SvgIconSet();svgItemSet.cast(svgItemSetCollection[k]);svgItemSetArray.push(svgItemSet);}var svgCategoryElem="#mfSvgIllustrationCategory";$(svgCategoryElem).html("");$.each(svgItemSetArray,function(i,item){$(svgCategoryElem).append($("<option>",{value:item.n,text:item.l}));});var svgPackType=mf_main.componentList.activeSvgIllustrationPackType;if(svgPackType!=null){$(svgCategoryElem).val(svgPackType);}else{$(svgCategoryElem).val("iradesign");svgPackType=$(svgCategoryElem).val();}thisClass.getSvgIllustrationItems(svgPackType);}};this.getSvgIconItems=function(svgPackType){if(svgPackType==null||svgPackType==""){svgPackType="default";mf_main.componentList.activeSvgIconPackType="default";$("#mfSvgIconCategory").val($("#mfSvgIconCategory option:first").val());}$("#mfSvgIconModalLoader").show();$("#mfSvgIconList").hide();thisClass.activeSvgIconPackType=svgPackType;$("#mfSvgIconListing .mfSvgIconList").empty();thisClass.searchedallicons=false;if(thisClass.svgIconCategories[svgPackType]){thisClass.svgIconComponents=thisClass.svgIconCategories[svgPackType];thisClass.applySvgTemplate();}else{MF_ImageManager.listArtwork(svgPackType,"icons",{callback:function(resarr){var arr=new Array();for(var k=0;k<resarr.length;k++){var svgItem=new MF_SvgIconData();resarr[k].svgIconPackType=svgPackType;svgItem.cast(resarr[k]);arr.push(svgItem);}thisClass.svgIconComponents=arr;thisClass.svgIconCategories[svgPackType]=arr;thisClass.applySvgTemplate();}});}};this.applySvgTemplate=function(){$("#mfSvgIconListing .mfSvgIconList").empty();var cachedSvgTemp=mf_main.getTemplateFromCache("SvgItems");if(cachedSvgTemp==null){$.get("templates/editor/SvgItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfSvgTemplate").html());mf_main.addTemplateToCache("SvgItems",template);thisClass.renderSvgItems(template);});}else{thisClass.renderSvgItems(cachedSvgTemp);}};this.renderSvgItems=function(template){var htmldom="";var categoryarr=new Array();var len=thisClass.svgIconComponents.length;var icondom="";for(var i=0;i<len;i++){if(categoryarr.indexOf(thisClass.svgIconComponents[i].c)==-1){var svgCategorytitle=thisClass.svgIconComponents[i].c;svgCategorytitle=svgCategorytitle.replace(/_/g," ");$(".mfSvgIconList").append("<div class='mfSvgListWrapper' id="+mf_main.componentList.activeSvgIconPackType+"_"+thisClass.svgIconComponents[i].c+"><h3 class='mfSvgIconCategoryTitle'>"+svgCategorytitle+"</h3></div>");categoryarr.push(thisClass.svgIconComponents[i].c);}var htmldom=template(thisClass.svgIconComponents[i]);$("#"+thisClass.activeSvgIconPackType+"_"+thisClass.svgIconComponents[i].c).append(htmldom);}$(".mfSVGIconListItemCls").off("error");$(".mfSVGIconListItemCls").on("error",function(){$(this).attr("src","images/editor/svg_placeholder.png");});if(mf_main.componentList.activeSvgIconPackType=="weblayouts"||mf_main.componentList.activeSvgIconPackType=="mobilelayouts"){$(".mfSvgItemCls, .mfSVGIconListItemCls").css({width:"80px",height:"80px"});$(".mfSvgItemCls").css({"padding-right":"0px","margin-right":"16px"});}if(mf_main.componentList.activeSvgIconPackType.includes("-nocolor")){$(".mfSvgItemCls, .mfSVGIconListItemCls").css({width:"40px",height:"40px"});$(".mfSvgItemCls").css({"padding-right":"0px","margin-right":"16px"});}$(".mfSvgItemCls").tooltip({animation:false});$("#mfSvgIconModalLoader").hide();$("#mfSvgIconList").show();$(".mfSvg").off("click");$(".mfSvg").on("click",function(event){event.stopImmediatePropagation();var SVGUrl="/svg/"+$(this).attr("data-category")+"/"+$(this).attr("data-className");if(thisClass.addIconMode){thisClass.addIconMode=false;var initPlace=mf_main.editorController.getInitialPlacement();var scrollTop=(document.getElementById("mfEditorHolder").scrollTop/mf_main.editorController.SCALE)+initPlace.y;var scrollLeft=(document.getElementById("mfEditorHolder").scrollLeft/mf_main.editorController.SCALE)+initPlace.x;mf_main.componentList.invokeComponent("MF_ImageComp","new",scrollLeft,scrollTop,SVGUrl);}else{if(mf_main.editorController.selectorResize&&mf_main.editorController.selectorResize.selector){var svgComponent=mf_main.editorController.selectorResize.selector.component;if(svgComponent.NAME=="MF_SVGIcon"){SVGUrl=$(this).attr("data-category")+"/"+$(this).attr("data-className");svgComponent.e2xml.addPropSingle("SVGUrl",SVGUrl);}else{var undoarr=new Array();var undo=new MF_UndoDAO();undo.propSingleUndo(svgComponent,"imageID",svgComponent.imageID);undoarr.push(undo);var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);svgComponent.e2xml.addPropSingle("imageID",SVGUrl,"default");}var currentColors=new Object();if(svgComponent.currentColors){currentColors=JSON.parse(JSON.stringify(svgComponent.currentColors));}svgComponent.currentColors=new Object();svgComponent.tempIconColor=currentColors;var layoutString=JSON.stringify(svgComponent.currentColors);svgComponent.e2xml.addPropSingle("currentColorsData",layoutString,"default");svgComponent.render(true);mf_main.editorController.closeAllSettings();mf_main.editorController.openSetting(mf_main.editorController.selectorResize.selector);mf_main.editorController.reStackComponents();}}MF_ChangeManager.CHANGED(true);mf_main.editorController.shortcutsFlag=true;$("#mfSvgIconSelectionPopUp").hide();});$(".mfSVGIconListItemCls").on("drag",function(e){MF_Utils.display_ActionIndicator("Click to add icon");});if(mf_main.editorController.VISIBLE_OBSERVE){thisClass.startIconIntersectionObserver("#mfSvgIconListing .mfSVGIconListItemCls","mfSvgIconListing");}else{$("#mfSvgIconListing .mfSvgIconList").find(".mfSVGIconListItemCls").each(function(){$(this).attr("src",$(this).attr("data-src"));$(this).css("visibility","visible");});$(".mfSVGIconListItemCls").on("drag",function(e){});}};this.getSvgIllustrationItems=function(svgPackType){if(svgPackType==null||svgPackType==""){svgPackType="iradesign";mf_main.componentList.activeSvgIllustrationPackType="iradesign";$("#mfSvgIllustrationCategory").val($("#mfSvgIllustrationCategory option:first").val());}$("#mfSvgIllustrationModalLoader").show();$("#mfSvgIllustrationList").hide();thisClass.activeSvgIllustrationPackType=svgPackType;thisClass.searchedallillustrations=false;$("#mfSvgIllustrationListing .mfSvgIllustrationList").empty();if(thisClass.svgIllustrationCategories[svgPackType]){thisClass.svgIllustrationComponents=thisClass.svgIllustrationCategories[svgPackType];thisClass.applySvgIllustrationTemplate();}else{MF_ImageManager.listArtwork(svgPackType,"illustrations",{callback:function(resarr){var arr=new Array();for(var k=0;k<resarr.length;k++){var svgItem=new MF_SvgIllustrationData();resarr[k].svgIconPackType=svgPackType;svgItem.cast(resarr[k]);arr.push(svgItem);}thisClass.svgIllustrationComponents=arr;thisClass.svgIllustrationCategories[svgPackType]=arr;thisClass.applySvgIllustrationTemplate();}});}};this.applySvgIllustrationTemplate=function(){$("#mfSvgIllustrationListing .mfSvgIllustrationList").empty();var cachedSvgTemp=mf_main.getTemplateFromCache("SvgIllustrationItems");if(cachedSvgTemp==null){$.get("templates/editor/SvgIllustrationItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfSvgIllustrationTemplate").html());mf_main.addTemplateToCache("SvgIllustrationItems",template);thisClass.renderSvgIllustrationItems(template);});}else{thisClass.renderSvgIllustrationItems(cachedSvgTemp);}};this.renderSvgIllustrationItems=function(template){var htmldom="";var categoryarr=new Array();var illdom="";var len=thisClass.svgIllustrationComponents.length;for(var i=0;i<len;i++){if(categoryarr.indexOf(thisClass.svgIllustrationComponents[i].c)==-1){var svgCategorytitle=thisClass.svgIllustrationComponents[i].c;svgCategorytitle=svgCategorytitle.replace(/_/g," ");$("#mfSvgIllustrationListing .mfSvgIllustrationList").append("<div class='mfSvgIllustrationListWrapper' id="+mf_main.componentList.activeSvgIllustrationPackType+"_"+thisClass.svgIllustrationComponents[i].c+"><h3 class='mfSvgIllustrationCategoryTitle'>"+svgCategorytitle+"</h3></div>");categoryarr.push(thisClass.svgIllustrationComponents[i].c);}var htmldom=template(thisClass.svgIllustrationComponents[i]);$("#"+thisClass.activeSvgIllustrationPackType+"_"+thisClass.svgIllustrationComponents[i].c).append(htmldom);}$(".mfSVGIllustrationListItemCls").off("error");$(".mfSVGIllustrationListItemCls").on("error",function(){$(this).attr("src","images/editor/svg_placeholder.png");});if(mf_main.componentList.activeSvgIllustrationPackType.includes("-nocolor")){$(".mfSvgIllustrationItemCls, .mfSVGIllustrationListItemCls").css({width:"40px",height:"40px"});$(".mfSvgIllustrationItemCls").css({"padding-right":"0px","margin-right":"16px"});}$(".mfSvgIllustrationItemCls").tooltip({animation:false});$("#mfSvgIllustrationModalLoader").hide();$("#mfSvgIllustrationList").show();$(".mfSvgIllustration").off("click");$(".mfSvgIllustration").on("click",function(event){event.stopImmediatePropagation();var SVGUrl="/illustrations/"+$(this).attr("data-category")+"/"+$(this).attr("data-className");if(thisClass.addIconMode){thisClass.addIconMode=false;var initPlace=mf_main.editorController.getInitialPlacement();var scrollTop=(document.getElementById("mfEditorHolder").scrollTop/mf_main.editorController.SCALE)+initPlace.y;var scrollLeft=(document.getElementById("mfEditorHolder").scrollLeft/mf_main.editorController.SCALE)+initPlace.x;mf_main.componentList.invokeComponent("MF_ImageComp","new",scrollLeft,scrollTop,SVGUrl);}else{if(mf_main.editorController.selectorResize&&mf_main.editorController.selectorResize.selector){var svgComponent=mf_main.editorController.selectorResize.selector.component;if(svgComponent.NAME=="MF_ImageComp"){var undoarr=new Array();var undo=new MF_UndoDAO();undo.propObjectUndo(svgComponent,"currentColorsData",svgComponent.currentColorsData);undoarr.push(undo);undo=new MF_UndoDAO();undo.propSingleUndo(svgComponent,"imageID",svgComponent.imageID);undoarr.push(undo);var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);svgComponent.e2xml.addPropSingle("currentColorsData","{}","default");svgComponent.e2xml.addPropSingle("imageID",SVGUrl,"default");}else{svgComponent.e2xml.addPropSingle("imageID",SVGUrl);}svgComponent.render(true);mf_main.editorController.closeAllSettings();mf_main.editorController.openSetting(mf_main.editorController.selectorResize.selector);mf_main.editorController.reStackComponents();}}MF_ChangeManager.CHANGED(true);mf_main.editorController.shortcutsFlag=true;$("#mfSvgIconSelectionPopUp").hide();});$(".mfSVGIllustrationListItemCls").on("drag",function(e){MF_Utils.display_ActionIndicator("Click to add icon");});if(mf_main.editorController.VISIBLE_OBSERVE){thisClass.startIllustrationIntersectionObserver("#mfSvgIllustrationListing .mfSVGIllustrationListItemCls","mfSvgIllustrationListing");}else{$("#mfSvgIllustrationListing .mfSvgIllustrationList").find(".mfSVGIllustrationListItemCls").each(function(){$(this).attr("src",$(this).attr("data-src"));$(this).css("visibility","visible");});$(".mfSVGIllustrationListItemCls").on("drag",function(e){});}};this.getActiveSvgIconPackTypeXML=function(){try{var activeSvgIconPackType=thisClass.activeSvgIconPackType;if(activeSvgIconPackType==null){activeSvgIconPackType="";}return'<svgPackSettings activepack="'+activeSvgIconPackType+'"></svgPackSettings>';}catch(e){return"";}};this.getActiveSvgIllustrationPackTypeXML=function(){try{var activeSvgIllustrationPackType=thisClass.activeSvgIllustrationPackType;if(activeSvgIllustrationPackType==null){activeSvgIllustrationPackType="";}return'<svgIllustrationPackSettings activepack="'+activeSvgIllustrationPackType+'"></svgIllustrationPackSettings>';}catch(e){return"";}};this.resizeComponentItem=function(element){if(element.naturalWidth<190){$(element).closest(".mfComponentItemCls").width(100);$(element).closest(".mfComponentItemCls").find(".mfComponentItemThumbnailContainer").height(90);}else{$(element).closest(".mfComponentItemCls").width(208);$(element).closest(".mfComponentItemCls").find(".mfComponentItemThumbnailContainer").css("min-height",0);$(element).closest(".mfComponentItemCls").find(".mfComponentItemThumbnailContainer").css("height","auto");}};}function MF_ComponentPackController(){var thisClass=this;this.currentPack=null;this.packImportDropdown=null;this.storeCategoryArray=[{text:"Web frameworks",value:"web"},{text:"Mobile frameworks",value:"mobile"},{text:"Desktop frameworks",value:"desktop"},{text:"Enterprise Packs",value:"enterprise"},{text:"Other",value:"other"}];this.uploadIconFile=null;this.uploadThumbnailFile=null;this.packImageUploadType=null;this.uploadPreviewFile=null;this.isIconDeleted=false;this.isThumbnailDeleted=false;thisClass.componentImgFileTemp=null;thisClass.selectedComponent=null;this.packAssetUploadCount=0;this.uiPackListenerFlag=false;this.isExportComponentAsImage=false;this.constructor=function(){$(".mfNewCustomPackBtn").on("click",thisClass.openNewPackHandler);$(".mfGoCompListBtn").on("click",thisClass.goBackListHandler);$("#mfPackSubmitbtn, #mfCreateMergePack").on("click",thisClass.submitPackHandler);$(".mfAddDBComponentBtnCls").on("click",thisClass.openAddComponentHandler);$(".mfSortDBComponentBtnCls").on("click",thisClass.openListComponentHandler);$("#mfAddNewComponentBtn").on("click",thisClass.addNewComponent);$(".mfSharePackDetailsIcon").on("click",thisClass.openShareUIpackPopup);$(".mfEditPackDetailsIcon").on("click",thisClass.openEditUIpackPopup);$("#mfPackDeleteSubmitbtn").on("click",thisClass.deletePackHandler);$("#mfPackEditSubmitbtn").on("click",thisClass.updatePackNameHandler);$("#mfAddClonePackBtn").on("click",thisClass.cloneUIPackHandler);var newcat=new Array();for(var m=0;m<mf_main.componentList.categories.length;m++){if(m==0){var cat=new MF_CompCategory();cat.id="none";cat.name="None";newcat.push(cat);}newcat.push(mf_main.componentList.categories[m]);}$("#mfAddComponentName").on("keypress",function(e){if(e.which==13){thisClass.addNewComponent();}});$("#mfAddComponentModal").on("shown.bs.modal",function(){$("#mfAddComponentName").focus();});$("#mfAddComponentModal").on("hidden.bs.modal",function(){mf_main.editorController.enableShortcuts();});$(".mfGetCustomPackBtn").on("click",function(){mf_main.closeDialog();mf_main.editorController.storeController.openStore("uipack");});$("#mfDeletePackListItem").on("click",thisClass.deleteComponentHandler);$("#mfComponentMoveTopBtn").on("click",thisClass.moveToTopHandler);$("#mfComponentMoveBottomBtn").on("click",thisClass.moveToBottomHandler);$("#mfEditPackComponents,#mfEditPackCategories").on("click",thisClass.toggleEditPackContainer);$("#mfEditPackNewFilterForm").submit(thisClass.addComponentFilterHandler);};this.uiPackListenerConstructor=function(){if(!thisClass.uiPackListenerFlag){$("#mfCustomPackIconEdit").on("click",thisClass.openIconSelectHandler);$("#mfCustomPackThumbnailEdit").on("click",thisClass.openThumbnailSelectHandler);$("#mfCustomPackPreviewEdit").on("click",thisClass.openPreviewSelectHandler);$("#mfCustomPackIconUpload").on("change",thisClass.iconUploadFileSelectHandler);$("#mfCustomPackThumbnailUpload").on("change",thisClass.iconUploadFileSelectHandler);$("#mfCustomPackPreviewUpload").on("change",thisClass.iconUploadFileSelectHandler);$("#mfpackIconDelete").on("click",thisClass.deleteUIpackIcon);$("#mfpackThumbnailDelete").on("click",thisClass.deleteUIpackThumbnail);$("#mfStoreShareUiPackBtn").on("click",thisClass.shareUIpackHandler);$("#mfStoreEditUiPackBtn").on("click",thisClass.editUIpackHandler);$("#mfStoreDeleteUiPackBtn").on("click",thisClass.deleteUIpackHandler);$("#mfCompImgUploadCancelBtn").on("click",thisClass.componentImgUploadCancel);$("#mfUploadComponentDetailSave").on("click",thisClass.mfUploadComponentDetails);$("#mfSelectStoreTemplate").kendoDropDownList({optionLabel:"Select Type...",dataTextField:"text",dataValueField:"value",dataSource:thisClass.storeCategoryArray,});$("#mfComponentImageUploadFile").on("change",thisClass.componentUploadFileSelectHandler);$("#mfComponentImageEdit").on("click",function(e){e.stopImmediatePropagation();$("#mfComponentImageUploadFile").trigger("click");});$("#mfComponentImageReset").on("click",thisClass.componentImageReset);thisClass.uiPackListenerFlag=true;}};this.openNewPackHandler=function(){mf_main.componentList.isNewMergePack=false;$(".mfCompPackCls").hide();$("#mfCompPackAddDiv").show();$("#mfPackNameInput").focus();if(($("#mfCommonPackImg").attr("src")=="")){$("#mfCommonPackImg").attr("src",$("#mfCommonPackImg").attr("data-src"));}$(".mfCreateNewPackWrapper").height($(currentWindow).height()-$(".mfCreateNewPackHeader").outerHeight());};this.openEditPackHandler=function(){$(".mfCompPackCls").hide();$("#mfCompPackEditDiv").show();$("#mfPackEditNameInput").focus();$("#mfPackEditNameInput").val(thisClass.currentPack.name);if(thisClass.currentPack.includeCommon){$("#mfToggleCompPack2IncludeCommon").prop("checked",true);}else{$("#mfToggleCompPack2IncludeCommon").prop("checked",false);}};this.deletePackHandler=function(){if($("#mfCompCategoryDialog").css("display")=="none"){thisClass.currentPack=mf_main.componentList.currentCategoryObj;}var msg="Are you sure you want to remove this UI pack?<br/><br/><br/>Note: This won't affect your wireframes";if(thisClass.currentPack&&thisClass.currentPack.isMaster&&!thisClass.currentPack.isMergeablePack){msg="This will permanently delete this Component Pack and all its components. <br/>Continue ?<br/><br/><br/>Note: This won't affect your wireframes<br/><br/><br/>Only pack creator or license admin can delete a custom UI Pack";}else{if(thisClass.currentPack&&thisClass.currentPack.isMaster&&thisClass.currentPack.isMergeablePack){msg="This will permanently delete your Merge Pack <br/>Continue ?<br/><br/><br/>Note: This won’t affect your imported pack components<br/><br/><br/>Only pack creator or license admin can delete a custom UI Pack";}}bootbox.confirm(msg,function(ans){if(ans){$(".mfCompPackCls").hide();$("#mfCompPackLoadDiv").show();MF_PackManager.deleteComponentPack(MF_UserSession.getUser(),thisClass.currentPack,{callback:function(result){if(result==null){mf_main.closeDialog();alert("Error in deleting pack. Only pack creator or license admin can delete a custom UI Pack.");}else{mf_main.closeDialog();MF_Utils.display_ActionIndicator("Pack removed!");var newcat=new Array();for(var m=0;m<mf_main.componentList.categories.length;m++){if(mf_main.componentList.categories[m].id!=thisClass.currentPack.id){newcat.push(mf_main.componentList.categories[m]);}}mf_main.componentList.categories=newcat;$("#mfComponentCategoryItem_"+thisClass.currentPack.id).remove();delete mf_main.componentList.sortPacks[thisClass.currentPack.id];if(mf_main.componentList.currentCategory=="featured"){mf_main.componentList.currentCategory="";}mf_main.componentList.viewCategory("featured");if(thisClass.currentPack.isMaster){thisClass.deleteMPackCacheHandler();}}}});}});};this.updatePackNameHandler=function(){var pname=$.trim($("#mfPackEditNameInput").val());if(pname==""){alert("Name cannot be empty");return;}$(".mfCompPackCls").hide();$("#mfCompPackLoadDiv").show();thisClass.currentPack.name=pname;if($("#mfToggleCompPack2IncludeCommon").is(":checked")){thisClass.currentPack.includeCommon=true;}else{thisClass.currentPack.includeCommon=false;}MF_PackManager.updateComponentPack(MF_UserSession.getUser(),thisClass.currentPack,{callback:function(result){mf_main.closeDialog();if(result==null){alert("Cannot edit UI pack details. Note: Only pack creator or license admin can make changes.");}else{MF_Utils.display_ActionIndicator("Pack updated!");if(mf_main.componentList.currentCategory==thisClass.currentPack.id){$("#mfCatInputTxt").text(thisClass.currentPack.nameLabel);mf_main.componentList.currentCategoryObj.name=pname;delete mf_main.componentList.cacheCategory[mf_main.componentList.currentCategoryObj.id];delete mf_main.componentList.dbCategories[mf_main.componentList.currentCategoryObj.id];mf_main.componentList.currentCategory="";mf_main.componentList.viewCategory(thisClass.currentPack.id);}else{var cat=mf_main.componentList.currentCategory;mf_main.componentList.currentCategory="";mf_main.componentList.viewCategory(cat);}$("#mfComponentCategoryItemTitle_"+thisClass.currentPack.id).text(pname);}}});};this.openAddComponentHandler=function(){if(mf_main.editorController.componentSelect.length>0){$(".mfCompPackCls").hide();$(".mfAddComponentModelCls").hide();$("#mfAddComponentInputScreen").show();if($("#mfAddDBComponentBtn").css("display")=="block"){$("#mfAddComponentModalTitle").text("For Pack: "+mf_main.componentList.currentCategoryObj.name);}else{$("#mfAddComponentModalTitle").text("For Pack: Saved Components");}mf_main.editorController.disableShortcuts();$("#mfAddComponentModal").modal();$("#mfAddComponentName").val("");}else{MF_Utils.display_ActionIndicator("No components selected in page");}};this.applyTemplate=function(){if(mf_main.RENDER||mf_main.PUBLIC){return;}$("#mfPackListItems").empty();var cachedTemplate=mf_main.getTemplateFromCache("mfComponentPackItemTemplate");if(cachedTemplate==null){$.get("templates/editor/ComponentPackItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfComponentPackItemTemplate").html());mf_main.addTemplateToCache("mfComponentPackItemTemplate",template);thisClass.renderItems(template);});}else{thisClass.renderItems(cachedTemplate);}};this.renderItems=function(template){var i=0;$("#mfPackListItems").empty();var sortableItems="";var sortableCount=0;var len=mf_main.componentList.compArray.length;var htmldom="";for(i=0;i<=len-1;i++){var compitem=mf_main.componentList.compArray[i];if(mf_main.componentList.currentCategoryObj&&compitem.pack){htmldom=htmldom+template(compitem);}if(sortableCount==0){sortableItems="#mfComponentPackItem_"+compitem.n;}else{sortableItems=sortableItems+",#mfComponentPackItem_"+compitem.n;}sortableCount++;}$("#mfPackListItems").append(htmldom);$(".lazycomppackThumb").off("error");$(".lazycomppackThumb").on("error",function(){$(this).hide();});$("#mfPackListItems").sortable({items:sortableItems,placeholder:"mfPackItemPlaceholder",start:function(event,ui){$(ui.item).addClass("mfSortableActiveCls");},stop:function(event,ui){$(ui.item).removeClass("mfSortableActiveCls");thisClass.sortComponentItems();}});$(".mfComponentPackEditCls").on("click",thisClass.openComponentEditModal);thisClass.displayMultiSelectAction();$(".mfComponentPackCheckboxCls").change(function(){thisClass.displayMultiSelectAction();});};this.moveToTopHandler=function(){$($(".mfComponentPackCheckboxCls:checked").get().reverse()).each(function(){var sectionid=$(this).val();var prevSection=$("#mfComponentPackItem_"+sectionid).prev(".mfComponentPackItemCls").prevObject;if(prevSection.length==1){var tmpHtml=$("#mfComponentPackItem_"+sectionid)[0].outerHTML;$("#mfComponentPackItem_"+sectionid).remove();$("#mfPackListItems").prepend(tmpHtml);thisClass.sortComponentItems();}});};this.moveToBottomHandler=function(){var checkboxes=$(".mfComponentPackCheckboxCls:checked");checkboxes.each(function(){var sectionid=$(this).val();var nextSection=$("#mfComponentPackItem_"+sectionid).next(".mfComponentPackItemCls").prevObject;if(nextSection.length==1){var tmpHtml=$("#mfComponentPackItem_"+sectionid)[0].outerHTML;$("#mfComponentPackItem_"+sectionid).remove();$("#mfPackListItems").append(tmpHtml);thisClass.sortComponentItems();}});};this.deleteComponentHandler=function(){var checkboxes=$(".mfComponentPackCheckboxCls:checked");bootbox.confirm("Do you want to delete the selected component(s) ?<br/><br/>Note: This won't affect your wireframes.",function(ans){if(ans){checkboxes.each(function(){var compdiv=$(this).val();$("#mfComponentPackItem_"+compdiv).remove();var compitem=thisClass.getCompByID(compdiv);thisClass.handleDeleteComponent(compitem);});$(".mfComponentSortCls").hide();}});};this.handleDeleteComponent=function(compitem){var temparray=new Array();for(var i=0;i<mf_main.componentList.compArray.length;i++){var ncompitem=mf_main.componentList.compArray[i];if(ncompitem.n!=compitem.n){temparray.push(ncompitem);}}mf_main.componentList.compArray=temparray;MF_PackManager.deleteComponent(MF_UserSession.getUser(),compitem,mf_main.componentList.currentCategoryObj.id,mf_main.componentList.currentCategoryObj.clientid,{callback:function(){delete mf_main.componentList.cacheCategory[mf_main.componentList.currentCategoryObj.id];delete mf_main.componentList.dbCategories[mf_main.componentList.currentCategoryObj.id];mf_main.componentList.addComponents(mf_main.componentList.currentCategoryObj.id);thisClass.resetMergePackCache();mf_main.componentList.searchComponentHandler();}});};this.openComponentEditModal=function(e){thisClass.selectedComponent=$(this).attr("db-compid");var compitem=thisClass.getCompByID($(this).attr("db-compid"));thisClass.componentImgFileTemp=null;$("#mfComponentNameInput").val(compitem.l);$("#mfSortPackComponentList").hide();$("#mfEditPackComponent").show();$("#mfPackComponentListModal").css("height","330px");$("#mfComponentNameInput").focus();$("#mfComponentImageUploadTempViewImg").attr("src","");$("#mfComponentImageUploadTempViewImg").attr("src",compitem.thumbnail+"?"+new Date().getTime());$("#mfComponentImageUploadTempView img").removeAttr("style");$("#mfEditPackComponentSelectFilter").empty();$("#mfEditPackComponentSelectFilter").append('<option value="">Select Category</option>');for(var i=0;i<mf_main.componentList.currentCategoryObj.filterList.length;i++){var filterItem=mf_main.componentList.currentCategoryObj.filterList[i];var selectedAttr="";if(compitem.filter==filterItem.id){selectedAttr=" selected";$("#mfEditPackComponentSelectFilter option").eq(0).text("Remove Category");}var selectDOM='<option value="'+filterItem.id+'"'+selectedAttr+">"+filterItem.name+"</option>";$("#mfEditPackComponentSelectFilter").append(selectDOM);}};this.componentImgUploadCancel=function(e){$("#mfSortPackComponentList").show();$("#mfEditPackComponent").hide();$("#mfPackComponentListModal").css("height","600px");};this.mfUploadComponentDetails=function(){var componentName=$.trim($("#mfComponentNameInput").val());if(componentName==""){alert("Component name cannot be empty");return;}else{if(thisClass.componentImgFileTemp!=null){thisClass.componentImgUploadhandler();}else{thisClass.updateComponentDetails(null);}}$("#mfPackComponentListModal").css("height","600px");};this.componentImgUploadhandler=function(e){$("#mfEditPackComponent").hide();$("#mfEditPackComponentLoadingScreen").show();var img=new Image();img.setAttribute("crossOrigin","anonymous");img.src=thisClass.img.src;img.onload=function(){var canvas=document.createElement("canvas");canvas.width=img.naturalWidth;canvas.height=img.naturalHeight;var ctx=canvas.getContext("2d");ctx.fillStyle="#FFFFFF";ctx.fill();ctx.drawImage(img,0,0,img.naturalWidth,img.naturalHeight);var dataURL=canvas.toDataURL("image/png");$(canvas).remove();thisClass.updateComponentDetails(dataURL);};};this.updateComponentDetails=function(data_uri){var componentName=$.trim($("#mfComponentNameInput").val());var user=MF_UserSession.getUser();$("#mfEditPackComponent").hide();$("#mfEditPackComponentLoadingScreen").show();var packid=mf_main.componentList.currentCategoryObj.id;var componentFilter=$("#mfEditPackComponentSelectFilter").val().trim();MF_WireframeStoreManager.uploadComponentDetails(user,packid,thisClass.selectedComponent,componentName,data_uri,mf_main.componentList.currentCategoryObj.clientid,componentFilter,{callback:function(){$("#mfSortPackComponentList").show();$("#mfEditPackComponentLoadingScreen").hide();var cpack=mf_main.componentList.currentCategoryObj.id;var compitem=thisClass.getCompByID(thisClass.selectedComponent);$("#mfComponentThumbItem_"+compitem.n).off("load");$("#mfComponentThumbItem_"+compitem.n).on("load",function(){mf_main.componentList.resizeComponentItem(this);});$("#mfComponentThumbItem_"+compitem.n).attr("src","https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+compitem.clientid+"/comppack/"+cpack+"/comp/"+compitem.n+"/thumbnail/"+compitem.n+".png?"+new Date().getTime());var componentName=$.trim($("#mfComponentNameInput").val());$("#mfComponentItem_"+compitem.n+" .mfComponentTitleCls").text(componentName);$("#mfSortPackComponentList").show();$("#mfEditPackComponent").hide();compitem.filter=componentFilter;compitem.l=componentName;for(var i=0;i<mf_main.componentList.currentCategoryObj.componentItemList.length;i++){var componentItem=mf_main.componentList.currentCategoryObj.componentItemList[i];if(compitem.n==componentItem.n){componentItem.l=compitem.l;componentItem.filter=compitem.filter;}}mf_main.componentList.searchComponentHandler();thisClass.applyTemplate();$("#mfComponentThumbPackItem_"+compitem.n).attr("src","https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+compitem.clientid+"/comppack/"+cpack+"/comp/"+compitem.n+"/thumbnail/"+compitem.n+".png?"+new Date().getTime());thisClass.resetMergePackCache();}});};this.componentUploadFileSelectHandler=function(e){thisClass.componentImgFileTemp=null;var file=document.getElementById("mfComponentImageUploadFile").files[0];thisClass.handleComponentImageUpload(file);};this.handleComponentImageUpload=function(file){var pass=true;if(file){var fileSize=0;fileSize=parseInt(file.size/1024,10);var ext=file.name.split(".").pop().toLowerCase();if($.inArray(ext,["gif","png","jpg","jpeg"])==-1){alert("Invalid file extension !");return false;}if(!file.type.match(/image.*/)){pass=false;alert("Only images are allowed!");$("#mfComponentImageUploadFile").attr({value:""});return false;}fileSize=fileSize/1000;if(fileSize>10){pass=false;$("#mfComponentImageUploadFile").attr({value:""});alert("The allowed file size is 10 MB or less. Compress your image before uploading.");return false;}if(pass){thisClass.componentImgFileTemp=file;var filename=file.name;var lastIndex=filename.lastIndexOf("\\");if(lastIndex>=0){filename=filename.substring(lastIndex+1);}thisClass.img=new Image();var reader=new FileReader();reader.onload=function(e){thisClass.img.onload=function(){$("#mfComponentImageUploadFile").attr({value:""});$("#mfSortPackComponentList").hide();$("#mfEditPackComponent").show();$("#mfComponentImageUploadTempView img").attr("src",e.target.result);$("#mfComponentImageUploadTempView img").removeAttr("style");thisClass.img.newImgWidth=$("#mfComponentImageUploadTempView img").width();thisClass.img.newImgHeight=$("#mfComponentImageUploadTempView img").height();$("#mfComponentImageUploadTempView img").width(thisClass.img.newImgWidth);$("#mfComponentImageUploadTempView img").height(thisClass.img.newImgHeight);$("#mfComponentImageUploadTempView").show();};thisClass.img.src=e.target.result;thisClass.isImageUpload=false;};reader.readAsDataURL(thisClass.componentImgFileTemp);}}};this.componentImageReset=function(){var cpack=mf_main.componentList.currentCategoryObj.id;var compitem=thisClass.getCompByID(thisClass.selectedComponent);var componentThumbnailURL="https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+compitem.clientid+"/comppack/"+cpack+"/comp/"+compitem.n+"/thumbnail/original/"+compitem.n+".png";thisClass.img=new Image();thisClass.img.onload=function(){$("#mfComponentImageUploadFile").attr({value:""});$("#mfSortPackComponentList").hide();$("#mfEditPackComponent").show();$("#mfComponentImageUploadTempView img").removeAttr("style");thisClass.img.newImgWidth=$("#mfComponentImageUploadTempView img").width();thisClass.img.newImgHeight=$("#mfComponentImageUploadTempView img").height();$("#mfComponentImageUploadTempView img").width(thisClass.img.newImgWidth);$("#mfComponentImageUploadTempView img").height(thisClass.img.newImgHeight);$("#mfComponentImageUploadTempView").show();};var request=new XMLHttpRequest();request.open("GET",componentThumbnailURL,true);request.responseType="blob";request.onload=function(){var reader=new FileReader();reader.readAsDataURL(request.response);reader.onload=function(e){thisClass.componentImgFileTemp=true;thisClass.img.src=e.target.result;$("#mfComponentImageUploadTempView img").attr("src",e.target.result);};};request.send();};this.getCompByID=function(compid){for(i=0;i<=mf_main.componentList.compArray.length-1;i++){var compitem=mf_main.componentList.compArray[i];if(compitem.n==compid){return compitem;}}return null;};this.sortComponentItems=function(){var d=new Date();var count=$("#mfPackListItems").children().length+1;var newarr=new Array();$("#mfPackListItems").children().each(function(){count--;var compitem=thisClass.getCompByID($(this).attr("db-compid"));if(compitem&&compitem.pack){compitem.sort=count;newarr.push(compitem);}});MF_PackManager.sortComponents(newarr,mf_main.componentList.currentCategoryObj.id,{callback:function(){delete mf_main.componentList.cacheCategory[mf_main.componentList.currentCategoryObj.id];delete mf_main.componentList.dbCategories[mf_main.componentList.currentCategoryObj.id];mf_main.componentList.addComponents(mf_main.componentList.currentCategoryObj.id);}});$(".mfComponentPackEditCls").on("click",thisClass.openComponentEditModal);thisClass.displayMultiSelectAction();$(".mfComponentPackCheckboxCls").change(function(){thisClass.displayMultiSelectAction();});};this.displayMultiSelectAction=function(){var checkboxes=$(".mfComponentPackCheckboxCls:checked");$(".mfComponentSortCls").hide();if(checkboxes.length>0){$(".mfComponentSortCls").show();}};this.openListComponentHandler=function(){thisClass.uiPackListenerConstructor();thisClass.componentImgUploadCancel();$("#mfPackComponentListModal").modal();thisClass.applyTemplate();thisClass.applyFilterTemplate();thisClass.populateMultipleComponentFilterSelect();};this.createComponentLib=function(components){var lib='<library version="1.0">';var customFontXML="";for(var i=0;i<components.length;i++){var componentData=components[i];for(var k=0;k<componentData.componentQueue.length;k++){var currentQueue=componentData.componentQueue[k];var copyXML=currentQueue.componentXML;var grpPresent=false;if(copyXML.attr("groupid")!=""){if(mf_main.editorController.editManager.tempCopyGroups[copyXML.attr("groupid")]){grpPresent=true;}}if(!grpPresent){copyXML.attr("groupid","");}lib=lib+MF_Utils.xmlToString(copyXML);if($(copyXML).find("settings").find('property[name="isGoogleFontUsed"]').text()=="false"){var customFontName=$(copyXML).find("settings").find('property[name="fontType"]').text();customFontXML=customFontXML+mf_main.editorController.fontController.getCustomFontXML(customFontName);}}}if(customFontXML!=""){customFontXML="<mffontcollection>"+customFontXML+"</mffontcollection>";lib=lib+customFontXML;}lib=lib+"<mfGroupList>";for(var c in mf_main.editorController.editManager.tempCopyGroups){var grp=mf_main.editorController.page.groupManager.getGroupByID(c);if(grp){if(mf_main.editorController.editManager.topCopyGroups[grp.GROUPID]){lib=lib+grp.getXML(true);}else{lib=lib+grp.getXML();}}}lib=lib+"</mfGroupList>";lib=lib+"</library>";return lib;};this.addNewComponent=function(){mf_main.editorController.saveProject(false);var componentName=$.trim($("#mfAddComponentName").val());if(componentName==""){alert("Component name cannot be empty");return;}var catObj=mf_main.componentList.currentCategoryObj;if($("#mfAddDBComponentBtn").css("display")=="block"){}else{newpack=new MF_CompCategory();newpack.id=mf_main.editorController.projectObj.id;newpack.clientid=mf_main.editorController.projectObj.company;newpack.name="Saved Components";newpack.modify=true;newpack.custompack=true;newpack.isMaster=true;newpack.isShared=false;newpack.includeCommon=false;newpack.masterClientid=mf_main.editorController.projectObj.company;newpack.isProjectPack=true;catObj=newpack;}mf_main.editorController.editManager.tempCopyGroups=new Object();mf_main.editorController.editManager.topCopyGroups=new Object();var cmplist=new Array();for(var i=0;i<mf_main.editorController.componentSelect.length;i++){var cselect=mf_main.editorController.componentSelect[i];if(cselect.GROUP&&cselect.GLOBAL_SELECT&&cselect.GROUPID!=""&&!mf_main.editorController.editManager.tempCopyGroups[cselect.GROUPID]){mf_main.editorController.editManager.topCopyGroups[cselect.GROUPID]=true;mf_main.editorController.editManager.addChildGroups(cselect.GROUPID,cmplist);}}var exportObj=mf_main.editorController.editManager.exportComponents();var components=exportObj.components;var images=exportObj.images;if(components.length>0){$(".mfAddComponentModelCls").hide();$("#mfAddComponentLoadingScreen").show();var lib=thisClass.createComponentLib(components);var componentItem=new MF_ComponentItem();componentItem.n=MF_Utils.guidGenerator();componentItem.l=componentName;componentItem.db=true;componentItem.clientid=catObj.clientid;componentItem.pack=true;componentItem.packid=catObj.id;if(catObj.includeCommon){componentItem.sort=mf_main.componentList.compArray.length-mf_main.componentList.featuredComponents.length+1;}else{componentItem.sort=mf_main.componentList.compArray.length+1;}MF_PackManager.addComponent(lib,componentItem,catObj.id,catObj.clientid,mf_main.editorController.projectObj,MF_UserSession.getUser(),images,mf_main.editorController.page.eid,{callback:function(result){mf_main.closeDialog();if(result=="fail"){alert("Error occurred");}else{MF_Utils.display_ActionIndicator("Component has been added to this pack");delete mf_main.componentList.cacheCategory[catObj.id];delete mf_main.componentList.dbCategories[catObj.id];mf_main.componentList.addComponents(catObj.id);mf_main.editorController.openNavBarContent("mfNavElementBtn");thisClass.resetMergePackCache();mf_main.rtc.compSync("uipackUpdate",catObj.id);}}});}else{alert("No components selected in page");}};this.exportComponentAsImage=function(callback){if(MF_UserSession.getUser().isBasic){alert("Selective export is not supported in free plan");return;}$("#mfAddComponentModalTitle").html("&nbsp;");if(typeof(callback)=="function"){$("#mfAddComponentModal").modal("hide");callback("loading");}else{$("#mfAddComponentModal").modal();}mf_main.editorController.editManager.tempCopyGroups=new Object();mf_main.editorController.editManager.topCopyGroups=new Object();var cmplist=new Array();for(var i=0;i<mf_main.editorController.componentSelect.length;i++){var cselect=mf_main.editorController.componentSelect[i];if(cselect.GROUP&&cselect.GLOBAL_SELECT&&cselect.GROUPID!=""&&!mf_main.editorController.editManager.tempCopyGroups[cselect.GROUPID]){mf_main.editorController.editManager.topCopyGroups[cselect.GROUPID]=true;mf_main.editorController.editManager.addChildGroups(cselect.GROUPID,cmplist);}}thisClass.isExportComponentAsImage=true;var exportObj=mf_main.editorController.editManager.exportComponents();var components=exportObj.components;var images=exportObj.images;if(components.length>0){var lib=thisClass.createComponentLib(components);$(".mfAddComponentModelCls").hide();$("#mfAddComponentLoadingScreen").show();var compid=MF_Utils.guidGenerator();MF_PackManager.exportComponentAsImage(MF_UserSession.getUser(),lib,compid,mf_main.editorController.projectObj,mf_main.editorController.page.eid,{callback:function(result){if(result=="fail"){mf_main.closeDialog();alert("Error Occurred");}else{var imgurl="https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/fileexport/"+compid+".png";if(mf_main.INTEGRATION){if(integrationController){integrationController.exportSelectionToIntegration(imgurl);}}else{if(typeof(callback)=="function"){callback(imgurl);}else{$(".mfAddComponentModelCls").hide();$("#mfExportImgCompDownloadBtn").attr("href",imgurl);$("#mfAddComponentDownloadScreen").show();}}}thisClass.isExportComponentAsImage=false;}});}else{thisClass.isExportComponentAsImage=false;mf_main.closeDialog();alert("No components selected in page");}};this.submitPackHandler=function(){var packNameInput=$("#mfPackNameInput");var isIncludeCommonPack=$("#mfToggleCompPackIncludeCommon");if(mf_main.componentList.isNewMergePack==true){packNameInput=$("#mfMergePackNameInput");isIncludeCommonPack=$("#mfToggleMergePackIncludeCommon");}var pname=$.trim(packNameInput.val());if(pname==""){alert("Name cannot be empty");return;}var newpack=new MF_CompCategory();newpack.id=MF_Utils.guidGenerator()+"___DBPACK";newpack.clientid=MF_UserSession.getUser().company;newpack.name=pname;newpack.builtin=false;newpack.modify=true;newpack.custompack=true;newpack.importcategory="none";newpack.isMaster=true;newpack.isShared=false;newpack.masterClientid=MF_UserSession.getUser().company;if(isIncludeCommonPack.is(":checked")){newpack.includeCommon=true;}else{newpack.includeCommon=false;}if(mf_main.componentList.isNewMergePack==true){newpack.isMergeablePack=true;}else{newpack.isMergeablePack=false;}if(MF_UserSession.getUser().isBasic&&!newpack.isMergeablePack){bootbox.confirm("Basic plan does not allow custom UI packs. Ask your license administrator to upgrade your account OR purchase a license",function(ans){if(ans){mf_main.openUpgradeDialog();}});return;}else{if(MF_UserSession.getUser().isBasic){bootbox.confirm("Basic plan does not allow merging of multiple UI packs. Ask your license administrator to upgrade your account OR purchase a license",function(ans){if(ans){mf_main.openUpgradeDialog();}});return;}}$("#mfCatInputTxt").text(pname);mf_main.componentList.showComponentPlaceHolder();$(".mfCompPackCls").hide();$("#mfCompPackLoadDiv").show();mf_main.closeDialog();MF_PackManager.createNewPack(MF_UserSession.getUser(),newpack,mf_main.editorController.projectObj.id,{callback:function(result){if(mf_main.componentList.isNewMergePack==true){var packdata=mf_main.componentList.mergePackHandler();if(packdata!=null){newpack.mergeablePackData=packdata;MF_PackManager.updateMergeablePackData(MF_UserSession.getUser(),newpack.id,packdata,mf_main.editorController.projectObj,mf_main.editorController.teamClientList,{callback:function(result2){thisClass.newPackCreateCommon(packNameInput,newpack);delete mf_main.componentList.dbCategories[newpack.id];mf_main.componentList.addComponentCallBack(newpack.id);mf_main.componentList.categories=new Array();mf_main.componentList.categoryListed=false;mf_main.componentList.mergeablePackMode=false;mf_main.componentList.addCategories();mf_main.componentList.listCategories();}});}else{thisClass.newPackCreateCommon(packNameInput,newpack);}}else{thisClass.newPackCreateCommon(packNameInput,newpack);}}});};this.newPackCreateCommon=function(packNameInput,newpack){packNameInput.val("");$("#mfCategoryListSearchBox").val("");MF_Utils.display_ActionIndicator("Pack created!");mf_main.componentList.categories.push(newpack);mf_main.componentList.mergeablePackMode=false;var cachedCatTemplate=mf_main.getTemplateFromCache("mfComponentCategoryItemTemplate");mf_main.componentList.renderCategoryItems(cachedCatTemplate);mf_main.componentList.viewCategory(newpack.id);};this.goBackListHandler=function(){$(".mfCompPackCls").hide();$("#mfNewMergePackForm, .mfCompCategoryTitleCls").hide();$("#mfCompListingTitle").show();if(mf_main.componentList.isNewMergePack==true){mf_main.componentList.isNewMergePack=false;mf_main.componentList.mergeablePackMode=false;mf_main.componentList.listCategoriesHandler();}else{$("#mfCompPackListDiv").show();}};this.openShareUIpackPopup=function(){if(mf_main.componentList.currentCategory==mf_main.editorController.projectObj.id){$("#mfCloneUIPackLoadingScreen").hide();$("#mfCloneUIPackInputScreen").show();$("#mfCloneUIPackTitle").val("");$("#mfCloneUIPack").modal();$("#mfCloneUIPackTitle").focus();}else{thisClass.uiPackListenerConstructor();thisClass.updateSharePackModal();}};this.cloneUIPackHandler=function(){if(MF_UserSession.getUser().isBasic){alert("Clone UI pack is not supported in free plan");return;}if(mf_main.componentList.compArray&&mf_main.componentList.compArray.length==0){alert("There no saved components to clone");return;}var pname=$.trim($("#mfCloneUIPackTitle").val());if(pname==""){alert("Pack name cannot be empty");return;}var newpack=new MF_CompCategory();newpack.id=MF_Utils.guidGenerator()+"___DBPACK";newpack.clientid=mf_main.editorController.projectObj.company;newpack.name=pname;newpack.builtin=false;newpack.modify=true;newpack.custompack=true;newpack.importcategory="none";newpack.isMaster=true;newpack.isShared=false;newpack.masterClientid=mf_main.editorController.projectObj.company;$("#mfCloneUIPackLoadingScreen").show();$("#mfCloneUIPackInputScreen").hide();MF_PackManager.cloneUIPack(MF_UserSession.getUser(),mf_main.componentList.currentCategoryObj,newpack,{callback:function(res){mf_main.closeDialog();alert("Pack cloned. Now this UI Pack is available across all projects for all team members");mf_main.componentList.categories.push(newpack);var cachedCatTemplate=mf_main.getTemplateFromCache("mfComponentCategoryItemTemplate");mf_main.componentList.renderCategoryItems(cachedCatTemplate);mf_main.componentList.viewCategory(newpack.id);}});};this.openEditUIpackPopup=function(){thisClass.uiPackListenerConstructor();$("#mfStoreShareUiPackBtn").hide();$("#mfStoreEditUiPackBtn").show();$("#mfStoreDeleteUiPackBtn").show();var iconImg=new Image();var packid=mf_main.componentList.currentCategoryObj.id;iconImg.onload=function(){$("#mfCustomPackIconUploadImg").attr("src","https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/uipack/"+packid+"/preview/thumb/"+packid+".png?"+new Date().getTime());$("#mfpackIconDelete").show();};iconImg.src="https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/uipack/"+packid+"/preview/thumb/"+packid+".png?"+new Date().getTime();MF_WireframeStoreManager.getStorePackById(MF_UserSession.getUser(),mf_main.componentList.currentCategoryObj.id,{callback:function(result){var store=result;if(result){$("#mfPackDescriptionInput").val(store.description);var typeDropdownList=$("#mfSelectStoreTemplate").data("kendoDropDownList");typeDropdownList.value(result.type);thisClass.currentPackStoreId=result.id;if(result.includeCommon){$("#mfToggleIncludeCommon").prop("checked",true);}else{$("#mfToggleIncludeCommon").prop("checked",false);}if(result.modeType=="designmode"){$("#mfToggleIncludeDesignMode").prop("checked",true);}else{$("#mfToggleIncludeDesignMode").prop("checked",false);}var thumbnailImg=new Image();thumbnailImg.onload=function(){$("#mfCustomPackThumbnailUploadImg").attr("src","https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/store/"+store.id+"/preview/thumb/"+store.id+".png?"+new Date().getTime());$("#mfpackThumbnailDelete").show();};thumbnailImg.src="https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/store/"+store.id+"/preview/thumb/"+store.id+".png?"+new Date().getTime();$("#mfCustomPackPreviewUploadImg").attr("src","https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/store/"+store.id+"/preview/"+store.id+".png?"+new Date().getTime());}}});thisClass.updateSharePackModal();};this.updateSharePackModal=function(){$("#mfSharePackLoadingScreen").hide();$("#mfSharePackInputScreen").show();mf_main.editorController.shortcutsFlag=false;$("#mfStorePackNameInput").val(mf_main.componentList.currentCategoryObj.name);thisClass.uploadIconFile=null;thisClass.uploadThumbnailFile=null;thisClass.uploadPreviewFile=null;thisClass.isIconDeleted=false;thisClass.isThumbnailDeleted=false;if(mf_main.componentList.currentCategoryObj.includeCommon){$("#mfToggleIncludeCommon").prop("checked",true);}else{$("#mfToggleIncludeCommon").prop("checked",false);}if(mf_main.componentList.currentCategoryObj.modeType=="designmode"){$("#mfToggleIncludeDesignMode").prop("checked",true);}else{$("#mfToggleIncludeDesignMode").prop("checked",false);}$("#mfCustomPackIconUpload").attr({value:""});$("#mfCustomPackThumbnailUpload").attr({value:""});$("#mfCustomPackPreviewUpload").attr({value:""});$("#mfPackDescriptionInput").val("");$(".mfpackImgDelete").hide();$("#mfCustomPackIconUploadImg").attr("src","images/editor/category/custom.png");$("#mfCustomPackThumbnailUploadImg").attr("src","images/store/uiPackThumbnail.png");$("#mfCustomPackPreviewUploadImg").attr("src","images/store/uiPackPreview.png");$("#mfSharePackDetailsModal").modal();};this.shareUIpackHandler=function(){var temptype=$("#mfSelectStoreTemplate").data("kendoDropDownList").dataItem().value;var pname=$.trim($("#mfStorePackNameInput").val());if(pname==""){alert("Pack name cannot be empty");return;}if(temptype==""){alert("Select UI pack type");return;}if($("#mfCustomPackPreviewUpload").val()==""){alert("Select UI pack preview image");return;}$("#mfSharePackLoadingScreen").show();$("#mfSharePackInputScreen").hide();var storeTemplate=new MF_StoreTemplate();storeTemplate.id=MF_Utils.guidGenerator();storeTemplate.name=mf_main.componentList.currentCategoryObj.name;storeTemplate.type=temptype;storeTemplate.packId=mf_main.componentList.currentCategory;storeTemplate.submitter=MF_UserSession.getUser().username;storeTemplate.submitterName=MF_UserSession.getUser().firstName+" "+MF_UserSession.getUser().lastName;storeTemplate.clientId=mf_main.componentList.currentCategoryObj.clientid;storeTemplate.itemType="uipack";storeTemplate.description=$.trim($("#mfPackDescriptionInput").val());thisClass.currentPackStoreId=storeTemplate.id;if($("#mfToggleIncludeCommon").is(":checked")){storeTemplate.includeCommon=true;}else{storeTemplate.includeCommon=false;}if($("#mfToggleIncludeDesignMode").is(":checked")){storeTemplate.modeType="designmode";}else{storeTemplate.modeType=null;}var images=[];MF_WireframeStoreManager.addStoreUIpack(storeTemplate,mf_main.editorController.page.eid,MF_UserSession.getUser(),mf_main.editorController.projectObj,{callback:function(result){if(result==null){$("#mfSharePackLoadingScreen").hide();$("#mfSharePackInputScreen").show();mf_main.closeDialog();alert("Cannot add UI pack to MockStore. Note: Only pack creator or license admin can make changes.");}else{thisClass.packAssetUploadCount=0;$(".mfSharePackDetailsIcon").hide();$(".mfEditPackDetailsIcon").show();if(thisClass.uploadIconFile!=null){thisClass.addPackIconHandler();}else{thisClass.packAssetUploadCount++;thisClass.packAssetUploadComplete();}if(thisClass.uploadThumbnailFile!=null){thisClass.addPackThumbnailHandler();}else{thisClass.packAssetUploadCount++;thisClass.packAssetUploadComplete();}if(thisClass.uploadPreviewFile!=null){thisClass.addPackPreviewHandler();}else{thisClass.packAssetUploadCount++;thisClass.packAssetUploadComplete();}}}});};this.deleteUIpackHandler=function(e){bootbox.confirm("Do you want to remove this UI Pack from store ? <br/><br/>Note: This won't delete this custom pack but will remove from MockStore.<br/><br/>Only pack creator or license admin can perform this operation..",function(ans){if(ans){mf_main.closeDialog();try{$("#mfStoreTemplateListing").show();$("#mfStoreItem"+mf_main.componentList.currentCategoryObj.id).remove();}catch(e){}if(MF_Global.adminAllow()){$(".mfSharePackDetailsIcon").show();}$(".mfEditPackDetailsIcon").hide();MF_WireframeStoreManager.deleteTemplateStore(MF_UserSession.getUser(),mf_main.componentList.currentCategoryObj.id,{callback:function(result){if(result==false){$(".mfSharePackDetailsIcon").hide();$(".mfEditPackDetailsIcon").show();alert("Error occurred.");}else{mf_main.componentList.currentCategoryObj.isShared=false;}}});}});};this.editUIpackHandler=function(e){var temptype=$("#mfSelectStoreTemplate").data("kendoDropDownList").dataItem().value;var pname=$.trim($("#mfStorePackNameInput").val());if(pname==""){alert("Pack name cannot be empty");return;}if(temptype==""){alert("Select UI pack type");return;}$("#mfSharePackLoadingScreen").show();$("#mfSharePackInputScreen").hide();var storeTemplate=new MF_StoreTemplate();storeTemplate.id=MF_Utils.guidGenerator();storeTemplate.name=pname;storeTemplate.type=temptype;storeTemplate.packId=mf_main.componentList.currentCategory;storeTemplate.submitter=MF_UserSession.getUser().username;storeTemplate.submitterName=MF_UserSession.getUser().firstName+" "+MF_UserSession.getUser().lastName;storeTemplate.clientId=mf_main.componentList.currentCategoryObj.clientid;storeTemplate.itemType="uipack";storeTemplate.description=$.trim($("#mfPackDescriptionInput").val());if($("#mfToggleIncludeCommon").is(":checked")){storeTemplate.includeCommon=true;}else{storeTemplate.includeCommon=false;}if($("#mfToggleIncludeDesignMode").is(":checked")){storeTemplate.modeType="designmode";}else{storeTemplate.modeType=null;}MF_WireframeStoreManager.updateUIPack(storeTemplate,MF_UserSession.getUser(),{callback:function(result){if(result==null){$("#mfSharePackLoadingScreen").show();$("#mfSharePackInputScreen").hide();mf_main.closeDialog();alert("Cannot update UI pack. Note: Only pack creator or license admin can make changes.");}else{thisClass.packAssetUploadCount=0;$(".mfSharePackDetailsIcon").hide();$(".mfEditPackDetailsIcon").show();if(thisClass.uploadIconFile!=null){thisClass.addPackIconHandler();}else{thisClass.packAssetUploadCount++;thisClass.packAssetUploadComplete();}if(thisClass.uploadThumbnailFile!=null){thisClass.addPackThumbnailHandler();}else{thisClass.packAssetUploadCount++;thisClass.packAssetUploadComplete();}if(thisClass.uploadPreviewFile!=null){thisClass.addPackPreviewHandler();}else{thisClass.packAssetUploadCount++;thisClass.packAssetUploadComplete();}if(thisClass.uploadIconFile==null&&thisClass.uploadThumbnailFile==null&&thisClass.uploadPreviewFile==null){var cpack=mf_main.componentList.currentCategoryObj.id;delete mf_main.componentList.cacheCategory[cpack];delete mf_main.componentList.dbCategories[cpack];mf_main.componentList.addComponents(cpack);}var packId=mf_main.componentList.currentCategory;if(thisClass.isIconDeleted){MF_WireframeStoreManager.deleteUIPackAsset(MF_UserSession.getUser(),packId,mf_main.componentList.currentCategoryObj.clientid,thisClass.currentPackStoreId,"icon",{callback:function(result){}});}if(thisClass.isThumbnailDeleted){MF_WireframeStoreManager.deleteUIPackAsset(MF_UserSession.getUser(),packId,mf_main.componentList.currentCategoryObj.clientid,thisClass.currentPackStoreId,"thumbnail",{callback:function(result){}});}}}});};this.openIconSelectHandler=function(e){$("#mfCustomPackIconUpload").click();};this.openThumbnailSelectHandler=function(e){$("#mfCustomPackThumbnailUpload").click();};this.openPreviewSelectHandler=function(e){$("#mfCustomPackPreviewUpload").click();};this.iconUploadFileSelectHandler=function(e){var type=$(this).attr("id");var file;if(type=="mfCustomPackIconUpload"){thisClass.packImageUploadType="icon";file=document.getElementById("mfCustomPackIconUpload").files[0];}else{if(type=="mfCustomPackThumbnailUpload"){thisClass.packImageUploadType="thumbnail";file=document.getElementById("mfCustomPackThumbnailUpload").files[0];}else{if(type=="mfCustomPackPreviewUpload"){thisClass.packImageUploadType="preview";file=document.getElementById("mfCustomPackPreviewUpload").files[0];}else{}}}thisClass.handleFileUpload(file);};this.handleFileUpload=function(file){var pass=true;var mfImageid;if(thisClass.packImageUploadType=="icon"){mfImageid="#mfCustomPackIconUpload";}else{if(thisClass.packImageUploadType=="thumbnail"){mfImageid="#mfCustomPackThumbnailUpload";}else{if(thisClass.packImageUploadType=="preview"){mfImageid="#mfCustomPackPreviewUpload";}else{}}}if(file){var fileSize=0;fileSize=parseInt(file.size/1024,10);var ext=file.name.split(".").pop().toLowerCase();if($.inArray(ext,["gif","png","jpg","jpeg"])==-1){alert("Invalid file extension !");return false;}if(!file.type.match(/image.*/)){pass=false;alert("Only images are allowed!");$(mfImageid).attr({value:""});return false;}fileSize=fileSize/1000;if(fileSize>50){pass=false;$(mfImageid).attr({value:""});alert("The allowed file size is 50 MB or less. Compress your image before uploading.");return false;}if(pass){var filename=file.name;var lastIndex=filename.lastIndexOf("\\");if(lastIndex>=0){filename=filename.substring(lastIndex+1);}thisClass.img=new Image();var reader=new FileReader();reader.onload=function(e){thisClass.img.onload=function(){if(thisClass.packImageUploadType=="icon"){if(this.width<=600&&this.height<=600){thisClass.uploadIconFile=file;$("#mfCustomPackIconUploadImg").attr("src",e.target.result);$("#mfpackIconDelete").show();}else{alert("The icon size should be maximum 600x600 pixels");return false;}}else{if(thisClass.packImageUploadType=="thumbnail"){if(this.width==200&&this.height==200){thisClass.uploadThumbnailFile=file;$("#mfCustomPackThumbnailUploadImg").attr("src",e.target.result);$("#mfpackThumbnailDelete").show();}else{alert("The icon size should be exact 200x200 pixels");return false;}}else{if(thisClass.packImageUploadType=="preview"){thisClass.uploadPreviewFile=file;$("#mfCustomPackPreviewUploadImg").attr("src",e.target.result);}else{}}}};thisClass.img.src=e.target.result;};reader.readAsDataURL(file);}}};this.addPackIconHandler=function(){var fd=new FormData();var packId=mf_main.componentList.currentCategory;fd.append("id",packId);fd.append("size",(parseInt(thisClass.uploadIconFile.size/1024,10)).toString());fd.append("name","Html 5 File API/FormData");fd.append("fileToUpload",thisClass.uploadIconFile);fd.append("mime",thisClass.uploadIconFile.type);fd.append("username",MF_UserSession.getUser().username);fd.append("imagecategory","icon");var xhr=new XMLHttpRequest();xhr.addEventListener("load",thisClass.iconUploadComplete,false);xhr.addEventListener("error",thisClass.packImageUploadFailed,false);xhr.addEventListener("abort",thisClass.packImageUploadCanceled,false);xhr.open("POST","uipackimageupload");xhr.send(fd);};this.addPackThumbnailHandler=function(){var fd=new FormData();fd.append("id",thisClass.currentPackStoreId);fd.append("size",(parseInt(thisClass.uploadThumbnailFile.size/1024,10)).toString());fd.append("name","Html 5 File API/FormData");fd.append("fileToUpload",thisClass.uploadThumbnailFile);fd.append("mime",thisClass.uploadThumbnailFile.type);fd.append("username",MF_UserSession.getUser().username);fd.append("imagecategory","thumbnail");var xhr=new XMLHttpRequest();xhr.addEventListener("load",thisClass.thumbnailUploadComplete,false);xhr.addEventListener("error",thisClass.packImageUploadFailed,false);xhr.addEventListener("abort",thisClass.packImageUploadCanceled,false);xhr.open("POST","uipackimageupload");xhr.send(fd);};this.addPackPreviewHandler=function(){var fd=new FormData();fd.append("id",thisClass.currentPackStoreId);fd.append("size",(parseInt(thisClass.uploadPreviewFile.size/1024,10)).toString());fd.append("name","Html 5 File API/FormData");fd.append("fileToUpload",thisClass.uploadPreviewFile);fd.append("mime",thisClass.uploadPreviewFile.type);fd.append("username",MF_UserSession.getUser().username);fd.append("imagecategory","preview");var xhr=new XMLHttpRequest();xhr.addEventListener("load",thisClass.previewUploadComplete,false);xhr.addEventListener("error",thisClass.packImageUploadFailed,false);xhr.addEventListener("abort",thisClass.packImageUploadCanceled,false);xhr.open("POST","uipackimageupload");xhr.send(fd);};this.iconUploadComplete=function(evt){thisClass.uploadIconFile=null;thisClass.packAssetUploadCount++;thisClass.packAssetUploadComplete();};this.thumbnailUploadComplete=function(evt){thisClass.uploadThumbnailFile=null;thisClass.packAssetUploadCount++;thisClass.packAssetUploadComplete();};this.previewUploadComplete=function(evt){thisClass.uploadPreviewFile=null;thisClass.packAssetUploadCount++;thisClass.packAssetUploadComplete();};this.packAssetUploadComplete=function(evt){if(thisClass.packAssetUploadCount==3){if(mf_main.componentList.currentCategoryObj.isShared==true){alert("UI pack has been updated");}else{alert("UI pack has been submitted to MockStore for review. After approval it will display in the store");mf_main.componentList.currentCategoryObj.isShared=true;}mf_main.closeDialog();}};this.packImageUploadFailed=function(evt){alert("There was an error attempting to upload the file.");};this.packImageUploadCanceled=function(evt){alert("The upload has been canceled by the user or the browser dropped the connection.");};this.deleteUIpackIcon=function(evt){$("#mfpackIconDelete").hide();$("#mfCustomPackIconUploadImg").attr("src","images/editor/category/custom.png");$("#mfCustomPackIconUpload").attr({value:""});thisClass.uploadIconFile=null;thisClass.isIconDeleted=true;};this.deleteUIpackThumbnail=function(evt){$("#mfpackThumbnailDelete").hide();$("#mfCustomPackThumbnailUploadImg").attr("src","images/store/uiPackThumbnail.png");$("#mfCustomPackThumbnailUpload").attr({value:""});thisClass.uploadThumbnailFile=null;thisClass.isThumbnailDeleted=true;};this.deleteMPackCacheHandler=function(){$.each(mf_main.componentList.dbCategories,function(index,jsonObject){if(mf_main.componentList.dbCategories[index]&&mf_main.componentList.dbCategories[index].isMergeablePack){delete mf_main.componentList.dbCategories[mf_main.componentList.dbCategories[index].id];}});};this.toggleEditPackContainer=function(){var selectedTab=$(this).attr("data-tabitem");if(selectedTab=="components"){$("#mfEditPackComponentsContainer").show();$("#mfEditPackCategoriesContainer").hide();}else{if(selectedTab=="categories"){thisClass.componentImgUploadCancel();$("#mfEditPackCategoriesContainer").show();$("#mfEditPackComponentsContainer").hide();}}$("#mfPackComponentListModal").css("height","600px");};this.addComponentFilterHandler=function(e){e.preventDefault();var categoryName=$("#mfEditPackNewFilterName").val().trim();if(categoryName.length==0){MF_Utils.display_ActionIndicator("Category name is required");}else{if(categoryName.length>50){MF_Utils.display_ActionIndicator("Category name should be a maximum of 50 characters");}else{var sortorder=mf_main.componentList.currentCategoryObj.filterList.length+1;var filter=new MF_CompFilter();filter.id=MF_Utils.guidGenerator();filter.name=categoryName;filter.packid=mf_main.componentList.currentCategoryObj.id;filter.clientid=mf_main.componentList.currentCategoryObj.clientid;filter.sort=sortorder;mf_main.componentList.currentCategoryObj.filterList.push(filter);mf_main.componentList.currentComponentFilterList[filter.id]=filter;var cachedTemplate=mf_main.getTemplateFromCache("mfComponentFilterItemTemplate");if(cachedTemplate!=null){var htmldom=cachedTemplate(filter);$("#mfEditPackFiltersList").append(htmldom);}$("#mfEditPackFiltersList").scrollTop($("#mfEditPackFiltersList").height());$("#mfEditPackFilterListHelp").show();$("#mfEditPackNewFilterName").val("");thisClass.listPackFiltersHandler();thisClass.populateMultipleComponentFilterSelect();thisClass.refreshFilterListEvents();thisClass.resetMergePackCache();MF_PackManager.addComponentFilter(MF_UserSession.getUser(),filter,{callback:function(result){MF_Utils.display_ActionIndicator("Category added successfully");}});}}};this.applyFilterTemplate=function(){var cachedTemplate=mf_main.getTemplateFromCache("mfComponentFilterItemTemplate");if(cachedTemplate==null){$.get("templates/editor/ComponentFilterItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfComponentFilterItemTemplate").html());mf_main.addTemplateToCache("mfComponentFilterItemTemplate",template);thisClass.renderFilterItems(template);});}else{thisClass.renderFilterItems(cachedTemplate);}};this.renderFilterItems=function(template){$("#mfEditPackFiltersList").empty();for(var i=0;i<mf_main.componentList.currentCategoryObj.filterList.length;i++){var filterItem=mf_main.componentList.currentCategoryObj.filterList[i];var htmldom=template(filterItem);$("#mfEditPackFiltersList").append(htmldom);}if(mf_main.componentList.currentCategoryObj.filterList.length>0){$("#mfEditPackFilterListHelp").show();}else{$("#mfEditPackFilterListHelp").hide();}thisClass.refreshFilterListEvents();};this.refreshFilterListEvents=function(){if($("#mfEditPackFiltersList").hasClass("ui-sortable")){$("#mfEditPackFiltersList").sortable("destroy");}$("#mfEditPackFiltersList").sortable({placeholder:"mfEditPackFiltersListPlaceholder",helper:"clone",update:function(event,ui){thisClass.sortFiltersHandler();}});$(".mfComponentFilterItemDelete").tooltip("destroy");$(".mfComponentFilterItemDelete").tooltip({trigger:"hover"});$(".mfComponentFilterItemDelete").off("click");$(".mfComponentFilterItemDelete").on("click",thisClass.deleteFilterHandler);$(".mfComponentFilterItemName").off("dblclick");$(".mfComponentFilterItemName").on("dblclick",thisClass.enableCategoryEdit);};this.deleteFilterHandler=function(){var filterId=$(this).attr("data-filterid");bootbox.confirm("Remove this category?<br/><br/>Note: This won't delete the components associated with this category",function(ans){if(ans){var deleteFilterObj=null;for(var i=0;i<mf_main.componentList.currentCategoryObj.filterList.length;i++){var categoryItem=mf_main.componentList.currentCategoryObj.filterList[i];if(filterId==categoryItem.id){var deletedItems=mf_main.componentList.currentCategoryObj.filterList.splice(i,1);delete mf_main.componentList.currentComponentFilterList[filterId];if(deletedItems.length>0){deleteFilterObj=deletedItems[0];}break;}}$("#mfComponentFilterItem_"+filterId).remove();if(mf_main.componentList.currentCategoryObj.filterList.length>0){$("#mfEditPackFilterListHelp").show();}else{$("#mfEditPackFilterListHelp").hide();}if(mf_main.componentList.currentComponentFilter==filterId){$("#mfComponentSearchBox").val("");mf_main.componentList.currentComponentFilter=null;mf_main.componentList.searchComponentHandler();}thisClass.listPackFiltersHandler();thisClass.populateMultipleComponentFilterSelect();for(var i=0;i<mf_main.componentList.currentCategoryObj.componentItemList.length;i++){var componentItem=mf_main.componentList.currentCategoryObj.componentItemList[i];if(filterId==componentItem.filter){componentItem.filter="";}}thisClass.applyTemplate();thisClass.resetMergePackCache();MF_PackManager.deleteComponentFilter(MF_UserSession.getUser(),deleteFilterObj,{callback:function(result){MF_Utils.display_ActionIndicator("Category deleted successfully");}});}});};this.sortFiltersHandler=function(){var filterList=mf_main.componentList.currentCategoryObj.filterList;var newFilterList=[];var sortorder=1;$("#mfEditPackFiltersList .mfComponentFilterItem").each(function(){for(var i=0;i<filterList.length;i++){if(filterList[i].id==$(this).attr("data-filterid")){filterList[i].sort=sortorder;newFilterList.push(filterList[i]);break;}}sortorder++;});mf_main.componentList.currentCategoryObj.filterList=newFilterList;thisClass.listPackFiltersHandler();thisClass.resetMergePackCache();MF_PackManager.updateFilterSortorder(MF_UserSession.getUser(),newFilterList,mf_main.componentList.currentCategoryObj.id,{callback:function(data){}});};this.listPackFiltersHandler=function(){$(".mfPackFiltersMenu").empty();if(mf_main.componentList.currentCategoryObj.filterList.length==0){$("#mfComponentSearchIcon").show();$("#mfComponentSearchFilterTrigger").hide();$("#mfComponentSearchFilterDisplay").hide();$("#mfComponentSearchBox").width(170);}else{$("#mfComponentSearchIcon").hide();$("#mfComponentSearchFilterTrigger").show();$("#mfComponentSearchFilterDisplay").show();$("#mfComponentSearchBox").width(100);}mf_main.componentList.currentComponentFilterList={};var htmldom="";htmldom="<li id='' data-filterid='' data-filtername='' class='mfComponentFilterCls'><span class='mfComponentCategoryNameCls'>All Categories</span></li>";if(mf_main.componentList.currentCategoryObj.isMergeablePack){var packCollection={};var mergeablePackData=JSON.parse(mf_main.componentList.currentCategoryObj.mergeablePackData);for(var i=0;i<mf_main.componentList.currentCategoryObj.filterList.length;i++){var filterItem=mf_main.componentList.currentCategoryObj.filterList[i];if(!packCollection.hasOwnProperty(filterItem.packid)){var packCollectionItem={name:"",icon:"",filterList:[]};for(var j=0;j<mergeablePackData.length;j++){if(mergeablePackData[j].id==filterItem.packid){packCollectionItem.name=mergeablePackData[j].name;packCollectionItem.icon=mergeablePackData[j].icon;}}packCollection[filterItem.packid]=packCollectionItem;}packCollection[filterItem.packid].filterList.push(filterItem);mf_main.componentList.currentComponentFilterList[filterItem.id]=filterItem;}for(var packId in packCollection){htmldom=htmldom+"<li id='' class='mfComponentPackCls'><span class='mfComponentCategoryNameCls'><img class='mfPackFilterThumb' src='"+packCollection[packId].icon+"'/> "+packCollection[packId].name+"</span></li>";for(var k=0;k<packCollection[packId].filterList.length;k++){var filterItem=packCollection[packId].filterList[k];var appendHtml="<li id='' data-filterid='"+filterItem.id+"' data-filtername='"+filterItem.name+"' class='mfComponentFilterCls'><span class='mfComponentCategoryNameCls'>"+filterItem.name+"</span></li>";htmldom=htmldom+appendHtml;}}}else{for(var k=0;k<mf_main.componentList.currentCategoryObj.filterList.length;k++){var filterItem=mf_main.componentList.currentCategoryObj.filterList[k];var appendHtml="<li id='' data-filterid='"+filterItem.id+"' data-filtername='"+filterItem.name+"' class='mfComponentFilterCls'><span class='mfComponentCategoryNameCls'>"+filterItem.name+"</span></li>";htmldom=htmldom+appendHtml;mf_main.componentList.currentComponentFilterList[filterItem.id]=filterItem;}}$(".mfPackFiltersMenu").append(htmldom);$(".mfComponentFilterCls").off("click");$(".mfComponentFilterCls").on("click",thisClass.componentFilterClickHandler);if(mf_main.componentList.currentCategoryObj.isMergeablePack){$(".mfPackFilterThumb").off("error");$(".mfPackFilterThumb").on("error",function(){$(this).attr("src","images/editor/category/custom.png");});}mf_main.componentList.currentComponentFilter=null;thisClass.displayFilterName("");mf_main.componentList.searchComponentHandler();};this.componentFilterClickHandler=function(){var filterId=$(this).attr("data-filterid").trim();var filterName=$(this).attr("data-filtername").trim();$(".mfPackFiltersMenuWrapper").removeClass("mfPackFiltersMenuWrapperShow");$("#mfComponentSearchBox").val("");if(!filterId||filterId==""){filterId=null;}mf_main.componentList.currentComponentFilter=filterId;thisClass.displayFilterName(filterName);mf_main.componentList.searchComponentHandler();};this.populateMultipleComponentFilterSelect=function(){$("#mfComponentSortFilter").empty();$("#mfComponentSortFilter").append('<option value="">Select Category</option>');for(var i=0;i<mf_main.componentList.currentCategoryObj.filterList.length;i++){var filterItem=mf_main.componentList.currentCategoryObj.filterList[i];var selectDOM='<option value="'+filterItem.id+'">'+filterItem.name+"</option>";$("#mfComponentSortFilter").append(selectDOM);}$("#mfComponentSortFilter").append('<option value="">Remove Category</option>');$("#mfComponentSortFilter").off("change");$("#mfComponentSortFilter").on("change",thisClass.multipleComponentChangeFilterHandler);};this.multipleComponentChangeFilterHandler=function(){var checkboxes=$(".mfComponentPackCheckboxCls:checked");var selectedFilter=$("#mfComponentSortFilter").val().trim();var selectedComponents=[];checkboxes.each(function(){var compitem=thisClass.getCompByID($(this).val());compitem.filter=selectedFilter;selectedComponents.push(compitem);});thisClass.applyTemplate();$("#mfComponentSortFilter").val("");thisClass.resetMergePackCache();mf_main.componentList.searchComponentHandler();MF_PackManager.updateMultipleComponentFilter(MF_UserSession.getUser(),selectedComponents,mf_main.componentList.currentCategoryObj.id,{callback:function(data){MF_Utils.display_ActionIndicator("Category assigned to the selected component(s)");}});};this.enableCategoryEdit=function(){if($(this).find("#mfEditPackCategoryName").length>0){return false;}var categoryName=$(this).text();$(this).html('<input type="text" id="mfEditPackCategoryName" value="" data-filtername="'+categoryName+'" />');$("#mfEditPackCategoryName").focus();$("#mfEditPackCategoryName").val(categoryName);mf_main.editorController.shortcutsFlag=false;if($("#mfEditPackFiltersList").hasClass("ui-sortable")){$("#mfEditPackFiltersList").sortable("destroy");}$("#mfEditPackCategoryName").off("blur");$("#mfEditPackCategoryName").on("blur",thisClass.inlineEditHandler);$("#mfEditPackCategoryName").off("keyup");$("#mfEditPackCategoryName").on("keyup",function(e){if(e.which&&e.which==13){thisClass.inlineEditHandler();}});};this.inlineEditHandler=function(){if($("#mfEditPackCategoryName").length>0){var updatedCategoryName=$("#mfEditPackCategoryName").val().trim();var existingCategoryName=$("#mfEditPackCategoryName").attr("data-filtername");if(updatedCategoryName.length==0||updatedCategoryName.length>50||updatedCategoryName==existingCategoryName){if(updatedCategoryName.length>50){MF_Utils.display_ActionIndicator("Category name should be a maximum of 50 characters");}$("#mfEditPackCategoryName").closest(".mfComponentFilterItemName").html(existingCategoryName);thisClass.refreshFilterListEvents();return;}var filterId=$("#mfEditPackCategoryName").closest(".mfComponentFilterItemName").attr("data-filterid");var updatedFilterObj=null;for(var i=0;i<mf_main.componentList.currentCategoryObj.filterList.length;i++){var filterItem=mf_main.componentList.currentCategoryObj.filterList[i];if(filterItem.id==filterId){updatedFilterObj=filterItem;}}if(updatedFilterObj!=null){updatedFilterObj.name=updatedCategoryName;mf_main.componentList.currentComponentFilterList[updatedFilterObj.id].name=updatedCategoryName;$("#mfEditPackCategoryName").closest(".mfComponentFilterItemName").html(updatedCategoryName);thisClass.listPackFiltersHandler();thisClass.populateMultipleComponentFilterSelect();thisClass.refreshFilterListEvents();thisClass.applyTemplate();thisClass.resetMergePackCache();MF_PackManager.updateComponentFilter(MF_UserSession.getUser(),updatedFilterObj,{callback:function(result){MF_Utils.display_ActionIndicator("Category updated successfully");}});}}};this.displayFilterName=function(filterName){if(filterName!=""){$("#mfComponentSearchFilterDisplay").text(filterName);}else{$("#mfComponentSearchFilterDisplay").text("All Categories");}};this.resetMergePackCache=function(){for(var k in mf_main.componentList.dbCategories){var cat=mf_main.componentList.dbCategories[k];if(cat&&cat.isMergeablePack){delete mf_main.componentList.dbCategories[cat.id];delete mf_main.componentList.cacheCategory[cat.id];}}};}function MF_ImageController(){var thisClass=this;this.uploadFileTemp=null;this.listed=false;this.imageCollection=null;this.selectedImage=null;this.uploadFiles=new Array();this.totalCount=0;this.component=null;this.newComponent=false;this.selected=false;this.imageEditorController=null;this.fileUploadInProgress=false;this.base64CacheCollection=new Object();this.editorDropFileCollection=new Array();this.droppedImageRenderingInProgress=false;this.iobserver=null;this.byocMode=false;this.byocLinkMode=false;this.byocLinkEditorMode=false;this.powerupComponentToUpdate=null;this.powerupComponentToUpdateImageID="";this.powerupList=new Array();this.constructor=function(){$("#mfImageUploadSelectionBtn").on("click",thisClass.openImageSelection);$("#mfImageUploadPowerupBtn").on("click",thisClass.togglePowerupMenu);$("#mfImageUploadFile").on("change",thisClass.fileSelectedHandler);$("#mfImageSearchBox").on("textchange",thisClass.searchImageHandler);$(".mfImageScrSelector .mfImageSrc").on("click",thisClass.handleImgSrcSelection);$("#mfImageEditNameBtn").on("click",thisClass.saveImageNameEvent);$("#mfImageUploadCancelBtn").on("click",thisClass.cancelImageUpload);$("#mfImageEditNameModal").on("shown.bs.modal",function(){$("#mfImageEditNameInput").focus();});$("#mfImageEditNameInput").on("keypress",function(e){if(e.which==13){thisClass.saveImageNameEvent();}});var dropZoneImageSection=document.getElementById("mfImageListSelectScreen");dropZoneImageSection.addEventListener("dragover",thisClass.handleImageSectionDragOver,false);dropZoneImageSection.addEventListener("drop",thisClass.handleImageSectionFileDrop,false);$("#mfImageListDragFeatureInfo").tooltip({trigger:"hover",placement:"right"});thisClass.addPowerupPopupList();};this.addPowerupPopupList=function(){var pitem=new MF_PowerupPopupItem();pitem.id="D9650a15cda3ec61ac782408381651bc7";pitem.name="Import from DropBox";thisClass.powerupList.push(pitem);var pitem=new MF_PowerupPopupItem();pitem.id="Df772db2355baf69bf15616eba9535ca6";pitem.name="Import from Google Drive";thisClass.powerupList.push(pitem);var pitem=new MF_PowerupPopupItem();pitem.id="D929778e937e0fa55db5f538bb0636747";pitem.name="Web image search";thisClass.powerupList.push(pitem);var pitem=new MF_PowerupPopupItem();pitem.id="Df9adb10a2fb3273c174a806dadc8fab8";pitem.name="Stock photography";thisClass.powerupList.push(pitem);var pitem=new MF_PowerupPopupItem();pitem.id="D9001a667ddd3f70df8debcdc56d4cb84";pitem.name="Global Image Manager";thisClass.powerupList.push(pitem);var pitem=new MF_PowerupPopupItem();pitem.id="D4073780418f47f01cdfff9cf319a0913";pitem.aiimage=true;pitem.name="Generate with AI";thisClass.powerupList.push(pitem);};this.startIntersectionObserver=function(entries){try{thisClass.stopIntersectionObserver();if(mf_main.editorController.VISIBLE_OBSERVE){var comps=null;comps=document.querySelectorAll("#mfImageListing .mfImgItemThumbCls");const config={threshold:0,root:document.getElementById("mfImageListing"),rootMargin:"100px"};if("IntersectionObserver" in window){thisClass.iobserver=new IntersectionObserver(thisClass.onIntersection,config);comps.forEach(function(com){thisClass.iobserver.observe(com);});}}}catch(e){}};this.stopIntersectionObserver=function(entries){try{if(mf_main.editorController.VISIBLE_OBSERVE&&thisClass.iobserver){thisClass.iobserver.disconnect();thisClass.iobserver=null;}}catch(e){}};this.onIntersection=function(entries){entries.forEach(function(entry){if(entry.isIntersecting){$("#"+entry.target.id).attr("src",$("#"+entry.target.id).attr("data-src"));if(thisClass.iobserver){thisClass.iobserver.unobserve(entry.target);}}else{}});};this.editImageHandler=function(){if(thisClass.selectedImage){mf_main.editorController.imageController.openImageEditor(thisClass.selectedImage.id,null);}};this.clearSelection=function(){thisClass.selectedImage=null;$("#mfImageSearchBox").val("");$(".mfImageItemThumbCls").css("border-color","#e0e0e0");};this.openImageSelection=function(e){if(MF_Permission.deny(mf_main.editorController.projectObj,"canUploadImage")){MF_Utils.display_ActionIndicator("Permission denied by project owner: To add images");return;}$("#mfImageUploadFile").val("");$("#mfImageUploadFile").click();};this.togglePowerupMenu=function(){$("#mfImageSectionPowerupMenu").toggle();if($("#mfImageSectionPowerupMenu").is(":empty")){thisClass.renderPowerupPopupItems();}};this.renderPowerupPopupItems=function(){$("#mfImageSectionPowerupMenu").empty();var htmldom="";var template=Handlebars.compile($("#mfPowerupPopupItemTemplate").html());var arr=thisClass.powerupList;for(i=0;i<arr.length;i++){htmldom=htmldom+template(arr[i]);}$("#mfImageSectionPowerupMenu").append(htmldom);$("#mfImageSectionPowerupMenu .mfPowerupPopupItem").on("click",thisClass.selectPowerup);};this.selectPowerup=function(){var pid=$(this).attr("data-powerupid");if(pid=="D4073780418f47f01cdfff9cf319a0913"){mf_main.editorController.openNavBarContent("mfNavAIToolsBtn");mf_main.editorController.aiToolsController.openAIImage();}else{mf_main.editorController.powerupController.openPowerupbyID(pid);}};this.closeImageEditor=function(){if($("#mfImageEditorInterface").css("display")=="block"){$("#mfImageEditorInterface").hide();}};this.openImageEditor=function(editimageID,comp){$("#mfImageEditorInterface").show();mf_main.editorController.disableShortcuts();if(thisClass.imageEditorController==null){var loadFiles=["modules/imageeditor/js/internal/imageeditor.js"];if(MF_Global.getS3Bucket()!="testmfassets"){loadFiles=["modules/imageeditor/js/mf_imageeditor-min.js"];}else{loadFiles.push("modules/imageeditor/js/internal/cropresize.js");}$("<link>").appendTo("head").attr({type:"text/css",rel:"stylesheet"}).attr("href","modules/imageeditor/css/internal/imageeditor.css");MF_Utils.loadsScripts(loadFiles).then(function(){$.get("modules/imageeditor/imageeditor.html",function(templates){$("#mfImageEditorInterface").html(templates);thisClass.imageEditorController=new MF_ImageEditor();thisClass.imageEditorController.constructor();thisClass.imageEditorController.openEditor(editimageID,comp);});});}else{thisClass.imageEditorController.openEditor(editimageID,comp);}};this.searchImageHandler=function(e){var searchval=$("#mfImageSearchBox").val().trim().toLowerCase();var imgArr=thisClass.imageCollection.toArray();for(var i=0;i<imgArr.length;i++){var item=imgArr[i];if(item.name.toLowerCase().indexOf(searchval)>=0){$("[id='mfImgItem"+item.id+"']").show();}else{$("[id='mfImgItem"+item.id+"']").hide();}}};this.closeHandler=function(){if(thisClass.selected){}else{}};this.handleImgSrcSelection=function(ev){$(".mfImageSrc").removeClass("selected");$(this).addClass("selected");};this.resize=function(){if($("#mfContentImages").css("display")=="block"){$("#mfImageListing").height($("#mfContentImages").height()-90);$("#mfImageListLoadScreen").height($("#mfContentImages").height()-60);$("#mfImageUploadSpinner").css({position:"absolute",top:($("#mfImageListing").height()/2),left:($("#mfImageListing").width()/2)-40});$("#mfImageLoadSpinner").css({position:"absolute",top:($("#mfImageListing").height()/2),left:($("#mfImageListing").width()/2)-20});}};this.openImageListing=function(){if(!thisClass.fileUploadInProgress){thisClass.selected=false;$("#mfImageListSelectScreen").show();$("#mfImageListUploadScreen").hide();thisClass.listImages();}};this.openAddImageDialog=function(){thisClass.uploadImageModalReset();$("#mfImageListUploadScreen").show();};this.addImageHandler=function(fileName){thisClass.uploadFileTemp=thisClass.uploadFiles.pop();if(!fileName){fileName=thisClass.uploadFileTemp.name;}var imageID=MF_Utils.guidGenerator();if(thisClass.uploadFileTemp&&thisClass.uploadFileTemp.hasOwnProperty("imageID")){imageID=thisClass.uploadFileTemp.imageID;}if(thisClass.uploadFileTemp==null){alert("No file selected");return;}thisClass.fileUploadInProgress=true;if(ConfirmExit){ConfirmExit.setPrompt(true);}thisClass.updateImageUploadCount();$("#mfImageUploadSpinner").css("display","block");var fd=new FormData();fd.append("company",mf_main.editorController.projectObj.company);fd.append("size",(parseInt(thisClass.uploadFileTemp.size/1024,10)).toString());fd.append("username",MF_UserSession.getUser().username);fd.append("project",mf_main.editorController.projectObj.id);fd.append("name","Html 5 File API/FormData");fd.append("fileToUpload",thisClass.uploadFileTemp);fd.append("mime",thisClass.uploadFileTemp.type);fd.append("filename",fileName);fd.append("uid",imageID);var xhr=new XMLHttpRequest();xhr.upload.addEventListener("progress",thisClass.uploadProgress,false);xhr.addEventListener("load",thisClass.uploadComplete,false);xhr.addEventListener("error",thisClass.uploadFailed,false);xhr.addEventListener("abort",thisClass.uploadCanceled,false);xhr.open("POST","upload");xhr.send(fd);};this.uploadComplete=function(evt){if(this.responseText.trim()=="invalid"){MF_Utils.display_ActionIndicator("Uploaded file is invalid");}if(thisClass.uploadFiles&&thisClass.uploadFiles.length>0){thisClass.addImageHandler(false);}else{if(thisClass.powerupComponentToUpdate!=null){var comp=mf_main.editorController.getComponentById(thisClass.powerupComponentToUpdate);if(!comp&&thisClass.powerupComponentToUpdate=="newimagecomponent"){try{var initoffset=mf_main.componentList.getInitOffsets();comp=mf_main.componentList.invokeComponent("MF_ImageComp","new",initoffset.offsetXPos,initoffset.offsetYPos);}catch(e){}}else{if(comp&&comp.imageID!=""){comp.preserveSize=true;}}if(comp){try{var tempImageObj=new Image();var urlCreator=window.URL||window.webkitURL;var tempImageUrl=urlCreator.createObjectURL(thisClass.uploadFileTemp);tempImageObj.onload=function(){var undoarr=new Array();var undo=new MF_UndoDAO();undo.propObjectUndo(comp,"esize",comp.esize);undoarr.push(undo);var undo=new MF_UndoDAO();undo.propSingleUndo(comp,"imageID",comp.imageID);undoarr.push(undo);var undo=new MF_UndoDAO();undo.propSingleUndo(comp,"originalEsize",comp.originalEsize);undoarr.push(undo);var szObject=new Object();comp.imageID=thisClass.powerupComponentToUpdateImageID;if(!comp.preserveSize){comp.width=tempImageObj.width;comp.height=tempImageObj.height;}szObject=new Object();szObject.width=tempImageObj.width;szObject.height=tempImageObj.height;comp.e2xml.addPropObject("originalEsize",szObject,"default");szObject=new Object();szObject.width=comp.width;szObject.height=comp.height;comp.e2xml.addPropObject("esize",szObject,"default");comp.e2xml.addPropSingle("imageID",comp.imageID,"default");comp.render(true);mf_main.editorController.reStackComponents();MF_ChangeManager.CHANGED(true);mf_main.editorController.closeAllSettings();mf_main.editorController.openSetting(comp.selector);mf_main.editorController.addSelectorResize(comp.selector);var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);thisClass.powerupComponentToUpdateImageID="";thisClass.powerupComponentToUpdate=null;};tempImageObj.onerror=function(erl){console.log(erl);};tempImageObj.src=tempImageUrl;}catch(e){console.log(e);}}}thisClass.uploadFileTemp=null;thisClass.uploadFiles=new Array();thisClass.fileUploadInProgress=false;thisClass.totalCount=0;MF_ChangeManager.CHANGED(true);mf_main.editorController.saveProject();thisClass.listed=false;thisClass.listImages();mf_main.rtc.imageSync("addImage",null);}};this.uploadProgress=function(evt){if(evt.lengthComputable){var percentComplete=Math.round(evt.loaded*100/evt.total);if(percentComplete>=100){$("#mfUploadImageModalScreen1").css("display","none");$("#mfImageUploadSpinner").css("display","block");}}else{$("#mfUploadImageModalScreen1").css("display","none");$("#mfImageUploadSpinner").css("display","block");}};this.uploadFailed=function(evt){$("#mfUploadImageModalScreen1").css("display","none");$("#mfImageUploadSpinner").css("display","block");alert("There was an error attempting to upload the file.");};this.uploadCanceled=function(evt){$("#mfUploadImageModalScreen1").css("display","none");$("#mfImageUploadSpinner").css("display","block");alert("The upload has been canceled by the user or the browser dropped the connection.");};this.cancelImageUpload=function(){$("#mfImageListUploadScreen").hide();};this.uploadImageModalReset=function(){$("#mfImageUploadFile").attr({value:""});$("#mfImageUploadSpinner").css("display","none");this.uploadFileTemp=null;};this.openFileUploadHandler=function(){if(mf_main.PERMISSION=="Reviewer"||mf_main.PUBLIC){}else{if(MF_Permission.deny(mf_main.editorController.projectObj,"canUploadImage")){MF_Utils.display_ActionIndicator("Permission denied by project owner: To add images");return;}thisClass.uploadImageModalReset();$("#mfUploadImageModal").modal();}};this.fileSelectedHandler=function(){if(MF_Permission.deny(mf_main.editorController.projectObj,"canUploadImage")){MF_Utils.display_ActionIndicator("Permission denied by project owner: To add images");return;}if(document.getElementById("mfImageUploadFile").files.length>20){alert("Maximum of 20 images can be selected at once");return false;}var validFilesCount=0;for(var i=0;i<document.getElementById("mfImageUploadFile").files.length;i++){var file=document.getElementById("mfImageUploadFile").files[i];if(file){var addFile=true;var fileSize=0;fileSize=parseInt(file.size/1024,10);var allow=false;if(file.type.match(/image\/jpeg/)||file.type.match(/image\/png/)||file.type.match(/image\/gif/)||file.type.match(/image\/svg/)){allow=true;}if(!allow){this.uploadFileTemp=null;addFile=false;alert("Only image files are supported - JPG, GIF, PNG, SVG");}fileSize=fileSize/1000;if(fileSize>50){this.uploadFileTemp=null;addFile=false;alert("File size cannot exceed 50 MB");}thisClass.uploadFileTemp=file;if(addFile){thisClass.uploadFiles.push(file);validFilesCount++;}}}thisClass.totalCount=thisClass.totalCount+validFilesCount;thisClass.updateImageUploadCount();if(thisClass.uploadFiles.length>0){thisClass.openAddImageDialog();thisClass.addImageHandler(false);}$("#mfImageUploadFile").attr({value:""});};this.listImages=function(){$("#mfImageListSelectScreen").show();$("#mfImageListUploadScreen").hide();if(!thisClass.listed){thisClass.listed=true;thisClass.imageCollection=new ArrayCollection();$("#mfImageListLoadScreen").css("display","block");$("#mfImageListing").css("display","none");thisClass.clearSelection(true);MF_ImageManager.list(mf_main.editorController.projectObj.company,mf_main.editorController.projectObj.id,{callback:function(arr){if(arr!=null){$("#mfImageListing").empty();thisClass.applyTemplate(arr);}$("#mfImageListLoadScreen").css("display","none");$("#mfImageListing").css("display","block");}});}};this.applyTemplate=function(arr){$("#mfImageListLoadScreen").css("display","none");$("#mfImageListing").css("display","block");$("#mfImageListing").empty();var cachedTemplate=mf_main.getTemplateFromCache("mfImgComponentItemTemplate");if(cachedTemplate==null){$.get("templates/editor/ImgComponentItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfImgComponentItemTemplate").html());mf_main.addTemplateToCache("mfImgComponentItemTemplate",template);thisClass.renderImageItem(template,arr);});}else{thisClass.renderImageItem(cachedTemplate,arr);}};this.renderImageItem=function(template,arr){$("#mfImageListLoadScreen").css("display","none");$("#mfImageListing").css("display","block");thisClass.imageCollection=new ArrayCollection();var len=arr.length;var htmldom="";for(var i=0,j=len;i<j;i++){var nitem=new MF_Image();nitem.cast(arr[i]);thisClass.imageCollection.addItem(nitem);htmldom=htmldom+template(nitem);}if(htmldom==""){htmldom="<div class='mfCenterAlign' id='mfImgListingPlaceholder'><i class='ico-photo'></i>Click 'Upload' button above to add images for this project.</div>";}$("#mfImageListing").append(htmldom);$(".mfImgCls").on("click",thisClass.selectImageHandler);$(".mfImageDelBtnCls").on("click",thisClass.delImageHandler);$(".mfImageCropEditBtnCls").on("click",thisClass.cropImageHandler);$(".mfImgCls").on("dblclick",thisClass.imageEditNameItemClick);$(".mfImgItemThumbCls").off("error");$(".mfImgItemThumbCls").on("error",function(){$(this).hide();});$(".mfImageExpandBtnCls").off("click");$(".mfImageExpandBtnCls").on("click",function(){var imgUrl=$(this).attr("data-imageURL");MF_Utils.copyToClipBoard4(imgUrl);});$("#mfImageListing").scrollTop(0);mf_main.editorController.makeComponentsDraggable();if(mf_main.editorController.VISIBLE_OBSERVE){thisClass.startIntersectionObserver();}else{for(var k=0;k<thisClass.imageCollection.size();k++){var nitem=thisClass.imageCollection.getItemAt(k);if(nitem){$("#mfImgItemThumbID"+nitem.nid).attr("src",$("#mfImgItemThumbID"+nitem.nid).attr("data-src"));}}}};this.imageEditNameItemClick=function(e){if(mf_main.editorController.VIEWER==true){return;}mf_main.editorController.disableShortcuts();$("#mfImageEditNameModal").modal();var imgObj=thisClass.getImageByID("mfImgItem",$(this).attr("id"));if(imgObj){thisClass.selectedImage=imgObj;$("#mfImageEditNameInput").val(imgObj.name);}};this.saveImageNameEvent=function(e){mf_main.editorController.enableShortcuts();mf_main.closeDialog();var newname=$("#mfImageEditNameInput").val().trim();if(thisClass.selectedImage){if(newname==""){newname=thisClass.selectedImage.name;}else{thisClass.selectedImage.name=newname;$("#mfImgItemName"+thisClass.selectedImage.validID).text(thisClass.selectedImage.name);mf_main.rtc.imageSync("renameImage",thisClass.selectedImage);MF_ImageManager.renameImage(MF_UserSession.getUser(),mf_main.editorController.projectObj.company,thisClass.selectedImage,{callback:function(){}});}}};this.selectImageHandler=function(e){var imgObj=thisClass.getImageByID("mfImgItem",$(this).attr("id"));if(thisClass.byocMode&&mf_main.editorController.lastTextEditComp&&mf_main.editorController.lastTextEditComp.NAME=="MF_BYOC"){thisClass.byocMode=false;thisClass.component=null;mf_main.editorController.contentEditController.replaceImage(imgObj);return;}if(thisClass.byocLinkMode&&thisClass.component&&thisClass.component.NAME=="MF_BYOC"){thisClass.byocLinkMode=false;var imgUrl=imgObj.imageURL;MF_Utils.copyToClipBoard4(imgUrl);mf_main.editorController.closeAllSettings();mf_main.editorController.openSetting(thisClass.component.selector);mf_main.editorController.addSelectorResize(thisClass.component.selector);thisClass.component=null;return;}if(thisClass.byocLinkEditorMode&&thisClass.component&&thisClass.component.NAME=="MF_BYOC"){thisClass.byocLinkEditorMode=false;var imgUrl=imgObj.imageURL;MF_Utils.copyToClipBoard4(imgUrl);mf_main.editorController.closeAllSettings();mf_main.editorController.openSetting(thisClass.component.selector);mf_main.editorController.addSelectorResize(thisClass.component.selector);mf_main.editorController.openBYOCeditor(thisClass.component);thisClass.component=null;return;}if(imgObj&&thisClass.component!=null){var undoarr=new Array();var undo=new MF_UndoDAO();undo.propObjectUndo(thisClass.component,"esize",thisClass.component.esize);undoarr.push(undo);undo=new MF_UndoDAO();undo.propSingleUndo(thisClass.component,"imageID",thisClass.component.imageID);undoarr.push(undo);undo=new MF_UndoDAO();undo.propObjectUndo(thisClass.component,"currentColorsData",thisClass.component.currentColorsData);undoarr.push(undo);undo=new MF_UndoDAO();undo.propSingleUndo(thisClass.component,"originalEsize",thisClass.component.originalEsize);undoarr.push(undo);var szObject=new Object();thisClass.selected=true;thisClass.component.imageID=imgObj.id;if(!thisClass.component.preserveSize){thisClass.component.width=imgObj.width;thisClass.component.height=imgObj.height;}szObject=new Object();szObject.width=imgObj.width;szObject.height=imgObj.height;thisClass.component.e2xml.addPropObject("originalEsize",szObject,"default");szObject=new Object();szObject.width=thisClass.component.width;szObject.height=thisClass.component.height;thisClass.component.e2xml.addPropObject("esize",szObject,"default");thisClass.component.e2xml.addPropSingle("currentColorsData","{}","default");thisClass.component.e2xml.addPropSingle("imageID",imgObj.id,"default");thisClass.component.render(true);mf_main.editorController.reStackComponents();MF_ChangeManager.CHANGED(true);mf_main.editorController.closeAllSettings();mf_main.editorController.openSetting(thisClass.component.selector);mf_main.editorController.addSelectorResize(thisClass.component.selector);var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);thisClass.component=null;}else{if(imgObj){thisClass.selectedImage=imgObj;}}};this.delImageHandler=function(e){if(MF_Permission.deny(mf_main.editorController.projectObj,"canDeleteImage")){MF_Utils.display_ActionIndicator("Permission denied by project owner: To delete image");}else{var mid=$(this).attr("id");bootbox.confirm("Delete selected image?<br/><br/>Note: This will also permanently remove this image and it won't show in the wireframes if used.",function(answer){if(answer){var imgObj=thisClass.getImageByID("mfImageDelBtn_",mid);if(imgObj){var oind=thisClass.imageCollection.getItemIndex(imgObj);if(oind!=-1){thisClass.imageCollection.removeItemAt(oind);}thisClass.clearSelection();var arr=thisClass.imageCollection.toArray();$("#mfImageListLoadScreen").css("display","none");$("#mfImageListing").css("display","block");thisClass.applyTemplate(arr);mf_main.rtc.imageSync("delImage",imgObj);MF_ImageManager.deleteImage(MF_UserSession.getUser(),mf_main.editorController.projectObj.company,imgObj,{callback:function(){}});}}});}};this.cropImageHandler=function(e){var imgObj=thisClass.getImageByID("mfImageCropEditBtn_",$(this).attr("id"));if(imgObj){thisClass.selectedImage=imgObj;thisClass.editImageHandler();}};this.getImageByID=function(classname,pid){for(var i=0;i<thisClass.imageCollection.size();i++){var item=thisClass.imageCollection.getItemAt(i);if(classname+item.id==pid){return item;break;}}return null;};this.handleImageSectionDragOver=function(e){e.stopPropagation();e.preventDefault();};this.handleImageSectionFileDrop=function(e){e.stopPropagation();e.preventDefault();var droppedFiles=e.dataTransfer.files;if(mf_main.editorController.EDITOR){if(droppedFiles){mf_main.editorController.clearSelection(true);if(droppedFiles.length>20){alert("Maximum of 20 images can be selected at once");return false;}var validFilesCount=0;for(var i=0;i<droppedFiles.length;i++){if(droppedFiles[i]&&thisClass.isValidImageFile(droppedFiles[i])){thisClass.uploadFiles.push(droppedFiles[i]);validFilesCount++;}}if(thisClass.uploadFiles.length>0){thisClass.totalCount=thisClass.totalCount+validFilesCount;thisClass.updateImageUploadCount();if(!thisClass.fileUploadInProgress){thisClass.openAddImageDialog();thisClass.addImageHandler(false);}}}}};this.initEditorDropHandler=function(elementId){var dropZoneEditorPage=document.getElementById(elementId);dropZoneEditorPage.addEventListener("dragover",thisClass.handleEditorPageDragOver,false);dropZoneEditorPage.addEventListener("drop",thisClass.handleEditorPageFileDropHandler,false);};this.handleEditorPageDragOver=function(e){e.stopPropagation();e.preventDefault();};this.handleEditorImagePasteHandler=function(event){try{var items=(event.clipboardData||event.originalEvent.clipboardData).items;var file=null;var droppedFiles=new Array();for(var i=0;i<items.length;i++){if(items[i].type.indexOf("image")!==-1){file=items[i].getAsFile();droppedFiles.push(file);}}if(droppedFiles.length>0){var initPlace=mf_main.editorController.getInitialPlacement();var pageX=$("#mfPageArea").position().left+initPlace.x;var pageY=initPlace.y;var offsetX=document.getElementById("mfEditorHolder").scrollLeft+initPlace.x;var offsetY=document.getElementById("mfEditorHolder").scrollTop+initPlace.y;var position={offsetX:offsetX,offsetY:offsetY,pageX:pageX,pageY:pageY};thisClass.handleEditorPageFileDrop(droppedFiles,position);}}catch(e){}};this.handleEditorPageFileDropHandler=function(e){e.stopPropagation();e.preventDefault();var droppedFiles=e.dataTransfer.files;var position={offsetX:e.offsetX,offsetY:e.offsetY,pageX:e.pageX,pageY:e.pageY};thisClass.handleEditorPageFileDrop(droppedFiles,position);};this.handleEditorPageFileDrop=function(droppedFiles,position){if(mf_main.editorController.EDITOR){if(droppedFiles){mf_main.editorController.clearSelection(true);if(droppedFiles.length>20){alert("Maximum of 20 images can be selected at once");return false;}var offsetPlus=0;for(var i=0;i<droppedFiles.length;i++){if(droppedFiles[i]&&thisClass.isValidImageFile(droppedFiles[i])){var sizeAllow=true;try{var fileSizeInBytes=droppedFiles[i].size;fileSizeInBytes=fileSizeInBytes/Math.pow(1024,2);fileSizeInBytes=Math.round(fileSizeInBytes);if(fileSizeInBytes>50){sizeAllow=false;MF_Utils.display_ActionIndicator("File size cannot exceed 50 MB");}}catch(e){}if(sizeAllow){if(i!=0){offsetPlus+=50;}droppedFiles[i].droppedOffsetX=position.offsetX+offsetPlus;droppedFiles[i].droppedOffsetY=position.offsetY+offsetPlus;droppedFiles[i].droppedPageX=position.pageX+offsetPlus;droppedFiles[i].droppedPageY=position.pageY+offsetPlus;thisClass.editorDropFileCollection.push(droppedFiles[i]);}}}if(!thisClass.droppedImageRenderingInProgress&&thisClass.editorDropFileCollection.length>0){thisClass.handleImageRendering();}}}};this.isValidImageFile=function(file){if(file){if(MF_Permission.deny(mf_main.editorController.projectObj,"canUploadImage")){MF_Utils.display_ActionIndicator("Permission denied by project owner: To add images");return false;}var addFile=true;var fileSize=0;fileSize=parseInt(file.size/1024,10);var allow=false;if(file.type.match(/image\/jpeg/)||file.type.match(/image\/png/)||file.type.match(/image\/gif/)||file.type.match(/image\/svg/)){allow=true;}if(!allow){alert("Only image files are supported - JPG, GIF, PNG, SVG");return false;}fileSize=fileSize/1000;if(fileSize>50){allow=false;alert("File size cannot exceed 50 MB");}return allow;}return false;};this.handleImageRendering=function(){var droppedFile=thisClass.editorDropFileCollection.pop();thisClass.droppedImageRenderingInProgress=true;var reader=new FileReader();reader.onload=(function(droppedFileItem){return function(readFile){var image=new Image();image.onload=function(){mf_main.editorController.closeCompMode();var offsetXPos=parseInt(droppedFileItem.droppedOffsetX);var offsetYPos=parseInt(droppedFileItem.droppedOffsetY);var scrollTop=document.getElementById("mfEditorHolder").scrollTop;var scrollLeft=document.getElementById("mfEditorHolder").scrollLeft;offsetYPos=offsetYPos-50+scrollTop;offsetXPos=offsetXPos-$("#mfContainerPage").css("left").replace("px","")+scrollLeft;offsetXPos=(droppedFileItem.droppedPageX-$("#mfContainerPage").position().left)/mf_main.editorController.SCALE;offsetYPos=(droppedFileItem.droppedPageY-$("#mfContainerPage").position().top)/mf_main.editorController.SCALE;if(offsetXPos<0){offsetXPos=0;}if(offsetYPos<0){offsetYPos=0;}offsetXPos=MF_Utils.roundUp5(offsetXPos);offsetYPos=MF_Utils.roundUp5(offsetYPos);mf_main.editorController.checkCloseGroup(offsetXPos,offsetYPos);var uploadedImageID=MF_Utils.guidGenerator();var comtype="MF_ImageComp";var newComponent=mf_main.componentList.invokeComponent(comtype,"new",offsetXPos,offsetYPos);newComponent.imageID=uploadedImageID;newComponent.width=this.width;newComponent.height=this.height;if(droppedFileItem.type=="image/svg+xml"){newComponent.imageID=uploadedImageID+".svg";newComponent.width=100;newComponent.height=100;}szObject=new Object();szObject.width=newComponent.width;szObject.height=newComponent.height;newComponent.e2xml.addPropObject("originalEsize",szObject,"default");szObject=new Object();szObject.width=newComponent.width;szObject.height=newComponent.height;newComponent.e2xml.addPropObject("esize",szObject,"default");thisClass.base64CacheCollection[newComponent.imageID]=this.src;newComponent.e2xml.addPropSingle("imageID",newComponent.imageID,"default");newComponent.render(true);mf_main.editorController.reStackComponents();MF_ChangeManager.CHANGED(true);if(mf_main.editorController.EDITOR){mf_main.editorController.closeAllSettings();mf_main.editorController.openSetting(newComponent.selector);mf_main.editorController.addSelectorResize(newComponent.selector);mf_main.editorController.resizePage();}droppedFileItem.imageID=uploadedImageID;newComponent=null;thisClass.uploadFiles.push(droppedFileItem);thisClass.totalCount++;thisClass.updateImageUploadCount();if(!thisClass.fileUploadInProgress){thisClass.openAddImageDialog();thisClass.addImageHandler(false);}mf_main.editorController.enableShortcuts();thisClass.handleImageRenderingComplete();};image.onerror=function(){MF_Utils.display_ActionIndicator("Uploaded file is invalid");thisClass.handleImageRenderingComplete();};image.src=readFile.target.result;};})(droppedFile);reader.readAsDataURL(droppedFile);};this.handleImageRenderingComplete=function(){if(thisClass.editorDropFileCollection.length>0){thisClass.handleImageRendering();}else{thisClass.droppedImageRenderingInProgress=false;}};this.updateImageUploadCount=function(){var uploadedFiles=(thisClass.totalCount-thisClass.uploadFiles.length).toString();if(uploadedFiles<=0){uploadedFiles=1;}if(thisClass.totalCount==1){$("#mfUploadImageModalTitle").text("Uploading: "+uploadedFiles+" / "+thisClass.totalCount.toString()+"");}else{$("#mfUploadImageModalTitle").text("Uploading: "+uploadedFiles+" / "+thisClass.totalCount.toString()+"");}};}function MF_RevisionController(){var thisClass=this;this.revisionChanged=false;this.timer=null;this.firstAutoRevision=true;this.revisionCollection=new ArrayCollection();this.selectedRevision=null;this.lastComparePage=null;this.constructor=function(){$("#mfRevisionDeleteBtn").on("click",thisClass.deleteRevision);$(".mfRevisionTooltip").tooltip({trigger:"hover"});$("#mfRevisionGoBackBtn").on("click",thisClass.goBackBtn);if(mf_main.REVISION){$("#mfExitRevisionCompareBtn").on("click",thisClass.removeComparisonHandler);$(".mfCompareRevisionsBtn").on("click",thisClass.openRevisionListing);$(".mfCompareRevisionsBtn").on("mouseleave",function(event){$(this).tooltip("hide");});}$("#mfRevisionPreviewBtn").on("click",thisClass.previewRevision);$("#mfRevisionRestoreBtn").on("click",thisClass.restoreRevisionHandler);$("#mfNewRevisionBtn").on("click",mf_main.editorController.revisionController.openAddRevisionDialog);$("#mfRevisionSaveAsBtn").on("click",thisClass.saveAsHandler);$("#mfEditRevisionBtn").on("click",thisClass.editRevisionNote);$("#mfRevisionEditNote").on("keypress",function(e){if(e.which==13){thisClass.editRevisionNote();}});$("#mfToggleAutoRevBtn").on("click",thisClass.listRevisionFromServer);$("#mfAddRevisionBtn").on("click",thisClass.addRevision);$("#mfRevisionNote").on("keypress",function(e){if(e.which==13){thisClass.addRevision();}});$("#mfAddRevisionModal").on("shown.bs.modal",function(){$("#mfRevisionNote").focus();});$("#mfRevisionSidebar").on("click",function(evt){evt.stopPropagation();});$("#mfRevisionClose").on("click",function(){$("#mfRevisionSidebar").hide();});};this.resetRevisionListing=function(){$("#mfToggleAutoRevBtn").prop("checked",false);$("#mfRevisionListScreen").hide();$("#mfRevisionPreviewScreen").hide();$("#mfRevisionLoadingScreen").show();};this.resetAddRevision=function(){$("#mfRevisionNote").val("");$("#mfAddRevisionInputScreen").show();$("#mfAddRevisionLoadingScreen").hide();};this.openAddRevisionDialog=function(){mf_main.editorController.disableShortcuts();mf_main.closeDialog();thisClass.resetAddRevision();$("#mfAddRevisionModal").modal();};this.restoreRevisionHandler=function(){if(thisClass.selectedRevision==null){MF_Utils.display_ActionIndicator("No revision selected!");}else{bootbox.hideAll();bootbox.confirm("Revert current page to this revision?",function(answer){if(answer){$("#mfRevisionListScreen").hide();$("#mfRevisionPreviewScreen").hide();$("#mfRevisionLoadingScreen").show();var unsnapArr=new Array();mf_main.editorController.unSnapPage(mf_main.editorController.page,unsnapArr);MF_RevisionManager.checkOutRevision(MF_UserSession.getUser(),thisClass.selectedRevision,mf_main.editorController.projectObj,unsnapArr,{callback:function(){mf_main.closeDialog();mf_main.editorController.page.remove();mf_main.editorController.page.loaded=false;mf_main.editorController.viewPage(mf_main.editorController.page,true);}});}});}};this.saveAsHandler=function(){if(thisClass.selectedRevision==null){MF_Utils.display_ActionIndicator("No revision selected!");}else{bootbox.confirm("Save this revision as new page?",function(answer){if(answer){if(!mf_main.editorController.pageController.allowPageCreation()){return;}$("#mfRevisionListScreen").hide();$("#mfRevisionPreviewScreen").hide();$("#mfRevisionLoadingScreen").show();var pagedata=new MF_PageData();pagedata.eid=MF_Utils.guidGenerator();pagedata.projectid=mf_main.editorController.projectObj.id;pagedata.clientid=mf_main.editorController.projectObj.company;pagedata.name="Page "+(MF_PagePool.getPages().size()+1).toString();var page=MF_PagePool.addNewPage("Page "+(MF_PagePool.getPages().size()+1).toString());MF_ChangeManager.CHANGED(true);mf_main.editorController.pageController.listPages();mf_main.editorController.pageController.siteMapChanged=true;mf_main.editorController.saveTree();MF_RevisionManager.createFromRevision(MF_UserSession.getUser(),thisClass.selectedRevision,page.pagedata,{callback:function(res){mf_main.closeDialog();MF_Utils.display_ActionIndicator("Created new page from this revision");mf_main.editorController.viewPage(page,true);mf_main.rtc.siteMapSync("addPage",page);}});}});}};this.previewRevision=function(){if(MF_Permission.deny(mf_main.editorController.projectObj,"canPreviewRevision")){MF_Utils.display_ActionIndicator("Permission denied by project owner: To preview revision");return;}if(thisClass.selectedRevision==null){MF_Utils.display_ActionIndicator("No revision selected!");}else{var publicid=MF_Utils.guidGenerator();var privateid=MF_Utils.guidGenerator();var url="preview.jsp?editor=off&publicid="+mf_main.PUBLICID+"&projectid="+mf_main.editorController.projectObj.id+"&pageid="+thisClass.selectedRevision.pageid+"&revid="+thisClass.selectedRevision.id;window.open(url);mf_main.PUBLICID=publicid;MF_Authentication.addSecureKeyHash(MF_UserSession.getUser(),publicid,privateid,{callback:function(str){}});}};this.goBackBtn=function(){$("#mfRevisionListScreen").show();$("#mfRevisionPreviewScreen").hide();$("#mfRevisionLoadingScreen").hide();};this.deleteRevision=function(){if(thisClass.selectedRevision==null){MF_Utils.display_ActionIndicator("No revision selected!");}else{if(MF_Permission.deny(mf_main.editorController.projectObj,"canDeleteRevision")){MF_Utils.display_ActionIndicator("Permission denied by project owner: To delete revision");return;}bootbox.confirm("Delete selected revision?",function(answer){if(answer){var rev=thisClass.selectedRevision;var rind=thisClass.revisionCollection.getItemIndex(thisClass.selectedRevision);if(rind!=-1){thisClass.revisionCollection.removeItemAt(rind);}thisClass.listRevisions(thisClass.revisionCollection.toArray());MF_Utils.display_ActionIndicator("Revision has been deleted!");MF_RevisionManager.deleteRevision(MF_UserSession.getUser(),rev.company,rev.projectid,rev.pageid,rev.id,{callback:function(){}});}});}};this.addRevision=function(){if(MF_UserSession.getUser().isBasic){bootbox.confirm("Basic plan does not allow manual revisions. Ask your license administrator to upgrade your account OR purchase a license",function(ans){if(ans){mf_main.openUpgradeDialog();}});return;}var note=$.trim($("#mfRevisionNote").val());if(note==""){alert("Revision note cannot be empty");return;}$("#mfAddRevisionInputScreen").hide();$("#mfAddRevisionLoadingScreen").show();var revision=new MF_Revision();revision.id=MF_Utils.guidGenerator();revision.company=mf_main.editorController.projectObj.company;revision.projectid=mf_main.editorController.projectObj.id;revision.pageid=mf_main.editorController.page.eid;revision.note=note;revision.creator=MF_UserSession.getUser().username;revision.auto=false;if(mf_main.editorController.page.changed){pagedata=MF_Utils.xmlToString(mf_main.editorController.page.e2xml.formXML("pageonly"));}else{pagedata=MF_Utils.xmlToString(mf_main.editorController.page.e2xml.settingsXML);}revision.data=pagedata;var restored=null;var revision2=new MF_Revision();revision2.cast(revision);revision2.data="";try{var binaryString=pako.gzip(revision.data,{to:"string"});restored=btoa(binaryString);}catch(e){}MF_RevisionManager.checkInRevision(MF_UserSession.getUser(),revision2,restored,{callback:function(result){if(result==false||result==null){MF_RevisionManager.checkInRevision(MF_UserSession.getUser(),revision,{callback:function(result){mf_main.closeDialog();MF_Utils.display_ActionIndicator("Revision checked-in!");thisClass.listRevisionFromServer();}});}else{mf_main.closeDialog();MF_Utils.display_ActionIndicator("Revision checked-in!");thisClass.listRevisionFromServer();}}});return revision;};this.editRevisionNote=function(){if(MF_Permission.deny(mf_main.editorController.projectObj,"canManageRevisions")){MF_Utils.display_ActionIndicator("Permission denied by project owner: To edit revision");return;}var note=$.trim($("#mfRevisionEditNote").val());if(note==""){alert("Revision note cannot be empty");return;}$("#mfEditRevisionInputScreen").hide();$("#mfEditRevisionLoadingScreen").show();thisClass.selectedRevision.note=note;MF_RevisionManager.changeRevisionNote(MF_UserSession.getUser(),thisClass.selectedRevision,{callback:function(result){mf_main.closeDialog();MF_Utils.display_ActionIndicator("Revision note updated!");}});};this.revisionItemDoubleClick=function(e){if(mf_main.REVISION){return;}if(MF_Permission.deny(mf_main.editorController.projectObj,"canManageRevisions")){MF_Utils.display_ActionIndicator("Permission denied by project owner: To edit revision");return;}mf_main.closeDialog();thisClass.clearRevisionSelection();$(this).css({color:"#2196F3"});thisClass.selectedRevision=thisClass.getRevisionByHTMLID($(this).attr("id"));$("#mfRevisionEditNote").val(thisClass.selectedRevision.note);$("#mfEditRevisionInputScreen").show();$("#mfEditRevisionLoadingScreen").hide();mf_main.editorController.disableShortcuts();$("#mfEditRevisionModal").modal();};this.listRevisionFromServer=function(){$("#mfRevisionListScreen").hide();$("#mfRevisionPreviewScreen").hide();$("#mfRevisionLoadingScreen").show();var hideAuto=false;if($("#mfToggleAutoRevBtn").is(":checked")){hideAuto=true;}MF_RevisionManager.list(MF_UserSession.getUser(),mf_main.editorController.projectObj.company,mf_main.editorController.projectObj.id,mf_main.editorController.page.eid,hideAuto,{callback:function(arr){if(arr!=null){thisClass.listRevisions(arr);}$("#mfRevisionListScreen").show();$("#mfRevisionPreviewScreen").hide();$("#mfRevisionLoadingScreen").hide();$(".mfRevisionNameSpan").each(function(){if($(this).width()+15>=$(this).closest(".mfRevisionNameWrapper").width()){$(this).attr("data-original-title",$(this).text());}});$(".mfRevisionNameSpan").tooltip({animation:false,trigger:"hover"});}});};this.removeComparisonHandler=function(){mf_main.closeDialog();thisClass.clearRevisionSelection();mf_main.editorController.page.masterPage="";mf_main.editorController.setMasterPage();mf_main.editorController.viewPage(mf_main.editorController.page,true);};this.openRevisionListing=function(){if($("#mfRevisionSidebar").css("display")=="block"){mf_main.closeDialog();return;}mf_main.closeDialog();mf_main.editorController.lastOpenedMfPopUp=$("#mfRevisionSidebar");mf_main.editorController.disableShortcuts();if(mf_main.REVISION){$("#mfRevisionListingTitle").text("Select revision to compare");$(".mfRevisionTooltip").hide();$("#mfNewRevisionBtn").hide();$("#mfRevisionEndNote").html("Note: The selected revision will be appear faded below the current revision");$("#mfRevisionSidebar").css("left","0px");$('[data-toggle="tooltip"], .tooltip').tooltip("hide");$("#mfExitRevisionCompareBtn").show();if(thisClass.selectedRevision==null){thisClass.resetRevisionListing();$("#mfRevisionSidebar").show();thisClass.listRevisionFromServer();}else{$("#mfRevisionSidebar").show();}$("#mfRevisionSidebar").css("height","100%");}else{thisClass.resetRevisionListing();$("#mfRevisionSidebar").show();thisClass.listRevisionFromServer();$("#mfRevisionSidebar").css("height","100%");if($("#mfVideoChatInterface").is(":visible")){$("#mfRevisionSidebar").css("height",$(window).height()-120);}}};this.listRevisions=function(arr){if(!mf_main.REVISION){this.selectedRevision=null;}$("#mfRevisionListItems").empty();var cachedTemplate=mf_main.getTemplateFromCache("mfRevisionItemTemplate");if(cachedTemplate==null){$.get("templates/editor/RevisionItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfRevisionItemTemplate").html());mf_main.addTemplateToCache("mfRevisionItemTemplate",template);thisClass.renderRevisionListing(arr,template);});}else{thisClass.renderRevisionListing(arr,cachedTemplate);}};this.revisionItemOver=function(e){if(thisClass.selectedRevision!=null&&("mfRevisionItem"+thisClass.selectedRevision.id)==$(this).attr("id")){}else{$(this).css({color:"#2f8cfc"});}};this.revisionItemOut=function(e){if(thisClass.selectedRevision!=null&&("mfRevisionItem"+thisClass.selectedRevision.id)==$(this).attr("id")){}else{$(this).css({color:"#444"});}};this.revisionItemClick=function(e){if(mf_main.REVISION){var selrev=thisClass.getRevisionByHTMLID($(this).attr("id"));if(selrev&&selrev.id==mf_main.revisionID){MF_Utils.display_ActionIndicator("Cannot compare same revisions");return;}thisClass.clearRevisionSelection();$(this).css({color:"#2f8cfc"});thisClass.selectedRevision=selrev;$("#mfRevisionListScreen").hide();$("#mfRevisionPreviewScreen").hide();$("#mfRevisionLoadingScreen").show();var page=MF_PagePool.addNewPage("Page "+(MF_PagePool.getPages().size()+1).toString());var revid=thisClass.selectedRevision.id;if(revid=="masterrevision"){revid=null;}MF_ProjectManager.getPageData(MF_UserSession.getUser(),mf_main.editorController.projectObj.id,mf_main.editorController.projectObj.company,mf_main.editorController.page.eid,mf_main.PUBLIC,thisClass.selectedRevision.id,{callback:function(pagedataObj){if(thisClass.lastComparePage){MF_PagePool.deletePage(thisClass.lastComparePage);}if(pagedataObj==null){page.createPageData();}else{var pagedata=new MF_PageData();pagedata.cast(pagedataObj);page.pagedata=pagedata;var jData=$(page.pagedata.data);page.e2xml.settingsXML=jData;}page.noDBLoad=true;$("#mfRevisionListScreen").show();$("#mfRevisionPreviewScreen").hide();$("#mfRevisionLoadingScreen").hide();thisClass.lastComparePage=page;mf_main.closeDialog();mf_main.editorController.page.masterPage=page.eid;mf_main.editorController.setMasterPage();mf_main.editorController.viewPage(mf_main.editorController.page,true);}});}else{thisClass.clearRevisionSelection();$(this).css({color:"#2f8cfc"});thisClass.selectedRevision=thisClass.getRevisionByHTMLID($(this).attr("id"));}};this.clearRevisionSelection=function(){for(var i=0;i<thisClass.revisionCollection.size();i++){var item=thisClass.revisionCollection.getItemAt(i);thisClass.selectedRevision=null;$("#mfRevisionItem"+item.id).css({color:"#444"});}};this.getRevisionByHTMLID=function(pid){for(var i=0;i<thisClass.revisionCollection.size();i++){var item=thisClass.revisionCollection.getItemAt(i);if("mfRevisionItem"+item.id==pid){return item;break;}}return null;};this.renderRevisionListing=function(arr,template){thisClass.revisionCollection=new ArrayCollection();var len=arr.length;var htmldom="";if(mf_main.REVISION){var revision=new MF_Revision();revision.id="masterrevision";revision.company=mf_main.editorController.projectObj.company;revision.projectid=mf_main.editorController.projectObj.id;revision.pageid="master";revision.note="Master Version";revision.creator=MF_UserSession.getUser().username;revision.auto=false;revision.createDate=new Date();thisClass.revisionCollection.addItem(revision);htmldom=htmldom+template(revision);}for(var i=0,j=len;i<j;i++){var citem=new MF_Revision();citem.cast(arr[i]);thisClass.revisionCollection.addItem(citem);htmldom=htmldom+template(citem);}$("#mfRevisionListItems").append(htmldom);$(".mfRevisionNameSpan").each(function(){if($(this).width()+15>=$(this).closest(".mfRevisionNameWrapper").width()){$(this).attr("data-original-title",$(this).text());}});$(".mfRevisionNameSpan").tooltip({animation:false,trigger:"hover"});$(".mfRevisionItemCls").on("mouseover",thisClass.revisionItemOver);$(".mfRevisionItemCls").on("mouseout",thisClass.revisionItemOut);$(".mfRevisionItemCls").on("click",thisClass.revisionItemClick);$(".mfRevisionItemCls").on("dblclick",thisClass.revisionItemDoubleClick);if(mf_main.REVISION&&thisClass.selectedRevision){for(var i=0;i<thisClass.revisionCollection.size();i++){var revitem=thisClass.revisionCollection.getItemAt(i);if(revitem.id==thisClass.selectedRevision.id){$("#mfRevisionItem"+revitem.id).css({color:"#2f8cfc"});break;}}}};}function MF_ExportController(){var thisClass=this;this.revisionChanged=false;this.timer=null;this.firstAutoRevision=true;this.images=new ArrayCollection();this.imagetreeview=null;this.exportType="images";this.clientExport=false;this.selectedPageExport=null;this.selectedPageID=null;this.includeFeedback=false;this.includeCallout=false;this.includeA4=false;this.powerupList=new Array();this.constructor=function(){$("#mfOpenExportImageBtn").on("click",thisClass.openExportImagesDialog);$("#mfOpenExportPDFBtn").on("click",thisClass.openExportPDFDialog);$("#mfOpenExportPPTBtn").on("click",thisClass.openExportPPTDialog);$("#mfOpenExportDocBtn").on("click",thisClass.openExportDocDialog);$("#mfOpenExportHTMLBtn").on("click",thisClass.openExportHTMLDialog);$("#mfOpenExportWIREBtn").on("click",thisClass.openExportWIREDialog);$("#mfExportImageSelectedBtn").on("click",thisClass.exportSelected);$("#mfStartExportPDFTextBtn").on("click",thisClass.exportPDFText);$("#mfViewerNavExportEditBtn").on("click",thisClass.quickExportHandler);$("#mfAddPageExportImage").on("click",thisClass.openAddPage2ImageHandler);$("#mfStartExportHTMLBtn").on("click",thisClass.export2HTML);$("#mfStartExportWIREBtn").on("click",thisClass.export2Wire);$("#mfStartExportDSGNBtn").on("click",thisClass.export2Dsgn);$("#mfmultipagepdf").on("click",function(e){$(".mfExportImageScreenCls").hide();$("#mfExportImageAddScreen").show();});$("#mftextpdf").on("click",function(e){$(".mfExportImageScreenCls").hide();$("#mfExportPDFTextScreen").show();});$("#mfAddExportAll").on("click",thisClass.addAllPagesHandler);$("#mfExportImageDialog").on("hidden.bs.modal",function(){try{if(thisClass.imagetreeview){thisClass.imagetreeview.destroy();}}catch(e){}$("#mfExportImagePageList").empty();$("#mfPageImageDelBtnAll").hide();thisClass.images=new ArrayCollection();$("#mfExportedImageList").empty();$("#mfExportImagePageSearchBox").val("");});$("#mfExportImagePageSearchBox").on("textchange",thisClass.searchPageImageHandler);$("#mfExportImageBtn").on("click",thisClass.exportImages2Server);$("#mfInclude2x").click(thisClass.toggle2xExport);$("#mfIncludeComments").click(thisClass.toggleComments);$("#mfIncludeCallouts").click(thisClass.toggleCallouts);$("#mfIncludeA4").click(thisClass.toggleA4);$("#mfIncludeCalloutsChk").popover({trigger:"hover",html:true});$("#mfIncludeA4Chk").popover({trigger:"hover",html:true});$("#mfExportedImageList").sortable({placeholder:"exportPagePlaceholder",containment:"#mfExportedImageList",tolerance:"pointer",axis:"y",stop:function(event,ui){var sortPageArray=new Array;if(thisClass.images.size()>0){$("#mfExportedImageList").children().each(function(){var pageId=$(this).attr("id");var arr=$.grep(thisClass.images.data,function(e){return"mfPageExportItem"+e.id==pageId;});sortPageArray.push(arr[0]);});if(sortPageArray&&sortPageArray.length>0){thisClass.images.data=sortPageArray;}}}});$("#mfPageImageDelBtnAll").on("click",thisClass.removeAllPageImageClick);$("#mfExportSectionPowerupDiv").on("click",thisClass.togglePowerupMenu);thisClass.addPowerupPopupList();};this.exportSelected=function(e){mf_main.closeDialog();mf_main.componentList.packController.exportComponentAsImage();};this.quickExportHandler=function(e){if(mf_main.editorController.EDITOR&&MF_ChangeManager.getCHANGED()==true){mf_main.editorController.saveProject();}thisClass.openExportImagesDialog(e);$("#mfAddPageExportImage").click();};this.addPowerupPopupList=function(){var pitem=new MF_PowerupPopupItem();pitem.id="Da36409ac78da4f7dafc15b02797dbc35";pitem.name="Mockup generator";thisClass.powerupList.push(pitem);var pitem=new MF_PowerupPopupItem();pitem.id="D71a2a2efac7b371c286210b6b88616c4";pitem.name="Annotate export";thisClass.powerupList.push(pitem);var pitem=new MF_PowerupPopupItem();pitem.id="Db737e52f9b5f729c80b4721242b1f1fd";pitem.name="Visualize hotspots ";thisClass.powerupList.push(pitem);};this.toggle2xExport=function(){$(".mfExportAddInputCls").hide();var $this=$(this);if($this.is(":checked")){$("#mfExportImageSelectedBtn").hide();$("#mfExportAddExport2x").show();}else{$("#mfExportAddExport").show();}};this.toggleComments=function(){var $this=$(this);if($this.is(":checked")){thisClass.includeFeedback=true;$("#mfExportPDFRestrictSize").hide();}else{thisClass.includeFeedback=false;if(!thisClass.includeCallout){$("#mfExportPDFRestrictSize").show();}}};this.toggleCallouts=function(){var $this=$(this);if($this.is(":checked")){thisClass.includeCallout=true;$("#mfExportPDFRestrictSize").hide();}else{thisClass.includeCallout=false;if(!thisClass.includeFeedback){$("#mfExportPDFRestrictSize").show();}}};this.toggleA4=function(){var $this=$(this);if($this.is(":checked")){thisClass.includeA4=true;}else{thisClass.includeA4=false;}};this.exportPDFText=function(){if(MF_UserSession.getUser()&&!MF_UserSession.getUser().isBasic){$("#mfPDFExportTypes").hide();$(".mfExportImageScreenCls").hide();$("#mfExportImageLoadScreen").show();$("#mfExportDownloadWait").hide();var localfile="File_"+mf_main.editorController.guidGenerator();var keyname="app/wireframepro/fileexport/Export_"+mf_main.editorController.guidGenerator()+".pdf";MF_ExportManager.exportPDFText(keyname,localfile,mf_main.editorController.projectObj,mf_main.editorController.page.eid,MF_UserSession.getUser(),mf_main.PUBLIC,{callback:function(res){if(!mf_main.PUBLIC){$("#mfPDFExportTypes").show();}$(".mfExportImageScreenCls").hide();$("#mfExportImageDownloadScreen").show();$("#mfDownloadImageBtn").attr("href",MF_Global.getS3URL()+keyname);}});}else{bootbox.hideAll();bootbox.confirm("Export to PDF text format is not available in Basic plan. Upgrade now?",function(msgallow){if(msgallow){mf_main.closeDialog();mf_main.openUpgradeDialog();}});return;}};this.exportImages2Server=function(){if(thisClass.images.size()==0){alert("No pages added");return;}$(".mfExportImageScreenCls").hide();$("#mfExportImageLoadScreen").show();$("#mfExportDownloadWait").hide();if(!mf_main.PUBLIC){$("#mfExportDownloadWait").show();}if(thisClass.exportType=="images"){var localfile="File_"+mf_main.editorController.guidGenerator();var arr=thisClass.images.toArray();var mode2x=false;if(mf_main.DESIGNMODE){if($("#mfInclude2x").is(":checked")){arr=new Array();var pageExport=new MF_PageExport();pageExport.id=mf_main.editorController.page.eid;pageExport.name=mf_main.editorController.page.pageName;pageExport.path="app/wireframepro/company/"+mf_main.editorController.projectObj.company+"/projects/"+mf_main.editorController.projectObj.id+"/pages/"+pageExport.id+"/image/"+pageExport.id+"_2x.png";arr.push(pageExport);mode2x=true;}}if(arr.length==1){$("#mfExportDownloadWait").hide();var mode2xstr=null;if(mode2x){mode2xstr="2";}MF_ExportManager.exportImage(mf_main.editorController.projectObj.id,mf_main.editorController.projectObj.company,arr[0].id,arr[0].path,arr[0],mode2xstr,{callback:function(res){$(".mfExportImageScreenCls").hide();$("#mfExportImageDownloadScreen").show();if(mode2x){$("#mfDownloadImageBtn").attr("href",MF_Global.getS3URL()+"app/wireframepro/fileexport/"+arr[0].id+"_2x.png?"+new Date().getTime());}else{$("#mfDownloadImageBtn").attr("href",MF_Global.getS3URL()+""+arr[0].path+"?"+new Date().getTime());}}});}else{var keyname="app/wireframepro/fileexport/Export_"+mf_main.editorController.guidGenerator()+".zip";MF_ExportManager.exportImages(mf_main.editorController.projectObj.id,mf_main.editorController.projectObj.company,mf_main.editorController.projectObj.title,keyname,localfile,arr,mf_main.editorController.projectObj,MF_UserSession.getUser(),{callback:function(res){$(".mfExportImageScreenCls").hide();$("#mfExportImageDownloadScreen").show();$("#mfDownloadImageBtn").attr("href",MF_Global.getS3URL()+keyname);}});}}if(thisClass.exportType=="ppt"){var localfile="File_"+mf_main.editorController.guidGenerator();var arr=thisClass.images.toArray();var keyname="app/wireframepro/fileexport/Export_"+mf_main.editorController.guidGenerator()+".ppt";MF_ExportManager.exportPPT(mf_main.editorController.projectObj.id,mf_main.editorController.projectObj.company,mf_main.editorController.projectObj.title,keyname,localfile,arr,mf_main.editorController.projectObj,MF_UserSession.getUser(),{callback:function(res){$(".mfExportImageScreenCls").hide();$("#mfExportImageDownloadScreen").show();$("#mfDownloadImageBtn").attr("href",MF_Global.getS3URL()+keyname);}});}if(thisClass.exportType=="pdf"){var localfile="File_"+mf_main.editorController.guidGenerator();var arr=thisClass.images.toArray();$("#mfPDFExportTypes").hide();var keyname="app/wireframepro/fileexport/Export_"+mf_main.editorController.guidGenerator()+".pdf";var fitpage="yes";if(thisClass.includeA4==true){fitpage="no";}MF_ExportManager.exportPDF(mf_main.editorController.projectObj.title,keyname,localfile,arr,mf_main.editorController.projectObj,"portrait","A4",fitpage,"yes",MF_UserSession.getUser(),mf_main.PUBLIC,thisClass.includeFeedback,thisClass.includeCallout,{callback:function(res){if(!mf_main.PUBLIC){$("#mfPDFExportTypes").show();}$(".mfExportImageScreenCls").hide();$("#mfExportImageDownloadScreen").show();$("#mfDownloadImageBtn").attr("href",MF_Global.getS3URL()+keyname);}});}if(thisClass.exportType=="doc"){var localfile="File_"+mf_main.editorController.guidGenerator();var arr=thisClass.images.toArray();var keyname="app/wireframepro/fileexport/Export_"+mf_main.editorController.guidGenerator()+".docx";MF_ExportManager.exportWord(mf_main.editorController.projectObj.title,keyname,localfile,arr,mf_main.editorController.projectObj,MF_UserSession.getUser(),mf_main.PUBLIC,thisClass.includeFeedback,thisClass.includeCallout,{callback:function(res){$(".mfExportImageScreenCls").hide();$("#mfExportImageDownloadScreen").show();$("#mfDownloadImageBtn").attr("href",MF_Global.getS3URL()+keyname);}});}};this.openAddPage2Image=function(){var expbool=thisClass.canExport(mf_main.editorController.page);if(!expbool){MF_Utils.display_ActionIndicator("This page is not permitted for export");return;}var pageExport=new MF_PageExport();pageExport.id=mf_main.editorController.page.eid;pageExport.name=mf_main.editorController.page.pageName;mf_main.editorController.viewFullSize();$("#mfEditorHolder").scrollLeft(0);$("#mfEditorHolder").scrollTop(0);var lf=$("#mfPage"+mf_main.editorController.page.eid).position().left;var tf=$("#mfPage"+mf_main.editorController.page.eid).position().top;$("#mfEditorMask").show();mf_main.interfaceResize();$("#mfPage"+mf_main.editorController.page.eid).css("top",0);$("#mfPage"+mf_main.editorController.page.eid).css("left",0);pageExport.px=mf_main.editorController.page.lowestX;pageExport.py=mf_main.editorController.page.lowestY;pageExport.pw=mf_main.editorController.page.highestWidth;pageExport.ph=mf_main.editorController.page.highestHeight;thisClass.images.addItem(pageExport);$("#mfAddExportLoader").show();$("#mfAddExportTxt").hide();};this.addAllPagesHandler=function(){for(var k=0;k<MF_PagePool.getPages().size();k++){if(thisClass.images.size()==80){alert("Not more than 80 pages can be exported at a time due to server resources.");break;}else{var litem=MF_PagePool.getPages().getItemAt(k);if(litem.navHide==false&&litem.folder==false){thisClass.selectedPageID=litem.eid;thisClass.openAddPage2ImageHandler();}}}try{var getActiveNode=$("#mfExportImagePageList_tv_active");var nodedata=thisClass.imagetreeview.get_node(getActiveNode);if(nodedata&&nodedata.id){thisClass.selectedPageID=nodedata.id;thisClass.selectedPageID=thisClass.selectedPageID.replace("mfExportPage_","");}}catch(e){}thisClass.listPageExport(thisClass.images.toArray());};this.openAddPage2ImageHandler=function(e){if(e){if(thisClass.images.size()==80){alert("Not more than 80 pages can be exported at a time due to server resources.");return;}}var presentPage=false;for(var k=0;k<thisClass.images.size();k++){if(thisClass.images.getItemAt(k).id==thisClass.selectedPageID){presentPage=true;break;}}if(presentPage){return;}if(thisClass.clientExport){var loaded=mf_main.editorController.checkImagesLoaded();if(loaded){thisClass.openAddPage2Image();}else{bootbox.hideAll();bootbox.confirm("All images in this page are not yet loaded. Do you want to continue ?",function(ans){if(ans){thisClass.openAddPage2Image();}});}}else{var expPage=mf_main.editorController.pageController.getPagebyID("mfPageItem"+thisClass.selectedPageID);var expbool=thisClass.canExport(expPage);if(!expbool){MF_Utils.display_ActionIndicator("This page is not permitted for export");return;}var pageExport=new MF_PageExport();pageExport.id=expPage.eid;pageExport.name=expPage.pageName;pageExport.path="app/wireframepro/company/"+mf_main.editorController.projectObj.company+"/projects/"+mf_main.editorController.projectObj.id+"/pages/"+pageExport.id+"/image/"+pageExport.id+".png";thisClass.images.addItem(pageExport);if(e){thisClass.listPageExport(thisClass.images.toArray());}}};this.canExport=function(pageexp){if(mf_main.PERMISSION=="Reviewer"||mf_main.PUBLIC){if(pageexp&&pageexp.navHide){return false;}}return true;};this.searchPageImageHandler=function(e){var searchval=$("#mfExportImagePageSearchBox").val().trim();var query=searchval.toLowerCase();thisClass.imagetreeview.show_all();thisClass.imagetreeview.search(query);};this.listPageExport=function(arr){this.selectedPageExport=null;$("#mfExportedImageList").empty();var cachedTemplate=mf_main.getTemplateFromCache("mfPageExportItemTemplate");if(cachedTemplate==null){$.get("templates/editor/PageExportItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfPageExportItemTemplate").html());mf_main.addTemplateToCache("mfPageExportItemTemplate",template);thisClass.renderPageExportListing(arr,template);});}else{thisClass.renderPageExportListing(arr,cachedTemplate);}};this.renderPageExportListing=function(arr,template){for(var i=0,j=arr.length;i<j;i++){$("#mfExportedImageList").append(template(arr[i]));}$(".mfPageImageDelBtnCls").on("click",thisClass.removePageImageClick);if(arr.length>1){$("#mfPageImageDelBtnAll").show();}else{$("#mfPageImageDelBtnAll").fadeOut("slow");}};this.removePageImageClick=function(e){var page=null;var clickedID=$(this).attr("id");for(var i=0;i<thisClass.images.size();i++){var item=thisClass.images.getItemAt(i);if("mfPageImageDelBtn"+item.id==clickedID){page=item;break;}}if(page){var imind=thisClass.images.getItemIndex(page);if(imind!=-1){thisClass.images.removeItemAt(imind);}thisClass.listPageExport(thisClass.images.toArray());}};this.removeAllPageImageClick=function(e){if(thisClass.images&&thisClass.images.size()>0){thisClass.images.removeAll();thisClass.listPageExport(thisClass.images.toArray());}};this.openExportImagesDialog=function(){$("#mfExportImageSelectedBtn").hide();if(!mf_main.VIEWER){if(mf_main.editorController.componentSelect&&mf_main.editorController.componentSelect.length>0){$("#mfExportImageSelectedBtn").show();}}thisClass.exportType="images";thisClass.openExportDialog();};this.openExportPDFDialog=function(){thisClass.exportType="pdf";$("#mfmultipagepdf").prop("checked",true);thisClass.openExportDialog();};this.openExportDocDialog=function(){thisClass.exportType="doc";thisClass.openExportDialog();};this.openExportHTMLDialog=function(){if(MF_UserSession.getUser().isBasic){bootbox.hideAll();bootbox.confirm("Basic plan does not allow export to HTML5. Upgrade now?",function(msgallow){if(msgallow){mf_main.openUpgradeDialog();}});return;}else{thisClass.exportType="html";thisClass.openExportDialog();}};this.openExportWIREDialog=function(){if(mf_main.DESIGNMODE){thisClass.exportType="dsgn";}else{thisClass.exportType="wire";}thisClass.openExportDialog();};this.openExportPPTDialog=function(){thisClass.exportType="ppt";thisClass.openExportDialog();};this.export2HTML=function(){$(".mfExportImageScreenCls").hide();$("#mfExportImageLoadScreen").show();$("#mfExportDownloadWait").hide();if(!mf_main.PUBLIC){$("#mfExportDownloadWait").show();}var localfile="File_"+mf_main.editorController.guidGenerator();var keyname="app/wireframepro/fileexport/HTML_Export_"+mf_main.editorController.guidGenerator()+".zip";MF_ExportManager.exportHTML5(mf_main.editorController.projectObj.title,keyname,localfile,mf_main.editorController.projectObj,MF_UserSession.getUser(),mf_main.PUBLIC,{callback:function(res){$(".mfExportImageScreenCls").hide();$("#mfExportImageDownloadScreen").show();$("#mfDownloadImageBtn").attr("href",MF_Global.getS3URL()+keyname);}});};this.export2Wire=function(){if(MF_UserSession.getUser().offlineMode==false){bootbox.hideAll();bootbox.confirm("Export to editable offline file format is only for annual licenses. Upgrade now?",function(ans){if(ans){mf_main.openUpgradeDialog();}});return;}$(".mfExportImageScreenCls").hide();$("#mfExportImageLoadScreen").show();$("#mfExportDownloadWait").hide();if(!mf_main.PUBLIC){$("#mfExportDownloadWait").show();}var localfile="File_"+mf_main.editorController.guidGenerator();var keyname="app/wireframepro/fileexport/"+mf_main.editorController.guidGenerator()+".wire";MF_ExportManager.exportAsWire(mf_main.editorController.projectObj.title,keyname,localfile,mf_main.editorController.projectObj,MF_UserSession.getUser(),{callback:function(res){$(".mfExportImageScreenCls").hide();$("#mfExportImageDownloadScreen").show();$("#mfDownloadImageBtn").attr("href",MF_Global.getS3URL()+keyname);}});};this.export2Dsgn=function(){if(MF_UserSession.getUser().offlineMode==false){bootbox.hideAll();bootbox.confirm("Export to editable offline file format is only for annual licenses. Upgrade now?",function(ans){if(ans){mf_main.openUpgradeDialog();}});return;}$(".mfExportImageScreenCls").hide();$("#mfExportImageLoadScreen").show();$("#mfExportDownloadWait").hide();if(!mf_main.PUBLIC){$("#mfExportDownloadWait").show();}var localfile="File_"+mf_main.editorController.guidGenerator();var keyname="app/wireframepro/fileexport/"+mf_main.editorController.guidGenerator()+".dsgn";MF_ExportManager.exportAsWire(mf_main.editorController.projectObj.title,keyname,localfile,mf_main.editorController.projectObj,MF_UserSession.getUser(),mf_main.DESIGNMODE,{callback:function(res){$(".mfExportImageScreenCls").hide();$("#mfExportImageDownloadScreen").show();$("#mfDownloadImageBtn").attr("href",MF_Global.getS3URL()+keyname);}});};this.openExportDialog=function(){$("#mfPDFExportTypes").hide();if(thisClass.exportType=="html"){$(".mfExportImageScreenCls").hide();$("#mfExportHTMLScreen").show();$("#mfExportImageDialogTitle").text("HTML export");$("#mfExportImageDialog").modal();return;}if(thisClass.exportType=="wire"){$(".mfExportImageScreenCls").hide();$("#mfExportWIREScreen").show();$("#mfExportImageDialogTitle").text("Wire export");$("#mfExportImageDialog").modal();return;}if(thisClass.exportType=="dsgn"){$(".mfExportImageScreenCls").hide();$("#mfExportDSGNScreen").show();$("#mfExportImageDialogTitle").text("DSGN file export");$("#mfExportImageDialog").modal();return;}var mapdata=MF_PagePool.getMap("mfExportPage");$("#mfAddExportLoader").hide();$("#mfAddExportTxt").show();$("#mfExportImagePageList").empty();$("#mfExportImagePageList").jstree({core:{animation:0,themes:{dots:false},data:mapdata,worker:false,},plugins:["search"],search:{show_only_matches:true}});thisClass.imagetreeview=$("#mfExportImagePageList").jstree(true);$("#mfExportImagePageList").on("search.jstree",function(nodes,str,res){if(str.nodes.length===0){thisClass.imagetreeview.hide_all();}});$("#mfExportImagePageList").on("click",function(e,data){thisClass.exportImageItemClick();});thisClass.imagetreeview.open_all();$("#mfInclude2xChk").hide();$("#mfIncludeCommentsChk").hide();$("#mfIncludeCalloutsChk").hide();$("#mfIncludeA4Chk").hide();$(".mfExportAddInputCls").hide();$("#mfExportAddExport").show();if(thisClass.exportType=="pdf"){$("#mfExportImageBtn").text("Create PDF");$("#mfExportImageDialogTitle").text("PDF export");$("#mfIncludeCommentsChk").show();if(!mf_main.PUBLIC){$("#mfPDFExportTypes").show();}$("#mfIncludeCalloutsChk").show();$("#mfIncludeA4Chk").show();}if(thisClass.exportType=="doc"){$("#mfExportImageBtn").text("Create Doc");$("#mfExportImageDialogTitle").text("Word export");$("#mfIncludeCommentsChk").show();$("#mfIncludeCalloutsChk").show();}if(thisClass.exportType=="ppt"){$("#mfExportImageBtn").text("Create PowerPoint");$("#mfExportImageDialogTitle").text("Powerpoint export");}if(thisClass.exportType=="images"){if(mf_main.DESIGNMODE){$("#mfInclude2xChk").show();$(".mfExportAddInputCls").hide();if($("#mfInclude2x").is(":checked")){$("#mfExportAddExport2x").show();}else{$("#mfExportAddExport").show();}}$("#mfExportImageBtn").text("Create PNG");$("#mfExportImageDialogTitle").text("Image export");}$(".mfExportImageScreenCls").hide();$("#mfExportImageAddScreen").show();var pageTreeItemData=thisClass.imagetreeview.get_node("mfExportPage_"+mf_main.editorController.page.eid);if(pageTreeItemData){thisClass.imagetreeview.deselect_all(true);thisClass.imagetreeview.select_node(pageTreeItemData);thisClass.selectedPageID=pageTreeItemData.id;thisClass.selectedPageID=thisClass.selectedPageID.replace("mfExportPage_","");}$("#mfExportImageDialog").modal();try{setTimeout(function(){thisClass.imagetreeview.get_node("mfExportPage_"+thisClass.selectedPageID,true).children(".jstree-anchor").focus();},500);}catch(err){}};this.exportImageItemClick=function(e){var nodedata=thisClass.imagetreeview.get_selected(true)[0];if(nodedata&&nodedata.icon!="images/editor/folder.svg"){thisClass.selectedPageID=nodedata.id;thisClass.selectedPageID=thisClass.selectedPageID.replace("mfExportPage_","");if(thisClass.clientExport){mf_main.editorController.pageController.selectPage("mfPageItem"+nodedata.id);mf_main.editorController.viewPage(mf_main.editorController.pageController.selectedPage);}}};this.togglePowerupMenu=function(){$("#mfExportSectionPowerupMenu").toggle();if($("#mfExportSectionPowerupMenu").is(":empty")){thisClass.renderPowerupPopupItems();}};this.renderPowerupPopupItems=function(){$("#mfExportSectionPowerupMenu").empty();var htmldom="";var template=Handlebars.compile($("#mfPowerupPopupItemTemplate").html());var arr=thisClass.powerupList;for(i=0;i<arr.length;i++){htmldom=htmldom+template(arr[i]);}$("#mfExportSectionPowerupMenu").append(htmldom);$("#mfExportSectionPowerupMenu .mfPowerupPopupItem").on("click",thisClass.selectPowerup);};this.selectPowerup=function(){var pid=$(this).attr("data-powerupid");mf_main.editorController.powerupController.openPowerupbyID(pid);};}function MF_StoreController(){var thisClass=this;this.categories=new Array();this.categoriesListed=false;this.orderType="new";this.selectedCategory="all";this.currentStoreCategory="all";this.currentOrderType="new";this.currentPackCategory="all";this.currentPowerupCategory="all";this.currentLimit=0;this.showApproved=true;this.currentStoreItem=null;this.storeEditTemplateTypeList=null;this.itemCollection=new ArrayCollection();this.discoverItemCollection=new ArrayCollection();this.templatesLoaded=false;this.uipacksLoaded=false;this.searchTemplatesLoaded=false;this.searchUIPacksLoaded=false;this.listingItemsOnScroll=false;this.removeLoaderOnScroll=false;this.integrationListed=false;this.startTemplateIndex=0;this.searchTemplateIndex=0;this.startUIPackIndex=0;this.searchUIPackIndex=0;this.offset=50;this.searching=false;this.checkSearchItemsLoaded=0;this.searchProcessing=true;this.itemType="all";this.featuredImageListed=false;this.featuredImageSliderEnabled=true;this.featureditemCollection=new ArrayCollection();this.featuredPackImageFile=null;this.eventListeners=false;this.currentImageWidth=0;this.currentImageHeight=0;this.lazyLoadingInProcess=false;this.storeIntegrationsCollection=[{id:"desktopIntegrationMF",category:"Desktop Applications",description:"Native platform apps with fast loading times, desktop notifications and offline mode",items:[{iconurl:"images/store/integration/windows.png",integrationName:"Windows 10",desc:"Certified Windows application with installer and other platform specific features",sourcelink:"https://d2njum3rvx672a.cloudfront.net/windows/WireframePro-Desktop.exe",mfintegrationbtntext:"Download exe",type:"desktop"},{iconurl:"images/store/integration/mac.png",integrationName:"Mac OS",desc:"WireframePro app designed and optimized for Mac OS with top menu, shortcuts and notifications",sourcelink:"https://d2njum3rvx672a.cloudfront.net/mac/WireframePro-Desktop.dmg",mfintegrationbtntext:"Download dmg",type:"desktop"}]},{id:"collaborationIntegrationMF",category:"Collaboration",description:"Enhance UI design collaboration with your everyday tools",items:[{iconurl:"images/store/integration/slack.png",integrationName:"Slack",desc:"Draw and post wireframes of your UI directly to your Slack channels",sourcelink:"https://slack.com/oauth/authorize?&client_id=10039907988.176302646913&scope=commands,files:write:user",mfintegrationbtntext:"Integrate"},{iconurl:"images/store/integration/drive.png",integrationName:"Google Drive",desc:"Integrates with your Google Drive web interface. Create and save UI designs to your Gdrive",sourcelink:"https://workspace.google.com/u/0/marketplace/app/wireframepro/413107853716?hl=en&pann=drive_app_widget",mfintegrationbtntext:"Integrate"},{iconurl:"images/store/integration/docs.png",integrationName:"Google Docs",desc:"WireframePro extension for Google Docs. Design and embed UI designs in your documents",sourcelink:"https://workspace.google.com/u/0/marketplace/app/wireframepro_gdocsaddon/127057374885",mfintegrationbtntext:"Integrate"},{iconurl:"images/store/integration/office.png",integrationName:"Office 365",desc:"Integrate WireframePro with MS Office web and desktop apps for seemless design documentation",sourcelink:"https://appsource.microsoft.com/en-us/product/office/WA104381268?src=office&amp;tab=Overview",mfintegrationbtntext:"Integrate"},{iconurl:"images/store/integration/teams.png",integrationName:"Microsoft Teams",desc:"Easily share and collaborate on UI designs inside Microsoft Teams",sourcelink:"https://appsource.microsoft.com/en-gb/product/office/WA200002301?tab=Overview",mfintegrationbtntext:"Integrate"}]},{id:"productivityIntegrationMF",category:"Task Management",description:"Illustrate UI ideas in your tasks",items:[{iconurl:"images/store/integration/trello.png",integrationName:"Trello",desc:"Visualize UI designs in your boards using WireframePro Power-up",sourcelink:"http://info.trello.com/power-ups/wireframepro",mfintegrationbtntext:"Integrate"},{iconurl:"images/store/integration/confluence.png",integrationName:"Confluence",desc:"Atlassian addon for inserting UI designs in Confluence wiki pages. Separate license is required",sourcelink:"https://marketplace.atlassian.com/plugins/com.mockflow.wireframepro.integrations.confluence/cloud/overview",mfintegrationbtntext:"Integrate"},{iconurl:"images/store/integration/jira.png",integrationName:"JIRA",desc:"Atlassian addon for drawing and attaching UI designs in JIRA tasks. Separate license is required",sourcelink:"https://marketplace.atlassian.com/plugins/com.mockflow.wireframepro.integrations.jira/cloud/overview",mfintegrationbtntext:"Integrate"}]},{id:"securityIntegrationMF",category:"Single Sign-On",description:"Sign-in to MockFlow with any third party Identity Provider that supports SSO/SAML",items:[{iconurl:"images/store/integration/gSuite.png",integrationName:"G Suite",desc:"SSO using Google OpenID for GSuite business apps and Google accounts",sourcelink:"https://gsuite.google.com/marketplace/app/wireframepro/413107853716",mfintegrationbtntext:"Integrate"},{iconurl:"images/store/integration/okta.png",integrationName:"Okta",desc:"Built-in support for OKTA identity cloud, approved and verified by OKTA team",sourcelink:"https://saml-doc.okta.com/SAML_Docs/How-to-Configure-SAML-2.0-for-MockFlow.html",mfintegrationbtntext:"Integrate"},{iconurl:"images/store/integration/azure.png",integrationName:"Azure",desc:"Single Sign On with Microsoft Azure Active Directory for a seamless sign-in",sourcelink:"https://docs.microsoft.com/en-us/azure/active-directory/saas-apps/saml-toolkit-tutorial",mfintegrationbtntext:"Integrate"}]}];this.constructor=function(){};this.openTemplateGroup=function(){$(".mfStoreGroupTemplates").removeClass("active");$(this).addClass("active");var tid=$(this).attr("data-id");var category=tid;thisClass.currentStoreCategory=category;thisClass.templatesLoaded=false;$("#mfStoreTemplateListing").empty();thisClass.startTemplateIndex=0;thisClass.listTemplates();};this.openUIPackGroup=function(){$(".mfStoreGroupUIPacks").removeClass("active");$(this).addClass("active");var tid=$(this).attr("data-id");var category=tid;thisClass.currentPackCategory=category;thisClass.uipacksLoaded=false;$("#mfUIPackListing").empty();thisClass.startUIPackIndex=0;thisClass.listTemplates();};this.openPowerupGroup=function(){$(".mfStoreGroupPowerups").removeClass("active");$(this).addClass("active");var tid=$(this).attr("data-id");var category=tid;thisClass.currentPowerupCategory=category;mf_main.editorController.powerupStoreController.loadCategory(category);};this.openIntegrationGroup=function(){var tid=$(this).attr("data-id");var category=tid;if(category=="all"){$("#mfStoreTemplateWrapper").scrollTop(0);return;}var top=document.getElementById(category+"IntegrationMF").offsetTop;$("#mfStoreTemplateWrapper").scrollTop(top);};this.attachEvents=function(){$(".mfStoreGroupTemplates").on("click",thisClass.openTemplateGroup);$(".mfStoreGroupUIPacks").on("click",thisClass.openUIPackGroup);$(".mfStoreGroupPowerups").on("click",thisClass.openPowerupGroup);$(".mfStoreGroupIntegrations").on("click",thisClass.openIntegrationGroup);$(".mfStoreCloseBtn").on("click",thisClass.closeStore);$("#mfStoreGoBack,#mfStoreGoBack2, #mfStoreTemplateViewerImageHolder").on("click",thisClass.goBackHandler);$("#mfStoreEditTemplate").on("click",thisClass.editTemplateHandler);$("#mfSubmitEditedStoreTemplate").on("click",thisClass.saveTemplateHandler);$("#mfCloseEditedStoreTemplate").on("click",thisClass.closeEditTemplateHandler);$("#mfImportTemplateBtn").on("click",thisClass.importTemplateHandler);$("#mfStoreDeleteTemplate").on("click",thisClass.deleteTemplateHandler);$(".mfStoreCheckBox").on("change",thisClass.orderSelectHandler);$(".mfStoreTypeSelector").on("click",thisClass.clickSelectHandler);$(".mfStoreTypeSelector").on("change",thisClass.viewSelectHandler);$(".mfStoreSeeAllBtn").on("click",thisClass.seeAllSelectHandler);$("#mfOnlyUnApprovedTemplatesBtn").on("click",thisClass.toggleApprovedHandler);$("#mfStoreTemplateWrapper, #mfStoreSearchWrapper").on("scroll",thisClass.loadTemplatesOnScroll);$("#mfStoreTemplateTypeEdit, #mfSelectStoreTemplate").kendoDropDownList({optionLabel:"Select Type...",dataTextField:"text",dataValueField:"value",dataSource:mf_main.editorController.editManager.storeCategoryArray,});$("#mfCategoryType").kendoDropDownList({optionLabel:"All",dataTextField:"text",dataValueField:"value",dataSource:mf_main.editorController.editManager.storeCategoryArray,change:thisClass.categoryItemClick});thisClass.storeEditTemplateTypeList=$("#mfStoreTemplateTypeEdit").data("kendoDropDownList");$("#mfSearchStoreInput").on("keypress",function(e){e.stopImmediatePropagation();if(e.which==13&&$("#mfSearchStoreInput").val().trim()!=""&&thisClass.searchProcessing){e.preventDefault();thisClass.searchProcessing=false;thisClass.searchTemplates();}});$("#mfSearchStoreInput").on("textchange",function(){if($("#mfSearchStoreInput").val().trim()==""){thisClass.clearStoreSearchItems();}});$("#mfStoreClearSearchBtn").on("click",thisClass.clearStoreSearchItems);$(document).on("click","#mfFeaturedImageCarousel div",thisClass.storeItemClick);$("#mfFeaturePrevBtn").on("click",function(){if(thisClass.featuredImageSliderEnabled){thisClass.featuredImageSliderEnabled=false;$("#mfFeaturedImageCarousel div.mfFeaturedPrev, #mfFeaturedImageCarousel div.mfFeaturedPrevLeftSecond, #mfFeaturedImageCarousel div.mfFeaturedSelected, #mfFeaturedImageCarousel div.mfFeaturedNext, #mfFeaturedImageCarousel div.mfFeaturedNextRightSecond").removeClass("mfFeaturedImageRemoveTransition");thisClass.moveToSelected("prev");}});$("#mfFeatureNextBtn").on("click",function(){if(thisClass.featuredImageSliderEnabled){thisClass.featuredImageSliderEnabled=false;$("#mfFeaturedImageCarousel div.mfFeaturedPrev, #mfFeaturedImageCarousel div.mfFeaturedPrevLeftSecond, #mfFeaturedImageCarousel div.mfFeaturedSelected, #mfFeaturedImageCarousel div.mfFeaturedNext, #mfFeaturedImageCarousel div.mfFeaturedNextRightSecond").removeClass("mfFeaturedImageRemoveTransition");thisClass.moveToSelected("next");}});$("#mfStoreFiltersDropdown").on("click",function(){$(this).parent().toggleClass("open");});$('.mfStoreTypeTabWrapper input[type="checkbox"]').on("change",function(){$('.mfStoreTypeTabWrapper input[type="checkbox"]').not(this).prop("checked",false);thisClass.groupChangeHandler();});$("#mfStoreImageViewerZoomOutButton").prop("disabled",true);$("#mfStoreImageViewerZoomInButton").on("click",thisClass.zoomIn);$("#mfStoreImageViewerZoomOutButton").on("click",thisClass.zoomOut);$("#mfStoreImageViewerFitButton").on("click",thisClass.fitImage);$("#mfStoreImageViewerFullSizeButton").on("click",thisClass.fitImageSize);};this.moveToSelected=function(element){$("#mfFeaturedImageCarousel div").show();var selected=element;if(element=="next"){var selected=$(".mfFeaturedNext");}else{if(element=="prev"){var selected=$(".mfFeaturedPrev");}}var next=$(selected).next();var prev=$(selected).prev();var prevSecond=$(prev).prev();var nextSecond=$(next).next();$(selected).removeClass().addClass("mfFeaturedSelected");$(prev).removeClass().addClass("mfFeaturedPrev");$(next).removeClass().addClass("mfFeaturedNext");$(nextSecond).removeClass().addClass("mfFeaturedNextRightSecond");$(prevSecond).removeClass().addClass("mfFeaturedPrevLeftSecond");$(nextSecond).nextAll().removeClass().addClass("mfFeaturedHideRight");$(prevSecond).prevAll().removeClass().addClass("mfFeaturedHideLeft");if(selected.is(":first-child")){$("#mfFeaturedImageCarousel > div:last-child").removeClass().addClass("mfFeaturedPrev");$("#mfFeaturedImageCarousel > div").eq(($("#mfFeaturedImageCarousel > div").length-2)).removeClass().addClass("mfFeaturedPrevLeftSecond");}else{if(selected.is(":last-child")){$("#mfFeaturedImageCarousel > div").eq(0).removeClass().addClass("mfFeaturedNext");$("#mfFeaturedImageCarousel > div").eq(1).removeClass().addClass("mfFeaturedNextRightSecond");}else{if(selected.is(":nth-child(2)")){$("#mfFeaturedImageCarousel div:last-child").removeClass().addClass("mfFeaturedPrevLeftSecond");}else{if(selected.is(":nth-child("+($("#mfFeaturedImageCarousel > div").length-1)+")")){$("#mfFeaturedImageCarousel > div").eq(0).removeClass().addClass("mfFeaturedNextRightSecond");}}}}thisClass.featuredImageResizeHandler(element);};this.featuredImageResizeHandler=function(direction){var sliderWidth=($(".mfFeaturedCarouselWrapper").width()/2)-420;var sliderSpaceLeft=sliderWidth-800;$("#mfFeaturedImageCarousel div.mfFeaturedPrev").css("left",sliderSpaceLeft+"px");$("#mfFeaturedImageCarousel div.mfFeaturedSelected").css("left",sliderSpaceLeft+"px");$("#mfFeaturedImageCarousel div.mfFeaturedHideLeft").css("left",sliderSpaceLeft-820+"px");if(typeof direction!="undefined"&&direction=="prev"){$("#mfFeaturedImageCarousel div.mfFeaturedPrevLeftSecond").hide().css("left",sliderSpaceLeft-820+"px");}else{$("#mfFeaturedImageCarousel div.mfFeaturedPrevLeftSecond").css("left",sliderSpaceLeft-820+"px");}var sliderSpaceRight=($(".mfFeaturedCarouselWrapper").width()/2)+420;$("#mfFeaturedImageCarousel div.mfFeaturedNext").css("left",sliderSpaceRight+"px");$("#mfFeaturedImageCarousel div.mfFeaturedHideRight").css("left",sliderSpaceRight+820+"px");if(typeof direction!="undefined"&&direction=="next"){$("#mfFeaturedImageCarousel div.mfFeaturedNextRightSecond").hide().css("left",sliderSpaceRight+820+"px");}else{$("#mfFeaturedImageCarousel div.mfFeaturedNextRightSecond").css("left",sliderSpaceRight+820+"px");}};this.groupChangeHandler=function(){thisClass.listTemplates();};this.orderSelectHandler=function(e){$(".mfStoreCheckBox").prop("checked",false);$(this).prop("checked",true);thisClass.currentOrderType=$(this).attr("data-order");thisClass.templatesLoaded=false;thisClass.uipacksLoaded=false;$("#mfStoreTemplateListing, #mfUIPackListing").empty();thisClass.startTemplateIndex=0;thisClass.startUIPackIndex=0;thisClass.listTemplates();};this.clickSelectHandler=function(e){thisClass.goBackHandler();};this.viewSelectHandler=function(e){$(".mfStoreTypeSelector").prop("checked",false);$(this).prop("checked",true);thisClass.listTemplates();};this.seeAllSelectHandler=function(e){var selectedType=$(this).attr("data-type");$(".mfStoreTypeSelector").prop("checked",false);$("#"+selectedType).prop("checked",true);if(thisClass.searching){thisClass.clearStoreSearchItems();}$("#mfStoreTemplateWrapper").scrollTop(0);thisClass.listTemplates();};this.searchTemplates=function(e){thisClass.searching=true;$(".mfStoreMain").hide();$("#mfStoreTemplateListingLoader").show();$(".mfStoreTypeTabWrapper, #mfStoreClearSearchBtn").addClass("mfStoreActionDenied");thisClass.checkSearchItemsLoaded=0;$(".mfStoreResultList").empty();thisClass.searchTemplateIndex=0;thisClass.searchUIPackIndex=0;thisClass.searchTemplatesLoaded=false;thisClass.searchUIPacksLoaded=false;if($("#mfSearchStoreInput").val().trim()!=""){$("#mfStoreClearSearchBtn").show();$(".mfStoreSearchKeyword").html('"'+$("#mfSearchStoreInput").val().trim()+'"');thisClass.listTemplates();}else{thisClass.clearStoreSearchItems();}};this.showStoreSearchSections=function(){$(".mfStoreResultSection").hide();if(thisClass.itemType=="all"){$(".mfStoreResultSection").show();}else{if(thisClass.itemType=="uipack"){$(".mfUIPacksResults").show();}else{if(thisClass.itemType=="template"){$(".mfTemplateResults").show();}else{if(thisClass.itemType=="powerup"){$(".mfPowerUpResults").show();}else{if(thisClass.itemType=="integration"){$(".mfIntegrationResults").show();}}}}}};this.showStoreSearchItems=function(){if(thisClass.checkSearchItemsLoaded==0){$(".mfStoreMain").hide();$("#mfStoreSearchWrapper").show();if(!thisClass.listingItemsOnScroll){$("#mfStoreSearchWrapper").scrollTop(0);}$(".mfStoreTypeTabWrapper, #mfStoreClearSearchBtn").removeClass("mfStoreActionDenied");thisClass.resize();thisClass.searchProcessing=true;}};this.clearStoreSearchItems=function(){if(thisClass.checkSearchItemsLoaded==0){$("#mfSearchStoreInput").val("");$(".mfStoreResultList").empty();$("#mfStoreClearSearchBtn").hide();thisClass.searchTemplateIndex=0;thisClass.searchUIPackIndex=0;$("#mfStoreSearchBoxIcon").show();thisClass.searching=false;thisClass.searchTemplatesLoaded=false;thisClass.searchUIPacksLoaded=false;thisClass.listTemplates();}};this.deleteTemplateHandler=function(e){var mfItemType=thisClass.currentStoreItem.itemType;bootbox.hideAll();bootbox.confirm("Do you want to remove this "+Handlebars.Utils.escapeExpression(mfItemType)+" from store ?",function(ans){if(ans){thisClass.goBackHandler();$(".mfStoreMain").hide();$("#mfStoreTemplateListingLoader").show();$("#mfStoreItem"+thisClass.currentStoreItem.id).remove();MF_WireframeStoreManager.deleteTemplate(MF_UserSession.getUser(),thisClass.currentStoreItem,{callback:function(template){if(mf_main.editorController.storeController.searching){$(".mfStoreMain").hide();$("#mfStoreSearchWrapper").show();$("#mfStoreSearchWrapper").scrollTop(0);}else{if(thisClass.itemType=="all"){$(".mfStoreMain").hide();$("#mfStoreDiscoverWrapper").show();$("#mfStoreDiscoverWrapper").scrollTop(0);}else{if(thisClass.itemType=="template"){$(".mfStoreMain, .mfStoreBackDrop").hide();$("#mfStoreTemplateListing, .mfStoreTemplateBackdrop").show();$("#mfStoreTemplateWrapper").show();$("#mfStoreTemplateWrapper").scrollTop(0);}else{if(thisClass.itemType=="uipack"){$(".mfStoreMain, .mfStoreBackDrop").hide();$("#mfUIPackListing, .mfStoreUIPackBackdrop").show();$("#mfStoreTemplateWrapper").show();$("#mfStoreTemplateWrapper").scrollTop(0);}}}}if(thisClass.currentStoreItem.featured){thisClass.featuredImageListed=false;thisClass.listFeatureImage();}}});}});};this.importTemplateHandler=function(e){if(thisClass.currentStoreItem.itemType=="uipack"){var uiPackIndex=MF_Utils.searchObjArray(mf_main.componentList.categories,"id",thisClass.currentStoreItem.packId);if(uiPackIndex==-1){thisClass.goBackHandler();$(".mfStoreMain").hide();$("#mfStoreTemplateListingLoader").show();if(mf_main.editorController.EDITOR==false){mf_main.editorController.showEditor();}thisClass.closeStore();var selectedpack=thisClass.currentStoreItem;var newpack=new MF_CompCategory();newpack.id=selectedpack.packId;newpack.clientid=MF_UserSession.getUser().company;newpack.name=selectedpack.name;newpack.builtin=false;newpack.modify=true;newpack.custompack=true;newpack.importcategory="none";newpack.isMaster=false;newpack.isShared=true;newpack.masterClientid=selectedpack.clientId;newpack.includeCommon=selectedpack.includeCommon;$("#mfCatInputTxt").text(newpack.name);mf_main.componentList.showComponentPlaceHolder();MF_PackManager.createNewPack(MF_UserSession.getUser(),newpack,mf_main.editorController.projectObj.id,{callback:function(result){$(".mfStoreMain, .mfStoreBackDrop").hide();$("#mfUIPackListing, .mfStoreUIPackBackdrop").show();$("#mfStoreTemplateWrapper").show();if(result=="exists"){MF_Utils.display_ActionIndicator("Pack already imported");if(newpack&&newpack.id==mf_main.componentList.currentCategory){mf_main.componentList.currentCategory="";}}else{MF_Utils.display_ActionIndicator("Pack imported!");if(mf_main.componentList.categoryListed){mf_main.componentList.categories.push(newpack);var cachedCatTemplate=mf_main.getTemplateFromCache("mfComponentCategoryItemTemplate");mf_main.componentList.renderCategoryItems(cachedCatTemplate);}}thisClass.closeStore();mf_main.componentList.viewCategory(newpack.id);}});}else{alert("The selected UI Pack is already available for your account.");}}else{thisClass.goBackHandler();$(".mfStoreMain").hide();$("#mfStoreTemplateListingLoader").show();mf_main.editorController.closeGroupEditing();MF_WireframeStoreManager.importTemplate(thisClass.currentStoreItem,mf_main.editorController.projectObj,false,mf_main.DESIGNMODE,{callback:function(template){$(".mfStoreMain, .mfStoreBackDrop").hide();$("#mfStoreTemplateListing, .mfStoreTemplateBackdrop").show();$("#mfStoreTemplateWrapper").show();if(mf_main.editorController.EDITOR==false){mf_main.editorController.showEditor();}if(template){var offX=$("#mfEditorHolder").scrollLeft()+100;var offY=$("#mfEditorHolder").scrollTop()+100;if(template.customFonts.length>0){for(var i=0;i<template.customFonts.length;i++){var customFontObj=template.customFonts[i];mf_main.editorController.fontController.addCustomFontHandler(customFontObj);mf_main.rtc.customFontSync("addcustomfont",customFontObj,true);}}if(mf_main.DESIGNMODE){offX=10;offY=10;mf_main.editorController.selectAll(true);mf_main.editorController.editManager.deleteComponent();var jData=$(template.data);try{jData.find("size").each(function(){var stype=$(this).attr("type");if(stype=="customsize"){var ws=parseInt($(this).attr("w"));var hs=parseInt($(this).attr("h"));mf_main.editorController.page.overrideSize=true;mf_main.editorController.page.autoResize=false;mf_main.editorController.page.width=ws;mf_main.editorController.page.height=hs;mf_main.editorController.page.origWidth=ws;mf_main.editorController.page.origHeight=hs;mf_main.editorController.page.sizeType="custom";MF_ChangeManager.CHANGED(true);mf_main.editorController.resizePage();}});}catch(e){}}mf_main.editorController.gridController.dtype=template.type;mf_main.editorController.addDBComponent(template.data,offX,offY);mf_main.editorController.imageController.listed=false;mf_main.editorController.openNavBarContent("mfNavElementBtn");mf_main.rtc.imageSync("refreshImageListing",null);}thisClass.closeStore();}});}};this.saveTemplateHandler=function(e){e.stopImmediatePropagation();if(MF_Global.adminAllow()){thisClass.currentStoreItem.name=$("#mfStoreTemplateTitleEdit").val().trim();if(thisClass.currentStoreItem.name==""){alert("Name should not be empty");return;}var temptype=null;if(thisClass.currentStoreItem.itemType=="uipack"){temptype=thisClass.storeEditTemplateTypeList.dataItem().value;}else{temptype=$("#mfTemplateEditType").val();}if(temptype==""){alert("Select a template type");return;}thisClass.currentStoreItem.type=temptype;var approved=false;if($("#mfToggleStoreTemplateApprovedBtn").is(":checked")){approved=true;}thisClass.refreshFeaturedPack=false;if(thisClass.currentStoreItem.itemType=="uipack"&&$("#mfStoreIsFeaturedBtn").is(":checked")){if(!thisClass.currentStoreItem.featured&&$("#mfStoreFeaturedImgInput").val()==""){alert("Select UI Pack Featured image");return;}thisClass.currentStoreItem.featured=true;thisClass.featuredPackImageFile=document.getElementById("mfStoreFeaturedImgInput").files[0];if(thisClass.featuredPackImageFile!=undefined){thisClass.addPackFeaturedImageHandler();}}else{if(thisClass.currentStoreItem.itemType=="uipack"&&!$("#mfStoreIsFeaturedBtn").is(":checked")){if(thisClass.currentStoreItem.featured){thisClass.refreshFeaturedPack=true;}thisClass.currentStoreItem.featured=false;}else{thisClass.featuredPackImageFile=document.getElementById("mfStoreFeaturedImgInput").files[0];if(thisClass.featuredPackImageFile!=undefined){thisClass.addPackFeaturedImageHandler("template");}}}thisClass.currentStoreItem.approved=approved;$("#mfStoreItemTitle"+thisClass.currentStoreItem.id).text(thisClass.currentStoreItem.name);thisClass.goBackHandler();MF_WireframeStoreManager.updateTemplate(MF_UserSession.getUser(),thisClass.currentStoreItem,{callback:function(){if(thisClass.refreshFeaturedPack){thisClass.featuredImageListed=false;thisClass.listFeatureImage();}}});}};this.editTemplateHandler=function(e){e.stopImmediatePropagation();$("#mfStoreTemplateTitleEdit").val(thisClass.currentStoreItem.name);$("#mfTemplateEditType").val(thisClass.currentStoreItem.type);$("#mfToggleStoreTemplateApprovedBtn").prop("checked",thisClass.currentStoreItem.approved);thisClass.storeEditTemplateTypeList.value(thisClass.currentStoreItem.type);$("#mfStoreFeaturedInputDiv").show();if(thisClass.currentStoreItem.itemType=="uipack"){$("#mfStoreTemplateTypeEdit").show();$("#mfTemplateEditType").hide();thisClass.storeEditTemplateTypeList.wrapper.show();$("#mfStoreIsFeaturedBtn").prop("checked",thisClass.currentStoreItem.featured);$("#mfStoreFeaturedImgInput").attr({value:""});$("#mfSubmitEditedStoreTemplate").text("Edit UI Pack");}else{$("#mfStoreFeaturedImgInput").attr({value:""});thisClass.storeEditTemplateTypeList.wrapper.hide();$("#mfTemplateEditType").show();$("#mfSubmitEditedStoreTemplate").text("Edit Template");}$("#mfStoreTemplateDetailsInput").hide();$("#mfStoreTemplateDetailsEdit").show();};this.closeEditTemplateHandler=function(){$("#mfStoreTemplateDetailsInput").show();$("#mfStoreTemplateDetailsEdit").hide();};this.openStore=function(opentype){if(mf_main.editorController.projectObj!=null){if(!mf_main.editorController.pageloaded){return;}if(thisClass.eventListeners==false){this.attachEvents();$("#mfSearchStoreInput").val("");$(".mfStoreResultList").empty();$("#mfStoreClearSearchBtn").hide();$(".mfStoreTypeTabWrapper, #mfStoreClearSearchBtn").removeClass("mfStoreActionDenied");thisClass.searching=false;mf_main.editorController.closeCompMode();if(MF_Global.adminAllow()){$("#mfOnlyUnApprovedTemplates").show();}}if(!thisClass.searching){if(opentype=="uipack"){thisClass.itemType="uipack";}if(opentype=="powerup"){thisClass.itemType="powerup";}if(thisClass.itemType=="uipack"){$(".mfStoreTypeSelector").prop("checked",false);$("#mfTypeUiPack").prop("checked",true);}else{if(thisClass.itemType=="template"){$(".mfStoreTypeSelector").prop("checked",false);$("#mfTypeTemplate").prop("checked",true);}else{if(thisClass.itemType=="powerup"){$(".mfStoreTypeSelector").prop("checked",false);$("#mfTypePowerUp").prop("checked",true);}else{if(thisClass.itemType=="integration"){$(".mfStoreTypeSelector").prop("checked",false);$("#mfTypeIntegration").prop("checked",true);}else{$(".mfStoreTypeSelector").prop("checked",false);$("#mfTypeAll").prop("checked",true);$(".mfStoreMain").hide();$("#mfStoreDiscoverWrapper").show();$("#mfStoreDiscoverWrapper").scrollTop(0);thisClass.featuredImageSliderEnabled=true;}}}}}$("#mfStoreInterface").css("left","-500px");$("#mfStoreInterface").addClass("mfStoreActionDenied");$("#mfStoreInterface").show();$("#mfStoreInterface").animate({left:"0px",},{duration:100,complete:function(){$("#mfStoreInterface").removeClass("mfStoreActionDenied");}});if(thisClass.eventListeners==false){thisClass.eventListeners=true;thisClass.listTemplates();thisClass.listFeatureImage();}else{if(opentype=="powerup"||opentype=="uipack"){thisClass.listTemplates();}}}else{MF_Utils.display_ActionIndicator("Project is loading, Please wait");}};this.listLatestPowerups=function(){if(mf_main.editorController.powerupController.installedPowerupsCollection==null){mf_main.editorController.powerupController.getInstalledPowerups();}if($(".mfLatestPowerupList .mfPowerupIconLayoutItem").length==0){MF_PowerupManager.listAllPowerups(MF_UserSession.getUser(),10,{callback:function(powerupList){if(powerupList!=null){mf_main.editorController.powerupStoreController.powerupStoreDiscoverCollection=new ArrayCollection();for(var i=0;i<powerupList.length;i++){var nitem=new MF_Powerup();nitem.cast(powerupList[i]);if((nitem.name.toLowerCase()!="zoom meetings")||(MF_UserSession.getUser().username.indexOf("@produle.com")!=-1)){mf_main.editorController.powerupStoreController.powerupStoreDiscoverCollection.addItem(nitem);}}thisClass.applyLatestPowerupTemplate(mf_main.editorController.powerupStoreController.powerupStoreDiscoverCollection);}else{MF_Utils.display_ActionIndicator("Error: Could not fetch powerups");}}});}};this.applyLatestPowerupTemplate=function(powerupList){var cachedTemplate=mf_main.getTemplateFromCache("mfLatestPowerupItemTemplate");if(cachedTemplate==null){$.get("templates/editor/LatestPowerupItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfLatestPowerupItemTemplate").html());mf_main.addTemplateToCache("mfLatestPowerupItemTemplate",template);thisClass.renderLatestPowerupItem(template,powerupList);});}else{thisClass.renderLatestPowerupItem(cachedTemplate,powerupList);}};this.renderLatestPowerupItem=function(template,powerupList){var htmldom="";for(var i=0;i<powerupList.size();i++){var nitem=powerupList.getItemAt(i);htmldom=htmldom+template(nitem);}$(".mfLatestPowerupList").html(htmldom);$(".mfPowerupIconInstallBtn.install").off("click");$(".mfPowerupIconInstallBtn.install").on("click",mf_main.editorController.powerupStoreController.installPowerup);$(".mfPowerupIconLayoutItem").off("click");$(".mfPowerupIconLayoutItem").on("click",mf_main.editorController.powerupStoreController.storePowerupItemClick);};this.toggleApprovedHandler=function(){if($("#mfOnlyUnApprovedTemplatesBtn").is(":checked")){thisClass.showApproved=false;}else{thisClass.showApproved=true;}thisClass.templatesLoaded=false;thisClass.uipacksLoaded=false;$("#mfStoreTemplateListing, #mfUIPackListing").empty();thisClass.startTemplateIndex=0;thisClass.startUIPackIndex=0;thisClass.listTemplates();};this.closeStore=function(){if($("#mfStoreInterface").css("display")=="block"){$("#mfStoreInterface").hide();}};this.goBackHandler=function(){thisClass.closeEditTemplateHandler();$("#mfStoreTemplateViewerImage").attr("src","");$(".mfStoreMain, .mfStoreBackDrop, #mfStoreAddPowerupBtn").hide();if(thisClass.searching){$("#mfStoreSearchWrapper").show();}else{if(thisClass.itemType=="all"){$(".mfStoreMain").hide();$("#mfStoreDiscoverWrapper").show();}else{if(thisClass.itemType=="template"){$("#mfStoreTemplateWrapper, .mfStoreTemplateBackdrop, #mfStoreFiltersBtn").show();}else{if(thisClass.itemType=="uipack"){$(".mfStoreMain, .mfStoreBackDrop").hide();$("#mfStoreTemplateWrapper, .mfStoreUIPackBackdrop, #mfStoreFiltersBtn").show();}else{if(thisClass.itemType=="powerup"){$(".mfStoreMain, .mfStoreBackDrop, #mfStoreFiltersBtn").hide();$("#mfStoreAddPowerupBtn").css({display:"inline-block"});$("#mfStoreTemplateWrapper, .mfStorePowerUpBackdrop").show();}else{if(thisClass.itemType=="integration"){$(".mfStoreMain, .mfStoreBackDrop,  #mfStoreFiltersBtn").hide();$("#mfStoreTemplateWrapper, .mfStoreIntegrationBackdrop").show();}}}}}}thisClass.resize();};this.resize=function(){if($("#mfStoreInterface").css("display")=="block"){$("#mfStoreCategoryListing").height($(currentWindow).height()-$("#mfStoreLogoDiv").height()-$("#mfStoreAddPageBtn").height()-60);$("#mfStoreTemplates").height($(currentWindow).height()-180);$("#mfStoreTemplates").css({"margin-top":"0px"});$("#mfStoreTemplateViewerImageHolder").width($(currentWindow).width()-$("#mfStoreRightSide").width());$("#mfStoreTemplateViewerImageHolder").height($("#mfStoreTemplates").height()-$("#mfStoreTemplateDetails").height()-$(".mfStoreImageViewerControlsWrapper").innerHeight());$("#mfStoreTemplateViewerImageHolder").css({position:"absolute",top:$("#mfStoreTemplateDetails").height(),left:0});$("#mfStoreTemplateDetails").css({position:"absolute",top:0,left:0});if($(".mfStoreTemplateBackdrop").css("display")=="block"||$("#mfStoreSearchWrapper").css("display")=="block"){var mfTemplateItemTotalWidth=$(".mfTemplateItem").outerWidth()+parseInt($(".mfTemplateItem").css("margin-left"))+parseInt($(".mfTemplateItem").css("margin-right"));if(thisClass.searching&&$(".mfTemplateSearchList .mfTemplateItem").length!=0){var mfTemplateColCount=parseInt($(".mfTemplateSearchList").outerWidth()/mfTemplateItemTotalWidth);var mfTemplateListWidth=($(".mfTemplateSearchList").outerWidth()-(mfTemplateColCount*mfTemplateItemTotalWidth))/2;$(".mfTemplateSearchList").css({"padding-left":mfTemplateListWidth+"px"});}else{var mfTemplateColCount=parseInt($("#mfStoreTemplateListing").outerWidth()/mfTemplateItemTotalWidth);var mfTemplateListWidth=($("#mfStoreTemplateListing").outerWidth()-(mfTemplateColCount*mfTemplateItemTotalWidth))/2;$("#mfStoreTemplateListing").css({"padding-left":mfTemplateListWidth+"px"});}}if($(".mfStoreUIPackBackdrop").css("display")=="block"||$("#mfStoreSearchWrapper").css("display")=="block"){var mfUIPackItemTotalWidth=$(".mfUIPackItem").outerWidth()+parseInt($(".mfUIPackItem").css("margin-left"))+parseInt($(".mfUIPackItem").css("margin-right"));if(thisClass.searching&&$(".mfUIPacksSearchList .mfUIPackItem").length!=0){var mfUIPackColCount=parseInt($(".mfUIPacksSearchList").outerWidth()/mfUIPackItemTotalWidth);var mfUIPackListWidth=($(".mfUIPacksSearchList").outerWidth()-(mfUIPackColCount*mfUIPackItemTotalWidth))/2;$(".mfUIPacksSearchList").css({"padding-left":mfUIPackListWidth+"px"});}else{var mfUIPackColCount=parseInt($("#mfUIPackListing").outerWidth()/mfUIPackItemTotalWidth);var mfUIPackListWidth=($("#mfUIPackListing").outerWidth()-(mfUIPackColCount*mfUIPackItemTotalWidth))/2;$("#mfUIPackListing").css({"padding-left":mfUIPackListWidth+"px"});}}if($(".mfStorePowerUpBackdrop").css("display")=="block"||$("#mfStoreSearchWrapper").css("display")=="block"){var mfPowerUpItemTotalWidth=$(".mfPowerupStoreItem").outerWidth()+parseInt($(".mfPowerupStoreItem").css("margin-left"))+parseInt($(".mfPowerupStoreItem").css("margin-right"));if(thisClass.searching&&$(".mfPowerupSearchList .mfPowerupStoreItem").length!=0){var mfPowerUpColCount=parseInt($(".mfPowerupSearchList").outerWidth()/mfPowerUpItemTotalWidth);var mfPowerUpListWidth=($(".mfPowerupSearchList").outerWidth()-(mfPowerUpColCount*mfPowerUpItemTotalWidth))/2;}else{var mfPowerUpColCount=parseInt($("#mfPowerupStoreContainer").outerWidth()/mfPowerUpItemTotalWidth);var mfPowerUpListWidth=($("#mfPowerupStoreContainer").outerWidth()-(mfPowerUpColCount*mfPowerUpItemTotalWidth))/2;$("#mfPowerupStoreContainer").css({"padding-left":mfPowerUpListWidth+"px"});}}if(($("#mfStoreDiscoverWrapper").css("display")=="block")){$("#mfFeaturedImageCarousel div.mfFeaturedPrev, #mfFeaturedImageCarousel div.mfFeaturedPrevLeftSecond, #mfFeaturedImageCarousel div.mfFeaturedSelected, #mfFeaturedImageCarousel div.mfFeaturedNext, #mfFeaturedImageCarousel div.mfFeaturedNextRightSecond").addClass("mfFeaturedImageRemoveTransition");thisClass.featuredImageResizeHandler();}if($("#mfStoreTemplateViewer").css("display")=="block"){thisClass.resizeImageViewer();}if($("#mfStorePowerupViewer").css("display")=="block"&&$("#mfPowerupScreenshots-slider .mfPowerupScreenshots-slider-item").length>2){thisClass.scrollBarWidth=$("#mfStorePowerupViewer").width()-($(".mfPowerupWrapperContainer").outerWidth()+parseInt($(".mfPowerupWrapperContainer").offset().left-$("#mfStoreRightSide").width())*2);$(".mfPowerupScreenshots-slider-frame").css("margin-bottom",-Math.abs(thisClass.scrollBarWidth));mf_main.editorController.powerupStoreController.positioningPowerupScreenshots();}else{$(".mfPowerupScreenshots-slider-frame").css("margin-bottom","0");}}};this.applyTemplate=function(arr){var cachedTemplate=mf_main.getTemplateFromCache("mfStoreItemTemplate");if(cachedTemplate==null){$.get("templates/editor/StoreItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfStoreItemTemplate").html());mf_main.addTemplateToCache("mfStoreItemTemplate",template);thisClass.renderStoreItem(template,arr);});}else{thisClass.renderStoreItem(cachedTemplate,arr);}};this.renderStoreItem=function(template,arr){var len=arr.length;var itemsRequired=len;var itemsRendered=0;if(thisClass.itemType=="all"&&!thisClass.searching){itemsRequired=12;}var htmldom="";if(len<thisClass.offset){if(thisClass.searching){thisClass.searchTemplatesLoaded=true;}else{thisClass.templatesLoaded=true;}}for(var i=0,j=len;i<j&&itemsRendered<itemsRequired;i++){var nitem=new MF_StoreTemplate();nitem.cast(arr[i]);if(nitem.packId==null){if(thisClass.itemType=="all"&&!thisClass.searching){thisClass.discoverItemCollection.addItem(nitem);}else{var itemIndex=MF_Utils.searchObjArray(thisClass.itemCollection.data,"id",nitem.id);if(itemIndex==-1){thisClass.itemCollection.addItem(nitem);}}htmldom=htmldom+template(nitem);itemsRendered++;}}if(thisClass.searching){$(".mfTemplateSearchList").append(htmldom);}else{if(thisClass.itemType=="all"){$(".mfLatestTemplatesList").empty();$(".mfLatestTemplatesList").append(htmldom);$(".mfStoreMain").hide();$("#mfStoreDiscoverWrapper").show();}else{$("#mfStoreTemplateListing").append(htmldom);if(thisClass.itemType=="template"){$(".mfStoreMain, .mfStoreBackDrop").hide();$("#mfStoreTemplateListing, .mfStoreTemplateBackdrop").show();$("#mfStoreTemplateWrapper").show();if(!thisClass.listingItemsOnScroll){$("#mfStoreTemplateWrapper").scrollTop(0);}}$(".mfTemplateSearchList, .mfUIPacksSearchList").empty();}}$(".mfStoreItemWrapper").off("click");$(".mfStoreItemWrapper").on("click",thisClass.storeItemClick);thisClass.resize();$(".mfTemplateThumbImportIcon").on("click",thisClass.importStoreItem);$(".lazyStoreThumb").off("error");$(".lazyStoreThumb").on("error",function(){$(this).attr("src","images/store/uiPackThumbnail.png");});};this.applyUiPackTemplate=function(arr){var cachedTemplate=mf_main.getTemplateFromCache("mfStoreUIPackItemTemplate");if(cachedTemplate==null){$.get("templates/editor/UIPackStoreItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfStoreUIPackItemTemplate").html());mf_main.addTemplateToCache("mfStoreUIPackItemTemplate",template);thisClass.renderUIpackItem(template,arr);});}else{thisClass.renderUIpackItem(cachedTemplate,arr);}};this.renderUIpackItem=function(template,arr){var len=arr.length;var itemsRequired=len;var itemsRendered=0;if(thisClass.itemType=="all"&&!thisClass.searching){itemsRequired=12;}if(len<thisClass.offset){if(thisClass.searching){thisClass.searchUIPacksLoaded=true;}else{thisClass.uipacksLoaded=true;}}var htmldom="";for(var i=0,j=len;i<j&&itemsRendered<itemsRequired;i++){var nitem=new MF_StoreTemplate();nitem.cast(arr[i]);if(nitem.packId!=null){if(thisClass.itemType=="all"&&!thisClass.searching){thisClass.discoverItemCollection.addItem(nitem);}else{var itemIndex=MF_Utils.searchObjArray(thisClass.itemCollection.data,"id",nitem.id);if(itemIndex==-1){thisClass.itemCollection.addItem(nitem);}}nitem.installed=false;var uiPackIndex=MF_Utils.searchObjArray(mf_main.componentList.categories,"id",nitem.packId);if(uiPackIndex==-1){nitem.installed=false;}else{nitem.installed=true;}htmldom=htmldom+template(nitem);itemsRendered++;}}if(thisClass.searching==true){$(".mfUIPacksSearchList").append(htmldom);}else{if(thisClass.itemType=="all"){$(".mfLatestUIPacksList").empty();$(".mfLatestUIPacksList").append(htmldom);$(".mfStoreMain").hide();$("#mfStoreDiscoverWrapper").show();}else{$("#mfUIPackListing").append(htmldom);if(thisClass.itemType=="uipack"){$(".mfStoreMain, .mfStoreBackDrop").hide();$("#mfUIPackListing, .mfStoreUIPackBackdrop").show();$("#mfStoreTemplateWrapper").show();if(!thisClass.listingItemsOnScroll){$("#mfStoreTemplateWrapper").scrollTop(0);}}$(".mfTemplateSearchList, .mfUIPacksSearchList").empty();}}$(".mfUIPackItem").off("click");$(".mfUIPackItem").on("click",thisClass.storeItemClick);thisClass.resize();$(".mfUIPackAddBtn").on("click",thisClass.importStoreItem);$(".lazyCatThumbCustom").off("error");$(".lazyCatThumbCustom").on("error",function(){$(this).attr("src","images/store/uiPackThumbnail.png");});};this.getStoreItemByID=function(storeID){var storeObj=null;var storeCollection=thisClass.itemCollection;if(thisClass.itemType=="all"&&!thisClass.searching){storeCollection=thisClass.discoverItemCollection;}for(var k=0;k<storeCollection.size();k++){var item=storeCollection.getItemAt(k);if(item.id==storeID){storeObj=item;break;}}return storeObj;};this.getFeaturedItemByStoreID=function(storeID){var storeObj=null;for(var k=0;k<thisClass.featureditemCollection.size();k++){var item=thisClass.featureditemCollection.getItemAt(k);if(item.id==storeID){storeObj=item;break;}}return storeObj;};this.importStoreItem=function(e){e.stopImmediatePropagation();thisClass.currentStoreItem=thisClass.getStoreItemByID($(this).attr("data-id"));thisClass.importTemplateHandler();};this.storeItemClick=function(e){var storeID=$(this).attr("id");thisClass.featuredImageSliderEnabled=true;thisClass.fitImage();thisClass.closeEditTemplateHandler();thisClass.currentStoreItem=thisClass.getStoreItemByID(storeID.replace("mfStoreItem",""));if(thisClass.currentStoreItem==null){thisClass.currentStoreItem=thisClass.getFeaturedItemByStoreID(storeID.replace("mfStoreItem",""));}$("#mfStoreEditTemplate").hide();$("#mfStoreDeleteTemplate").hide();$("#mfStoreTemplateViewerLoader").show();if(MF_Global.adminAllow()){$("#mfStoreDeleteTemplate").show();$("#mfStoreEditTemplate").show();if(thisClass.currentStoreItem.itemType=="uipack"){$("#mfStoreEditTemplate").attr("data-original-title","Edit Pack");$("#mfStoreDeleteTemplate").attr("data-original-title","Delete Pack");}else{$("#mfStoreEditTemplate").attr("data-original-title","Edit Template");$("#mfStoreDeleteTemplate").attr("data-original-title","Delete Template");}}else{if(thisClass.currentStoreItem.submitter.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()){$("#mfStoreDeleteTemplate").show();$("#mfImportTemplateBtn").css("right","50px");}else{$("#mfImportTemplateBtn").css("right","0px");}}if(thisClass.currentStoreItem.itemType=="uipack"){var uiPackIndex=MF_Utils.searchObjArray(mf_main.componentList.categories,"id",thisClass.currentStoreItem.packId);if(uiPackIndex==-1){$("#mfImportTemplateBtn").text("Add UI Pack");$("#mfImportTemplateBtn").css("pointer-events","inherit");}else{$("#mfImportTemplateBtn").text("Pack already exists");$("#mfImportTemplateBtn").css("pointer-events","none");}$("#mfStoreUIPackDescription").text(thisClass.currentStoreItem.description);$("#mfStoreUIPackDescription").css("display","none");}else{$("#mfStoreUIPackDescription").css("display","none");$("#mfImportTemplateBtn").text("Import");$("#mfImportTemplateBtn").css("pointer-events","inherit");}$("#mfStoreTemplateDetailsTitle").text(thisClass.currentStoreItem.name);$("#mfStoreTemplateDetailsTitle").attr("data-original-title",thisClass.currentStoreItem.name);$("#mfStoreTemplateDetailsBy").text(" By "+thisClass.currentStoreItem.submitterName);$("#mfStoreTemplateDetailsBy").attr("data-original-title",thisClass.currentStoreItem.submitterName);$("#mfStoreTemplateViewerImage").off("load");$("#mfStoreTemplateViewerImage").one("load",function(){$("#mfStoreTemplateViewerImage").show();$(this).css({width:"auto",height:"auto"});thisClass.currentImageWidth=$(this).width();thisClass.currentImageHeight=$(this).height();thisClass.resizeImageViewer();$("#mfStoreTemplateViewerLoader").hide();});$("#mfStoreTemplateViewerImage").off("error");$("#mfStoreTemplateViewerImage").one("error",function(){$("#mfStoreTemplateViewerImage").show();$("#mfStoreTemplateViewerLoader").hide();});$("#mfStoreTemplateViewerImage").hide();$("#mfStoreTemplateViewerImage").attr("src",thisClass.currentStoreItem.imageURL);$("#mfStoreTemplateViewerImage").css({top:"50%",transform:"translateY(-50%)"});$("#mfStoreTemplateDetailsTitle").text(thisClass.currentStoreItem.name);$("#mfStoreTemplateDetailsBy").text(" By "+thisClass.currentStoreItem.submitterName);$(".mfStoreMain").hide();$("#mfStoreTemplateViewer").show();thisClass.resize();};this.listTemplates=function(){$(".mfStoreBackDrop").hide();$("#mfStoreFiltersDropdown").show();$("#mfStoreAddPowerupBtn").hide();if($("#mfTypeAll").is(":checked")){thisClass.itemType="all";$(".mfStoreMain").hide();$("#mfStoreDiscoverWrapper").show();thisClass.listLatestPowerups();thisClass.showFeaturedPackCarousel();thisClass.featuredImageSliderEnabled=true;$("#mfStoreTemplateListingLoader").css("margin-left","0px");$("#mfStoreMainTopic").text("Explore");$("#mfStoreMainDesc").text("Discover UI packs, wireframe templates and also addons to enhance your wireframing");}else{if($("#mfTypeTemplate").is(":checked")){thisClass.itemType="template";$(".mfStoreBackDrop").hide();$(".mfStoreTemplateBackdrop, #mfStoreFiltersBtn").show();$("#mfStoreMainTopic").text("Templates");$("#mfStoreMainDesc").text("Find UI layouts, templates and interface designs");}else{if($("#mfTypeUiPack").is(":checked")){thisClass.itemType="uipack";$(".mfStoreBackDrop").hide();$(".mfStoreUIPackBackdrop,  #mfStoreFiltersBtn").show();$("#mfStoreMainTopic").text("UI Packs");$("#mfStoreMainDesc").text("Get pre-built component sets for designing any user interface");}else{if($("#mfTypePowerUp").is(":checked")){thisClass.itemType="powerup";$("#mfStoreMainTopic").text("Power-Ups");$("#mfStoreMainDesc").text("Super charge your UI design workflow with addon tools");$(".mfStoreMain, .mfStoreBackDrop, #mfStoreFiltersDropdown").hide();$("#mfStoreTemplateListingLoader").show();$("#mfStoreAddPowerupBtn").css({display:"inline-block"});$(".mfStorePowerUpBackdrop, #mfStoreAddPowerupBtn").show();mf_main.editorController.powerupStoreController.openPowerupStore();return;}else{if($("#mfTypeIntegration").is(":checked")){thisClass.itemType="integration";$(".mfStoreMain, .mfStoreBackDrop, #mfStoreFiltersDropdown").hide();$("#mfStoreTemplateListingLoader").show();$("#mfStoreMainTopic").text("Brainstorm anywhere");$("#mfStoreMainDesc").text("Bring UI design to your favourite tools");thisClass.listIntegrations();return;}else{$(".mfFeaturedCarouselWrapper").hide();$("#mfStoreTemplateListing").append("<div class='mfCenterBlock' style='font-size: 30px; color: #ccc; width: 100%; text-align: center;'>Select UI Pack or Template</div>");return;}}}}}if(thisClass.itemType!="all"){$("#mfStoreTemplateListingLoader").css("margin-left","100px");}$("#mfStoreFiltersBtn").removeClass("open");$("#mfStoreTemplateListingLoader").show();thisClass.listItems(false);if(thisClass.searching==true){mf_main.editorController.powerupStoreController.openPowerupStore();thisClass.listIntegrations();thisClass.showStoreSearchItems();thisClass.showStoreSearchSections();}$("#mfStoreTemplateWrapper, #mfStoreDiscoverWrapper, #mfStoreSearchWrapper").scrollTop(0);thisClass.resize();};this.showFeaturedPackCarousel=function(){if(thisClass.featureditemCollection.size()!=0&&$("#mfSearchStoreInput").val().trim()==""){$(".mfFeaturedCarouselWrapper").show();}};this.listIntegrations=function(){var integrations=thisClass.storeIntegrationsCollection;var cachedTemplate=mf_main.getTemplateFromCache("mfStoreIntegrationItemTemplate");if(cachedTemplate==null){$.get("templates/editor/StoreIntegrationItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfStoreIntegrationItemTemplate").html());mf_main.addTemplateToCache("mfStoreIntegrationItemTemplate",template);thisClass.renderIntegrationItems(template,integrations);});}else{thisClass.renderIntegrationItems(cachedTemplate,integrations);}};this.renderIntegrationItems=function(template,integrations){var htmlDom="";if(thisClass.searching==true){var storeSearchText=$("#mfSearchStoreInput").val().trim().toLowerCase();for(var i=0;i<integrations.length;i++){for(var j=0;j<integrations[i].items.length;j++){var nitem=integrations[i].items[j];if(nitem.integrationName.toLowerCase().includes(storeSearchText)){htmlDom=htmlDom+template(nitem);}}}$(".mfIntegrationSearchList").empty();$(".mfIntegrationSearchList").append(htmlDom);if(htmlDom==""){$(".mfIntegrationSearchList").html("<span class='mfPowerupSearchNoResult'>No Results</span>");$(".mfIntegrationSearchList").css("padding-left","0");}$(".mfStoreMain").hide();$("#mfStoreSearchWrapper").show();thisClass.showStoreSearchItems();thisClass.showStoreSearchSections();}else{if(thisClass.integrationListed==false){for(var i=0;i<integrations.length;i++){htmlDom+='<h2 id="'+integrations[i].id+'" class="mfStoreIntegrationTitle">'+integrations[i].category+"</h2>";htmlDom+='<p class="mfStoreIntegrationDesc">'+integrations[i].description+"</p>";for(var j=0;j<integrations[i].items.length;j++){var nitem=integrations[i].items[j];htmlDom=htmlDom+template(nitem);}}$("#mfIntegrationListing").empty();$("#mfIntegrationListing").append(htmlDom);thisClass.integrationListed=true;}if(thisClass.itemType=="integration"){$(".mfStoreMain, .mfStoreBackDrop").hide();$("#mfIntegrationListing, .mfStoreIntegrationBackdrop").show();$("#mfStoreTemplateWrapper").show();if(!thisClass.listingItemsOnScroll){$("#mfStoreTemplateWrapper").scrollTop(0);}}$(".mfIntegrationSearchList").empty();}};this.listItems=function(onscroll){if(onscroll){$(".mfOnScorllLoaderCls").remove();var loaderOnScroll="#mfStoreTemplateWrapper";if($("#mfStoreSearchWrapper").css("display")=="block"){loaderOnScroll="#mfStoreSearchWrapper";}$(loaderOnScroll).append('<div class="mfOnScorllLoaderCls mfStoreScrollLoader"><img alt="Loading" src="images/general/mf_loader.svg"  style="position: absolute;left: 50%;top:50%;transform: translate(-50%, -50%);" class="centered-axis-xy mfSVGLoader" /></div>');}else{thisClass.listingItemsOnScroll=false;}var templateIndex=thisClass.startTemplateIndex;var UIPackIndex=thisClass.startUIPackIndex;var templatesloaded=thisClass.templatesLoaded;var uipacksloaded=thisClass.uipacksLoaded;var templatesLength=$("#mfStoreTemplateListing .mfTemplateItem").length;var uiPackLength=$("#mfUIPackListing .mfUIPackItem").length;if(thisClass.itemType=="all"){templatesLength=$(".mfLatestTemplatesList .mfTemplateItem").length;uiPackLength=$(".mfLatestUIPacksList .mfUIPackItem").length;if(uiPackLength==0||templatesLength==0){thisClass.selectedCategory="all";thisClass.orderType="new";thisClass.showApproved=true;templateIndex=0;UIPackIndex=0;templatesloaded=false;uipacksloaded=false;}}else{thisClass.selectedCategory=thisClass.currentStoreCategory;thisClass.orderType=thisClass.currentOrderType;}if(thisClass.searching){templateIndex=thisClass.searchTemplateIndex;UIPackIndex=thisClass.searchUIPackIndex;templatesloaded=thisClass.searchTemplatesLoaded;uipacksloaded=thisClass.searchUIPacksLoaded;templatesLength=$(".mfTemplateSearchList .mfTemplateItem").length;uiPackLength=$(".mfUIPacksSearchList .mfUIPackItem").length;}var waitForTemplateLoad=false;if(((thisClass.itemType=="all"&&(templatesLength<=0||thisClass.searching))||thisClass.itemType=="template")&&!templatesloaded&&templatesLength<=templateIndex){thisClass.checkSearchItemsLoaded--;waitForTemplateLoad=true;MF_WireframeStoreManager.getTemplatesByOrder(thisClass.selectedCategory,thisClass.orderType,MF_UserSession.getUser().username,thisClass.showApproved,templateIndex,thisClass.offset,thisClass.searching,$("#mfSearchStoreInput").val(),"template",{callback:function(arr){if(arr.length==0){if(thisClass.searching){thisClass.searchTemplatesLoaded=true;}else{thisClass.templatesLoaded=true;}if($(".mfTemplateSearchList .mfTemplateItem").length<=0&&thisClass.searching){$(".mfTemplateSearchList").html("<span class='mfPowerupSearchNoResult'>No Results</span>");$(".mfTemplateSearchList").css("padding-left","0");}else{if($("#mfStoreTemplateListing .mfTemplateItem").length<=0){$("#mfStoreTemplateListing").html("<span class='mfPowerupSearchNoResult'>No Items Found</span>");$(".mfStoreMain").hide();$("#mfStoreTemplateWrapper").show();}}}else{if(thisClass.itemType!="all"){$("#mfStoreTemplateListing .mfPowerupSearchNoResult").remove();}thisClass.applyTemplate(arr);}if(onscroll){$(".mfOnScorllLoaderCls").remove();}if(thisClass.searching){thisClass.checkSearchItemsLoaded++;thisClass.showStoreSearchItems();}thisClass.lazyLoadingInProcess=false;}});}else{if((thisClass.itemType=="all")&&!thisClass.searching){$(".mfStoreMain").hide();$("#mfStoreDiscoverWrapper").show();}else{if(thisClass.itemType=="template"&&!thisClass.searching){$(".mfStoreMain").hide();$("#mfStoreTemplateWrapper").show();$("#mfStoreTemplateWrapper").scrollTop(0);}else{if(thisClass.itemType=="template"){$(".mfOnScorllLoaderCls").remove();}else{if(thisClass.itemType=="all"){thisClass.removeLoaderOnScroll=true;}}}}}var waitForUIPackLoad=false;if(((thisClass.itemType=="all"&&(uiPackLength<=0||thisClass.searching))||thisClass.itemType=="uipack")&&!uipacksloaded&&uiPackLength<=UIPackIndex){thisClass.selectedCategory=thisClass.currentPackCategory;thisClass.checkSearchItemsLoaded--;waitForUIPackLoad=true;MF_WireframeStoreManager.getTemplatesByOrder(thisClass.selectedCategory,thisClass.orderType,MF_UserSession.getUser().username,thisClass.showApproved,UIPackIndex,thisClass.offset,thisClass.searching,$("#mfSearchStoreInput").val(),"uipack",{callback:function(arr){if(arr.length==0){if(thisClass.searching){thisClass.searchUIPacksLoaded=true;}else{thisClass.uipacksLoaded=true;}if($(".mfUIPacksSearchList .mfUIPackItem").length<=0&&thisClass.searching){$(".mfUIPacksSearchList").html("<span class='mfPowerupSearchNoResult'>No Results</span>");$(".mfUIPacksSearchList").css("padding-left","0");}else{if($("#mfUIPackListing .mfUIPackItem").length<=0){$("#mfUIPackListing").html("<span class='mfPowerupSearchNoResult'>No Items Found</span>");$(".mfStoreMain").hide();$("#mfStoreTemplateWrapper").show();}}}else{if(thisClass.itemType!="all"){$("#mfUIPackListing .mfPowerupSearchNoResult").remove();}thisClass.applyUiPackTemplate(arr);}if(thisClass.searching){thisClass.checkSearchItemsLoaded++;thisClass.showStoreSearchItems();}thisClass.lazyLoadingInProcess=false;if(onscroll){$(".mfOnScorllLoaderCls").remove();}}});}else{if(thisClass.itemType=="all"&&!thisClass.searching){$(".mfStoreMain").hide();$("#mfStoreDiscoverWrapper").show();}else{if(thisClass.itemType=="uipack"&&!thisClass.searching){$(".mfStoreMain").hide();$("#mfStoreTemplateWrapper").show();$("#mfStoreTemplateWrapper").scrollTop(0);}else{if(thisClass.itemType=="uipack"){$(".mfOnScorllLoaderCls").remove();}else{if(thisClass.itemType=="all"&&thisClass.removeLoaderOnScroll){$(".mfOnScorllLoaderCls").remove();}}}}}if(!waitForTemplateLoad&&!waitForUIPackLoad){thisClass.lazyLoadingInProcess=false;}};this.loadTemplatesOnScroll=function(){if($(".mfStoreFiltersDropdownWrapper").css("display")=="block"){$("#mfStoreFiltersBtn").removeClass("open");$("#mfCategoryType-list").hide();$(".mfStoreFiltersDropdownWrapper .k-dropdown-wrap ").removeClass("k-state-active k-state-border-down");}if($(this).scrollTop()==0){return;}if($("#mfTypePowerUp").prop("checked")!=true&&$(this).scrollTop()+$(this).innerHeight()>=this.scrollHeight-1){if(thisClass.lazyLoadingInProcess){return false;}var getStoreItems=false;if(thisClass.searching){if(thisClass.itemType=="all"&&(!thisClass.searchTemplatesLoaded||!thisClass.searchUIPacksLoaded)){getStoreItems=true;thisClass.searchTemplateIndex=thisClass.searchTemplateIndex+thisClass.offset;thisClass.searchUIPackIndex=thisClass.searchUIPackIndex+thisClass.offset;}else{if(thisClass.itemType=="template"&&!thisClass.searchTemplatesLoaded){getStoreItems=true;thisClass.searchTemplateIndex=thisClass.searchTemplateIndex+thisClass.offset;}else{if(thisClass.itemType=="uipack"&&!thisClass.searchUIPacksLoaded){getStoreItems=true;thisClass.searchUIPackIndex=thisClass.searchUIPackIndex+thisClass.offset;}}}}else{if(thisClass.itemType=="template"&&!thisClass.templatesLoaded){getStoreItems=true;thisClass.startTemplateIndex=thisClass.startTemplateIndex+thisClass.offset;}else{if(thisClass.itemType=="uipack"&&!thisClass.uipacksLoaded){getStoreItems=true;thisClass.startUIPackIndex=thisClass.startUIPackIndex+thisClass.offset;}}}if(getStoreItems){thisClass.lazyLoadingInProcess=true;thisClass.listItems(true);thisClass.listingItemsOnScroll=true;}}};this.categoryItemClick=function(e){var category=$("#mfCategoryType").data("kendoDropDownList").value();if(category==""){thisClass.currentStoreCategory="all";}else{thisClass.currentStoreCategory=category;}thisClass.templatesLoaded=false;thisClass.uipacksLoaded=false;$("#mfStoreTemplateListing, #mfUIPackListing").empty();thisClass.startTemplateIndex=0;thisClass.startUIPackIndex=0;thisClass.listTemplates();};this.listFeatureImage=function(){if(thisClass.featuredImageListed==false){thisClass.featuredImageListed=true;thisClass.featureditemCollection=new ArrayCollection();}else{return;}MF_WireframeStoreManager.getStoreFeaturedPacks(MF_UserSession.getUser(),{callback:function(arr){if(arr.length!=0){$(".mfFeaturedCarouselWrapper").show();var cachedTemplate=mf_main.getTemplateFromCache("mfFeaturedItemTemplate");if(cachedTemplate==null){$.get("templates/editor/FeaturedItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfFeaturedItemTemplate").html());mf_main.addTemplateToCache("mfFeaturedItemTemplate",template);thisClass.renderFeatureImageItems(template,arr);});}else{thisClass.renderFeatureImageItems(cachedTemplate,arr);}}else{$(".mfFeaturedCarouselWrapper").hide();}thisClass.resize();}});};this.renderFeatureImageItems=function(template,featuredPacks){$("#mfFeaturedImageCarousel").empty();var htmldom="";for(var i=0,j=featuredPacks.length;i<j;i++){var fpack=new MF_StoreTemplate();fpack.cast(featuredPacks[i]);thisClass.featureditemCollection.addItem(fpack);var className;switch(i){case 0:fpack.classname="mfFeaturedPrevLeftSecond";break;case 1:fpack.classname="mfFeaturedPrev";break;case 2:fpack.classname="mfFeaturedSelected";break;case 3:fpack.classname="mfFeaturedNext";break;case 4:fpack.classname="mfFeaturedNextRightSecond";break;default:fpack.classname="mfFeaturedHideRight";}htmldom=htmldom+template(fpack);}$("#mfFeaturedImageCarousel").append(htmldom);$("#mfFeaturedImageCarousel div").on("otransitionend transitionend webkitTransitionend",function(){thisClass.featuredImageSliderEnabled=true;});thisClass.resize();};this.addPackFeaturedImageHandler=function(ttype){var fd=new FormData();var packId=thisClass.currentStoreItem.id;fd.append("id",packId);fd.append("size",(parseInt(thisClass.featuredPackImageFile.size/1024,10)).toString());fd.append("name","Html 5 File API/FormData");fd.append("fileToUpload",thisClass.featuredPackImageFile);fd.append("mime",thisClass.featuredPackImageFile.type);fd.append("username",MF_UserSession.getUser().username);fd.append("imagecategory","featured");if(ttype){fd.append("template","true");}var xhr=new XMLHttpRequest();xhr.addEventListener("load",thisClass.featuredImageUploadComplete,false);xhr.addEventListener("error",thisClass.featuredImageUploadFailed,false);xhr.addEventListener("abort",thisClass.featuredImageUploadCanceled,false);xhr.open("POST","uipackimageupload");xhr.send(fd);};this.featuredImageUploadComplete=function(evt){thisClass.uploadIconFile=null;alert("Featured Image Updated");thisClass.featuredImageListed=false;thisClass.listFeatureImage();};this.featuredImageUploadFailed=function(evt){alert("There was an error attempting to upload the file.");};this.featuredImageUploadCanceled=function(evt){alert("The upload has been canceled by the user or the browser dropped the connection.");};this.pinchToZoom=function(e){if(e.ctrlKey){e.preventDefault();e.stopPropagation();if(e.deltaY>0){thisClass.zoomOut();}else{if(e.deltaY<0){thisClass.zoomIn();}}}};this.pinchToZoomGestureChange=function(e){if(e.scale<1){thisClass.zoomOut();}else{if(e.scale>1){thisClass.zoomIn();}}};this.zoomIn=function(){$("#mfStoreImageViewerZoomOutButton").prop("disabled",false);var imgElem=$("#mfStoreTemplateViewerImageWrapper img");var canvasWidth=$("#mfStoreTemplateViewerImageWrapper").width();var canvasHeight=$("#mfStoreTemplateViewerImageWrapper").height();imgElem.css({transition:"ease all 0.5s","-webkit-transition":"ease all 0.5s"});var imgHeight=imgElem.height();var imgWidth=imgElem.width();imgElem.height(imgHeight*1.3);imgElem.width(imgWidth*1.3);if(imgElem.height()>canvasHeight){imgElem.css({top:0,transform:"none","-webkit-transform":"none"});}if(imgElem.width()>canvasWidth){}};this.zoomOut=function(){var imgElem=$("#mfStoreTemplateViewerImageWrapper img");var imgDim={height:thisClass.currentImageHeight,width:thisClass.currentImageWidth};var canvasWidth=$("#mfStoreTemplateViewerImageWrapper").width();var canvasHeight=$("#mfStoreTemplateViewerImageWrapper").height();if(imgElem.height()>canvasHeight||imgElem.width()>canvasWidth){imgElem.css({transition:"ease all 0.5s","-webkit-transition":"ease all 0.5s"});var imgHeight=imgElem.height();var imgWidth=imgElem.width();imgElem.height(imgHeight/1.3);imgElem.width(imgWidth/1.3);}if(imgElem.height()>imgDim.height||imgElem.width()>imgDim.width){var imgHeight=imgElem.height();var imgWidth=imgElem.width();imgElem.height(imgHeight/1.3);imgElem.width(imgWidth/1.3);}if(imgElem.height()<canvasHeight&&imgElem.width()<canvasWidth){imgElem.css({transform:"translateY(-50%)","-webkit-transform":"translateY(-50%)",top:"50%"});}setTimeout(function(){if(!(imgElem.height()>canvasHeight||imgElem.width()>canvasWidth)){$("#mfStoreImageViewerZoomOutButton").prop("disabled",true);}},500);};this.fitImage=function(){$("#mfStoreImageViewerZoomOutButton").prop("disabled",true);$("#mfStoreTemplateViewerImage").css({top:"50%",transform:"translateY(-50%)","-webkit-transform":"translateY(-50%)"});thisClass.resizeImageViewer();};this.fitImageSize=function(){$("#mfStoreTemplateViewerImage").css({width:"auto",height:"auto"});if($("#mfStoreTemplateViewerImage").height()>$("#mfStoreTemplateViewerImageWrapper").height()){$("#mfStoreTemplateViewerImage").css({top:0,transform:"none","-webkit-transform":"none"});$("#mfStoreImageViewerZoomOutButton").prop("disabled",false);}else{$("#mfStoreTemplateViewerImage").css({top:"50%",transform:"translateY(-50%)"});}};this.resizeImageViewer=function(){var canvasWidth=$("#mfStoreTemplateViewerImageWrapper").width();var canvasHeight=$("#mfStoreTemplateViewerImageWrapper").height();if(thisClass.currentImageWidth<(canvasWidth)&&thisClass.currentImageHeight<(canvasHeight)){$("#mfStoreTemplateViewerImage").height(thisClass.currentImageHeight);$("#mfStoreTemplateViewerImage").width(thisClass.currentImageWidth);}else{if(thisClass.currentImageWidth>0&&thisClass.currentImageHeight>0){var dAspectRatio=canvasWidth/canvasHeight;var dPictureAspectRatio=thisClass.currentImageWidth/thisClass.currentImageHeight;if(dPictureAspectRatio>dAspectRatio){var nNewHeight=(canvasWidth/thisClass.currentImageWidth*thisClass.currentImageHeight);var nCenteringFactor=(canvasHeight-nNewHeight)/2;$("#mfStoreTemplateViewerImage").height(nNewHeight);$("#mfStoreTemplateViewerImage").width(canvasWidth);}else{if(dPictureAspectRatio<dAspectRatio){var nNewWidth=(canvasHeight/thisClass.currentImageHeight*thisClass.currentImageWidth);var nCenteringFactor=(canvasWidth-nNewWidth)/2;$("#mfStoreTemplateViewerImage").height(canvasHeight);$("#mfStoreTemplateViewerImage").width(nNewWidth);}}}else{$("#mfStoreTemplateViewerImage").height($("#mfStoreTemplateViewerImageWrapper").height());$("#mfStoreTemplateViewerImage").width("auto");}}};}function MF_DesignStoreController(){var thisClass=this;this.designmodeListed=false;this.designmodeCompleted=false;this.designItemCollection=new ArrayCollection();this.startDesignTemplateIndex=0;this.designTemplatesearching=false;this.offset=50;this.clickFlag=false;this.currentStoreItem=null;this.category=null;this.currentWidth=null;this.currentHeight=null;this.sizearr=new Array();this.constructor=function(){if(mf_main.DESIGNMODE){$("#mfNavTemplatesBtn").on("click",function(event){mf_main.editorController.showPopUp(event,$("#mfTemplateSelectionPopUp"));mf_main.interfaceResize();if($("#mfTemplateSelectionPopUp").css("display")=="block"){if(!thisClass.designmodeListed){thisClass.designmodeListed=true;thisClass.showLoader();thisClass.listDesignTemplates();}else{thisClass.hideLoader();}}});$("#mfDesignerTemplateListSearchBox").on("keypress",function(e){e.stopImmediatePropagation();if(e.which==13&&$("#mfDesignerTemplateListSearchBox").val().trim()!=""){e.preventDefault();thisClass.startDesignTemplateIndex=0;thisClass.designTemplatesearching=true;thisClass.designmodeCompleted=false;$("#mfDesignerTemplateList").empty();thisClass.showLoader();thisClass.listDesignTemplates();}});$("#mfDesignerTemplateListSearchBox").on("textchange",function(){if($("#mfDesignerTemplateListSearchBox").val().trim()==""){thisClass.designTemplatesearching=false;thisClass.designmodeCompleted=false;thisClass.startDesignTemplateIndex=0;$("#mfDesignerTemplateList").empty();thisClass.showLoader();thisClass.listDesignTemplates();}});thisClass.renderCategory();$("#mfRenameDesignTemplate").on("click",thisClass.renameDesignHandler);$("#mfDeleteDesignTemplate").on("click",thisClass.deleteDesignHandler);$("#mfDesignerTemplatesCategory").on("change",thisClass.changeDesignerCategoryHandler);$("#mfEditDesignTemplateModal").on("shown.bs.modal",function(){$("#mfEditDesignTemplateTitle").focus();});}};this.listDesignTemplates=function(onscroll){if(!thisClass.category){thisClass.category=thisClass.getDtype();if($("#mfDesignerTemplatesCategory option[value='"+thisClass.category+"']").length>0){}else{thisClass.category="all";}$("#mfDesignerTemplatesCategory").val(thisClass.category);var designCssClass=thisClass.category.replace(/\//g,"_");$("#mfDesignerTemplateList").removeClass().addClass("mfDesignSize_"+designCssClass);}if(onscroll){$("#mfDesignerTemplateList .mfOnScorllLoaderCls").remove();$("#mfDesignerTemplateList").append('<div class="mfOnScorllLoaderCls mfStoreScrollLoader"><img alt="Loading" src="images/general/mf_loader.svg"  style="position: absolute;left: 45%;top:50%;transform: translate(-50%, -50%);" class="centered-axis-xy mfSVGLoader" /></div>');}thisClass.itemType="designtemplate";if(thisClass.designmodeCompleted){thisClass.hideLoader();return;}MF_WireframeStoreManager.getTemplatesByOrder(thisClass.category,"designmode",MF_UserSession.getUser().username,true,thisClass.startDesignTemplateIndex,thisClass.offset,thisClass.designTemplatesearching,$("#mfDesignerTemplateListSearchBox").val(),"template",{callback:function(arr){if(arr.length<50){thisClass.designmodeCompleted=true;}if(arr.length==0){thisClass.hideLoader();if(!onscroll&&thisClass.category!="all"&&$("#mfDesignerTemplateListSearchBox").val().trim()==""){thisClass.designmodeCompleted=false;$("#mfDesignerTemplatesCategory").val("all");thisClass.changeDesignerCategoryHandler();}}else{thisClass.applyDesignerTemplate(arr);}if(onscroll){$(".mfOnScorllLoaderCls").remove();}thisClass.lazyLoadingInProcess=false;}});};this.applyDesignerTemplate=function(narr){var cachedTemplate=mf_main.getTemplateFromCache("mfStoreDesignerItemTemplate");if(cachedTemplate==null){var template=Handlebars.compile($("#mfStoreDesignerItemTemplate").html());mf_main.addTemplateToCache("mfStoreDesignerItemTemplate",template);thisClass.renderStoreDesignerItem(narr,template);}else{thisClass.renderStoreDesignerItem(narr,cachedTemplate);}};this.getDtype=function(){var refdtype=mf_main.editorController.gridController.dtype;var rw=0;var rh=0;var rtype=null;if(refdtype){var sarr=refdtype.split("/");var jarr=sarr[0].split("x");rw=parseInt(jarr[0]);rh=parseInt(jarr[1]);if(sarr.length>=3){rtype=sarr[2];}}var w=mf_main.editorController.page.width;var h=mf_main.editorController.page.height;var dtype="custom";for(var j=0;j<thisClass.sizearr.length;j++){var sobj=thisClass.sizearr[j];if(sobj.s!="all"){try{var sarr=sobj.s.split("/");var jarr=sarr[0].split("x");wi=parseInt(jarr[0]);hi=parseInt(jarr[1]);if(w==wi&&h==hi){if(rtype!=null&&rw==wi&&rh==hi){dtype=refdtype;}else{dtype=sobj.s;}break;}}catch(e){}}}return dtype;};this.getPagePresetArray=function(){var w=800;var h=600;var arr=new Array();var obj=new Object();obj.text="Custom";obj.value="custom";obj.width=w;obj.height=h;arr.push(obj);for(var j=0;j<thisClass.sizearr.length;j++){var sobj=thisClass.sizearr[j];try{if(sobj.s!="all"){var sarr=sobj.s.split("/");var jarr=sarr[0].split("x");wi=parseInt(jarr[0]);hi=parseInt(jarr[1]);var obj=new Object();obj.text=sobj.l;obj.value=sobj.s;obj.width=wi;obj.height=hi;arr.push(obj);}}catch(e){}}return arr;};this.renderStoreDesignerItem=function(arr,template){var htmldom="";for(var n=0;n<arr.length;n++){var citem=new MF_StoreTemplate();citem.cast(arr[n]);var allow=true;if(mf_main.DESIGNMODE){if(citem.modeType!="designmode"){allow=false;}}if(allow){htmldom=htmldom+template(citem);var itemIndex=MF_Utils.searchObjArray(thisClass.designItemCollection.data,"id",citem.id);if(itemIndex==-1){thisClass.designItemCollection.addItem(citem);}}}$("#mfDesignerTemplateList").append(htmldom);$(".mfDesignTemplateItem").off("click");$(".mfDesignTemplateItem").on("click",function(e){thisClass.clickFlag=true;var email=MF_UserSession.getUser().username;var dataId=$(this).attr("data-id");if(!email.includes("@produle.com")){thisClass.importDesignStoreItem(e,dataId);}else{setTimeout(function(){if(thisClass.clickFlag){thisClass.importDesignStoreItem(e,dataId);}thisClass.clickFlag=false;},300);}});$(".mfDesignTemplateItem").off("dblclick");$(".mfDesignTemplateItem").on("dblclick",function(e){var email=MF_UserSession.getUser().username;var dataId=$(this).attr("data-id");if(email.includes("@produle.com")){var dItem=thisClass.getDesignStoreItemByID(dataId);thisClass.currentStoreItem=dItem;$("#mfEditDesignTemplateTitle").val(dItem.name);$("#mfEditDesignTemplateModal").modal("show");$("#mfEditDesignTemplateTitle").val();}thisClass.clickFlag=false;});$(".lazyStoreThumb").off("error");$(".lazyStoreThumb").on("error",function(){$(this).attr("src","images/store/uiPackThumbnail.png");});$("#mfDesignerTemplateListing").off("scroll");$("#mfDesignerTemplateListing").on("scroll",thisClass.loadDesignTemplatesOnScroll);thisClass.hideLoader();};this.importDesignStoreItem=function(e,dataId){e.stopImmediatePropagation();bootbox.confirm("Do you want to import this design?",function(ans){if(ans){thisClass.showLoader();mf_main.editorController.storeController.currentStoreItem=thisClass.getDesignStoreItemByID(dataId);mf_main.editorController.storeController.importTemplateHandler();}});};this.loadDesignTemplatesOnScroll=function(){if($(this).scrollTop()==0){return;}if($(this).scrollTop()+$(this).innerHeight()>=this.scrollHeight-1){if(thisClass.lazyLoadingInProcess||thisClass.designmodeCompleted){return false;}thisClass.startDesignTemplateIndex=thisClass.startDesignTemplateIndex+thisClass.offset;thisClass.lazyLoadingInProcess=true;thisClass.listDesignTemplates(true);}};this.getDesignStoreItemByID=function(storeID){var storeObj=null;var storeCollection=thisClass.designItemCollection;for(var k=0;k<storeCollection.size();k++){var item=storeCollection.getItemAt(k);if(item.id==storeID){storeObj=item;break;}}return storeObj;};this.renderCategory=function(){var arr=new Array();arr.push({s:"all",l:"All Templates"});arr.push({s:"1920x1080/px/heroimage",l:"Hero Image 1920 x 1080 px"});arr.push({s:"3840x2160/px/heroimage",l:"Hero Image 2x 3840 x 2160 px"});arr.push({s:"1200x630/px/bloghero",l:"Blog Image 1200 x 630 px"});arr.push({s:"2400x1260/px/bloghero",l:"Blog Image 2x 2400 x 1260 px"});arr.push({s:"150x150/px/thumbnail",l:"Thumbnails 150 x 150 px"});arr.push({s:"300x300/px/thumbnail",l:"Thumbnails 2x 300 x 300 px"});arr.push({s:"16x16/px/favicon",l:"Favicons 16 x 16 px"});arr.push({s:"32x32/px/favicon",l:"Favicons2x 32 x 32 px"});arr.push({s:"940x788/px/facebook",l:"Facebook 940 x 788 px"});arr.push({s:"1080x1080/px/instagram",l:"Instagram Square 1080 x 1080 px"});arr.push({s:"1080x1350/px/instagram",l:"Instagram Portrait 1080 x 1350 px"});arr.push({s:"1200x628/px/linkedin",l:"LinkedIn 1200 x 628 px"});arr.push({s:"1080x1080/px/linkedin",l:"LinkedIn Square 1080 x 1080 px"});arr.push({s:"1080x1350/px/linkedin",l:"LinkedIn Portrait 1080 x 1350 px"});arr.push({s:"1200x675/px/twitter",l:"Twitter 1200 x 675 px"});arr.push({s:"1200x628/px/twitter",l:"Twitter Card 1200 x 628 px"});arr.push({s:"400x400/px/twitter",l:"Twitter Profile 400 x 400 px"});arr.push({s:"1500x500/px/twitter",l:"Twitter Header 1500 x 500 px"});arr.push({s:"200x200/px/googlead",l:"Google Ads Small Square 200 x 200 px"});arr.push({s:"240x400/px/googlead",l:"Google Ads Vertical Rectangle 240 x 400 px"});arr.push({s:"250x250/px/googlead",l:"Google Ads Square 250 x 250 px"});arr.push({s:"300x250/px/googlead",l:"Google Ads Inline Rectangle 300 x 250 px"});arr.push({s:"336x280/px/googlead",l:"Google Ads Large Rectangle 336 x 280 px"});arr.push({s:"580x400/px/googlead",l:"Google Ads Netboard 580 x 400 px"});arr.push({s:"120x600/px/googlead",l:"Google Ads Skyscraper 120 x 600 px"});arr.push({s:"160x600/px/googlead",l:"Google Ads Wide Skyscraper 160 x 600 px"});arr.push({s:"300x600/px/googlead",l:"Google Ads Half-page Ad 300 x 600 px"});arr.push({s:"300x1050/px/googlead",l:"Google Ads Portrait 300 x 1050 px"});arr.push({s:"468x60/px/googlead",l:"Google Ads Banner 468 x 60 px"});arr.push({s:"728x90/px/googlead",l:"Google Ads Leaderboard 728 x 90 px"});arr.push({s:"930x180/px/googlead",l:"Google Ads Top Banner 930 x 180 px"});arr.push({s:"970x90/px/googlead",l:"Google Ads Large Leaderboard 970 x 90 px"});arr.push({s:"970x250/px/googlead",l:"Google Ads Billboard 970 x 250 px"});arr.push({s:"980x120/px/googlead",l:"Google Ads Panorama 980 x 120 px"});arr.push({s:"300x50/px/googlead",l:"Google Ads Mobile Banner 300 x 50 px"});arr.push({s:"320x100/px/googlead",l:"Google Ads Large Mobile Banner 320 x 100 px"});arr.push({s:"100x100/px/icon",l:"Small 100 x 100 px"});arr.push({s:"500x500/px/icon",l:"Medium 500 x 500 px"});arr.push({s:"1000x1000/px/icon",l:"Large 1000 x 1000 px"});thisClass.sizearr=arr;$("#mfDesignerTemplatesCategory").empty();for(var n=0;n<arr.length;n++){var obj=arr[n];$("#mfDesignerTemplatesCategory").append("<option value='"+obj.s+"'>"+obj.l+"</option>");}var pagepresetarray=thisClass.getPagePresetArray();mf_main.editorController.editManager.pagePresetArray=pagepresetarray;var mfGlobalPageTypeDropDown=$("#mfGlobalPageType").data("kendoDropDownList");mfGlobalPageTypeDropDown.setDataSource(pagepresetarray);var mfCurrentPageTypeDropDown=$("#mfCurrentPageType").data("kendoDropDownList");mfCurrentPageTypeDropDown.setDataSource(pagepresetarray);};this.changeDesignerCategoryHandler=function(){thisClass.showLoader();var sval=$("#mfDesignerTemplatesCategory").val();thisClass.category=sval;thisClass.designTemplatesearching=false;thisClass.startDesignTemplateIndex=0;thisClass.designmodeCompleted=false;$("#mfDesignerTemplateList").empty();$("#mfDesignerTemplateListSearchBox").val("");thisClass.listDesignTemplates();var designCssClass=thisClass.category.replace(/\//g,"_");$("#mfDesignerTemplateList").removeClass().addClass("mfDesignSize_"+designCssClass);};this.renameDesignHandler=function(){var dItemName=$("#mfEditDesignTemplateTitle").val().trim();if(dItemName==""){return;}thisClass.currentStoreItem.name=dItemName;MF_WireframeStoreManager.updateTemplate(MF_UserSession.getUser(),thisClass.currentStoreItem,{callback:function(template){}});$("#mfEditDesignTemplateModal").modal("hide");};this.deleteDesignHandler=function(){var answer=confirm("Delete this design template?");if(answer){thisClass.currentStoreItem.approved=false;MF_WireframeStoreManager.updateTemplate(MF_UserSession.getUser(),thisClass.currentStoreItem,{callback:function(template){}});$("#mfEditDesignTemplateModal").modal("hide");}};this.showLoader=function(){$("#mfDesignerTemplateModalLoader").show();$("#mfDesignerTemplateList").hide();};this.hideLoader=function(){$("#mfDesignerTemplateModalLoader").hide();$("#mfDesignerTemplateList").show();};}function MF_RTC(){var thisClass=this;this.sessionID=null;this.socket=null;this.memberCollection=null;this.firstMemberListing=false;this.disconnect=function(){if(thisClass.socket){thisClass.socket.disconnect();}};this.connect=function(projectid){if(mf_main.RENDER){return;}if(MF_Global.getS3Bucket()=="testmfassets"){thisClass.socket=io.connect("http://localhost:2053",{cookie:false});}else{thisClass.socket=io.connect("https://wireframepro.mockflow.com",{path:"/rtc_editor.io",cookie:false});}thisClass.socket.on("connect",function(){if(mf_main.PUBLIC){thisClass.socket.emit("adduser",thisClass.sessionID+"#--__--#"+MF_Utils.guidGenerator()+"/"+mf_main.editorController.projectObj.id);}else{thisClass.socket.emit("adduser",thisClass.sessionID+"#--__--#"+MF_UserSession.getUser().username+"/"+mf_main.editorController.projectObj.id);}if(mf_main.editorController.EDITOR){thisClass.aiGetCredits();}});thisClass.socket.on("updateusers",function(sender,usernames){if(mf_main.PUBLIC){return;}var onlineusers={};var onlinecount=0;if(thisClass.memberCollection.size()>1){try{for(var key in usernames){var uid=usernames[key];var sarr=uid.split("/");var sarr2=sarr[0].split("#--__--#");onlineusers[sarr2[1]]=true;}for(var i=0;i<thisClass.memberCollection.size();i++){var litem=thisClass.memberCollection.getItemAt(i);var prevonline=litem.online;litem.online=false;if(onlineusers[litem.userid]){litem.online=true;onlinecount++;if(mf_main.editorController.textChatController){mf_main.editorController.textChatController.setOnlineStatus(litem.id);}}else{if(mf_main.editorController.textChatController){mf_main.editorController.textChatController.setOfflineStatus(litem.id);}}if(litem.online==false){for(var k=0;k<MF_PagePool.getPages().size();k++){var pageitem=MF_PagePool.getPages().getItemAt(k);if(pageitem.rtcEditor==litem.userid){pageitem.closeRTCEditor();if(pageitem.eid==mf_main.editorController.page.eid){pageitem.showRTCMsg();}}}}}if(!thisClass.firstMemberListing){thisClass.firstMemberListing=true;}}catch(err){}}var membersStr="members";if(thisClass.memberCollection.size()<=1){membersStr="member";}$("#mfMembersOnlineLabel").text((onlinecount)+" / "+thisClass.memberCollection.size()+" "+membersStr+" online");});thisClass.socket.on("updatemsg",function(username,data){if(data){if(data.sessionID==thisClass.sessionID&&data&&data.cmd=="aitool"){mf_main.editorController.aiToolsController.showResults(data);}if(data.sessionID==thisClass.sessionID&&data&&data.cmd=="getaicredits"){mf_main.editorController.aiManagerController.assignCreditLimits(data.creditLimits);}if(data.sessionID!=thisClass.sessionID){var senderUsername="";if(!mf_main.PUBLIC){senderUsername=data.username;}if(data.cmd=="lockEditing"){if(!mf_main.PUBLIC&&MF_UserSession.getUser().username.toLowerCase()!=data.sender.toLowerCase()){var existingPage=MF_PagePool.getPage(data.pageid);if(existingPage){existingPage.rtcEditor=data.sender;existingPage.rtcEditorName=data.senderName;}if(mf_main.editorController.page.eid===data.pageid){existingPage.showRTCMsg();}}}if(data.cmd=="textmsg"){mf_main.editorController.textChatController.updateMessage(data);if(!mf_main.editorController.textChatController.toggleSnoozeMode){mf_main.editorController.textChatController.openTextChatHandler();}}if(data.cmd=="uipackUpdate"){if(!mf_main.PUBLIC){try{delete mf_main.componentList.dbCategories[data.packid];delete mf_main.componentList.cacheCategory[data.packid];if(mf_main.componentList.currentCategoryObj&&mf_main.componentList.currentCategoryObj.id==data.packid){mf_main.componentList.currentCategory=null;if(data.packid==mf_main.editorController.projectObj.id){mf_main.componentList.viewCategory(mf_main.editorController.projectObj.id,"no");}else{mf_main.componentList.viewCategory(data.packid,mf_main.componentList.currentCategoryObj.mockstore);}}}catch(e){}}}if(data.cmd=="gridsync"){var gridobj=data.gridobj;if(gridobj==null){mf_main.editorController.grid=null;$("#mfGrid").remove();}else{if(gridobj.type=="mesh"){var grid=new MF_MeshGrid();grid.cast(gridobj);mf_main.editorController.grid=grid;mf_main.editorController.grid.setGrid();}if(gridobj.type=="960"){var grid=new MF_960Grid();grid.cast(gridobj);mf_main.editorController.grid=grid;mf_main.editorController.grid.setGrid();}}}if(data.cmd=="pagesizesync"){var sizeobj=data.sizeobj;if(sizeobj==null){}else{mf_main.editorController.editManager.getSizeSettingsRTC(sizeobj);}}if(data.cmd=="bgsync"){var bgcolor=data.bgcolor;if(mf_main.editorController.gridController.backgroundColor!=bgcolor){mf_main.editorController.gridController.backgroundColor=bgcolor;mf_main.editorController.gridController.backgroundColorGlobal=bgcolor;mf_main.editorController.changeBackgroundColor();}mf_main.editorController.editManager.getPageBackgroundRTC(data);}if(data.cmd=="snapsync"){var snap=data.snap;var snapval=data.snapval;mf_main.editorController.gridController.snapToGrid=snap;mf_main.editorController.gridController.snapPos=snapval;}if(data.cmd=="unlockEditing"){if(!mf_main.PUBLIC&&MF_UserSession.getUser().username.toLowerCase()!=data.sender.toLowerCase()){var existingPage=MF_PagePool.getPage(data.pageid);if(existingPage){existingPage.closeRTCEditor();}if(mf_main.editorController.page.eid===data.pageid){existingPage.showRTCMsg();}}}if(data.cmd=="addComment"){if(mf_main.editorController.page.eid===data.pageid){mf_main.editorController.commentController.refreshCommentHandler();}else{mf_main.editorController.commentController.cachedPageComments[data.pageid]=null;}thisClass.showNotification(senderUsername,data.creatorName,"Added Comment: "+data.msg);}if(data.cmd=="editComment"){if(mf_main.editorController.page.eid===data.pageid){for(var i=0;i<mf_main.editorController.commentController.commentCollection.size();i++){var commentItem=mf_main.editorController.commentController.commentCollection.getItemAt(i);if(commentItem.id==data.feedback.id){commentItem.message=data.feedback.message;commentItem.pos=data.feedback.pos;}}mf_main.editorController.commentController.listCommentsByPage(mf_main.editorController.commentController.commentCollection.toArray());}else{mf_main.editorController.commentController.cachedPageComments[data.pageid]=null;}thisClass.showNotification(senderUsername,data.creatorName,"Updated Comment: "+data.msg);}if(data.cmd=="delComment"){if(mf_main.editorController.page.eid===data.pageid){mf_main.editorController.commentController.refreshCommentHandler();}else{mf_main.editorController.commentController.cachedPageComments[data.pageid]=null;}}if(data.cmd=="addImage"||data.cmd=="refreshImageListing"){if(mf_main.PERMISSION=="Reviewer"||mf_main.PUBLIC){}else{if(mf_main.editorController.imageController.listed){mf_main.editorController.imageController.listed=false;mf_main.editorController.imageController.listImages();}}}if(data.cmd=="delImage"){if(mf_main.PERMISSION=="Reviewer"||mf_main.PUBLIC){}else{if(mf_main.editorController.imageController.listed){var imgObj=mf_main.editorController.imageController.getImageByID("",data.imageID);if(imgObj){var imindx=mf_main.editorController.imageController.imageCollection.getItemIndex(imgObj);if(imindx!=-1){mf_main.editorController.imageController.imageCollection.removeItemAt(imindx);}var arr=mf_main.editorController.imageController.imageCollection.toArray();mf_main.editorController.imageController.applyTemplate(arr);}}}}if(data.cmd=="renameImage"){if(mf_main.PERMISSION=="Reviewer"||mf_main.PUBLIC){}else{if(mf_main.editorController.imageController.listed){var imgObj=mf_main.editorController.imageController.getImageByID("",data.imageID);if(imgObj){imgObj.name=data.imageName;var arr=mf_main.editorController.imageController.imageCollection.toArray();mf_main.editorController.imageController.applyTemplate(arr);}}}}if(data.cmd=="syncpowerupsidebar"){if(mf_main.PUBLIC){}else{var arr=data.pinned;if(arr&&mf_main.editorController.powerupController){mf_main.editorController.projectObj.pinnedPowerups=arr;mf_main.editorController.powerupController.powerupsListed=false;mf_main.editorController.powerupController.applyPinnedPowerupsTemplate();$(".mfPowerupItemPin").removeClass("mfPowerupItemPinInstalled");$(".mfPowerupItemPin").find(".mfIcon").removeClass("fa-heart").addClass("fa-heart-o");for(var k=0;k<arr.length;k++){var pin=arr[k];$("#mfPowerupItemIcon_"+pin.id).addClass("mfPowerupItemPinInstalled");$("#mfPowerupItemIcon_"+pin.id).find(".mfIcon").removeClass("fa-heart-o").addClass("fa-heart");}}}}if(data.cmd=="addPage"){var page=new MF_Page();page.cast(data);MF_PagePool.addPage(page);mf_main.editorController.pageController.refreshTree(page,page.folder);mf_main.editorController.pageController.setGridChanged();}if(data.cmd=="delPage"){var existingPage=MF_PagePool.getPage(data.eid);if(existingPage){mf_main.editorController.pageController.deletePageServer(existingPage);mf_main.editorController.pageController.setGridChanged();}}if(data.cmd=="savePage"){var existingPage=MF_PagePool.getPage(data.eid);if(existingPage&&!existingPage.changed){var allow=false;if(existingPage.loaded||existingPage.noDBLoad){allow=true;}if(allow){var pageViewed=false;for(var k=0;k<mf_main.editorController.loadedPages.length;k++){var pagechk=mf_main.editorController.loadedPages[k];if(pagechk.eid==existingPage.eid){pageViewed=true;break;}}existingPage.pagedata.data=data.pagedata;existingPage.noDBLoad=true;var jData=$(existingPage.pagedata.data);existingPage.e2xml.settingsXML=jData;if(pageViewed){existingPage.loaded=false;existingPage.remove();mf_main.editorController.viewPage(mf_main.editorController.page,true);}else{existingPage.loaded=false;existingPage.remove();}}}}if(data.cmd=="renamePage"){var existingPage=MF_PagePool.getPage(data.eid);if(existingPage){existingPage.pageName=data.pageName;try{var pageTreeItemData=mf_main.editorController.pageController.treeview.get_node(existingPage.eid);if(pageTreeItemData){pageTreeItemData.name=data.pageName;mf_main.editorController.pageController.treeview.rename_node(pageTreeItemData,data.pageName);MF_PagePool.mapPages();mf_main.editorController.pageController.setPageItemDblClickEvent();}else{mf_main.editorController.pageController.listPages();}}catch(e){mf_main.editorController.pageController.listPages();}mf_main.editorController.pageController.setGridChanged();}}if(data.cmd=="masterPage"){var existingPage=MF_PagePool.getPage(data.eid);if(existingPage){existingPage.master=data.master;existingPage.masterPage=data.masterPage;if(existingPage.eid==mf_main.editorController.page.eid){existingPage.loaded=false;mf_main.editorController.viewPage(mf_main.editorController.page,true);}}}if(data.cmd=="navHide"){var existingPage=MF_PagePool.getPage(data.eid);if(existingPage){existingPage.navHide=data.navHide;mf_main.editorController.pageController.listPages();}}if(data.cmd=="updatePageParent"){var existingPage=MF_PagePool.getPage(data.eid);if(existingPage){existingPage.cast(data);var pindx=MF_PagePool.getPages().getItemIndex(existingPage);if(pindx!=-1){MF_PagePool.getPages().removeItemAt(pindx);}MF_PagePool.getPages().addItemAt(existingPage,data.pos);mf_main.editorController.pageController.listPages();mf_main.editorController.pageController.setGridChanged();}mf_main.editorController.pageController.selectPage("mfPageItem"+mf_main.editorController.page.eid);var pageTreeItemData=mf_main.editorController.pageController.treeview.get_node(mf_main.editorController.page.eid);if(pageTreeItemData){mf_main.editorController.pageController.treeview.select_node(pageTreeItemData.id);}}if(data.cmd=="addcustomfont"){if(mf_main.editorController.fontController.customFontListLoaded||data.forceLoadCustomFont){mf_main.editorController.fontController.addCustomFontHandler(data.customFontObj);}}if(data.cmd=="deletecustomfont"){if(mf_main.editorController.fontController.customFontListLoaded){var fontFamily=data.fontfamily;var deleteCustomFontObj=null;for(var i=0;i<mf_main.editorController.fontController.customFontArray.length;i++){if(mf_main.editorController.fontController.customFontArray[i].filename==fontFamily){deleteCustomFontObj=mf_main.editorController.fontController.customFontArray[i];mf_main.editorController.fontController.customFontArray.splice(i,1);break;}}for(var i=0;i<mf_main.editorController.fontController.fontArray.length;i++){if(mf_main.editorController.fontController.fontArray[i].id==fontFamily){mf_main.editorController.fontController.fontArray.splice(i,1);break;}}for(key in mf_main.editorController.fontController.usedFonts){var fontObj=mf_main.editorController.fontController.usedFonts[key];if(fontObj.fontFamily==fontFamily){delete mf_main.editorController.fontController.usedFonts[key];break;}}$("#mfFontListing").find('[data-id="mfFontItem'+fontFamily+'"]').remove();}}if(data.cmd=="refreshpowerup"){mf_main.editorController.powerupController.RTCRefreshPowerup(data.powerupId,data.data);}if(mf_main.workflowController&&mf_main.workflowController.boardController.listed){if(data.cmd=="addboard"){var board=new MF_WorkflowBoard();board.id=data.boardid;board.name=data.name;board.clientid=data.clientid;board.projectId=data.projectId;board.sortDate=mf_main.workflowController.boardController.boardCollection.size()+1;mf_main.workflowController.boardController.addBoardRTC(board);}if(data.cmd=="deleteboard"){mf_main.workflowController.boardController.deleteBoardRTC(data.boardid);}if(data.cmd=="editboard"){mf_main.workflowController.boardController.editBoardRTC(data.boardid,data.name);}if(data.cmd=="sortboard"){mf_main.workflowController.boardController.sortBoardRTC(data);}if(data.cmd=="sortworkflowItem"){mf_main.workflowController.boardController.sortWorkflowItemRTC(data.boardid);}if(data.cmd=="moveworkflowItem"){mf_main.workflowController.boardController.moveWorkflowItemRTC(data.srcBoardID,data.dstBoardID);}}if(data.cmd=="powerup_sync"){thisClass.showNotification(data.sender,data.senderName,data.messageStr);}}}});};this.showNotification=function(sender,senderName,msg){if(mf_main.PUBLIC){return;}if(sender.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()){return;}if(mf_main.pushController.isEnabled()){}else{}var notifyObj=new Notify(senderName,{body:msg,icon:"images/general/wireframe.png",timeout:4,notifyClick:onNotificationClick});function onNotificationClick(){}mf_main.pushController.showNotification(notifyObj);};this.sendChatMsg=function(cmd,chatObj){chatObj.sessionID=thisClass.sessionID;chatObj.cmd=cmd;if(cmd=="textmsg"){thisClass.socket.emit("sendmsg",chatObj);return;}};this.sidebarPowerupSync=function(cmd,arr){var obj=new Object();obj.sessionID=thisClass.sessionID;obj.cmd=cmd;obj.pinned=arr;if(cmd=="syncpowerupsidebar"){thisClass.socket.emit("sendmsg",obj);return;}};this.imageSync=function(cmd,imageobj){var obj=new Object();obj.sessionID=thisClass.sessionID;obj.cmd=cmd;if(cmd=="addImage"){thisClass.socket.emit("sendmsg",obj);return;}if(cmd=="delImage"){obj.imageID=imageobj.id;thisClass.socket.emit("sendmsg",obj);return;}if(cmd=="renameImage"){obj.imageID=imageobj.id;obj.imageName=imageobj.name;thisClass.socket.emit("sendmsg",obj);return;}if(cmd=="refreshImageListing"){thisClass.socket.emit("sendmsg",obj);return;}};this.siteMapSync=function(cmd,pageobj){var obj=new Object();obj.sessionID=thisClass.sessionID;obj.cmd=cmd;obj.pageName=pageobj.pageName;obj.eid=pageobj.eid;obj.parentPage=pageobj.parentPage;obj.folder=pageobj.folder;obj.master=pageobj.master;obj.masterPage=pageobj.masterPage;obj.navHide=pageobj.navHide;if(cmd=="addPage"){mf_main.editorController.pageController.setGridChanged();thisClass.socket.emit("sendmsg",obj);return;}if(cmd=="savePage"){obj.pagedata=pageobj.pagedata.data;thisClass.socket.emit("sendmsg",obj);return;}if(cmd=="delPage"){mf_main.editorController.pageController.setGridChanged();thisClass.socket.emit("sendmsg",obj);return;}if(cmd=="renamePage"){mf_main.editorController.pageController.setGridChanged();thisClass.socket.emit("sendmsg",obj);return;}if(cmd=="masterPage"){thisClass.socket.emit("sendmsg",obj);return;}if(cmd=="navHide"){mf_main.editorController.pageController.setGridChanged();thisClass.socket.emit("sendmsg",obj);return;}if(cmd=="updatePageParent"){mf_main.editorController.pageController.setGridChanged();var pos=MF_PagePool.getPages().getItemIndex(pageobj);if(pos!=-1){obj.pos=pos;thisClass.socket.emit("sendmsg",obj);}return;}};this.commentSync=function(cmd,commentObj){var obj=new Object();obj.sessionID=thisClass.sessionID;obj.cmd=cmd;obj.pageid=commentObj.pageid;obj.msg=commentObj.message;obj.username=commentObj.creator;obj.creatorName=commentObj.creatorName;if(cmd=="addComment"){thisClass.socket.emit("sendmsg",obj);return;}if(cmd=="editComment"){obj.feedback=commentObj;thisClass.socket.emit("sendmsg",obj);return;}if(cmd=="delComment"){thisClass.socket.emit("sendmsg",obj);return;}};this.gridSync=function(gridobj){var obj=new Object();obj.sessionID=thisClass.sessionID;obj.gridobj=gridobj;obj.cmd="gridsync";thisClass.socket.emit("sendmsg",obj);};this.pagesizeSync=function(sizeobj){var obj=new Object();obj.sessionID=thisClass.sessionID;obj.sizeobj=sizeobj;obj.cmd="pagesizesync";thisClass.socket.emit("sendmsg",obj);};this.bgSync=function(bgcolor,pageid,pageoverride,pagecolor){var obj=new Object();obj.sessionID=thisClass.sessionID;obj.pageoverride=pageoverride;obj.pagecolor=pagecolor;obj.pageid=pageid;obj.bgcolor=bgcolor;obj.cmd="bgsync";thisClass.socket.emit("sendmsg",obj);};this.snapSync=function(snap,snapval){var obj=new Object();obj.sessionID=thisClass.sessionID;obj.snap=snap;obj.snapval=snapval;obj.cmd="snapsync";thisClass.socket.emit("sendmsg",obj);};this.customFontSync=function(cmd,customFontObj,forceLoadCustomFont){var obj=new Object();obj.sessionID=thisClass.sessionID;obj.cmd=cmd;if(cmd=="addcustomfont"){obj.forceLoadCustomFont=forceLoadCustomFont;obj.customFontObj=customFontObj;}if(cmd=="deletecustomfont"){obj.fontfamily=customFontObj.filename;}thisClass.socket.emit("sendmsg",obj);};this.editorSync=function(cmd,pageobj){var obj=new Object();obj.sessionID=thisClass.sessionID;obj.cmd=cmd;obj.pageid=pageobj.eid;obj.sender=MF_UserSession.getUser().username;obj.senderName=MF_UserSession.getUser().firstName+" "+MF_UserSession.getUser().lastName;if(cmd=="lockEditing"){thisClass.socket.emit("sendmsg",obj);return;}if(cmd=="unlockEditing"){thisClass.socket.emit("sendmsg",obj);return;}};this.aiGetCredits=function(){if(MF_UserSession.getUser()&&MF_UserSession.getUser().isBasic){mf_main.editorController.aiManagerController.creditsPeriod="this month";}var obj=new Object();obj.sessionID=thisClass.sessionID;obj.clientid=MF_UserSession.getUser().company;obj.accountType=MF_UserSession.getUser().accountType;obj.userobj=MF_UserSession.getUser();obj.cmd="getaicredits";thisClass.socket.emit("sendmsg",obj);return;};this.aiToolSync=function(data,aitype){var obj=new Object();obj.sessionID=thisClass.sessionID;obj.clientid=MF_UserSession.getUser().company;obj.accountType=MF_UserSession.getUser().accountType;obj.cmd="aitool";obj.userobj=MF_UserSession.getUser();obj.aitype=aitype;obj.data=data;thisClass.socket.emit("sendmsg",obj);return;};this.compSync=function(cmd,packid){if(mf_main.FILEMODE){return;}var obj=new Object();obj.sessionID=thisClass.sessionID;obj.cmd=cmd;obj.packid=packid;obj.sender=MF_UserSession.getUser().username;obj.senderName=MF_UserSession.getUser().firstName+" "+MF_UserSession.getUser().lastName;if(cmd=="uipackUpdate"){thisClass.socket.emit("sendmsg",obj);return;}};this.boardSync=function(boardcmd,boardid,boardobj){var obj=new Object();obj.sessionID=thisClass.sessionID;obj.cmd=boardcmd;obj.boardid=boardid;if(boardcmd=="addboard"){obj.name=boardobj.name;obj.clientid=boardobj.clientid;obj.projectId=boardobj.projectId;obj.sortDate=boardobj.sortDate;thisClass.socket.emit("sendmsg",obj);return;}if(boardcmd=="deleteboard"){thisClass.socket.emit("sendmsg",obj);return;}if(boardcmd=="sortboard"){thisClass.socket.emit("sendmsg",obj);return;}if(boardcmd=="editboard"){obj.name=boardobj.name;thisClass.socket.emit("sendmsg",obj);return;}if(boardcmd=="sortworkflowItem"){thisClass.socket.emit("sendmsg",obj);return;}if(boardcmd=="moveworkflowItem"){obj.srcBoardID=boardobj.srcBoard;obj.dstBoardID=boardobj.dstBoard;thisClass.socket.emit("sendmsg",obj);return;}};this.powerupSync=function(cmd,powerupId,data){var obj=new Object();obj.sessionID=thisClass.sessionID;obj.cmd=cmd;if(cmd=="refreshpowerup"){obj.powerupId=powerupId;obj.data=data;}thisClass.socket.emit("sendmsg",obj);};this.powerupNotificationSync=function(powerupObj){var obj=new Object();obj.sessionID=thisClass.sessionID;obj.cmd=powerupObj.cmd;obj.sender=MF_UserSession.getUser().username;obj.senderName=MF_UserSession.getUser().firstName+" "+MF_UserSession.getUser().lastName;obj.messageStr=powerupObj.messageStr;thisClass.socket.emit("sendmsg",obj);var user=MF_UserSession.getUser();MF_LogManager.logProjectNotification(mf_main.editorController.projectObj,user.username,user.firstName,"ZOOMMEETING-CREATE",powerupObj.id,{callback:function(){}});};}function MF_PushNotificationController(){this.constructor=function(){if(mf_main.PUBLIC||mf_main.INTEGRATION){return;}try{if(Notify.needsPermission){if(Notify.isSupported()){Notify.requestPermission(thisClass.onPermissionGranted,thisClass.onPermissionDenied);}}}catch(e){}};this.onPermissionDenied=function(){};this.onPermissionGranted=function(){};this.enableNotification=function(){};this.isEnabled=function(){try{if(Notify.needsPermission){return false;}}catch(e){}return true;};this.showNotification=function(notifyObj){try{if(!Notify.needsPermission){notifyObj.show();}else{if(Notify.isSupported()){Notify.requestPermission(thisClass.onPermissionGranted,thisClass.onPermissionDenied);}}}catch(e){}};}function MF_FavouriteColorController(){var thisClass=this;this.favouriteColors=new Array();this.favouriteColorPaletteArr=new Array();this.constructor=function(){};this.addFavColorHandler=function(selectedColor){var colPowerup=false;if(selectedColor&&typeof selectedColor=="string"){var colorCode=selectedColor;colPowerup=true;}else{var colorCode=$(".sp-container").not(".sp-hidden").find(".sp-input").val();}var favColors=mf_main.editorController.projectObj.favouriteColors;var colorIndx=MF_Utils.searchObjArray(favColors,"code",colorCode);if(colorIndx==-1){mf_color=new MF_FavouriteColor();mf_color.id="favc"+MF_Utils.guidGenerator();mf_color.code=colorCode;mf_color.title=colorCode;$(".sp-palette-row-0").append('<span title="'+colorCode+'" data-color="'+colorCode+'" class="sp-thumb-el sp-thumb-dark"><span class="sp-thumb-inner" style="background-color:'+colorCode+'"></span></span>');thisClass.favouriteColors=new Array();if(favColors!=null&&favColors.length>0){thisClass.favouriteColors=favColors;var cpos=Math.max.apply(Math,favColors.map(function(item){return item.sort;}));mf_color.sort=cpos+1;}else{mf_color.sort=0;}if(!$(".mfColorPickerOptions").is(":visible")){$(".mfColorPickerOptions").show();$(".mfFavColorEmptyString").remove();}thisClass.favouriteColors.push(mf_color);thisClass.updateFavColorHandler();if(colPowerup){MF_Utils.display_ActionIndicator("Selected color added to favourite list in your project.");}}else{MF_Utils.display_ActionIndicator("Selected color already exists");}};this.updateFavColorHandler=function(){var favColors=thisClass.favouriteColors;mf_main.editorController.projectObj.favouriteColors=favColors;thisClass.assignFavouriteColorPalette();MF_ChangeManager.CHANGED(true);if(favColors.length==0){$("#mfFavColorsListItemsEmpty").show();}};this.manageFavColorHandler=function(){thisClass.favouriteColors=mf_main.editorController.projectObj.favouriteColors;$("#mfNavBarContent").click();$(".modal").modal("hide");$("#mfFavColorsListModal").modal();$("#mfFavColorsListItemsEmpty").hide();thisClass.applyFavColorTemplate();};this.applyFavColorTemplate=function(){$("#mfFavColorsListItems").empty();var cachedTemplate=mf_main.getTemplateFromCache("mfFavColorItemTemplate");if(cachedTemplate==null){$.get("templates/editor/FavouriteColorItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfFavColorItemTemplate").html());mf_main.addTemplateToCache("mfFavColorItemTemplate",template);thisClass.renderItems(template);});}else{thisClass.renderItems(cachedTemplate);}};this.renderItems=function(template){var i=0;$("#mfFavColorsListItems").empty();var sortableItems="";var sortableCount=0;var len=thisClass.favouriteColors.length;var htmldom="";for(i=0;i<=len-1;i++){var colorItem=thisClass.favouriteColors[i];htmldom=htmldom+template(colorItem);if(sortableCount==0){sortableItems="#mfFavColorItem_"+colorItem.id;}else{sortableItems=sortableItems+",#mfFavColorItem_"+colorItem.id;}sortableCount++;}$("#mfFavColorsListItems").append(htmldom);$("#mfFavColorsListItems").sortable({items:sortableItems,stop:thisClass.sortFavColorItems});$(".mfFavColorEditCls").on("click",thisClass.editFavColorHandler);$(".mfFavColorDelCls").on("click",thisClass.deleteFavColorHandler);};this.sortFavColorItems=function(){var count=0;var colorarray=new Array();$("#mfFavColorsListItems").children().each(function(){count++;var colorItem=thisClass.getColorByID($(this).attr("db-colorid"));if(colorItem){colorItem.sort=count;colorarray.push(colorItem);}});thisClass.favouriteColors=colorarray;thisClass.updateFavColorHandler();};this.editFavColorHandler=function(e){e.stopImmediatePropagation();$("#mfColorEditOptions").remove();$(".mfColorOptions").show();var coloritem=thisClass.getColorByID($(this).attr("db-colorid"));thisClass.selectedColorId=coloritem.id;var selColorElem="#mfFavColorItem_"+coloritem.id;$(selColorElem+" .mfColorOptions").hide();$(selColorElem).append('<div id="mfColorEditOptions" style="text-align: left;width: calc(100% - 40px);padding-left: 10px;float: left;font-size: 14px;"><input id="mfFavColorTitleinput" type="text" class="form-control" style="color: #666;width: 270px;margin-right: 10px;float: left;"/><span class="mfFavColorSaveCls btn btn-primary" db-colorid="{{id}}" style="float: right;padding: 6px 18px;">Save</span></div>');$("#mfFavColorTitleinput").val($(selColorElem+" .mfFavColorTitleCls").text());mf_main.editorController.shortcutsFlag=false;$("#mfFavColorTitleinput").on("keypress",function(event){if(event.which=="13"){thisClass.updateColorTitle();}});$(".mfFavColorSaveCls").on("click",function(){thisClass.updateColorTitle();});};this.updateColorTitle=function(e){var colorInput=$("#mfFavColorTitleinput");if(colorInput.length!=0&&colorInput.val().trim()!=""){var colorIndx=MF_Utils.searchObjArray(thisClass.favouriteColors,"id",thisClass.selectedColorId);thisClass.favouriteColors[colorIndx].title=colorInput.val().trim();$("#mfColorEditOptions").remove();$("#mfFavColorItem_"+thisClass.selectedColorId+" .mfColorOptions").show();$("#mfFavColorItem_"+thisClass.selectedColorId+" .mfFavColorTitleCls").text(colorInput.val().trim());thisClass.updateFavColorHandler();}else{alert("Color title should not be empty");}};thisClass.closeColorTitleInput=function(){var colorInput=$("#mfFavColorTitleinput");if(colorInput.length!=0){$("#mfColorEditOptions").remove();$("#mfFavColorItem_"+thisClass.selectedColorId+" .mfColorOptions").show();}};this.deleteFavColorHandler=function(e){var coloritem=thisClass.getColorByID($(this).attr("db-colorid"));if(coloritem){$("#mfFavColorItem_"+coloritem.id).remove();var colorIndx=MF_Utils.searchObjArray(thisClass.favouriteColors,"id",coloritem.id);thisClass.favouriteColors.splice(colorIndx,1);thisClass.updateFavColorHandler();}};this.getColorByID=function(cid){for(i=0;i<=thisClass.favouriteColors.length-1;i++){var colorItem=thisClass.favouriteColors[i];if(colorItem.id==cid){return colorItem;}}return null;};this.getFavouriteColorXML=function(){try{var favouriteColorXML="<favourite-colors>";var favouriteColorsArr=mf_main.editorController.projectObj.favouriteColors;for(var i=0;i<favouriteColorsArr.length;i++){favouriteColorXML+='<color id="'+favouriteColorsArr[i].id+'" hexcode="'+favouriteColorsArr[i].code+'" title="'+favouriteColorsArr[i].title+'" sortorder="'+favouriteColorsArr[i].sort+'"></color>';}favouriteColorXML+="</favourite-colors>";return favouriteColorXML;}catch(e){return"";}};this.assignFavouriteColorPalette=function(){var favColourCodeArray=[];for(var i=0;i<mf_main.editorController.projectObj.favouriteColors.length;i++){favColourCodeArray.push(mf_main.editorController.projectObj.favouriteColors[i].code);}$.fn.spectrum.defaults.palette=favColourCodeArray;thisClass.favouriteColorPaletteArr=favColourCodeArray;};}function MF_DashboardRTCController(){var thisClass=this;this.sessionID=null;this.socket=null;this.disconnect=function(){if(thisClass.socket){thisClass.socket.disconnect();}};this.connect=function(){if(mf_main.RENDER){return;}if(MF_Global.getS3Bucket()=="testmfassets"){thisClass.socket=io.connect("http://localhost:2083",{cookie:false});}else{thisClass.socket=io.connect("https://wireframepro.mockflow.com",{path:"/rtc_dashboard.io",cookie:false});}thisClass.socket.on("connect",function(){thisClass.sessionID=MF_Utils.guidGenerator();thisClass.socket.emit("adduser",{sessionid:thisClass.sessionID,username:MF_UserSession.getUser().username});});thisClass.socket.on("updatemsg",function(username,data){if(data&&mf_main.editorController){var senderName=MF_UserSession.getUser().firstName+" "+MF_UserSession.getUser().lastName;if(senderName==data.sender){data.sender="You";data.message=data.message.replace("has","have");}if(data.cmd=="designspaceprojectpowerup_editorpinunpinupdate"){if(data&&data.project.powerupId){mf_main.editorController.powerupController.updatePowerupPinHandler(data.project.powerupId);}}if(data.cmd=="designspaceproject_editorupdatespaceid"){if(data.project.id==mf_main.editorController.projectObj.id){var destSpaceId=data.project.spaceId;if(destSpaceId=="default"){destSpaceId=null;}mf_main.editorController.projectObj.spaceId=destSpaceId;if(mf_main.editorController.powerupController.selectedPowerup){mf_main.editorController.powerupController.updatePowerupPinHandler(mf_main.editorController.powerupController.selectedPowerup.id);}}}if(data.cmd=="designspaceproject_share"){if(data.project&&data.project.projectType=="powerup"){if(mf_main.editorController.powerupController.selectedPowerup&&data.project.powerupId==mf_main.editorController.powerupController.selectedPowerup.id){mf_main.editorController.powerupController.updatePowerupPinHandler(mf_main.editorController.powerupController.selectedPowerup.id);}}else{mf_main.editorController.powerupController.updateProjectPublicLinkAccess(data.project);}}}});};this.powerupSync=function(cmd,rtcObj){var obj=new Object();obj.sessionID=thisClass.sessionID;obj.cmd=cmd;obj.sender=rtcObj.sender;obj.senderName=rtcObj.senderName;obj.userobj=rtcObj.collaborators;obj.message=rtcObj.messageStr;obj.logcmd=rtcObj.logcmd;obj.logdata=rtcObj.logdata;if(cmd=="powerup_sync"){thisClass.socket.emit("sendmsg",obj);return;}};this.pinPowerupSync=function(cmd,rtcObj){var obj=new Object();obj.sessionID=thisClass.sessionID;obj.cmd=cmd;obj.sender=rtcObj.sender;obj.senderName=rtcObj.senderName;obj.userobj=rtcObj.collaborators;obj.spaceId=rtcObj.spaceId;obj.project=rtcObj.project;obj.collaborators=rtcObj.collaborators;obj.notifyCollaborators=rtcObj.notifyCollaborators;obj.message=rtcObj.messageStr;obj.logcmd=rtcObj.logcmd;obj.logdata=rtcObj.logdata;if(cmd=="designspacepowerup_pin"||cmd=="designspacepowerup_unpin"){thisClass.socket.emit("sendmsg",obj);return;}};this.uninstallPowerupSync=function(cmd,rtcObj){var obj=new Object();obj.sessionID=thisClass.sessionID;obj.cmd=cmd;obj.sender=rtcObj.sender;obj.senderName=rtcObj.senderName;obj.userobj=rtcObj.collaborators;obj.collaborators=rtcObj.collaborators;obj.notifyCollaborators=rtcObj.notifyCollaborators;obj.powerupId=rtcObj.powerupId;obj.spaceId=rtcObj.spaceId;obj.clientId=rtcObj.clientId;obj.message=rtcObj.messageStr;obj.logcmd=rtcObj.logcmd;obj.logdata=rtcObj.logdata;if(cmd=="uninstall_powerup"){thisClass.socket.emit("sendmsg",obj);return;}};this.powerupPublicLinkSync=function(cmd,rtcObj){var obj=new Object();obj.sessionID=thisClass.sessionID;obj.cmd=cmd;obj.sender=rtcObj.sender;obj.senderName=rtcObj.senderName;obj.userobj=rtcObj.collaborators;obj.collaborators=rtcObj.collaborators;obj.projectId=rtcObj.projectId;obj.publicURL=rtcObj.publicURL;obj.spaceId=rtcObj.spaceId;obj.message=rtcObj.messageStr;obj.logcmd=rtcObj.logcmd;obj.logdata=rtcObj.logdata;if(cmd=="designspacepowerup_updatepubliclink"){thisClass.socket.emit("sendmsg",obj);return;}};this.pagePowerupSync=function(cmd,rtcObj){var obj=new Object();obj.sessionID=thisClass.sessionID;obj.cmd=cmd;obj.sender=rtcObj.sender;obj.senderName=rtcObj.senderName;obj.userobj=rtcObj.collaborators;obj.collaborators=rtcObj.collaborators;obj.projects=rtcObj.projects;obj.spaceId=mf_main.editorController.projectObj.spaceId;obj.type=rtcObj.type;obj.message=rtcObj.messageStr;obj.logcmd=rtcObj.logcmd;obj.logdata=rtcObj.logdata;if(cmd=="designspaceprojectpowerup_pagesync"){thisClass.socket.emit("sendmsg",obj);return;}};this.commentSync=function(cmd,commentObj){var obj=new Object();obj.sessionID=thisClass.sessionID;obj.cmd=cmd;obj.pageid=commentObj.pageid;obj.msg=commentObj.message;obj.username=commentObj.creator;obj.creatorName=commentObj.creatorName;obj.userobj=commentObj.collaborators;obj.message=commentObj.messageStr;obj.sender=commentObj.sender;obj.senderName=commentObj.senderName;obj.profileImage=commentObj.profileImage;obj.collaborators=commentObj.collaborators;obj.logcmd=commentObj.logcmd;obj.logdata=commentObj.logdata;if(cmd=="addComment"){thisClass.socket.emit("sendmsg",obj);return;}if(cmd=="editComment"){obj.feedback=commentObj;thisClass.socket.emit("sendmsg",obj);return;}if(cmd=="delComment"){thisClass.socket.emit("sendmsg",obj);return;}};this.notification_sync=function(rtcObj){var obj=new Object();obj.sessionID=thisClass.sessionID;obj.cmd="notification_sync";obj.sender=rtcObj.sender;obj.senderName=rtcObj.senderName;obj.collaborators=rtcObj.collaborators;obj.notifyCollaborators=rtcObj.notifyCollaborators;obj.message=rtcObj.messageStr;obj.profileImage=rtcObj.profileImage;obj.logcmd=rtcObj.logcmd;obj.logdata=rtcObj.logdata;thisClass.socket.emit("sendmsg",obj);return;};this.spacePowerupPageSync=function(cmd,rtcObj){var obj=new Object();obj.sessionID=thisClass.sessionID;obj.cmd=cmd;obj.collaborators=rtcObj.collaborators;obj.spaceId=mf_main.editorController.projectObj.spaceId;thisClass.socket.emit("sendmsg",obj);return;};}function MF_AIManagerController(){var thisClass=this;this.BYOCAIContent="";this.creditsTextAvailable=0;this.creditsTextTotal=0;this.creditsImageAvailable=0;this.creditsImageTotal=0;this.creditsPeriod="today";this.byocwidth=0;this.byocheight=0;this.BYOCGenerationInProgress=false;this.constructor=function(){$("#mfBYOCGenerateWithAISubmit").on("click",thisClass.BYOCAIGenerateHandler);$("#mfBYOCGenerateWithAIAdd").on("click",thisClass.addAICodeToBYOC);$("#mfBYOCAIFormSuggestions li").on("click",thisClass.BYOCAISuggestionHandler);$("#mfBYOCGenerateWithAIModal").on("shown.bs.modal",thisClass.openModalHandler);$("#mfBYOCAIBackIcon").on("click",thisClass.byocBackToGenerateScreen);};this.BYOCAIGenerateHandler=function(e){e.preventDefault();var promptText=$("#mfBYOCGenerateWithAIPrompt").val().trim();if(promptText.length>0){thisClass.getAICodeHandler(promptText);}else{bootbox.alert("A text prompt is required");}return false;};this.displayCode=function(generatedCode){var txt=generatedCode;try{txt=MF_Utils.sanitizeHTML(txt);txt=MF_Utils.sanitizeHTMLTags(txt);}catch(e){}thisClass.BYOCAIContent=txt;var decodedSnippet='<html style=" margin: 0px; padding: 10px;  "><head><style> body, input, textarea, button { overflow: hidden;} </style></head><body style=" min-height: calc(100% - 40px) !important; margin: 0 auto; padding: 15px; overflow: auto; width: fit-content; pointer-events: none;">'+txt+"</body></html>";$("#mfBYOCGenerateWithAIPreviewFrame").attr("srcdoc",decodedSnippet);thisClass.byocwidth=0;thisClass.byocheight=0;$("#mfBYOCAILoadingScreen").hide();$("#mfBYOCAIPreviewScreen").show();setTimeout(function(){try{var swidth=$("#mfBYOCGenerateWithAIPreviewFrame").contents().find("body").children().first().outerWidth();var sheight=$("#mfBYOCGenerateWithAIPreviewFrame").contents().find("body").children().first().outerHeight();thisClass.byocwidth=swidth;thisClass.byocheight=sheight;thisClass.byocheight=$("#mfBYOCGenerateWithAIPreviewFrame").contents().find("body").outerHeight();}catch(e){}},2000);thisClass.BYOCGenerationInProgress=false;};this.getAICodeHandler=function(promptText){if(mf_main.editorController.aiManagerController.creditsTextAvailable==0){$("#mfBYOCGenerateWithAIModal").modal("hide");bootbox.alert("You have exhausted your AI text credits for "+mf_main.editorController.aiManagerController.creditsPeriod);return false;}thisClass.creditsTextAvailable--;thisClass.renderOpenAILimitInfo();$("#mfBYOCAIFormScreen").hide();$("#mfBYOCAILoadingScreen").show();thisClass.BYOCGenerationInProgress=true;var obj=new Object();obj.prompt=promptText;obj.textLength=parseInt($("#mf_gentext_rangeinput").val());mf_main.rtc.aiToolSync(obj,"genbyoc");};this.addAICodeToBYOC=function(){var txt=thisClass.BYOCAIContent;txt=MF_Utils.htmlEncode(txt);thisClass.updateCodeInComponents(txt);MF_Utils.display_ActionIndicator("HTML code saved successfully");$("#mfBYOCGenerateWithAIModal").modal("hide");};this.updateCodeInComponents=function(stext){var applied=false;var complist=new Array();var undoarr=new Array();var comptext=new Object();for(var v=0;v<mf_main.editorController.componentSelect.length;v++){var selectobj=mf_main.editorController.componentSelect[v];var comp=selectobj.component;if(comp&&comp.NAME=="MF_BYOC"){applied=true;comptext[comp.eid]=MF_Utils.htmlEscape(comp.text);complist.push(comp);if(mf_main.editorController.lastTextEditComp){mf_main.editorController.stopEditingText();}}}if(applied){for(var j=0;j<complist.length;j++){try{var txtcomp=complist[j];var undo=new MF_UndoDAO();undo.propSingleUndo(txtcomp,"text",txtcomp.text);undoarr.push(undo);txtcomp.e2xml.addPropSingle("text",stext,"default");txtcomp.render(true);}catch(e){}}if(undoarr.length>0){mf_main.editorController.reStackComponents();var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}else{var initoffset=mf_main.componentList.getInitOffsets();var newComp=mf_main.componentList.invokeComponent("MF_BYOC","new",initoffset.offsetXPos,initoffset.offsetYPos);newComp.e2xml.addPropSingle("text",stext,"default");try{if(thisClass.byocwidth!=0&&thisClass.byocheight!=0){var szObject=new Object();szObject.width=parseInt(thisClass.byocwidth);szObject.height=parseInt(thisClass.byocheight);newComp.e2xml.addPropObject("esize",szObject,"default");}}catch(e){console.log(e);}newComp.render(true);mf_main.editorController.reStackComponents();mf_main.editorController.addSelectorResize(newComp.selector);}};this.BYOCAISuggestionHandler=function(){var promptText=$(this).text();thisClass.getAICodeHandler(promptText);};this.assignCreditLimits=function(creditLimits){thisClass.creditsTextAvailable=creditLimits.availableTextCredits;thisClass.creditsTextTotal=creditLimits.totalTextCredits;thisClass.creditsImageAvailable=creditLimits.availableImageCredits;thisClass.creditsImageTotal=creditLimits.totalImageCredits;thisClass.renderOpenAILimitInfo();thisClass.AICreditLoaded=true;};this.openModalHandler=function(){thisClass.renderOpenAILimitInfo();$("#mfBYOCGenerateWithAIPrompt").focus();};this.renderOpenAILimitInfo=function(){$("#mfBYOCGenerateWithAICredits").text(thisClass.creditsTextAvailable+"/"+thisClass.creditsTextTotal+" credits available for today");};this.byocBackToGenerateScreen=function(){$("#mfBYOCAIPreviewScreen").hide();$("#mfBYOCAIFormScreen").show();$("#mfBYOCGenerateWithAIPrompt").focus();};}function MF_AIToolsController(){var thisClass=this;this.stable=null;this.colorarr=null;this.constructor=function(){$(".mfAIToolItemCls").on("click",thisClass.openToolHandler);$("#mfAIToolsBackListing").on("click",thisClass.openToolListHandler);$("#mfAIToolTextGenerateBtn").on("click",thisClass.generateText);$("#mfApplyGenTextBtn").on("click",thisClass.applyText);$("#mfApplyReuseTextBtn").on("click",thisClass.regenerateText);$("#mf_ai_tool_text_close").on("click",thisClass.closeText);$("#mfAIToolImageGenerateBtn").on("click",thisClass.generateImage);$("#mfApplyGenImageBtn").on("click",thisClass.applyImage);$("#mfApplyReuseImageBtn").on("click",thisClass.regenerateImage);$("#mf_ai_tool_img_close").on("click",thisClass.closeImage);$("#mfAIToolTableGenerateBtn").on("click",thisClass.generateTable);$("#mfApplyGenTableBtn").on("click",thisClass.applyTable);$("#mfApplyReuseTableBtn").on("click",thisClass.regenerateTable);$("#mf_ai_tool_table_close").on("click",thisClass.closeTable);$("#mfAIToolColorGenerateBtn").on("click",thisClass.generateColors);$("#mfApplyReuseColorBtn").on("click",thisClass.regenerateColor);$("#mf_ai_tool_color_close").on("click",thisClass.closeColor);$("#mfApplyGenColorBtn").on("click",thisClass.applyAddAllAIColors);$(".mfColorPromptExample").on("click",thisClass.exampleColorPrompts);$("#mfAIToolUIGenerateBtn").on("click",thisClass.generateUI);$(".mf_ai_tone_cls").on("click",thisClass.selectTone);$(".mf_ai_tool_img_input_data").on("click",thisClass.selectImageStyle);};this.closeText=function(e){$(".mf_ai_tool_txt_container_cls").hide();$(".mf_ai_tool_input").show();};this.closeColor=function(e){$(".mf_ai_tool_color_container_cls").hide();$(".mf_ai_tool_color_input").show();};this.closeTable=function(e){$(".mf_ai_tool_table_container_cls").hide();$(".mf_ai_tool_table_input").show();};this.closeImage=function(e){$(".mf_ai_tool_img_container_cls").hide();$(".mf_ai_tool_img_input").show();};this.openAIText=function(noinputopen){$(".mfAIToolSideBarCls").hide();$("#mfAIToolView").show();$(".mfAIToolViewContentType").hide();$("#mfAITool_generate_text").show();$(".mfAIToolInfoCredits").text(mf_main.editorController.aiManagerController.creditsTextAvailable+" / "+mf_main.editorController.aiManagerController.creditsTextTotal+" credits available for "+mf_main.editorController.aiManagerController.creditsPeriod);if(noinputopen){}else{$(".mf_ai_tool_txt_container_cls").hide();$(".mf_ai_tool_input").show();$("#mfAIToolSourceText").focus();}};this.openAITable=function(noinputopen){$(".mfAIToolSideBarCls").hide();$("#mfAIToolView").show();$(".mfAIToolViewContentType").hide();$("#mfAITool_generate_table").show();$(".mfAIToolInfoCredits").text(mf_main.editorController.aiManagerController.creditsTextAvailable+" / "+mf_main.editorController.aiManagerController.creditsTextTotal+" credits available for "+mf_main.editorController.aiManagerController.creditsPeriod);if(noinputopen){}else{$(".mf_ai_tool_table_container_cls").hide();$(".mf_ai_tool_table_input").show();$("#mfAIToolSourceTable").focus();}};this.openAIImage=function(noinputopen){$(".mfAIToolSideBarCls").hide();$("#mfAIToolView").show();$(".mfAIToolViewContentType").hide();$("#mfAITool_generate_image").show();$(".mfAIToolInfoCredits").text(mf_main.editorController.aiManagerController.creditsImageAvailable+" / "+mf_main.editorController.aiManagerController.creditsImageTotal+" credits available for "+mf_main.editorController.aiManagerController.creditsPeriod);if(noinputopen){}else{$(".mf_ai_tool_img_container_cls").hide();$(".mf_ai_tool_img_input").show();$("#mfAIToolImgPrompt").focus();}};this.selectImageStyle=function(e){$(".mf_ai_tool_img_input_data").removeClass("mf_ai_tool_imgstyle_active");$(this).addClass("mf_ai_tool_imgstyle_active");};this.selectTone=function(e){var stone=$(this).attr("data-type");$("#mf_ai_selected_tone").attr("data-type",stone);var stone_html=$(this).html();$("#mf_ai_selected_tone").html(stone_html);};this.regenerateImage=function(e){$(".mf_ai_tool_img_container_cls").hide();$(".mf_ai_tool_img_input").show();};this.applyImage=function(e){$(".mf_ai_tool_img_container_cls").hide();$(".mf_ai_tool_img_loader").show();var obj=new Object();obj.url=$("#mfAIToolImageSrc").attr("src");mf_main.rtc.aiToolSync(obj,"downloadaiimage");};this.downloadImage=function(rdata){const blob=new Blob([rdata],{type:"image/png"});const file=new File([blob],"aiimage.png",{type:"image/png",lastModified:Date.now()});mf_main.editorController.imageController.uploadFileTemp=file;mf_main.editorController.imageController.uploadFiles.push(file);mf_main.editorController.imageController.totalCount=mf_main.editorController.imageController.totalCount+mf_main.editorController.imageController.uploadFiles.length;if(typeof mf_main.editorController.imageController.updateImageUploadCount==="function"){mf_main.editorController.imageController.updateImageUploadCount();}if(mf_main.editorController.imageController.uploadFiles.length>0){mf_main.editorController.openNavBarContent("mfNavImagesBtn");mf_main.editorController.imageController.openAddImageDialog();mf_main.editorController.imageController.addImageHandler("aiimage.png");}};this.regenerateText=function(e){$(".mf_ai_tool_txt_container_cls").hide();$(".mf_ai_tool_input").show();};this.regenerateTable=function(e){$(".mf_ai_tool_table_container_cls").hide();$(".mf_ai_tool_table_input").show();};this.regenerateColor=function(e){$(".mf_ai_tool_color_container_cls").hide();$(".mf_ai_tool_color_input").show();};this.applyText=function(e){var stext=$("#mfAITextGenResult").text();thisClass.updateTextInComponents(stext);};this.applyTable=function(e){var stable=thisClass.stable;thisClass.updateTableInComponents(stable);};this.updateTableInComponents=function(stable){var sourceJson=new Object();try{sourceJson=JSON.parse(stable);}catch(e){alert("Some error occurred!. Try again");return;}try{var headers=sourceJson.datagrid[0];var headerRow=headers.map(function(header){return{id:MF_Utils.guidGenerator(),fontColor:"#fff",text:header.charAt(0).toUpperCase()+header.slice(1),icon:"",iconSize:13,link:"",fontWeight:"normal",fontSize:13,fontStyle:"normal",textAlign:"center",textPadding:0,textDecoration:"none",linkType:"",imageUrl:"",height:50,width:130,fillColor:"#424242",fillAlpha:1,fillType:"solid"};});var rows=sourceJson.datagrid.slice(1).map(function(item){return item.map(function(value,index){return{id:MF_Utils.guidGenerator(),fontColor:"#000000",text:value,icon:"",iconSize:13,link:"",fontWeight:"normal",fontSize:13,fontStyle:"normal",textAlign:"center",textPadding:0,textDecoration:"none",linkType:"",imageUrl:"",height:70,width:130,fillColor:index%2===0?"#FAFAFA":"#E0E0E0",fillAlpha:1,fillType:"solid"};});});var targetJson={gridLayout:[headerRow].concat(rows)};var applied=false;var complist=new Array();var undoarr=new Array();var comptext=new Object();for(var v=0;v<mf_main.editorController.componentSelect.length;v++){var selectobj=mf_main.editorController.componentSelect[v];var comp=selectobj.component;if(comp&&comp.NAME=="MF_AdvancedDataGrid"){applied=true;comptext[comp.eid]=MF_Utils.htmlEscape(comp.text);complist.push(comp);if(mf_main.editorController.lastTextEditComp){mf_main.editorController.stopEditingText();}}}if(applied){for(var j=0;j<complist.length;j++){try{var txtcomp=complist[j];var undo=new MF_UndoDAO();undo.propSingleUndo(txtcomp,"gridLayout",txtcomp.gridLayout);undoarr.push(undo);txtcomp.e2xml.addPropSingle("gridLayout",JSON.stringify(targetJson),"default");txtcomp.render(false);}catch(e){}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}else{var initoffset=mf_main.componentList.getInitOffsets();var newComp=mf_main.componentList.invokeComponent("MF_AdvancedDataGrid","new",initoffset.offsetXPos,initoffset.offsetYPos);newComp.e2xml.addPropSingle("gridLayout",JSON.stringify(targetJson),"default");newComp.render(false);var szObject=new Object();szObject.width=newComp.width;szObject.height=newComp.height;newComp.prevEsize=szObject;newComp.render(false);}$(".mf_ai_tool_txt_container_cls").hide();$(".mf_ai_tool_input").show();}catch(e){alert("Some error occurred!. Try again");}};this.updateTextInComponents=function(stext){var applied=false;var complist=new Array();var undoarr=new Array();var comptext=new Object();for(var v=0;v<mf_main.editorController.componentSelect.length;v++){var selectobj=mf_main.editorController.componentSelect[v];var comp=selectobj.component;if(comp&&comp.NAME=="MF_Text"){applied=true;comptext[comp.eid]=MF_Utils.htmlEscape(comp.text);complist.push(comp);if(mf_main.editorController.lastTextEditComp){mf_main.editorController.stopEditingText();}}}if(applied){for(var j=0;j<complist.length;j++){try{var txtcomp=complist[j];var undo=new MF_UndoDAO();undo.propSingleUndo(txtcomp,"text",txtcomp.text);undoarr.push(undo);txtcomp.e2xml.addPropSingle("text",stext,"default");txtcomp.render(false);}catch(e){}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}else{var initoffset=mf_main.componentList.getInitOffsets();var newComp=mf_main.componentList.invokeComponent("MF_Text","new",initoffset.offsetXPos,initoffset.offsetYPos);newComp.e2xml.addPropSingle("text",stext,"default");newComp.render(false);}$(".mf_ai_tool_txt_container_cls").hide();$(".mf_ai_tool_input").show();};this.convertToFullHex=function(shortHex){if(/^#?[0-9a-fA-F]{3}$/.test(shortHex)){if(shortHex[0]==="#"){shortHex=shortHex.substr(1);}var r=shortHex[0];var g=shortHex[1];var b=shortHex[2];return"#"+r+r+g+g+b+b;}else{return shortHex;}};this.traverseDOM=function(element){console.log(element.prop("tagName"));var allow=true;var posx=500;var posy=500;if(element.attr("id")=="mfInvisibleGenUI"){allow=false;}if(allow){var swidth=element.outerWidth();var sheight=element.outerHeight();var hx=element.offset().left+1000;var hy=element.offset().top+1000;if(element.is("input")||element.is("div")||element.is("textarea")){var style=element.attr("style");if(style){var props=new Object();var styles=style.split(";").filter(Boolean);for(var i=0;i<styles.length;i++){var prop_val=styles[i].split(":");if(prop_val&&prop_val.length==2){props[prop_val[0].trim()]=prop_val[1].trim();}}var sx=parseInt(hx)+posx;var sy=parseInt(hy)+posy;var acomp=mf_main.componentList.invokeComponent("MF_Rectangle2","new",sx,sy);acomp.width=parseInt(swidth);acomp.height=parseInt(sheight);var posObject=new Object();posObject.x=sx;posObject.y=sy;var szObject=new Object();szObject.width=parseInt(swidth);szObject.height=parseInt(sheight);acomp.e2xml.addPropObject("esize",szObject,"default");if(props["background-color"]){var fillcolor=thisClass.convertToFullHex(props["background-color"]);acomp.e2xml.addPropArray("fillColors",[fillcolor,fillcolor],"String","default");}if(props.border){acomp.e2xml.addPropArray("borderWidth",[1,1,1,1,1],"uint","default");}else{acomp.e2xml.addPropArray("borderWidth",[0,0,0,0,0],"uint","default");}if(element.is("input")||element.is("textarea")){acomp.e2xml.addPropArray("borderWidth",[1,1,1,1,1],"uint","default");}acomp.render(true);}}if(element.is("button")){var style=element.attr("style");if(style){var props=new Object();var styles=style.split(";").filter(Boolean);for(var i=0;i<styles.length;i++){var prop_val=styles[i].split(":");props[prop_val[0].trim()]=prop_val[1].trim();}var sx=parseInt(hx)+posx;var sy=parseInt(hy)+posy;var acomp=mf_main.componentList.invokeComponent("MF_Button2","new",sx,sy);acomp.width=parseInt(swidth);acomp.height=parseInt(sheight);var posObject=new Object();posObject.x=sx;posObject.y=sy;var szObject=new Object();szObject.width=parseInt(swidth);szObject.height=parseInt(sheight);acomp.e2xml.addPropObject("esize",szObject,"default");if(props["background-color"]){var fillcolor=thisClass.convertToFullHex(props["background-color"]);acomp.e2xml.addPropArray("fillColors",[fillcolor,fillcolor],"String","default");}if(props.border){acomp.e2xml.addPropArray("borderWidth",[1,1,1,1,1],"uint","default");}else{acomp.e2xml.addPropArray("borderWidth",[1,1,1,1,1],"uint","default");}acomp.e2xml.addPropSingle("text",$(element).text(),"default");acomp.render(true);}}if(element.is("span")){var style=element.attr("style");if(style){var props=new Object();var styles=style.split(";").filter(Boolean);for(var i=0;i<styles.length;i++){var prop_val=styles[i].split(":");props[prop_val[0].trim()]=prop_val[1].trim();}var sx=parseInt(hx)+posx+50;var sy=parseInt(hy)+posy;var acomp=mf_main.componentList.invokeComponent("MF_Text","new",sx,sy);var szObject=new Object();szObject.width=parseInt(swidth);szObject.height=parseInt(sheight);acomp.e2xml.addPropObject("esize",szObject,"default");if(props["font-size"]){acomp.e2xml.addPropSingle("fontSize",props["font-size"].replace("px",""),"default");}acomp.e2xml.addPropSingle("text",$(element).text(),"default");acomp.render(true);}}}element.children().each(function(){thisClass.traverseDOM($(this));});};this.generateUICode=function(genui){try{var comps=new Array();$("#mfInvisibleGenUI").remove();var $invisibleDiv=$('<div id="mfInvisibleGenUI" style="position: absolute; top: -1000px; left: -1000px; display: block;"></div>').append(genui);$("body").append($invisibleDiv);thisClass.traverseDOM($invisibleDiv);$("#mfInvisibleGenUI").remove();mf_main.editorController.clearSelection(true);$(".mf_ai_tool_ui_container_cls").hide();$(".mf_ai_tool_ui_input").show();}catch(e){$("#mfInvisibleGenUI").remove();console.log(e);alert("Some error occurred in generating UI code. Try again.");$(".mf_ai_tool_ui_container_cls").hide();$(".mf_ai_tool_ui_input").show();}};this.generateColorListing=function(colors){try{var colorarr=JSON.parse(colors).colors;var arr=new Array();var htmldom="";var template=MF_Utils.getCompiledTemplate("mfGenColorItemTemplate");for(var j=0;j<colorarr.length;j++){var color=colorarr[j];var obj=new Object();obj.color=color;arr.push(obj);htmldom=htmldom+template(obj);}$("#mfAIColorGenResult").html(htmldom);thisClass.colorarr=colorarr;$(".mfCopyAIColorCls").off("click");$(".mfCopyAIColorCls").on("click",thisClass.copyAIColor);$(".mfAddAIColorCls").off("click");$(".mfAddAIColorCls").on("click",thisClass.applyAIColor);}catch(e){console.log(e);alert("Error occurred. Try again.");}};this.copyAIColor=function(e){MF_Utils.copyToClipBoard4($(this).attr("data-id"));MF_Utils.display_ActionIndicator("Selected color copied to clipboard");};this.applyAIColor=function(e){mf_main.editorController.favouriteColorController.addFavColorHandler($(this).attr("data-id"));MF_Utils.display_ActionIndicator("Added color to favorites in color picker");};this.exampleColorPrompts=function(e){var txt=$(this).text();$("#mfAIToolSourceColors").val(txt);thisClass.generateColors();};this.applyAddAllAIColors=function(e){for(var j=0;j<thisClass.colorarr.length;j++){var color=thisClass.colorarr[j];mf_main.editorController.favouriteColorController.addFavColorHandler(color);}MF_Utils.display_ActionIndicator("Added color to favorites in color picker");};this.showResults=function(data){if(data.aitype=="gentext"){$(".mf_ai_tool_txt_container_cls").hide();$(".mf_ai_tool_result").show();$("#mfAITextGenResult").text(data.data.generatedtext);}if(data.aitype=="genui"){thisClass.generateUICode(data.data.generatedui);}if(data.aitype=="genbyoc"){mf_main.editorController.aiManagerController.displayCode(data.data.generatedCode);}if(data.aitype=="downloadaiimage"){$(".mf_ai_tool_img_container_cls").hide();$(".mf_ai_tool_img_result").show();thisClass.downloadImage(data.data.bytearray);}if(data.aitype=="gentable"){$(".mf_ai_tool_table_container_cls").hide();$(".mf_ai_tool_table_result").show();thisClass.stable=data.data.generatedtext;var htable=thisClass.generateHTMLTable(data.data.generatedtext);$("#mfAITableGenResult").html(htable);}if(data.aitype=="gencolors"){$(".mf_ai_tool_color_container_cls").hide();$(".mf_ai_tool_color_result").show();thisClass.generateColorListing(data.data.generatedcolors);}if(data.aitype=="genimage"){$("#mfAIToolImageLink").html('<img style="" id="mfAIToolImageSrc" src="">');$(".mf_ai_tool_img_container_cls").hide();$(".mf_ai_tool_img_result").show();$("#mfAIToolImageLink").attr("href",data.data.generatedimage);$("#mfAIToolImageSrc").attr("src",data.data.generatedimage);}};this.generateHTMLTable=function(stable){try{var sourceJson=new Object();try{sourceJson=JSON.parse(stable);}catch(e){return"";}var html='<table border="1">';var headers=sourceJson.datagrid[0];html+="<thead><tr>";headers.forEach(function(header){html+="<th>"+header+"</th>";});html+="</tr></thead>";sourceJson.datagrid.slice(1).forEach(function(row){html+="<tr>";row.forEach(function(cell){html+="<td>"+cell+"</td>";});html+="</tr>";});html+="</table>";return html;}catch(e){return"";}};this.generateImage=function(){if(mf_main.editorController.aiManagerController.creditsImageAvailable==0){bootbox.alert("You have exhausted your AI image credits for "+mf_main.editorController.aiManagerController.creditsPeriod);return false;}var prompt=$("#mfAIToolImgPrompt").val().trim();if(prompt==""){alert("Prompt cannot be empty.");return;}mf_main.editorController.aiManagerController.creditsImageAvailable--;$(".mfAIToolInfoCredits").text(mf_main.editorController.aiManagerController.creditsImageAvailable+" / "+mf_main.editorController.aiManagerController.creditsImageTotal+" credits available for "+mf_main.editorController.aiManagerController.creditsPeriod);var obj=new Object();obj.prompt=prompt;obj.aistyle=$(".mf_ai_tool_imgstyle_active").attr("data-style");$("#mfAIToolImageLink").empty();mf_main.rtc.aiToolSync(obj,"genimage");$(".mf_ai_tool_img_container_cls").hide();$(".mf_ai_tool_img_loader").show();};this.generateText=function(){if(mf_main.editorController.aiManagerController.creditsTextAvailable==0){bootbox.alert("You have exhausted your AI text credits for "+mf_main.editorController.aiManagerController.creditsPeriod);return false;}var prompt=$("#mfAIToolSourceText").val().trim();if(prompt==""){alert("Prompt cannot be empty.");return;}mf_main.editorController.aiManagerController.creditsTextAvailable--;$(".mfAIToolInfoCredits").text(mf_main.editorController.aiManagerController.creditsTextAvailable+" / "+mf_main.editorController.aiManagerController.creditsTextTotal+" credits available for "+mf_main.editorController.aiManagerController.creditsPeriod);var obj=new Object();obj.prompt=prompt;obj.aitone=$("#mf_ai_selected_tone").attr("data-type");obj.textLength=parseInt($("#mf_gentext_rangeinput").val());mf_main.rtc.aiToolSync(obj,"gentext");$(".mf_ai_tool_txt_container_cls").hide();$(".mf_ai_tool_loader").show();};this.generateTable=function(){if(mf_main.editorController.aiManagerController.creditsTextAvailable==0){bootbox.alert("You have exhausted your AI text credits for "+mf_main.editorController.aiManagerController.creditsPeriod);return false;}var prompt=$("#mfAIToolSourceTable").val().trim();if(prompt==""){alert("Prompt cannot be empty.");return;}mf_main.editorController.aiManagerController.creditsTextAvailable--;$(".mfAIToolInfoCredits").text(mf_main.editorController.aiManagerController.creditsTextAvailable+" / "+mf_main.editorController.aiManagerController.creditsTextTotal+" credits available for "+mf_main.editorController.aiManagerController.creditsPeriod);var obj=new Object();obj.prompt=prompt;var snum=5;try{snum=parseInt($("#mfAITableRows").val());}catch(e){snum=5;}obj.rows=snum;mf_main.rtc.aiToolSync(obj,"gentable");$(".mf_ai_tool_table_container_cls").hide();$(".mf_ai_tool_table_loader").show();};this.generateColors=function(){if(mf_main.editorController.aiManagerController.creditsTextAvailable==0){bootbox.alert("You have exhausted your AI text credits for "+mf_main.editorController.aiManagerController.creditsPeriod);return false;}var prompt=$("#mfAIToolSourceColors").val().trim();if(prompt==""){alert("Prompt cannot be empty.");return;}mf_main.editorController.aiManagerController.creditsTextAvailable--;$(".mfAIToolInfoCredits").text(mf_main.editorController.aiManagerController.creditsTextAvailable+" / "+mf_main.editorController.aiManagerController.creditsTextTotal+" credits available for "+mf_main.editorController.aiManagerController.creditsPeriod);var obj=new Object();obj.prompt=prompt;mf_main.rtc.aiToolSync(obj,"gencolors");$(".mf_ai_tool_color_container_cls").hide();$(".mf_ai_tool_color_loader").show();};this.generateUI=function(){if(mf_main.editorController.aiManagerController.creditsTextAvailable==0){bootbox.alert("You have exhausted your AI text credits for "+mf_main.editorController.aiManagerController.creditsPeriod);return false;}var prompt=$("#mfAIToolSourceUI").val().trim();if(prompt==""){alert("Prompt cannot be empty.");return;}mf_main.editorController.aiManagerController.creditsTextAvailable--;$(".mfAIToolInfoCredits").text(mf_main.editorController.aiManagerController.creditsTextAvailable+" / "+mf_main.editorController.aiManagerController.creditsTextTotal+" credits available for "+mf_main.editorController.aiManagerController.creditsPeriod);var obj=new Object();obj.prompt=prompt;mf_main.rtc.aiToolSync(obj,"genui");$(".mf_ai_tool_ui_container_cls").hide();$(".mf_ai_tool_ui_loader").show();};this.openToolListHandler=function(){$(".mfAIToolSideBarCls").hide();$("#mfAIToolListing").show();};this.openToolHandler=function(){var tooltype=$(this).attr("data-id");if(tooltype=="generate_text"){thisClass.openAIText(true);}if(tooltype=="generate_image"){thisClass.openAIImage(true);}if(tooltype=="generate_table"){thisClass.openAITable(true);}if(tooltype=="generate_colors"){$(".mfAIToolInfoCredits").text(mf_main.editorController.aiManagerController.creditsTextAvailable+" / "+mf_main.editorController.aiManagerController.creditsTextTotal+" credits available for "+mf_main.editorController.aiManagerController.creditsPeriod);$(".mfAIToolSideBarCls").hide();$("#mfAIToolView").show();$(".mfAIToolViewContentType").hide();$("#mfAITool_generate_colors").show();}if(tooltype=="generate_table"){$(".mfAIToolSideBarCls").hide();$("#mfAIToolView").show();$(".mfAIToolViewContentType").hide();$("#mfAITool_generate_table").show();}if(tooltype=="generate_byoc"){mf_main.editorController.disableShortcuts();if(!mf_main.editorController.aiManagerController.BYOCGenerationInProgress){$("#mfBYOCAIFormScreen").show();$("#mfBYOCAILoadingScreen").hide();$("#mfBYOCAIPreviewScreen").hide();}$("#mfBYOCGenerateWithAIModal").modal();}if(tooltype=="generate_wizard"){mf_main.editorController.disableShortcuts();mf_main.editorController.openWizard();}if(tooltype=="generate_ui"){$(".mfAIToolSideBarCls").hide();$("#mfAIToolView").show();$(".mfAIToolViewContentType").hide();$("#mfAITool_generate_ui").show();}};}function MF_PowerupController(){var thisClass=this;this.POWERUP_LIBRARY="";this.initEventListeners=false;this.loadedPowerupsCollection=new ArrayCollection();this.installedPowerupsCollection=null;this.loadedPowerupsTopmenu=false;this.selectedPowerup=null;this.renderedForEditor=false;this.powerupPublicData=null;this.publicURLPowerupId="";this.publicURLPowerupData="";this.publicPowerupProcessInitialised=false;this.powerupsListed="none";this.selectedPinnedPowerupID=null;this.constructor=function(){$(".mfPowerupContainer").hide();if(mf_main.PUBLIC){$("#mfNavPowerupBtn").remove();$("#mfViewerNavPowerupBtn").remove();}if(mf_main.INTEGRATION){$("#mfNavPowerupBtn").remove();$("#mfViewerNavPowerupBtn").remove();$(".mfPowerupPopupBtn").remove();}if(mf_main.PUBLIC){$(".mfPowerupPopupBtn").remove();}$("#mfAddPowerupTopMenuBackBtn").click(thisClass.goBackImageHandler);$(document).on("mouseenter",".mfPowerupTooltip",function(){var $this=$(this);if(this.offsetWidth<this.scrollWidth&&!$this.attr("title")){$this.tooltip({placement:"bottom"});$this.attr("data-original-title",$this.text()).tooltip("show");}else{$this.tooltip("hide");}});};this.reInitPowerups=function(eventType){for(var i=0;i<thisClass.loadedPowerupsCollection.size();i++){var item=thisClass.loadedPowerupsCollection.getItemAt(i);item.init_flag=true;}};this.attachEvents=function(){if(!thisClass.initEventListeners){thisClass.initEventListeners=true;$("#mfPowerupStoreBtn, #mfAddPowerupTopMenuBtn").click(thisClass.openPowerupStoreFromEditor);$("#mfMorePowerupBtn").click(thisClass.openInstalledPowerupList);$("#mfPowerupSearchInput").keyup(thisClass.powerupSearchHandler);$("#mfPowerupSearchInputClear").click(thisClass.clearPowerupSearchHandler);}};this.goBackImageHandler=function(){$("#mfNavImagesBtn").click();};this.openPowerupStoreFromEditor=function(){mf_main.editorController.storeController.itemType="powerup";mf_main.editorController.storeController.lastOpenedTab="powerup";mf_main.editorController.storeController.currentScrollPosition=0;if(mf_main.editorController.storeController.searching){$("#mfSearchStoreInput").val("");$(".mfStoreResultList").empty();$("#mfStoreClearSearchBtn").hide();$(".mfStoreTypeTabWrapper, #mfStoreClearSearchBtn").removeClass("mfStoreActionDenied");mf_main.editorController.storeController.searching=false;}mf_main.editorController.storeController.openStore("powerup");};this.getLoadedPowerupRef=function(powerupid){for(var i=0;i<thisClass.loadedPowerupsCollection.size();i++){var item=thisClass.loadedPowerupsCollection.getItemAt(i);if(item.id==powerupid){return item.obj;}}return false;};this.getLoadedPowerupObj=function(powerupid){for(var i=0;i<thisClass.loadedPowerupsCollection.size();i++){var item=thisClass.loadedPowerupsCollection.getItemAt(i);if(item.id==powerupid){return item;}}return false;};this.getInstalledPowerupObj=function(powerupid){for(var i=0;i<thisClass.installedPowerupsCollection.size();i++){var item=thisClass.installedPowerupsCollection.getItemAt(i);if(item.id==powerupid){return item;}}return null;};this.openPowerupList=function(){if(mf_main.PUBLIC){return;}thisClass.attachEvents();if(thisClass.selectedPowerup==null){$(".mfPowerupContainer").hide();$("#mfPowerupListScreen").show();$("#mfPowerupSearchInput").focus();thisClass.getInstalledPowerups();}else{if(thisClass.loadedPowerupsTopmenu==false||thisClass.renderedForEditor!=mf_main.editorController.EDITOR){thisClass.applyInstalledPowerupsCarouselTemplate();thisClass.renderedForEditor=mf_main.editorController.EDITOR;}if(thisClass.selectedPowerup.mode=="all"||(mf_main.editorController.EDITOR&&thisClass.selectedPowerup.mode=="editor")||(!mf_main.editorController.EDITOR&&thisClass.selectedPowerup.mode=="review")){var powerupRef=thisClass.getLoadedPowerupRef(thisClass.selectedPowerup.id);var loadedPowerupObj=thisClass.getLoadedPowerupObj(thisClass.selectedPowerup.id);$(".mfPowerupContainer,.mfPowerupDataContainer").hide();$("#mfPowerupDataScreenWrapper").show();$("#mfPowerupDataScreen_"+thisClass.selectedPowerup.id).show();var powerupIndx=MF_Utils.searchObjArray(mf_main.editorController.projectObj.pinnedPowerups,"id",thisClass.selectedPowerup.id);$(".mfPowerupPinnedItem").removeClass("mfPowerupPinnedItemActive");if(powerupIndx!=-1){$('.mfPowerupPinnedItem[data-powerupid="'+thisClass.selectedPowerup.id+'"]').addClass("mfPowerupPinnedItemActive");}thisClass.resize();if(thisClass.selectedPowerup.source=="folder"){powerupRef.init();}else{if(thisClass.selectedPowerup.source=="url"){if(loadedPowerupObj.init_flag==true){loadedPowerupObj.init_flag=false;thisClass.sendCommunication("reinitialise",thisClass.selectedPowerup.id);}}}}else{$(".mfPowerupContainer").hide();$("#mfPowerupListScreen").show();$("#mfPowerupSearchInput").focus();thisClass.getInstalledPowerups();}}};this.loadPowerupModule=function(powerupid){if(typeof powerupid!="string"){powerupid=$(this).attr("data-powerupid");}var powerupIndx=MF_Utils.searchObjArray(mf_main.editorController.projectObj.pinnedPowerups,"id",powerupid);$(".mfPowerupPinnedItem").removeClass("mfPowerupPinnedItemActive");if(powerupIndx!=-1){$('.mfPowerupPinnedItem[data-powerupid="'+powerupid+'"]').addClass("mfPowerupPinnedItemActive");}thisClass.selectedPowerup=thisClass.getInstalledPowerupObj(powerupid);if(thisClass.selectedPowerup){if(thisClass.selectedPowerup.mode=="all"||(mf_main.editorController.EDITOR&&thisClass.selectedPowerup.mode=="editor")||(!mf_main.editorController.EDITOR&&thisClass.selectedPowerup.mode=="review")){thisClass.loadInstalledPowerupModule(powerupid);}}else{if(powerupid.includes("_preferencetest")||powerupid.includes("_surveytest")||powerupid.includes("_firstimpressiontest")||powerupid.includes("_clicktest")){powerupid=powerupid.split("_")[0];}MF_PowerupManager.getPowerupById(MF_UserSession.getUser(),powerupid,{callback:function(powerupObj){if(powerupObj){powerupObj.installationid=MF_Utils.guidGenerator();MF_PowerupManager.installPowerup(MF_UserSession.getUser(),powerupObj,{callback:function(status){if(status=="success"){thisClass.installedPowerupsCollection=null;thisClass.openPowerupList();}else{}}});}}});}};this.loadInstalledPowerupModule=function(powerupid){var powerupRef=thisClass.getLoadedPowerupRef(powerupid);$(".mfPowerupContainer,.mfPowerupDataContainer").hide();$("#mfPowerupDataScreenWrapper").show();if(!powerupRef&&thisClass.selectedPowerup!=null){var powerupslug=thisClass.selectedPowerup.slug;$("#mfPowerupDataScreen").hide();$("#mfPowerupDataScreenLoader").show();if(thisClass.selectedPowerup.source=="url"){var powerupDOM=$("<div></div>");powerupDOM.attr("id","mfPowerupDataScreen_"+powerupid);powerupDOM.addClass("mfPowerupDataContainer");powerupDOM.html('<iframe src="'+powerupslug+'" name="mfPowerupDataScreen_'+powerupid+'" width="250" class="mfPowerupIframe" allow="camera https://wireframepro.mockflow.com; microphone https://wireframepro.mockflow.com"></iframe>');$("#mfPowerupDataScreen").append(powerupDOM);$("#mfPowerupDataScreen_"+powerupid).find("iframe").on("load",function(){$("#mfPowerupDataScreenLoader").hide();$("#mfPowerupDataScreen").show();if(!mf_main.PINPOWERUP&&!mf_main.PUBLIC){$("#mfPowerupPublicLoader").hide();}});$("#mfPowerupDataScreen_"+powerupid).show();thisClass.resize();var classname="MF_Powerup_"+powerupslug;var powerupObj={};var tmpLoadedPowerup={id:powerupid,obj:powerupObj,init_flag:false};thisClass.loadedPowerupsCollection.addItem(tmpLoadedPowerup);}}else{if(powerupRef&&thisClass.selectedPowerup!=null){$("#mfPowerupDataScreen_"+thisClass.selectedPowerup.id).show();thisClass.resize();if(thisClass.selectedPowerup.source=="folder"){powerupRef.init();}else{if(thisClass.selectedPowerup.source=="url"){thisClass.sendCommunication("reinitialise",thisClass.selectedPowerup.id);}}}else{if(MF_UserSession.getUser()&&!MF_UserSession.getUser().offlineMode){if(powerupid!="D6b672969bd41e0b203af9f2726f61ae0"&&powerupid!="D1d53f643d8d753cf28568c9929d7a03d"&&powerupid!="Dfc48ce023dd5df731be65215764b2093"){if(MF_UserSession.getUser().isBasic||(MF_UserSession.getUser().wireframing&&powerupid!="D25391f242a0654082abf49c8d0c7d908"&&powerupid!="D4073780418f47f01cdfff9cf319a0913")){var wireframePlanMsg="";if(MF_UserSession.getUser().wireframing){wireframePlanMsg=", AI Text";}bootbox.confirm("This powerup is not permitted for your MockFlow plan. Only Stepguide, CJM"+wireframePlanMsg+" and Bootstrap Builder powerups are available. Upgrade now?",function(ansu){if(ansu){mf_main.openUpgradeDialog();}else{}});return;}else{alert("Powerup is not installed, Please install this powerup and access it.");window.close();return;}}}}}};this.getInstalledPowerups=function(){if(thisClass.installedPowerupsCollection==null){thisClass.installedPowerupsCollection=new ArrayCollection();$("#mfPowerupListScreenLoader").show();$("#mfPowerupListScreen").hide();var newPinnedPowerups=new Array();MF_PowerupManager.listInstalledPowerups(MF_UserSession.getUser(),mf_main.editorController.projectObj.id,{callback:function(powerupList){if(powerupList!=null){for(var i=0;i<powerupList.length;i++){var nitem=new MF_Powerup();nitem.cast(powerupList[i]);thisClass.installedPowerupsCollection.addItem(nitem);for(var k=0;k<mf_main.editorController.projectObj.pinnedPowerups.length;k++){var pinned=mf_main.editorController.projectObj.pinnedPowerups[k];if(pinned.id==nitem.id){pinned.name=nitem.name;pinned.iconURL=nitem.iconURL;pinned.mode=nitem.mode;pinned.isPublic=nitem.isPublic;newPinnedPowerups.push(pinned);break;}}}var newarr=new Array();for(var j=0;j<mf_main.editorController.projectObj.pinnedPowerups.length;j++){var pinned=mf_main.editorController.projectObj.pinnedPowerups[j];for(var g=0;g<newPinnedPowerups.length;g++){var pinnedObj=newPinnedPowerups[g];if(pinned.id==pinnedObj.id){newarr.push(pinnedObj);break;}}}mf_main.editorController.projectObj.pinnedPowerups=newarr;thisClass.applyInstalledPowerupsTemplate();thisClass.applyPinnedPowerupsTemplate();if(mf_main.OPEN_POWERUPID){thisClass.openPowerupbyID(mf_main.OPEN_POWERUPID);mf_main.OPEN_POWERUPID=null;}}else{MF_Utils.display_ActionIndicator("Error: Could not fetch installed powerups");}}});}else{if(thisClass.powerupsListed){if(thisClass.selectedPinnedPowerupID){thisClass.loadPowerupModule(thisClass.selectedPinnedPowerupID);}}else{thisClass.applyInstalledPowerupsTemplate();}}};this.openPowerupbyID=function(id){if(!thisClass.canAccessPowerup(id)){return;}thisClass.selectedPowerup=null;var powerupObj=mf_main.editorController.powerupController.getInstalledPowerupObj(id);if(powerupObj){mf_main.editorController.powerupController.selectedPinnedPowerupID=id;if(mf_main.editorController.EDITOR){$("#mfNavPowerupBtn").click();}else{if(mf_main.editorController.VIEWER){$("#mfViewerNavPowerupBtn").click();}}}else{if(mf_main.editorController.powerupStoreController.listedAllPowerups){mf_main.editorController.powerupStoreController.installPowerup(null,id);}else{mf_main.editorController.powerupStoreController.powerupStoreCollection=new ArrayCollection();MF_PowerupManager.getPowerupById(MF_UserSession.getUser(),id,{callback:function(powerupObj){if(powerupObj){var nitem=new MF_Powerup();nitem.cast(powerupObj);mf_main.editorController.powerupStoreController.powerupStoreCollection.addItem(nitem);mf_main.editorController.powerupStoreController.installPowerup(null,powerupObj.id);}}});}}};this.canAccessPowerup=function(id){if(MF_UserSession.getUser()&&!MF_UserSession.allowAllPowerups()&&id!="Dfc48ce023dd5df731be65215764b2093"&&!(MF_UserSession.getUser().wireframing&&(id=="D25391f242a0654082abf49c8d0c7d908"||id=="D4073780418f47f01cdfff9cf319a0913"))){bootbox.confirm("This addon is not available for your MockFlow plan. To install, upgrade your account.<br/><br/>Want to learn more about this addon?",function(ans){if(ans){mf_main.editorController.powerupStoreController.viewPowerupId=id;mf_main.editorController.storeController.openStore("powerup");}});return false;}else{return true;}};this.applyInstalledPowerupsTemplate=function(){var cachedTemplate=mf_main.getTemplateFromCache("mfPowerupInstalledTemplate");if(cachedTemplate==null){$.get("templates/editor/PowerupInstalledItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfPowerupInstalledTemplate").html());mf_main.addTemplateToCache("mfPowerupInstalledTemplate",template);thisClass.renderPowerupInstalledItem(template);});}else{thisClass.renderPowerupInstalledItem(cachedTemplate);}};this.renderPowerupInstalledItem=function(template){var htmldom="";for(var i=0;i<thisClass.installedPowerupsCollection.size();i++){var nitem=thisClass.installedPowerupsCollection.getItemAt(i);if(nitem.mode=="all"||(mf_main.editorController.EDITOR&&nitem.mode=="editor")||(!mf_main.editorController.EDITOR&&nitem.mode=="review")){htmldom=htmldom+template(nitem);}}if(htmldom==""){htmldom="<div class='mfCenterAlign' id='mfPowerupPlaceholder'><img src='images/powerup/addPowerup.png' />Power-ups provide additional features and integrations to your UI design</div>";}$("#mfPowerupList").html(htmldom);$(".mfPowerupItemUninstall").off("click");$(".mfPowerupItemUninstall").on("click",mf_main.editorController.powerupStoreController.uninstallPowerup);$(".mfPowerupItem").off("click");$(".mfPowerupItem").on("click",thisClass.loadPowerupModule);$("#mfPowerupPlaceholder").click(thisClass.openPowerupStoreFromEditor);$(".mfPowerupItemPin").off("click");$(".mfPowerupItemPin").on("click",thisClass.pinPowerupToSidebar);if(thisClass.loadedPowerupsTopmenu==false||thisClass.renderedForEditor!=mf_main.editorController.EDITOR){thisClass.applyInstalledPowerupsCarouselTemplate();thisClass.renderedForEditor=mf_main.editorController.EDITOR;}if($("#mfPowerupList").hasClass("ui-sortable")){$("#mfPowerupList").sortable("destroy");}if(mf_main.editorController.EDITOR){$("#mfPowerupList").sortable({placeholder:"mfPowerupSortPowerupListPlaceholder",helper:"clone",sort:function(){$(this).addClass("mfPowerupItemOnDrag");},update:function(event,ui){thisClass.sortPowerupHandler();},stop:function(){$(this).removeClass("mfPowerupItemOnDrag");}});}$("#mfPowerupListScreen").show();$("#mfPowerupListScreenLoader").hide();$("#mfPowerupSearchInput").focus();$("#mfPowerupSearchInput").val("");thisClass.powerupSearchHandler();thisClass.resize();thisClass.powerupsListed=true;if(thisClass.selectedPinnedPowerupID){thisClass.loadPowerupModule(thisClass.selectedPinnedPowerupID);}};this.applyInstalledPowerupsCarouselTemplate=function(){var cachedTemplate=mf_main.getTemplateFromCache("mfPowerupInstalledTopmenuTemplate");if(cachedTemplate==null){$.get("templates/editor/PowerupInstalledCarouselItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfPowerupInstalledTopmenuTemplate").html());mf_main.addTemplateToCache("mfPowerupInstalledTopmenuTemplate",template);thisClass.renderPowerupInstalledCarouselItem(template);});}else{thisClass.renderPowerupInstalledCarouselItem(cachedTemplate);}};this.renderPowerupInstalledCarouselItem=function(template){var htmldom="";var listedPowerupsCount=0;for(var i=0;i<thisClass.installedPowerupsCollection.size();i++){var nitem=thisClass.installedPowerupsCollection.getItemAt(i);if(nitem.mode=="all"||(mf_main.editorController.EDITOR&&nitem.mode=="editor")||(!mf_main.editorController.EDITOR&&nitem.mode=="review")){htmldom=htmldom+template(nitem);listedPowerupsCount++;}}var addPowerupleft=(listedPowerupsCount*40);$("#mfInstalledPowerupTopMenu").html(htmldom);$("#mfPowerupTopMenu .mfPowerup-Topmenu-item").each(function(i){left=$(this).width()*i;$(this).css({left:left});});$(".mfPowerupItem").off("click");$(".mfPowerupItem").on("click",thisClass.powerupListClickHandler);thisClass.loadedPowerupsTopmenu=true;};thisClass.powerupListClickHandler=function(){var powerupId=$(this).attr("data-powerupid");thisClass.loadPowerupModule(powerupId);};this.openInstalledPowerupList=function(){thisClass.selectedPinnedPowerupID=null;$(".mfPowerupContainer").hide();$("#mfPowerupListScreen").show();$("#mfPowerupSearchInput").focus();thisClass.selectedPinnedPowerupID=null;$(".mfPowerupPinnedItem").removeClass("mfPowerupPinnedItemActive");thisClass.getInstalledPowerups();thisClass.resize();};this.resize=function(){if($("#mfPowerupListScreen").css("display")=="block"){$("#mfPowerupList").height($("#mfContentPowerup").height()-$("#mfPowerupStoreBtn").height()-$("#mfPowerupSearchWrapper").height()-20-40-30);}if($("#mfPowerupDataScreenWrapper").css("display")=="block"){$("#mfPowerupDataScreen").height($("#mfContentPowerup").height()-100);$(".mfPowerupIframe").height($("#mfPowerupDataScreen").height()-6);}if($("#mfPowerupInterfaceModal").css("display")=="block"){$("#mfPowerupInterfaceIframe,#mfPowerupInterfaceIframeLoader").height($("#mfPowerupInterfaceModal").height()-$("#mfPowerupInterfaceModal .modal-header").height()-30);}};this.RTCRefreshPowerup=function(powerupId,data){var powerupRef=thisClass.getLoadedPowerupRef(powerupId);if(powerupRef&&typeof powerupRef.refresh==="function"){powerupRef.refresh();}else{if(powerupRef){thisClass.sendCommunication("refresh",powerupId,data);}}};this.sortPowerupHandler=function(){if(mf_main.editorController.EDITOR){var powerupList=thisClass.installedPowerupsCollection;var newPowerupList=new ArrayCollection();var sortorder=1;$("#mfPowerupList .mfPowerupItem").each(function(){for(var i=0;i<powerupList.size();i++){var nitem=powerupList.getItemAt(i);if(nitem.id==$(this).attr("data-powerupid")){nitem.sortorder=sortorder;newPowerupList.addItem(nitem);}}sortorder++;});thisClass.installedPowerupsCollection=newPowerupList;thisClass.loadedPowerupsTopmenu=false;thisClass.applyInstalledPowerupsCarouselTemplate();thisClass.renderedForEditor=mf_main.editorController.EDITOR;MF_PowerupManager.updatePowerupSortorder(MF_UserSession.getUser(),newPowerupList.toArray(),mf_main.editorController.projectObj.id,{callback:function(data){}});}};this.sendCommunication=function(eventName,powerupId,data){if(typeof data=="undefined"){data={};}var response={};if(eventName=="reinitialise"){response={method:"reinitialise"};}else{if(eventName=="refresh"){response={method:"refresh",data:data};}}var iframeSelection=$("#mfPowerupDataScreen_"+powerupId+" iframe");if(iframeSelection.length==1){iframeSelection[0].contentWindow.postMessage(response,"*");}};this.powerupSearchHandler=function(){var searchTerm=$("#mfPowerupSearchInput").val().trim().toLowerCase();if(searchTerm.length==0){$("#mfPowerupList .mfPowerupItem").show();if(mf_main.editorController.EDITOR){$("#mfPowerupList").sortable("enable");}$("#mfPowerupSearchInputClear").hide();}else{$("#mfPowerupList .mfPowerupItem").each(function(){if($(this).attr("data-powerup-name").toLowerCase().indexOf(searchTerm)>=0){$(this).show();}else{$(this).hide();}});if(mf_main.editorController.EDITOR){$("#mfPowerupList").sortable("disable");}$("#mfPowerupSearchInputClear").show();}};this.clearPowerupSearchHandler=function(){$("#mfPowerupSearchInput").val("");thisClass.powerupSearchHandler();$("#mfPowerupSearchInput").focus();};this.getPublicPowerupDetails=function(){thisClass.publicPowerupProcessInitialised=true;if(mf_main.PUBLIC&&thisClass.installedPowerupsCollection==null){thisClass.installedPowerupsCollection=new ArrayCollection();$("#mfPowerupListScreenLoader").show();$("#mfPowerupListScreen").hide();MF_PowerupManager.getPublicPowerupDetails(thisClass.publicURLPowerupId,{callback:function(powerupObj){if(powerupObj!=null){var nitem=new MF_Powerup();nitem.cast(powerupObj);thisClass.installedPowerupsCollection.addItem(nitem);thisClass.powerupPublicData=thisClass.publicURLPowerupData;thisClass.loadPublicPowerup(thisClass.publicURLPowerupId);}else{MF_Utils.display_ActionIndicator("Error: Could not fetch powerup");}}});}};this.loadPublicPowerup=function(powerupid){mf_main.editorController.resetNavBar();mf_main.editorController.resetViewNavBar();$("#mfPowerupListScreenLoader").hide();$("#mfContentPowerup").show();thisClass.loadPowerupModule(powerupid);};this.pinPowerupToSidebar=function(e){$(this).find(".mfIcon").tooltip("hide");if(mf_main.PERMISSION!="Owner"&&mf_main.PERMISSION!="Admin"){return;}e.stopPropagation();var powerupId=$(this).attr("data-powerupid");var powerupData=thisClass.getInstalledPowerupObj(powerupId);var pinnedPowerups=mf_main.editorController.projectObj.pinnedPowerups;var powerupIndx=MF_Utils.searchObjArray(pinnedPowerups,"id",powerupId);if(powerupIndx==-1&&pinnedPowerups.length==3){MF_Utils.display_ActionIndicator("Limit reached. To add new, remove existing powerups from sidebar.");}else{if(powerupIndx==-1&&pinnedPowerups.length<3){$(this).find(".mfIcon").attr("data-original-title","Remove Powerup from sidebar");$(this).find(".mfIcon").mouseover();$(this).addClass("mfPowerupItemPinInstalled");$(this).find(".mfIcon").removeClass("fa-heart-o").addClass("fa-heart");var pinItem=new MF_PinnedPowerup();pinItem.id=powerupData.id;pinItem.name=powerupData.name;pinItem.iconURL=powerupData.iconURL;pinItem.mode=powerupData.mode;pinItem.isPublic=powerupData.isPublic;if(pinnedPowerups!=null&&pinnedPowerups.length>0){pinItem.sort=pinnedPowerups.length;}else{pinItem.sort=0;}mf_main.editorController.projectObj.pinnedPowerups.push(pinItem);var cachedTemplate=mf_main.getTemplateFromCache("mfPowerupPinnedTemplate");if(cachedTemplate!=null){$("#mfPowerupPinnedItemList").append(cachedTemplate(pinItem));thisClass.pinPowerupEvents();}MF_ChangeManager.CHANGED(true);}else{$(this).find(".mfIcon").attr("data-original-title","Add Powerup to sidebar");$(this).find(".mfIcon").mouseover();$(this).removeClass("mfPowerupItemPinInstalled");$(this).find(".mfIcon").removeClass("fa-heart").addClass("fa-heart-o");mf_main.editorController.projectObj.pinnedPowerups.splice(powerupIndx,1);$("#mfPowerupPinnedItemID_"+powerupId).remove();MF_ChangeManager.CHANGED(true);}}mf_main.rtc.sidebarPowerupSync("syncpowerupsidebar",mf_main.editorController.projectObj.pinnedPowerups);};this.getPinnedPowerupXML=function(){try{var pinnedPowerupXML="<pinned-powerups>";var pinnedPowerupArr=mf_main.editorController.projectObj.pinnedPowerups;for(var i=0;i<pinnedPowerupArr.length;i++){pinnedPowerupXML+='<powerup id="'+pinnedPowerupArr[i].id+'" sort="'+pinnedPowerupArr[i].sort+'"></powerup>';}pinnedPowerupXML+="</pinned-powerups>";return pinnedPowerupXML;}catch(e){return"";}};this.applyPinnedPowerupsTemplate=function(){if(mf_main.editorController.projectObj&&!mf_main.INTEGRATION){var cachedTemplate=mf_main.getTemplateFromCache("mfPowerupPinnedTemplate");if(cachedTemplate==null){$.get("templates/editor/PowerupPinnedItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfPowerupPinnedTemplate").html());mf_main.addTemplateToCache("mfPowerupPinnedTemplate",template);thisClass.renderPowerupPinnedItem(template);});}else{thisClass.renderPowerupPinnedItem(cachedTemplate);}}};this.renderPowerupPinnedItem=function(template){$("#mfPowerupPinnedItemList").empty();var htmldom="";var arr=mf_main.editorController.projectObj.pinnedPowerups;for(var i=0;i<arr.length;i++){var nitem=arr[i];if(nitem.mode=="all"||(mf_main.editorController.EDITOR&&nitem.mode=="editor")||(!mf_main.editorController.EDITOR&&nitem.mode=="review")){htmldom=htmldom+template(nitem);}}$("#mfPowerupPinnedItemList").html(htmldom);thisClass.pinPowerupEvents();};this.pinPowerupEvents=function(){$(".mfPowerupPinnedItem").off("click",thisClass.openPinnedPowerup);$(".mfPowerupPinnedItem").on("click",thisClass.openPinnedPowerup);if(mf_main.PERMISSION=="Owner"||mf_main.PERMISSION=="Admin"){if($("#mfPowerupPinnedItemList").hasClass("ui-sortable")){$("#mfPowerupPinnedItemList").sortable("destroy");}$("#mfPowerupPinnedItemList").sortable({containment:"#mfPowerupPinnedItemList",tolerance:"pointer",helper:"clone",sort:function(){$(this).addClass("mfPowerupItemOnDrag");},axis:"y",update:function(event,ui){thisClass.sortPowerupPinnedHandler();},stop:function(){$(this).removeClass("mfPowerupItemOnDrag");}});}};this.openPinnedPowerup=function(e){thisClass.selectedPinnedPowerupID=$(this).attr("data-powerupid");if(thisClass.selectedPowerup&&(thisClass.selectedPowerup.id!=thisClass.selectedPinnedPowerupID)){thisClass.selectedPowerup=null;}if(mf_main.editorController.EDITOR){mf_main.editorController.openNavBarContent("mfNavPowerupBtn");}else{if(mf_main.editorController.VIEWER){mf_main.editorController.openNavBarContent("mfViewerNavPowerupBtn");}}};this.openSpacePowerupHandler=function(refId){if(mf_main.isPowerupEditorCreate&&thisClass.selectedPinnedPowerupID){if(mf_main.editorController.EDITOR){mf_main.editorController.openNavBarContent("mfNavPowerupBtn");}else{if(mf_main.editorController.VIEWER){mf_main.editorController.openNavBarContent("mfViewerNavPowerupBtn");}}}else{MF_PowerupManager.getPowerupIDfromRef(MF_UserSession.getUser(),refId,{callback:function(pid){thisClass.selectedPinnedPowerupID=pid;if(mf_main.editorController.EDITOR){mf_main.editorController.openNavBarContent("mfNavPowerupBtn");}else{if(mf_main.editorController.VIEWER){mf_main.editorController.openNavBarContent("mfViewerNavPowerupBtn");}}}});}};this.sortPowerupPinnedHandler=function(){var powerupList=mf_main.editorController.projectObj.pinnedPowerups;var newPowerupList=new Array();var sortorder=1;$("#mfPowerupPinnedItemList .mfPowerupPinnedItem").each(function(){for(var i=0;i<powerupList.length;i++){var nitem=powerupList[i];if(nitem.id==$(this).attr("data-powerupid")){nitem.sortorder=sortorder;newPowerupList.push(nitem);}}sortorder++;});mf_main.editorController.projectObj.pinnedPowerups=newPowerupList;mf_main.rtc.sidebarPowerupSync("syncpowerupsidebar",mf_main.editorController.projectObj.pinnedPowerups);MF_ChangeManager.CHANGED(true);};this.updatePowerupPinHandler=function(powerupId){if(powerupId&&mf_main.editorController.powerupController.selectedPowerup){if(powerupId==mf_main.editorController.powerupController.selectedPowerup.id){thisClass.sendCommunication("refresh",powerupId);}}};this.refreshSpaceHandler=function(powerupId){var rtcObj=new MF_DashboardRTCItem();rtcObj.collaborators=thisClass.getRTCCollaboratorList();rtcObj.powerupId=powerupId;rtcObj.clientId=mf_main.editorController.projectObj.company;mf_main.dashboardRtcController.uninstallPowerupSync("uninstall_powerup",rtcObj);};this.getRTCCollaboratorList=function(){var userList=new Array();if(mf_main.editorController.projectObj.collaborators){for(var i=0;i<mf_main.editorController.projectObj.collaborators.length;i++){userList.push(mf_main.editorController.projectObj.collaborators[i].userid);}}return userList;};this.updateProjectPublicLinkAccess=function(project){if(project){if(Array.isArray(project)){for(var i=0;i<project.length;i++){if(project[i].id==mf_main.editorController.projectObj.id){if(mf_main.editorController.projectObj.share!=project[i].share){mf_main.editorController.projectObj.share=project[i].share;if(mf_main.editorController.powerupController.selectedPowerup){thisClass.updatePowerupPinHandler(mf_main.editorController.powerupController.selectedPowerup.id);}}}}}else{if(project.id==mf_main.editorController.projectObj.id){if(mf_main.editorController.projectObj.share!=project.share){mf_main.editorController.projectObj.share=project.share;if(mf_main.editorController.powerupController.selectedPowerup){thisClass.updatePowerupPinHandler(mf_main.editorController.powerupController.selectedPowerup.id);}}}}}};}function MF_PowerupStoreController(){var thisClass=this;this.powerupStoreCollection=null;this.powerupStoreDiscoverCollection=null;this.uploadFilesCount=0;this.screenshotSortOrder=0;this.powerupOnEdit=null;this.powerupScreenshotsCollection={};this.listedAllPowerups=false;this.deprecatedPowerups=["D5b41eb5ca4bb1933527ed8d4b05518bf","D74c78a4ed61c7a1d380665be4a2eb4b4","D1d0038a5ebb6b8ae55b284449eb1794c"];this.viewPowerupId=null;this.constructor=function(){if(MF_Global.adminAllow()){$("#mfStoreAddPowerupBtn").css({display:"inline-block"});$("#mfStoreAddPowerupBtn").off("click");$("#mfStoreAddPowerupBtn").on("click",thisClass.addPowerupItem);$("#mfAddPowerupSubmitBtn").click(thisClass.handleAddPowerupSubmit);$("#mfPowerupPageEditButton").click(thisClass.openEditPowerup);$("#mfPowerupPageDeleteButton").click(thisClass.deletePowerupHandler);$("#mfCloseAddPowerupItem").click(thisClass.closePowerupItem);$("#mfPowerupPageSortScreenshotButton").click(thisClass.openSortScreenshot);$("#mfCloseSortScreenshotBtn").click(thisClass.closePowerupItem);}else{$(".mfPowerupAdminContent").remove();}$("#mfPowerupPreviewBackBtn").click(thisClass.closePowerupItem);if(mf_main.PERMISSION=="Reviewer"){$(".mfStoreRemoveForReviewer").hide();}$(".mfPowerupScreenshots-slider-frame").on("scroll",thisClass.checkPowerupScreenshotsCarouselArrows);};this.loadCategory=function(cat){$(".mfPowerupStoreItem").hide();$("#mfStoreTemplateWrapper, #mfStoreDiscoverWrapper, #mfStoreSearchWrapper").scrollTop(0);if(cat=="all"){$(".mfPowerupStoreItem").show();return;}for(var i=0;i<thisClass.powerupStoreCollection.size();i++){var nitem=thisClass.powerupStoreCollection.getItemAt(i);if(nitem.category.includes(cat)){$("#mfPowerupItem"+nitem.id).show();}}};this.getPowerupObj=function(powerupid){if(thisClass.powerupStoreCollection!=null){for(var i=0;i<thisClass.powerupStoreCollection.size();i++){var item=thisClass.powerupStoreCollection.getItemAt(i);if(item.id==powerupid){return item;}}}if(thisClass.powerupStoreDiscoverCollection!=null){for(var i=0;i<thisClass.powerupStoreDiscoverCollection.size();i++){var item=thisClass.powerupStoreDiscoverCollection.getItemAt(i);if(item.id==powerupid){return item;}}}return null;};this.openPowerupStore=function(){if($("#mfStoreInterface").css("display")=="none"){mf_main.editorController.storeController.openStore("powerup");}if(!mf_main.editorController.storeController.searching){$("#mfTypeUiPack").prop("checked",false);$("#mfTypeTemplate").prop("checked",false);$("#mfTypeAll").prop("checked",false);$("#mfTypePowerUp").prop("checked",true);}if(mf_main.editorController.storeController.itemType=="powerup"){$(".mfStorePowerUpBackdrop, #mfStoreTemplateWrapper").show();$("#mfStoreTemplateWrapper").scrollTop(0);$("#mfStoreFiltersDropdown").hide();$("#mfStorePowerupViewer").hide();$("#mfStoreAddPowerupBtn").css({display:"inline-block"});}mf_main.editorController.storeController.resize();$(".mfStoreMain").hide();$("#mfStoreTemplateListingLoader").show();thisClass.fetchPowerupData();$("#mfStoreTemplateWrapper, #mfStoreDiscoverWrapper, #mfStoreSearchWrapper").scrollTop(0);};this.fetchPowerupData=function(){if(thisClass.listedAllPowerups==false){MF_PowerupManager.listAllPowerups(MF_UserSession.getUser(),null,{callback:function(powerupList){if(powerupList!=null){thisClass.powerupStoreCollection=new ArrayCollection();for(var i=0;i<powerupList.length;i++){var nitem=new MF_Powerup();nitem.cast(powerupList[i]);thisClass.powerupStoreCollection.addItem(nitem);}thisClass.listedAllPowerups=true;thisClass.applyPowerupStoreTemplate();}else{MF_Utils.display_ActionIndicator("Error: Could not fetch powerups");}}});if(mf_main.editorController.powerupController.installedPowerupsCollection==null){mf_main.editorController.powerupController.getInstalledPowerups();}}else{if(mf_main.editorController.storeController.itemType=="powerup"&&!mf_main.editorController.storeController.searching){$(".mfStoreMain").hide();$("#mfStoreTemplateWrapper").show();}thisClass.applyPowerupStoreTemplate();}if(mf_main.editorController.storeController.searching==true){mf_main.editorController.storeController.showStoreSearchItems();mf_main.editorController.storeController.showStoreSearchSections();}};this.addPowerupItem=function(){$(".mfStoreMain").hide();$("#mfStoreAddPowerup").show();thisClass.powerupOnEdit=null;$("#mfNewPowerupName").val("");$("#mfNewPowerupSource").val("url");$("#mfNewPowerupPath").val("");$("#mfNewPowerupShortDescription").val("");$("#mfNewPowerupDetails").val("");$("#mfNewPowerupCategory").val("Analytics & Reporting");$("#mfNewPowerupMode").val("all");$("#mfNewPowerupIconFile").attr({value:""});$("#mfNewPowerupThumbnailFile").attr({value:""});$("#mfNewPowerupScreenshots").attr({value:""});mf_main.editorController.disableShortcuts();mf_main.editorController.storeController.resize();};this.openEditPowerup=function(){$(".mfStoreMain").hide();$("#mfStoreAddPowerup").show();var editPowerupId=$(this).attr("data-powerupid");thisClass.powerupOnEdit=thisClass.getPowerupObj(editPowerupId);$("#mfNewPowerupName").val(thisClass.powerupOnEdit.name);$("#mfNewPowerupSource").val(thisClass.powerupOnEdit.source);$("#mfNewPowerupPath").val(thisClass.powerupOnEdit.slug);$("#mfNewPowerupShortDescription").val(thisClass.powerupOnEdit.description);$("#mfNewPowerupDetails").val(thisClass.powerupOnEdit.detailsMarkdown);$("#mfNewPowerupCategory").val(thisClass.powerupOnEdit.category);$("#mfNewPowerupMode").val(thisClass.powerupOnEdit.mode);$("#mfNewPowerupIsPublic").prop("checked",false);if(thisClass.powerupOnEdit.isPublic){$("#mfNewPowerupIsPublic").prop("checked",true);}$("#mfNewPowerupIconFile").attr({value:""});$("#mfNewPowerupThumbnailFile").attr({value:""});$("#mfNewPowerupScreenshots").attr({value:""});mf_main.editorController.disableShortcuts();mf_main.editorController.storeController.resize();};this.deletePowerupHandler=function(){if(MF_Global.adminAllow()){var editPowerupId=$(this).attr("data-powerupid");var powerupObj=thisClass.getPowerupObj(editPowerupId);if(powerupObj){bootbox.confirm("Are you sure you want to delete the powerup '"+Handlebars.Utils.escapeExpression(powerupObj.name)+"'",function(answer){if(answer){MF_PowerupManager.deletePowerup(MF_UserSession.getUser(),powerupObj,{callback:function(status){if(status=="success"){MF_Utils.display_ActionIndicator("Powerup deleted successfully");thisClass.closePowerupItem();if(mf_main.editorController.storeController.searching){$(".mfStoreMain").hide();$("#mfStoreSearchWrapper").show();}else{if(mf_main.editorController.storeController.itemType=="all"){$(".mfStoreMain").hide();$("#mfStoreDiscoverWrapper").show();}else{if(mf_main.editorController.storeController.itemType=="powerup"){$(".mfStoreMain, .mfStoreBackDrop").hide();$("#mfStoreTemplateWrapper, #mfPowerupStoreContainer, .mfStorePowerUpBackdrop").show();}}}}else{MF_Utils.display_ActionIndicator("Error in deleting powerup");}}});}});}}};this.applyPowerupStoreTemplate=function(){var cachedTemplate=mf_main.getTemplateFromCache("mfPowerupStoreItemTemplate");if(cachedTemplate==null){$.get("templates/editor/PowerupStoreItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfPowerupStoreItemTemplate").html());mf_main.addTemplateToCache("mfPowerupStoreItemTemplate",template);thisClass.renderPowerupStoreItem(template);});}else{thisClass.renderPowerupStoreItem(cachedTemplate);}};this.applyOtherPowerupStoreTemplate=function(){var cachedTemplate=mf_main.getTemplateFromCache("mfLatestPowerupItemTemplate");if(cachedTemplate==null){$.get("templates/editor/LatestPowerupItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfLatestPowerupItemTemplate").html());mf_main.addTemplateToCache("mfLatestPowerupItemTemplate",template);thisClass.renderPowerupStoreItem(template);});}else{thisClass.renderPowerupStoreItem(cachedTemplate);}};this.renderPowerupStoreItem=function(template){var htmldom="";var renderedItems=0;var storeSearchText=$("#mfSearchStoreInput").val().trim().toLowerCase();var storeCollection=null;if(thisClass.powerupStoreCollection!=null){storeCollection=thisClass.powerupStoreCollection;}else{if(thisClass.powerupStoreDiscoverCollection!=null){storeCollection=thisClass.powerupStoreDiscoverCollection;}}if(storeCollection!=null){for(var i=0;i<storeCollection.size();i++){var nitem=storeCollection.getItemAt(i);if(!thisClass.deprecatedPowerups.includes(nitem.id)){if($("#mfStorePowerupViewer").css("display")!="block"||(nitem.id!=$("#mfPowerupPageButton").attr("data-powerupid")&&renderedItems<4)){if($("#mfStorePowerupViewer").css("display")!="block"&&mf_main.editorController.storeController.searching){if(nitem.name.toLowerCase().includes(storeSearchText)){htmldom=htmldom+template(nitem);renderedItems++;}}else{htmldom=htmldom+template(nitem);renderedItems++;}}}}}if($("#mfStorePowerupViewer").css("display")=="block"){$("#mfOtherPowerupsList").html(htmldom);}else{if(mf_main.editorController.storeController.searching){$(".mfPowerupSearchList").empty();$(".mfPowerupSearchList").append(htmldom);if(htmldom==""){$(".mfPowerupSearchList").html("<span class='mfPowerupSearchNoResult'>No Results</span>");$(".mfPowerupSearchList").css("padding-left","0");}mf_main.editorController.storeController.showStoreSearchSections();}else{if($("#mfPowerupStoreContainer .mfPowerupStoreItem").length==0){$("#mfPowerupStoreContainer").html(htmldom);}$(".mfStoreMain, .mfStoreBackDrop").hide();$("#mfPowerupStoreContainer, .mfStorePowerUpBackdrop").show();$("#mfStoreTemplateWrapper").show();$("#mfStoreTemplateWrapper").scrollTop(0);}}mf_main.editorController.storeController.resize();$(".mfPowerupStoreItemInstall, .mfPowerupIconInstallBtn.install").off("click");$(".mfPowerupStoreItemInstall, .mfPowerupIconInstallBtn.install").on("click",thisClass.installPowerup);$(".mfPowerupStoreItemUninstall").off("click");$(".mfPowerupStoreItemUninstall").on("click",thisClass.uninstallPowerup);$(".mfPowerupStoreItem, .mfPowerupIconLayoutItem").off("click");$(".mfPowerupStoreItem, .mfPowerupIconLayoutItem").on("click",thisClass.storePowerupItemClick);if(thisClass.viewPowerupId){var pid=JSON.parse(JSON.stringify(thisClass.viewPowerupId));thisClass.viewPowerupId=null;thisClass.storePowerupItemClick(null,pid);}};this.storePowerupItemClick=function(e,powerupID){var currentPowerupId;if(!powerupID){currentPowerupId=$(this).attr("id");}else{currentPowerupId=powerupID;}var currentPowerupItem=thisClass.getPowerupObj(currentPowerupId.replace("mfPowerupItem",""));mf_main.editorController.storeController.featuredImageSliderEnabled=true;var isInstalledPowerup=currentPowerupItem.installed;$("#mfStoreTemplates").height($(window).height());$("#mfPowerupPageIcon").attr("src",currentPowerupItem.iconURL);$("#mfPowerupPageName").text(currentPowerupItem.name);$("#mfPowerupAboutDescription").text(currentPowerupItem.description);$("#mfPowerupAboutDetails").html(currentPowerupItem.details);$(".mfPowerupScreenshotItem").attr("src","");var powerupAvailability="Editor and Reviewer mode";if(currentPowerupItem.mode=="editor"){powerupAvailability="Editor";}else{if(currentPowerupItem.mode=="review"){powerupAvailability="Reviewer";}}$("#mfPowerupPageAvailability").text(powerupAvailability);$("#mfPowerupPageContactEmail").attr("href","mailto:"+currentPowerupItem.creator);$("#mfPowerupPageButton,#mfPowerupPageEditButton,#mfPowerupPageDeleteButton,#mfPowerupPageSortScreenshotButton").attr("data-powerupid",currentPowerupItem.id);if(!isInstalledPowerup){$("#mfPowerupPageButton").removeClass("mfPowerupStoreItemUninstall").addClass("mfPowerupStoreItemInstall");$("#mfPowerupPageButton").text("Install");}else{$("#mfPowerupPageButton").removeClass("mfPowerupStoreItemInstall").addClass("mfPowerupStoreItemUninstall");$("#mfPowerupPageButton").text("Uninstall");}$(".mfStoreMain").hide();$("#mfStorePowerupViewer").show();$("#mfStorePowerupViewer").scrollTop(0);thisClass.listPowerupScreenshots(currentPowerupItem);thisClass.applyOtherPowerupStoreTemplate();mf_main.editorController.storeController.resize();$(".mfPowerUpTooltipCls").tooltip({trigger:"hover"});$(".mfPowerUpTooltipCls").on("click",function(){$(this).blur();});};this.closePowerupItem=function(){if(mf_main.editorController.storeController.searching){$(".mfStoreMain").hide();$("#mfStoreSearchWrapper").show();}else{if(mf_main.editorController.storeController.itemType=="all"){$(".mfStoreMain").hide();$("#mfStoreDiscoverWrapper").show();}else{if(mf_main.editorController.storeController.itemType=="powerup"){$(".mfStoreMain, .mfStoreBackDrop, #mfStoreFiltersDropdown").hide();$("#mfStoreTemplateWrapper, .mfStorePowerUpBackdrop").show();}}}mf_main.editorController.storeController.resize();};this.closePowerupStore=function(){if($("#mfStoreInterface").css("display")=="block"){thisClass.closePowerupItem();mf_main.editorController.storeController.closeStore();}};this.checkPowerupScreenshotsCarouselArrows=function(){var totalWidth=$("#mfPowerupScreenshots-slider .mfPowerupScreenshots-slider-item").length*(Math.round($(".mfPowerupScreenshots-slider-item").outerWidth())+19);var frameWidth=Math.round($(".mfPowerupScreenshots-slider-frame").outerWidth());var itemWidth=Math.round($(".mfPowerupScreenshots-slider-item").outerWidth())+20;var totalScroll=Math.round($(".mfPowerupScreenshots-slider-frame").scrollLeft());if(((totalWidth-frameWidth)-totalScroll)<itemWidth&&(totalScroll+frameWidth+20)>=totalWidth){$(".mfPowerupScreenshotsCarouselArrow.next").css("visibility","hidden");}else{if($("#mfPowerupScreenshots-slider .mfPowerupScreenshots-slider-item").length<=2){$(".mfPowerupScreenshotsCarouselArrow.next").css("visibility","hidden");$(".mfPowerupScreenshotsCarouselArrow.prev").css("visibility","hidden");}else{$(".mfPowerupScreenshotsCarouselArrow.next").css("visibility","visible");}}if(((totalWidth-frameWidth)+totalScroll)<itemWidth||$(".mfPowerupScreenshots-slider-frame").scrollLeft()==0){$(".mfPowerupScreenshotsCarouselArrow.prev").css("visibility","hidden");}else{if($("#mfPowerupScreenshots-slider .mfPowerupScreenshots-slider-item").length<=2){$(".mfPowerupScreenshotsCarouselArrow.next").css("visibility","hidden");$(".mfPowerupScreenshotsCarouselArrow.prev").css("visibility","hidden");}else{$(".mfPowerupScreenshotsCarouselArrow.prev").css("visibility","visible");}}};this.movePowerupScreenshotsCarousel=function(){var $this=$(this),width=$(".mfPowerupScreenshots-slider-item").outerWidth()+20,speed=500;if($this.hasClass("prev")){$(".mfPowerupScreenshots-slider-frame").animate({scrollLeft:"-="+width},speed,function(){thisClass.checkPowerupScreenshotsCarouselArrows();});}else{if($this.hasClass("next")){$(".mfPowerupScreenshots-slider-frame").animate({scrollLeft:"+="+width},speed,function(){thisClass.checkPowerupScreenshotsCarouselArrows();});}}};this.installPowerup=function(e,powerupID){if(e){e.stopPropagation();}if(!powerupID){powerupID=$(this).attr("data-powerupid");}if(mf_main.INTEGRATION){bootbox.alert("Power-ups not available inside third party integrations. Only inside desktop apps and mockflow.com");return;}if(MF_UserSession.getUser()&&!MF_UserSession.getUser().offlineMode){if(powerupID!="D6b672969bd41e0b203af9f2726f61ae0"&&powerupID!="D1d53f643d8d753cf28568c9929d7a03d"&&powerupID!="Dfc48ce023dd5df731be65215764b2093"){if(MF_UserSession.getUser().isBasic||(MF_UserSession.getUser().wireframing&&powerupID!="D25391f242a0654082abf49c8d0c7d908"&&powerupID!="D4073780418f47f01cdfff9cf319a0913")){var wireframePlanMsg="";if(MF_UserSession.getUser().wireframing){wireframePlanMsg=", AI Text";}bootbox.confirm("This powerup is not permitted for your MockFlow plan. Only Stepguide, CJM"+wireframePlanMsg+" and Bootstrap Builder powerups are available. Upgrade now?",function(ansu){if(ansu){mf_main.openUpgradeDialog();}else{}});return;}}}var powerupid;if(!powerupID){powerupid=$(this).attr("data-powerupid");}else{powerupid=powerupID;}var powerupObj=thisClass.getPowerupObj(powerupid);if(powerupObj!=null){if(mf_main.PERMISSION=="Reviewer"&&powerupObj.mode=="editor"){bootbox.confirm("You are about to install editor-only powerup. Since you a reviewer of this project, this powerup will not be visible in this project. Continue?",function(ans){if(!ans){return;}});}powerupObj.installationid=mf_main.editorController.guidGenerator();powerupObj.installed=true;var powerupInstalled=false;for(var i=0;i<mf_main.editorController.powerupController.installedPowerupsCollection.size();i++){var powerupInstalledItem=mf_main.editorController.powerupController.installedPowerupsCollection.getItemAt(i);if(powerupInstalledItem.id==powerupObj.id){powerupInstalled=true;}mf_main.editorController.powerupController.installedPowerupsCollection.getItemAt(i).sortorder=i+2;}if(!powerupInstalled){mf_main.editorController.powerupController.powerupsListed=false;mf_main.editorController.powerupController.installedPowerupsCollection.addItemAt(powerupObj,0);}mf_main.editorController.powerupController.loadedPowerupsTopmenu=false;thisClass.closePowerupStore();if(mf_main.editorController.EDITOR){if(powerupObj.mode=="review"){mf_main.editorController.showPreview();$("#mfViewerNavPowerupBtn").click();}else{$("#mfNavPowerupBtn").click();}mf_main.editorController.powerupController.loadPowerupModule(powerupObj.id);}else{if(powerupObj.mode=="editor"&&mf_main.PERMISSION!="Reviewer"){mf_main.editorController.showEditor();$("#mfNavPowerupBtn").click();mf_main.editorController.powerupController.loadPowerupModule(powerupObj.id);}else{if(powerupObj.mode!="editor"){$("#mfViewerNavPowerupBtn").click();mf_main.editorController.powerupController.loadPowerupModule(powerupObj.id);}}}MF_PowerupManager.installPowerup(MF_UserSession.getUser(),powerupObj,{callback:function(status){if(status=="success"){MF_Utils.display_ActionIndicator("Powerup installed successfully");$("#mfPowerupPageButton").removeClass("mfPowerupStoreItemInstall").addClass("mfPowerupStoreItemUninstall");$("#mfPowerupPageButton").text("Uninstall");$("#mfPowerupStoreContainer #mfPowerupItem"+powerupObj.id+" .mfPowerupIconInstallBtn").removeClass("install").text("installed");$(".mfLatestPowerupList #mfPowerupItem"+powerupObj.id+" .mfPowerupIconInstallBtn").removeClass("install").text("installed");}else{}}});}};this.uninstallPowerup=function(e){e.stopPropagation();var powerupid=$(this).attr("data-powerupid");var powerupinstallcls=$(this).hasClass("mfPowerupStoreItemUninstall");var uninstallButtonDiv=$(this);bootbox.confirm("This will remove this Power-up from your account or team. Continue ? <br/><br/>Note: It can be installed later",function(ans){if(ans){var powerupObj=mf_main.editorController.powerupController.getInstalledPowerupObj(powerupid);if(powerupObj!=null&&powerupObj.installed){var uninstallButton=null;if(powerupinstallcls){uninstallButton=uninstallButtonDiv;uninstallButton.prop("disabled",true);uninstallButton.text("Processing...");}else{$("#mfPowerupListScreenLoader").show();$("#mfPowerupListScreen").hide();}MF_PowerupManager.uninstallPowerup(MF_UserSession.getUser(),powerupObj,{callback:function(status){if(status=="success"){powerupObj.installed=false;var installedIndex=null;for(var i=0;i<mf_main.editorController.powerupController.installedPowerupsCollection.size();i++){var item=mf_main.editorController.powerupController.installedPowerupsCollection.getItemAt(i);if(item.id==powerupid){installedIndex=i;break;}}if(installedIndex!=null){mf_main.editorController.powerupController.installedPowerupsCollection.removeItemAt(installedIndex);mf_main.editorController.powerupController.powerupsListed=false;}var storePowerupObj=null;var storePowerupIndex=null;if(thisClass.powerupStoreCollection!=null){for(var i=0;i<thisClass.powerupStoreCollection.size();i++){var item=thisClass.powerupStoreCollection.getItemAt(i);if(item.id==powerupid){storePowerupObj=item;storePowerupIndex=i;break;}}if(storePowerupIndex!=null&&storePowerupObj!=null){storePowerupObj.installed=false;storePowerupObj.installationid=null;thisClass.powerupStoreCollection.removeItemAt(storePowerupIndex);thisClass.powerupStoreCollection.addItem(storePowerupObj);}}var loadedPowerupIndex=null;if(mf_main.editorController.powerupController.loadedPowerupsCollection!=null){for(var i=0;i<mf_main.editorController.powerupController.loadedPowerupsCollection.size();i++){var item=mf_main.editorController.powerupController.loadedPowerupsCollection.getItemAt(i);if(item.id==powerupid){loadedPowerupIndex=i;break;}}if(loadedPowerupIndex!=null){mf_main.editorController.powerupController.loadedPowerupsCollection.removeItemAt(loadedPowerupIndex);}}MF_PowerupManager.unpinCompanyPowerup(MF_UserSession.getUser(),powerupObj,{callback:function(status){if(status){mf_main.editorController.powerupController.refreshSpaceHandler(powerupid);}}});$("#mfPowerupDataScreen_"+powerupid).remove();mf_main.editorController.powerupController.selectedPowerup=null;mf_main.editorController.powerupController.loadedPowerupsTopmenu=false;mf_main.editorController.powerupController.installedPowerupsCollection=null;mf_main.editorController.powerupController.openPowerupList();thisClass.closePowerupStore();MF_Utils.display_ActionIndicator("Powerup uninstalled successfully");$("#mfPowerupStoreContainer #mfPowerupItem"+powerupObj.id+" .mfPowerupIconInstallBtn").addClass("install").text("install").attr("data-powerupid",powerupObj.id);$(".mfLatestPowerupList #mfPowerupItem"+powerupObj.id+" .mfPowerupIconInstallBtn").addClass("install").text("install").attr("data-powerupid",powerupObj.id);}else{MF_Utils.display_ActionIndicator("Error: "+status);}if(uninstallButton!=null){uninstallButton.prop("disabled",false);uninstallButton.text("Uninstall");}else{$("#mfPowerupListScreen").show();$("#mfPowerupListScreenLoader").hide();}}});}}});};this.listPowerupScreenshots=function(powerupObj){$("#mfPowerupScreenshotsContainer").hide();$("#mfPowerupScreenshotsLoader").show();if(powerupObj!=null){if(!thisClass.powerupScreenshotsCollection.hasOwnProperty(powerupObj.id)){MF_PowerupManager.listscreenshots(MF_UserSession.getUser(),powerupObj.id,{callback:function(list){if(list!=null){var screenshotList=new Array();for(var i=0;i<list.length;i++){var screenshot=new MF_PowerupScreenshot();screenshot.cast(list[i]);screenshotList.push(screenshot);}thisClass.powerupScreenshotsCollection[powerupObj.id]=screenshotList;thisClass.applyScreenshotTemplate(screenshotList);}else{MF_Utils.display_ActionIndicator("Error in obtaining screenshots");}}});}else{thisClass.applyScreenshotTemplate(thisClass.powerupScreenshotsCollection[powerupObj.id]);}}};this.applyScreenshotTemplate=function(arr){var cachedTemplate=mf_main.getTemplateFromCache("mfPowerupScreenshotTemplate");if(cachedTemplate==null){$.get("templates/editor/PowerupScreenshotItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfPowerupScreenshotTemplate").html());mf_main.addTemplateToCache("mfPowerupScreenshotTemplate",template);thisClass.renderPowerupScreenshotItem(arr,template);});}else{thisClass.renderPowerupScreenshotItem(arr,cachedTemplate);}};this.renderPowerupScreenshotItem=function(arr,template){var htmldom="";for(var i=0;i<arr.length;i++){var nitem=arr[i];nitem.isVideo=false;if(nitem.mediatype=="video"){nitem.isVideo=true;}htmldom=htmldom+template(nitem);}$("#mfPowerupScreenshotListWrapper").html(htmldom);$("#mfPowerupScreenshotsContainer, .mfPowerupScreenshotLoader").show();$("#mfPowerupScreenshotsLoader").hide();thisClass.positioningPowerupScreenshots();$(".mfPowerupScreenshotsCarouselArrow").off("click");$(".mfPowerupScreenshotsCarouselArrow").on("click",thisClass.movePowerupScreenshotsCarousel);thisClass.checkPowerupScreenshotsCarouselArrows();$(".mfPowerupScreenshots img.mfPowerupScreenshotItem").on("load",function(){$(this).closest(".mfPowerupScreenshots").find(".mfPowerupScreenshotLoader").hide();});$(".mfPowerupScreenshots video.mfPowerupScreenshotItem").on("canplaythrough",function(){$(this).show();$(this).closest(".mfPowerupScreenshots").find(".mfPowerupScreenshotLoader").hide();$(this).closest(".mfPowerupScreenshots").find(".mfPowerupScreenshotItemVideoFullScreen").addClass("mfPowerupScreenshotItemVideoFullScreenViewable");});$(".mfPowerupScreenshotItemVideoFullScreen").off("click");$(".mfPowerupScreenshotItemVideoFullScreen").on("click",thisClass.openScreenshotVideoFullScreen);mf_main.editorController.storeController.resize();};this.handleAddPowerupSubmit=function(e){e.preventDefault();if(MF_Global.adminAllow()){var powerupName=$("#mfNewPowerupName").val().trim();var powerupSource=$("#mfNewPowerupSource").val().trim();var powerupPath=$("#mfNewPowerupPath").val().trim();var powerupDescription=$("#mfNewPowerupShortDescription").val().trim();var powerupDetails=$("#mfNewPowerupDetails").val().trim();var powerupCategory=$("#mfNewPowerupCategory").val().trim();var powerupMode=$("#mfNewPowerupMode").val().trim();var powerupIsPublic=false;if($("#mfNewPowerupIsPublic").is(":checked")){powerupIsPublic=true;}var powerupIcon=$("#mfNewPowerupIconFile").val();var powerupThumbnail=$("#mfNewPowerupThumbnailFile").val();var powerupScreenshots=$("#mfNewPowerupScreenshots").val();if(powerupName.length==0){MF_Utils.display_ActionIndicator("Powerup name is required");return;}if(powerupPath.length==0){MF_Utils.display_ActionIndicator("Powerup path is required");return;}if(powerupDescription.length==0){MF_Utils.display_ActionIndicator("Powerup description is required");return;}var powerupObj=new MF_Powerup();powerupObj.id=mf_main.editorController.guidGenerator();powerupObj.source=powerupSource;powerupObj.slug=powerupPath;powerupObj.name=powerupName;powerupObj.description=powerupDescription;powerupObj.details=powerupDetails;powerupObj.detailsMarkdown=powerupDetails;powerupObj.category=powerupCategory;powerupObj.creator=MF_UserSession.getUser().username;powerupObj.mode=powerupMode;powerupObj.isPublic=powerupIsPublic;$("#mfAddPowerupSubmitBtn").prop("disabled",true);$("#mfAddPowerupSubmitBtn").text("Saving...");if(thisClass.powerupOnEdit==null){MF_PowerupManager.addNewPowerup(MF_UserSession.getUser(),powerupObj,{callback:function(status){if(status=="success"){thisClass.screenshotSortOrder=0;thisClass.processPowerupFiles(powerupObj);}else{MF_Utils.display_ActionIndicator("Error:"+status);$("#mfAddPowerupSubmitBtn").prop("disabled",false);$("#mfAddPowerupSubmitBtn").text("Submit");}}});}else{powerupObj.id=thisClass.powerupOnEdit.id;MF_PowerupManager.updatePowerup(MF_UserSession.getUser(),powerupObj,{callback:function(status){if(status=="success"){if(thisClass.powerupScreenshotsCollection.hasOwnProperty(powerupObj.id)){thisClass.screenshotSortOrder=thisClass.powerupScreenshotsCollection[powerupObj.id].length;delete thisClass.powerupScreenshotsCollection[powerupObj.id];}else{thisClass.screenshotSortOrder=0;}thisClass.processPowerupFiles(powerupObj);}else{MF_Utils.display_ActionIndicator("Error:"+status);$("#mfAddPowerupSubmitBtn").prop("disabled",false);$("#mfAddPowerupSubmitBtn").text("Submit");}}});}}else{MF_Utils.display_ActionIndicator("Permission denied");}};this.processPowerupFiles=function(powerupObj){thisClass.uploadFilesCount=0;var fileUploadInProcess=false;if(document.getElementById("mfNewPowerupIconFile").files.length==1){fileUploadInProcess=true;var file=document.getElementById("mfNewPowerupIconFile").files[0];thisClass.uploadPowerupFiles("icon","mfNewPowerupIconFile",file,powerupObj);}if(document.getElementById("mfNewPowerupThumbnailFile").files.length==1){fileUploadInProcess=true;var file=document.getElementById("mfNewPowerupThumbnailFile").files[0];thisClass.uploadPowerupFiles("thumbnail","mfNewPowerupThumbnailFile",file,powerupObj);}if(document.getElementById("mfNewPowerupScreenshots").files.length>0){fileUploadInProcess=true;for(var i=0;i<document.getElementById("mfNewPowerupScreenshots").files.length;i++){var file=document.getElementById("mfNewPowerupScreenshots").files[i];thisClass.uploadPowerupFiles("screenshot","mfNewPowerupScreenshots",file,powerupObj);}}if(thisClass.uploadFilesCount==0){fileUploadInProcess=false;}if(!fileUploadInProcess){$("#mfAddPowerupSubmitBtn").prop("disabled",false);$("#mfAddPowerupSubmitBtn").text("Submit");thisClass.closePowerupItem();if(thisClass.powerupOnEdit==null){MF_Utils.display_ActionIndicator("Powerup created successfully");}else{MF_Utils.display_ActionIndicator("Powerup edited successfully");}}};this.uploadPowerupFiles=function(field,element,file,powerupObj){if(file){var addFile=true;var fileSize=0;fileSize=parseInt(file.size/1024,10);var allow=false;if(field=="icon"&&(file.type.match(/image\/jpeg/)||file.type.match(/image\/png/)||file.type.match(/image\/gif/))){allow=true;}if(field=="thumbnail"&&(file.type.match(/image\/jpeg/)||file.type.match(/image\/png/)||file.type.match(/image\/gif/))){allow=true;}if(field=="screenshot"&&(file.type.match(/image\/jpeg/)||file.type.match(/image\/png/)||file.type.match(/image\/gif/)||file.type.match(/video\/webm/)||file.type.match(/video\/mp4/))){allow=true;}if(!allow){$("#"+element).attr({value:""});this.uploadFileTemp=null;addFile=false;if(field=="icon"||field=="thumbnail"){alert("Only image files are supported - JPG, GIF, PNG");}if(field=="screenshot"){alert("Only image/video files are supported - JPG, GIF, PNG, WebM, MP4");}}fileSize=fileSize/1000;if(fileSize>50){$("#"+element).attr({value:""});this.uploadFileTemp=null;addFile=false;alert("File size cannot exceed 50 MB");}if(addFile){thisClass.uploadFilesCount++;var fd=new FormData();fd.append("company",mf_main.editorController.projectObj.company);fd.append("username",MF_UserSession.getUser().username);fd.append("token",MF_UserSession.getUser().jwtToken);fd.append("password",MF_UserSession.getUser().password);fd.append("size",(parseInt(file.size/1024,10)).toString());fd.append("powerupid",powerupObj.id);fd.append("name","Html 5 File API/FormData");fd.append("fileToUpload",file);fd.append("mime",file.type);fd.append("filename",file.name);fd.append("field",field);if(field=="screenshot"){thisClass.screenshotSortOrder++;fd.append("sortorder",thisClass.screenshotSortOrder);}var xhr=new XMLHttpRequest();xhr.upload.addEventListener("progress",thisClass.uploadProgress,false);xhr.addEventListener("load",thisClass.uploadComplete,false);xhr.addEventListener("error",thisClass.uploadFailed,false);xhr.addEventListener("abort",thisClass.uploadCanceled,false);xhr.open("POST","powerupimageupload");xhr.send(fd);}}};this.uploadComplete=function(evt){thisClass.uploadFilesCount--;if(thisClass.uploadFilesCount==0){if(thisClass.powerupOnEdit==null){MF_Utils.display_ActionIndicator("Powerup created successfully");}else{MF_Utils.display_ActionIndicator("Powerup edited successfully");}$("#mfAddPowerupSubmitBtn").prop("disabled",false);$("#mfAddPowerupSubmitBtn").text("Submit");thisClass.closePowerupItem();}};this.uploadProgress=function(evt){};this.uploadFailed=function(evt){thisClass.uploadFilesCount--;if(thisClass.uploadFilesCount==0){MF_Utils.display_ActionIndicator("Powerup created successfully, failure in uploading files");$("#mfAddPowerupSubmitBtn").prop("disabled",false);$("#mfAddPowerupSubmitBtn").text("Submit");thisClass.closePowerupItem();}};this.uploadCanceled=function(evt){thisClass.uploadFilesCount--;if(thisClass.uploadFilesCount==0){if(thisClass.powerupOnEdit==null){MF_Utils.display_ActionIndicator("Powerup created successfully");}else{MF_Utils.display_ActionIndicator("Powerup edited successfully");}$("#mfAddPowerupSubmitBtn").prop("disabled",false);$("#mfAddPowerupSubmitBtn").text("Submit");}};this.openSortScreenshot=function(){if(MF_Global.adminAllow()){$(".mfStoreMain").hide();$("#mfStoreSortPowerupScreenshots").show();var editPowerupId=$(this).attr("data-powerupid");thisClass.powerupOnEdit=thisClass.getPowerupObj(editPowerupId);$("#mfPowerupSortScreenshotList").html("");if(thisClass.powerupScreenshotsCollection.hasOwnProperty(editPowerupId)){var screenshotList=thisClass.powerupScreenshotsCollection[editPowerupId];var powerupScreenshotItemTemplate=$("#mfPowerupSortScreenshotItemTemplate").clone();screenshotList.forEach(function(screenshotItem){if(screenshotItem.mediatype=="image"){$(powerupScreenshotItemTemplate).find(".mfPowerupSortScreenshotItemThumbnail-image").show();$(powerupScreenshotItemTemplate).find(".mfPowerupSortScreenshotItemThumbnail-video").hide();}else{$(powerupScreenshotItemTemplate).find(".mfPowerupSortScreenshotItemThumbnail-image").hide();$(powerupScreenshotItemTemplate).find(".mfPowerupSortScreenshotItemThumbnail-video").show();}$(powerupScreenshotItemTemplate).find(".mfPowerupSortScreenshotItem").attr("data-screenshotid",screenshotItem.id);$(powerupScreenshotItemTemplate).find(".mfPowerupSortScreenshotItemThumbnail").attr("src",screenshotItem.thumbnailURL);$(powerupScreenshotItemTemplate).find(".mfPowerupSortScreenshotID").text(screenshotItem.id);$(powerupScreenshotItemTemplate).find(".mfPowerupSortScreenshotDelete").attr("data-screenshotid",screenshotItem.id);$(powerupScreenshotItemTemplate).find(".mfPowerupSortScreenshotDelete").attr("data-powerupid",screenshotItem.powerupid);$("#mfPowerupSortScreenshotList").append($(powerupScreenshotItemTemplate).html());});if($("#mfPowerupSortScreenshotList").hasClass("ui-sortable")){$("#mfPowerupSortScreenshotList").sortable("destroy");}$("#mfPowerupSortScreenshotList").sortable({placeholder:"mfPowerupSortScreenshotListPlaceholder",update:function(event,ui){thisClass.sortScreenshotHandler();}});$(".mfPowerupSortScreenshotDelete").off("click");$(".mfPowerupSortScreenshotDelete").on("click",thisClass.deleteScreenshotHandler);}}else{MF_Utils.display_ActionIndicator("Permission denied");}};this.sortScreenshotHandler=function(){if(MF_Global.adminAllow()){if(thisClass.powerupOnEdit!=null){if(thisClass.powerupScreenshotsCollection.hasOwnProperty(thisClass.powerupOnEdit.id)){var screenshotList=thisClass.powerupScreenshotsCollection[thisClass.powerupOnEdit.id];var newScreenshotList=[];var sortorder=1;$("#mfPowerupSortScreenshotList .mfPowerupSortScreenshotItem").each(function(){for(var i=0;i<screenshotList.length;i++){if(screenshotList[i].id==$(this).attr("data-screenshotid")){screenshotList[i].sortorder=sortorder;newScreenshotList.push(screenshotList[i]);}}sortorder++;});thisClass.powerupScreenshotsCollection[thisClass.powerupOnEdit.id]=newScreenshotList;MF_PowerupManager.updateScreenshotSortorder(MF_UserSession.getUser(),thisClass.powerupOnEdit.id,newScreenshotList,{callback:function(data){if(data=="success"){MF_Utils.display_ActionIndicator("Screenshots order updated successfully");}else{MF_Utils.display_ActionIndicator("Error in saving screenshots order");}}});}}}else{MF_Utils.display_ActionIndicator("Permission denied");}};this.deleteScreenshotHandler=function(){if(MF_Global.adminAllow()){if(thisClass.powerupOnEdit!=null){if(thisClass.powerupScreenshotsCollection.hasOwnProperty(thisClass.powerupOnEdit.id)){var screenshotList=thisClass.powerupScreenshotsCollection[thisClass.powerupOnEdit.id];var newScreenshotList=[];var screenshotId=$(this).attr("data-screenshotid");for(var i=0;i<screenshotList.length;i++){if(screenshotList[i].id!=screenshotId){newScreenshotList.push(screenshotList[i]);}}thisClass.powerupScreenshotsCollection[thisClass.powerupOnEdit.id]=newScreenshotList;$(this).closest(".mfPowerupSortScreenshotItem").remove();$("#mfPowerupSortScreenshotList").sortable("refresh");thisClass.sortScreenshotHandler();MF_PowerupManager.deleteScreenshot(MF_UserSession.getUser(),thisClass.powerupOnEdit.id,screenshotId,{callback:function(data){if(data=="success"){MF_Utils.display_ActionIndicator("Screenshot deleted successfully");}else{MF_Utils.display_ActionIndicator("Error in deleting screenshot");}}});}}}else{MF_Utils.display_ActionIndicator("Permission denied");}};this.positioningPowerupScreenshots=function(){$("#mfPowerupScreenshots-slider .mfPowerupScreenshots-slider-item").each(function(i){left=($(this).outerWidth()+20)*i;$(this).css({left:left});});};this.openScreenshotVideoFullScreen=function(){var elem=$(this).closest(".mfPowerupScreenshots").find("video")[0];if(elem.requestFullscreen){elem.requestFullscreen();}else{if(elem.mozRequestFullScreen){elem.mozRequestFullScreen();}else{if(elem.webkitRequestFullscreen){elem.webkitRequestFullscreen();}else{if(elem.msRequestFullscreen){elem.msRequestFullscreen();}}}}};}function MF_PowerupInterface(){var thisClass=this;this.initEventListeners=false;this.powerupInterfaceModalCallback=null;this.receiveMessageCallback=null;this.addFileCallback=null;this.desktopProxyWindow=null;this.preventModalClose=true;this.refreshSideBar=new Object();this.frameSizeObj=null;this.constructor=function(){$(".mfPowerupContainer").hide();thisClass.attachEvents();};this.attachEvents=function(){if(!thisClass.initEventListeners){thisClass.initEventListeners=true;$("#mfPowerupInterfaceModalCloseBtn").on("click",function(){$("#mfPowerupInterfaceModal").modal("hide");});$("#mfPowerupInterfaceModal").on("shown.bs.modal",function(){mf_main.editorController.powerupController.resize();if(mf_main.PINPOWERUP){$("#mfPowerupInterfaceModal").focus();}});$("#mfPowerupInterfaceModal").on("hide.bs.modal",function(e){if(mf_main.PUBLIC){e.preventDefault();return false;}try{if(mf_main.editorController.powerupCallbackOptions&&mf_main.editorController.powerupCallbackOptions.isResetPage){if(mf_main.editorController.powerupCallbackOptions.currentPageId&&Object.keys(mf_main.editorController.powerupData).length==0){mf_main.editorController.powerupCallPageReset();}}}catch(e){}if($("#mfPowerupInterfaceModal").css("display")=="block"&&thisClass.preventModalClose&&!confirm("There may be unsaved changes, your changes will be lost.")){e.preventDefault();}else{$("#mfPowerupInterfaceIframe").remove();if(thisClass.powerupInterfaceModalCallback!=null&&typeof thisClass.powerupInterfaceModalCallback=="function"){thisClass.powerupInterfaceModalCallback();thisClass.powerupInterfaceModalCallback=null;}}});if(typeof mf_appmain!="undefined"){require("electron").ipcRenderer.removeAllListeners("powerup-window-data");require("electron").ipcRenderer.on("powerup-window-data",function(event,res){thisClass.sendMessage("sidebar",res);});}}};this.getPageID=function(callback){callback(mf_main.editorController.page.eid);return;};this.getRandomString=function(callback){var randomString=mf_main.editorController.guidGenerator();callback(randomString);return;};this.uploadImage=function(file,filename,options){if(mf_main.editorController.EDITOR){if(typeof file!="object"||filename.trim().length==0||file.size==0){return"File is not valid";}else{if(options&&options.component){mf_main.editorController.imageController.powerupComponentToUpdate=options.component;mf_main.editorController.imageController.powerupComponentToUpdateImageID=MF_Utils.guidGenerator();file.imageID=mf_main.editorController.imageController.powerupComponentToUpdateImageID;}if(filename.endsWith(".svg")){file.imageID=MF_Utils.guidGenerator()+".svg";}mf_main.editorController.imageController.uploadFileTemp=file;mf_main.editorController.imageController.uploadFiles.push(file);mf_main.editorController.imageController.totalCount=mf_main.editorController.imageController.totalCount+mf_main.editorController.imageController.uploadFiles.length;if(typeof mf_main.editorController.imageController.updateImageUploadCount==="function"){mf_main.editorController.imageController.updateImageUploadCount();}if(mf_main.editorController.imageController.uploadFiles.length>0){mf_main.editorController.openNavBarContent("mfNavImagesBtn");mf_main.editorController.imageController.openAddImageDialog();mf_main.editorController.imageController.addImageHandler(filename);}}}else{MF_Utils.display_ActionIndicator("You can upload images only in edit mode");}};this.getData=function(name,callback){MF_PowerupManager.getStoreData(MF_UserSession.getUser(),mf_main.editorController.powerupController.selectedPowerup.installationid,name,mf_main.editorController.projectObj.id,mf_main.PUBLIC,true,{callback:function(response){var buf=thisClass._base64ToArrayBuffer(response);var str=pako.inflate(buf,{to:"string"});response=str;response=JSON.parse(response);callback(response);}});return;};this._base64ToArrayBuffer=function(base64){var binary_string=window.atob(base64);var len=binary_string.length;var bytes=new Uint8Array(len);for(var i=0;i<len;i++){bytes[i]=binary_string.charCodeAt(i);}return bytes.buffer;};this.putData=function(name,value,scope,options,callback){if(arguments.length==4){callback=options;options={};}var defaultOptions={isPublic:false,publicURL:null,origPublicURL:null,pageId:null,itemId:null,isSaveURL:false,isDeleteSection:false,pinProjectId:null,clientId:mf_main.editorController.projectObj.company};var putDataOptions=$.extend({},defaultOptions,options);var compressedData="";var isBase64Data=false;try{var binaryString=pako.gzip(value,{to:"string"});compressedData=btoa(binaryString);isBase64Data=true;}catch(e){compressedData=value;}MF_PowerupManager.putStoreData(MF_UserSession.getUser(),mf_main.editorController.powerupController.selectedPowerup,name,compressedData,scope,mf_main.editorController.projectObj.id,JSON.stringify(putDataOptions),isBase64Data,{callback:function(response){response=JSON.parse(response);callback(response);if(putDataOptions.isSaveURL&&response.pinId&&response.pinId!="none"){var obj=new Object();obj.cmd="designspacepowerup_updatepubliclink";obj.projectId=response.pinId;obj.publicURL=putDataOptions.publicURL;thisClass.updatePowerupPublicLinkInSpace(obj,function(response){});}if(response&&response.pinId&&response.pinId!="none"&&putDataOptions.isDeleteSection){var projObj=new MF_Project();projObj.id=response.pinId;var obj=new Object();obj.cmd="designspacepowerup_unpin";obj.project=projObj;obj.spaceId=mf_main.editorController.projectObj.spaceId;thisClass.sendPinPowerupToSpace(obj,function(response){});}}});if(scope=="project"&&mf_main.editorController.powerupController.selectedPowerup.hasOwnProperty("isUsed")&&mf_main.editorController.powerupController.selectedPowerup.isUsed==false){mf_main.editorController.powerupController.selectedPowerup.isUsed=true;$("#mfPowerupListScreen .mfPowerupItem[data-powerupid="+mf_main.editorController.powerupController.selectedPowerup.id+"]").addClass("mfPowerupItemUsed");}return;};this.deleteData=function(name,callback){MF_PowerupManager.deleteStoreData(MF_UserSession.getUser(),mf_main.editorController.powerupController.selectedPowerup.installationid,name,mf_main.editorController.projectObj.id,{callback:function(response){response=JSON.parse(response);callback(response);}});return;};this.refreshOtherUsers=function(data){if(typeof data=="undefined"){data={};}mf_main.rtc.powerupSync("refreshpowerup",mf_main.editorController.powerupController.selectedPowerup.id,data);return;};this.getUserInfo=function(callback){var userObj=MF_UserSession.getUser();if(userObj){var userInfo={email:userObj.username,firstName:userObj.firstName,lastName:userObj.lastName,role:mf_main.PERMISSION,clientid:userObj.company,accountType:userObj.accountType};callback(userInfo);}else{callback(false);}return;};this.getAssetPath=function(callback){var url="";var url="https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+mf_main.editorController.projectObj.company+"/projects/"+mf_main.editorController.projectObj.id+"/powerup/"+mf_main.editorController.powerupController.selectedPowerup.id+"/page/common/assets/";callback(url);return;};this.getPageList=function(callback){var mapdata=MF_PagePool.getMap();var processedMapData=thisClass.processMapData(mapdata);callback(processedMapData);return;};this.getSavedCompList=function(callback){MF_PackManager.getSavedComponentListing(MF_UserSession.getUser(),mf_main.editorController.projectObj,{callback:function(response){response=JSON.stringify(response);callback(response);}});};this.processMapData=function(mapdata){var newMapData=new Array();for(var i=0;i<mapdata.length;i++){var nodeItem={};if(mapdata[i].icon){if((mapdata[i].icon=="images/editor/page.png"||mapdata[i].icon=="images/editor/page.svg"||mapdata[i].icon=="images/editor/pagehide.svg")){nodeItem.nodeType="page";}else{nodeItem.nodeType="folder";}nodeItem.nodeIcon=mapdata[i].icon;}else{if(mapdata[i].imageUrl){if((mapdata[i].imageUrl=="images/editor/page.png"||mapdata[i].imageUrl=="images/editor/page.svg")){nodeItem.nodeType="page";}else{nodeItem.nodeType="folder";}nodeItem.nodeIcon=mapdata[i].imageUrl;}}nodeItem.childNodes=[];if(mapdata[i].children&&mapdata[i].children.length>0){nodeItem.childNodes=thisClass.processMapData(mapdata[i].children);}else{if(mapdata[i].items&&mapdata[i].items.length>0){nodeItem.childNodes=thisClass.processMapData(mapdata[i].items);}}nodeItem.nodeIcon=mapdata[i].icon;nodeItem.id=mapdata[i].id;nodeItem.name=mapdata[i].text;nodeItem.navHide=mapdata[i].navHide;nodeItem.downloadUrl="https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+mf_main.editorController.projectObj.company+"/projects/"+mf_main.editorController.projectObj.id+"/pages/"+nodeItem.id+"/image/"+nodeItem.id+".png";nodeItem.thumbnailUrl="https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+mf_main.editorController.projectObj.company+"/projects/"+mf_main.editorController.projectObj.id+"/pages/"+nodeItem.id+"/image/thumb/"+nodeItem.id+".png";newMapData.push(nodeItem);}return newMapData;};this.getPageInfo=function(callback){var mapdata=MF_PagePool.getMap();var processedMapData=thisClass.processCurrentPageMapData(mapdata,mf_main.editorController.page.eid);callback(processedMapData);return;};this.processCurrentPageMapData=function(mapdata,pageId){for(var i=0;i<mapdata.length;i++){if(mapdata[i].id==pageId){var nodeItem={};if(mapdata[i].icon){if((mapdata[i].icon=="images/editor/page.png"||mapdata[i].icon=="images/editor/page.svg")){nodeItem.nodeType="page";}else{nodeItem.nodeType="folder";}nodeItem.nodeIcon=mapdata[i].icon;}else{if(mapdata[i].imageUrl){if((mapdata[i].imageUrl=="images/editor/page.png"||mapdata[i].imageUrl=="images/editor/page.svg")){nodeItem.nodeType="page";}else{nodeItem.nodeType="folder";}nodeItem.nodeIcon=mapdata[i].imageUrl;}}nodeItem.childNodes=[];nodeItem.id=mapdata[i].id;nodeItem.name=mapdata[i].text;nodeItem.downloadUrl="https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+mf_main.editorController.projectObj.company+"/projects/"+mf_main.editorController.projectObj.id+"/pages/"+nodeItem.id+"/image/"+nodeItem.id+".png";nodeItem.thumbnailUrl="https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+mf_main.editorController.projectObj.company+"/projects/"+mf_main.editorController.projectObj.id+"/pages/"+nodeItem.id+"/image/thumb/"+nodeItem.id+".png";return nodeItem;}if(mapdata[i].children&&mapdata[i].children.length>0){var childNode=thisClass.processCurrentPageMapData(mapdata[i].children,pageId);if(childNode){return childNode;}}else{if(mapdata[i].items&&mapdata[i].items.length>0){var childNode=thisClass.processCurrentPageMapData(mapdata[i].items,pageId);if(childNode){return childNode;}}}}return false;};this.openModal=function(url,title,onCloseCallback){var powerupName=mf_main.editorController.powerupController.selectedPowerup.name;$("#mfPowerupInterfaceIframeLoader").show();$("#mfPowerupInterfaceIframe").remove();$("#mfPowerupInterfaceModal .modal-content .modal-body").prepend('<iframe src="'+url+'" id="mfPowerupInterfaceIframe" allow="camera https://wireframepro.mockflow.com; microphone https://wireframepro.mockflow.com; clipboard-write https://wireframepro.mockflow.com" allowfullscreen="true"></iframe>');$("#mfPowerupInterfaceIframe").on("load",function(){$("#mfPowerupInterfaceIframeLoader").hide();if($("#mfPowerupInterfaceIframe").css("display")=="none"){$("#mfPowerupInterfaceIframe").show();}else{$("#mfPowerupInterfaceIframe").css("visibility","visible");}});$("#mfPowerupInterfaceTitle").text(title);$("#mfPowerupInterfaceName").text(powerupName);$("#mfPowerupInterfaceIframe").removeAttr("data-params");thisClass.powerupInterfaceModalCallback=onCloseCallback;thisClass.preventModalClose=false;if(mf_main.PUBLIC){$("#mfPowerupInterfaceModal #mfPowerupInterfaceModalCloseBtn").remove();if(mf_main.PINPOWERUP||mf_main.PUBLIC){$("#mfPowerupInterfaceHeader").remove();$("#mfPowerupInterfaceModal .modal-body").css("height","100%");}$("#mfPowerupInterfaceModal").removeClass("mfPowerupInterfaceModalNonPublic");$("#mfPowerupInterfaceModal").addClass("mfPowerupInterfaceModalPublic");$("#mfPowerupInterfaceModal").modal({backdrop:"static",keyboard:false});$("#mfPowerupInterfaceModal").focus();}else{if(mf_main.PINPOWERUP){$("#mfPowerupInterfaceHeader").remove();$("#mfPowerupInterfaceModal").removeClass("mfPowerupInterfaceModalNonPublic");$("#mfPowerupInterfaceModal").addClass("mfPowerupInterfaceModalPublic");$("#mfPowerupInterfaceModal .modal-body").css("height","100%");$("#mfPowerupInterfaceModal").modal({backdrop:"static",keyboard:false});$("#mfPowerupInterfaceModal").focus();$("#mfPowerupPublicLoader").hide();}else{$("#mfPowerupInterfaceModal").modal();}}return;};this.openResizeModal=function(url,title,attributes,framesize,onCloseCallback){thisClass.frameSizeObj=JSON.parse(framesize);var powerupName=mf_main.editorController.powerupController.selectedPowerup.name;$("#mfPowerupResizeModalLoader").show();$("#mfPowerupResizeModalIframe").remove();$("#mfPowerupResizeModal #mfPowerupResizeModalBody").prepend('<iframe src="'+url+'" id="mfPowerupResizeModalIframe"'+attributes+'style="width: 100%;height: 100%;border: 0;padding: 5px;" allowfullscreen="true"></iframe>');$("#mfPowerupResizeModal").css({top:thisClass.frameSizeObj.mintop,left:thisClass.frameSizeObj.minleft,height:thisClass.frameSizeObj.minheight,width:thisClass.frameSizeObj.minwidth});$("#mfPowerupResizeModalIframe").on("load",function(){$("#mfPowerupResizeModalLoader").hide();if(!$("#mfPowerupResizeModal").is(".ui-draggable")){$("#mfPowerupResizeModal").draggable({containment:"parent"});}if(!$("#mfPowerupResizeModal").is(".ui-resizable")){$("#mfPowerupResizeModal").resizable({containment:"parent",handles:"all",start:function(event,ui){$("#mfPowerupResizeModalIframe").css("pointer-events","none");},stop:function(event,ui){$("#mfPowerupResizeModalIframe").css("pointer-events","auto");}});}$("#mfPowerupResizeModalCloseBtn").off("click");$("#mfPowerupResizeModalCloseBtn").on("click",function(){$("#mfPowerupResizeModal").hide();});$("#mfPowerupResizeModalFitBtn").off("click");$("#mfPowerupResizeModalFitBtn").on("click",function(){$("#mfPowerupResizeModal").css({top:thisClass.frameSizeObj.maxtop,left:thisClass.frameSizeObj.maxleft,height:thisClass.frameSizeObj.maxheight,width:thisClass.frameSizeObj.maxwidth});});$("#mfPowerupResizeModalMinimizeBtn").off("click");$("#mfPowerupResizeModalMinimizeBtn").on("click",function(){$("#mfPowerupResizeModal").hide();$("#mfPowerupModalMaximizeIcon").show();});$("#mfPowerupModalMaximizeIcon").off("click");$("#mfPowerupModalMaximizeIcon").on("click",function(){$("#mfPowerupResizeModal").show();$("#mfPowerupModalMaximizeIcon").hide();});$("#mfPowerupResizeModalMinimalBtn").off("click");$("#mfPowerupResizeModalMinimalBtn").on("click",function(){$("#mfPowerupResizeModal").css({top:thisClass.frameSizeObj.mintop,left:thisClass.frameSizeObj.minleft,height:thisClass.frameSizeObj.minheight,width:thisClass.frameSizeObj.minwidth});});});$("#mfPowerupResizeModalTitle").text(title);$("#mfPowerupInterfaceIframeZoom").removeAttr("data-params");thisClass.powerupInterfaceModalCallback=onCloseCallback;thisClass.preventModalClose=false;$("#mfPowerupResizeModal").show();$(".mfPowerupResizeModalBtns").tooltip("destroy");$(".mfPowerupResizeModalBtns").tooltip();return;};this.closeResizeModal=function(){$("#mfPowerupResizeModalIframe").remove();$("#mfPowerupResizeModal").hide();$("#mfPowerupModalMaximizeIcon").hide();return;};this.showResizeModal=function(){$("#mfPowerupResizeModal").show();};this.addFile=function(file,options,callback){if(typeof file!="object"||file.size==0){callback({status:"fail",message:"File is not valid"});}else{var defaultOptions={pageId:mf_main.editorController.page.eid,scope:"project",limitFileSize:true,userDefinedPathId:null,thumbnail:false};var addFileOptions=$.extend({},defaultOptions,options);if(addFileOptions.limitFileSize&&(parseInt(file.size/1024,10)/1000)>50){callback({status:"fail",message:"File size should be less than 50MB"});}else{thisClass.addFileCallback=callback;var companyId=mf_main.editorController.projectObj.company;if(addFileOptions.scope=="user"){companyId=MF_UserSession.getUser().company;}var userDefinedPathId=null;if(addFileOptions.userDefinedPathId!=null){userDefinedPathId=addFileOptions.userDefinedPathId;}var fd=new FormData();fd.append("company",companyId);fd.append("size",(parseInt(file.size/1024,10)).toString());fd.append("username",MF_UserSession.getUser().username);fd.append("token",MF_UserSession.getUser().jwtToken);fd.append("password",MF_UserSession.getUser().password);fd.append("projectid",mf_main.editorController.projectObj.id);fd.append("pageid",addFileOptions.pageId);fd.append("scope",addFileOptions.scope);fd.append("thumbnail",addFileOptions.thumbnail);fd.append("powerupid",mf_main.editorController.powerupController.selectedPowerup.id);fd.append("name","Html 5 File API/FormData");fd.append("fileToUpload",file);if(file.type!=""){fd.append("mime",file.type);}else{fd.append("mime",file.name.split(".").pop());}fd.append("userDefinedPathId",userDefinedPathId);fd.append("uid",MF_Utils.guidGenerator());fd.append("limitFileSize",addFileOptions.limitFileSize);var xhr=new XMLHttpRequest();xhr.upload.addEventListener("progress",thisClass.uploadProgress,false);xhr.addEventListener("load",thisClass.uploadComplete,false);xhr.addEventListener("error",thisClass.uploadFailed,false);xhr.addEventListener("abort",thisClass.uploadCancelled,false);xhr.open("POST",MF_Global.serverURL()+"powerupfileupload");xhr.send(fd);}}};this.uploadComplete=function(){if(thisClass.addFileCallback!=null){var responseJson=JSON.parse(this.responseText.trim());var isThumbnail=false;if(responseJson.status=="success"&&responseJson.message.length>0){if(responseJson.thumbnail){thisClass.addFileCallback({status:"success",message:MF_Global.getS3CdnURL()+responseJson.message,thumbnail:"https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/"+responseJson.thumbnail});}else{thisClass.addFileCallback({status:"success",message:MF_Global.getS3CdnURL()+responseJson.message});}}else{thisClass.addFileCallback({status:"fail",message:responseJson.message});}thisClass.addFileCallback=null;}};this.uploadProgress=function(){};this.uploadFailed=function(){if(thisClass.addFileCallback!=null){thisClass.addFileCallback({status:"fail",message:"File upload failed"});thisClass.addFileCallback=null;}};this.uploadCancelled=function(evt){if(thisClass.addFileCallback!=null){thisClass.addFileCallback({status:"fail",message:"File upload cancelled"});thisClass.addFileCallback=null;}};this.removeFile=function(url,options,callback){var defaultOptions={pageId:mf_main.editorController.page.eid,scope:"project",folder:false};var removeFileOptions=$.extend({},defaultOptions,options);var clientid=mf_main.editorController.projectObj.company;var projectid=mf_main.editorController.projectObj.id;var powerupid=mf_main.editorController.powerupController.selectedPowerup.id;var isFolder=removeFileOptions.folder;var validPath="https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+mf_main.editorController.projectObj.company+"/projects/"+mf_main.editorController.projectObj.id+"/powerup/"+mf_main.editorController.powerupController.selectedPowerup.id;var validCDNPath=MF_Global.getS3CdnURL()+"app/wireframepro/company/"+mf_main.editorController.projectObj.company+"/projects/"+mf_main.editorController.projectObj.id+"/powerup/"+mf_main.editorController.powerupController.selectedPowerup.id;if(removeFileOptions.scope=="user"){projectid="";validPath="https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+mf_main.editorController.projectObj.company+"/powerup/"+mf_main.editorController.powerupController.selectedPowerup.id;validCDNPath=MF_Global.getS3CdnURL()+"app/wireframepro/company/"+mf_main.editorController.projectObj.company+"/powerup/"+mf_main.editorController.powerupController.selectedPowerup.id;}var blockui=false;if(removeFileOptions.pageId&&removeFileOptions.pageId=="blockui"){validPath="https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/blockui/";validCDNPath=MF_Global.getS3CdnURL()+"app/wireframepro/blockui/";blockui=true;}if(url.indexOf(validPath)>=0||url.indexOf(validCDNPath)>=0){if(url.indexOf(validPath)>=0){url=url.replace(validPath,"");}else{url=url.replace(validCDNPath,"");}if(blockui){url="/blockui/"+url;}MF_PowerupManager.deletePowerupFile(MF_UserSession.getUser(),clientid,projectid,powerupid,url,isFolder,{callback:function(response){if(response=="success"){callback({status:"success",message:"File deleted successfully"});}else{callback({status:"fail",message:"File deletion failed"});}}});}else{callback({status:"fail",message:"Invalid URL"});}};this.copyFile=function(fromurl,tourl,options,callback){var clientid=mf_main.editorController.projectObj.company;var projectid=mf_main.editorController.projectObj.id;var powerupid=mf_main.editorController.powerupController.selectedPowerup.id;var validPath="https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/wireframepro/company/"+mf_main.editorController.projectObj.company+"/projects/"+mf_main.editorController.projectObj.id+"/powerup/"+mf_main.editorController.powerupController.selectedPowerup.id;if(fromurl.indexOf(validPath)>=0&&tourl.indexOf(validPath)>=0){fromurl=fromurl.replace(validPath,"");tourl=tourl.replace(validPath,"");MF_PowerupManager.copyPowerupFile(MF_UserSession.getUser(),clientid,projectid,powerupid,fromurl,tourl,{callback:function(response){if(response=="success"){callback({status:"success",message:"File copied successfully"});}else{callback({status:"fail",message:"File copy failed"});}}});}else{callback({status:"fail",message:"Invalid URL"});}};this.getProjectInfo=function(callback){var projectInfo={};projectInfo.id=mf_main.editorController.projectObj.id;projectInfo.name=mf_main.editorController.projectObj.title;projectInfo.thumbnailUrl=mf_main.editorController.projectObj.thumbnailURL;projectInfo.company=mf_main.editorController.projectObj.company;projectInfo.creator=mf_main.editorController.projectObj.creator;projectInfo.collaborators=mf_main.editorController.projectObj.collaborators;projectInfo.spaceId=mf_main.editorController.projectObj.spaceId;projectInfo.powerupId=mf_main.editorController.powerupController.selectedPowerup.id;projectInfo.powerupInstallId=mf_main.editorController.powerupController.selectedPowerup.installationid;projectInfo.publicURL=null;if(mf_main.editorController.projectObj.published){projectInfo.publicURL=MF_Global.serverURL()+"/view/"+mf_main.editorController.projectObj.publicURL;}callback(projectInfo);return;};this.getProjectFavouriteColors=function(callback){callback(mf_main.editorController.projectObj.favouriteColors);};this.warnUserOnModalClose=function(flag){thisClass.preventModalClose=false;if(flag===true){thisClass.preventModalClose=true;}return;};this.getWarnUserOnModalClose=function(callback){callback(thisClass.preventModalClose);};this.setSideBarRefresh=function(flag){if(mf_main.editorController.powerupController.selectedPowerup){thisClass.refreshSideBar[mf_main.editorController.powerupController.selectedPowerup.id]=flag;}return;};this.getSideBarRefresh=function(callback){var ref=true;if(mf_main.editorController.powerupController.selectedPowerup){ref=thisClass.refreshSideBar[mf_main.editorController.powerupController.selectedPowerup.id];}if(ref!=true&&ref!=false){ref=true;}callback(ref);};this.isWizardActive=function(callback){callback(mf_main.editorController.isWizardActive);mf_main.editorController.isWizardActive=false;};this.getCurrentDesktopVersion=function(callback){try{if(mf_main.desktopver){callback(mf_main.desktopver);}else{callback(require("electron").remote.app.getVersion());}}catch(e){callback(null);}};this.openDesktopWindow=function(url,options){thisClass.proxyWindowUrl=url;var defaultOptions={show:true};var openWindowOptions=$.extend({},defaultOptions,options);if(typeof mf_appmain!="undefined"){const remote=require("electron").remote;const BrowserWindow=remote.BrowserWindow;const path=require("path");thisClass.openNewProxyWindow=false;if(thisClass.desktopProxyWindow){thisClass.openNewProxyWindow=true;thisClass.desktopProxyWindow.destroy();thisClass.desktopProxyWindow=null;}else{thisClass.desktopProxyWindow=new BrowserWindow({webPreferences:{nodeIntegration:false,webSecurity:false,preload:path.join(__dirname,"powerups/powerup-window-preload.js"),contextIsolation:false},show:openWindowOptions.show,});thisClass.desktopProxyWindow.on("closed",function(){thisClass.desktopProxyWindow=null;if(thisClass.openNewProxyWindow){thisClass.openDesktopWindow(thisClass.proxyWindowUrl,options);}});thisClass.desktopProxyWindow.loadURL(thisClass.proxyWindowUrl);}}return;};this.closeModal=function(){$("#mfPowerupInterfaceModal").modal("hide");return;};this.createRevision=function(title,callback){var title=title.trim();if(title.length==0){callback({status:"fail",message:"Invalid Title"});}else{$("#mfRevisionNote").val(title);var revisionObj=mf_main.editorController.revisionController.addRevision();callback({status:"success",message:revisionObj.id});}};this.previewRevision=function(revisionId){MF_RevisionManager.list(MF_UserSession.getUser(),mf_main.editorController.projectObj.company,mf_main.editorController.projectObj.id,mf_main.editorController.page.eid,false,{callback:function(arr){if(arr!=null){for(var i=0;i<arr.length;i++){var citem=new MF_Revision();citem.cast(arr[i]);mf_main.editorController.revisionController.revisionCollection.addItem(citem);}mf_main.editorController.revisionController.selectedRevision=mf_main.editorController.revisionController.getRevisionByHTMLID("mfRevisionItem"+revisionId);if(mf_main.editorController.revisionController.selectedRevision!=null){mf_main.editorController.revisionController.previewRevision();}else{alert("Selected revision does not exist. It may have been deleted.");}}}});};this.exportPDF=function(pageList,callback){var localfile="File_"+mf_main.editorController.guidGenerator();var keyname="app/wireframepro/fileexport/Export_"+mf_main.editorController.guidGenerator()+".pdf";var imageArray=new Array();for(var i=0;i<pageList.length;i++){var expPage=mf_main.editorController.pageController.getPagebyID("mfPageItem"+pageList[i]);var pageExport=new MF_PageExport();pageExport.id=expPage.eid;pageExport.name=expPage.pageName;pageExport.path="app/wireframepro/company/"+mf_main.editorController.projectObj.company+"/projects/"+mf_main.editorController.projectObj.id+"/pages/"+pageExport.id+"/image/"+pageExport.id+".png";imageArray.push(pageExport);}MF_ExportManager.exportPDF(mf_main.editorController.projectObj.title,keyname,localfile,imageArray,mf_main.editorController.projectObj,"portrait","A4","no","yes",MF_UserSession.getUser(),mf_main.PUBLIC,false,false,{callback:function(res){if(res=="success"){callback({status:"success",message:MF_Global.getS3URL()+keyname});}else{callback({status:"fail",message:"PDF export failed"});}}});};this.addComment=function(message,attachmentFile,fileName,options,callback){var defaultOptions={pageId:mf_main.editorController.page.eid};var addCommentOptions=$.extend({},defaultOptions,options);message=message.trim();message=Handlebars.Utils.escapeExpression(message);if(message.length==0){callback({status:"fail",message:"Comment cannot be empty"});return;}var feedback=new MF_Feedback();feedback.id=MF_Utils.guidGenerator();feedback.creator=MF_UserSession.getUser().username;feedback.creatorName=MF_UserSession.getUser().firstName+" "+MF_UserSession.getUser().lastName;feedback.clientid=mf_main.editorController.projectObj.company;feedback.createDate=new Date();feedback.projectid=mf_main.editorController.projectObj.id;feedback.pageid=addCommentOptions.pageId;feedback.message=message;feedback.canDelete=true;if(attachmentFile!=null){thisClass.uploadCommentAttachmentFile(attachmentFile,fileName,feedback,callback);}else{thisClass.addCommentToServer(feedback,callback);}};this.updateTextInComponents=function(comps,options,callback){var complist=new Array();var undoarr=new Array();var comptext=new Object();for(var i=0;i<comps.length;i++){var comp=mf_main.editorController.getComponentById(comps[i].eid);if(comp&&comps[i].text){comptext[comp.eid]=MF_Utils.htmlEscape(comps[i].text);if(comp.NAME=="MF_DataGrid"){comptext[comp.eid]=comptext[comp.eid].replaceAll(/[،，、]/g,",");}complist.push(comp);if(mf_main.editorController.lastTextEditComp){mf_main.editorController.stopEditingText();}}else{if(comps[i].compName=="MF_AdvancedDataGrid"){complist.push(comp);var textArrayObj=comps[i].textArray;var layoutJSONObj=JSON.parse(JSON.stringify(comp.layoutJSON));for(var j=0;j<layoutJSONObj.gridLayout.length;j++){for(var k=0;k<layoutJSONObj.gridLayout[j].length;k++){var cell=layoutJSONObj.gridLayout[j][k];var textObj=textArrayObj.find(function(obj){return obj.cid===cell.id;});if(textObj){cell.text=MF_Utils.htmlEscape(textObj.text);}}}comptext[comp.eid]=layoutJSONObj;if(mf_main.editorController.lastTextEditComp){mf_main.editorController.stopEditingText();}}else{if(comps[i].eid=="newtextcomponent"){try{var initoffset=mf_main.componentList.getInitOffsets();var newComp=mf_main.componentList.invokeComponent("MF_Text","new",initoffset.offsetXPos,initoffset.offsetYPos);comptext[newComp.eid]=MF_Utils.htmlEscape(comps[i].text);complist.push(newComp);}catch(e){}}}}}for(var j=0;j<complist.length;j++){try{var txtcomp=complist[j];if(txtcomp.NAME=="MF_AdvancedDataGrid"){var undo=new MF_UndoDAO();undo.propSingleUndo(txtcomp,"gridLayout",JSON.stringify(txtcomp.layoutJSON));undoarr.push(undo);txtcomp.e2xml.addPropSingle("gridLayout",JSON.stringify(comptext[txtcomp.eid]),"default");txtcomp.render(false);}else{var undo=new MF_UndoDAO();undo.propSingleUndo(txtcomp,"text",txtcomp.text);undoarr.push(undo);txtcomp.e2xml.addPropSingle("text",comptext[txtcomp.eid],"default");txtcomp.render(false);}}catch(e){}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}callback({status:"success",message:"Translated selected components"});};this.getComponentSpecs=function(callback,options){mf_main.editorController.powerupCallback=callback;try{if(options.hasOwnProperty("type")&&options.type=="powerup-pagepreview"){if(MF_ChangeManager.getCHANGED()==true){mf_main.editorController.saveProject();}mf_main.editorController.powerupData.translatedComponentList=new Array();mf_main.editorController.powerupData.translatedComponentText=new Object();mf_main.editorController.enableSelectMode("powerup-pagepreview");var translatedData=JSON.parse(options.transData);var comptext=new Object();for(var i=0;i<translatedData.length;i++){if(translatedData[i].compId&&translatedData[i].targetText){var component=mf_main.editorController.getComponentByLid(translatedData[i].compId);if(component){comptext[translatedData[i].compId]=MF_Utils.htmlEscape(MF_Utils.htmlDecode(translatedData[i].targetText));mf_main.editorController.powerupData.translatedComponentList.push(component);}}}var complist=mf_main.editorController.powerupData.translatedComponentList;for(var j=0;j<complist.length;j++){try{var txtcomp=complist[j];mf_main.editorController.powerupData.translatedComponentText[txtcomp.lid]=txtcomp.text;txtcomp.e2xml.addPropSingle("text",comptext[txtcomp.lid],"default");txtcomp.render(false);}catch(e){}}}else{if(typeof mf_main.editorController.powerupCallbackOptions=="object"){mf_main.editorController.powerupCallbackOptions=options;mf_main.editorController.pageController.selectPage("mfPageItem"+options.selectedPageId);mf_main.editorController.viewPage(mf_main.editorController.pageController.selectedPage);}else{mf_main.editorController.enableSelectMode("powerup-specsmode");}}}catch(e){}};this.cleanupPowerupData=function(){if(mf_main.editorController.SELECTMODE_TYPE=="powerup-pagepreview"){mf_main.VIEWER=false;mf_main.editorController.disableSelectMode();if(mf_main.editorController.currentSelectModeState){mf_main.editorController.showEditor();}else{mf_main.editorController.showPreview();}mf_main.editorController.showNavBar();if(mf_main.editorController.powerupData.hasOwnProperty("translatedComponentList")){var compList=mf_main.editorController.powerupData.translatedComponentList;for(var j=0;j<compList.length;j++){try{var txtcomp=compList[j];txtcomp.e2xml.addPropSingle("text",mf_main.editorController.powerupData.translatedComponentText[txtcomp.lid],"default");txtcomp.render(false);}catch(e){}}}}mf_main.editorController.powerupData=new Object();};this.getServerS3URL=function(callback,options){var url="";if(options&&options.cdnURL){url=MF_Global.cdnURL();}else{url=MF_Global.getS3URL()+"app/wireframepro/company/"+mf_main.editorController.projectObj.company+"/projects/"+mf_main.editorController.projectObj.id+"/powerup/"+mf_main.editorController.powerupController.selectedPowerup.id+"/page/";}callback(url);};this.getSelectedComponent=function(callback){mf_main.editorController.powerupCallback=callback;mf_main.editorController.enableSelectMode("powerup-selectedcomponent");};this.addCommentToServer=function(feedback,callback){MF_FeedbackManager.create(MF_UserSession.getUser(),mf_main.PUBLIC,mf_main.editorController.projectObj.company,feedback,false,{callback:function(arr){if(arr!=null){mf_main.editorController.commentController.cachedPageComments[feedback.pageid]=arr;mf_main.rtc.commentSync("addComment",feedback);callback({status:"success",message:"Comment posted successfully"});try{var selectedPage=MF_PagePool.getPage(feedback.pageid);var getActivePage=mf_main.editorController.pageController.selectedPage;if(getActivePage&&getActivePage.eid==feedback.pageid){var template=mf_main.getTemplateFromCache("mfCommentItemTemplate");if(template){$("#mfPageSidebarComments").prepend(template(feedback));mf_main.editorController.commentController.commentCollection.addItemAt(feedback,0);mf_main.editorController.commentController.bindCommentEvents();}}if(selectedPage){selectedPage.comments++;}mf_main.editorController.commentController.setCommentNum();var logcmd="COMMENTED";var logdata={projectid:mf_main.editorController.projectObj.id,projectname:mf_main.editorController.projectObj.title,pageid:feedback.pageid};var logMessage=mf_main.logController.getLogMessage(logcmd,logdata);var rtcObj=new MF_EditorRTCItem();rtcObj.logcmd=logcmd;rtcObj.logdata=logdata;rtcObj.messageStr=logMessage;rtcObj.collaborators=mf_main.editorController.powerupController.getRTCCollaboratorList();mf_main.dashboardRtcController.notification_sync(rtcObj);mf_main.logController.logSpaceAction(logcmd,logMessage,logdata,rtcObj.collaborators);}catch(e){}}}});};this.uploadCommentAttachmentFile=function(uploadFile,fileName,feedback,callback){var currentUploadID=MF_Utils.guidGenerator();var attached="file";var filetype="";var arr2=fileName.split(".");if(arr2.length>1){filetype=arr2[arr2.length-1];}else{filetype="";}if(filetype=="png"||filetype=="gif"||filetype=="jpg"){attached="image";}feedback.attached=filetype;var fd=new FormData();fd.append("company",mf_main.editorController.projectObj.company);fd.append("type",attached);fd.append("ext",filetype);fd.append("size",(parseInt(uploadFile.size/1024,10)).toString());fd.append("username",MF_UserSession.getUser().username);fd.append("projectid",mf_main.editorController.projectObj.id);fd.append("name","Html 5 File API/FormData");fd.append("fileToUpload",uploadFile);fd.append("mime",uploadFile.type);fd.append("uid",currentUploadID);fd.append("pageid",feedback.pageid);fd.append("feedbackid",feedback.id);var xhr=new XMLHttpRequest();xhr.upload.addEventListener("progress",thisClass.commentAttachmentUploadProgress,false);xhr.addEventListener("load",thisClass.commentAttachmentUploadComplete.bind(null,feedback,callback),false);xhr.addEventListener("error",thisClass.commentAttachmentUploadFailed,false);xhr.addEventListener("abort",thisClass.commentAttachmentUploadCanceled,false);xhr.open("POST",MF_Global.serverURL()+"attach");xhr.send(fd);};this.commentAttachmentUploadComplete=function(feedback,callback){thisClass.addCommentToServer(feedback,callback);};this.commentAttachmentUploadProgress=function(){};this.commentAttachmentUploadFailed=function(){callback({status:"fail",message:"File upload failed"});};this.commentAttachmentUploadCancelled=function(evt){callback({status:"fail",message:"File upload cancelled"});};this.getProjectUsers=function(callback){var userList=new Array();if(mf_main.editorController.projectObj.collaborators){for(var i=0;i<mf_main.editorController.projectObj.collaborators.length;i++){var userObj={email:mf_main.editorController.projectObj.collaborators[i].userid,userType:mf_main.editorController.projectObj.collaborators[i].type};userList.push(userObj);}}callback(userList);return;};this.getRTCCollaboratorList=function(){var userList=new Array();if(mf_main.editorController.projectObj.collaborators){for(var i=0;i<mf_main.editorController.projectObj.collaborators.length;i++){userList.push(mf_main.editorController.projectObj.collaborators[i].userid);}}return userList;};this.sendEmail=function(toEmail,subject,content,callback){if(toEmail.trim().length==0||subject.trim().length==0||content.trim().length==0){callback({status:"fail",message:"Email, Subject and Content are required"});}else{MF_PowerupManager.sendEmail(MF_UserSession.getUser(),mf_main.editorController.projectObj,toEmail,subject,content,{callback:function(res){if(res=="success"){callback({status:"success",message:"Email sent successfully"});}else{callback({status:"fail",message:"Could not send email"});}}});}};this.sendMessage=function(targetFrame,message){if(targetFrame=="sidebar"){if(mf_main.editorController.powerupController.selectedPowerup.source=="url"){var iframeWindow=$("#mfPowerupDataScreen_"+mf_main.editorController.powerupController.selectedPowerup.id+" iframe")[0].contentWindow;var response={method:"receiveMessage",value:message};iframeWindow.postMessage(response,"*");}else{if(thisClass.receiveMessageCallback!=null){thisClass.receiveMessageCallback();}}}else{if(targetFrame=="modal"&&$("#mfPowerupInterfaceModal").css("display")=="block"){var iframeWindow=$("#mfPowerupInterfaceIframe")[0].contentWindow;var response={method:"receiveMessage",value:message};iframeWindow.postMessage(response,"*");}else{if(targetFrame=="resizemodal"){if($("#mfPowerupResizeModalIframe")[0]){var iframeWindow=$("#mfPowerupResizeModalIframe")[0].contentWindow;var response={method:"receiveMessage",value:message};iframeWindow.postMessage(response,"*");}}}}};this.receiveMessage=function(callback){thisClass.receiveMessageCallback=callback;};this.displayActionIndicator=function(msg){MF_Utils.display_ActionIndicator(msg);return;};this.getPublicURL=function(data,callback){if(mf_main.editorController.powerupController.selectedPowerup.isPublic){if(mf_main.editorController.projectObj.share){var publicURL=MF_Global.serverURL()+"view/viewpowerup&powerupdata="+mf_main.editorController.projectObj.id+"#/page/"+mf_main.editorController.page.eid+"/powerup/"+mf_main.editorController.powerupController.selectedPowerup.id+"/powerupdata/"+btoa(data);callback({status:"success",message:publicURL});}else{callback({status:"fail",message:"Project is not shared as public"});}}else{callback({status:"fail",message:"Powerup is not enabled for public"});}};this.getPowerupPublicURL=function(data,callback){var publicURL=MF_Global.serverURL()+"poweruppublic.jsp?powerupdata="+btoa(data);callback({status:"success",message:publicURL});};this.getPublicDetails=function(callback){var response={isPublic:mf_main.PUBLIC,data:null};if(mf_main.PUBLIC&&mf_main.editorController.powerupController.powerupPublicData!=null){try{response.data=atob(mf_main.editorController.powerupController.powerupPublicData);}catch(e){response.data=null;}}callback(response);};this.showPublicNotFoundPlaceholder=function(message){if(mf_main.PUBLIC){$("#mfPowerupPublicLoader").hide();if(typeof message!="undefined"&&message!=null&&message!=""){$("#mfPowerupPublicPlaceholderContent").text(message);}$("#mfPowerupPublicNotFoundPlaceholder").show();}};this.setTraceImage=function(file,options,callback){if(mf_main.editorController.EDITOR){if(typeof file!="object"||file.size==0){callback({status:"fail",message:"File is not valid"});}else{var defaultOptions={pageId:mf_main.editorController.page.eid};var setTraceOptions=$.extend({},defaultOptions,options);if($("#mfPageTracer"+setTraceOptions.pageId).length>0){$("#mfPageTracer"+setTraceOptions.pageId).remove();}$("#mfContainerPage").append('<div unselectable="on" id="mfPageTracer'+setTraceOptions.pageId+'" class="mfPageTracer" style="top: 100px; left: 100px; background-color: rgba(255,255,255,0);  height: 100px; width: 100px; position: absolute; overflow: hidden; display: none; " ></div>');$("#mfPageTracer"+setTraceOptions.pageId).append('<img id="mfPageTracerImg'+setTraceOptions.pageId+'" src="https://cdn.hasselblad.com/samples/B0001395.jpg" style="-webkit-user-drag: none; user-select: none; position: absolute; opacity: 1; width: auto; height: auto; left: 0px; top: 0px; border-radius: 0px; ">');var reader=new FileReader();reader.onload=function(e){$("#mfPageTracerImg"+setTraceOptions.pageId).on("load",function(){$("#mfPageTracer"+setTraceOptions.pageId).height($("#mfPageTracerImg"+setTraceOptions.pageId).height());$("#mfPageTracer"+setTraceOptions.pageId).width($("#mfPageTracerImg"+setTraceOptions.pageId).width());});$("#mfPageTracerImg"+setTraceOptions.pageId).attr("src",e.target.result);};reader.readAsDataURL(file);if(setTraceOptions.pageId==mf_main.editorController.page.eid){$("#mfPageTracer"+setTraceOptions.pageId).show();}callback({status:"success",message:"Tracer set successfully"});}}else{callback({status:"fail",message:"Tracer can be applied only in editor mode."});}};this.removeTraceImage=function(options,callback){if(mf_main.editorController.EDITOR){var defaultOptions={pageId:mf_main.editorController.page.eid};var removeTraceOptions=$.extend({},defaultOptions,options);if($("#mfPageTracer"+removeTraceOptions.pageId).length>0){$("#mfPageTracer"+removeTraceOptions.pageId).remove();callback({status:"success",message:"Tracer removed successfully"});}else{callback({status:"fail",message:"Tracer not available for the page"});}}else{callback({status:"fail",message:"Tracer can be removed only in editor mode."});}};this.isTraceImageSet=function(options,callback){var defaultOptions={pageId:mf_main.editorController.page.eid};var isTraceImageSetOptions=$.extend({},defaultOptions,options);if($("#mfPageTracer"+isTraceImageSetOptions.pageId).length>0){callback({status:"success",message:true});}else{callback({status:"success",message:false});}};this.addFavColorHandler=function(selectedColor,callback){mf_main.editorController.favouriteColorController.addFavColorHandler(selectedColor);callback(true);return;};this.getProjectFontList=function(options,callback){if(mf_main.editorController.fontController.customFontListLoaded){thisClass.getProjectFontListCallbackHandler(callback);}else{mf_main.editorController.fontController.getCustomFontsList(function(){thisClass.getProjectFontListCallbackHandler(callback);});}};this.isPinnedPowerup=function(options,callback){var response={method:"receiveMessage",value:mf_main.editorController.powerupController.selectedPowerup.isPinnedToSpace};iframeWindow.postMessage(response,"*");};this.isPowerupOpen=function(options,callback){var response={method:"receiveMessage",value:mf_main.isPowerupOpen};iframeWindow.postMessage(response,"*");};this.isPowerupSpaceOpen=function(options,callback){var response={method:"receiveMessage",value:mf_main.PINPOWERUP};iframeWindow.postMessage(response,"*");};this.getSelectedComponents=function(options,callback){thisClass.getSelectedComponentsCallbackHandler(options,callback);};this.getProjectFontListCallbackHandler=function(callback){var fontList={builtin:[],custom:[],used:[]};for(var i=0;i<mf_main.editorController.fontController.fontArray.length;i++){var fontObj=mf_main.editorController.fontController.fontArray[i];if(fontObj.id&&fontObj.id=="sourcesanspro"){var fontRef={fontKey:fontObj.id,fontDisplayName:fontObj.name,fontFamily:fontObj.type,css:"css/fonts/"+fontObj.id+"/stylesheet.css"};fontList.builtin.push(fontRef);}if(fontObj.embedded&&!fontObj.isGoogleFont&&!fontObj.isCustomFont){var fontRef={fontKey:fontObj.id,fontDisplayName:fontObj.name,fontFamily:fontObj.type,css:"css/fonts/"+fontObj.id+"/stylesheet.css"};fontList.builtin.push(fontRef);}else{if(!fontObj.embedded&&!fontObj.isGoogleFont&&fontObj.isCustomFont){var fontRef={id:fontObj.customFontId,fontKey:fontObj.id,fontDisplayName:fontObj.name,fontFamily:fontObj.type,extType:fontObj.extType,css:MF_Global.getS3URL()+"app/wireframepro/company/"+fontObj.clientid+"/projects/"+fontObj.projectid+"/fonts/"+fontObj.customFontId+".css",ttf:MF_Global.getS3URL()+"app/wireframepro/company/"+fontObj.clientid+"/projects/"+fontObj.projectid+"/fonts/"+fontObj.customFontId+".ttf",fontPath:MF_Global.getS3URL()+"app/wireframepro/company/"+fontObj.clientid+"/projects/"+fontObj.projectid+"/fonts/"+fontObj.customFontId};fontList.custom.push(fontRef);}}}for(var fontKey in mf_main.editorController.fontController.usedFonts){var fontRef={fontKey:fontKey,fontFamily:mf_main.editorController.fontController.usedFonts[fontKey].fontFamily,isGoogleFont:mf_main.editorController.fontController.usedFonts[fontKey].isGoogleFont};fontList.used.push(fontRef);}callback({status:"success",message:fontList});};this.getSelectedComponentList=function(arr,selects,selectionType){var isSave=false;for(var i=0;i<selects.length;i++){var select=selects[i];if(select.component){if(select.component.EDITABLE&&!select.component.BYOC){var obj=new Object();obj.eid=select.component.eid;obj.text=select.component.text;if(select.component.NAME=="MF_AdvancedDataGrid"){obj.compName=select.component.NAME;obj.layoutJSON=select.component.layoutJSON;}if(selectionType&&selectionType=="powerup-i18n"){obj.compName=select.component.NAME;if(select.component.lid==null||select.component.lid==""){select.component.lid="lnk_"+mf_main.editorController.guidGenerator();if(!isSave){isSave=true;}}obj.lid=select.component.lid;}if(selectionType&&selectionType=="currenttext"){if(select.component.NAME=="MF_Text"){arr.push(obj);}}else{if(selectionType&&selectionType=="currentimage"){if(select.component.NAME=="MF_ImageComp"){arr.push(obj);}}else{if(obj.text!=""){arr.push(obj);}else{if(select.component.NAME=="MF_AdvancedDataGrid"){arr.push(obj);}}}}}}else{if(select.GROUP){var groupObj=mf_main.editorController.page.groupManager.groups[select.GROUPID];if(groupObj){var compselects=new Array();for(var i2=0;i2<groupObj.children.size();i2++){var component=groupObj.children.getItemAt(i2);compselects.push(component.selector);}thisClass.getSelectedComponentList(arr,compselects);}}}}if(isSave){mf_main.editorController.page.changed=true;mf_main.editorController.saveProject();}};this.getSelectedComponentsCallbackHandler=function(selectionType,callback){var components=new Array();if(selectionType=="all"||selectionType=="powerup-i18n"){var compselects=new Array();for(var i=0;i<mf_main.editorController.page.childComponents.size();i++){var component=mf_main.editorController.page.childComponents.getItemAt(i);compselects.push(component.selector);}thisClass.getSelectedComponentList(components,compselects,selectionType);}else{thisClass.getSelectedComponentList(components,mf_main.editorController.componentSelect,selectionType);}callback({status:"success",message:components});};this.loadPageComponents=function(pageId,callback){var status="error";if(pageId){if(!mf_main.editorController.powerupCallbackOptions){mf_main.editorController.powerupCallbackOptions=new Object();mf_main.editorController.powerupCallbackOptions.currentPageId=mf_main.editorController.page.eid;mf_main.editorController.powerupCallbackOptions.isResetPage=true;}mf_main.editorController.pageController.selectPage("mfPageItem"+pageId);mf_main.editorController.viewPage(mf_main.editorController.pageController.selectedPage);status="success";}callback({status:status,message:"Page Loaded"});};this.putPublicData=function(name,value,powerupDataName,options,callback){var defaultOptions={isPublic:false,publicURL:null,pageId:null,itemId:null,isSaveURL:false,isDeleteSection:false,pinProjectId:null,};var putDataOptions=$.extend({},defaultOptions,options);var compressedData="";var isBase64Data=false;try{var binaryString=pako.gzip(value,{to:"string"});compressedData=btoa(binaryString);isBase64Data=true;}catch(e){compressedData=value;}MF_PowerupManager.putStorePublicData(name,compressedData,"project",powerupDataName,JSON.stringify(putDataOptions),isBase64Data,{callback:function(response){response=JSON.parse(response);callback(response);}});return;};this.getOpenAICredits=function(callback){var responseData={creditsTextAvailable:mf_main.editorController.aiManagerController.creditsTextAvailable,creditsTextTotal:mf_main.editorController.aiManagerController.creditsTextTotal,creditsImageAvailable:mf_main.editorController.aiManagerController.creditsImageAvailable,creditsImageTotal:mf_main.editorController.aiManagerController.creditsImageTotal};callback(responseData);};this.updateOpenAICredits=function(creditType,credits,callback){if(creditType=="text"){mf_main.editorController.aiManagerController.creditsTextAvailable=mf_main.editorController.aiManagerController.creditsTextAvailable-credits;}else{if(creditType=="image"){mf_main.editorController.aiManagerController.creditsImageAvailable=mf_main.editorController.aiManagerController.creditsImageAvailable-credits;}}return true;};this.postMessageListener=function(event){var message=event.data;if(message.method=="getPageID"){thisClass.getPageID(function(pageID){var response={method:message.method,pageID:pageID};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="getRandomString"){thisClass.getRandomString(function(randomString){var response={method:message.method,randomString:randomString};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="uploadImage"){thisClass.uploadImage(message.file,message.filename,message.options);var response={method:message.method};thisClass.exceptionHandlingBlock(response,event);}else{if(message.method=="getData"){thisClass.getData(message.name,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="putData"){thisClass.putData(message.name,message.value,message.scope,message.options,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="deleteData"){thisClass.deleteData(message.name,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="getUserInfo"){thisClass.getUserInfo(function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="getAssetPath"){thisClass.getAssetPath(function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="getPageList"){thisClass.getPageList(function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="getSavedCompList"){thisClass.getSavedCompList(function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="getPageInfo"){thisClass.getPageInfo(function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="openModal"){if(mf_main.editorController.powerupController.selectedPowerup){thisClass.refreshSideBar[mf_main.editorController.powerupController.selectedPowerup.id]=false;}thisClass.openModal(message.url,message.title,function(){var response={method:"modalCloseCallback"};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="openResizeModal"){if(mf_main.editorController.powerupController.selectedPowerup){thisClass.refreshSideBar[mf_main.editorController.powerupController.selectedPowerup.id]=false;}thisClass.openResizeModal(message.url,message.title,message.attributes,message.framesize,function(){var response={method:"modalCloseCallback"};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="closeResizeModal"){thisClass.closeResizeModal();var response={method:message.method};thisClass.exceptionHandlingBlock(response,event);}else{if(message.method=="showResizeModal"){thisClass.showResizeModal();var response={method:message.method};thisClass.exceptionHandlingBlock(response,event);}else{if(message.method=="sendMessage"){thisClass.sendMessage(message.targetFrame,message.message);var response={method:message.method};thisClass.exceptionHandlingBlock(response,event);}else{if(message.method=="addFile"){thisClass.addFile(message.file,message.options,function(value){var response={method:message.method,value:value};if(typeof event.source!=="undefined"){thisClass.exceptionHandlingBlock(response,event);}});}else{if(message.method=="removeFile"){thisClass.removeFile(message.url,message.options,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="copyFile"){thisClass.copyFile(message.fromurl,message.tourl,message.options,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="getProjectInfo"){thisClass.getProjectInfo(function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="warnUserOnModalClose"){thisClass.warnUserOnModalClose(message.flag);var response={method:message.method};thisClass.exceptionHandlingBlock(response,event);}else{if(message.method=="getWarnUserOnModalClose"){thisClass.getWarnUserOnModalClose(function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="setSideBarRefresh"){thisClass.setSideBarRefresh(message.flag);var response={method:message.method};thisClass.exceptionHandlingBlock(response,event);}else{if(message.method=="getSideBarRefresh"){thisClass.getSideBarRefresh(function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="isWizardActive"){thisClass.isWizardActive(function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="refreshOtherUsers"){thisClass.refreshOtherUsers(message.data);var response={method:message.method};thisClass.exceptionHandlingBlock(response,event);}else{if(message.method=="getCurrentDesktopVersion"){thisClass.getCurrentDesktopVersion(function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="openDesktopWindow"){thisClass.openDesktopWindow(message.url,message.options);var response={method:message.method};thisClass.exceptionHandlingBlock(response,event);}else{if(message.method=="closeModal"){thisClass.closeModal();var response={method:message.method};thisClass.exceptionHandlingBlock(response,event);}else{if(message.method=="createRevision"){thisClass.createRevision(message.title,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="previewRevision"){thisClass.previewRevision(message.revisionId);var response={method:message.method};thisClass.exceptionHandlingBlock(response,event);}else{if(message.method=="exportPDF"){thisClass.exportPDF(message.pageList,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="addComment"){thisClass.addComment(message.message,message.attachmentFile,message.fileName,message.options,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="updateTextInComponents"){thisClass.updateTextInComponents(message.components,message.options,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="getComponentSpecs"){thisClass.getComponentSpecs(function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);},message.options);}else{if(message.method=="getS3URL"){thisClass.getServerS3URL(function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);},message.options);}else{if(message.method=="getSelectedComponent"){thisClass.getSelectedComponent(function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="getProjectUsers"){thisClass.getProjectUsers(function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="sendEmail"){thisClass.sendEmail(message.toEmail,message.subject,message.content,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="displayActionIndicator"){thisClass.displayActionIndicator(message.message);var response={method:message.method};thisClass.exceptionHandlingBlock(response,event);}else{if(message.method=="getPublicURL"){thisClass.getPublicURL(message.data,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="getPowerupPublicURL"){thisClass.getPowerupPublicURL(message.data,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="getPublicDetails"){thisClass.getPublicDetails(function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="showPublicNotFoundPlaceholder"){thisClass.showPublicNotFoundPlaceholder(message.message);var response={method:message.method};thisClass.exceptionHandlingBlock(response,event);}else{if(message.method=="setTraceImage"){thisClass.setTraceImage(message.file,message.options,function(value){var response={method:message.method,value:value};if(typeof event.source!=="undefined"){thisClass.exceptionHandlingBlock(response,event);}});}else{if(message.method=="removeTraceImage"){thisClass.removeTraceImage(message.options,function(value){var response={method:message.method,value:value};if(typeof event.source!=="undefined"){thisClass.exceptionHandlingBlock(response,event);}});}else{if(message.method=="isTraceImageSet"){thisClass.isTraceImageSet(message.options,function(value){var response={method:message.method,value:value};if(typeof event.source!=="undefined"){thisClass.exceptionHandlingBlock(response,event);}});}else{if(message.method=="addFavColor"){thisClass.addFavColorHandler(message.selColor,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="getProjectFontList"){thisClass.getProjectFontList(message.options,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="getSelectedComponents"){thisClass.getSelectedComponents(message.options,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="exportFontsToZip"){thisClass.exportFontsToZip(message.userDefinedPathId,message.pageId,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="addSecureKeyHashTokenForPowerup"){thisClass.addSecureKeyHashTokenForPowerup(message.publicid,message.privateid,function(value){var response={method:message.method,value:value};event.source.postMessage(response,event.origin);});}else{if(message.method=="powerupNotification"){thisClass.sendPowerupNotification(message.message,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="openloomsdk"){thisClass.openloomsdk(message.message,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.pluginMessage&&message.pluginMessage.method=="FigmaImage"){if(message.pluginMessage.errMsg==""){var imageData=new Blob([message.pluginMessage.file],{type:"image/png"});thisClass.uploadImage(imageData,message.pluginMessage.fileName,{});}else{mf_main.closeDialog();alert(message.pluginMessage.errMsg);}}else{if(message.method=="getProjectFavouriteColors"){thisClass.getProjectFavouriteColors(function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="pinPowerup"){thisClass.pinPowerup(message.options,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="unpinPowerup"){thisClass.unpinPowerup(message.options,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="saveUIBlock"){thisClass.saveUIBlock(message.options,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="getUIBlock"){thisClass.getUIBlock(message.options,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="listUIBlocks"){thisClass.listUIBlocks(message.options,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="addBlock2Wireframe"){thisClass.addBlock2Wireframe(message.options,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="addBlockComponent"){thisClass.addBlockComponent(message.options,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="deleteUIBlock"){thisClass.deleteUIBlock(message.options,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="checkIsDesignSpace"){thisClass.checkIsDesignSpace(function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="isPowerupOpen"){thisClass.getPowerupPinData(message.options,function(value){var response={method:message.method,value:mf_main.isPowerupOpen,data:value,isPowerupEditorCreate:mf_main.isPowerupEditorCreate,powerupEditorCreateTitle:mf_main.powerupEditorCreateTitle};mf_main.isPowerupEditorCreate=false;thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="isPowerupSpaceOpen"){var response={method:message.method,value:mf_main.PINPOWERUP,isPowerupEditorCreate:mf_main.isPowerupEditorCreate,powerupEditorCreateTitle:mf_main.powerupEditorCreateTitle};mf_main.isPowerupOpen=false;mf_main.isPowerupEditorCreate=false;thisClass.exceptionHandlingBlock(response,event);}else{if(message.method=="isPinnedPowerup"){thisClass.getPinnedPowerupData(message.options,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="getProjectFavouriteColors"){thisClass.getProjectFavouriteColors(function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="loadPageComponents"){thisClass.loadPageComponents(message.options,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="putPublicData"){thisClass.putPublicData(message.name,message.value,message.powerupDataName,message.options,function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="getOpenAICredits"){thisClass.getOpenAICredits(function(value){var response={method:message.method,value:value};thisClass.exceptionHandlingBlock(response,event);});}else{if(message.method=="updateOpenAICredits"){thisClass.updateOpenAICredits(message.creditType,message.credits);}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}};this.exceptionHandlingBlock=function(response,event){try{event.source.postMessage(response,event.origin);}catch(e){}};this.exportFontsToZip=function(userDefinedPathId,pageId,callback){MF_PowerupManager.exportFontsToZip(MF_UserSession.getUser(),mf_main.editorController.projectObj,mf_main.editorController.powerupController.selectedPowerup.id,userDefinedPathId,pageId,mf_main.PUBLIC,{callback:function(response){callback({status:"success",message:"https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/"+JSON.parse(response).message});}});};this.addSecureKeyHashTokenForPowerup=function(publicid,privateid,callback){MF_Authentication.addSecureKeyHash(MF_UserSession.getUser(),publicid,privateid,{callback:function(str){callback({status:"success",message:str});}});};this.sendPowerupNotification=function(obj,callback){obj.id=mf_main.editorController.powerupController.selectedPowerup.id;mf_main.rtc.powerupNotificationSync(obj);var rtcObj=new MF_DashboardRTCItem();rtcObj.collaborators=thisClass.getRTCCollaboratorList();rtcObj.messageStr=obj.messageStr;mf_main.dashboardRtcController.powerupSync(obj.cmd,rtcObj);callback({status:"success",message:""});};this.sendPinPowerupToSpace=function(obj,callback){var logcmd;var pintitle="";if(obj.cmd=="designspacepowerup_pin"){logcmd="ADD-PINPOWERUP";pintitle=obj.project.title;}if(obj.cmd=="designspacepowerup_unpin"){logcmd="UNPINPOWERUP";pintitle=obj.title;}var logdata={spaceid:mf_main.editorController.projectObj.spaceId,spacename:obj.spacename,projectid:obj.project.id,projectname:pintitle};var logMessage=mf_main.logController.getLogMessage(logcmd,logdata);var rtcObj=new MF_EditorRTCItem();rtcObj.collaborators=thisClass.getRTCCollaboratorList();rtcObj.project=obj.project;rtcObj.spaceId=mf_main.editorController.projectObj.spaceId;rtcObj.messageStr=logMessage;rtcObj.logcmd=logcmd;rtcObj.logdata=logdata;mf_main.dashboardRtcController.pinPowerupSync(obj.cmd,rtcObj);mf_main.logController.logSpaceAction(logcmd,logMessage,logdata,rtcObj.collaborators);callback({status:"success",message:""});};this.updatePowerupPublicLinkInSpace=function(obj,callback){var rtcObj=new MF_EditorRTCItem();rtcObj.collaborators=thisClass.getRTCCollaboratorList();rtcObj.projectId=obj.projectId;rtcObj.publicURL=obj.publicURL;rtcObj.spaceId=mf_main.editorController.projectObj.spaceId;mf_main.dashboardRtcController.powerupPublicLinkSync(obj.cmd,rtcObj);callback({status:"success",message:""});};this.pinPowerup=function(options,callback){var defaultOptions={pageId:null,itemId:null,clientId:mf_main.editorController.projectObj.company,isSaveUrl:false,publicUrl:null};var putDataOptions=$.extend({},defaultOptions,options);var data=null;if(putDataOptions.data){data=putDataOptions.data;}if(mf_main.editorController.projectObj.spaceId!=null){var powerupObj=mf_main.editorController.powerupController.selectedPowerup;if(MF_UserSession.getUser().isBasic||MF_UserSession.getUser().wireframing){var responseText=new Object();responseText.status="restricted";if(powerupObj.id!="D6b672969bd41e0b203af9f2726f61ae0"&&powerupObj.id!="D1d53f643d8d753cf28568c9929d7a03d"&&powerupObj.id!="Dfc48ce023dd5df731be65215764b2093"&&!(MF_UserSession.getUser().wireframing&&(powerupObj.id=="D25391f242a0654082abf49c8d0c7d908"||powerupObj.id=="D4073780418f47f01cdfff9cf319a0913"))){var wireframePlanMsg="";if(MF_UserSession.getUser().wireframing){wireframePlanMsg=", AI Text";}alert("Only Stepguide, CJM"+wireframePlanMsg+" and Bootstrap Builder powerups can be pinned to designspace in your plan");callback(responseText);return;}}var pinPowerupID=MF_Utils.guidGenerator();var projectID=mf_main.editorController.projectObj.id;var p=new MF_Project();p.title=putDataOptions.title;p.id=pinPowerupID;p.category=projectID;p.creator=MF_UserSession.getUser().username;p.company=mf_main.editorController.projectObj.company;p.data=data;p.projectType="powerup";p.spaceId=mf_main.editorController.projectObj.spaceId;p.powerupId=powerupObj.id;if(putDataOptions.isSaveUrl){p.share=true;p.publicURL=putDataOptions.publicUrl;}if(putDataOptions.pageId){p.pinnedPageId=putDataOptions.pageId;}if(typeof mf_appmain!="undefined"){var rtcObj={project:p,collaborators:mf_main.designSpaceController.projectController.designSpaceShareController.getRTCCollaboratorList()};mf_main.dashboardRtcController.designSpaceProjectSync("designspaceproject_add",rtcObj);mf_main.designSpaceController.projectController.updateDesignSpaceProjectAddRTC(p);mf_main.designSpaceController.projectController.sortDesignSpaceProjectHandler();}MF_PowerupManager.pinPowerupData(MF_UserSession.getUser(),powerupObj,projectID,p.spaceId,pinPowerupID,data,JSON.stringify(putDataOptions),{callback:function(response){response=JSON.parse(response);if(response&&response.status=="success"){var obj=new Object();obj.cmd="designspacepowerup_pin";obj.project=p;obj.spacename=response.spacename;thisClass.sendPinPowerupToSpace(obj,function(response){});}else{if(response&&response.status=="denied"){alert("Powerups from default space project cannot be pinned to designspace. Move the project to custom space to pin the powerup");}}callback(response);}});}else{var response={message:"Powerups from default space project cannot be pinned to designspace. Move the project to custom space to pin the powerup",status:"denied"};alert(response.message);callback(response);}};this.unpinPowerup=function(options,callback){if(mf_main.editorController.projectObj.spaceId!=null){if(options&&options.id){MF_ProjectManager.unpinPowerupData(MF_UserSession.getUser(),options.id,{callback:function(response){response=JSON.parse(response);var projObj=new MF_Project();projObj.id=options.id;var obj=new Object();obj.cmd="designspacepowerup_unpin";obj.project=projObj;obj.spaceId=mf_main.editorController.projectObj.spaceId;obj.spacename=response.spacename;obj.title=response.pintitle;thisClass.sendPinPowerupToSpace(obj,function(response){});callback(response);}});}else{alert("Power-up is not available in the design space.");}}};this.saveUIBlock=function(options,callback){if(options&&options.blockjson){MF_PowerupManager.saveUIBlock(MF_UserSession.getUser(),options.blockjson,{callback:function(response){callback(response);}});}else{}};this.getUIBlock=function(options,callback){if(options&&options.blockjson){MF_PowerupManager.getUIBlock(MF_UserSession.getUser(),options.blockjson,{callback:function(response){callback(response);}});}else{}};this.listUIBlocks=function(options,callback){if(options&&options.blocktype){MF_PowerupManager.listUIBlocks(MF_UserSession.getUser(),options.search,options.category,options.blocktype,{callback:function(response){callback(response);}});}else{}};this.addBlock2Wireframe=function(options,callback){if(options&&options.blocks){var arr=JSON.parse(options.blocks);MF_PackManager.copyBlock2SaveComp(MF_UserSession.getUser(),mf_main.editorController.projectObj.id,mf_main.editorController.projectObj.company,arr,{callback:function(response){if(response.length>0){mf_main.editorController.dbComponentsWireframe=response.reverse();mf_main.editorController.saveAsWireframeMode=true;var db1=mf_main.editorController.dbComponentsWireframe.pop();mf_main.editorController.addDBComponent2Page(db1.id,db1,100,100);mf_main.editorController.imageController.listed=false;}callback("good");}});}else{}};this.addBlockComponent=function(options,callback){if(options&&options.compjson){var obj=JSON.parse(options.compjson);MF_PackManager.copy2BlockUI(MF_UserSession.getUser(),obj.compid,obj.packid,obj.blockid,obj.clientid,obj.deletecomp,{callback:function(response){callback(response);}});}else{}};this.deleteUIBlock=function(options,callback){if(options&&options.blockjson){MF_PowerupManager.deleteUIBlock(MF_UserSession.getUser(),options.blockjson,{callback:function(response){callback(response);}});}else{}};this.checkIsDesignSpace=function(callback){if(mf_main.editorController.projectObj.spaceId!=null){callback(true);}else{callback(false);}};this.getPowerupPinData=function(options,callback){var prId=mf_main.poweruprefId;MF_PowerupManager.getPowerupPinData(MF_UserSession.getUser(),prId,mf_main.editorController.projectObj.company,{callback:function(response){if(response){response=JSON.parse(response);}callback(response);}});};this.getPinnedPowerupData=function(options,callback){var pageId=null;if(options&&options.hasOwnProperty("pageId")){pageId=options.pageId;}var powerupId=mf_main.editorController.powerupController.selectedPowerup.id;var projectId=mf_main.projectID;if(projectId&&powerupId){MF_PowerupManager.getPinnedPowerupData(MF_UserSession.getUser(),projectId,powerupId,pageId,{callback:function(response){callback(response);}});}else{callback(null);}};this.openloomsdk=function(obj,callback){mf_main.editorController.textChatController.openLoomRecording();callback({status:"success",message:""});};window.addEventListener("message",thisClass.postMessageListener,false);}function MF_TransformSettings(){var thisClass=this;thisClass.eid=mf_main.editorController.guidGenerator();thisClass.transformLock=false;thisClass.NAME="TransformSettings";thisClass.x=0;thisClass.y=0;thisClass.settingsHolder=null;thisClass.RENDERDOM=true;thisClass.xbox=null;thisClass.ybox=null;thisClass.hbox=null;thisClass.wbox=null;thisClass.rotatebox=null;thisClass.showSetting=true;thisClass.annotateMode=false;thisClass.remove=function(delSet){if(delSet){try{if($("#rotate_"+thisClass.eid).data("kendoNumericTextBox")){$("#rotate_"+thisClass.eid).data("kendoNumericTextBox").destroy();}if($("#x_"+thisClass.eid).data("kendoNumericTextBox")){$("#x_"+thisClass.eid).data("kendoNumericTextBox").destroy();}if($("#y_"+thisClass.eid).data("kendoNumericTextBox")){$("#y_"+thisClass.eid).data("kendoNumericTextBox").destroy();}if($("#w_"+thisClass.eid).data("kendoNumericTextBox")){$("#w_"+thisClass.eid).data("kendoNumericTextBox").destroy();}if($("#h_"+thisClass.eid).data("kendoNumericTextBox")){$("#h_"+thisClass.eid).data("kendoNumericTextBox").destroy();}}catch(e){console.log("error occured in the component MF_TransformSettings.js");}$("#"+thisClass.eid).remove();}};thisClass.init=function(settingsHolder){thisClass.settingsHolder=settingsHolder;if(thisClass.RENDERDOM){thisClass.render();}else{thisClass.setupEvents();$("#"+thisClass.eid).show();}if(thisClass.settingsHolder.selector.GLOBAL_SELECT){thisClass.noRotateTransform();}if(thisClass.settingsHolder.selector.component&&thisClass.settingsHolder.selector.component.CANNOT_ROTATE){thisClass.noRotateTransform();}MF_ComponentSettingUtils.rememberToggle(thisClass);};thisClass.noRotateTransform=function(){$("#rotlbl_"+thisClass.eid).hide();$("#rotval_"+thisClass.eid).hide();$("#mfAnnotateToggleBtn_"+thisClass.eid).hide();if(thisClass.settingsHolder.selector.GROUP){$("#"+thisClass.eid+"_partSetting").css("height","120px");}else{$("#mfGlobalAnnotateToggleBtn_"+thisClass.eid).show();}};thisClass.updateTransform=function(noscale){MF_ComponentSettingUtils.updateTransform(thisClass.xbox,thisClass.ybox,thisClass.wbox,thisClass.hbox,thisClass.rotatebox,thisClass.settingsHolder.selector,noscale);};thisClass.setupEvents=function(){if(thisClass.RENDERDOM){MF_ComponentSettingUtils.setupTransform(thisClass);MF_ComponentSettingUtils.setupToggle(thisClass);$("#mfRotateComponentBtn_"+thisClass.eid).on("click",thisClass.rotateComponent);$("#mfAnnotateToggleBtn_"+thisClass.eid).on("click",thisClass.toggleAnnotation);$("#mfGlobalAnnotateToggleBtn_"+thisClass.eid).on("click",thisClass.toggleAnnotation);$("#lockBtn_"+thisClass.eid).tooltip({position:"top",animation:false});$("#lockBtn_"+thisClass.eid).on("click",thisClass.lockComponent);}if(thisClass.RENDERDOM==true){thisClass.RENDERDOM=false;}thisClass.updateTransform(true);$("#mfAnnotateToggleBtn_"+thisClass.eid).show();$("#mfGlobalAnnotateToggleBtn_"+thisClass.eid).hide();if(thisClass.settingsHolder.component){if(thisClass.settingsHolder.component.ANNOTATION){thisClass.markAsAnnotate();}else{thisClass.unMarkAsAnnotate();}}else{if(thisClass.settingsHolder.selector&&thisClass.settingsHolder.selector.GROUP){$("#mfAnnotateToggleBtn_"+thisClass.eid).hide();$("#mfGlobalAnnotateToggleBtn_"+thisClass.eid).hide();}else{thisClass.unMarkAsAnnotate();}}};thisClass.lockComponent=function(e){mf_main.editorController.editManager.lockComponent();};thisClass.rotateComponent=function(e){mf_main.editorController.rotateComponent(thisClass.rotatebox);};thisClass.toggleAnnotation=function(e){$("#mfAnnotateToggleBtn_"+thisClass.eid).tooltip("hide");$("#mfGlobalAnnotateToggleBtn_"+thisClass.eid).tooltip("hide");if(thisClass.settingsHolder.selector&&thisClass.settingsHolder.selector.GLOBAL_SELECT&&!thisClass.settingsHolder.selector.GROUP){var undoarr=new Array();var allselections=mf_main.editorController.getAllComponentSelects();if(thisClass.annotateMode){thisClass.annotateMode=false;thisClass.unMarkAsAnnotate();}else{thisClass.annotateMode=true;thisClass.markAsAnnotate();}for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){if(select.component.hasOwnProperty("ANNOTATION")){var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"ANNOTATION",select.component.ANNOTATION);undoarr.push(undo);select.component.e2xml.addPropSingle("ANNOTATION",thisClass.annotateMode,"default");}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}else{if(thisClass.settingsHolder.component){if(thisClass.settingsHolder.component.ANNOTATION){thisClass.unMarkAsAnnotate();thisClass.settingsHolder.component.e2xml.addPropSingle("ANNOTATION",false);}else{thisClass.markAsAnnotate();thisClass.settingsHolder.component.e2xml.addPropSingle("ANNOTATION",true);}$("#mfAnnotateToggleBtn_"+thisClass.eid).tooltip("hide");}}};thisClass.markAsAnnotate=function(){$("#mfAnnotateToggleBtn_"+thisClass.eid).css("color","#ff0000");$("#mfAnnotateToggleBtn_"+thisClass.eid).attr("data-original-title","Unmark component as 'Annotation'. Annotation components can be toggled - shown/hidden in review mode.");$("#mfGlobalAnnotateToggleBtn_"+thisClass.eid).text("Unmark as Annotation");$("#mfGlobalAnnotateToggleBtn_"+thisClass.eid).attr("data-original-title","Unmark component as 'Annotation'. Annotation components can be toggled - shown/hidden in review mode.");};thisClass.unMarkAsAnnotate=function(){$("#mfAnnotateToggleBtn_"+thisClass.eid).css("color","#8C95A4");$("#mfAnnotateToggleBtn_"+thisClass.eid).attr("data-original-title","Mark component as 'Annotation'. Annotation components can be toggled - shown/hidden in review mode.");$("#mfGlobalAnnotateToggleBtn_"+thisClass.eid).text("Mark as Annotation");$("#mfGlobalAnnotateToggleBtn_"+thisClass.eid).attr("data-original-title","Mark component as 'Annotation'. Annotation components can be toggled - shown/hidden in review mode.");};thisClass.render=function(redraw,mfpage){if(redraw==null){redraw=true;}var htmlCode="";if(redraw){$("#"+thisClass.eid).remove();htmlCode=multiline(function(){
/*!
			
			<div id="{{eid}}_settingToggle"  class="mfImgLink mfSettingsToggleBtn" style=" " >
				
					<div style="float: left; width: 185px; padding-left: 5px;">Transform</div>
					
					<div style="float: left; width: 50px; text-align: right;">
						<span id="{{eid}}_settingToggleHide"  style="display: none; font-size: 20px;" class="ico-angle-right"></span>
						<span id="{{eid}}_settingToggleShow"  style="font-size: 20px;" class="ico-angle-down"></span>
					</div>
			</div>
						
			<div id="{{eid}}_partSetting" style="overflow: hidden; position: relative; width:100%; height: 160px;" >		

			 

				<div style="position: absolute; left: 10px; top: 20px;">x: </div>
				<div style="position: absolute; left: 25px; top: 15px;"><input style="width: 70px;"  id="x_{{eid}}" type="number" value="0" min="-10000000"  step="1" /></div>
	
				<div style="position: absolute; left: 110px; top: 20px;">y: </div> 
				<div style="position: absolute; left: 125px; top: 15px;"><input style="width: 70px;" id="y_{{eid}}" type="number" value="0" min="-10000000"  step="1" /></div>
	
				<div style="position: absolute; left: 10px; top: 60px;">w: </div>
				<div style="position: absolute; left: 25px; top: 55px;"><input style="width: 70px;"  id="w_{{eid}}" type="number" value="0" min="1"  step="1" /></div>
	
				<div style="position: absolute; left: 110px; top: 60px;">h: </div>
				<div style="position: absolute; left: 125px; top: 55px;"><input style="width: 70px;" id="h_{{eid}}" type="number" value="0" min="1"  step="1" /></div>
	
				<span class="ico-lock" data-toggle="tooltip"  data-placement="left" title="Lock component"  id="lockBtn_{{eid}}" style="position: absolute; font-size: 18px; cursor:pointer; left: 200px; top: 40px;"></span>
				
				<div id="rotlbl_{{eid}}" style="position: absolute; left: 10px; top: 106px;">Rotate Angle:</div>
				<div id="rotval_{{eid}}" style="position: absolute; left: 90px; top: 100px;">&nbsp;<input style="width: 70px;" id="rotate_{{eid}}" type="number" value="0" min="-360" max="360" step="1" /> &nbsp; <img id="mfRotateComponentBtn_{{eid}}" class="mfRotateComponentBtn" src="images/editor/rotation.png" style="width: 20px;cursor:pointer"/></div>
			
				<span class="ico-border_color" data-toggle="tooltip"  data-placement="left"   id="mfAnnotateToggleBtn_{{eid}}" style="position: absolute; font-size: 18px; cursor:pointer; left: 200px; top: 103px;"></span>

				<a id="mfGlobalAnnotateToggleBtn_{{eid}}" data-toggle="tooltip" data-placement="bottom" title="" style="display:none;border-color: #2196F3; position: absolute; display: block; left: 10px; top: 105px; width: 220px;" class="btn mfSidebarShadowButton"></a>
			
			</div>
			
			*/
console.log;});var compiled_template=Handlebars.compile(htmlCode);var context={eid:thisClass.eid};var compiled_code=compiled_template(context);$("#"+thisClass.settingsHolder.eid+"_transform").append(compiled_code);thisClass.setupEvents();$("#"+thisClass.eid).show();}else{$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);}};}function MF_LinkSettings(){var thisClass=this;thisClass.eid=mf_main.editorController.guidGenerator();thisClass.settingsHolder=null;thisClass.link="";thisClass.NAME="LinkSettings";thisClass.RENDERDOM=true;thisClass.showSetting=true;thisClass.remove=function(delSet){if(delSet){$("#"+thisClass.eid).remove();}};thisClass.init=function(settingsHolder){thisClass.settingsHolder=settingsHolder;thisClass.link=thisClass.settingsHolder.component.link;if(thisClass.RENDERDOM){thisClass.render();}else{thisClass.setupEvents();$("#"+thisClass.eid).show();}MF_ComponentSettingUtils.rememberToggle(thisClass);};thisClass.setupEvents=function(){if(thisClass.RENDERDOM){MF_ComponentSettingUtils.setupToggle(thisClass);$("#mfDispLink_"+thisClass.eid).on("click",function(event){mf_main.editorController.showPopUp(event,$("#mfLinkSelectionPopUp"));MF_ComponentSettingUtils.openLinkModal("#mfDispLink_"+thisClass.eid,thisClass);});}if(thisClass.RENDERDOM==true){thisClass.RENDERDOM=false;}$("#mfDispLink_"+thisClass.eid).text("Select link");MF_ComponentSettingUtils.convert2LinkObj(thisClass.settingsHolder.component);if(thisClass.link!=""&&thisClass.link!=null){if(thisClass.settingsHolder.component.linkObj.type=="page"){if(thisClass.settingsHolder.component.linkObj.pageName!=""&&thisClass.settingsHolder.component.linkObj.pageName!=null){$("#mfDispLink_"+thisClass.eid).text(thisClass.settingsHolder.component.linkObj.pageName);}}else{if(thisClass.settingsHolder.component.linkObj.type=="internal"){var urldisp=thisClass.settingsHolder.component.linkObj.url;var arr=urldisp.split("|--::--|");if(arr.length==2){$("#mfDispLink_"+thisClass.eid).text("Internal: "+arr[1]);}else{$("#mfDispLink_"+thisClass.eid).text("Internal link");}}else{if(thisClass.settingsHolder.component.linkObj.type=="web"){$("#mfDispLink_"+thisClass.eid).text(thisClass.settingsHolder.component.linkObj.url);}}}}else{thisClass.settingsHolder.component.linkObj=null;}};thisClass.render=function(redraw,mfpage){if(redraw==null){redraw=true;}var htmlCode="";if(redraw){$("#"+thisClass.eid).remove();htmlCode=multiline(function(){
/*!
			
			<div id="{{eid}}_settingToggle"  class="mfImgLink mfSettingsToggleBtn" style=" " >
				
					<div style="float: left; width: 185px; padding-left: 5px;">Link</div>
					
					<div style="float: left; width: 50px; text-align: right;">
						<span id="{{eid}}_settingToggleHide"  style="display: none; font-size: 20px;" class="ico-angle-right"></span>
						<span id="{{eid}}_settingToggleShow"  style="font-size: 20px;" class="ico-angle-down"></span>
					</div>
			</div>
						
			<div id="{{eid}}_partSetting" style="overflow: hidden; position: relative; width:100%; height: 60px;" >	 	

					
					
				<div  style="position: absolute; left: 10px; top: 20px; font-weight: normal;" >
				Link: </div>
				
				<div id="mfDispLink_{{eid}}" class='mfSingleLine' style="width: 180px; cursor: pointer; color: #2196F3; position: absolute; left: 50px; top: 20px; font-weight: normal;" >
				Select link
				</div>
			
			
			</div>
			
			*/
console.log;});var compiled_template=Handlebars.compile(htmlCode);var context={eid:thisClass.eid};var compiled_code=compiled_template(context);$("#"+thisClass.settingsHolder.eid+"_link").append(compiled_code);thisClass.setupEvents();$("#"+thisClass.eid).show();}else{$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);}};}function MF_ThemeSettings(){var thisClass=this;thisClass.eid=mf_main.editorController.guidGenerator();thisClass.settingsHolder=null;thisClass.NAME="ThemeSettings";thisClass.RENDERDOM=true;thisClass.themeType="";thisClass.showSetting=true;thisClass.remove=function(delSet){if(delSet){$("#"+thisClass.eid).remove();}};thisClass.init=function(settingsHolder){thisClass.themeType=settingsHolder.component.NAME;thisClass.settingsHolder=settingsHolder;if(thisClass.RENDERDOM){thisClass.render();}else{thisClass.setupEvents();$("#"+thisClass.eid).show();}MF_ComponentSettingUtils.rememberToggle(thisClass);};thisClass.setupEvents=function(){if(thisClass.RENDERDOM){MF_ComponentSettingUtils.setupToggle(thisClass);$("#mfDispTheme_"+thisClass.eid).on("click",function(event){mf_main.editorController.showPopUp(event,$("#mfThemeSelectionPopUp"));mf_main.componentList.listThemeTemplates(thisClass.themeType);});}if(thisClass.RENDERDOM==true){thisClass.RENDERDOM=false;}};thisClass.render=function(redraw,mfpage){if(redraw==null){redraw=true;}var htmlCode="";if(redraw){$("#"+thisClass.eid).remove();htmlCode=multiline(function(){
/*!
			
			<div id="{{eid}}_settingToggle"  class="mfImgLink mfSettingsToggleBtn" style=" " >
				
					<div style="float: left; width: 185px; padding-left: 5px;">Themes</div>
					
					<div style="float: left; width: 50px; text-align: right;">
						<span id="{{eid}}_settingToggleHide"  style="display: none; font-size: 20px;" class="ico-angle-right"></span>
						<span id="{{eid}}_settingToggleShow"  style="font-size: 20px;" class="ico-angle-down"></span>
					</div>
			</div>
						
			<div id="{{eid}}_partSetting" style="overflow: hidden; position: relative; width:100%; height: 70px;" >	 	
 
					
				<a style=" width: 220px; padding-top: 10px; padding-bottom: 10px; vertical-align: middle; position: absolute; left: 15px; top: 20px;" class="btn mfSidebarShadowButton" id="mfDispTheme_{{eid}}" >
				
				<svg style="position: relative; top: 3px;" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-palette2" viewBox="0 0 16 16">
			  <path d="M0 .5A.5.5 0 0 1 .5 0h5a.5.5 0 0 1 .5.5v5.277l4.147-4.131a.5.5 0 0 1 .707 0l3.535 3.536a.5.5 0 0 1 0 .708L10.261 10H15.5a.5.5 0 0 1 .5.5v5a.5.5 0 0 1-.5.5H3a2.99 2.99 0 0 1-2.121-.879A2.99 2.99 0 0 1 0 13.044m6-.21 7.328-7.3-2.829-2.828L6 7.188v5.647zM4.5 13a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0zM15 15v-4H9.258l-4.015 4H15zM0 .5v12.495V.5z"/>
			  <path d="M0 12.995V13a3.07 3.07 0 0 0 0-.005z"/>
			</svg> &nbsp;
				
				Select Theme</a>
					
				
			
			
			</div>
			
			*/
console.log;});var compiled_template=Handlebars.compile(htmlCode);var context={eid:thisClass.eid};var compiled_code=compiled_template(context);$("#"+thisClass.settingsHolder.eid+"_theme").append(compiled_code);thisClass.setupEvents();$("#"+thisClass.eid).show();}else{$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);}};}function MF_LinkSettings2(){var thisClass=this;thisClass.eid=mf_main.editorController.guidGenerator();thisClass.settingsHolder=null;thisClass.NAME="LinkSettings2";thisClass.RENDERDOM=true;thisClass.showSetting=true;thisClass.remove=function(delSet){if(delSet){$("#"+thisClass.eid).remove();}};thisClass.init=function(settingsHolder){thisClass.settingsHolder=settingsHolder;if(thisClass.RENDERDOM){thisClass.render();}else{thisClass.setupEvents();$("#"+thisClass.eid).show();}MF_ComponentSettingUtils.rememberToggle(thisClass);};thisClass.setupEvents=function(){if(thisClass.RENDERDOM){MF_ComponentSettingUtils.setupToggle(thisClass);$("#mfDispLink_"+thisClass.eid).on("click",function(event){mf_main.editorController.showPopUp(event,$("#mfMultiLinkSelectionPopUp"));MF_ComponentSettingUtils.openMultiLinkModal("#mfDispLink_"+thisClass.eid,thisClass);});}if(thisClass.RENDERDOM==true){thisClass.RENDERDOM=false;}};thisClass.render=function(redraw,mfpage){if(redraw==null){redraw=true;}var htmlCode="";if(redraw){$("#"+thisClass.eid).remove();htmlCode=multiline(function(){
/*!
			
			<div id="{{eid}}_settingToggle"  class="mfImgLink mfSettingsToggleBtn" style=" " >
				
					<div style="float: left; width: 185px; padding-left: 5px;">Link</div>
					
					<div style="float: left; width: 50px; text-align: right;">
						<span id="{{eid}}_settingToggleHide"  style="display: none; font-size: 20px;" class="ico-angle-right"></span>
						<span id="{{eid}}_settingToggleShow"  style="font-size: 20px;" class="ico-angle-down"></span>
					</div>
			</div>
						
			<div id="{{eid}}_partSetting" style="overflow: hidden; position: relative; width:100%; height: 60px;" >	 	

					
					
				<div  style="position: absolute; left: 10px; top: 20px; font-weight: normal;" >
				Link: </div>
				
				<div id="mfDispLink_{{eid}}"  class='mfSingleLine' style="width: 180px; cursor: pointer; color: #2196F3; position: absolute; left: 50px; top: 20px; font-weight: normal;" >
					Click here to manage Links
				</div>
			
			
			</div>
			
			*/
console.log;});var compiled_template=Handlebars.compile(htmlCode);var context={eid:thisClass.eid};var compiled_code=compiled_template(context);$("#"+thisClass.settingsHolder.eid+"_link").append(compiled_code);thisClass.setupEvents();$("#"+thisClass.eid).show();}else{$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);}};}function MF_GroupLinkSettings(){var thisClass=this;thisClass.eid=mf_main.editorController.guidGenerator();thisClass.settingsHolder=null;thisClass.NAME="GroupLinkSettings";thisClass.RENDERDOM=true;thisClass.linkObj=new Object();thisClass.showSetting=true;thisClass.remove=function(delSet){if(delSet){$("#"+thisClass.eid).remove();}};thisClass.init=function(settingsHolder){thisClass.settingsHolder=settingsHolder;if(thisClass.RENDERDOM){thisClass.render();}else{thisClass.setupEvents();$("#"+thisClass.eid).show();}MF_ComponentSettingUtils.rememberToggle(thisClass);};thisClass.setupEvents=function(){if(thisClass.RENDERDOM){MF_ComponentSettingUtils.setupToggle(thisClass);$("#mfDispLink_"+thisClass.eid).on("click",function(event){mf_main.editorController.showPopUp(event,$("#mfLinkSelectionPopUp"));MF_ComponentSettingUtils.openLinkModal("#mfDispLink_"+thisClass.eid,thisClass);});}if(thisClass.RENDERDOM==true){thisClass.RENDERDOM=false;}$("#mfDispLink_"+thisClass.eid).text("Select link");var linkObj=mf_main.editorController.page.groupManager.linkedGroups[thisClass.settingsHolder.selector.GROUPID];if(linkObj){MF_ComponentSettingUtils.convert2LinkObj(linkObj);}else{linkObj=new Object();linkObj.GROUP=true;linkObj.GROUPID=thisClass.settingsHolder.selector.GROUPID;}thisClass.linkObj=linkObj;if(linkObj.linkObj){if(linkObj.linkObj.type=="page"){if(linkObj.linkObj.pageName!=""&&linkObj.linkObj.pageName!=null){$("#mfDispLink_"+thisClass.eid).text(linkObj.linkObj.pageName);}}else{if(linkObj.linkObj.type=="web"){$("#mfDispLink_"+thisClass.eid).text(linkObj.linkObj.url);}else{if(linkObj.linkObj.type=="internal"){var urldisp=linkObj.linkObj.url;var arr=urldisp.split("|--::--|");if(arr.length==2){$("#mfDispLink_"+thisClass.eid).text("Internal: "+arr[1]);}else{$("#mfDispLink_"+thisClass.eid).text("Internal link");}}}}}else{}};thisClass.render=function(redraw,mfpage){if(redraw==null){redraw=true;}var htmlCode="";if(redraw){$("#"+thisClass.eid).remove();htmlCode=multiline(function(){
/*!
			
			<div id="{{eid}}_settingToggle"  class="mfImgLink mfSettingsToggleBtn" style=" " >
				
					<div style="float: left; width: 185px; padding-left: 5px;">Group Linking</div>
					
					<div style="float: left; width: 50px; text-align: right;">
						<span id="{{eid}}_settingToggleHide"  style="display: none; font-size: 20px;" class="ico-angle-right"></span>
						<span id="{{eid}}_settingToggleShow"  style="font-size: 20px;" class="ico-angle-down"></span>
					</div>
			</div>
						
			<div id="{{eid}}_partSetting" style="overflow: hidden; position: relative; width:100%; height: 120px;" >	 	

					
					
				<div  style="position: absolute; left: 10px; top: 20px; font-weight: normal;" >
				Link: </div>
				
				<div id="mfDispLink_{{eid}}" class='mfSingleLine' style="cursor: pointer; color: #2196F3; position: absolute; left: 50px; top: 20px; font-weight: normal; width: 180px;" >
				Select Page
				</div>
				
				<div style='color: #bbb; text-align: left; position: absolute; left: 10px; top: 60px; width: 220px; height: 40px;'>
				When you link a Group, Any links for individual components inside the Group won't work
				</div>
			
			
			</div>
			
			*/
console.log;});var compiled_template=Handlebars.compile(htmlCode);var context={eid:thisClass.eid};var compiled_code=compiled_template(context);$("#"+thisClass.settingsHolder.eid+"_link").append(compiled_code);thisClass.setupEvents();$("#"+thisClass.eid).show();}else{$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);}};}function MF_IconAssignSettings(){var thisClass=this;thisClass.eid=mf_main.editorController.guidGenerator();thisClass.settingsHolder=null;thisClass.NAME="IconAssignSettings";thisClass.RENDERDOM=true;thisClass.showSetting=true;thisClass.remove=function(delSet){if(delSet){$("#"+thisClass.eid).remove();}};thisClass.init=function(settingsHolder){thisClass.settingsHolder=settingsHolder;if(thisClass.RENDERDOM){thisClass.render();}else{thisClass.setupEvents();$("#"+thisClass.eid).show();}MF_ComponentSettingUtils.rememberToggle(thisClass);};thisClass.setupEvents=function(){if(thisClass.RENDERDOM){MF_ComponentSettingUtils.setupToggle(thisClass);$("#mfDispIcon_"+thisClass.eid).on("click",function(event){mf_main.editorController.showPopUp(event,$("#mfMultiIconSelectionPopUp"));MF_ComponentSettingUtils.openMultiIconModal("#mfDispIcon_"+thisClass.eid,thisClass);});$("#mfFlipIcon_"+thisClass.eid).on("click",function(event){if(thisClass.settingsHolder.component.iconPlace=="left"){thisClass.settingsHolder.component.e2xml.addPropSingle("iconPlace","right");}else{thisClass.settingsHolder.component.e2xml.addPropSingle("iconPlace","left");}thisClass.settingsHolder.component.render(false);});$("#mfFlipIcon_"+thisClass.eid).tooltip({position:"top",animation:false});}if(thisClass.RENDERDOM==true){thisClass.RENDERDOM=false;}if(thisClass.settingsHolder.component.iconPlace==null){$("#mfFlipIcon_"+thisClass.eid).hide();}else{$("#mfFlipIcon_"+thisClass.eid).show();}};thisClass.render=function(redraw,mfpage){if(redraw==null){redraw=true;}var htmlCode="";if(redraw){$("#"+thisClass.eid).remove();htmlCode=multiline(function(){
/*!
			
			<div id="{{eid}}_settingToggle"  class="mfImgLink mfSettingsToggleBtn" style=" " >
				
					<div style="float: left; width: 185px; padding-left: 5px;">Icons</div>
					
					<div style="float: left; width: 50px; text-align: right;">
						<span id="{{eid}}_settingToggleHide"  style="display: none; font-size: 20px;" class="ico-angle-right"></span>
						<span id="{{eid}}_settingToggleShow"  style="font-size: 20px;" class="ico-angle-down"></span>
					</div>
			</div>
						
			<div id="{{eid}}_partSetting" style="overflow: hidden; position: relative; width:100%; height: 60px;" >	 	

					
					
				<div  style="position: absolute; left: 10px; top: 20px; font-weight: normal;" >
				Icons: </div>
				
				<div id="mfDispIcon_{{eid}}"  style="cursor: pointer; color: #2196F3; position: absolute; left: 50px; top: 20px; font-weight: normal;" >
					Click here to assign Icons
					
					
				</div>
				
				<div data-toggle="tooltip"  data-placement="top" title="Flip icon position" id="mfFlipIcon_{{eid}}"style="position: absolute; top: 20px; left: 220px; cursor: pointer; width: 30px; color: #000; font-size: 14px; font-weight: bold; float: right;">
							 		<i class="fa-exchange" ></i>
				</div>
			
			
			</div>
			
			*/
console.log;});var compiled_template=Handlebars.compile(htmlCode);var context={eid:thisClass.eid};var compiled_code=compiled_template(context);$("#"+thisClass.settingsHolder.eid+"_icon").append(compiled_code);thisClass.setupEvents();$("#"+thisClass.eid).show();}else{$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);}};}function MF_IconAssignSettings2(){var thisClass=this;thisClass.eid=mf_main.editorController.guidGenerator();thisClass.settingsHolder=null;thisClass.NAME="IconAssignSettings2";thisClass.RENDERDOM=true;thisClass.dropdown=false;thisClass.showSetting=true;thisClass.remove=function(delSet){if(delSet){$("#"+thisClass.eid).remove();}};thisClass.init=function(settingsHolder){thisClass.settingsHolder=settingsHolder;if(thisClass.RENDERDOM){thisClass.render();}else{thisClass.setupEvents();$("#"+thisClass.eid).show();}MF_ComponentSettingUtils.rememberToggle(thisClass);};thisClass.setupEvents=function(){if(thisClass.RENDERDOM){MF_ComponentSettingUtils.setupToggle(thisClass);$(".mfSelectIconCls_"+thisClass.eid).on("click",function(event){mf_main.editorController.showPopUp(event,$("#mfMultiIconSelectionPopUp"));MF_ComponentSettingUtils.openSingleIconModal(thisClass.eid,thisClass);});$("#mfDelIcon_"+thisClass.eid).on("click",function(event){thisClass.settingsHolder.component.e2xml.addPropSingle("icon","");thisClass.settingsHolder.component.render(false);thisClass.setIcon();});$("#mfFlipIcon_"+thisClass.eid).on("click",function(event){if(thisClass.settingsHolder.component.iconPlace=="left"){thisClass.settingsHolder.component.e2xml.addPropSingle("iconPlace","right");}else{thisClass.settingsHolder.component.e2xml.addPropSingle("iconPlace","left");}thisClass.settingsHolder.component.render(false);});}if(thisClass.RENDERDOM==true){thisClass.RENDERDOM=false;}thisClass.setIcon();};thisClass.setIcon=function(){$("#mfIcon_"+thisClass.eid).removeClass();$("#mfFlipIcon_"+thisClass.eid).show();if(thisClass.settingsHolder.component.icon!=""&&thisClass.settingsHolder.component.icon!=null){$("#mfIcon_"+thisClass.eid).removeClass().addClass(thisClass.settingsHolder.component.icon);$("#mfDispIcon_"+thisClass.eid).show();$("#mfSelectIcon_"+thisClass.eid).hide();}else{$("#mfDispIcon_"+thisClass.eid).hide();$("#mfSelectIcon_"+thisClass.eid).show();}if(thisClass.settingsHolder.component.iconPlace==null){$("#mfFlipIcon_"+thisClass.eid).hide();}$("#mfFlipIcon_"+thisClass.eid).tooltip({position:"top",animation:false});};thisClass.render=function(redraw,mfpage){if(redraw==null){redraw=true;}var htmlCode="";if(redraw){$("#"+thisClass.eid).remove();htmlCode=multiline(function(){
/*!
			
			<div id="{{eid}}_settingToggle"  class="mfImgLink mfSettingsToggleBtn" style=" " >
				
					<div id="{{eid}}_headtxt"  style="float: left; width: 185px; padding-left: 5px;">Icons</div>
					
					<div style="float: left; width: 50px; text-align: right;">
						<span id="{{eid}}_settingToggleHide"  style="display: none; font-size: 20px;" class="ico-angle-right"></span>
						<span id="{{eid}}_settingToggleShow"  style="font-size: 20px;" class="ico-angle-down"></span>
					</div>
			</div>
						
			<div id="{{eid}}_partSetting" style="overflow: hidden; position: relative; width:100%; height: 60px;" >	 	

					
					
				<div  style="position: absolute; left: 10px; top: 20px; font-weight: normal;" >
				Icon: </div>
				
				<div style="position: absolute; left: 50px; top: 20px;">
				
							<div id="mfSelectIcon_{{eid}}" class="mfSelectIconCls_{{eid}}" style="display:block; cursor: pointer; color: #2196F3;  font-weight: normal;" >
								Select Icon
							</div>
							
							<div id="mfDispIcon_{{eid}}" style=' width: 190px;  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;'>
								<div class="mfSelectIconCls_{{eid}}"  style="cursor: pointer; width: 140px; float: left; color: #2196F3; font-size: 20px; font-weight: bold;">
									<i id="mfIcon_{{eid}}" class='' ></i>
								</div>
								
								
								<div id="mfDelIcon_{{eid}}"style="cursor: pointer; width: 20px; color: #000; font-weight: bold; float: right; font-size: 14px;">
							 		<i class="ico-trash2" ></i>
								</div> 
								
								<div data-toggle="tooltip"  data-placement="top" title="Flip icon position" id="mfFlipIcon_{{eid}}"style="cursor: pointer; width: 30px; color: #000; font-size: 14px; font-weight: bold; float: right;">
							 		<i class="fa-exchange" ></i>
								</div>
							</div>
				</div>
			
			
			
			</div>
			
			*/
console.log;});var compiled_template=Handlebars.compile(htmlCode);var context={eid:thisClass.eid};var compiled_code=compiled_template(context);if(thisClass.dropdown){$("#"+thisClass.settingsHolder.eid+"_dropdownicon").append(compiled_code);$("#"+thisClass.eid+"_headtxt").text("Dropdown icon");}else{$("#"+thisClass.settingsHolder.eid+"_icon").append(compiled_code);}thisClass.setupEvents();$("#"+thisClass.eid).show();}else{$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);}};}function MF_ChartColorSettings(){var thisClass=this;thisClass.eid=mf_main.editorController.guidGenerator();thisClass.settingsHolder=null;thisClass.chartColors=[];thisClass.NAME="ChartColorSettings";thisClass.RENDERDOM=true;thisClass.showGrid=true;thisClass.showSetting=true;thisClass.remove=function(delSet){if(delSet){try{}catch(e){console.log("error occured in the component MF_BorderSettings4.js");}$("#"+thisClass.eid).remove();}};thisClass.init=function(settingsHolder){thisClass.settingsHolder=settingsHolder;thisClass.chartColors=thisClass.settingsHolder.component.chartColorsArray;if(thisClass.RENDERDOM){thisClass.render();}else{thisClass.renderChartColors();thisClass.setupEvents();$("#"+thisClass.eid).show();}MF_ComponentSettingUtils.rememberToggle(thisClass);};thisClass.setupEvents=function(){if(thisClass.RENDERDOM){MF_ComponentSettingUtils.setupToggle(thisClass);$("#mfChartGridToggle_"+thisClass.eid).click(toggleGridSelection);$("#mfChartLabelToggle_"+thisClass.eid).click(toggleLabelSelection);$("#mfChartLegendToggle_"+thisClass.eid).click(toggleLegendSelection);}if(thisClass.RENDERDOM==true){thisClass.RENDERDOM=false;}$(".mfChartColorPicker_"+thisClass.eid).each(function(){var pickerIndex=$(this).attr("data-index");$("#mfChartColorPicker_"+thisClass.eid+"_"+pickerIndex).spectrum({showInput:true,preferredFormat:"hex6",showPalette:true,showSelectionPalette:true,palette:[MF_ComponentUtils.commonPallete()],show:function(color){mf_main.editorController.shortcutsFlag=false;},hide:function(color){mf_main.editorController.shortcutsFlag=true;},change:function(color){color=MF_Utils.RGBToHex(color.toRgbString());var colorItemIndex=$(this).attr("data-index");thisClass.chartColors[colorItemIndex].backgroundColor=color;thisClass.settingsHolder.component.chartColorsArray=thisClass.chartColors;var chartColorsString=JSON.stringify(thisClass.chartColors);thisClass.settingsHolder.component.e2xml.addPropSingle("chartColors",chartColorsString,"true");thisClass.settingsHolder.component.render(false);}});});$("#mfChartGridColorPicker_"+thisClass.eid).spectrum({showInput:true,preferredFormat:"hex6",showPalette:true,showSelectionPalette:true,palette:[MF_ComponentUtils.commonPallete()],show:function(color){mf_main.editorController.shortcutsFlag=false;},hide:function(color){mf_main.editorController.shortcutsFlag=true;},change:function(color){color=MF_Utils.RGBToHex(color.toRgbString());thisClass.settingsHolder.component.gridColor=color;thisClass.settingsHolder.component.e2xml.addPropSingle("gridColor",color,"true");thisClass.settingsHolder.component.render(false);}});if(thisClass.showGrid){$("#mfChartGridColorPicker_"+thisClass.eid).spectrum("set",thisClass.settingsHolder.component.gridColor);}$("#mfChartGridToggle_"+thisClass.eid).prop("checked",thisClass.settingsHolder.component.showGrid);if(thisClass.settingsHolder.component.showGrid){$("#mfChartGridColorContainer_"+thisClass.eid).show();}else{$("#mfChartGridColorContainer_"+thisClass.eid).hide();}$("#mfChartLabelToggle_"+thisClass.eid).prop("checked",thisClass.settingsHolder.component.showLabels);$("#mfChartLegendToggle_"+thisClass.eid).prop("checked",thisClass.settingsHolder.component.showLegend);function toggleGridSelection(e){var $this=$(this);if($this.is(":checked")){$("#mfChartGridColorContainer_"+thisClass.eid).show();thisClass.settingsHolder.component.e2xml.addPropSingle("showGrid",true);}else{$("#mfChartGridColorContainer_"+thisClass.eid).hide();thisClass.settingsHolder.component.e2xml.addPropSingle("showGrid",false);}thisClass.settingsHolder.component.render(false);}function toggleLabelSelection(e){var $this=$(this);if($this.is(":checked")){thisClass.settingsHolder.component.e2xml.addPropSingle("showLabels",true);}else{thisClass.settingsHolder.component.e2xml.addPropSingle("showLabels",false);}thisClass.settingsHolder.component.render(false);}function toggleLegendSelection(e){var $this=$(this);if($this.is(":checked")){thisClass.settingsHolder.component.e2xml.addPropSingle("showLegend",true);}else{thisClass.settingsHolder.component.e2xml.addPropSingle("showLegend",false);}thisClass.settingsHolder.component.render(false);}if(thisClass.showGrid){$(".mfGridBtns_"+thisClass.eid).show();}else{$(".mfGridBtns_"+thisClass.eid).hide();}};thisClass.renderChartColors=function(){try{var colorHTML="";for(var i=0;i<thisClass.chartColors.length;i++){colorHTML+='<div class="mfChartColorItem" style="margin:5px 0;" data-index="'+i+'"><div class="mfChartColorTitle" style="display: inline-block; width: 80%;">'+thisClass.chartColors[i].legend+'</div><div class="mfChartColorButton" style="display: inline-block; width: 20%;"><input style="width: 100px;" type="text" class="mfChartColorPicker_'+thisClass.eid+'" id="mfChartColorPicker_'+thisClass.eid+"_"+i+'" value="'+thisClass.chartColors[i].backgroundColor+'" data-index="'+i+'" /></div></div>';}$("#"+thisClass.eid+"_chartColorsContainer").html(colorHTML);}catch(e){}};thisClass.render=function(redraw,mfpage){if(redraw==null){redraw=true;}var htmlCode="";if(redraw){$("#"+thisClass.eid).remove();htmlCode=multiline(function(){
/*!
			
			<div id="{{eid}}_settingToggle"  class="mfImgLink mfSettingsToggleBtn" style=" " >
				
					<div style="float: left; width: 185px; padding-left: 5px;">Color Settings</div>
					
					<div style="float: left; width: 50px; text-align: right;">
						<span id="{{eid}}_settingToggleHide"  style="display: none; font-size: 20px;" class="ico-angle-right"></span>
						<span id="{{eid}}_settingToggleShow"  style="font-size: 20px;" class="ico-angle-down"></span>
					</div>
			</div>
						
			<div id="{{eid}}_partSetting" style="overflow-x: hidden; overflow-y: auto; position: relative; width:100%; height: auto;" >	 	

				<div style="padding:10px;">
					<div class="mfGridBtns_{{eid}}" style="margin:5px 0; position: relative;">
						<div class="checkbox" style="position: relative; width: 100%; height: 30px;">
							<input  type="checkbox" checked=true id="mfChartGridToggle_{{eid}}" class="tgl tgl-ios" value="">
							<label class='tgl-btn' for='mfChartGridToggle_{{eid}}' style='float: right;'></label><span style='left: 0px;'>Show Grid lines</span>
						</div>
					</div>
					<div class="mfGridBtns_{{eid}}" style="margin:5px 0; display: none;" id="mfChartGridColorContainer_{{eid}}">
						<div style="display: inline-block; width: 80%;">Grid Color</div>
						<div style="display: inline-block; width: 30px;">
							<input style="width: 100px;" type="text" id="mfChartGridColorPicker_{{eid}}" />
						</div>
					</div>
					<div class="mfGridBtns_{{eid}}" style="margin:5px 0; position: relative;">
						<div class="checkbox" style="position: relative; width: 100%; height: 30px;">
							<input  type="checkbox" checked=true id="mfChartLabelToggle_{{eid}}" class="tgl tgl-ios" value="">
							<label class='tgl-btn' for='mfChartLabelToggle_{{eid}}' style='float: right;'></label><span style='left: 0px;'>Show Labels</span>
						</div>
					</div>
					
					<div style="margin:5px 0; position: relative;">
						<div class="checkbox" style="position: relative; width: 100%; height: 30px;">
							<input  type="checkbox" checked=true id="mfChartLegendToggle_{{eid}}" class="tgl tgl-ios" value="">
							<label class='tgl-btn' for='mfChartLegendToggle_{{eid}}' style='float: right;'></label><span style='left: 0px;'>Show Legends</span>
						</div>
					</div>
				</div>
					
				<div id="{{eid}}_chartColorsContainer" style="padding: 10px; font-weight: normal;" >
				
				</div>
			
			
			</div>
			
			*/
console.log;});var compiled_template=Handlebars.compile(htmlCode);var context={eid:thisClass.eid};var compiled_code=compiled_template(context);$("#"+thisClass.settingsHolder.eid+"_chartcolor").append(compiled_code);thisClass.renderChartColors();thisClass.setupEvents();$("#"+thisClass.eid).show();}else{thisClass.renderChartColors();$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);}};}function MF_BackgroundSettings(){var thisClass=this;thisClass.eid=mf_main.editorController.guidGenerator();thisClass.NAME="BackgroundSettings";thisClass.settingsHolder=null;thisClass.RENDERDOM=true;thisClass.global=false;thisClass.globalFileType="solid";thisClass.globalFillColor="#000000";thisClass.globalFillColors=["#000000","#000000"];thisClass.globalOpacity=1;thisClass.showSetting=true;this.getCommonBackground=function(){var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){if(select.component.hasOwnProperty("fillAlpha")){thisClass.globalOpacity=select.component.fillAlpha;}if(select.component.hasOwnProperty("fillColors")){thisClass.globalFillColors=select.component.fillColors;}if(select.component.hasOwnProperty("fillColor")){thisClass.globalFillColor=select.component.fillColor;}if(select.component.hasOwnProperty("fillType")){thisClass.globalFileType=select.component.fillType;}}}};thisClass.remove=function(delSet){if(delSet){try{if($("#mfFillType"+thisClass.eid).data("kendoDropDownList")){$("#mfFillType"+thisClass.eid).data("kendoDropDownList").destroy();}if($("#mfFillOpacity"+thisClass.eid).data("kendoSlider")){$("#mfFillOpacity"+thisClass.eid).data("kendoSlider").destroy();}}catch(e){console.log("error occured in the component MF_BackgroundSettings.js");}$("#"+thisClass.eid).remove();}};thisClass.init=function(settingsHolder){thisClass.settingsHolder=settingsHolder;if(thisClass.RENDERDOM){thisClass.render();}else{thisClass.setupEvents();$("#"+thisClass.eid).show();}MF_ComponentSettingUtils.rememberToggle(thisClass);};thisClass.setupEvents=function(){if(thisClass.RENDERDOM){MF_ComponentSettingUtils.setupToggle(thisClass);$("#mfFillColor_"+thisClass.eid).spectrum({showInput:true,preferredFormat:"hex6",showPalette:true,showSelectionPalette:true,palette:[MF_ComponentUtils.commonPallete()],show:function(color){mf_main.editorController.shortcutsFlag=false;},hide:function(color){mf_main.editorController.shortcutsFlag=true;},change:function(color){if(thisClass.global){color=MF_Utils.RGBToHex(color.toRgbString());var undoarr=new Array();var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){var cjson=MF_ComponentUtils.updateCSS(select.component,["background","background-color"]);if(cjson!=""){undoarr=MF_ComponentUtils.addCSSUndo(select.component,cjson,undoarr);}if(select.component.hasOwnProperty("fillColors")){var undo=new MF_UndoDAO();undo.propArrayUndo(select.component,"fillColors",select.component.fillColors.slice(),"String");undoarr.push(undo);var newarray=select.component.fillColors.slice();newarray[0]=color;select.component.e2xml.addPropArray("fillColors",newarray,"String","default");select.component.render(false);}if(select.component.hasOwnProperty("fillColor")){var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"fillColor",select.component.fillColor);undoarr.push(undo);select.component.e2xml.addPropSingle("fillColor",color,"default");select.component.render(false);}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}else{var newarray=thisClass.settingsHolder.component.fillColors.slice();color=MF_Utils.RGBToHex(color.toRgbString());newarray[0]=color;var cjson=MF_ComponentUtils.updateCSS(thisClass.settingsHolder.component,["background","background-color"]);if(cjson!=""){MF_ComponentUtils.applyCSSPropArray(thisClass.settingsHolder,"fillColors",newarray,"String",cjson);}else{thisClass.settingsHolder.component.e2xml.addPropArray("fillColors",newarray,"String");thisClass.settingsHolder.component.render(false);}}}});$("#mfFillColor2_"+thisClass.eid).spectrum({showInput:true,preferredFormat:"hex6",showPalette:true,showSelectionPalette:true,palette:[MF_ComponentUtils.commonPallete()],show:function(color){mf_main.editorController.shortcutsFlag=false;},hide:function(color){mf_main.editorController.shortcutsFlag=true;},change:function(color){if(thisClass.global){color=MF_Utils.RGBToHex(color.toRgbString());var undoarr=new Array();var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){var cjson=MF_ComponentUtils.updateCSS(select.component,["background","background-color"]);if(cjson!=""){undoarr=MF_ComponentUtils.addCSSUndo(select.component,cjson,undoarr);}if(select.component.hasOwnProperty("fillColors")){var undo=new MF_UndoDAO();undo.propArrayUndo(select.component,"fillColors",select.component.fillColors.slice(),"String");undoarr.push(undo);var newarray=select.component.fillColors.slice();newarray[1]=color;select.component.e2xml.addPropArray("fillColors",newarray,"String","default");select.component.render(false);}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}else{var newarray=thisClass.settingsHolder.component.fillColors.slice();color=MF_Utils.RGBToHex(color.toRgbString());newarray[1]=color;var cjson=MF_ComponentUtils.updateCSS(thisClass.settingsHolder.component,["background","background-color"]);if(cjson!=""){MF_ComponentUtils.applyCSSPropArray(thisClass.settingsHolder,"fillColors",newarray,"String",cjson);}else{thisClass.settingsHolder.component.e2xml.addPropArray("fillColors",newarray,"String");thisClass.settingsHolder.component.render(false);}}}});$("#mfFillOpacity"+thisClass.eid).kendoSlider({showButtons:false,change:alphaSliderOnSlide,tickPlacement:"none",min:0,max:1,smallStep:0.1,largeStep:0.1,tooltip:{enabled:false}}).data("kendoSlider");$("#mfFillType"+thisClass.eid).kendoDropDownList({select:onGradientSelect});$("#mfGradientExchange_"+thisClass.eid).on("click",thisClass.exchangeGradientColor);}if(thisClass.RENDERDOM==true){thisClass.RENDERDOM=false;}if(thisClass.global){thisClass.getCommonBackground();}if(thisClass.global==false){$("#mfFillColor_"+thisClass.eid).spectrum("set",thisClass.settingsHolder.component.fillColors[0]);}else{$("#mfFillColor_"+thisClass.eid).spectrum("set",thisClass.globalFillColors[0]);}if(thisClass.global==false){$("#mfFillColor2_"+thisClass.eid).spectrum("set",thisClass.settingsHolder.component.fillColors[1]);}else{$("#mfFillColor2_"+thisClass.eid).spectrum("set",thisClass.globalFillColors[1]);}var alpha=1;if(thisClass.global==false){alpha=thisClass.settingsHolder.component.fillAlpha;}else{alpha=thisClass.globalOpacity;}var aslider=$("#mfFillOpacity"+thisClass.eid).data("kendoSlider");aslider.value(alpha);function alphaSliderOnSlide(e){if(thisClass.global){var aval=e.value;var undoarr=new Array();var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){if(select.component.hasOwnProperty("fillAlpha")){var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"fillAlpha",select.component.fillAlpha);undoarr.push(undo);var cjson=MF_ComponentUtils.updateCSS(select.component,["background","background-color"]);if(cjson!=""){undoarr=MF_ComponentUtils.addCSSUndo(select.component,cjson,undoarr);}select.component.e2xml.addPropSingle("fillAlpha",aval,"default");select.component.render(false);}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}else{var cjson=MF_ComponentUtils.updateCSS(thisClass.settingsHolder.component,["background","background-color"]);if(cjson!=""){MF_ComponentUtils.applyCSSPropSingle(thisClass.settingsHolder,"fillAlpha",e.value,cjson);}else{thisClass.settingsHolder.component.e2xml.addPropSingle("fillAlpha",e.value);thisClass.settingsHolder.component.render(false);}}}var dropdownlist=$("#mfFillType"+thisClass.eid).data("kendoDropDownList");var vtype="";if(thisClass.global==false){vtype=thisClass.settingsHolder.component.fillType;}else{vtype=thisClass.globalFileType;}if(vtype=="solid"){dropdownlist.select(0);$("#mfFillColorBlock2_"+thisClass.eid).css("visibility","hidden");$("#mfGradientExchange_"+thisClass.eid).hide();}if(vtype=="linear-vertical"){dropdownlist.select(1);$("#mfFillColorBlock2_"+thisClass.eid).css("visibility","visible");$("#mfGradientExchange_"+thisClass.eid).show();}if(vtype=="linear-horizontal"){dropdownlist.select(2);$("#mfFillColorBlock2_"+thisClass.eid).css("visibility","visible");$("#mfGradientExchange_"+thisClass.eid).show();}if(vtype=="linear-diagonally"){dropdownlist.select(3);$("#mfFillColorBlock2_"+thisClass.eid).css("visibility","visible");$("#mfGradientExchange_"+thisClass.eid).show();}if(vtype=="radial"){dropdownlist.select(4);$("#mfFillColorBlock2_"+thisClass.eid).css("visibility","visible");$("#mfGradientExchange_"+thisClass.eid).show();}if(vtype=="none"){dropdownlist.select(5);$("#mfFillColorBlock1_"+thisClass.eid).css("visibility","hidden");$("#mfFillColorBlock2_"+thisClass.eid).css("visibility","hidden");$("#mfGradientExchange_"+thisClass.eid).show();}else{$("#mfFillColorBlock1_"+thisClass.eid).css("visibility","visible");}function onGradientSelect(e){var gtype="solid";if(e.item.index()==0){gtype="solid";$("#mfFillColorBlock2_"+thisClass.eid).css("visibility","hidden");$("#mfGradientExchange_"+thisClass.eid).hide();}if(e.item.index()==1){gtype="linear-vertical";$("#mfFillColorBlock2_"+thisClass.eid).css("visibility","visible");$("#mfGradientExchange_"+thisClass.eid).show();}if(e.item.index()==2){gtype="linear-horizontal";$("#mfFillColorBlock2_"+thisClass.eid).css("visibility","visible");$("#mfGradientExchange_"+thisClass.eid).show();}if(e.item.index()==3){gtype="linear-diagonally";$("#mfFillColorBlock2_"+thisClass.eid).css("visibility","visible");$("#mfGradientExchange_"+thisClass.eid).show();}if(e.item.index()==4){gtype="radial";$("#mfFillColorBlock2_"+thisClass.eid).css("visibility","visible");$("#mfGradientExchange_"+thisClass.eid).show();}if(e.item.index()==5){gtype="none";$("#mfFillColorBlock2_"+thisClass.eid).css("visibility","visible");$("#mfGradientExchange_"+thisClass.eid).show();}if(thisClass.global){var undoarr=new Array();var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){if(select.component.hasOwnProperty("fillType")){var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"fillType",select.component.fillType);undoarr.push(undo);var cjson=MF_ComponentUtils.updateCSS(select.component,["background","background-color"]);if(cjson!=""){undoarr=MF_ComponentUtils.addCSSUndo(select.component,cjson,undoarr);}select.component.e2xml.addPropSingle("fillType",gtype,"default");select.component.render(false);}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}else{var cjson=MF_ComponentUtils.updateCSS(thisClass.settingsHolder.component,["background","background-color"]);if(cjson!=""){MF_ComponentUtils.applyCSSPropSingle(thisClass.settingsHolder,"fillType",gtype,cjson);}else{thisClass.settingsHolder.component.e2xml.addPropSingle("fillType",gtype);thisClass.settingsHolder.component.render(false);}}}};this.exchangeGradientColor=function(e){if(thisClass.global){var fillColors=new Array();fillColors[0]=$("#mfFillColor2_"+thisClass.eid).spectrum("get").toHexString();fillColors[1]=$("#mfFillColor_"+thisClass.eid).spectrum("get").toHexString();var undoarr=new Array();var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(select.component.hasOwnProperty("fillColors")){var undo=new MF_UndoDAO();undo.propArrayUndo(select.component,"fillColors",select.component.fillColors.slice(),"String");undoarr.push(undo);select.component.e2xml.addPropArray("fillColors",fillColors,"String","default");select.component.render(false);}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}$("#mfFillColor_"+thisClass.eid).spectrum("set",fillColors[0]);$("#mfFillColor2_"+thisClass.eid).spectrum("set",fillColors[1]);}else{mf_main.editorController.exchangeGradientColor(thisClass.settingsHolder.component.fillColors,"#mfFillColor_"+thisClass.eid,"#mfFillColor2_"+thisClass.eid);}};thisClass.render=function(redraw,mfpage){if(redraw==null){redraw=true;}var htmlCode="";if(redraw){$("#"+thisClass.eid).remove();htmlCode=multiline(function(){
/*!
			
			<div id="{{eid}}_settingToggle"  class="mfImgLink mfSettingsToggleBtn" style=" " >
				
					<div style="float: left; width: 185px; padding-left: 5px;">Background</div>
					
					<div style="float: left; width: 50px; text-align: right;">
						<span id="{{eid}}_settingToggleHide"  style="display: none; font-size: 20px;" class="ico-angle-right"></span>
						<span id="{{eid}}_settingToggleShow"  style="font-size: 20px;" class="ico-angle-down"></span>
					</div>
			</div>
						
			<div id="{{eid}}_partSetting" style="overflow: hidden; position: relative; width:100%; height: 160px;" >		

					<div style="position: absolute; left: 10px; top: 20px;">Fill Type:</div>
			
					 <select style="left: 80px; top: 15px; width: 100px;" id="mfFillType{{eid}}">
					 <option>Solid</option>
					 <option>Linear Vert.</option>
					 <option>Linear Horz.</option>
					 <option>Linear Diag.</option>
					 <option>Radial</option>
					 </select>
					
					<div  style='position: absolute; left: 80px; top: 50px;' ><input style='width: 100px;' type='text' id='mfFillColor_{{eid}}' /></div>
					<div  id='mfFillColorBlock2_{{eid}}' style='position: absolute;  left: 140px; top: 50px;' ><input style='width: 100px;' type='text' id='mfFillColor2_{{eid}}' /></div>
					
					<div style="position: absolute; left: 40px; top: 60px;"><img id="mfGradientExchange_{{eid}}" class="mfGradientExchange" title="Exchange Gradient Colors" style="height:20px;cursor: pointer;" src="images/editor/exchange.png"/></div>
		
		
					<div style="position: absolute; left: 10px; top: 100px;">Opacity:</div>
					<div style="position: absolute; height: 25px; font-size: 11px;  width: 100px; left: 83px; top: 95px;">
					<input id="mfFillOpacity{{eid}}" style="width: 100px;" class="balSlider" value="0" />
					</div>
			

			
			
			</div>
			
			*/
console.log;});var compiled_template=Handlebars.compile(htmlCode);var context={eid:thisClass.eid};var compiled_code=compiled_template(context);$("#"+thisClass.settingsHolder.eid+"_background").append(compiled_code);thisClass.setupEvents();$("#"+thisClass.eid).show();}else{$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);}};}function MF_BorderSettings(){var thisClass=this;thisClass.NAME="BorderSettings";thisClass.eid=mf_main.editorController.guidGenerator();thisClass.settingsHolder=null;thisClass.RENDERDOM=true;thisClass.showSetting=true;thisClass.borderTypeDropdown=null;thisClass.borderWidthBox=null;thisClass.borderRadiusBox=null;thisClass.currentSelectedBorder="all";thisClass.remove=function(delSet){if(delSet){try{if($("#mfBorderType"+thisClass.eid).data("kendoDropDownList")){$("#mfBorderType"+thisClass.eid).data("kendoDropDownList").destroy();}if($("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox")){$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").destroy();}if($("#mfBorderRadius_"+thisClass.eid).data("kendoNumericTextBox")){$("#mfBorderRadius_"+thisClass.eid).data("kendoNumericTextBox").destroy();}}catch(e){console.log("error occured in the component MF_BorderSettings.js");}$("#"+thisClass.eid).remove();}};thisClass.init=function(settingsHolder){thisClass.settingsHolder=settingsHolder;if(thisClass.RENDERDOM){thisClass.render();}else{thisClass.setupEvents();$("#"+thisClass.eid).show();}MF_ComponentSettingUtils.rememberToggle(thisClass);};thisClass.setupEvents=function(){if(thisClass.RENDERDOM){MF_ComponentSettingUtils.setupToggle(thisClass);$("#mfBorderType"+thisClass.eid).kendoDropDownList({select:onBorderTypeSelect});$("#mfBorderColor_"+thisClass.eid).spectrum({showInput:true,preferredFormat:"hex6",showPalette:true,showSelectionPalette:true,palette:[MF_ComponentUtils.commonPallete()],show:function(color){mf_main.editorController.shortcutsFlag=false;},hide:function(color){mf_main.editorController.shortcutsFlag=true;},change:function(color){var newarray=thisClass.settingsHolder.component.borderColors.slice();color=MF_Utils.RGBToHex(color.toRgbString());if(thisClass.currentSelectedBorder=="all"){newarray[0]=color;newarray[1]=color;newarray[2]=color;newarray[3]=color;newarray[4]=color;}if(thisClass.currentSelectedBorder=="top"){newarray[1]=color;}if(thisClass.currentSelectedBorder=="right"){newarray[2]=color;}if(thisClass.currentSelectedBorder=="bottom"){newarray[3]=color;}if(thisClass.currentSelectedBorder=="left"){newarray[4]=color;}thisClass.settingsHolder.component.e2xml.addPropArray("borderColors",newarray,"String");thisClass.settingsHolder.component.render(false);}});$("#mfBorderWidth_"+thisClass.eid).focusin(function(){mf_main.editorController.disableShortcuts();});$("#mfBorderWidth_"+thisClass.eid).focusout(function(){mf_main.editorController.enableShortcuts();});$("#mfBorderWidth_"+thisClass.eid).kendoNumericTextBox({format:"#",spinners:true,spin:onWidthChange,decimals:0,max:maxValue});$("#mfBorderWidth_"+thisClass.eid).focus(function(){$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onWidthChange);$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").bind("change",onWidthChange);});$("#mfBorderRadius_"+thisClass.eid).focusin(function(){mf_main.editorController.disableShortcuts();});$("#mfBorderRadius_"+thisClass.eid).focusout(function(){mf_main.editorController.enableShortcuts();});$("#mfBorderRadius_"+thisClass.eid).kendoNumericTextBox({format:"#",spinners:true,spin:onRadiusChange,decimals:0,min:0});$("#mfBorderRadius_"+thisClass.eid).focus(function(){$("#mfBorderRadius_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onRadiusChange);$("#mfBorderRadius_"+thisClass.eid).data("kendoNumericTextBox").bind("change",onRadiusChange);});$(".mfBorderSelectCls_"+thisClass.eid).on("click",function(event){$(".mfBorderSelectCls_"+thisClass.eid).css("background-color","#cccccc");var cval=0;if($(this).attr("id")==("mfTopBorder_"+thisClass.eid)){$(this).css("background-color","#2286FB");thisClass.currentSelectedBorder="top";cval=1;}if($(this).attr("id")==("mfBottomBorder_"+thisClass.eid)){$(this).css("background-color","#2286FB");thisClass.currentSelectedBorder="bottom";cval=2;}if($(this).attr("id")==("mfLeftBorder_"+thisClass.eid)){$(this).css("background-color","#2286FB");thisClass.currentSelectedBorder="left";cval=3;}if($(this).attr("id")==("mfRightBorder_"+thisClass.eid)){$(this).css("background-color","#2286FB");thisClass.currentSelectedBorder="right";cval=4;}if($(this).attr("id")==("mfAllBorder_"+thisClass.eid)){$(this).css("background-color","#2286FB");thisClass.currentSelectedBorder="all";cval=0;}thisClass.setBorderType(thisClass.settingsHolder.component.borderType[cval]);$("#mfBorderColor_"+thisClass.eid).spectrum("set",thisClass.settingsHolder.component.borderColors[cval]);thisClass.borderWidthBox.value(thisClass.settingsHolder.component.borderWidth[cval]);thisClass.borderRadiusBox.value(thisClass.settingsHolder.component.borderRadius[cval]);});}if(thisClass.RENDERDOM==true){thisClass.RENDERDOM=false;}thisClass.borderTypeDropdown=$("#mfBorderType"+thisClass.eid).data("kendoDropDownList");thisClass.setBorderType(thisClass.settingsHolder.component.borderType[0]);function onBorderTypeSelect(e){var newarray=thisClass.settingsHolder.component.borderType.slice();var gtype="solid";if(e.item.index()==0){gtype="solid";}if(e.item.index()==1){gtype="dashed";}if(e.item.index()==2){gtype="dotted";}if(e.item.index()==3){gtype="none";}if(thisClass.currentSelectedBorder=="all"){newarray[0]=gtype;newarray[1]=gtype;newarray[2]=gtype;newarray[3]=gtype;newarray[4]=gtype;}if(thisClass.currentSelectedBorder=="top"){newarray[1]=gtype;}if(thisClass.currentSelectedBorder=="right"){newarray[2]=gtype;}if(thisClass.currentSelectedBorder=="bottom"){newarray[3]=gtype;}if(thisClass.currentSelectedBorder=="left"){newarray[4]=gtype;}thisClass.settingsHolder.component.e2xml.addPropArray("borderType",newarray,"String");thisClass.settingsHolder.component.render(false);}$("#mfBorderColor_"+thisClass.eid).spectrum("set",thisClass.settingsHolder.component.borderColors[0]);var maxValue=500;if(thisClass.settingsHolder.component.MAX_BORDER){maxValue=thisClass.settingsHolder.component.MAX_BORDER;}function onWidthChange(){$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onWidthChange);$("#mfclipboard").focus();if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}var w=this.value();var newarray=thisClass.settingsHolder.component.borderWidth.slice();if(thisClass.currentSelectedBorder=="all"){newarray[0]=w;newarray[1]=w;newarray[2]=w;newarray[3]=w;newarray[4]=w;}if(thisClass.currentSelectedBorder=="top"){newarray[1]=w;}if(thisClass.currentSelectedBorder=="right"){newarray[2]=w;}if(thisClass.currentSelectedBorder=="bottom"){newarray[3]=w;}if(thisClass.currentSelectedBorder=="left"){newarray[4]=w;}thisClass.settingsHolder.component.e2xml.addPropArray("borderWidth",newarray,"uint");thisClass.settingsHolder.component.render(false);}thisClass.borderWidthBox=$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox");thisClass.borderWidthBox.value(thisClass.settingsHolder.component.borderWidth[0]);function onRadiusChange(){$("#mfBorderRadius_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onRadiusChange);$("#mfclipboard").focus();if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}var r=this.value();var newarray=thisClass.settingsHolder.component.borderRadius.slice();if(thisClass.currentSelectedBorder=="all"){newarray[0]=r;newarray[1]=r;newarray[2]=r;newarray[3]=r;newarray[4]=r;}if(thisClass.currentSelectedBorder=="top"){newarray[1]=r;}if(thisClass.currentSelectedBorder=="right"){newarray[2]=r;}if(thisClass.currentSelectedBorder=="bottom"){newarray[3]=r;}if(thisClass.currentSelectedBorder=="left"){newarray[4]=r;}thisClass.settingsHolder.component.e2xml.addPropArray("borderRadius",newarray,"uint");thisClass.settingsHolder.component.render(false);}thisClass.borderRadiusBox=$("#mfBorderRadius_"+thisClass.eid).data("kendoNumericTextBox");thisClass.borderRadiusBox.value(thisClass.settingsHolder.component.borderRadius[0]);};thisClass.setBorderType=function(borderType){if(borderType=="solid"){thisClass.borderTypeDropdown.select(0);}if(borderType=="dashed"){thisClass.borderTypeDropdown.select(1);}if(borderType=="dotted"){thisClass.borderTypeDropdown.select(2);}if(borderType=="none"){thisClass.borderTypeDropdown.select(3);}};thisClass.render=function(redraw,mfpage){if(redraw==null){redraw=true;}var htmlCode="";if(redraw){$("#"+thisClass.eid).remove();htmlCode=multiline(function(){
/*!
			
			<div id="{{eid}}_settingToggle"  class="mfImgLink mfSettingsToggleBtn" style=" " >
				
					<div style="float: left; width: 185px; padding-left: 5px;">Border</div>
					 
					<div style="float: left; width: 50px; text-align: right;">
						<span id="{{eid}}_settingToggleHide"  style="display: none; font-size: 20px;" class="ico-angle-right"></span>
						<span id="{{eid}}_settingToggleShow"  style="font-size: 20px;" class="ico-angle-down"></span>
					</div>
			</div>
						
			<div id="{{eid}}_partSetting" style="overflow: hidden; position: relative; width:100%; height: 180px;" >		

					

				
					<select style="left: 10px; top: 10px; width: 100px;" id="mfBorderType{{eid}}">
					 <option>solid</option>
					 <option>dashed</option>
					 <option>dotted</option>
					 <option>none</option>
					 </select>
				
					<div  style='position: absolute; left: 130px; top: 10px;' ><input  id='mfBorderColor_{{eid}}' style='width: 100px;' type='text'  /></div>

					<div style="position: absolute; left: 10px; top: 65px;">Thickness:</div>
					<div style="position: absolute; left: 100px; top: 60px;"><input style="width: 70px;" id="mfBorderWidth_{{eid}}" type="number" value="0" min="0" step="1" /></div>

					<div style="position: absolute; left: 10px; top: 115px;">Corner Radius:</div>
					<div style="position: absolute; left: 100px; top: 110px;"><input style="width: 70px;" id="mfBorderRadius_{{eid}}" type="number" value="0" min="0" max="10000000" step="1" /></div>

			
			</div>
			
			*/
console.log;});var compiled_template=Handlebars.compile(htmlCode);var context={eid:thisClass.eid};var compiled_code=compiled_template(context);$("#"+thisClass.settingsHolder.eid+"_border").append(compiled_code);thisClass.setupEvents();$("#"+thisClass.eid).show();}else{$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);}};}function MF_BorderSettings2(){var thisClass=this;thisClass.eid=mf_main.editorController.guidGenerator();thisClass.settingsHolder=null;thisClass.NAME="BorderSettings";thisClass.borderTypeDropdown=null;thisClass.borderWidthBox=null;thisClass.borderRadiusBox=null;thisClass.RENDERDOM=true;thisClass.showSetting=true;thisClass.remove=function(delSet){if(delSet){try{if($("#mfBorderType"+thisClass.eid).data("kendoDropDownList")){$("#mfBorderType"+thisClass.eid).data("kendoDropDownList").destroy();}if($("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox")){$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").destroy();}}catch(e){console.log("error occured in the component MF_BorderSettings2.js");}$("#"+thisClass.eid).remove();}};thisClass.init=function(settingsHolder){thisClass.settingsHolder=settingsHolder;if(thisClass.RENDERDOM){thisClass.render();}else{thisClass.setupEvents();$("#"+thisClass.eid).show();}MF_ComponentSettingUtils.rememberToggle(thisClass);};thisClass.setupEvents=function(){if(thisClass.RENDERDOM){MF_ComponentSettingUtils.setupToggle(thisClass);$("#mfBorderType"+thisClass.eid).kendoDropDownList({select:onBorderTypeSelect});$("#mfBorderColor_"+thisClass.eid).spectrum({showInput:true,preferredFormat:"hex6",showPalette:true,showSelectionPalette:true,palette:[MF_ComponentUtils.commonPallete()],show:function(color){mf_main.editorController.shortcutsFlag=false;},hide:function(color){mf_main.editorController.shortcutsFlag=true;},change:function(color){color=MF_Utils.RGBToHex(color.toRgbString());var cjson=MF_ComponentUtils.updateCSS(thisClass.settingsHolder.component,["border","border-color"]);if(cjson!=""){MF_ComponentUtils.applyCSSPropSingle(thisClass.settingsHolder,"borderColor",color,cjson);}else{thisClass.settingsHolder.component.e2xml.addPropSingle("borderColor",color);thisClass.settingsHolder.component.render(false);}}});$("#mfBorderWidth_"+thisClass.eid).focusin(function(){mf_main.editorController.disableShortcuts();});$("#mfBorderWidth_"+thisClass.eid).focusout(function(){mf_main.editorController.enableShortcuts();});$("#mfBorderWidth_"+thisClass.eid).kendoNumericTextBox({format:"#",spinners:true,spin:onWidthChange,decimals:0,max:maxValue});$("#mfBorderWidth_"+thisClass.eid).focus(function(){$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onWidthChange);$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").bind("change",onWidthChange);});}if(thisClass.RENDERDOM==true){thisClass.RENDERDOM=false;}thisClass.borderTypeDropdown=$("#mfBorderType"+thisClass.eid).data("kendoDropDownList");thisClass.setBorderType(thisClass.settingsHolder.component.borderType);function onBorderTypeSelect(e){var gtype="solid";if(e.item.index()==0){gtype="solid";}if(e.item.index()==1){gtype="dashed";}if(e.item.index()==2){gtype="dotted";}if(e.item.index()==3){gtype="none";}var cjson=MF_ComponentUtils.updateCSS(thisClass.settingsHolder.component,["border","border-width"]);if(cjson!=""){MF_ComponentUtils.applyCSSPropSingle(thisClass.settingsHolder,"borderType",gtype,cjson);}else{thisClass.settingsHolder.component.e2xml.addPropSingle("borderType",gtype);thisClass.settingsHolder.component.render(false);}}$("#mfBorderColor_"+thisClass.eid).spectrum("set",thisClass.settingsHolder.component.borderColor);var maxValue=500;if(thisClass.settingsHolder.component.MAX_BORDER){maxValue=thisClass.settingsHolder.component.MAX_BORDER;}function onWidthChange(){$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onWidthChange);$("#mfclipboard").focus();if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}var w=this.value();var cjson=MF_ComponentUtils.updateCSS(thisClass.settingsHolder.component,["border","border-width"]);if(cjson!=""){MF_ComponentUtils.applyCSSPropSingle(thisClass.settingsHolder,"borderWidth",w,cjson);}else{thisClass.settingsHolder.component.e2xml.addPropSingle("borderWidth",w);thisClass.settingsHolder.component.render(false);}}thisClass.borderWidthBox=$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox");thisClass.borderWidthBox.value(thisClass.settingsHolder.component.borderWidth);};thisClass.setBorderType=function(borderType){if(borderType=="solid"){thisClass.borderTypeDropdown.select(0);}if(borderType=="dashed"){thisClass.borderTypeDropdown.select(1);}if(borderType=="dotted"){thisClass.borderTypeDropdown.select(2);}if(borderType=="none"){thisClass.borderTypeDropdown.select(3);}};thisClass.render=function(redraw,mfpage){if(redraw==null){redraw=true;}var htmlCode="";if(redraw){$("#"+thisClass.eid).remove();htmlCode=multiline(function(){
/*!
			
			<div id="{{eid}}_settingToggle"  class="mfImgLink mfSettingsToggleBtn" style=" " >
				
					<div style="float: left; width: 185px; padding-left: 5px;">Border</div>
					 
					<div style="float: left; width: 50px; text-align: right;">
						<span id="{{eid}}_settingToggleHide"  style="display: none; font-size: 20px;" class="ico-angle-right"></span>
						<span id="{{eid}}_settingToggleShow"  style="font-size: 20px;" class="ico-angle-down"></span>
					</div>
			</div>
						
			<div id="{{eid}}_partSetting" style="overflow: hidden; position: relative; width:100%; height: 150px;" >		

					

					
					<div style="position: absolute; left: 10px; top: 15px;">Type:</div>
	
					<select style="left: 100px; top: 10px; width: 100px;" id="mfBorderType{{eid}}">
					 <option>solid</option>
					 <option>dashed</option>
					 <option>dotted</option>
					 <option>none</option>
					 </select>
				
					<div style="position: absolute; left: 10px; top: 53px;">Color:</div>
					<div  style='position: absolute; left: 100px; top: 47px;' ><input  id='mfBorderColor_{{eid}}' style='width: 100px;' type='text'  /></div>

					<div style="position: absolute; left: 10px; top: 95px;">Thickness:</div>
					<div style="position: absolute; left: 100px; top: 90px;"><input style="width: 70px;" id="mfBorderWidth_{{eid}}" type="number" value="0" min="0"  step="1" /></div>

					
			
			</div>
			
			*/
console.log;});var compiled_template=Handlebars.compile(htmlCode);var context={eid:thisClass.eid};var compiled_code=compiled_template(context);$("#"+thisClass.settingsHolder.eid+"_border").append(compiled_code);thisClass.setupEvents();$("#"+thisClass.eid).show();}else{$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);}};}function MF_BorderSettings3(){var thisClass=this;thisClass.eid=mf_main.editorController.guidGenerator();thisClass.settingsHolder=null;thisClass.NAME="BorderSettings";thisClass.global=false;thisClass.RENDERDOM=true;thisClass.borderTypeDropdown=null;thisClass.borderWidthBox=null;thisClass.borderRadiusBox=null;thisClass.globalBorderWidth=1;thisClass.globalBorderColor="#000000";thisClass.globalBorderRadius=0;thisClass.globalBorderType="solid";thisClass.showSetting=true;this.getCommonBorder=function(){var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){if(select.component.hasOwnProperty("borderRadius")){if(select.component.borderRadius instanceof Array){thisClass.globalBorderRadius=select.component.borderRadius[0];}else{thisClass.globalBorderRadius=select.component.borderRadius;}}if(select.component.hasOwnProperty("borderType")){if(select.component.borderType instanceof Array){thisClass.globalBorderType=select.component.borderType[0];}else{thisClass.globalBorderType=select.component.borderType;}}if(select.component.hasOwnProperty("borderColor")){if(select.component.borderColor instanceof Array){thisClass.globalBorderColor=select.component.borderColor[0];}else{thisClass.globalBorderColor=select.component.borderColor;}}if(select.component.hasOwnProperty("borderColors")){if(select.component.borderColors instanceof Array){thisClass.globalBorderColor=select.component.borderColors[0];}else{thisClass.globalBorderColor=select.component.borderColors;}}if(select.component.hasOwnProperty("borderWidth")){if(select.component.borderWidth instanceof Array){thisClass.globalBorderWidth=select.component.borderWidth[0];}else{thisClass.globalBorderWidth=select.component.borderWidth;}}}}};thisClass.remove=function(delSet){if(delSet){try{if($("#mfBorderType"+thisClass.eid).data("kendoDropDownList")){$("#mfBorderType"+thisClass.eid).data("kendoDropDownList").destroy();}if($("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox")){$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").destroy();}if($("#mfBorderRadius_"+thisClass.eid).data("kendoNumericTextBox")){$("#mfBorderRadius_"+thisClass.eid).data("kendoNumericTextBox").destroy();}}catch(e){console.log("error occured in the component MF_BorderSettings3.js");}$("#"+thisClass.eid).remove();}};thisClass.init=function(settingsHolder){thisClass.settingsHolder=settingsHolder;if(thisClass.RENDERDOM){thisClass.render();}else{thisClass.setupEvents();$("#"+thisClass.eid).show();}MF_ComponentSettingUtils.rememberToggle(thisClass);};thisClass.setupEvents=function(){if(thisClass.RENDERDOM){MF_ComponentSettingUtils.setupToggle(thisClass);$("#mfBorderRadius_"+thisClass.eid).focusin(function(){mf_main.editorController.disableShortcuts();});$("#mfBorderRadius_"+thisClass.eid).focusout(function(){mf_main.editorController.enableShortcuts();});$("#mfBorderRadius_"+thisClass.eid).kendoNumericTextBox({format:"#",spinners:true,spin:onRadiusChange,decimals:0});$("#mfBorderRadius_"+thisClass.eid).focus(function(){$("#mfBorderRadius_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onRadiusChange);$("#mfBorderRadius_"+thisClass.eid).data("kendoNumericTextBox").bind("change",onRadiusChange);});$("#mfBorderType"+thisClass.eid).kendoDropDownList({select:onBorderTypeSelect});$("#mfBorderColor_"+thisClass.eid).spectrum({showInput:true,preferredFormat:"hex6",showPalette:true,showSelectionPalette:true,palette:[MF_ComponentUtils.commonPallete()],show:function(color){mf_main.editorController.shortcutsFlag=false;},hide:function(color){mf_main.editorController.shortcutsFlag=true;},change:function(color){color=MF_Utils.RGBToHex(color.toRgbString());if(thisClass.global){var undoarr=new Array();var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){if(select.component.hasOwnProperty("borderColors")){var undo=new MF_UndoDAO();undo.propArrayUndo(select.component,"borderColors",select.component.borderColors.slice(),"String");undoarr.push(undo);var newarray=new Array();newarray[0]=color;newarray[1]=color;newarray[2]=color;newarray[3]=color;newarray[4]=color;select.component.e2xml.addPropArray("borderColors",newarray,"String","default");select.component.render(false);}if(select.component.hasOwnProperty("borderColor")){var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"borderColor",select.component.borderColor);undoarr.push(undo);select.component.e2xml.addPropSingle("borderColor",color,"default");select.component.render(false);}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}else{thisClass.settingsHolder.component.e2xml.addPropSingle("borderColor",color);thisClass.settingsHolder.component.render(false);}}});$("#mfBorderWidth_"+thisClass.eid).focusin(function(){mf_main.editorController.disableShortcuts();});$("#mfBorderWidth_"+thisClass.eid).focusout(function(){mf_main.editorController.enableShortcuts();});$("#mfBorderWidth_"+thisClass.eid).kendoNumericTextBox({format:"#",spinners:true,spin:onWidthChange,decimals:0,max:maxValue});$("#mfBorderWidth_"+thisClass.eid).focus(function(){$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onWidthChange);$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").bind("change",onWidthChange);});}if(thisClass.RENDERDOM==true){thisClass.RENDERDOM=false;}thisClass.getCommonBorder();function onRadiusChange(){$("#mfBorderRadius_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onRadiusChange);$("#mfclipboard").focus();if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}var r=this.value();if(thisClass.global){var undoarr=new Array();var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){if(select.component.hasOwnProperty("borderRadius")){if(select.component.borderRadius&&select.component.borderRadius instanceof Array){var undo=new MF_UndoDAO();undo.propArrayUndo(select.component,"borderRadius",select.component.borderRadius.slice(),"uint");undoarr.push(undo);var newarray=new Array();newarray[0]=r;newarray[1]=r;newarray[2]=r;newarray[3]=r;newarray[4]=r;select.component.e2xml.addPropArray("borderRadius",newarray,"uint","default");select.component.render(false);}else{var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"borderRadius",select.component.borderRadius);undoarr.push(undo);select.component.e2xml.addPropSingle("borderRadius",r,"default");select.component.render(false);}}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}else{thisClass.settingsHolder.component.e2xml.addPropSingle("borderRadius",r);thisClass.settingsHolder.component.render(false);}}thisClass.borderRadiusBox=$("#mfBorderRadius_"+thisClass.eid).data("kendoNumericTextBox");if(thisClass.global==false){thisClass.borderRadiusBox.value(thisClass.settingsHolder.component.borderRadius);}else{thisClass.borderRadiusBox.value(thisClass.globalBorderRadius);}thisClass.borderTypeDropdown=$("#mfBorderType"+thisClass.eid).data("kendoDropDownList");if(thisClass.global==false){thisClass.setBorderType(thisClass.settingsHolder.component.borderType);}else{thisClass.setBorderType(thisClass.globalBorderType);}function onBorderTypeSelect(e){var gtype="solid";if(e.item.index()==0){gtype="solid";}if(e.item.index()==1){gtype="dashed";}if(e.item.index()==2){gtype="dotted";}if(e.item.index()==3){gtype="none";}if(thisClass.global){var undoarr=new Array();var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){if(select.component.hasOwnProperty("borderType")){if(select.component.borderType&&select.component.borderType instanceof Array){var undo=new MF_UndoDAO();undo.propArrayUndo(select.component,"borderType",select.component.borderType.slice(),"String");undoarr.push(undo);var newarray=new Array();newarray[0]=gtype;newarray[1]=gtype;newarray[2]=gtype;newarray[3]=gtype;newarray[4]=gtype;select.component.e2xml.addPropArray("borderType",newarray,"String","default");select.component.render(false);}else{var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"borderType",select.component.borderType);undoarr.push(undo);select.component.e2xml.addPropSingle("borderType",gtype,"default");select.component.render(false);}}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}else{thisClass.settingsHolder.component.e2xml.addPropSingle("borderType",gtype);thisClass.settingsHolder.component.render(false);}}if(thisClass.global==false){$("#mfBorderColor_"+thisClass.eid).spectrum("set",thisClass.settingsHolder.component.borderColor);}else{$("#mfBorderColor_"+thisClass.eid).spectrum("set",thisClass.globalBorderColor);}var maxValue=500;if(thisClass.global==false){if(thisClass.settingsHolder.component.MAX_BORDER){maxValue=thisClass.settingsHolder.component.MAX_BORDER;}}function onWidthChange(){$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onWidthChange);$("#mfclipboard").focus();if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}var w=this.value();if(thisClass.global){var undoarr=new Array();var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){if(select.component.hasOwnProperty("borderWidth")){if(select.component.borderWidth&&select.component.borderWidth instanceof Array){var undo=new MF_UndoDAO();undo.propArrayUndo(select.component,"borderWidth",select.component.borderWidth.slice(),"uint");undoarr.push(undo);var newarray=new Array();newarray[0]=w;newarray[1]=w;newarray[2]=w;newarray[3]=w;newarray[4]=w;select.component.e2xml.addPropArray("borderWidth",newarray,"uint","default");select.component.render(false);}else{var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"borderWidth",select.component.borderWidth);undoarr.push(undo);select.component.e2xml.addPropSingle("borderWidth",w,"default");select.component.render(false);}}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}else{thisClass.settingsHolder.component.e2xml.addPropSingle("borderWidth",w);thisClass.settingsHolder.component.render(false);}}thisClass.borderWidthBox=$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox");if(thisClass.global==false){thisClass.borderWidthBox.value(thisClass.settingsHolder.component.borderWidth);}else{thisClass.borderWidthBox.value(thisClass.globalBorderWidth);}};thisClass.setBorderType=function(borderType){if(borderType=="solid"){thisClass.borderTypeDropdown.select(0);}if(borderType=="dashed"){thisClass.borderTypeDropdown.select(1);}if(borderType=="dotted"){thisClass.borderTypeDropdown.select(2);}if(borderType=="none"){thisClass.borderTypeDropdown.select(3);}};thisClass.render=function(redraw,mfpage){if(redraw==null){redraw=true;}var htmlCode="";if(redraw){$("#"+thisClass.eid).remove();htmlCode=multiline(function(){
/*!
			
			<div id="{{eid}}_settingToggle"  class="mfImgLink mfSettingsToggleBtn" style=" " >
				
					<div style="float: left; width: 185px; padding-left: 5px;">Border</div>
					 
					<div style="float: left; width: 50px; text-align: right;">
						<span id="{{eid}}_settingToggleHide"  style="display: none; font-size: 20px;" class="ico-angle-right"></span>
						<span id="{{eid}}_settingToggleShow"  style="font-size: 20px;" class="ico-angle-down"></span>
					</div>
			</div>
						
			<div id="{{eid}}_partSetting" style="overflow: hidden; position: relative; width:100%; height: 200px;" >		

					

					
					<div style="position: absolute; left: 10px; top: 15px;">Type:</div>
	
					<select style="left: 100px; top: 10px; width: 100px;" id="mfBorderType{{eid}}">
					 <option>solid</option>
					 <option>dashed</option>
					 <option>dotted</option>
					 <option>none</option>
					 </select>
				
					<div style="position: absolute; left: 10px; top: 53px;">Color:</div>
					<div  style='position: absolute; left: 100px; top: 47px;' ><input  id='mfBorderColor_{{eid}}' style='width: 100px;' type='text'  /></div>

					<div style="position: absolute; left: 10px; top: 95px;">Thickness:</div>
					<div style="position: absolute; left: 100px; top: 90px;"><input style="width: 70px;" id="mfBorderWidth_{{eid}}" type="number" value="0" min="0" step="1" /></div>

					<div style="position: absolute; left: 10px; top: 145px;">Corner Radius:</div>
					<div style="position: absolute; left: 100px; top: 140px;"><input style="width: 70px;" id="mfBorderRadius_{{eid}}" type="number" value="0" min="0" max="10000000" step="1" /></div>

			
			</div>
			
			*/
console.log;});var compiled_template=Handlebars.compile(htmlCode);var context={eid:thisClass.eid};var compiled_code=compiled_template(context);$("#"+thisClass.settingsHolder.eid+"_border").append(compiled_code);thisClass.setupEvents();$("#"+thisClass.eid).show();}else{$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);}};}function MF_BorderSettings4(){var thisClass=this;thisClass.NAME="BorderSettings";thisClass.eid=mf_main.editorController.guidGenerator();thisClass.settingsHolder=null;thisClass.borderTypeDropdown=null;thisClass.borderWidthBox=null;thisClass.borderRadiusBox=null;thisClass.currentSelectedBorder="all";thisClass.RENDERDOM=true;thisClass.showSetting=true;thisClass.remove=function(delSet){if(delSet){try{if($("#mfBorderType"+thisClass.eid).data("kendoDropDownList")){$("#mfBorderType"+thisClass.eid).data("kendoDropDownList").destroy();}if($("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox")){$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").destroy();}if($("#mfBorderRadius_"+thisClass.eid).data("kendoNumericTextBox")){$("#mfBorderRadius_"+thisClass.eid).data("kendoNumericTextBox").destroy();}}catch(e){console.log("error occured in the component MF_BorderSettings4.js");}$("#"+thisClass.eid).remove();}};thisClass.init=function(settingsHolder){thisClass.settingsHolder=settingsHolder;if(thisClass.RENDERDOM){thisClass.render();}else{thisClass.setupEvents();$("#"+thisClass.eid).show();}MF_ComponentSettingUtils.rememberToggle(thisClass);};thisClass.setupEvents=function(){if(thisClass.RENDERDOM){MF_ComponentSettingUtils.setupToggle(thisClass);$("#mfBorderType"+thisClass.eid).kendoDropDownList({select:onBorderTypeSelect});$("#mfBorderColor_"+thisClass.eid).spectrum({showInput:true,preferredFormat:"hex6",showPalette:true,showSelectionPalette:true,palette:[MF_ComponentUtils.commonPallete()],show:function(color){mf_main.editorController.shortcutsFlag=false;},hide:function(color){mf_main.editorController.shortcutsFlag=true;},change:function(color){var newarray=thisClass.settingsHolder.component.borderColors.slice();color=MF_Utils.RGBToHex(color.toRgbString());if(thisClass.currentSelectedBorder=="all"){newarray[0]=color;newarray[1]=color;newarray[2]=color;newarray[3]=color;newarray[4]=color;}if(thisClass.currentSelectedBorder=="top"){newarray[1]=color;}if(thisClass.currentSelectedBorder=="right"){newarray[2]=color;}if(thisClass.currentSelectedBorder=="bottom"){newarray[3]=color;}if(thisClass.currentSelectedBorder=="left"){newarray[4]=color;}var cjson=MF_ComponentUtils.updateCSS(thisClass.settingsHolder.component,["border","border-color"]);if(cjson!=""){MF_ComponentUtils.applyCSSPropArray(thisClass.settingsHolder,"borderColors",newarray,"String",cjson);}else{thisClass.settingsHolder.component.e2xml.addPropArray("borderColors",newarray,"String");thisClass.settingsHolder.component.render(false);}}});$("#mfBorderWidth_"+thisClass.eid).focusin(function(){mf_main.editorController.disableShortcuts();});$("#mfBorderWidth_"+thisClass.eid).focusout(function(){mf_main.editorController.enableShortcuts();});$("#mfBorderWidth_"+thisClass.eid).kendoNumericTextBox({format:"#",spinners:true,spin:onWidthChange,decimals:0,max:maxValue});$("#mfBorderWidth_"+thisClass.eid).focus(function(){$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onWidthChange);$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").bind("change",onWidthChange);});$("#mfBorderRadius_"+thisClass.eid).focusin(function(){mf_main.editorController.disableShortcuts();});$("#mfBorderRadius_"+thisClass.eid).focusout(function(){mf_main.editorController.enableShortcuts();});$("#mfBorderRadius_"+thisClass.eid).kendoNumericTextBox({format:"#",spinners:true,spin:onRadiusChange,decimals:0,min:0});$("#mfBorderRadius_"+thisClass.eid).focus(function(){$("#mfBorderRadius_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onRadiusChange);$("#mfBorderRadius_"+thisClass.eid).data("kendoNumericTextBox").bind("change",onRadiusChange);});$(".mfBorderSelectCls_"+thisClass.eid).on("click",function(event){$(".mfBorderSelectCls_"+thisClass.eid).css("background-color","#cccccc");var cval=0;if($(this).attr("id")==("mfTopBorder_"+thisClass.eid)){$(this).css("background-color","#2286FB");thisClass.currentSelectedBorder="top";cval=1;}if($(this).attr("id")==("mfBottomBorder_"+thisClass.eid)){$(this).css("background-color","#2286FB");thisClass.currentSelectedBorder="bottom";cval=3;}if($(this).attr("id")==("mfLeftBorder_"+thisClass.eid)){$(this).css("background-color","#2286FB");thisClass.currentSelectedBorder="left";cval=4;}if($(this).attr("id")==("mfRightBorder_"+thisClass.eid)){$(this).css("background-color","#2286FB");thisClass.currentSelectedBorder="right";cval=2;}if($(this).attr("id")==("mfAllBorder_"+thisClass.eid)){$(this).css("background-color","#2286FB");thisClass.currentSelectedBorder="all";cval=0;}thisClass.setBorderType(thisClass.settingsHolder.component.borderType[cval]);$("#mfBorderColor_"+thisClass.eid).spectrum("set",thisClass.settingsHolder.component.borderColors[cval]);thisClass.borderWidthBox.value(thisClass.settingsHolder.component.borderWidth[cval]);thisClass.borderRadiusBox.value(thisClass.settingsHolder.component.borderRadius[cval]);});}if(thisClass.RENDERDOM==true){thisClass.RENDERDOM=false;}thisClass.borderTypeDropdown=$("#mfBorderType"+thisClass.eid).data("kendoDropDownList");function onBorderTypeSelect(e){var newarray=thisClass.settingsHolder.component.borderType.slice();var gtype="solid";if(e.item.index()==0){gtype="solid";}if(e.item.index()==1){gtype="dashed";}if(e.item.index()==2){gtype="dotted";}if(e.item.index()==3){gtype="none";}if(thisClass.currentSelectedBorder=="all"){newarray[0]=gtype;newarray[1]=gtype;newarray[2]=gtype;newarray[3]=gtype;newarray[4]=gtype;}if(thisClass.currentSelectedBorder=="top"){newarray[1]=gtype;}if(thisClass.currentSelectedBorder=="right"){newarray[2]=gtype;}if(thisClass.currentSelectedBorder=="bottom"){newarray[3]=gtype;}if(thisClass.currentSelectedBorder=="left"){newarray[4]=gtype;}var cjson=MF_ComponentUtils.updateCSS(thisClass.settingsHolder.component,["border","border-type"]);if(cjson!=""){MF_ComponentUtils.applyCSSPropArray(thisClass.settingsHolder,"borderType",newarray,"String",cjson);}else{thisClass.settingsHolder.component.e2xml.addPropArray("borderType",newarray,"String");thisClass.settingsHolder.component.render(false);}}var maxValue=500;if(thisClass.settingsHolder.component.MAX_BORDER){maxValue=thisClass.settingsHolder.component.MAX_BORDER;}function onWidthChange(){$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onWidthChange);$("#mfclipboard").focus();if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}var w=this.value();var newarray=thisClass.settingsHolder.component.borderWidth.slice();if(thisClass.currentSelectedBorder=="all"){newarray[0]=w;newarray[1]=w;newarray[2]=w;newarray[3]=w;newarray[4]=w;}if(thisClass.currentSelectedBorder=="top"){newarray[1]=w;}if(thisClass.currentSelectedBorder=="right"){newarray[2]=w;}if(thisClass.currentSelectedBorder=="bottom"){newarray[3]=w;}if(thisClass.currentSelectedBorder=="left"){newarray[4]=w;}var cjson=MF_ComponentUtils.updateCSS(thisClass.settingsHolder.component,["border","border-width"]);if(cjson!=""){MF_ComponentUtils.applyCSSPropArray(thisClass.settingsHolder,"borderWidth",newarray,"uint",cjson);}else{thisClass.settingsHolder.component.e2xml.addPropArray("borderWidth",newarray,"uint");thisClass.settingsHolder.component.render(false);}}thisClass.borderWidthBox=$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox");function onRadiusChange(){$("#mfBorderRadius_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onRadiusChange);$("#mfclipboard").focus();if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}var r=this.value();var newarray=thisClass.settingsHolder.component.borderRadius.slice();if(thisClass.currentSelectedBorder=="all"){newarray[0]=r;newarray[1]=r;newarray[2]=r;newarray[3]=r;newarray[4]=r;}if(thisClass.currentSelectedBorder=="top"){newarray[1]=r;}if(thisClass.currentSelectedBorder=="right"){newarray[2]=r;}if(thisClass.currentSelectedBorder=="bottom"){newarray[3]=r;}if(thisClass.currentSelectedBorder=="left"){newarray[4]=r;}var cjson=MF_ComponentUtils.updateCSS(thisClass.settingsHolder.component,["border-radius"]);if(cjson!=""){MF_ComponentUtils.applyCSSPropArray(thisClass.settingsHolder,"borderRadius",newarray,"uint",cjson);}else{thisClass.settingsHolder.component.e2xml.addPropArray("borderRadius",newarray,"uint");thisClass.settingsHolder.component.render(false);}}thisClass.borderRadiusBox=$("#mfBorderRadius_"+thisClass.eid).data("kendoNumericTextBox");var cval=0;if(thisClass.currentSelectedBorder=="top"){cval=1;}if(thisClass.currentSelectedBorder=="bottom"){cval=3;}if(thisClass.currentSelectedBorder=="left"){cval=4;}if(thisClass.currentSelectedBorder=="right"){cval=2;}if(thisClass.currentSelectedBorder=="all"){cval=0;}thisClass.setBorderType(thisClass.settingsHolder.component.borderType[cval]);$("#mfBorderColor_"+thisClass.eid).spectrum("set",thisClass.settingsHolder.component.borderColors[cval]);thisClass.borderWidthBox.value(thisClass.settingsHolder.component.borderWidth[cval]);thisClass.borderRadiusBox.value(thisClass.settingsHolder.component.borderRadius[cval]);};thisClass.setBorderType=function(borderType){if(borderType=="solid"){thisClass.borderTypeDropdown.select(0);}if(borderType=="dashed"){thisClass.borderTypeDropdown.select(1);}if(borderType=="dotted"){thisClass.borderTypeDropdown.select(2);}if(borderType=="none"){thisClass.borderTypeDropdown.select(3);}};thisClass.render=function(redraw,mfpage){if(redraw==null){redraw=true;}var htmlCode="";if(redraw){$("#"+thisClass.eid).remove();htmlCode=multiline(function(){
/*!
			
			<div id="{{eid}}_settingToggle"  class="mfImgLink mfSettingsToggleBtn" style=" " >
				
					<div style="float: left; width: 185px; padding-left: 5px;">Border</div>
					 
					<div style="float: left; width: 50px; text-align: right;">
						<span id="{{eid}}_settingToggleHide"  style="display: none; font-size: 20px;" class="ico-angle-right"></span>
						<span id="{{eid}}_settingToggleShow"  style="font-size: 20px;" class="ico-angle-down"></span>
					</div>
			</div>
						
			<div id="{{eid}}_partSetting" style="overflow: hidden; position: relative; width:100%; height: 270px;" >		

					
					<div style="position:absolute; left: 10px; top: 10px;">
						<div data-toggle="tooltip"  data-placement="top" title="Left Border" class="mfBorderSelectCls_{{eid}}" id="mfLeftBorder_{{eid}}" style="cursor: pointer; position: absolute; left: 0px; top: 30px; background-color: #ccc; width: 5px; height: 15px;"></div>
						<div data-toggle="tooltip"  data-placement="top" title="Top Border" class="mfBorderSelectCls_{{eid}}"  id="mfTopBorder_{{eid}}" style="cursor: pointer; position: absolute; left: 20px; top: 10px; background-color: #ccc; width: 15px; height: 5px;"></div>
						<div data-toggle="tooltip"  data-placement="top" title="Right Border" class="mfBorderSelectCls_{{eid}}"   id="mfRightBorder_{{eid}}" style="cursor: pointer; position: absolute; left: 50px; top: 30px; background-color: #ccc; width: 5px; height: 15px;"></div>
						<div data-toggle="tooltip"  data-placement="top" title="Bottom Border" class="mfBorderSelectCls_{{eid}}"   id="mfBottomBorder_{{eid}}" style="cursor: pointer; position: absolute; left: 20px; top: 60px; background-color: #ccc; width: 15px; height: 5px;"></div>
						<div data-toggle="tooltip"  data-placement="top" title="All Borders" class="mfBorderSelectCls_{{eid}}"   id="mfAllBorder_{{eid}}" style="cursor: pointer; position: absolute; left: 20px; top: 30px; background-color: #6997F2; color :#fff; width: 15px; height: 15px;"></div>
					</div>

				
					<select style="left: 10px; top: 105px; width: 100px;" id="mfBorderType{{eid}}">
					 <option>solid</option>
					 <option>dashed</option>
					 <option>dotted</option>
					 <option>none</option>
					 </select>
				
					<div  style='position: absolute; left: 130px; top: 105px;' ><input  id='mfBorderColor_{{eid}}' style='width: 100px;' type='text'  /></div>

					<div style="position: absolute; left: 10px; top: 165px;">Thickness:</div>
					<div style="position: absolute; left: 100px; top: 160px;"><input style="width: 70px;" id="mfBorderWidth_{{eid}}" type="number" value="0" min="0" step="1" /></div>

					<div style="position: absolute; left: 10px; top: 205px;">Corner Radius:</div>
					<div style="position: absolute; left: 100px; top: 200px;"><input style="width: 70px;" id="mfBorderRadius_{{eid}}" type="number" value="0" min="0" max="10000000" step="1" /></div>

			
			</div>
			
			*/
console.log;});var compiled_template=Handlebars.compile(htmlCode);var context={eid:thisClass.eid};var compiled_code=compiled_template(context);$("#"+thisClass.settingsHolder.eid+"_border").append(compiled_code);thisClass.setupEvents();$("#"+thisClass.eid).show();}else{$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);}};}function MF_ShadowSettings(){var thisClass=this;thisClass.eid=mf_main.editorController.guidGenerator();thisClass.settingsHolder=null;thisClass.NAME="ShadowSettings";thisClass.RENDERDOM=true;thisClass.global=false;thisClass.showSetting=true;thisClass.hOffsetSizeBox=null;thisClass.vOffsetSizeBox=null;thisClass.blurBox=null;thisClass.spreadBox=null;thisClass.customArr=new Array();thisClass.globalShadowType="none";this.getCommonShadow=function(){var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){if(select.component.hasOwnProperty("shadowType")){thisClass.globalShadowType=select.component.shadowType;}}}};thisClass.remove=function(delSet){if(delSet){try{if($("#mfShadowType"+thisClass.eid).data("kendoDropDownList")){$("#mfShadowType"+thisClass.eid).data("kendoDropDownList").destroy();}if($("#mfShadowHOffset_"+thisClass.eid).data("kendoNumericTextBox")){$("#mfShadowHOffset_"+thisClass.eid).data("kendoNumericTextBox").destroy();}if($("#mfShadowVOffset_"+thisClass.eid).data("kendoNumericTextBox")){$("#mfShadowVOffset_"+thisClass.eid).data("kendoNumericTextBox").destroy();}if($("#mfShadowBlur_"+thisClass.eid).data("kendoNumericTextBox")){$("#mfShadowBlur_"+thisClass.eid).data("kendoNumericTextBox").destroy();}if($("#mfShadowSpread_"+thisClass.eid).data("kendoNumericTextBox")){$("#mfShadowSpread_"+thisClass.eid).data("kendoNumericTextBox").destroy();}if($("#mfShadowOpacity"+thisClass.eid).data("kendoSlider")){$("#mfShadowOpacity"+thisClass.eid).data("kendoSlider").destroy();}}catch(e){console.log("error occured in the component MF_ShadowSettings.js");}$("#"+thisClass.eid).remove();}};thisClass.init=function(settingsHolder){thisClass.settingsHolder=settingsHolder;if(thisClass.RENDERDOM){thisClass.render();}else{thisClass.setupEvents();$("#"+thisClass.eid).show();}MF_ComponentSettingUtils.rememberToggle(thisClass);};thisClass.setupEvents=function(){if(thisClass.RENDERDOM){MF_ComponentSettingUtils.setupToggle(thisClass);$("#mfShadowType"+thisClass.eid).kendoDropDownList({select:onShadowSelect});$("#mfShadowOpacity"+thisClass.eid).kendoSlider({showButtons:false,change:alphaSliderOnSlide,tickPlacement:"none",min:0,max:1,smallStep:0.1,largeStep:0.1,tooltip:{enabled:false},value:1}).data("kendoSlider");$("#mfShadowSpread_"+thisClass.eid).focusin(function(){mf_main.editorController.disableShortcuts();});$("#mfShadowSpread_"+thisClass.eid).focusout(function(){mf_main.editorController.enableShortcuts();});$("#mfShadowSpread_"+thisClass.eid).kendoNumericTextBox({format:"#",spinners:true,spin:onSpreadChange,decimals:0,max:500});$("#mfShadowSpread_"+thisClass.eid).focus(function(){$("#mfShadowSpread_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onSpreadChange);$("#mfShadowSpread_"+thisClass.eid).data("kendoNumericTextBox").bind("change",onSpreadChange);});$("#mfShadowHOffset_"+thisClass.eid).focusin(function(){mf_main.editorController.disableShortcuts();});$("#mfShadowHOffset_"+thisClass.eid).focusout(function(){mf_main.editorController.enableShortcuts();});$("#mfShadowHOffset_"+thisClass.eid).kendoNumericTextBox({format:"#",spinners:true,spin:onHOffsetChange,decimals:0,max:500});$("#mfShadowHOffset_"+thisClass.eid).focus(function(){$("#mfShadowHOffset_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onHOffsetChange);$("#mfShadowHOffset_"+thisClass.eid).data("kendoNumericTextBox").bind("change",onHOffsetChange);});$("#mfShadowVOffset_"+thisClass.eid).focusin(function(){mf_main.editorController.disableShortcuts();});$("#mfShadowVOffset_"+thisClass.eid).focusout(function(){mf_main.editorController.enableShortcuts();});$("#mfShadowVOffset_"+thisClass.eid).kendoNumericTextBox({format:"#",spinners:true,spin:onVOffsetChange,decimals:0,max:500});$("#mfShadowVOffset_"+thisClass.eid).focus(function(){$("#mfShadowVOffset_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onVOffsetChange);$("#mfShadowVOffset_"+thisClass.eid).data("kendoNumericTextBox").bind("change",onVOffsetChange);});$("#mfShadowBlur_"+thisClass.eid).focusin(function(){mf_main.editorController.disableShortcuts();});$("#mfShadowBlur_"+thisClass.eid).focusout(function(){mf_main.editorController.enableShortcuts();});$("#mfShadowBlur_"+thisClass.eid).kendoNumericTextBox({format:"#",spinners:true,spin:onBlurChange,decimals:0,max:500});$("#mfShadowBlur_"+thisClass.eid).focus(function(){$("#mfShadowBlur_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onBlurChange);$("#mfShadowBlur_"+thisClass.eid).data("kendoNumericTextBox").bind("change",onBlurChange);});$("#mfShadowColor_"+thisClass.eid).spectrum({showInput:true,preferredFormat:"hex6",showPalette:true,showSelectionPalette:true,palette:[MF_ComponentUtils.commonPallete()],show:function(color){mf_main.editorController.shortcutsFlag=false;},hide:function(color){mf_main.editorController.shortcutsFlag=true;},change:function(color){thisClass.formCustomShadow();}});}if(thisClass.RENDERDOM==true){thisClass.RENDERDOM=false;}thisClass.getCommonShadow();var dropdownlist=$("#mfShadowType"+thisClass.eid).data("kendoDropDownList");$(".mfShadowCustomCls"+thisClass.eid).hide();$("#"+thisClass.eid+"_partSetting").css("height","90px");var stype="";if(thisClass.global==false){stype=thisClass.settingsHolder.component.shadowType;}else{stype=thisClass.globalShadowType;}if(stype=="none"){dropdownlist.select(0);}if(stype=="all"){dropdownlist.select(1);}if(stype=="top"){dropdownlist.select(2);}if(stype=="right"){dropdownlist.select(3);}if(stype=="bottom"){dropdownlist.select(4);}if(stype=="left"){dropdownlist.select(5);}if(stype.indexOf("custom")!=-1){$("#"+thisClass.eid+"_partSetting").css("height","260px");$(".mfShadowCustomCls"+thisClass.eid).show();dropdownlist.select(6);thisClass.customArr=stype.split("::");}function onShadowSelect(e){var gtype="none";$(".mfShadowCustomCls"+thisClass.eid).hide();$("#"+thisClass.eid+"_partSetting").css("height","90px");if(e.item.index()==0){gtype="none";}if(e.item.index()==1){gtype="all";}if(e.item.index()==2){gtype="top";}if(e.item.index()==3){gtype="right";}if(e.item.index()==4){gtype="bottom";}if(e.item.index()==5){gtype="left";}if(e.item.index()==6){gtype="custom";$(".mfShadowCustomCls"+thisClass.eid).show();}if(gtype=="custom"){$("#"+thisClass.eid+"_partSetting").css("height","260px");thisClass.formCustomShadow();return;}if(thisClass.global){var undoarr=new Array();var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){if(select.component.hasOwnProperty("shadowType")){var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"shadowType",select.component.shadowType);undoarr.push(undo);var cjson=MF_ComponentUtils.updateCSS(select.component,["box-shadow"]);if(cjson!=""){undoarr=MF_ComponentUtils.addCSSUndo(select.component,cjson,undoarr);}select.component.e2xml.addPropSingle("shadowType",gtype,"default");select.component.render(false);}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}else{var cjson=MF_ComponentUtils.updateCSS(thisClass.settingsHolder.component,["box-shadow"]);if(cjson!=""){MF_ComponentUtils.applyCSSPropSingle(thisClass.settingsHolder,"shadowType",gtype,cjson);}else{thisClass.settingsHolder.component.e2xml.addPropSingle("shadowType",gtype);thisClass.settingsHolder.component.render(false);}}}function alphaSliderOnSlide(e){thisClass.formCustomShadow();}function onHOffsetChange(){$("#mfShadowHOffset_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onHOffsetChange);$("#mfclipboard").focus();if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}thisClass.formCustomShadow();}thisClass.hOffsetSizeBox=$("#mfShadowHOffset_"+thisClass.eid).data("kendoNumericTextBox");function onVOffsetChange(){$("#mfShadowVOffset_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onVOffsetChange);$("#mfclipboard").focus();if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}thisClass.formCustomShadow();}thisClass.vOffsetSizeBox=$("#mfShadowVOffset_"+thisClass.eid).data("kendoNumericTextBox");function onBlurChange(){$("#mfShadowBlur_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onBlurChange);$("#mfclipboard").focus();if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}thisClass.formCustomShadow();}thisClass.blurBox=$("#mfShadowBlur_"+thisClass.eid).data("kendoNumericTextBox");function onSpreadChange(){$("#mfShadowSpread_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onSpreadChange);$("#mfclipboard").focus();if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}thisClass.formCustomShadow();}thisClass.spreadBox=$("#mfShadowSpread_"+thisClass.eid).data("kendoNumericTextBox");thisClass.setCustomShadow();};thisClass.formCustomShadow=function(){var str="custom";str=str+"::"+thisClass.hOffsetSizeBox.value();str=str+"::"+thisClass.vOffsetSizeBox.value();str=str+"::"+thisClass.blurBox.value();str=str+"::"+thisClass.spreadBox.value();str=str+"::"+$("#mfShadowColor_"+thisClass.eid).spectrum("get").toHexString();var aslider4=$("#mfShadowOpacity"+thisClass.eid).data("kendoSlider");str=str+"::"+aslider4.value();var customshadow=str;if(thisClass.global){var undoarr=new Array();var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){if(select.component.hasOwnProperty("shadowType")){var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"shadowType",select.component.shadowType);undoarr.push(undo);var cjson=MF_ComponentUtils.updateCSS(select.component,["box-shadow"]);if(cjson!=""){undoarr=MF_ComponentUtils.addCSSUndo(select.component,cjson,undoarr);}select.component.e2xml.addPropSingle("shadowType",customshadow,"default");select.component.render(false);}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}else{var cjson=MF_ComponentUtils.updateCSS(thisClass.settingsHolder.component,["box-shadow"]);if(cjson!=""){MF_ComponentUtils.applyCSSPropSingle(thisClass.settingsHolder,"shadowType",customshadow,cjson);}else{thisClass.settingsHolder.component.e2xml.addPropSingle("shadowType",customshadow);thisClass.settingsHolder.component.render(false);}}};thisClass.setCustomShadow=function(){var stype="";if(thisClass.global==false){stype=thisClass.settingsHolder.component.shadowType;}else{stype=thisClass.globalShadowType;}if(stype.indexOf("custom")!=-1){if(thisClass.customArr&&thisClass.customArr.length>=7){thisClass.hOffsetSizeBox.value(thisClass.customArr[1]);thisClass.vOffsetSizeBox.value(thisClass.customArr[2]);thisClass.blurBox.value(thisClass.customArr[3]);thisClass.spreadBox.value(thisClass.customArr[4]);$("#mfShadowColor_"+thisClass.eid).spectrum("set",thisClass.customArr[5]);var aslider2=$("#mfShadowOpacity"+thisClass.eid).data("kendoSlider");aslider2.value(thisClass.customArr[6]);}}};thisClass.render=function(redraw,mfpage){if(redraw==null){redraw=true;}var htmlCode="";if(redraw){$("#"+thisClass.eid).remove();htmlCode=multiline(function(){
/*!
			
			<div id="{{eid}}_settingToggle"  class="mfImgLink mfSettingsToggleBtn" style=" " >
				
					<div style="float: left; width: 185px; padding-left: 5px;">Shadow</div>
					
					<div style="float: left; width: 50px; text-align: right;">
						<span id="{{eid}}_settingToggleHide"  style="display: none; font-size: 20px;" class="ico-angle-right"></span>
						<span id="{{eid}}_settingToggleShow"  style="font-size: 20px;" class="ico-angle-down"></span>
					</div>
			</div>
						
			<div id="{{eid}}_partSetting" style="overflow: hidden; position: relative; width:100%; height: 80px;" >		

					<div style="position: absolute; left: 10px; top: 20px;">Position:</div>
			
					 <select style="left: 80px; top: 15px; width: 100px;" id="mfShadowType{{eid}}">
					 <option>None</option>
					 <option>All</option>
					 <option>Top</option>
					 <option>Right</option>
					 <option>Bottom</option>
					 <option>Left</option>
					 <option>Custom</option>
					 </select>
					 
					 <div class='mfShadowCustomCls{{eid}}' style="position: absolute; left: 10px; top: 65px;">Horz. Offset: &nbsp; &nbsp; <br/><input style="width: 60px;" id="mfShadowHOffset_{{eid}}" type="number" value="0" min="-1000" step="1" /> px</div>

					<div class='mfShadowCustomCls{{eid}}' style="position: absolute; left: 120px; top: 65px;">Vert. Offset: &nbsp; &nbsp; <br/><input style="width: 60px;" id="mfShadowVOffset_{{eid}}" type="number" value="0" min="-1000" step="1" /> px</div>
			
					 <div class='mfShadowCustomCls{{eid}}' style="position: absolute; left: 10px; top: 115px;">Blur: &nbsp; &nbsp; <br/><input style="width: 60px;" id="mfShadowBlur_{{eid}}" type="number" value="5" min="0" step="1" /> px</div>

					<div class='mfShadowCustomCls{{eid}}' style="position: absolute; left: 120px; top: 115px;">Spread: &nbsp; &nbsp; <br/><input style="width: 60px;" id="mfShadowSpread_{{eid}}" type="number" value="0" min="-1000" step="1" /> px</div>
			
				
					 
					<div class='mfShadowCustomCls{{eid}}' style="position: absolute; left: 10px; top: 190px;">Opacity:</div>
					<div class='mfShadowCustomCls{{eid}}' style="position: absolute; height: 25px; font-size: 11px;  width: 80px; left: 75px; top: 185px;">
					<input id="mfShadowOpacity{{eid}}" style="width: 80px;" class="balSlider" value="0" />
					</div>
					
					<div  class='mfShadowCustomCls{{eid}}' style='position: absolute; left: 170px; top: 185px;' ><input  id='mfShadowColor_{{eid}}' style='width: 100px;' type='text'  /></div>
					
					
					
					
			
			
			</div>
			
			*/
console.log;});var compiled_template=Handlebars.compile(htmlCode);var context={eid:thisClass.eid};var compiled_code=compiled_template(context);$("#"+thisClass.settingsHolder.eid+"_shadow").append(compiled_code);thisClass.setupEvents();$("#"+thisClass.eid).show();}else{$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);}};}function MF_FontSettings2(){var thisClass=this;thisClass.eid=mf_main.editorController.guidGenerator();thisClass.settingsHolder=null;thisClass.NAME="FontSettings2";thisClass.global=false;thisClass.RENDERDOM=true;thisClass.fontObj=null;thisClass.globalFontWeight="normal";thisClass.globalFontStyle="normal";thisClass.globalTextDecoration="none";thisClass.currentFont="";thisClass.fontWeightTypeDropdown=null;thisClass.showAlign=true;thisClass.showTextStyles=true;thisClass.showSetting=true;this.globalFontObj=null;this.globalFontColor="#000000";this.globalFontSize=14;this.globalFontWeight="normal";thisClass.remove=function(delSet){if(delSet){try{if($("#mfFontWeightType_"+thisClass.eid).data("kendoDropDownList")){$("#mfFontWeightType_"+thisClass.eid).data("kendoDropDownList").destroy();}if($("#mfFontSize_"+thisClass.eid).data("kendoNumericTextBox")){$("#mfFontSize_"+thisClass.eid).data("kendoNumericTextBox").destroy();}}catch(e){console.log("error occured in the component MF_FontSettings2.js");}$("#"+thisClass.eid).remove();}};thisClass.init=function(settingsHolder){thisClass.settingsHolder=settingsHolder;if(thisClass.RENDERDOM){thisClass.render();}else{thisClass.setupEvents();$("#"+thisClass.eid).show();}MF_ComponentSettingUtils.rememberToggle(thisClass);};thisClass.globalTextAlign=function(typeval){var undoarr=new Array();var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){if(select.component.hasOwnProperty("textAlign")){var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"textAlign",select.component.textAlign);undoarr.push(undo);select.component.e2xml.addPropSingle("textAlign",typeval,"default");select.component.render(false);}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}};thisClass.setAlignToggle=function(val){if(val){$(".mfAlignFontCls_"+thisClass.eid).css("background","#ffffff");if(val=="right"){$("#mfAlignRight_"+thisClass.eid).css("background","#EEEEEE");}else{if(val=="center"){$("#mfAlignCenter_"+thisClass.eid).css("background","#EEEEEE");}else{if(val=="justify"){$("#mfAlignJustify_"+thisClass.eid).css("background","#EEEEEE");}else{$("#mfAlignLeft_"+thisClass.eid).css("background","#EEEEEE");}}}}};thisClass.setItalicToggle=function(val){if(val){if(val=="italic"){$("#mfItalicText_"+thisClass.eid).css("background","#EEEEEE");}else{$("#mfItalicText_"+thisClass.eid).css("background","#ffffff");}}};thisClass.setUnderlineToggle=function(val){if(val){if(val=="underline"){$("#mfUnderlineText_"+thisClass.eid).css("background","#EEEEEE");}else{$("#mfUnderlineText_"+thisClass.eid).css("background","#ffffff");}}};thisClass.setupEvents=function(){if(thisClass.RENDERDOM){MF_ComponentSettingUtils.setupToggle(thisClass);$("#mfFontWeightType_"+thisClass.eid).kendoDropDownList({dataTextField:"text",dataValueField:"value",select:onFontWeightSelect});$("#mfAlignLeft_"+thisClass.eid).on("click",function(event){if(thisClass.global){thisClass.globalTextAlign("left");}else{var cjson=MF_ComponentUtils.updateCSS(thisClass.settingsHolder.component,["text-align"]);if(cjson!=""){MF_ComponentUtils.applyCSSPropSingle(thisClass.settingsHolder,"textAlign","left",cjson);}else{thisClass.settingsHolder.component.e2xml.addPropSingle("textAlign","left");thisClass.settingsHolder.component.render(false);}}thisClass.setAlignToggle("left");});$("#mfAlignCenter_"+thisClass.eid).on("click",function(event){if(thisClass.global){thisClass.globalTextAlign("center");}else{var cjson=MF_ComponentUtils.updateCSS(thisClass.settingsHolder.component,["text-align"]);if(cjson!=""){MF_ComponentUtils.applyCSSPropSingle(thisClass.settingsHolder,"textAlign","center",cjson);}else{thisClass.settingsHolder.component.e2xml.addPropSingle("textAlign","center");thisClass.settingsHolder.component.render(false);}}thisClass.setAlignToggle("center");});$("#mfAlignRight_"+thisClass.eid).on("click",function(event){if(thisClass.global){thisClass.globalTextAlign("right");}else{var cjson=MF_ComponentUtils.updateCSS(thisClass.settingsHolder.component,["text-align"]);if(cjson!=""){MF_ComponentUtils.applyCSSPropSingle(thisClass.settingsHolder,"textAlign","right",cjson);}else{thisClass.settingsHolder.component.e2xml.addPropSingle("textAlign","right");thisClass.settingsHolder.component.render(false);}}thisClass.setAlignToggle("right");});$("#mfAlignJustify_"+thisClass.eid).on("click",function(event){if(thisClass.global){thisClass.globalTextAlign("justify");}else{var cjson=MF_ComponentUtils.updateCSS(thisClass.settingsHolder.component,["text-align"]);if(cjson!=""){MF_ComponentUtils.applyCSSPropSingle(thisClass.settingsHolder,"textAlign","justify",cjson);}else{thisClass.settingsHolder.component.e2xml.addPropSingle("textAlign","justify");thisClass.settingsHolder.component.render(false);}}thisClass.setAlignToggle("justify");});$("#mfItalicText_"+thisClass.eid).on("click",function(event){if(thisClass.global){var aval=thisClass.globalFontStyle;if(aval=="italic"){aval="normal";thisClass.globalFontStyle="normal";}else{aval="italic";thisClass.globalFontStyle="italic";}var undoarr=new Array();var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){if(select.component.hasOwnProperty("fontStyle")){var cjson=MF_ComponentUtils.updateCSS(select.component,["font-style"]);if(cjson!=""){undoarr=MF_ComponentUtils.addCSSUndo(select.component,cjson,undoarr);}if(select.component.NAME=="MF_Text"){var componentText=select.component.text;var fontStyleRegex=/font-style: (normal|italic);/gm;componentText=componentText.replaceAll(fontStyleRegex,"font-style: "+updatedFontStyle+";");var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"text",select.component.text);undoarr.push(undo);select.component.e2xml.addPropSingle("text",componentText,"default");}var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"fontStyle",select.component.fontStyle);undoarr.push(undo);select.component.e2xml.addPropSingle("fontStyle",aval,"default");select.component.render(false);}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}thisClass.setItalicToggle(aval);}else{var updatedFontStyle="normal";if(thisClass.settingsHolder.component.fontStyle=="normal"){updatedFontStyle="italic";}var undoarr=new Array();if(thisClass.settingsHolder.component.NAME=="MF_Text"){var componentText=thisClass.settingsHolder.component.text;var fontStyleRegex=/font-style: (normal|italic);/gm;componentText=componentText.replaceAll(fontStyleRegex,"font-style: "+updatedFontStyle+";");var undo=new MF_UndoDAO();undo.propSingleUndo(thisClass.settingsHolder.component,"text",thisClass.settingsHolder.component.text);undoarr.push(undo);thisClass.settingsHolder.component.e2xml.addPropSingle("text",componentText,"default");}var cjson=MF_ComponentUtils.updateCSS(thisClass.settingsHolder.component,["font-style"]);if(cjson!=""){undoarr=MF_ComponentUtils.addCSSUndo(thisClass.settingsHolder.component,cjson,undoarr);thisClass.settingsHolder.cssSettings.init(thisClass.settingsHolder);}var undo=new MF_UndoDAO();undo.propSingleUndo(thisClass.settingsHolder.component,"fontStyle",thisClass.settingsHolder.component.fontStyle);undoarr.push(undo);thisClass.settingsHolder.component.e2xml.addPropSingle("fontStyle",updatedFontStyle,"default");thisClass.settingsHolder.component.render(false);thisClass.setItalicToggle(thisClass.settingsHolder.component.fontStyle);if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}});$("#mfUnderlineText_"+thisClass.eid).on("click",function(event){if(thisClass.global){var aval=thisClass.globalTextDecoration;if(aval=="none"){aval="underline";thisClass.globalTextDecoration="underline";}else{aval="none";thisClass.globalTextDecoration="none";}var undoarr=new Array();var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){if(select.component.hasOwnProperty("textDecoration")){var cjson=MF_ComponentUtils.updateCSS(select.component,["text-decoration"]);if(cjson!=""){undoarr=MF_ComponentUtils.addCSSUndo(select.component,cjson,undoarr);}if(select.component.NAME=="MF_Text"){var componentText=select.component.text;var fontUnderlineRegex=/text-decoration: (none|underline);/gm;componentText=componentText.replaceAll(fontUnderlineRegex,"text-decoration: "+updatedFontUnderline+";");var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"text",select.component.text);undoarr.push(undo);select.component.e2xml.addPropSingle("text",componentText,"default");}var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"textDecoration",select.component.textDecoration);undoarr.push(undo);select.component.e2xml.addPropSingle("textDecoration",aval,"default");select.component.render(false);}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}thisClass.setUnderlineToggle(aval);}else{var updatedFontUnderline="none";if(thisClass.settingsHolder.component.textDecoration=="none"){updatedFontUnderline="underline";}var undoarr=new Array();if(thisClass.settingsHolder.component.NAME=="MF_Text"){var componentText=thisClass.settingsHolder.component.text;var fontUnderlineRegex=/text-decoration: (none|underline);/gm;componentText=componentText.replaceAll(fontUnderlineRegex,"text-decoration: "+updatedFontUnderline+";");var undo=new MF_UndoDAO();undo.propSingleUndo(thisClass.settingsHolder.component,"text",thisClass.settingsHolder.component.text);undoarr.push(undo);thisClass.settingsHolder.component.e2xml.addPropSingle("text",componentText,"default");}var cjson=MF_ComponentUtils.updateCSS(thisClass.settingsHolder.component,["text-decoration"]);if(cjson!=""){undoarr=MF_ComponentUtils.addCSSUndo(thisClass.settingsHolder.component,cjson,undoarr);thisClass.settingsHolder.cssSettings.init(thisClass.settingsHolder);}var undo=new MF_UndoDAO();undo.propSingleUndo(thisClass.settingsHolder.component,"textDecoration",thisClass.settingsHolder.component.textDecoration);undoarr.push(undo);thisClass.settingsHolder.component.e2xml.addPropSingle("textDecoration",updatedFontUnderline,"default");thisClass.settingsHolder.component.render(false);thisClass.setUnderlineToggle(thisClass.settingsHolder.component.textDecoration);if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}});$("#mfFontFamily_"+thisClass.eid).on("click",function(event){mf_main.editorController.disableShortcuts();$("#mfFontSelectScreen").show();$("#mfFontLoadScreen").hide();if(thisClass.global==false){mf_main.editorController.selectedFontComp=thisClass.settingsHolder.component;}else{mf_main.editorController.selectedFontComp="global";}$("#mffontusedbtn").click();$("#mfFontModal").modal();$("#mfFontSearchBox").val("");$("#mfFontCurrent").text($("#mfFontFamily_"+thisClass.eid).text());mf_main.componentList.searchFontsHandler(null);mf_main.editorController.showPopUp(event,$("#mfFontSelectionPopUp"));});$("#mfFontSize_"+thisClass.eid).focusin(function(){mf_main.editorController.disableShortcuts();});$("#mfFontSize_"+thisClass.eid).focusout(function(){mf_main.editorController.enableShortcuts();});$("#mfFontSize_"+thisClass.eid).kendoNumericTextBox({format:"#",spinners:true,spin:onFontSizeChange,decimals:0});$("#mfFontSize_"+thisClass.eid).focus(function(){$("#mfFontSize_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onFontSizeChange);$("#mfFontSize_"+thisClass.eid).data("kendoNumericTextBox").bind("change",onFontSizeChange);});$("#mfTextColor_"+thisClass.eid).spectrum({showInput:true,preferredFormat:"hex6",showPalette:true,showSelectionPalette:true,palette:[MF_ComponentUtils.commonPallete()],show:function(color){mf_main.editorController.shortcutsFlag=false;},hide:function(color){mf_main.editorController.shortcutsFlag=true;},change:function(color){var colorRGB=color.toRgbString();color=MF_Utils.RGBToHex(color.toRgbString());if(thisClass.global){var undoarr=new Array();var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){if(select.component.hasOwnProperty("fontColor")){if(select.component.NAME=="MF_Text"){var componentText=select.component.text;var colorRegex=/color: rgb\([0-9]+, [0-9]+, [0-9]+\);/gm;componentText=componentText.replaceAll(colorRegex,"color: "+colorRGB+";");var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"text",select.component.text);undoarr.push(undo);select.component.e2xml.addPropSingle("text",componentText,"default");}var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"fontColor",select.component.fontColor);undoarr.push(undo);var cjson=MF_ComponentUtils.updateCSS(select.component,["color"]);if(cjson!=""){undoarr=MF_ComponentUtils.addCSSUndo(select.component,cjson,undoarr);}select.component.e2xml.addPropSingle("fontColor",color,"default");select.component.render(false);}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}else{var undoarr=new Array();if(thisClass.settingsHolder.component.NAME=="MF_Text"){var componentText=thisClass.settingsHolder.component.text;var colorRegex=/color: rgb\([0-9]+, [0-9]+, [0-9]+\);/gm;componentText=componentText.replaceAll(colorRegex,"color: "+colorRGB+";");var undo=new MF_UndoDAO();undo.propSingleUndo(thisClass.settingsHolder.component,"text",thisClass.settingsHolder.component.text);undoarr.push(undo);thisClass.settingsHolder.component.e2xml.addPropSingle("text",componentText,"default");}var cjson=MF_ComponentUtils.updateCSS(thisClass.settingsHolder.component,["color"]);if(cjson!=""){undoarr=MF_ComponentUtils.addCSSUndo(thisClass.settingsHolder.component,cjson,undoarr);thisClass.settingsHolder.cssSettings.init(thisClass.settingsHolder);}mf_main.editorController.stopEditingText();var undo=new MF_UndoDAO();undo.propSingleUndo(thisClass.settingsHolder.component,"fontColor",thisClass.settingsHolder.component.fontColor);undoarr.push(undo);thisClass.settingsHolder.component.e2xml.addPropSingle("fontColor",color,"default");thisClass.settingsHolder.component.render(false);if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}}});}if(thisClass.RENDERDOM==true){thisClass.RENDERDOM=false;}var fontFamily="SourceSans Pro";if(thisClass.global==false){thisClass.fontObj=mf_main.editorController.fontController.getFontByID(thisClass.settingsHolder.component.fontType);}else{thisClass.getCommonFont();if(thisClass.globalFontObj!=null){thisClass.fontObj=mf_main.editorController.fontController.getFontByID(thisClass.globalFontObj.fontType);}}if(thisClass.fontObj){fontFamily=thisClass.fontObj.name;}else{if(thisClass.globalFontObj&&thisClass.global){if(thisClass.globalFontObj.isGoogleFontUsed){fontFamily=thisClass.globalFontObj.fontType;}}else{if(!thisClass.global&&thisClass.settingsHolder.component.isGoogleFontUsed){fontFamily=thisClass.settingsHolder.component.fontType;}}}if(thisClass.globalFontObj==null&&thisClass.global){fontFamily=$("#mfFontFamily_"+thisClass.eid).text();}thisClass.fontWeightTypeDropdown=$("#mfFontWeightType_"+thisClass.eid).data("kendoDropDownList");var selectIndex=-1;var varray=new ArrayCollection();var normalFound=false;var boldFound=false;var googleFontUsed=false;if(fontFamily=="sourcesanspro"||fontFamily=="SourceSans Pro"||fontFamily=="Source Sans Pro"||fontFamily=="SourceSansPro"){var obj=new Object();obj.text="200";obj.value="200";varray.addItemAt(obj,0);var obj=new Object();obj.text="300";obj.value="300";varray.addItemAt(obj,0);var obj=new Object();obj.text="600";obj.value="600";varray.addItemAt(obj,0);var obj=new Object();obj.text="900";obj.value="900";varray.addItemAt(obj,0);}else{if(!thisClass.global&&thisClass.settingsHolder.component.isGoogleFontUsed){googleFontUsed=true;}else{if(thisClass.global&&thisClass.globalFontObj&&thisClass.globalFontObj.isGoogleFontUsed){googleFontUsed=true;}}}if(googleFontUsed){var variants=mf_main.editorController.fontController.getGoogleFontVariants(fontFamily);for(var j=0;j<variants.length;j++){var obj=new Object();obj.text=variants[j];obj.value=variants[j];if(obj.text=="normal"){normalFound=true;}if(obj.text=="bold"){boldFound=true;}var vitem=variants[j];if(vitem.indexOf("italic")!=-1||vitem.indexOf("regular")!=-1){}else{varray.addItem(obj);}}}if(!normalFound){var obj=new Object();obj.text="normal";obj.value="normal";varray.addItemAt(obj,0);}if(!boldFound){var obj=new Object();obj.text="bold";obj.value="bold";varray.addItemAt(obj,1);}for(var k=0;k<varray.size();k++){var obj=varray.getItemAt(k);if(obj&&!thisClass.global){if(obj.text==thisClass.settingsHolder.component.fontWeight){selectIndex=k;}}else{if(obj&&thisClass.global){if(obj.text==thisClass.globalFontWeight){selectIndex=k;}}}}thisClass.fontWeightTypeDropdown.setDataSource(varray.toArray());if(selectIndex==-1){selectIndex=0;}thisClass.fontWeightTypeDropdown.select(selectIndex);function onFontWeightSelect(e){var gtype="normal";gtype=e.item.text();if(!thisClass.global){var undoarr=new Array();var cjson=MF_ComponentUtils.updateCSS(thisClass.settingsHolder.component,["font-weight"]);if(cjson!=""){undoarr=MF_ComponentUtils.addCSSUndo(thisClass.settingsHolder.component,cjson,undoarr);thisClass.settingsHolder.cssSettings.init(thisClass.settingsHolder);}if(thisClass.settingsHolder.component.NAME=="MF_Text"){var componentText=thisClass.settingsHolder.component.text;var fontWeightRegex=/font-weight: (normal|bold);/gm;componentText=componentText.replaceAll(fontWeightRegex,"font-weight: "+gtype+";");var undo=new MF_UndoDAO();undo.propSingleUndo(thisClass.settingsHolder.component,"text",thisClass.settingsHolder.component.text);undoarr.push(undo);thisClass.settingsHolder.component.e2xml.addPropSingle("text",componentText,"default");}var undo=new MF_UndoDAO();undo.propSingleUndo(thisClass.settingsHolder.component,"fontWeight",thisClass.settingsHolder.component.fontWeight);undoarr.push(undo);thisClass.settingsHolder.component.e2xml.addPropSingle("fontWeight",gtype,"default");thisClass.settingsHolder.component.render(false);if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}else{thisClass.globalFontWeight=gtype;var undoarr=new Array();var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){if(select.component.hasOwnProperty("fontWeight")){var cjson=MF_ComponentUtils.updateCSS(select.component,["font-weight"]);if(cjson!=""){undoarr=MF_ComponentUtils.addCSSUndo(select.component,cjson,undoarr);}if(select.component.NAME=="MF_Text"){var componentText=select.component.text;var fontWeightRegex=/font-weight: (normal|bold);/gm;componentText=componentText.replaceAll(fontWeightRegex,"font-weight: "+gtype+";");var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"text",select.component.text);undoarr.push(undo);select.component.e2xml.addPropSingle("text",componentText,"default");}var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"fontWeight",select.component.fontWeight);undoarr.push(undo);select.component.e2xml.addPropSingle("fontWeight",gtype,"default");select.component.render(false);}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}}thisClass.currentFont=fontFamily;if(thisClass.showAlign){if(!thisClass.global){thisClass.setAlignToggle(thisClass.settingsHolder.component.textAlign);}}if(thisClass.showTextStyles){if(!thisClass.global){thisClass.setItalicToggle(thisClass.settingsHolder.component.fontStyle);}if(!thisClass.global){thisClass.setUnderlineToggle(thisClass.settingsHolder.component.textDecoration);}}if(thisClass.global==false){$("#mfFontFamily_"+thisClass.eid).text(fontFamily);}else{if(thisClass.globalFontObj!=null&&thisClass.global){$("#mfFontFamily_"+thisClass.eid).text(fontFamily);}}function onFontSizeChange(){$("#mfFontSize_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onFontSizeChange);$("#mfclipboard").focus();if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}var fontSize=this.value();if(thisClass.global){var undoarr=new Array();var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){if(select.component.hasOwnProperty("fontSize")){if(select.component.NAME=="MF_Text"){var componentText=select.component.text;var fontSizeRegex=/font-size: [0-9]+px;/gm;componentText=componentText.replaceAll(fontSizeRegex,"font-size: "+fontSize+"px;");var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"text",select.component.text);undoarr.push(undo);select.component.e2xml.addPropSingle("text",componentText,"default");}var undo=new MF_UndoDAO();undo.propSingleUndo(select.component,"fontSize",select.component.fontSize);undoarr.push(undo);var cjson=MF_ComponentUtils.updateCSS(select.component,["font-size"]);if(cjson!=""){undoarr=MF_ComponentUtils.addCSSUndo(select.component,cjson,undoarr);}select.component.e2xml.addPropSingle("fontSize",fontSize,"default");select.component.render(false);}}}if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}else{var undoarr=new Array();if(thisClass.settingsHolder.component.NAME=="MF_Text"){var componentText=thisClass.settingsHolder.component.text;var fontSizeRegex=/font-size: [0-9]+px;/gm;componentText=componentText.replaceAll(fontSizeRegex,"font-size: "+fontSize+"px;");var undo=new MF_UndoDAO();undo.propSingleUndo(thisClass.settingsHolder.component,"text",thisClass.settingsHolder.component.text);undoarr.push(undo);thisClass.settingsHolder.component.e2xml.addPropSingle("text",componentText,"default");}mf_main.editorController.stopEditingText();var undo=new MF_UndoDAO();undo.propSingleUndo(thisClass.settingsHolder.component,"fontSize",thisClass.settingsHolder.component.fontSize);undoarr.push(undo);var cjson=MF_ComponentUtils.updateCSS(thisClass.settingsHolder.component,["font-size"]);if(cjson!=""){undoarr=MF_ComponentUtils.addCSSUndo(thisClass.settingsHolder.component,cjson,undoarr);thisClass.settingsHolder.cssSettings.init(thisClass.settingsHolder);}thisClass.settingsHolder.component.e2xml.addPropSingle("fontSize",fontSize,"default");thisClass.settingsHolder.component.render(false);if(undoarr.length>0){var undoObj=new MF_UndoDAO();var meta=new MF_MetaUndo(undoarr);undoObj.metaUndo(meta);MF_ChangeManager.addUndo(undoObj);MF_ChangeManager.CHANGED(true);}}}var fontSizeBox=$("#mfFontSize_"+thisClass.eid).data("kendoNumericTextBox");if(thisClass.global==false){fontSizeBox.value(thisClass.settingsHolder.component.fontSize);}else{fontSizeBox.value(thisClass.globalFontSize);}if(thisClass.global==false){$("#mfTextColor_"+thisClass.eid).spectrum("set",thisClass.settingsHolder.component.fontColor);}else{$("#mfTextColor_"+thisClass.eid).spectrum("set",thisClass.globalFontColor);}if(thisClass.showAlign){$("#"+thisClass.eid+"_partSetting").height(260);$("#mfAlignBtnGrpCls_"+thisClass.eid).show();}else{$("#"+thisClass.eid+"_partSetting").height(200);$("#mfAlignBtnGrpCls_"+thisClass.eid).hide();}if(thisClass.showTextStyles){$("#mfTextStyles_"+thisClass.eid).show();}else{$("#mfTextStyles_"+thisClass.eid).hide();}};this.getCommonFont=function(){var fontObj=null;var fontColor=thisClass.globalFontColor;var fontSize=thisClass.globalFontSize;var fontWeight=thisClass.globalFontWeight;var allselections=mf_main.editorController.getAllComponentSelects();for(var i=0;i<allselections.length;i++){var select=allselections[i];if(!select.GROUP&&select.component){if(select.component.hasOwnProperty("fontType")){if(fontObj==null){fontObj=new Object();fontObj.isGoogleFontUsed=select.component.isGoogleFontUsed;fontObj.fontType=select.component.fontType;}else{if(fontObj&&fontObj.fontType==select.component.fontType){}else{fontObj=null;}}}if(select.component.hasOwnProperty("fontColor")){fontColor=select.component.fontColor;}if(select.component.hasOwnProperty("fontSize")){fontSize=select.component.fontSize;}if(select.component.hasOwnProperty("fontWeight")){fontWeight=select.component.fontWeight;}}}thisClass.globalFontObj=fontObj;thisClass.globalFontColor=fontColor;thisClass.globalFontSize=fontSize;thisClass.globalFontWeight=fontWeight;};thisClass.render=function(redraw,mfpage){if(redraw==null){redraw=true;}var htmlCode="";if(redraw){$("#"+thisClass.eid).remove();htmlCode=multiline(function(){
/*!
			
			<div id="{{eid}}_settingToggle"  class="mfImgLink mfSettingsToggleBtn" style=" " >
				
					<div style="float: left; width: 185px; padding-left: 5px;">Font</div>
					
					<div style="float: left; width: 50px; text-align: right;">
						<span id="{{eid}}_settingToggleHide"  style="display: none; font-size: 20px;" class="ico-angle-right"></span>
						<span id="{{eid}}_settingToggleShow"  style="font-size: 20px;" class="ico-angle-down"></span>
					</div>
			</div>
						
			<div id="{{eid}}_partSetting" style="overflow: hidden; position: relative; width:100%; height: 250px;" >	 	

					
					
				<div  style="position: absolute; left: 15px; top: 20px; font-weight: normal;" >
				Font: </div>
				
				<div class="mfFontFamilyCls mfSingleLine"  id="mfFontFamily_{{eid}}"  style="width: 180px; cursor: pointer; color: #2196F3; position: absolute; left: 50px; top: 20px; font-weight: normal;" >Select font
				</div>
				
				
				<div style="left: 15px; top: 65px; width: 30px; position: absolute;" >
					Style: 
				</div> 
				
				<select style="position: absolute; left: 50px; top: 60px; width: 100px; " id="mfFontWeightType_{{eid}}">
					
				</select> 
				
				
				
				<div  id="mfTextStyles_{{eid}}"  style="position: absolute; left: 160px; top: 60px;" class="btn-toolbar">
			 		<div class="btn-group">
						<button id="mfItalicText_{{eid}}" style='height: 25px; font-size: 10px;' class="btn" ><i class="fa fa-italic"></i></button>
						<button id="mfUnderlineText_{{eid}}" style='height: 25px; font-size: 10px;' class="btn"  ><i class="fa fa-underline"></i></button>
			 		</div>
			 	</div>
				
				
				
				
				<div style="position: absolute; left: 10px; top: 110px;">Font Size: &nbsp; &nbsp; <br/><input style="width: 60px;"  id="mfFontSize_{{eid}}" type="number" value="12" min="6" max="500" step="1" /> px</div>

				<div style="position: absolute; left: 120px; top: 110px;">Font Color: &nbsp; &nbsp; <br/><input style='' type='text' id='mfTextColor_{{eid}}' /> </div>
			
				
			
				<div id="mfAlignBtnGrpCls_{{eid}}" class="btn-group " style="position: absolute; left: 10px; top: 180px;" >
				  <button type="button"  id="mfAlignLeft_{{eid}}" class="btn mfAlignFontCls_{{eid}}"><i class="fa fa-align-left"></i></button>
				  <button type="button" id="mfAlignCenter_{{eid}}" class="btn mfAlignFontCls_{{eid}}"><i class="fa fa-align-center"></i></button>
				  <button type="button" id="mfAlignRight_{{eid}}" class="btn mfAlignFontCls_{{eid}}"><i class="fa fa-align-right"></i></button>
				   <button type="button" id="mfAlignJustify_{{eid}}" class="btn mfAlignFontCls_{{eid}}"><i class="fa fa-align-justify"></i></button>
				</div>
			
			</div>
			
			*/
console.log;});var compiled_template=Handlebars.compile(htmlCode);var context={eid:thisClass.eid};var compiled_code=compiled_template(context);$("#"+thisClass.settingsHolder.eid+"_font").append(compiled_code);thisClass.setupEvents();$("#"+thisClass.eid).show();}else{$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);}};}function MF_SketchSettings(){var thisClass=this;thisClass.eid=mf_main.editorController.guidGenerator();thisClass.settingsHolder=null;thisClass.NAME="SketchSettings";thisClass.RENDERDOM=true;thisClass.borderWidthBox=null;thisClass.roughBox=null;thisClass.showBorder=true;thisClass.showSetting=true;thisClass.remove=function(delSet){if(delSet){try{if($("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox")){$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").destroy();}if($("#mfRoughness_"+thisClass.eid).data("kendoNumericTextBox")){$("#mfRoughness_"+thisClass.eid).data("kendoNumericTextBox").destroy();}if($("#mfFillOpacity"+thisClass.eid).data("kendoSlider")){$("#mfFillOpacity"+thisClass.eid).data("kendoSlider").destroy();}if($("#mfFillType"+thisClass.eid).data("kendoDropDownList")){$("#mfFillType"+thisClass.eid).data("kendoDropDownList").destroy();}}catch(e){console.log("error occured in the component MF_SketchSettings.js");}$("#"+thisClass.eid).remove();}};thisClass.init=function(settingsHolder){thisClass.settingsHolder=settingsHolder;if(thisClass.RENDERDOM){thisClass.render();}else{thisClass.setupEvents();$("#"+thisClass.eid).show();}MF_ComponentSettingUtils.rememberToggle(thisClass);};thisClass.setupEvents=function(){if(thisClass.RENDERDOM){MF_ComponentSettingUtils.setupToggle(thisClass);$("#mfBorderColor_"+thisClass.eid).spectrum({showInput:true,preferredFormat:"hex6",showPalette:true,showSelectionPalette:true,palette:[MF_ComponentUtils.commonPallete()],show:function(color){mf_main.editorController.shortcutsFlag=false;},hide:function(color){mf_main.editorController.shortcutsFlag=true;},change:function(color){color=MF_Utils.RGBToHex(color.toRgbString());thisClass.settingsHolder.component.e2xml.addPropSingle("borderColor",color);thisClass.settingsHolder.component.render(false);}});$("#mfBorderWidth_"+thisClass.eid).focusin(function(){mf_main.editorController.disableShortcuts();});$("#mfBorderWidth_"+thisClass.eid).focusout(function(){mf_main.editorController.enableShortcuts();});$("#mfBorderWidth_"+thisClass.eid).kendoNumericTextBox({format:"#",spinners:true,spin:onWidthChange,decimals:0,max:maxValue});$("#mfBorderWidth_"+thisClass.eid).focus(function(){$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onWidthChange);$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").bind("change",onWidthChange);});$("#mfRoughness_"+thisClass.eid).focusin(function(){mf_main.editorController.disableShortcuts();});$("#mfRoughness_"+thisClass.eid).focusout(function(){mf_main.editorController.enableShortcuts();});$("#mfRoughness_"+thisClass.eid).kendoNumericTextBox({decimals:1,spinners:true,spin:onRoughChange,max:10});$("#mfRoughness_"+thisClass.eid).focus(function(){$("#mfRoughness_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onRoughChange);$("#mfRoughness_"+thisClass.eid).data("kendoNumericTextBox").bind("change",onRoughChange);});$("#mfFillColor_"+thisClass.eid).spectrum({showInput:true,preferredFormat:"hex6",showPalette:true,showSelectionPalette:true,palette:[MF_ComponentUtils.commonPallete()],show:function(color){mf_main.editorController.shortcutsFlag=false;},hide:function(color){mf_main.editorController.shortcutsFlag=true;},change:function(color){color=MF_Utils.RGBToHex(color.toRgbString());thisClass.settingsHolder.component.e2xml.addPropSingle("fillColor",color);thisClass.settingsHolder.component.render(false);}});$("#mfFillOpacity"+thisClass.eid).kendoSlider({showButtons:false,change:alphaSliderOnSlide,tickPlacement:"none",min:0,max:1,smallStep:0.1,largeStep:0.1,tooltip:{enabled:false}}).data("kendoSlider");$("#mfFillType"+thisClass.eid).kendoDropDownList({select:onGradientSelect});$("#mfRefreshBorder_"+thisClass.eid).on("click",function(){thisClass.settingsHolder.component.e2xml.addPropSingle("seed",0);thisClass.settingsHolder.component.render(false);});}if(thisClass.RENDERDOM==true){thisClass.RENDERDOM=false;}var aslider=$("#mfFillOpacity"+thisClass.eid).data("kendoSlider");aslider.value(thisClass.settingsHolder.component.fillAlpha);if(thisClass.showBorder){$("#mfBorderColor_"+thisClass.eid).spectrum("set",thisClass.settingsHolder.component.borderColor);}var maxValue=500;if(thisClass.showBorder){if(thisClass.settingsHolder.component.MAX_BORDER){maxValue=thisClass.settingsHolder.component.MAX_BORDER;}}function onWidthChange(){$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onWidthChange);$("#mfclipboard").focus();if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}var w=this.value();thisClass.settingsHolder.component.e2xml.addPropSingle("borderWidth",w);thisClass.settingsHolder.component.render(false);}if(thisClass.showBorder){thisClass.borderWidthBox=$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox");thisClass.borderWidthBox.value(thisClass.settingsHolder.component.borderWidth);}function onRoughChange(){$("#mfRoughness_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onRoughChange);$("#mfclipboard").focus();if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}var w=this.value();thisClass.settingsHolder.component.e2xml.addPropSingle("roughness",w);thisClass.settingsHolder.component.render(false);}thisClass.roughBox=$("#mfRoughness_"+thisClass.eid).data("kendoNumericTextBox");thisClass.roughBox.value(thisClass.settingsHolder.component.roughness);$("#mfFillColor_"+thisClass.eid).spectrum("set",thisClass.settingsHolder.component.fillColor);function alphaSliderOnSlide(e){thisClass.settingsHolder.component.e2xml.addPropSingle("fillAlpha",e.value);thisClass.settingsHolder.component.render(false);}if(thisClass.showBorder){$(".mfShowBorder_"+thisClass.eid).show();$("#mfRefreshBorder_"+thisClass.eid).show();$("#mfRoughnessLabel_"+thisClass.eid).css("top","15px");$("#mfRoughnessVal_"+thisClass.eid).css("top","10px");$("#mfRefreshBorder_"+thisClass.eid).css("top","16px");}else{$(".mfShowBorder_"+thisClass.eid).hide();$("#mfRefreshBorder_"+thisClass.eid).hide();$("#mfRoughnessLabel_"+thisClass.eid).css("top","35px");$("#mfRoughnessVal_"+thisClass.eid).css("top","30px");$("#mfRefreshBorder_"+thisClass.eid).css("top","36px");}var dropdownlist=$("#mfFillType"+thisClass.eid).data("kendoDropDownList");if(thisClass.settingsHolder.component.fillType=="solid"){dropdownlist.select(0);}if(thisClass.settingsHolder.component.fillType=="hachure"){dropdownlist.select(1);}if(thisClass.settingsHolder.component.fillType=="zigzag"){dropdownlist.select(2);}if(thisClass.settingsHolder.component.fillType=="cross-hatch"){dropdownlist.select(3);}function onGradientSelect(e){var gtype="solid";if(e.item.index()==0){gtype="solid";}if(e.item.index()==1){gtype="hachure";}if(e.item.index()==2){gtype="zigzag";}if(e.item.index()==3){gtype="cross-hatch";}thisClass.settingsHolder.component.e2xml.addPropSingle("fillType",gtype);thisClass.settingsHolder.component.render(false);}};thisClass.render=function(redraw,mfpage){if(redraw==null){redraw=true;}var htmlCode="";if(redraw){$("#"+thisClass.eid).remove();htmlCode=multiline(function(){
/*!
			
			<div id="{{eid}}_settingToggle"  class="mfImgLink mfSettingsToggleBtn" style=" " >
				
					<div style="float: left; width: 185px; padding-left: 5px;">Roughness</div>
					 
					<div style="float: left; width: 50px; text-align: right;">
						<span id="{{eid}}_settingToggleHide"  style="display: none; font-size: 20px;" class="ico-angle-right"></span>
						<span id="{{eid}}_settingToggleShow"  style="font-size: 20px;" class="ico-angle-down"></span>
					</div>
			</div>
						
			<div id="{{eid}}_partSetting" style="overflow: hidden; position: relative; width:100%; height: 260px;" >		

					<div id="mfRoughnessLabel_{{eid}}"  style="position: absolute; left: 10px; top: 15px;">Roughness:</div>
					<div id="mfRoughnessVal_{{eid}}"  style="position: absolute; left: 100px; top: 10px;"><input style="width: 70px;" id="mfRoughness_{{eid}}" type="number" value="1" min="0.5"  step="0.5" /></div>
					<i   data-toggle="tooltip"  data-placement="bottom" title="Redraw border" id="mfRefreshBorder_{{eid}}"  style="position: absolute; left: 180px; top: 16px; cursor: pointer; font-size: 18px;" class='fa-refresh'></i>
				
					<div  class="mfShowBorder_{{eid}}" style="position: absolute; left: 10px; top: 53px;">Border Color:</div>
					<div   class="mfShowBorder_{{eid}}" style='position: absolute; left: 100px; top: 47px;' ><input  id='mfBorderColor_{{eid}}' style='width: 100px;' type='text'  /></div>

					<div  class="mfShowBorder_{{eid}}" style="position: absolute; left: 10px; top: 95px;">Thickness:</div>
					<div  class="mfShowBorder_{{eid}}" style="position: absolute; left: 100px; top: 90px;"><input style="width: 70px;" id="mfBorderWidth_{{eid}}" type="number" value="1" min="0"  step="1" /></div>

					<div style="position: absolute; left: 10px; top: 135px;">Fill Type:</div>
			
					 <select style="left: 100px; top: 130px; width: 100px;" id="mfFillType{{eid}}">					 
					 <option>Solid fill</option>
					 <option>Sketchy fill</option>
					 <option>Sketchy fill 2</option>
					 <option>Grid fill</option>
					 </select>
					
					<div  style='position: absolute; left: 100px; top: 160px;' ><input style='width: 100px;' type='text' id='mfFillColor_{{eid}}' /></div>
					
		
		
					<div style="position: absolute; left: 10px; top: 210px;">Opacity:</div>
					<div style="position: absolute; height: 25px; font-size: 11px;  width: 100px; left: 100px; top: 205px;">
					<input id="mfFillOpacity{{eid}}" style="width: 100px;" class="balSlider" value="0" />
					</div>
			
			
			</div>
			
			*/
console.log;});var compiled_template=Handlebars.compile(htmlCode);var context={eid:thisClass.eid};var compiled_code=compiled_template(context);$("#"+thisClass.settingsHolder.eid+"_sketch").append(compiled_code);thisClass.setupEvents();$("#"+thisClass.eid).show();}else{$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);}};}function MF_SketchSettings2(){var thisClass=this;thisClass.eid=mf_main.editorController.guidGenerator();thisClass.settingsHolder=null;thisClass.NAME="SketchSettings2";thisClass.RENDERDOM=true;thisClass.borderWidthBox=null;thisClass.roughBox=null;thisClass.showSetting=true;thisClass.remove=function(delSet){if(delSet){try{if($("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox")){$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").destroy();}if($("#mfRoughness_"+thisClass.eid).data("kendoNumericTextBox")){$("#mfRoughness_"+thisClass.eid).data("kendoNumericTextBox").destroy();}}catch(e){console.log("error occured in the component MF_SketchSettings2.js");}$("#"+thisClass.eid).remove();}};thisClass.init=function(settingsHolder){thisClass.settingsHolder=settingsHolder;if(thisClass.RENDERDOM){thisClass.render();}else{thisClass.setupEvents();$("#"+thisClass.eid).show();}MF_ComponentSettingUtils.rememberToggle(thisClass);};thisClass.setupEvents=function(){if(thisClass.RENDERDOM){MF_ComponentSettingUtils.setupToggle(thisClass);$("#mfBorderColor_"+thisClass.eid).spectrum({showInput:true,preferredFormat:"hex6",showPalette:true,showSelectionPalette:true,palette:[MF_ComponentUtils.commonPallete()],show:function(color){mf_main.editorController.shortcutsFlag=false;},hide:function(color){mf_main.editorController.shortcutsFlag=true;},change:function(color){color=MF_Utils.RGBToHex(color.toRgbString());thisClass.settingsHolder.component.e2xml.addPropSingle("borderColor",color);thisClass.settingsHolder.component.render(false);}});$("#mfBorderWidth_"+thisClass.eid).focusin(function(){mf_main.editorController.disableShortcuts();});$("#mfBorderWidth_"+thisClass.eid).focusout(function(){mf_main.editorController.enableShortcuts();});$("#mfBorderWidth_"+thisClass.eid).kendoNumericTextBox({format:"#",spinners:true,spin:onWidthChange,decimals:0,max:maxValue});$("#mfBorderWidth_"+thisClass.eid).focus(function(){$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onWidthChange);$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").bind("change",onWidthChange);});$("#mfRoughness_"+thisClass.eid).focusin(function(){mf_main.editorController.disableShortcuts();});$("#mfRoughness_"+thisClass.eid).focusout(function(){mf_main.editorController.enableShortcuts();});$("#mfRoughness_"+thisClass.eid).kendoNumericTextBox({decimals:1,spinners:true,spin:onRoughChange,max:10});$("#mfRoughness_"+thisClass.eid).focus(function(){$("#mfRoughness_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onRoughChange);$("#mfRoughness_"+thisClass.eid).data("kendoNumericTextBox").bind("change",onRoughChange);});$("#mfRefreshBorder_"+thisClass.eid).on("click",function(){thisClass.settingsHolder.component.e2xml.addPropSingle("seed",0);thisClass.settingsHolder.component.render(false);});}if(thisClass.RENDERDOM==true){thisClass.RENDERDOM=false;}$("#mfBorderColor_"+thisClass.eid).spectrum("set",thisClass.settingsHolder.component.borderColor);var maxValue=500;if(thisClass.settingsHolder.component.MAX_BORDER){maxValue=thisClass.settingsHolder.component.MAX_BORDER;}function onWidthChange(){$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onWidthChange);$("#mfclipboard").focus();if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}var w=this.value();thisClass.settingsHolder.component.e2xml.addPropSingle("borderWidth",w);thisClass.settingsHolder.component.render(false);}thisClass.borderWidthBox=$("#mfBorderWidth_"+thisClass.eid).data("kendoNumericTextBox");thisClass.borderWidthBox.value(thisClass.settingsHolder.component.borderWidth);function onRoughChange(){$("#mfRoughness_"+thisClass.eid).data("kendoNumericTextBox").unbind("change",onRoughChange);$("#mfclipboard").focus();if(this.value()==""||this.value()==null){if(this.value()!=0&&this.value()!="0"){return;}}var w=this.value();thisClass.settingsHolder.component.e2xml.addPropSingle("roughness",w);thisClass.settingsHolder.component.render(false);}thisClass.roughBox=$("#mfRoughness_"+thisClass.eid).data("kendoNumericTextBox");thisClass.roughBox.value(thisClass.settingsHolder.component.roughness);};thisClass.render=function(redraw,mfpage){if(redraw==null){redraw=true;}var htmlCode="";if(redraw){$("#"+thisClass.eid).remove();htmlCode=multiline(function(){
/*!
			
			<div id="{{eid}}_settingToggle"  class="mfImgLink mfSettingsToggleBtn" style=" " >
				
					<div style="float: left; width: 185px; padding-left: 5px;">Roughness</div>
					 
					<div style="float: left; width: 50px; text-align: right;">
						<span id="{{eid}}_settingToggleHide"  style="display: none; font-size: 20px;" class="ico-angle-right"></span>
						<span id="{{eid}}_settingToggleShow"  style="font-size: 20px;" class="ico-angle-down"></span>
					</div>
			</div>
						
			<div id="{{eid}}_partSetting" style="overflow: hidden; position: relative; width:100%; height: 150px;" >		

					<div style="position: absolute; left: 10px; top: 15px;">Roughness:</div>
					<div style="position: absolute; left: 100px; top: 10px;"><input style="width: 70px;" id="mfRoughness_{{eid}}" type="number" value="1" min="0.5"  step="0.5" /></div>
					<i  data-toggle="tooltip"  data-placement="bottom" title="Redraw border" id="mfRefreshBorder_{{eid}}"  style="position: absolute; left: 180px; top: 16px; cursor: pointer; font-size: 18px;" class='fa-refresh'></i>
				
					<div style="position: absolute; left: 10px; top: 53px;">Border Color:</div>
					<div  style='position: absolute; left: 100px; top: 47px;' ><input  id='mfBorderColor_{{eid}}' style='width: 100px;' type='text'  /></div>

					<div style="position: absolute; left: 10px; top: 95px;">Thickness:</div>
					<div style="position: absolute; left: 100px; top: 90px;"><input style="width: 70px;" id="mfBorderWidth_{{eid}}" type="number" value="1" min="1"  step="1" /></div>

					
			
			
			</div>
			
			*/
console.log;});var compiled_template=Handlebars.compile(htmlCode);var context={eid:thisClass.eid};var compiled_code=compiled_template(context);$("#"+thisClass.settingsHolder.eid+"_sketch2").append(compiled_code);thisClass.setupEvents();$("#"+thisClass.eid).show();}else{$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);}};}function MF_TextUtilitySettings(){var thisClass=this;thisClass.eid=mf_main.editorController.guidGenerator();thisClass.settingsHolder=null;thisClass.NAME="PowerupSettings";thisClass.RENDERDOM=true;thisClass.showSetting=true;thisClass.remove=function(delSet){if(delSet){$("#"+thisClass.eid).remove();}};thisClass.init=function(settingsHolder){if(mf_main.INTEGRATION){return;}thisClass.settingsHolder=settingsHolder;if(thisClass.RENDERDOM){thisClass.render();}else{thisClass.setupEvents();$("#"+thisClass.eid).show();}MF_ComponentSettingUtils.rememberToggle(thisClass);};thisClass.setupEvents=function(){if(thisClass.RENDERDOM){if(MF_UserSession.getUser()&&!MF_UserSession.allowAllPowerups()){$(".mfTextUtilitySettCls_"+thisClass.eid).css("opacity",0.5);}MF_ComponentSettingUtils.setupToggle(thisClass);$("#mfSpellChecker_"+thisClass.eid).on("click",function(event){mf_main.editorController.powerupController.openPowerupbyID("Dffa438ca65838522b42fbd380f256fbf");});$("#mfTranslator_"+thisClass.eid).on("click",function(event){mf_main.editorController.powerupController.openPowerupbyID("Dd4d58e1c4c562c25f17d9e2cabc8c8e4");});$("#mfDummydata_"+thisClass.eid).on("click",function(event){mf_main.editorController.powerupController.openPowerupbyID("D19e07a5843a39033a304b2a1217556bd");});}if(thisClass.RENDERDOM==true){thisClass.RENDERDOM=false;}};thisClass.render=function(redraw,mfpage){if(redraw==null){redraw=true;}var htmlCode="";if(redraw){$("#"+thisClass.eid).remove();htmlCode=multiline(function(){
/*!
			
			<div id="{{eid}}_settingToggle"  class="mfImgLink mfSettingsToggleBtn" style=" " >
				
					<div style="float: left; width: 185px; padding-left: 5px;">Text Utilities</div>
					
					<div style="float: left; width: 50px; text-align: right;">
						<span id="{{eid}}_settingToggleHide"  style="display: none; font-size: 20px;" class="ico-angle-right"></span>
						<span id="{{eid}}_settingToggleShow"  style="font-size: 20px;" class="ico-angle-down"></span>
					</div>
			</div>
						
			<div id="{{eid}}_partSetting" style="overflow: hidden; position: relative; width:100%; height: 160px;" >	 	
				<br/>				
				<a style="width: 220px;top: 30px;text-align: left; font-size: 14px; padding-left: 20px; cursor: pointer;" class="mfTextUtilitySettCls_{{eid}}" id="mfSpellChecker_{{eid}}" ><img style="width: 18px; height: auto; margin-right: 5px;" src="images/editor/settings/spellcheck.png" />Check Spelling</a>
				<br/><br/>
				<a style="width: 220px;top: 50px;text-align: left; font-size: 14px; padding-left: 20px; cursor: pointer;" class="mfTextUtilitySettCls_{{eid}}" id="mfTranslator_{{eid}}" ><img style="width: 18px; height: auto; margin-right: 5px;" src="images/editor/settings/translate.png" />Translate Text</a>
				<br/><br/>
				<a style="width: 220px;top: 70px;text-align: left; font-size: 14px; padding-left: 20px; cursor: pointer;" class="mfTextUtilitySettCls_{{eid}}" id="mfDummydata_{{eid}}" ><img style="width: 20px; height: auto; margin-right: 5px;" src="images/editor/settings/dummy.png" />Populate dummy data</a>
			</div>
			
			*/
console.log;});var compiled_template=Handlebars.compile(htmlCode);var context={eid:thisClass.eid};var compiled_code=compiled_template(context);$("#"+thisClass.settingsHolder.eid+"_powerup").append(compiled_code);thisClass.setupEvents();$("#"+thisClass.eid).show();}else{$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);}};}function MF_CSSSettings(){var thisClass=this;thisClass.eid=mf_main.editorController.guidGenerator();thisClass.settingsHolder=null;thisClass.NAME="CSSSettings";thisClass.classTypeDropdown=null;thisClass.cssTextBox=null;thisClass.RENDERDOM=true;thisClass.showSetting=true;thisClass.currentCSSClassObj=null;thisClass.currentCSSClassName="";thisClass.cssObj=null;thisClass.remove=function(delSet){if(delSet){try{if($("#mfCssClassType"+thisClass.eid).data("kendoDropDownList")){$("#mfCssClassType"+thisClass.eid).data("kendoDropDownList").destroy();}}catch(e){console.log("error occured in the component MF_CSSSettings.js");}$("#"+thisClass.eid).remove();}};thisClass.init=function(settingsHolder){thisClass.settingsHolder=settingsHolder;if(thisClass.RENDERDOM){thisClass.render();}else{thisClass.setupEvents();$("#"+thisClass.eid).show();}MF_ComponentSettingUtils.rememberToggle(thisClass);};thisClass.setupEvents=function(){$("#mfCssClassType"+thisClass.eid);if(thisClass.RENDERDOM){MF_ComponentSettingUtils.setupToggle(thisClass);$("#mfCssClassType"+thisClass.eid).kendoDropDownList({select:onCssClassSelect});$("#mfPickColor_"+thisClass.eid).spectrum({showInput:true,preferredFormat:"hex6",showPalette:true,showSelectionPalette:true,palette:[MF_ComponentUtils.commonPallete()],show:function(color){mf_main.editorController.shortcutsFlag=false;},hide:function(color){},change:function(color){color=MF_Utils.RGBToHex(color.toRgbString());$("#mfCSSText_"+thisClass.eid).val($("#mfCSSText_"+thisClass.eid).val()+" "+color);}});thisClass.classTypeDropdown=$("#mfCssClassType"+thisClass.eid).data("kendoDropDownList");}thisClass.classTypeDropdown.setDataSource(thisClass.settingsHolder.component.cssClasses);thisClass.cssObj=new Object();if(thisClass.settingsHolder.component.cssJson!=""){try{thisClass.cssObj=JSON.parse(thisClass.settingsHolder.component.cssJson);}catch(e){}}var cssClasses=thisClass.settingsHolder.component.cssClasses;var ind=thisClass.classTypeDropdown.select();thisClass.currentCSSClassName=cssClasses[ind];thisClass.renderCssItems();if(thisClass.RENDERDOM==true){thisClass.RENDERDOM=false;}$("#mfCSSText_"+thisClass.eid).focusin(function(){mf_main.editorController.disableShortcuts();});$("#mfCSSText_"+thisClass.eid).focusout(function(){mf_main.editorController.enableShortcuts();saveCSS();});$("#mfCSSText_"+thisClass.eid).keypress(function(event){var keycode=(event.keyCode?event.keyCode:event.which);if(keycode=="13"){}});function saveCSS(){var cssval=$("#mfCSSText_"+thisClass.eid).val();var parser=new cssjs();var parsed=parser.parseCSS(".csscls{"+cssval+"}");thisClass.currentCSSClassObj=new Object();if(parsed&&parsed.length>=1){var obj=parsed[0];if(obj.rules){for(var j=0;j<obj.rules.length;j++){var cssval=obj.rules[j];if(thisClass.filterProps(cssval.directive)){thisClass.currentCSSClassObj[cssval.directive]=thisClass.filterVals(cssval.value);}}thisClass.cssObj[thisClass.currentCSSClassName]=thisClass.currentCSSClassObj;var cssres="";try{cssres=JSON.stringify(thisClass.cssObj);}catch(e){}cssres=cssres.trim();var cssObj2=new Object();if(cssres!=""){cssObj2=thisClass.cssObj;}thisClass.settingsHolder.component.cssObj=cssObj2;thisClass.renderCssItems(cssObj2);if(cssres!=thisClass.settingsHolder.component.cssJson){thisClass.settingsHolder.component.e2xml.addPropSingle("cssJson",cssres);thisClass.settingsHolder.component.render(true);mf_main.editorController.reStackComponents();}}}}function onCssClassSelect(e){var num=e.item.index();thisClass.currentCSSClassName=cssClasses[num];thisClass.renderCssItems();}};thisClass.badProps=["font-family","visibility","position","max-width","min-width","max-height","min-height","z-index","zindex","display","top","left","bottom","right","width","height"];thisClass.filterProps=function(pname){for(var j=0;j<thisClass.badProps.length;j++){if(thisClass.badProps[j]==pname){return false;}}return true;};thisClass.badVals=["url:","data:"];thisClass.filterVals=function(pval){for(var j=0;j<thisClass.badVals.length;j++){if(thisClass.badVals[j].includes(pval)){return"";}}return pval;};thisClass.renderCssItems=function(){if(!thisClass.cssObj[thisClass.currentCSSClassName]){thisClass.cssObj[thisClass.currentCSSClassName]=new Object();}thisClass.currentCSSClassObj=thisClass.cssObj[thisClass.currentCSSClassName];var cssVal="";var count=0;for(var prop in thisClass.cssObj[thisClass.currentCSSClassName]){if(count==0){cssVal=prop+": "+thisClass.cssObj[thisClass.currentCSSClassName][prop]+";";}else{cssVal=cssVal+"\n"+prop+": "+thisClass.cssObj[thisClass.currentCSSClassName][prop]+";";}count++;}$("#mfCSSText_"+thisClass.eid).val(cssVal);};thisClass.render=function(redraw,mfpage){if(redraw==null){redraw=true;}var htmlCode="";if(redraw){$("#"+thisClass.eid).remove();htmlCode=multiline(function(){
/*!
			
			<div id="{{eid}}_settingToggle"  class="mfImgLink mfSettingsToggleBtn" style=" " >
				
					<div style="float: left; width: 185px; padding-left: 5px;">Custom CSS</div>
					 
					<div style="float: left; width: 50px; text-align: right;">
						<span id="{{eid}}_settingToggleHide"  style="display: none; font-size: 20px;" class="ico-angle-right"></span>
						<span id="{{eid}}_settingToggleShow"  style="font-size: 20px;" class="ico-angle-down"></span>
					</div>
			</div>
						
			<div id="{{eid}}_partSetting" style="overflow: hidden; position: relative; width:100%; height: 300px;" >		

					
					<div style="position: absolute; left: 10px; top: 15px; font-size: 14px;">CSS class:</div>
	
					<select style="left: 80px; top: 12px; width: 100px;" id="mfCssClassType{{eid}}">
					
					 </select>
					 
					 <div  style='position: absolute; left: 205px; top: 11px;' ><input style='width: 100px;' type='text' id='mfPickColor_{{eid}}' /></div>
				
					<div style="position: absolute; left: 10px; top: 53px; font-size: 14px;">CSS code:</div>
					
					<i data-toggle="tooltip"  data-placement="top" title="Custom CSS code will override other style settings" style="position: absolute; left: 215px; top: 55px; cursor: pointer; font-size: 16px; color: #000;" class="ico-info"></i>
					
					<div  style='position: absolute; left: 10px; top: 80px;' >
					
						    <textarea placeholder="color: blue;&#10;word-spacing: 5px;&#10;Add custom styles here..." style="resize: none; width: 222px; height: 132px;" class="form-control mfCSSTextCls" id='mfCSSText_{{eid}}' ></textarea>
						
							<br/>
							<a style="margin-top: -12px; display: block;" href="https://support.mockflow.com/article/231-style-components-with-css" target="_blank">Learn more on Custom CSS</a>
							
							<div style="margin-top: 5px">CSS Gradient examples: <a href="https://webgradients.com/" target="_blank">Open link</a></div>
			
							<div style="margin-top: 5px;">CSS Shadow examples: <a href="https://getcssscan.com/css-box-shadow-examples" target="_blank">Open link</a></div>
					</div>

				
					<div id="{{eid}}_basic"  style='position: absolute; left: 0px; top: 0px; width: 250px; height: 250px; background-image: linear-gradient(rgba(255,255,255,0.5), white); display: none;' >
					
						<span id="{{eid}}_basiclink"  style="cursor: pointer; color: #2196F3; position: absolute; top: 160px; width: 250px; text-align: center; height: 30px; font-size: 14px; padding: 10px;">
						
							<img src="images/editor/crown.png" style="margin-top: -5px; height: 22px;" alt="" /> Custom CSS is available only <br/>for paid plans
							
						</span>
					
					</div>
					
			
			</div>
			
			*/
console.log;});var compiled_template=Handlebars.compile(htmlCode);var context={eid:thisClass.eid};var compiled_code=compiled_template(context);$("#"+thisClass.settingsHolder.eid+"_css").append(compiled_code);thisClass.setupEvents();$("#"+thisClass.eid).show();}else{$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);}};}function MF_IllustrationColors(){var thisClass=this;thisClass.eid=mf_main.editorController.guidGenerator();thisClass.NAME="IllustrationColors";thisClass.settingsHolder=null;thisClass.cssCode="";thisClass.showSpec=true;thisClass.remove=function(){$("#"+thisClass.eid).remove();};thisClass.init=function(settingsHolder){thisClass.settingsHolder=settingsHolder;thisClass.render();MF_ComponentSettingUtils.rememberSpecToggle(thisClass);};thisClass.generateColorListing=function(currentColors){};this.colorDict=new Object();thisClass.setupEvents=function(){MF_ComponentSettingUtils.setupSpecToggle(thisClass);var currentColors=thisClass.settingsHolder.component.currentColors;if(typeof(currentColors)=="string"){currentColors=JSON.parse(currentColors);}$("#mfRestoreIllustrationColors_"+thisClass.eid).on("click",function(event){for(var key in currentColors){if(key=="nocolor"){key="#000000";currentColors.nocolor=key;$("#"+thisClass.colorDict.nocolor).spectrum("set",key);}else{currentColors[key]=key;$("#"+thisClass.colorDict[key]).spectrum("set",key);}}thisClass.settingsHolder.component.e2xml.addPropSingle("currentColorsData",JSON.stringify(currentColors));thisClass.settingsHolder.component.getColors=true;thisClass.settingsHolder.component.render(true);mf_main.editorController.reStackComponents();});for(var key in currentColors){if(currentColors.hasOwnProperty(key)){var value=currentColors[key];var uuid=MF_Utils.guidGenerator();thisClass.colorDict[key]=uuid;$("#"+thisClass.eid+"_partSpec").append('<div style="padding: 5px 5px; height: 40px; width: 230px; vertical-align: middle;"><div style="float: left; width: 100px;"><div style="float: left; width: 30px; height: 30px; border-radius: 30px; background: '+value+'; border: 1px solid #ccc;cursor: pointer;"><input id="'+uuid+'" style="width: 100px;" type="text"/></div> <div id="'+uuid+'_color" style="width: 60px; height: 30px; float: right; margin-top: 6px;">'+value+'</div> </div><div id="'+uuid+'_copy"   class="ico-copy mfIllustrationCopyColorCode" data-color="'+value+'" style="float: right; text-align: right; width:auto;margin-top:6px;cursor: pointer;font-size: 14px;" data-original-title="Click to Copy" data-toggle="tooltip" data-placement="left"></div></div>');$("#"+uuid).data("initial-color",key);$("#"+uuid).spectrum({showInput:true,preferredFormat:"hex6",showPalette:true,showSelectionPalette:true,palette:[MF_ComponentUtils.commonPallete()],show:function(color){mf_main.editorController.shortcutsFlag=false;},hide:function(color){mf_main.editorController.shortcutsFlag=true;},change:function(color){var newColor="#"+color.toHex().toLowerCase();var initialColor=$(this).data("initial-color");thisClass.settingsHolder.component.currentColors[initialColor]=newColor;thisClass.settingsHolder.component.e2xml.addPropSingle("currentColorsData",JSON.stringify(thisClass.settingsHolder.component.currentColors));var uid=$(this).attr("id");$("#"+uid+"_color").text(newColor);$("#"+uid+"_copy").attr("data-color",newColor);thisClass.settingsHolder.component.getColors=true;thisClass.settingsHolder.component.render(true);mf_main.editorController.reStackComponents();}});$("#"+uuid).spectrum("set",value);}}$(".mfIllustrationCopyColorCode").on("click",function(){MF_Utils.copyToClipBoard4($(this).attr("data-color"));});};thisClass.render=function(redraw){if(redraw==null){redraw=true;}var htmlCode="";if(redraw){$("#"+thisClass.eid).remove();htmlCode=multiline(function(){
/*!
			
			<div id="{{eid}}_specToggle"  class="mfImgLink mfSettingsToggleBtn" style=" " >
				
					<div style="float: left; width: 185px; padding-left: 5px;">Colors</div>
					
					<div style="float: left; width: 50px; text-align: right;">
						<span id="{{eid}}_specToggleHide"  style="display: none; font-size: 20px;" class="ico-angle-right"></span>
						<span id="{{eid}}_specToggleShow"  style="font-size: 20px;" class="ico-angle-down"></span>
					</div>
			</div>
						
			<div id="{{eid}}_partSpec" class="mfIllustrationColors" style="overflow: hidden; position: relative; width:100%; padding-bottom: 20px; padding-top: 10px; padding-left: 5px; padding-right: 5px;word-break: break-word; " >		
			
			
				<div class="w-100" style="padding-bottom: 10px;" >
					<a id="mfRestoreIllustrationColors_{{eid}}" style="width: 220px; margin: auto;font-weight: normal;display: flex;align-items: center;justify-content: center;" class="btn mfSidebarShadowButton">Restore default colors</a>
				</div>
				
			</div>
			
			*/
console.log;});var compiled_template=Handlebars.compile(htmlCode);var context={eid:thisClass.eid};var compiled_colors=compiled_template(context);$("#"+thisClass.settingsHolder.eid+"_colors").empty();$("#"+thisClass.settingsHolder.eid+"_colors").append(compiled_colors);thisClass.setupEvents();$("#"+thisClass.eid).show();}else{$("#"+thisClass.eid).css("left",thisClass.x);$("#"+thisClass.eid).css("top",thisClass.y);}};}